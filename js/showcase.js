/*! For license information please see showcase.js.LICENSE.txt */
(()=>{var e,t,i,n,s={87207:(e,t,i)=>{"use strict";e.exports=i.p+"images/chrome.png"},75673:(e,t,i)=>{"use strict";e.exports=i.p+"images/edge.png"},68472:(e,t,i)=>{"use strict";e.exports=i.p+"images/firefox.png"},81826:(e,t,i)=>{"use strict";e.exports=i.p+"images/safari.png"},24877:(e,t,i)=>{"use strict";e.exports=i.p+"images/showcase-password-background.jpg"},90831:(e,t,i)=>{"use strict";e.exports=i.p+"images/matterport-logo-light.svg"},99612:(e,t,i)=>{"use strict";e.exports=i.p+"images/puck_256_red.png"},408:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAMAAABrrFhUAAAAhFBMVEUAAAD///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8g2+bRAAAAK3RSTlMAswpHBJ4d+GmsJHYX2zYTkGDwT4Prp4kPWjvMP6Ms5uFvMJZVfsPSe7i+UNMvaAAAD+NJREFUeNrs2Yd2okAUBuB/CsPM0AXFXrDL+7/fuutKMclmKSLJyfcAOvdyy3DAjx8/umW7u020VZejsx4OzKvBcO0cD8qIrYBpju9r7Er/7JjpP5nrg3FiAt/MmO3JOq1gcNgGGt+DCIxjWsuQWFOKL40y30kbMYn8spUg5MVM2+D47OvNRmEd0k9cx//KuVpdl8Gn3bCd4wsZy8PHocyUv9mxRFAUcHs5D+XeuHy8JVa+i6+BLcz3Izj7gUvxCS6YtZi9/wtHOUbfedb6vWq/RKGHMu55QugrITyPo4wvA8N574eMKfpsaZhvz3y2Eo47KlwWWJFvKFKiDD+yAuYWO8Nj8TsLdLbr7URkl7dFGzOKG6qZjBbkU4tIMp2lwQ4Ww/TBetPL20E4e/OsLI0bwaRPKvFldh/mbLtKywZR74bB7vgY/UbgD5udRqSW0YnZuJn7w4cU7HtVBewh/KG/xG/clQZpxJAux298d374D6s3KXAfev8cclxR11KkBcr6uzzFySnv1QB9oEfl2vQ1rngWfUs54LcyOJT77PVLkUalxedsxn/fAEnLjEDcym1U+sORwEsxpxR+wAHweUyeIp5zXInSZcO0OF5GkNLO3+GK7gzyNMaO4kqXUjBL8CJB8RjrCa5sqchTKWnfUlAsgpjiBTxVPMOe/gmfdOCWguRS7D0XnWOrNLcQnYWfpyB00oy5QbeoX2xCF8BYKtIZJccAuDVIM8RDh5bHNLOaAODhiHRqFPKHKbx20ZmNmddeRAG4Bumc4eJqtyosRHRDnAurLwFgR+QlIhuAZ3TdBklh+vkU4KEiL6JCDiAc5m0wxdOFZt79DID2yQv5GoB97nAbbNKM8gA+IS824QCkmRclnon7ea4lAOGTl/MFgMTJ7yQcT0NJvvs1AKZIDygGwMuPdqZ4EjHLC40D1CI9YVEA+/zheHiKZFUuf4P0hiEAsOxe6Ai0rfT7AwZg3ovyv1NzAMt1tp+WaB0zs2WbAFySnpEcsLMeHUzRsrmZdZgA6J70zp4Wp7TJ0Co3q39CARqTHoopgG2WgSlalAyK9wxvS3pp6wGIsy5YojXL7Lbdt/FfZojiOlwJtERn+y8AoEekt0a6eFt3PLRCr4vxu71af4+UC0Bm85qiBcIpxs9aKdVIhmyaaGGPOR/bQidTFsqoldZixRo4czQ2LsUfNg3dmsw1xQeonk+spmkIi3NggcZIcf4x0sDCYgL/QTBr0bQG4rbejvNcRgBcUpc6hQIViPCkSF1u8T5goRGW/rUFoOueKWYUlVEW1822BkBauRDp+wVIARCjem0/sVGTPTHqbUMB0Fl6s/ZQGz2mNwcKeLUOs9FoRG9qJd0D7Pv2JqhtdE+iDdBtvS+ZjdT+3rqlwHLQbAzk69RMar3/qMBDK7xA1XozYvfzuw3fgHcA31fuwwlFa+ik8vzZc2DfaAyIYWEBSlKRpGgVrX4CAKTJGDinNxcA8+rfK9pV5wvMHPCc+mNApjdDGxCqWvUzPAWr1gdKAIlZdwzo+wBgADWqbb4xnmRcbScaNH+ODkU1h/QmBmCRChYJnij5Rd25LScLBEG4WVjkpKIQxROJ0eTX+P7v91+IswHRnbUquvvdJVWpCM70dA+IRikh/dXJ88cm4CowTEDlGH/KuDTMRdkbzXIDwkvrJIYCsMCfszCUgUK9l3xiJZ5BblD+NZ5AbdAGeQBI80ng00kzOuFlhadQlUYlOX5vyjkEEzFs/qIGEhPn8RzMfFkC7E9nZqZLkC8gyG1qf8XCpAnIEC7ZCkijszAQ3Kfim+wIw2nT0uBAolEAWcyV2yWezJL90jIgpb2ugQc8Aii5/6TG06ljrjYDQaNq7wJ6PGUBRvwl3AtIYv6StOCPwqWyjoG09/03qQEZAD9NtBPcEDCt+Aq4xItY8nXwkyabhvXpzAGoZlbq/wOzYFYBkt7Y+xxVqUQWzv8H/UCktL3EPahStkAW2+b/HveEcaZKQHAW4R/sAijxYkrTEtjiDsmvAuAJ7Ms/xFzxRpUqgY8At9lRmTALoMbLqZklQBZ/j5uIKQlFZr8AmglhRv290m6CBxkQOSEABjIQASNtKGyuhUpAcEbAZgwrGG84g0CQyZM6F5wAe4/BJyzh02Owp83IoLo/A7+ZKWALa9iyEgGFwgi9VI1KLniXwmYvn4AEz7WvgUPzWTf0MlEzcG53BHgsFMyB8HRmhGsoMeZA6OnJYRW5pyekqJOjh+x0pgYmnh7LHnKXeHomJIPvvUJC/RFI6zPQNRFPBpsLZWtcs6JFwIihgNY8wuaCmLF2Yznd9dclVCYgdcQDGzvilBY+b8EtG7xiucDYugJgv+zmOpl/axmcsjrAjicYdZiwemB3Yw6IgUEHxJaEgDbj2KAHhujg0++D2L0RwB0EsZoDCdqoyhhxsrWVZKwe2PTngSFpQ+RSCjLNRBE5fq/XBg4EIF0zgSZ2ULYOlSCLeOTUkYS1SE73/uvbC+U0BH0XTRDfDPnAnI6V+H1WDq5KIE8GD4DfIwKV6ouZPlZbzFwbYoBx44Z7XMA3ELq1CDFfjIQ08RIoUronwHcxBpgEAp8uEU2u16EFwwUcYDUHvhPYXWtgCOw8DQWspvA07ICaGr6ThKaA8HRY/v0neg0TCC6HS4zolGi91AaWs2H42BUVfINqCl8fKC0nZajgprsUmVNAipwegqxBGNHQU3oekw8sHZcAhgiUZHtkdyGcARt3g9AFqVexsDsG3s5GGBDOSwBDBARwHgMfnSQwBEKHk+CFBd8MB+17446MdZgD3/azZqzFftppoCBN8J1dBikSfhrw2zYgZazWrU5CZwTjosZXOw6l9GPq/hAApF7Io/ZSaE5ZsHTjtrB7sA6iaH+aVJIPyt28IvKfvTNoTRgIovCAm4gxEhOwFMHqQYL9/3+wl5mJUyis1EOSb/fW3lyym5l57315TR85ujxURVmwEamW3QvndcSVN8S7mJFoRXZL7wRyuoGdawNjHIckSbPNhrw1R5IkRbfYwSrhbjHWyH/ZJjuRbZCIbzYgaVdQB2VUQq3IEJqBk83J68U3wyJ5v+IUpIHBrGP1gkWhabUZG3ANU0E9EBkPz4zcsX+vz4yDrNfeyxsw2289Pq9UNiB7A8oRKJdgeQ2GQqhjFEKdF0KlFC7NUGmHn5SxL+xApNIUBXYkhh+K7lUdx47Fe+WLYIWRDV0aaxQfixVHE1Qe33p3f9O/KQaJ5AaJWArWWIuM3QlYk9RDX4swm9z+t1v+gjVK1hqbxVplZdDXANUsLaM3xMe12+WP0S4fc6M9NjCh/6qwkZlGi2FsaEo0Ut1RY3Pmk9pQg5Oem8NGZ886KMeGp42g0VLj83YJ9FSAgs1JL1iERmOAISpExSEia8foOC4nrgmyRQUp2c5csSgtB81RYWr+bFBxetPeUIGKdjruVKSmPR3fVKiqo7drKlbX2qQHFaxs/cAhQdHazta+U+HqNi4dqXh9OdsdQf3AgolmH9RPbPyQd2+7jcJAGID/MbY54zSkkIQcSbpq1+//fqvdBJterFRzCEh8l71oizszNrHU3zSJXGjICvjFdElCP3GcfC/cHoeM2cG1ydpbaNCSCdoRS43awqYpgYWGrWHblMBS4/ZM5m690MBFsHf9z++lRm6aiNp8oaGrYOfmpXChsbt4a1ZrocHL5o1gLRcavW1eCmmh4etAoR/uC43fN+9NZ+Wy1rTZ4iW2G3KpS3U277g/ZIeGcGoCEie8wEmQUwMIhy2wwSt7GJAh0ZwGwY5+LpT2CFBxOKifTfCeAB452CiMSm3IgQck788GqOGk1OaeCDE5ONYYUX0kB7HNEtcl3LBUPwQAE+TiusVItldyIRgQ6IeUwVHm29KRIbkoPIzCK8hFKG0r+xmcxc3aKeBAblYRBhetyM0BUKnNEndH9kCIgBwFDINi7r/Bt0foQl3shwj8gxwVO4bBsF1Bjj64/XDnomB0GQPaA1hJrsI3hUGot5BclQzw9PcB0H0MrE8Au5GzMEjQWxKE5OzGgNPaHAE7o6aGEkAJ6uAaoZfoSh0IBSSX7wOg3xioGCAL6kLsEnSU7AR1UUiAVXYA9LD3W8sYhdRN6TE4Y15J3YRRq3j9PXq56qcbgIy6Cj9zCQcy/wypqwzATT9d0dNKtw7THvVwjD2JH5BefKQePAClflqht6Nu3Snk1I+Id4eI4T9YdNjFgvrJW7c7+oj++Fe7mjwagNgEubevI5lsOd8mMqr3Xh5sBA3Aa/ftF0d/dp7qAEAW0oyFGYBA271rECpt10BU0GwVUfvvnyoMRJ710ycAKWimhATwqZ/OEoM5rdt7gbrRLN1Ue/6vTxjQ3m+fB1hJM1Sy9v7v7zEoz6wAMYB90Ox8MICReX4PA9ubLqgSgAc0MwEHksrU/x6DO5lJeDkBOMxqOwwPAE4XM/9OGIFMzfp6M9sMhATgmRpNJUahKt0+FrOYZiJm7eOvrhRGwr50gxQAbxZtEHoAFOnGF8No+FE30hqAXNHkVhJAnerGkWNMK93wAwB8RxPbcQCBrxsrjCz2ba0l5r5iAvYGJrGd6ccY3f6iG+85AJ6HNJEw5wDyd9247PECirQhFIBkQ5PYJACU0AYpOOrfBuc7AGSCXk5kAHA/v7D8reyiDZIAeF7QSxU5ByBJG5cMDoZsg3XMAWyDkF4mDLYAeLyeoPxbbWCk+eMOi17kceOWp3qC8reyVFu/69csgX38+re20gwTYKWvLRF1uMnsfN8aCW35JcM06kpb/mMJ2F3QaMSdPR7f11ZVYzI89r8tgQQAfihpFOWBA4AU335ozDElWegWv8geX30TNDDxJvFXVvi6pZj+n7zuK932684BgGdxSIMJ4+zxXe+/dFs1j9ibP+3d626CMBQAYKGUVkqRdlSNomCQi573f7+xsBFuytAtlsTvbxOS9hzaENpTEUETL6qomPUYPN17s8qrgkNTpE09J5MpaLmUaVDlAcVPZj71vh91vkCLYjqV8jFTCS3KDxcVFxVr4yHrArmLSugraJGpTt3/sg0ktEVJaNW//GliTJLQejOBFSYRtMng5Ye2B5inGDrUQbh1s4NocDBGHQKKnDq8rjgo6IhPukX/h3XeQ0++QavGKNkeEizw8bIz02E/YAJ5dqNvK7TJoWd/1vreyx0m0MexOFrd0Vq5tu2UbNtd9RqPAnPoI1iPhe+eLc1hCNljhuxfbRHCewJDcqrjqz/A8yO4gfArTulHeHStVsTdY/hBU3zlBG6IfG8xI2GiYASRKuKlSEkCI1QygxuOOizkc/gT3Edaz3t3ONQg8BRiUM0K901l7pih4CHKYDtdV/yJHJFkEiaQWSJmHvk+GxU4i2FEnOECvf4j//9YDhJsg5dZzmMlSUmqmOfZEm+YQM5cZ7u3t7n6BCyj3BOxzBQ1AAAAAElFTkSuQmCC"},89992:e=>{"use strict";e.exports="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHg9IjAiIHk9IjAiIHZpZXdCb3g9IjAgMCAyMzAuMDUgNDkuNzUiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxzdHlsZT4uc3Qwe2ZpbGw6I2Y1ZjRmM30uc3Qye2ZpbGw6I2ZmZn0uc3Qze2ZpbGw6Izk5OX08L3N0eWxlPjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik02MS4yOCAzNi4xNHYtOC44MmwtLjI0LTUuMDkuMTktLjA0IDIuMDUgNC41NCA0LjgyIDguODYgNC44Mi04Ljg2IDIuMDYtNC41NC4xOC4wNC0uMjQgNS4wOXY4LjgyaDUuMTRWMTQuNGgtNS44MWwtNi4xMSAxMS43N2gtLjA3TDYxLjk1IDE0LjRoLTUuODF2MjEuNzR6TTIxMi42OSAzMC42M2MwIDMuNiAxLjk0IDUuNSA1LjYxIDUuNWgzLjE3di00LjQ1aC0zLjQ1di05LjQ5aDMuNzR2LTQuMzZoLTQuMTV2LTQuMjFoLTQuOTF2MTcuMDF6TTIxMS4yNiAxNy44M2gtLjg3Yy0zLjAxIDAtNC40NCAyLjAzLTQuODkgMy40M2gtLjE4di0zLjQzSDIwMHYxOC4zMWg1LjMyVjI1LjcyYzAtMS4wOC40MS0xLjg0LjkzLTIuMzMuODktLjg2IDIuNzktMS4xMSA1LjAxLTEuMTF2LTQuNDV6TTE1OC42MyAxNy44M2gtLjg3Yy0zLjAxIDAtNC40NCAyLjAzLTQuODkgMy40M2gtLjE4di0zLjQzaC01LjMydjE4LjMxaDUuMzJWMjUuNzJjMC0xLjA4LjQxLTEuODQuOTMtMi4zMy44OS0uODYgMi43OS0xLjExIDUuMDEtMS4xMXYtNC40NXpNMTI3LjQ4IDI3LjI1YzAtNS45NyAzLjE3LTkuODYgOC44NS05Ljg2IDYuMjYgMCA4Ljc4IDQuNTMgOC43OCA5LjY0djEuNThoLTEyLjEydi4xOGMwIDIuMTIgMS4xNCAzLjYgNC4xNyAzLjYgMi4yMyAwIDMuNDUtMS4wNCA0LjY0LTIuMjdsMi42NiAzLjMxYy0xLjY5IDEuOTQtNC40NiAzLjEzLTcuOTEgMy4xMy01LjguMDEtOS4wNy0zLjI3LTkuMDctOS4zMXptNS41LTIuMDV2LjI5aDYuNjJ2LS4zMmMwLTIuMy0xLjA0LTMuODUtMy4xNy0zLjg1cy0zLjQ1IDEuNTQtMy40NSAzLjg4ek0xODAuMDQgMjcuMjVjMC02LjA4IDMuMzEtOS44NiA4Ljg1LTkuODYgNS41NCAwIDguODUgMy43OCA4Ljg1IDkuODZzLTMuMzEgOS4zMi04Ljg1IDkuMzJjLTUuNTUgMC04Ljg1LTMuMjQtOC44NS05LjMyem0xMi4xNSAxLjM3di0zLjI3YzAtMi4zNy0xLjIyLTMuNzQtMy4zMS0zLjc0cy0zLjMxIDEuMzctMy4zMSAzLjc0djMuMjdjMCAyLjM3IDEuMjIgMy43NCAzLjMxIDMuNzRzMy4zMS0xLjM3IDMuMzEtMy43NHpNMTIyLjQyIDEzLjYyaC00Ljc4djIuMTljMCAxLjMtLjQzIDIuMDEtMS44NyAyLjAxaC0xLjMzdjQuMzZoMi42NnY4LjQ0YzAgMy42IDEuOTQgNS41IDUuNjEgNS41aDMuMTd2LTQuNDVoLTMuNDV2LTkuNDloMy43NHYtNC4zNmgtMy43NHYtNC4yek0xMDkuMTcgMTMuNjJoLTQuNzh2Mi4xOWMwIDEuMy0uNDMgMi4wMS0xLjg3IDIuMDFoLTEuMzN2NC4zNmgyLjY2djguNDRjMCAzLjYgMS45NCA1LjUgNS42MSA1LjVoMy4xN3YtNC40NWgtMy40NXYtOS40OWgzLjc0di00LjM2aC0zLjc0di00LjJ6TTE3MC45IDE3LjM5Yy0yLjQ1IDAtNC41MyAxLjUxLTUuMDcgMy42aC0uMTh2LTMuMTdoLTUuMzJ2MjMuODJoNS4zMnYtOC42N2guMThjLjU0IDIuMDUgMi42MyAzLjYgNS4wNyAzLjYgNC43OCAwIDcuMjctMi45MSA3LjI3LTkuMzItLjAxLTYuNC0yLjQ5LTkuODYtNy4yNy05Ljg2em0xLjcyIDExLjUyYzAgMi4zNy0xLjQ4IDMuMzUtMy40OSAzLjM1LTIuMDEgMC0zLjQ5LTEuMDQtMy40OS0yLjc3di01YzAtMS43MyAxLjQ4LTIuNzcgMy40OS0yLjc3IDIuMDEgMCAzLjQ5IDEuNTUgMy40OSAzLjkydjMuMjd6TTk3LjgzIDM2LjE0Yy0xLjkxIDAtMy4yNy0xLjMtMy42LTMuMzFoLS4yMmMtLjU4IDIuNDUtMi42NiAzLjc0LTUuNTQgMy43NC0zLjc4IDAtNS44Ni0yLjIzLTUuODYtNS41IDAtMy45OSAzLjA5LTUuOSA4LjA5LTUuOWgyLjk5di0uNjFjMC0xLjgzLS45LTIuOTktMy4xMy0yLjk5LTIuMTIgMC0zLjI0IDEuMDgtNC4wNiAyLjIzbC0zLjE3LTIuODFjMS41MS0yLjIzIDMuNjctMy42IDcuNjMtMy42IDUuMzIgMCA4LjA2IDIuNDUgOC4wNiA2LjkxdjcuMzhoMS43NnY0LjQ1aC0yLjk1em0tNC4xMy01Ljcydi0yLjIzaC0yLjU5Yy0yLjA1IDAtMy4xMy43Ni0zLjEzIDIuMTJ2LjU0YzAgMS4zNy45IDIuMDEgMi40OCAyLjAxIDEuNzYgMCAzLjI0LS43MiAzLjI0LTIuNDR6Ii8+PGc+PHBhdGggZD0iTTM5LjA1IDYuOTFMMjYuMjQgMTAuNSAxMy40MiA2LjkxIDguMyA4LjM1djMzLjA2bDUuMTMgMS40NCAxMi44Mi0zLjU5IDEyLjgyIDMuNTkgNS4xMy0xLjQ0VjguMzVsLTUuMTUtMS40NHptLTUuMTIgMjQuNjdsLTcuNjktMi4xNS03LjY5IDIuMTV2LTEzLjRsNy42OSAyLjE1IDcuNjktMi4xNXYxMy40eiIgZmlsbD0iI2I3YmFiYiIvPjxwYXRoIGNsYXNzPSJzdDIiIGQ9Ik0yNi4yNCAxMy4zN3Y2Ljk2bC0xMi44Mi0zLjU5djI2LjFMOC4zIDQxLjQxVjguMzV6TTMzLjkzIDM0LjQ1bC03LjY5LTIuMTZ2Ni45NmwxMi44MSAzLjU5di0yNi4xbC01LjEyIDEuNDR6Ii8+PGc+PHBhdGggY2xhc3M9InN0MyIgZD0iTTM5LjA1IDYuOTFsNS4xMyAxLjQ0LTE3Ljk0IDUuMDJMOC4zIDguMzVsNS4xMi0xLjQ0IDEyLjgyIDMuNTl6TTI2LjI0IDI5LjQybDcuNjkgMi4xNnYyLjg3bC03LjY5LTIuMTYtNy42OSAyLjE2di0yLjg3eiIvPjwvZz48L2c+PC9zdmc+"},31896:e=>{"use strict";e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODQiIGhlaWdodD0iODQiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48cGF0aCBkPSJNNDIgMEMxOC43OSAwIDAgMTguNzkgMCA0MnMxOC43OSA0MiA0MiA0MiA0Mi0xOC43OSA0Mi00MlM2NS4yMSAwIDQyIDB6IiBmaWxsLW9wYWNpdHk9Ii4yNSIgZmlsbD0iIzAwMCIgZmlsbC1ydWxlPSJub256ZXJvIi8+PHBhdGggZD0iTTUxLjUgNTdoLTJhLjUuNSAwIDAxLS41LS41di0yOGEuNS41IDAgMDEuNS0uNWgyYS41LjUgMCAwMS41LjV2MjhhLjUuNSAwIDAxLS41LjV6TTM0LjUgNTdoLTJhLjUuNSAwIDAxLS41LS41di0yOGEuNS41IDAgMDEuNS0uNWgyYS41LjUgMCAwMS41LjV2MjhhLjUuNSAwIDAxLS41LjV6IiBmaWxsPSIjRkZGIi8+PC9nPjwvc3ZnPg=="},78899:(e,t,i)=>{"use strict";e.exports=i.p+"images/escape.png"},7560:(e,t,i)=>{"use strict";e.exports=i.p+"images/headset-cardboard.png"},63931:(e,t,i)=>{"use strict";e.exports=i.p+"images/headset-quest.png"},31891:(e,t,i)=>{"use strict";e.exports=i.p+"images/Desktop-help-play-button.svg"},71002:(e,t,i)=>{"use strict";e.exports=i.p+"images/Desktop-help-spacebar.png"},14653:(e,t,i)=>{"use strict";e.exports=i.p+"images/mattertag-disc-128-free.v1.png"},94874:(e,t,i)=>{"use strict";e.exports=i.p+"images/mobile-help-play-button.svg"},86533:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_360.png"},70626:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_click_inside.png"},72145:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_gesture_drag.png"},12742:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_gesture_drag_two_finger.png"},5435:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_gesture_pinch.png"},67649:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_gesture_position.png"},2433:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_gesture_position_two_finger.png"},24367:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_gesture_tap.png"},64549:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_inside_key.png"},76064:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_keyboard_all.png"},81202:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_keyboard_left_right.png"},42135:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_keyboard_up_down.png"},41891:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_mouse_click.png"},73993:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_mouse_drag_left.png"},26668:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_mouse_drag_right.png"},82906:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_mouse_position_left.png"},64991:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_mouse_position_right.png"},12136:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_mouse_zoom.png"},90619:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_tap_inside.png"},26407:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_zoom_keys.png"},2116:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o,A:()=>r});var n=i(26605),s=i(46162);function o(e){if(!e.prototype||!e.prototype.render)return e.__scuWrap||(e.__scuWrap=a(e,h));e.prototype.shouldComponentUpdate=l}function r(e){if(!e.prototype||!e.prototype.render)return e.__scuWrap||(e.__scuWrap=a(e,s.NK));e.prototype.shouldComponentUpdate=c}function a(e,t){class Wrap extends Wrapper{}return Wrap.prototype.renderChild=e,Wrap.prototype.diffFunc=t,Wrap}class Wrapper extends n.Component{shouldComponentUpdate(e){return this.diffFunc(e,this.props)}render(e,t,i){return this.renderChild(e,i)}}function l(e,t){return h(e,this.props)||h(t,this.state)}function c(e,t){return h(e,this.props)||(0,s.NK)(t,this.state)}function h(e,t){for(let i in e)if(e[i]!==t[i])return!0;for(let i in t)if(!(i in e))return!0;return!1}},91975:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAJ1BMVEUAAAD///////////////////////////////////////////////+uPUo5AAAADHRSTlMA4ZNBI+fLwLSGYE5aqgIgAAAAlUlEQVQoz2MAAy91mYNFSxjgwEjmDBAcVIbxPWPOgMHRKRA+c88ZKDhhABbYdgYOssEKchACx0BKPM4ggRagwBxkgZNAHTHIAkcNGJjOoAAFBkdUARGGNagCpxh0UAUOMdSgChxnkEEVOMhwBg1gCGBowTAUw1oMh2E4HcNzGN5HDyCMIMQIZPRowIgozKjEjGyM5AAACSg5ooJJElsAAAAASUVORK5CYII="},40886:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAPFBMVEUAAAD/AVL/AVL/AVL/AVL/AVL/AVL/AVL/AVL/AVL/AVL/AVL/////+fr/5er/0tv/ytX/iaH/dJL/cpA84uD/AAAAC3RSTlMA45NBI8vAtIZgTrS8MGcAAAC5SURBVDjLhVPtDoQgDBuICPKpvP+7Xs4t6LlL2j9GWtYCG91w0XqTkvE2OtJYrEkTxi4v2gWhpyS4n+1bUtgeRfY1/cG6z/3Ma8Ui/rP+6LWU2sd04RxBfs+WBe2UpXAZSP4jP3DIWb4m9ua1whI5w/XzC+xiHEWWtreg8XoUh5EVhnj469u1oF+EJ45QtaByCGKrogWFGSiAFjAkPCa8KHjV6LHgc6OGgS2Hmha2PR4cPHp4eOH4fwAGdiPh+RS0GAAAAABJRU5ErkJggg=="},71370:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAIBAMAAABqq+CcAAAAD1BMVEUAAAD///////////////+PQt5oAAAABHRSTlMAy4AzqjrmZgAAABRJREFUCNdjAAMjERcXR2Uwc4AEAIn2CZHn9cAcAAAAAElFTkSuQmCC"},88296:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAIBAMAAABqq+CcAAAAGFBMVEUAAAD/AVL/AVL/AVL/////AVL/r7//OWiicYg+AAAABHRSTlMAy4AzqjrmZgAAABlJREFUCNdjYGBgVgwtcwGC9FAhAyB3YAQAVg4X6a0jaXAAAAAASUVORK5CYII="},64366:(e,t,i)=>{"use strict";e.exports=i.p+"images/tagbg.png"},78947:(e,t,i)=>{"use strict";e.exports=i.p+"images/tagmask.png"},28636:(e,t,i)=>{"use strict";e.exports=i.p+"images/NoteColor.png"},27314:(e,t,i)=>{"use strict";e.exports=i.p+"images/NoteIcon.png"},30749:(e,t,i)=>{"use strict";e.exports=i.p+"images/pinAnchor.png"},48072:(e,t,i)=>{"use strict";e.exports=i.p+"images/360_placement_pin_mask.png"},68444:(e,t,i)=>{"use strict";e.exports=i.p+"images/exterior.png"},85089:(e,t,i)=>{"use strict";e.exports=i.p+"images/exterior_hover.png"},45545:(e,t,i)=>{"use strict";e.exports=i.p+"images/interior.png"},64293:(e,t,i)=>{"use strict";e.exports=i.p+"images/interior_hover.png"},29480:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAMAAABrrFhUAAAAP1BMVEUAAAD///////////////////////////////////////////////////////////////////////////////9Du/pqAAAAFXRSTlMAmYWNk1l7bCJCEQpjKHQ0GE9HHToMZFdDAAAHfklEQVR42uzcC3LcIAwAUAnxMT//73/WTmcnnWw7za6xMMLJO0HsCEkI1vDjx49rhbz7xaTRKkWkETWRUnZMZvF7DnBjIa9pVPiCGtN6v/cw72YkPIBGs89wD8PqCIuQWwfoW/BO4yna+W7XQzYKWSiToTvZEDKivt7BZgjZkdmgC9FbrMT6CNINSWNFOsmuC5PF6uwEUnmFl1AeBIoL4WVoEZcMFsJL0QKSrISXoxWk2AmboB0kGCw2Y9sXxZCwqRSgqVVjY3qFdjaLAtgNGllQiAVaGBSKoRokQ9989X+mPVwrOhTGRfjSfcP/rWVw6/B/vQxuH/6vlsH9w//LZfAtwv+6ZWBQOANVJRQvQUVi099nDmqJIvY+r9kIVQTB6f+ZClDB3M3zI6oZ2A2EHaEBmGXR5f9fOgOrobPnR9QDMJq7iv8Hmr9j/q9TC2KXz4+oIvCwWIUmZUfnRqtIYxVWZv+rnPE5RHgSQ/bGKUQU1xUn5GPNtMGXtslYWTsjg0yUmSK8JU5Gidkde+Sg3RTgkDA5jRy8gAbI+lh43ax5Q8RQANUyQ7F5UW2LocOTxgwn5bFhKVjxHDcAg8HhOWujBJA2YLIl9jRQPwGkGRjNqUEacKIu7wz26jTgsRh5qMDTpd3AoMVdXArpyjSgsJDKUE0u/6vgoEXo0ZS56B7RhmVogsomwjLbFTMQO0N1s71gOrKKDP8PpnpDGDQW0BNcZCr7+wK8K8k4jOE+pkrwpkHKcRz3QeUA77FiDmT/L6h6eXDH48YIF4sjHrfDO0jSpQzezRrBG9ZOnr/oDaxVAmCERsYaIbCUjBsaiYp/SxBJev4/VwsocgcAzdDQTNwhQNcMHNtdXSHmOVjzn3JPvNMxJXP/x7k3VJyv04IAljFobU8J8MNMbP+1obcE8DCxbQpTdwngwTDNBaI+mE3EUHiEjjw1UNCnjTJPJbRyfplR9yaX5TgLIFHfOAuER2wMqUTYp2w8Q/qm7lqg4vVL5xNJ+493/GU4ncBNtxmwIA+asytARA/8bD65BnLnAXAwBPK5FSDy04bbuTWg5I/BX3Fn+vjQdQkoKAQBnvkezgFeGU80cq7PXdCzfGIZ6y63wScSmYYng/jvNr1lKU5ka99N0Ie5+JzUdbwN+syWJgHqdh9cXMyoMHS0uO+5fhZ12VLeu+8CP7iy+zKmu7MAhjMCU9ZCiRoF/iuUNbR0hy7oQZVkwdDhadD/mJJgzrdJAYeSQC7pA0UXwd9iSS+Y7tEGPtiCwd54nxQAYArKgLpPCgCYCipa59PQ4tloQRWEDiAerYMZb9MGHVvQGR52vMlO6MEd3g55vFEROFIGPDwseIthyPGhyPLnlXU/EP/F3pkjAQzCMBDGDBXh/8/NpMmQUunslZ/gHPiQljMu+YVevUgvrB5q6y0Ey3QCWjewz3OjTBkgFAJTTcBoKWIIZY2WgGgpItQERKlC8McDjULTgCemmoCRXhjwja3+03qpVkBpBpwAfwL+CfoYdCHkUrjNDm+G8O0wfiCCH4nhh6L4sTh+MYJfjeGXo/j1uAUSeIkMXiSFl8nhhZJ4qSxeLG25PN4wgbfM4E1TeNucjZN46yzePI23zxuggEdo4CEqeIyOQUp4lBYepmacHh6oiEdqGqqKx+riwcpGa+Ph6ni8vi9YwF+xcbN3pzkOwjAUgJ9DFrLQQLn/XUfzZzSbWjBOa5bvBBEimx3pXSErp4/ZuYKWTh+1dYWtnT5u7/SBi1fk5hW6evrY3St4+fTR21f4+unj95EsMdiKF6m88SV8WboV6rwbOmK5YwVPLH5EcyN3bCtbzTxdRWO1I5559XsrldPAEdPEqDTzmAHNDPxRcSoNXCWhiVSIgV23icTWRTQQO2KLYAjE53sI6z3xBXa5ga+MEDQW2sBkdsFxizJDyFyIQaBwG2mb0ENAH2ibCLZAG90GbDTcaKMgUXXkM9MItnESGEAW6jvw+ZjBkKMnBuHOTSQJNtSEVVINliRE4cM3n3E1Y5FcnSEhDpsVkuNdnfHQXJ0nOQUCAskywcUhZfyQ0xBdMCQrQISnJmxn/C2EmzedpSa8XAtul+SalmmXX0CyVTF2tDt/Hy68/UC0nIID0G/Dzr6AHfDp7c0YCVraVOOOVsKfjcrz7QWtWtXZ0y74jP9oPBV/UXj+/V8h9Qr+UNGaekbR/fexqPpAYCOa6xVvBqbHC2S1S2HIeI27ymlg73jg+NPgye9/+Gmw4Pc/8m6wbPU/7jQwPd5hIiUmvMms4nbkZ6xxtA2Ru/kpeLj0nboHWYzHO2yqniJ9tHN3OwiDMBSA1x7KxgQU5P2f1QtvTIxubox1Zt8btOEnJOUsUkC7QOm0yKDmkDtNEqgpqIt1vLRsAZLKbFvH1AQri/B5cbW0Obv7h/WvBm9oQ8bruPimhrs2Yp3Krf/uLqDqICpjHD8JgrrVK4ptmisIUxV8xOqfRtebtSOWbv/nzjpD7kGLoM/6z/x5bkUi6AeIUlSkNNU0huwj0wSOPoejr/qJPhSXxEfLDBgiAzDb6CW58t+Vn04aPQDVw5SJCNPsmgAAAABJRU5ErkJggg=="},80517:(e,t,i)=>{"use strict";e.exports=i.p+"images/tagbg.png"},89411:(e,t,i)=>{"use strict";e.exports=i.p+"images/tagmask.png"},94085:(e,t,i)=>{"use strict";e.exports=i.p+"images/roboto-700-42_0.png"},62634:(e,t,i)=>{"use strict";i.d(t,{h4:()=>Pe,ab:()=>ce});var n=function(){return Object.create(null)},s=Array.prototype,o=s.forEach,r=s.slice,a=function(){function e(e,t){void 0===e&&(e=!0),void 0===t&&(t=n),this.weakness=e,this.makeData=t}return e.prototype.lookup=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.lookupArray(e)},e.prototype.lookupArray=function(e){var t=this;return o.call(e,(function(e){return t=t.getChildTrie(e)})),t.data||(t.data=this.makeData(r.call(e)))},e.prototype.getChildTrie=function(t){var i=this.weakness&&function(e){switch(typeof e){case"object":if(null===e)break;case"function":return!0}return!1}(t)?this.weak||(this.weak=new WeakMap):this.strong||(this.strong=new Map),n=i.get(t);return n||i.set(t,n=new e(this.weakness,this.makeData)),n},e}();var l=null,c={},h=1,d="@wry/context:Slot",u=Array,p=u[d]||function(){var e=function(){function e(){this.id=["slot",h++,Date.now(),Math.random().toString(36).slice(2)].join(":")}return e.prototype.hasValue=function(){for(var e=l;e;e=e.parent)if(this.id in e.slots){var t=e.slots[this.id];if(t===c)break;return e!==l&&(l.slots[this.id]=t),!0}return l&&(l.slots[this.id]=c),!1},e.prototype.getValue=function(){if(this.hasValue())return l.slots[this.id]},e.prototype.withValue=function(e,t,i,n){var s,o=((s={__proto__:null})[this.id]=e,s),r=l;l={parent:r,slots:o};try{return t.apply(n,i)}finally{l=r}},e.bind=function(e){var t=l;return function(){var i=l;try{return l=t,e.apply(this,arguments)}finally{l=i}}},e.noContext=function(e,t,i){if(!l)return e.apply(i,t);var n=l;try{return l=null,e.apply(i,t)}finally{l=n}},e}();try{Object.defineProperty(u,d,{value:u[d]=e,enumerable:!1,writable:!1,configurable:!1})}finally{return e}}();p.bind,p.noContext;function m(){}var g=function(){function e(e,t){void 0===e&&(e=1/0),void 0===t&&(t=m),this.max=e,this.dispose=t,this.map=new Map,this.newest=null,this.oldest=null}return e.prototype.has=function(e){return this.map.has(e)},e.prototype.get=function(e){var t=this.getEntry(e);return t&&t.value},e.prototype.getEntry=function(e){var t=this.map.get(e);if(t&&t!==this.newest){var i=t.older,n=t.newer;n&&(n.older=i),i&&(i.newer=n),t.older=this.newest,t.older.newer=t,t.newer=null,this.newest=t,t===this.oldest&&(this.oldest=n)}return t},e.prototype.set=function(e,t){var i=this.getEntry(e);return i?i.value=t:(i={key:e,value:t,newer:null,older:this.newest},this.newest&&(this.newest.newer=i),this.newest=i,this.oldest=this.oldest||i,this.map.set(e,i),i.value)},e.prototype.clean=function(){for(;this.oldest&&this.map.size>this.max;)this.delete(this.oldest.key)},e.prototype.delete=function(e){var t=this.map.get(e);return!!t&&(t===this.newest&&(this.newest=t.older),t===this.oldest&&(this.oldest=t.newer),t.newer&&(t.newer.older=t.older),t.older&&(t.older.newer=t.newer),this.map.delete(e),this.dispose(t.value,e),!0)},e}(),f=new p;function v(e){var t=e.unsubscribe;"function"==typeof t&&(e.unsubscribe=void 0,t())}var y=[];function b(e,t){if(!e)throw new Error(t||"assertion failure")}function w(e){switch(e.length){case 0:throw new Error("unknown value");case 1:return e[0];case 2:throw e[1]}}var S=function(){function e(t){this.fn=t,this.parents=new Set,this.childValues=new Map,this.dirtyChildren=null,this.dirty=!0,this.recomputing=!1,this.value=[],this.deps=null,++e.count}return e.prototype.peek=function(){if(1===this.value.length&&!T(this))return this.value[0]},e.prototype.recompute=function(e){return b(!this.recomputing,"already recomputing"),function(e){var t=f.getValue();if(t)e.parents.add(t),t.childValues.has(e)||t.childValues.set(e,[]),T(e)?x(t,e):A(t,e)}(this),T(this)?function(e,t){P(e),f.withValue(e,E,[e,t]),function(e,t){if("function"==typeof e.subscribe)try{v(e),e.unsubscribe=e.subscribe.apply(null,t)}catch(t){return e.setDirty(),!1}return!0}(e,t)&&function(e){if(e.dirty=!1,T(e))return;_(e)}(e);return w(e.value)}(this,e):w(this.value)},e.prototype.setDirty=function(){this.dirty||(this.dirty=!0,this.value.length=0,M(this),P(this),v(this))},e.prototype.dispose=function(){var e=this;P(this),v(this),this.parents.forEach((function(t){t.setDirty(),C(t,e)}))},e.prototype.dependOn=function(e){e.add(this),this.deps||(this.deps=y.pop()||new Set),this.deps.add(e)},e.prototype.forgetDeps=function(){var e=this;this.deps&&(this.deps.forEach((function(t){return t.delete(e)})),this.deps.clear(),y.push(this.deps),this.deps=null)},e.count=0,e}();function E(e,t){e.recomputing=!0,e.value.length=0;try{e.value[0]=e.fn.apply(null,t)}catch(t){e.value[1]=t}e.recomputing=!1}function T(e){return e.dirty||!(!e.dirtyChildren||!e.dirtyChildren.size)}function M(e){e.parents.forEach((function(t){return x(t,e)}))}function _(e){e.parents.forEach((function(t){return A(t,e)}))}function x(e,t){if(b(e.childValues.has(t)),b(T(t)),e.dirtyChildren){if(e.dirtyChildren.has(t))return}else e.dirtyChildren=y.pop()||new Set;e.dirtyChildren.add(t),M(e)}function A(e,t){b(e.childValues.has(t)),b(!T(t));var i,n,s,o=e.childValues.get(t);0===o.length?e.childValues.set(t,t.value.slice(0)):(i=o,n=t.value,(s=i.length)>0&&s===n.length&&i[s-1]===n[s-1]||e.setDirty()),O(e,t),T(e)||_(e)}function O(e,t){var i=e.dirtyChildren;i&&(i.delete(t),0===i.size&&(y.length<100&&y.push(i),e.dirtyChildren=null))}function P(e){e.childValues.size>0&&e.childValues.forEach((function(t,i){C(e,i)})),e.forgetDeps(),b(null===e.dirtyChildren)}function C(e,t){t.parents.delete(e),e.childValues.delete(t),O(e,t)}function D(e){var t=new Map,i=e&&e.subscribe;function n(e){var n=f.getValue();if(n){var s=t.get(e);s||t.set(e,s=new Set),n.dependOn(s),"function"==typeof i&&(v(s),s.unsubscribe=i(e))}}return n.dirty=function(e){var i=t.get(e);i&&(i.forEach((function(e){return e.setDirty()})),t.delete(e),v(i))},n}var I=new a("function"==typeof WeakMap);function R(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return I.lookupArray(e)}var L=new Set;function N(e,t){void 0===t&&(t=Object.create(null));var i=new g(t.max||Math.pow(2,16),(function(e){return e.dispose()})),n=t.keyArgs||function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e},s=t.makeCacheKey||R;function o(){var o=s.apply(null,n.apply(null,arguments));if(void 0===o)return e.apply(null,arguments);var r=i.get(o);r||(i.set(o,r=new S(e)),r.subscribe=t.subscribe);var a=r.recompute(Array.prototype.slice.call(arguments));return i.set(o,r),L.add(i),f.hasValue()||(L.forEach((function(e){return e.clean()})),L.clear()),a}function r(){var e=s.apply(null,arguments);if(void 0!==e)return i.get(e)}return o.dirty=function(){var e=r.apply(null,arguments);e&&e.setDirty()},o.peek=function(){var e=r.apply(null,arguments);if(e)return e.peek()},o.forget=function(){var e=s.apply(null,arguments);return void 0!==e&&i.delete(e)},o}var k,B=i(80496),F=function(){function e(){this.getFragmentDoc=N(B.Yk)}return e.prototype.recordOptimisticTransaction=function(e,t){this.performTransaction(e,t)},e.prototype.transformDocument=function(e){return e},e.prototype.identify=function(e){},e.prototype.gc=function(){return[]},e.prototype.modify=function(e){return!1},e.prototype.transformForLink=function(e){return e},e.prototype.readQuery=function(e,t){return void 0===t&&(t=!!e.optimistic),this.read({rootId:e.id||"ROOT_QUERY",query:e.query,variables:e.variables,returnPartialData:e.returnPartialData,optimistic:t})},e.prototype.readFragment=function(e,t){return void 0===t&&(t=!!e.optimistic),this.read({query:this.getFragmentDoc(e.fragment,e.fragmentName),variables:e.variables,rootId:e.id,returnPartialData:e.returnPartialData,optimistic:t})},e.prototype.writeQuery=function(e){return this.write({dataId:e.id||"ROOT_QUERY",result:e.data,query:e.query,variables:e.variables,broadcast:e.broadcast})},e.prototype.writeFragment=function(e){return this.write({dataId:e.id,result:e.data,variables:e.variables,query:this.getFragmentDoc(e.fragment,e.fragmentName),broadcast:e.broadcast})},e}();k||(k={});var U=function(e,t,i,n,s){this.message=e,this.path=t,this.query=i,this.clientOnly=n,this.variables=s},V=i(70655),H=i(92924),G=i(82152),z=Object.prototype.hasOwnProperty;var j=/^[_a-z][_0-9a-z]*/i;function W(e){var t=e.match(j);return t?t[0]:e}function Z(e,t,i){return!(!t||"object"!=typeof t)&&(Array.isArray(t)?t.every((function(t){return Z(e,t,i)})):e.selections.every((function(e){if((0,B.My)(e)&&(0,B.LZ)(e,i)){var n=(0,B.u2)(e);return z.call(t,n)&&(!e.selectionSet||Z(e.selectionSet,t[n],i))}return!0})))}function q(e){return null!==e&&"object"==typeof e&&!(0,B.hh)(e)&&!Array.isArray(e)}var K=Object.create(null),Y=function(){return K},$=Object.create(null),X=function(){function e(e,t){var i=this;this.policies=e,this.group=t,this.data=Object.create(null),this.rootIds=Object.create(null),this.refs=Object.create(null),this.getFieldValue=function(e,t){return(0,B.Jv)((0,B.hh)(e)?i.get(e.__ref,t):e&&e[t])},this.canRead=function(e){return(0,B.hh)(e)?i.has(e.__ref):"object"==typeof e},this.toReference=function(e,t){if("string"==typeof e)return(0,B.kQ)(e);if((0,B.hh)(e))return e;var n=i.policies.identify(e)[0];if(n){var s=(0,B.kQ)(n);return t&&i.merge(n,e),s}}}return e.prototype.toObject=function(){return(0,V.pi)({},this.data)},e.prototype.has=function(e){return void 0!==this.lookup(e,!0)},e.prototype.get=function(e,t){if(this.group.depend(e,t),z.call(this.data,e)){var i=this.data[e];if(i&&z.call(i,t))return i[t]}return"__typename"===t&&z.call(this.policies.rootTypenamesById,e)?this.policies.rootTypenamesById[e]:this instanceof ee?this.parent.get(e,t):void 0},e.prototype.lookup=function(e,t){return t&&this.group.depend(e,"__exists"),z.call(this.data,e)?this.data[e]:this instanceof ee?this.parent.lookup(e,t):this.policies.rootTypenamesById[e]?Object.create(null):void 0},e.prototype.merge=function(e,t){var i=this,n=this.lookup(e),s=new B.w0(te).merge(n,t);if(this.data[e]=s,s!==n&&(delete this.refs[e],this.group.caching)){var o=Object.create(null);n||(o.__exists=1),Object.keys(t).forEach((function(e){if(!n||n[e]!==s[e]){o[e]=1;var t=W(e);t===e||i.policies.hasKeyArgs(s.__typename,t)||(o[t]=1),void 0!==s[e]||i instanceof ee||delete s[e]}})),Object.keys(o).forEach((function(t){return i.group.dirty(e,t)}))}},e.prototype.modify=function(e,t){var i=this,n=this.lookup(e);if(n){var s=Object.create(null),o=!1,r=!0,a={DELETE:K,INVALIDATE:$,isReference:B.hh,toReference:this.toReference,canRead:this.canRead,readField:function(t,n){return i.policies.readField("string"==typeof t?{fieldName:t,from:n||(0,B.kQ)(e)}:t,{store:i})}};if(Object.keys(n).forEach((function(l){var c=W(l),h=n[l];if(void 0!==h){var d="function"==typeof t?t:t[l]||t[c];if(d){var u=d===Y?K:d((0,B.Jv)(h),(0,V.pi)((0,V.pi)({},a),{fieldName:c,storeFieldName:l,storage:i.getStorage(e,l)}));u===$?i.group.dirty(e,l):(u===K&&(u=void 0),u!==h&&(s[l]=u,o=!0,h=u))}void 0!==h&&(r=!1)}})),o)return this.merge(e,s),r&&(this instanceof ee?this.data[e]=void 0:delete this.data[e],this.group.dirty(e,"__exists")),!0}return!1},e.prototype.delete=function(e,t,i){var n,s=this.lookup(e);if(s){var o=this.getFieldValue(s,"__typename"),r=t&&i?this.policies.getStoreFieldName({typename:o,fieldName:t,args:i}):t;return this.modify(e,r?((n={})[r]=Y,n):Y)}return!1},e.prototype.evict=function(e){var t=!1;return e.id&&(z.call(this.data,e.id)&&(t=this.delete(e.id,e.fieldName,e.args)),this instanceof ee&&(t=this.parent.evict(e)||t),(e.fieldName||t)&&this.group.dirty(e.id,e.fieldName||"__exists")),t},e.prototype.clear=function(){this.replace(null)},e.prototype.extract=function(){var e=this,t=this.toObject(),i=[];return this.getRootIdSet().forEach((function(t){z.call(e.policies.rootTypenamesById,t)||i.push(t)})),i.length&&(t.__META={extraRootIds:i.sort()}),t},e.prototype.replace=function(e){var t=this;if(Object.keys(this.data).forEach((function(i){e&&z.call(e,i)||t.delete(i)})),e){var i=e.__META,n=(0,V._T)(e,["__META"]);Object.keys(n).forEach((function(e){t.merge(e,n[e])})),i&&i.extraRootIds.forEach(this.retain,this)}},e.prototype.retain=function(e){return this.rootIds[e]=(this.rootIds[e]||0)+1},e.prototype.release=function(e){if(this.rootIds[e]>0){var t=--this.rootIds[e];return t||delete this.rootIds[e],t}return 0},e.prototype.getRootIdSet=function(e){return void 0===e&&(e=new Set),Object.keys(this.rootIds).forEach(e.add,e),this instanceof ee?this.parent.getRootIdSet(e):Object.keys(this.policies.rootTypenamesById).forEach(e.add,e),e},e.prototype.gc=function(){var e=this,t=this.getRootIdSet(),i=this.toObject();t.forEach((function(n){z.call(i,n)&&(Object.keys(e.findChildRefIds(n)).forEach(t.add,t),delete i[n])}));var n=Object.keys(i);if(n.length){for(var s=this;s instanceof ee;)s=s.parent;n.forEach((function(e){return s.delete(e)}))}return n},e.prototype.findChildRefIds=function(e){if(!z.call(this.refs,e)){var t=this.refs[e]=Object.create(null),i=new Set([this.data[e]]),n=function(e){return null!==e&&"object"==typeof e};i.forEach((function(e){(0,B.hh)(e)?t[e.__ref]=!0:n(e)&&Object.values(e).filter(n).forEach(i.add,i)}))}return this.refs[e]},e.prototype.makeCacheKey=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.group.keyMaker.lookupArray(e)},e}(),Q=function(){function e(e){this.caching=e,this.d=null,this.keyMaker=new a(B.mr),this.d=e?D():null}return e.prototype.depend=function(e,t){if(this.d){this.d(J(e,t));var i=W(t);i!==t&&this.d(J(e,i))}},e.prototype.dirty=function(e,t){this.d&&this.d.dirty(J(e,t))},e}();function J(e,t){return t+"#"+e}!function(e){var t=function(e){function t(t){var i=t.policies,n=t.resultCaching,s=void 0===n||n,o=t.seed,r=e.call(this,i,new Q(s))||this;return r.storageTrie=new a(B.mr),r.sharedLayerGroup=new Q(s),o&&r.replace(o),r}return(0,V.ZT)(t,e),t.prototype.addLayer=function(e,t){return new ee(e,this,t,this.sharedLayerGroup)},t.prototype.removeLayer=function(){return this},t.prototype.getStorage=function(){return this.storageTrie.lookupArray(arguments)},t}(e);e.Root=t}(X||(X={}));var ee=function(e){function t(t,i,n,s){var o=e.call(this,i.policies,s)||this;return o.id=t,o.parent=i,o.replay=n,o.group=s,n(o),o}return(0,V.ZT)(t,e),t.prototype.addLayer=function(e,i){return new t(e,this,i,this.group)},t.prototype.removeLayer=function(e){var t=this,i=this.parent.removeLayer(e);return e===this.id?(this.group.caching&&Object.keys(this.data).forEach((function(e){t.data[e]!==i.lookup(e)&&t.delete(e)})),i):i===this.parent?this:i.addLayer(this.id,this.replay)},t.prototype.toObject=function(){return(0,V.pi)((0,V.pi)({},this.parent.toObject()),this.data)},t.prototype.findChildRefIds=function(t){var i=this.parent.findChildRefIds(t);return z.call(this.data,t)?(0,V.pi)((0,V.pi)({},i),e.prototype.findChildRefIds.call(this,t)):i},t.prototype.getStorage=function(){for(var e=this.parent;e.parent;)e=e.parent;return e.getStorage.apply(e,arguments)},t}(X);function te(e,t,i){var n=e[i],s=t[i];return(0,G.D)(n,s)?n:s}function ie(e){return!!(e instanceof X&&e.group.caching)}function ne(e,t){return new U(e.message,t.path.slice(),t.query,t.clientOnly,t.variables)}var se=function(){function e(e){var t=this;this.config=e,this.executeSelectionSet=N((function(e){return t.execSelectionSetImpl(e)}),{keyArgs:function(e){return[e.selectionSet,e.objectOrReference,e.context]},makeCacheKey:function(e,t,i){if(ie(i.store))return i.store.makeCacheKey(e,(0,B.hh)(t)?t.__ref:t,i.varString)}}),this.knownResults=new WeakMap,this.executeSubSelectedArray=N((function(e){return t.execSubSelectedArrayImpl(e)}),{makeCacheKey:function(e){var t=e.field,i=e.array,n=e.context;if(ie(n.store))return n.store.makeCacheKey(t,i,n.varString)}}),this.config=(0,V.pi)({addTypename:!0},e)}return e.prototype.diffQueryAgainstStore=function(e){var t=e.store,i=e.query,n=e.rootId,s=void 0===n?"ROOT_QUERY":n,o=e.variables,r=e.returnPartialData,a=void 0===r||r,l=this.config.cache.policies;o=(0,V.pi)((0,V.pi)({},(0,B.O4)((0,B.iW)(i))),o);var c=this.executeSelectionSet({selectionSet:(0,B.p$)(i).selectionSet,objectOrReference:(0,B.kQ)(s),context:{store:t,query:i,policies:l,variables:o,varString:JSON.stringify(o),fragmentMap:(0,B.F)((0,B.kU)(i)),path:[],clientOnly:!1}}),h=c.missing&&c.missing.length>0;if(h&&!a)throw c.missing[0];return{result:c.result,missing:c.missing,complete:!h}},e.prototype.isFresh=function(e,t,i,n){if(ie(n.store)&&this.knownResults.get(e)===i){var s=this.executeSelectionSet.peek(i,t,n);if(s&&e===s.result)return!0}return!1},e.prototype.execSelectionSetImpl=function(e){var t=this,i=e.selectionSet,n=e.objectOrReference,s=e.context;if((0,B.hh)(n)&&!s.policies.rootTypenamesById[n.__ref]&&!s.store.has(n.__ref))return{result:{},missing:[ne(new H.ej(4),s)]};var o=s.variables,r=s.policies,a=s.store,l=[],c={result:null},h=a.getFieldValue(n,"__typename");function d(){return c.missing||(c.missing=[])}function u(e){var t;return e.missing&&(t=d()).push.apply(t,e.missing),e.result}this.config.addTypename&&"string"==typeof h&&!r.rootIdsByTypename[h]&&l.push({__typename:h});var p=new Set(i.selections);return p.forEach((function(e){var i;if((0,B.LZ)(e,o))if((0,B.My)(e)){var a=r.readField({fieldName:e.name.value,field:e,variables:s.variables,from:n},s),c=(0,B.u2)(e);s.path.push(c);var m=s.clientOnly;s.clientOnly=m||!(!e.directives||!e.directives.some((function(e){return"client"===e.name.value}))),void 0===a?B.Gw.added(e)||d().push(ne(new H.ej(5),s)):Array.isArray(a)?a=u(t.executeSubSelectedArray({field:e,array:a,context:s})):e.selectionSet&&null!=a&&(a=u(t.executeSelectionSet({selectionSet:e.selectionSet,objectOrReference:a,context:s}))),void 0!==a&&l.push(((i={})[c]=a,i)),s.clientOnly=m,(0,H.kG)(s.path.pop()===c)}else{var g=(0,B.hi)(e,s.fragmentMap);g&&r.fragmentMatches(g,h)&&g.selectionSet.selections.forEach(p.add,p)}})),c.result=(0,B.bw)(l),this.knownResults.set(c.result,i),c},e.prototype.execSubSelectedArrayImpl=function(e){var t,i=this,n=e.field,s=e.array,o=e.context;function r(e,i){return e.missing&&(t=t||[]).push.apply(t,e.missing),(0,H.kG)(o.path.pop()===i),e.result}return n.selectionSet&&(s=s.filter(o.store.canRead)),{result:s=s.map((function(e,t){return null===e?null:(o.path.push(t),Array.isArray(e)?r(i.executeSubSelectedArray({field:n,array:e,context:o}),t):n.selectionSet?r(i.executeSelectionSet({selectionSet:n.selectionSet,objectOrReference:e,context:o}),t):((0,H.kG)(o.path.pop()===t),e))})),missing:t}},e}();var oe=function(){function e(e,t){this.cache=e,this.reader=t}return e.prototype.writeToStore=function(e){var t=e.query,i=e.result,n=e.dataId,s=e.store,o=e.variables,r=(0,B.$H)(t),a=new B.w0;o=(0,V.pi)((0,V.pi)({},(0,B.O4)(r)),o);var l=this.processSelectionSet({result:i||Object.create(null),dataId:n,selectionSet:r.selectionSet,mergeTree:{map:new Map},context:{store:s,written:Object.create(null),merge:function(e,t){return a.merge(e,t)},variables:o,varString:JSON.stringify(o),fragmentMap:(0,B.F)((0,B.kU)(t))}});if(!(0,B.hh)(l))throw new H.ej(7);return s.retain(l.__ref),l},e.prototype.processSelectionSet=function(e){var t=this,i=e.dataId,n=e.result,s=e.selectionSet,o=e.context,r=e.mergeTree,a=this.cache.policies,l=a.identify(n,s,o.fragmentMap),c=l[0],h=l[1];if("string"==typeof(i=i||c)){var d=o.written[i]||(o.written[i]=[]),u=(0,B.kQ)(i);if(d.indexOf(s)>=0)return u;if(d.push(s),this.reader&&this.reader.isFresh(n,u,s,o))return u}var p=Object.create(null);h&&(p=o.merge(p,h));var m=i&&a.rootTypenamesById[i]||(0,B.qw)(n,s,o.fragmentMap)||i&&o.store.get(i,"__typename");"string"==typeof m&&(p.__typename=m);var g=new Set(s.selections);if(g.forEach((function(e){var i;if((0,B.LZ)(e,o.variables))if((0,B.My)(e)){var s=(0,B.u2)(e),l=n[s];if(void 0!==l){var c=a.getStoreFieldName({typename:m,fieldName:e.name.value,field:e,variables:o.variables}),h=ae(r,c),d=t.processFieldValue(l,e,o,h),u=e.selectionSet&&o.store.getFieldValue(d,"__typename")||void 0,f=a.getMergeFunction(m,e.name.value,u);f?h.info={field:e,typename:m,merge:f}:le(r,c),p=o.merge(p,((i={})[c]=d,i))}else if(a.usingPossibleTypes&&!(0,B.FS)(["defer","client"],e))throw new H.ej(8)}else{var v=(0,B.hi)(e,o.fragmentMap);v&&a.fragmentMatches(v,m,n,o.variables)&&v.selectionSet.selections.forEach(g.add,g)}})),"string"==typeof i){var f=(0,B.kQ)(i);return r.map.size&&(p=this.applyMerges(r,f,p,o)),o.store.merge(i,p),f}return p},e.prototype.processFieldValue=function(e,t,i,n){var s=this;return t.selectionSet&&null!==e?Array.isArray(e)?e.map((function(e,o){var r=s.processFieldValue(e,t,i,ae(n,o));return le(n,o),r})):this.processSelectionSet({result:e,selectionSet:t.selectionSet,context:i,mergeTree:n}):e},e.prototype.applyMerges=function(e,t,i,n,s){var o,r=this;if(e.map.size&&!(0,B.hh)(i)){var a,l=Array.isArray(i)||!(0,B.hh)(t)&&!q(t)?void 0:t,c=i;l&&!s&&(s=[(0,B.hh)(l)?l.__ref:l]);var h=function(e,t){return Array.isArray(e)?"number"==typeof t?e[t]:void 0:n.store.getFieldValue(e,String(t))};e.map.forEach((function(e,t){s&&s.push(t);var i=h(l,t),o=h(c,t),d=r.applyMerges(e,i,o,n,s);d!==o&&(a=a||new Map).set(t,d),s&&(0,H.kG)(s.pop()===t)})),a&&(i=Array.isArray(c)?c.slice(0):(0,V.pi)({},c),a.forEach((function(e,t){i[t]=e})))}return e.info?this.cache.policies.runMergeFunction(t,i,e.info,n,s&&(o=n.store).getStorage.apply(o,s)):i},e}(),re=[];function ae(e,t){var i=e.map;return i.has(t)||i.set(t,re.pop()||{map:new Map}),i.get(t)}function le(e,t){var i=e.map,n=i.get(t);!n||n.info||n.map.size||(re.push(n),i.delete(t))}new Set;var ce=new p;function he(e,t){if(e.size){var i=[];e.forEach((function(e){return i.push(e)})),e.clear(),i.forEach(t)}}var de=new WeakMap;function ue(e){var t=de.get(e);return t||de.set(e,t={vars:new Set,dep:D()}),t}function pe(e){var t=new Set,i=new Set,n=function(o){if(arguments.length>0)e!==o&&(e=o,t.forEach((function(e){ue(e).dep.dirty(n),me(e)})),he(i,(function(t){return t(e)})));else{var r=ce.getValue();r&&(s(r),ue(r).dep(n))}return e};n.onNextChange=function(e){return i.add(e),function(){i.delete(e)}};var s=n.attachCache=function(e){return t.add(e),ue(e).vars.add(n),n};return n.forgetCache=function(e){return t.delete(e)},n}function me(e){e.broadcastWatches&&e.broadcastWatches()}function ge(e){return void 0!==e.args?e.args:e.field?(0,B.NC)(e.field,e.variables):null}var fe=function(e,t){var i=e.__typename,n=e.id,s=e._id;if("string"==typeof i&&(t&&(t.keyObject=void 0!==n?{id:n}:void 0!==s?{_id:s}:void 0),void 0===n&&(n=s),void 0!==n))return i+":"+("number"==typeof n||"string"==typeof n?n:JSON.stringify(n))},ve=function(){},ye=function(e,t){return t.fieldName},be=function(e,t,i){return(0,i.mergeObjects)(e,t)},we=function(e,t){return t},Se=function(){function e(e){this.config=e,this.typePolicies=Object.create(null),this.toBeAdded=Object.create(null),this.supertypeMap=new Map,this.fuzzySubtypes=new Map,this.rootIdsByTypename=Object.create(null),this.rootTypenamesById=Object.create(null),this.usingPossibleTypes=!1,this.config=(0,V.pi)({dataIdFromObject:fe},e),this.cache=this.config.cache,this.setRootTypename("Query"),this.setRootTypename("Mutation"),this.setRootTypename("Subscription"),e.possibleTypes&&this.addPossibleTypes(e.possibleTypes),e.typePolicies&&this.addTypePolicies(e.typePolicies)}return e.prototype.identify=function(e,t,i){var n=t&&i?(0,B.qw)(e,t,i):e.__typename;if(n===this.rootTypenamesById.ROOT_QUERY)return["ROOT_QUERY"];for(var s,o={typename:n,selectionSet:t,fragmentMap:i},r=n&&this.getTypePolicy(n),a=r&&r.keyFn||this.config.dataIdFromObject;a;){var l=a(e,o);if(!Array.isArray(l)){s=l;break}a=_e(l)}return s=s&&String(s),o.keyObject?[s,o.keyObject]:[s]},e.prototype.addTypePolicies=function(e){var t=this;Object.keys(e).forEach((function(i){var n=e[i],s=n.queryType,o=n.mutationType,r=n.subscriptionType,a=(0,V._T)(n,["queryType","mutationType","subscriptionType"]);s&&t.setRootTypename("Query",i),o&&t.setRootTypename("Mutation",i),r&&t.setRootTypename("Subscription",i),z.call(t.toBeAdded,i)?t.toBeAdded[i].push(a):t.toBeAdded[i]=[a]}))},e.prototype.updateTypePolicy=function(e,t){var i=this,n=this.getTypePolicy(e),s=t.keyFields,o=t.fields;function r(e,t){e.merge="function"==typeof t?t:!0===t?be:!1===t?we:e.merge}r(n,t.merge),n.keyFn=!1===s?ve:Array.isArray(s)?_e(s):"function"==typeof s?s:n.keyFn,o&&Object.keys(o).forEach((function(t){var n=i.getFieldPolicy(e,t,!0),s=o[t];if("function"==typeof s)n.read=s;else{var a=s.keyArgs,l=s.read,c=s.merge;n.keyFn=!1===a?ye:Array.isArray(a)?Me(a):"function"==typeof a?a:n.keyFn,"function"==typeof l&&(n.read=l),r(n,c)}n.read&&n.merge&&(n.keyFn=n.keyFn||ye)}))},e.prototype.setRootTypename=function(e,t){void 0===t&&(t=e);var i="ROOT_"+e.toUpperCase(),n=this.rootTypenamesById[i];t!==n&&((0,H.kG)(!n||n===e,1),n&&delete this.rootIdsByTypename[n],this.rootIdsByTypename[t]=i,this.rootTypenamesById[i]=t)},e.prototype.addPossibleTypes=function(e){var t=this;this.usingPossibleTypes=!0,Object.keys(e).forEach((function(i){t.getSupertypeSet(i,!0),e[i].forEach((function(e){t.getSupertypeSet(e,!0).add(i);var n=e.match(j);n&&n[0]===e||t.fuzzySubtypes.set(e,new RegExp(e))}))}))},e.prototype.getTypePolicy=function(e){var t=this;if(!z.call(this.typePolicies,e)){var i=this.typePolicies[e]=Object.create(null);i.fields=Object.create(null);var n=this.supertypeMap.get(e);n&&n.size&&n.forEach((function(e){var n=t.getTypePolicy(e),s=n.fields,o=(0,V._T)(n,["fields"]);Object.assign(i,o),Object.assign(i.fields,s)}))}var s=this.toBeAdded[e];return s&&s.length&&this.updateTypePolicy(e,B.oA.apply(void 0,s.splice(0))),this.typePolicies[e]},e.prototype.getFieldPolicy=function(e,t,i){if(e){var n=this.getTypePolicy(e).fields;return n[t]||i&&(n[t]=Object.create(null))}},e.prototype.getSupertypeSet=function(e,t){var i=this.supertypeMap.get(e);return!i&&t&&this.supertypeMap.set(e,i=new Set),i},e.prototype.fragmentMatches=function(e,t,i,n){var s=this;if(!e.typeCondition)return!0;if(!t)return!1;var o=e.typeCondition.name.value;if(t===o)return!0;if(this.usingPossibleTypes&&this.supertypeMap.has(o))for(var r=this.getSupertypeSet(t,!0),a=[r],l=function(e){var t=s.getSupertypeSet(e,!1);t&&t.size&&a.indexOf(t)<0&&a.push(t)},c=!(!i||!this.fuzzySubtypes.size),h=0;h<a.length;++h){var d=a[h];if(d.has(o))return r.has(o)||r.add(o),!0;d.forEach(l),c&&h===a.length-1&&Z(e.selectionSet,i,n)&&(c=!1,!0,this.fuzzySubtypes.forEach((function(e,i){var n=t.match(e);n&&n[0]===t&&l(i)})))}return!1},e.prototype.hasKeyArgs=function(e,t){var i=this.getFieldPolicy(e,t,!1);return!(!i||!i.keyFn)},e.prototype.getStoreFieldName=function(e){var t,i=e.typename,n=e.fieldName,s=this.getFieldPolicy(i,n,!1),o=s&&s.keyFn;if(o&&i)for(var r={typename:i,fieldName:n,field:e.field||null,variables:e.variables},a=ge(e);o;){var l=o(a,r);if(!Array.isArray(l)){t=l||n;break}o=Me(l)}return void 0===t&&(t=e.field?(0,B.vf)(e.field,e.variables):(0,B.PT)(n,ge(e))),n===W(t)?t:n+":"+t},e.prototype.readField=function(e,t){var i=e.from;if(i&&(e.field||e.fieldName)){if(void 0===e.typename){var n=t.store.getFieldValue(i,"__typename");n&&(e.typename=n)}var s=this.getStoreFieldName(e),o=W(s),r=t.store.getFieldValue(i,s),a=this.getFieldPolicy(e.typename,o,!1),l=a&&a.read;if(l){var c=Ee(this,i,e,t,t.store.getStorage((0,B.hh)(i)?i.__ref:i,s));return ce.withValue(this.cache,l,[r,c])}return r}},e.prototype.getMergeFunction=function(e,t,i){var n=this.getFieldPolicy(e,t,!1),s=n&&n.merge;return!s&&i&&(s=(n=this.getTypePolicy(i))&&n.merge),s},e.prototype.runMergeFunction=function(e,t,i,n,s){var o=i.field,r=i.typename,a=i.merge;return a===be?Te(n.store.getFieldValue)(e,t):a===we?t:a(e,t,Ee(this,void 0,{typename:r,fieldName:o.name.value,field:o,variables:n.variables},n,s||Object.create(null)))},e}();function Ee(e,t,i,n,s){var o=e.getStoreFieldName(i),r=W(o),a=i.variables||n.variables,l=n.store,c=l.getFieldValue,h=l.toReference,d=l.canRead;return{args:ge(i),field:i.field||null,fieldName:r,storeFieldName:o,variables:a,isReference:B.hh,toReference:h,storage:s,cache:e.cache,canRead:d,readField:function(i,s){var o="string"==typeof i?{fieldName:i,from:s}:(0,V.pi)({},i);return void 0===o.from&&(o.from=t),void 0===o.variables&&(o.variables=a),e.readField(o,n)},mergeObjects:Te(c)}}function Te(e){return function(t,i){if(Array.isArray(t)||Array.isArray(i))throw new H.ej(2);if(t&&"object"==typeof t&&i&&"object"==typeof i){var n=e(t,"__typename"),s=e(i,"__typename");return!(n&&s&&n!==s)&&q(t)&&q(i)?(0,V.pi)((0,V.pi)({},t),i):i}return i}}function Me(e){return function(t,i){return t?i.fieldName+":"+JSON.stringify(Ae(t,e,!1)):i.fieldName}}function _e(e){var t=new a(B.mr);return function(i,n){var s;if(n.selectionSet&&n.fragmentMap){var o=t.lookupArray([n.selectionSet,n.fragmentMap]);s=o.aliasMap||(o.aliasMap=xe(n.selectionSet,n.fragmentMap))}var r=n.keyObject=Ae(i,e,!0,s);return n.typename+":"+JSON.stringify(r)}}function xe(e,t){var i=Object.create(null),n=new Set([e]);return n.forEach((function(e){e.selections.forEach((function(e){if((0,B.My)(e)){if(e.alias){var s=e.alias.value,o=e.name.value;if(o!==s)(i.aliases||(i.aliases=Object.create(null)))[o]=s}if(e.selectionSet)(i.subsets||(i.subsets=Object.create(null)))[e.name.value]=xe(e.selectionSet,t)}else{var r=(0,B.hi)(e,t);r&&n.add(r.selectionSet)}}))})),i}function Ae(e,t,i,n){var s,o=Object.create(null);return t.forEach((function(t){if(Array.isArray(t)){if("string"==typeof s){var r=n&&n.subsets,a=r&&r[s];o[s]=Ae(e[s],t,i,a)}}else{var l=n&&n.aliases,c=l&&l[t]||t;z.call(e,c)?o[s=t]=e[c]:((0,H.kG)(!i,3),s=void 0)}})),o}var Oe={dataIdFromObject:fe,addTypename:!0,resultCaching:!0,typePolicies:{}},Pe=function(e){function t(t){void 0===t&&(t={});var i=e.call(this)||this;return i.watches=new Set,i.typenameDocumentCache=new Map,i.makeVar=pe,i.txCount=0,i.maybeBroadcastWatch=N((function(e,t){return i.broadcastWatch.call(i,e,!!t)}),{makeCacheKey:function(e){var t=e.optimistic?i.optimisticData:i.data;if(ie(t)){var n=e.optimistic,s=e.rootId,o=e.variables;return t.makeCacheKey(e.query,e.callback,JSON.stringify({optimistic:n,rootId:s,variables:o}))}}}),i.watchDep=D(),i.config=(0,V.pi)((0,V.pi)({},Oe),t),i.addTypename=!!i.config.addTypename,i.policies=new Se({cache:i,dataIdFromObject:i.config.dataIdFromObject,possibleTypes:i.config.possibleTypes,typePolicies:i.config.typePolicies}),i.data=new X.Root({policies:i.policies,resultCaching:i.config.resultCaching}),i.optimisticData=i.data,i.storeWriter=new oe(i,i.storeReader=new se({cache:i,addTypename:i.addTypename})),i}return(0,V.ZT)(t,e),t.prototype.restore=function(e){return e&&this.data.replace(e),this},t.prototype.extract=function(e){return void 0===e&&(e=!1),(e?this.optimisticData:this.data).extract()},t.prototype.read=function(e){var t=e.returnPartialData,i=void 0!==t&&t;try{return this.storeReader.diffQueryAgainstStore({store:e.optimistic?this.optimisticData:this.data,query:e.query,variables:e.variables,rootId:e.rootId,config:this.config,returnPartialData:i}).result||null}catch(e){if(e instanceof U)return null;throw e}},t.prototype.write=function(e){try{return++this.txCount,this.storeWriter.writeToStore({store:this.data,query:e.query,result:e.result,dataId:e.dataId,variables:e.variables})}finally{--this.txCount||!1===e.broadcast||this.broadcastWatches()}},t.prototype.modify=function(e){if(z.call(e,"id")&&!e.id)return!1;var t=e.optimistic?this.optimisticData:this.data;try{return++this.txCount,t.modify(e.id||"ROOT_QUERY",e.fields)}finally{--this.txCount||!1===e.broadcast||this.broadcastWatches()}},t.prototype.diff=function(e){return this.storeReader.diffQueryAgainstStore({store:e.optimistic?this.optimisticData:this.data,rootId:e.id||"ROOT_QUERY",query:e.query,variables:e.variables,returnPartialData:e.returnPartialData,config:this.config})},t.prototype.watch=function(e){var t,i=this;return this.watches.size||ue(t=this).vars.forEach((function(e){return e.attachCache(t)})),this.watches.add(e),e.immediate&&this.maybeBroadcastWatch(e),function(){i.watches.delete(e)&&!i.watches.size&&function(e){ue(e).vars.forEach((function(t){return t.forgetCache(e)}))}(i),i.watchDep.dirty(e),i.maybeBroadcastWatch.forget(e)}},t.prototype.gc=function(){return this.optimisticData.gc()},t.prototype.retain=function(e,t){return(t?this.optimisticData:this.data).retain(e)},t.prototype.release=function(e,t){return(t?this.optimisticData:this.data).release(e)},t.prototype.identify=function(e){return(0,B.hh)(e)?e.__ref:this.policies.identify(e)[0]},t.prototype.evict=function(e){if(!e.id){if(z.call(e,"id"))return!1;e=(0,V.pi)((0,V.pi)({},e),{id:"ROOT_QUERY"})}try{return++this.txCount,this.optimisticData.evict(e)}finally{--this.txCount||!1===e.broadcast||this.broadcastWatches()}},t.prototype.reset=function(){return this.data.clear(),this.optimisticData=this.data,this.broadcastWatches(),Promise.resolve()},t.prototype.removeOptimistic=function(e){var t=this.optimisticData.removeLayer(e);t!==this.optimisticData&&(this.optimisticData=t,this.broadcastWatches())},t.prototype.performTransaction=function(e,t){var i=this,n=function(t){var n=i,s=n.data,o=n.optimisticData;++i.txCount,t&&(i.data=i.optimisticData=t);try{e(i)}finally{--i.txCount,i.data=s,i.optimisticData=o}},s=!1;"string"==typeof t?(this.optimisticData=this.optimisticData.addLayer(t,n),s=!0):null===t?n(this.data):n(),this.broadcastWatches(s)},t.prototype.transformDocument=function(e){if(this.addTypename){var t=this.typenameDocumentCache.get(e);return t||(t=(0,B.Gw)(e),this.typenameDocumentCache.set(e,t),this.typenameDocumentCache.set(t,t)),t}return e},t.prototype.broadcastWatches=function(e){var t=this;this.txCount||this.watches.forEach((function(i){return t.maybeBroadcastWatch(i,e)}))},t.prototype.broadcastWatch=function(e,t){this.watchDep.dirty(e),this.watchDep(e);var i=this.diff({query:e.query,variables:e.variables,optimistic:e.optimistic});e.optimistic&&t&&(i.fromOptimisticTransaction=!0),e.callback(i)},t}(F)},35367:()=>{},55765:(e,t,i)=>{"use strict";i.d(t,{f:()=>T});var n=i(70655),s=i(92924),o=i(81707),r=i(80496),a=i(96593),l=i(82152),c=i(21498),h=i(66282),d=i(85942),u=i(27636),p=i(62634),m=function(){function e(e){var t=e.cache,i=e.client,n=e.resolvers,s=e.fragmentMatcher;this.cache=t,i&&(this.client=i),n&&this.addResolvers(n),s&&this.setFragmentMatcher(s)}return e.prototype.addResolvers=function(e){var t=this;this.resolvers=this.resolvers||{},Array.isArray(e)?e.forEach((function(e){t.resolvers=(0,r.Ee)(t.resolvers,e)})):this.resolvers=(0,r.Ee)(this.resolvers,e)},e.prototype.setResolvers=function(e){this.resolvers={},this.addResolvers(e)},e.prototype.getResolvers=function(){return this.resolvers||{}},e.prototype.runResolvers=function(e){var t=e.document,i=e.remoteResult,s=e.context,o=e.variables,r=e.onlyRunForcedResolvers,a=void 0!==r&&r;return(0,n.mG)(this,void 0,void 0,(function(){return(0,n.Jh)(this,(function(e){return t?[2,this.resolveDocument(t,i.data,s,o,this.fragmentMatcher,a).then((function(e){return(0,n.pi)((0,n.pi)({},i),{data:e.result})}))]:[2,i]}))}))},e.prototype.setFragmentMatcher=function(e){this.fragmentMatcher=e},e.prototype.getFragmentMatcher=function(){return this.fragmentMatcher},e.prototype.clientQuery=function(e){return(0,r.FS)(["client"],e)&&this.resolvers?e:null},e.prototype.serverQuery=function(e){return(0,r.ob)(e)},e.prototype.prepareContext=function(e){var t=this.cache;return(0,n.pi)((0,n.pi)({},e),{cache:t,getCacheKey:function(e){return t.identify(e)}})},e.prototype.addExportedVariables=function(e,t,i){return void 0===t&&(t={}),void 0===i&&(i={}),(0,n.mG)(this,void 0,void 0,(function(){return(0,n.Jh)(this,(function(s){return e?[2,this.resolveDocument(e,this.buildRootValueFromCache(e,t)||{},this.prepareContext(i),t).then((function(e){return(0,n.pi)((0,n.pi)({},t),e.exportedVariables)}))]:[2,(0,n.pi)({},t)]}))}))},e.prototype.shouldForceResolvers=function(e){var t=!1;return(0,u.Vn)(e,{Directive:{enter:function(e){if("client"===e.name.value&&e.arguments&&(t=e.arguments.some((function(e){return"always"===e.name.value&&"BooleanValue"===e.value.kind&&!0===e.value.value}))))return u.$_}}}),t},e.prototype.buildRootValueFromCache=function(e,t){return this.cache.diff({query:(0,r.aL)(e),variables:t,returnPartialData:!0,optimistic:!1}).result},e.prototype.resolveDocument=function(e,t,i,s,o,a){return void 0===i&&(i={}),void 0===s&&(s={}),void 0===o&&(o=function(){return!0}),void 0===a&&(a=!1),(0,n.mG)(this,void 0,void 0,(function(){var l,c,h,d,u,p,m,g,f;return(0,n.Jh)(this,(function(v){return l=(0,r.p$)(e),c=(0,r.kU)(e),h=(0,r.F)(c),d=l.operation,u=d?d.charAt(0).toUpperCase()+d.slice(1):"Query",m=(p=this).cache,g=p.client,f={fragmentMap:h,context:(0,n.pi)((0,n.pi)({},i),{cache:m,client:g}),variables:s,fragmentMatcher:o,defaultOperationType:u,exportedVariables:{},onlyRunForcedResolvers:a},[2,this.resolveSelectionSet(l.selectionSet,t,f).then((function(e){return{result:e,exportedVariables:f.exportedVariables}}))]}))}))},e.prototype.resolveSelectionSet=function(e,t,i){return(0,n.mG)(this,void 0,void 0,(function(){var o,a,l,c,h,d=this;return(0,n.Jh)(this,(function(u){return o=i.fragmentMap,a=i.context,l=i.variables,c=[t],h=function(e){return(0,n.mG)(d,void 0,void 0,(function(){var h,d;return(0,n.Jh)(this,(function(n){return(0,r.LZ)(e,l)?(0,r.My)(e)?[2,this.resolveField(e,t,i).then((function(t){var i;void 0!==t&&c.push(((i={})[(0,r.u2)(e)]=t,i))}))]:((0,r.Ao)(e)?h=e:(h=o[e.name.value],(0,s.kG)(h,11)),h&&h.typeCondition&&(d=h.typeCondition.name.value,i.fragmentMatcher(t,d,a))?[2,this.resolveSelectionSet(h.selectionSet,t,i).then((function(e){c.push(e)}))]:[2]):[2]}))}))},[2,Promise.all(e.selections.map(h)).then((function(){return(0,r.bw)(c)}))]}))}))},e.prototype.resolveField=function(e,t,i){return(0,n.mG)(this,void 0,void 0,(function(){var s,o,a,l,c,h,d,u,m,g=this;return(0,n.Jh)(this,(function(n){return s=i.variables,o=e.name.value,a=(0,r.u2)(e),l=o!==a,c=t[a]||t[o],h=Promise.resolve(c),i.onlyRunForcedResolvers&&!this.shouldForceResolvers(e)||(d=t.__typename||i.defaultOperationType,(u=this.resolvers&&this.resolvers[d])&&(m=u[l?o:a])&&(h=Promise.resolve(p.ab.withValue(this.cache,m,[t,(0,r.NC)(e,s),i.context,{field:e,fragmentMap:i.fragmentMap}])))),[2,h.then((function(t){return void 0===t&&(t=c),e.directives&&e.directives.forEach((function(e){"export"===e.name.value&&e.arguments&&e.arguments.forEach((function(e){"as"===e.name.value&&"StringValue"===e.value.kind&&(i.exportedVariables[e.value.value]=t)}))})),e.selectionSet?null==t?t:Array.isArray(t)?g.resolveSubSelectedArray(e,t,i):e.selectionSet?g.resolveSelectionSet(e.selectionSet,t,i):void 0:t}))]}))}))},e.prototype.resolveSubSelectedArray=function(e,t,i){var n=this;return Promise.all(t.map((function(t){return null===t?null:Array.isArray(t)?n.resolveSubSelectedArray(e,t,i):e.selectionSet?n.resolveSelectionSet(e.selectionSet,t,i):void 0})))},e}(),g=new(r.mr?WeakMap:Map);function f(e,t){var i=e[t];"function"==typeof i&&(e[t]=function(){return g.set(e,(g.get(e)+1)%1e15),i.apply(this,arguments)})}function v(e){e.notifyTimeout&&(clearTimeout(e.notifyTimeout),e.notifyTimeout=void 0)}var y=function(){function e(e){this.cache=e,this.listeners=new Set,this.document=null,this.lastRequestId=1,this.subscriptions=new Set,this.stopped=!1,this.dirty=!1,this.diff=null,this.observableQuery=null,g.has(e)||(g.set(e,0),f(e,"evict"),f(e,"modify"),f(e,"reset"))}return e.prototype.init=function(e){var t=e.networkStatus||d.I.loading;return this.variables&&this.networkStatus!==d.I.loading&&!(0,l.D)(this.variables,e.variables)&&(t=d.I.setVariables),(0,l.D)(e.variables,this.variables)||(this.diff=null),Object.assign(this,{document:e.document,variables:e.variables,networkError:null,graphQLErrors:this.graphQLErrors||[],networkStatus:t}),e.observableQuery&&this.setObservableQuery(e.observableQuery),e.lastRequestId&&(this.lastRequestId=e.lastRequestId),this},e.prototype.reset=function(){v(this),this.diff=null,this.dirty=!1},e.prototype.getDiff=function(e){return void 0===e&&(e=this.variables),this.diff&&(0,l.D)(e,this.variables)?this.diff:(this.updateWatch(this.variables=e),this.diff=this.cache.diff({query:this.document,variables:e,returnPartialData:!0,optimistic:!0}))},e.prototype.setDiff=function(e){var t=this,i=this.diff;this.diff=e,this.dirty||(e&&e.result)===(i&&i.result)||(this.dirty=!0,this.notifyTimeout||(this.notifyTimeout=setTimeout((function(){return t.notify()}),0)))},e.prototype.setObservableQuery=function(e){var t=this;e!==this.observableQuery&&(this.oqListener&&this.listeners.delete(this.oqListener),this.observableQuery=e,e?(e.queryInfo=this,this.listeners.add(this.oqListener=function(){t.getDiff().fromOptimisticTransaction?e.observe():e.reobserve()})):delete this.oqListener)},e.prototype.notify=function(){var e=this;v(this),this.shouldNotify()&&this.listeners.forEach((function(t){return t(e)})),this.dirty=!1},e.prototype.shouldNotify=function(){if(!this.dirty||!this.listeners.size)return!1;if((0,d.O)(this.networkStatus)&&this.observableQuery){var e=this.observableQuery.options.fetchPolicy;if("cache-only"!==e&&"cache-and-network"!==e)return!1}return!0},e.prototype.stop=function(){if(!this.stopped){this.stopped=!0,this.cancel(),delete this.cancel,this.subscriptions.forEach((function(e){return e.unsubscribe()}));var e=this.observableQuery;e&&e.stopPolling()}},e.prototype.cancel=function(){},e.prototype.updateWatch=function(e){var t=this;void 0===e&&(e=this.variables);var i=this.observableQuery;i&&"no-cache"===i.options.fetchPolicy||this.lastWatch&&this.lastWatch.query===this.document&&(0,l.D)(e,this.lastWatch.variables)||(this.cancel(),this.cancel=this.cache.watch(this.lastWatch={query:this.document,variables:e,optimistic:!0,callback:function(e){return t.setDiff(e)}}))},e.prototype.shouldWrite=function(e,t){var i=this.lastWrite;return!(i&&i.dmCount===g.get(this.cache)&&(0,l.D)(t,i.variables)&&(0,l.D)(e.data,i.result.data))},e.prototype.markResult=function(e,t,i){var n=this;this.graphQLErrors=(0,r.Of)(e.errors)?e.errors:[],this.reset(),"no-cache"===t.fetchPolicy?this.diff={result:e.data,complete:!0}:!this.stopped&&i&&(b(e,t.errorPolicy)?this.cache.performTransaction((function(i){if(n.shouldWrite(e,t.variables))i.writeQuery({query:n.document,data:e.data,variables:t.variables}),n.lastWrite={result:e,variables:t.variables,dmCount:g.get(n.cache)};else if(n.diff&&n.diff.complete)return void(e.data=n.diff.result);var s=i.diff({query:n.document,variables:t.variables,returnPartialData:!0,optimistic:!0});n.stopped||n.updateWatch(t.variables),n.diff=s,s.complete&&(e.data=s.result)})):this.lastWrite=void 0)},e.prototype.markReady=function(){return this.networkError=null,this.networkStatus=d.I.ready},e.prototype.markError=function(e){return this.networkStatus=d.I.error,this.lastWrite=void 0,this.reset(),e.graphQLErrors&&(this.graphQLErrors=e.graphQLErrors),e.networkError&&(this.networkError=e.networkError),e},e}();function b(e,t){void 0===t&&(t="none");var i="ignore"===t||"all"===t,n=!(0,r.d2)(e);return!n&&i&&e.data&&(n=!0),n}var w=Object.prototype.hasOwnProperty,S=function(){function e(e){var t=e.cache,i=e.link,n=e.queryDeduplication,s=void 0!==n&&n,o=e.onBroadcast,a=e.ssrMode,l=void 0!==a&&a,c=e.clientAwareness,h=void 0===c?{}:c,d=e.localState,u=e.assumeImmutableResults;this.clientAwareness={},this.queries=new Map,this.fetchCancelFns=new Map,this.transformCache=new(r.mr?WeakMap:Map),this.queryIdCounter=1,this.requestIdCounter=1,this.mutationIdCounter=1,this.inFlightLinkObservables=new Map,this.cache=t,this.link=i,this.queryDeduplication=s,this.clientAwareness=h,this.localState=d||new m({cache:t}),this.ssrMode=l,this.assumeImmutableResults=!!u,(this.onBroadcast=o)&&(this.mutationStore=Object.create(null))}return e.prototype.stop=function(){var e=this;this.queries.forEach((function(t,i){e.stopQueryNoBroadcast(i)})),this.cancelPendingFetches(new s.ej(12))},e.prototype.cancelPendingFetches=function(e){this.fetchCancelFns.forEach((function(t){return t(e)})),this.fetchCancelFns.clear()},e.prototype.mutate=function(e){var t=e.mutation,i=e.variables,o=e.optimisticResponse,a=e.updateQueries,l=e.refetchQueries,h=void 0===l?[]:l,d=e.awaitRefetchQueries,u=void 0!==d&&d,p=e.update,m=e.errorPolicy,g=void 0===m?"none":m,f=e.fetchPolicy,v=e.context,y=void 0===v?{}:v;return(0,n.mG)(this,void 0,void 0,(function(){var e,l,d;return(0,n.Jh)(this,(function(m){switch(m.label){case 0:return(0,s.kG)(t,13),(0,s.kG)(!f||"no-cache"===f,14),e=this.generateMutationId(),t=this.transform(t).document,i=this.getVariables(t,i),this.transform(t).hasClientExports?[4,this.localState.addExportedVariables(t,i,y)]:[3,2];case 1:i=m.sent(),m.label=2;case 2:return l=this.mutationStore&&(this.mutationStore[e]={mutation:t,variables:i,loading:!0,error:null}),o&&this.markMutationOptimistic(o,{mutationId:e,document:t,variables:i,errorPolicy:g,updateQueries:a,update:p}),this.broadcastQueries(),d=this,[2,new Promise((function(s,m){var v,b;d.getObservableFromLink(t,(0,n.pi)((0,n.pi)({},y),{optimisticResponse:o}),i,!1).subscribe({next:function(n){if((0,r.d2)(n)&&"none"===g)b=new c.c({graphQLErrors:n.errors});else{if(l&&(l.loading=!1,l.error=null),"no-cache"!==f)try{d.markMutationResult({mutationId:e,result:n,document:t,variables:i,errorPolicy:g,updateQueries:a,update:p})}catch(e){return void(b=new c.c({networkError:e}))}v=n}},error:function(t){l&&(l.loading=!1,l.error=t),o&&d.cache.removeOptimistic(e),d.broadcastQueries(),m(new c.c({networkError:t}))},complete:function(){if(b&&l&&(l.loading=!1,l.error=b),o&&d.cache.removeOptimistic(e),d.broadcastQueries(),b)m(b);else{"function"==typeof h&&(h=h(v));var t=[];(0,r.Of)(h)&&h.forEach((function(e){if("string"==typeof e)d.queries.forEach((function(i){var n=i.observableQuery;n&&n.queryName===e&&t.push(n.refetch())}));else{var i={query:e.query,variables:e.variables,fetchPolicy:"network-only"};e.context&&(i.context=e.context),t.push(d.query(i))}})),Promise.all(u?t:[]).then((function(){"ignore"===g&&v&&(0,r.d2)(v)&&delete v.errors,s(v)}),m)}}})}))]}}))}))},e.prototype.markMutationResult=function(e,t){var i=this;if(void 0===t&&(t=this.cache),b(e.result,e.errorPolicy)){var n=[{result:e.result.data,dataId:"ROOT_MUTATION",query:e.document,variables:e.variables}],s=e.updateQueries;s&&this.queries.forEach((function(o,a){var l=o.observableQuery,c=l&&l.queryName;if(c&&w.call(s,c)){var h=s[c],d=i.queries.get(a),u=d.document,p=d.variables,m=t.diff({query:u,variables:p,returnPartialData:!0,optimistic:!1}),g=m.result;if(m.complete&&g){var f=h(g,{mutationResult:e.result,queryName:u&&(0,r.rY)(u)||void 0,queryVariables:p});f&&n.push({result:f,dataId:"ROOT_QUERY",query:u,variables:p})}}})),t.performTransaction((function(t){n.forEach((function(e){return t.write(e)}));var i=e.update;i&&i(t,e.result)}),null)}},e.prototype.markMutationOptimistic=function(e,t){var i=this,s="function"==typeof e?e(t.variables):e;return this.cache.recordOptimisticTransaction((function(e){try{i.markMutationResult((0,n.pi)((0,n.pi)({},t),{result:{data:s}}),e)}catch(e){}}),t.mutationId)},e.prototype.fetchQuery=function(e,t,i){return this.fetchQueryObservable(e,t,i).promise},e.prototype.getQueryStore=function(){var e=Object.create(null);return this.queries.forEach((function(t,i){e[i]={variables:t.variables,networkStatus:t.networkStatus,networkError:t.networkError,graphQLErrors:t.graphQLErrors}})),e},e.prototype.resetErrors=function(e){var t=this.queries.get(e);t&&(t.networkError=void 0,t.graphQLErrors=[])},e.prototype.transform=function(e){var t=this.transformCache;if(!t.has(e)){var i=this.cache.transformDocument(e),n=(0,r.Fo)(this.cache.transformForLink(i)),s=this.localState.clientQuery(i),o=n&&this.localState.serverQuery(n),a={document:i,hasClientExports:(0,r.mj)(i),hasForcedResolvers:this.localState.shouldForceResolvers(i),clientQuery:s,serverQuery:o,defaultVars:(0,r.O4)((0,r.$H)(i))},l=function(e){e&&!t.has(e)&&t.set(e,a)};l(e),l(i),l(s),l(o)}return t.get(e)},e.prototype.getVariables=function(e,t){return(0,n.pi)((0,n.pi)({},this.transform(e).defaultVars),t)},e.prototype.watchQuery=function(e){void 0===(e=(0,n.pi)((0,n.pi)({},e),{variables:this.getVariables(e.query,e.variables)})).notifyOnNetworkStatusChange&&(e.notifyOnNetworkStatusChange=!1);var t=new y(this.cache),i=new h.u({queryManager:this,queryInfo:t,options:e});return this.queries.set(i.queryId,t),t.init({document:e.query,observableQuery:i,variables:e.variables}),i},e.prototype.query=function(e){var t=this;(0,s.kG)(e.query,15),(0,s.kG)("Document"===e.query.kind,16),(0,s.kG)(!e.returnPartialData,17),(0,s.kG)(!e.pollInterval,18);var i=this.generateQueryId();return this.fetchQuery(i,e).finally((function(){return t.stopQuery(i)}))},e.prototype.generateQueryId=function(){return String(this.queryIdCounter++)},e.prototype.generateRequestId=function(){return this.requestIdCounter++},e.prototype.generateMutationId=function(){return String(this.mutationIdCounter++)},e.prototype.stopQueryInStore=function(e){this.stopQueryInStoreNoBroadcast(e),this.broadcastQueries()},e.prototype.stopQueryInStoreNoBroadcast=function(e){var t=this.queries.get(e);t&&t.stop()},e.prototype.clearStore=function(){return this.cancelPendingFetches(new s.ej(19)),this.queries.forEach((function(e){e.observableQuery?e.networkStatus=d.I.loading:e.stop()})),this.mutationStore&&(this.mutationStore=Object.create(null)),this.cache.reset()},e.prototype.resetStore=function(){var e=this;return this.clearStore().then((function(){return e.reFetchObservableQueries()}))},e.prototype.reFetchObservableQueries=function(e){var t=this;void 0===e&&(e=!1);var i=[];return this.queries.forEach((function(n,s){var o=n.observableQuery;if(o&&o.hasObservers()){var r=o.options.fetchPolicy;o.resetLastResults(),"cache-only"===r||!e&&"standby"===r||i.push(o.refetch()),t.getQuery(s).setDiff(null)}})),this.broadcastQueries(),Promise.all(i)},e.prototype.setObservableQuery=function(e){this.getQuery(e.queryId).setObservableQuery(e)},e.prototype.startGraphQLSubscription=function(e){var t=this,i=e.query,n=e.fetchPolicy,s=e.errorPolicy,o=e.variables,a=e.context,l=void 0===a?{}:a;i=this.transform(i).document,o=this.getVariables(i,o);var h=function(e){return t.getObservableFromLink(i,l,e,!1).map((function(o){if("no-cache"!==n&&(b(o,s)&&t.cache.write({query:i,result:o.data,dataId:"ROOT_SUBSCRIPTION",variables:e}),t.broadcastQueries()),(0,r.d2)(o))throw new c.c({graphQLErrors:o.errors});return o}))};if(this.transform(i).hasClientExports){var d=this.localState.addExportedVariables(i,o,l).then(h);return new r.y$((function(e){var t=null;return d.then((function(i){return t=i.subscribe(e)}),e.error),function(){return t&&t.unsubscribe()}}))}return h(o)},e.prototype.stopQuery=function(e){this.stopQueryNoBroadcast(e),this.broadcastQueries()},e.prototype.stopQueryNoBroadcast=function(e){this.stopQueryInStoreNoBroadcast(e),this.removeQuery(e)},e.prototype.removeQuery=function(e){this.fetchCancelFns.delete(e),this.getQuery(e).stop(),this.queries.delete(e)},e.prototype.broadcastQueries=function(){this.onBroadcast&&this.onBroadcast(),this.queries.forEach((function(e){return e.notify()}))},e.prototype.getLocalState=function(){return this.localState},e.prototype.getObservableFromLink=function(e,t,i,s){var a,l,c=this;void 0===s&&(s=null!==(a=null==t?void 0:t.queryDeduplication)&&void 0!==a?a:this.queryDeduplication);var h=this.transform(e).serverQuery;if(h){var d=this.inFlightLinkObservables,u=this.link,p={query:h,variables:i,operationName:(0,r.rY)(h)||void 0,context:this.prepareContext((0,n.pi)((0,n.pi)({},t),{forceFetch:!s}))};if(t=p.context,s){var m=d.get(h)||new Map;d.set(h,m);var g=JSON.stringify(i);if(!(l=m.get(g))){var f=new r.X_([(0,o.ht)(u,p)]);m.set(g,l=f),f.cleanup((function(){m.delete(g)&&m.size<1&&d.delete(h)}))}}else l=new r.X_([(0,o.ht)(u,p)])}else l=new r.X_([r.y$.of({data:{}})]),t=this.prepareContext(t);var v=this.transform(e).clientQuery;return v&&(l=(0,r.sz)(l,(function(e){return c.localState.runResolvers({document:v,remoteResult:e,context:t,variables:i})}))),l},e.prototype.getResultsFromLink=function(e,t,i){var n=e.lastRequestId;return(0,r.sz)(this.getObservableFromLink(e.document,i.context,i.variables),(function(s){var o=(0,r.Of)(s.errors);if(n>=e.lastRequestId){if(o&&"none"===i.errorPolicy)throw e.markError(new c.c({graphQLErrors:s.errors}));e.markResult(s,i,t),e.markReady()}var a={data:s.data,loading:!1,networkStatus:e.networkStatus||d.I.ready};return o&&"ignore"!==i.errorPolicy&&(a.errors=s.errors),a}),(function(t){var i=(0,c.M)(t)?t:new c.c({networkError:t});throw n>=e.lastRequestId&&e.markError(i),i}))},e.prototype.fetchQueryObservable=function(e,t,i){var n=this;void 0===i&&(i=d.I.loading);var s=this.transform(t.query).document,o=this.getVariables(s,t.variables),a=this.getQuery(e),l=a.networkStatus,c=t.fetchPolicy,h=void 0===c?"cache-first":c,u=t.errorPolicy,p=void 0===u?"none":u,m=t.returnPartialData,g=void 0!==m&&m,f=t.notifyOnNetworkStatusChange,v=void 0!==f&&f,y=t.context,b=void 0===y?{}:y;("cache-first"===h||"cache-and-network"===h||"network-only"===h||"no-cache"===h)&&v&&"number"==typeof l&&l!==i&&(0,d.O)(i)&&("cache-first"!==h&&(h="cache-and-network"),g=!0);var w=Object.assign({},t,{query:s,variables:o,fetchPolicy:h,errorPolicy:p,returnPartialData:g,notifyOnNetworkStatusChange:v,context:b}),S=function(e){return w.variables=e,n.fetchQueryByPolicy(a,w,i)};this.fetchCancelFns.set(e,(function(e){Promise.resolve().then((function(){return E.cancel(e)}))}));var E=new r.X_(this.transform(w.query).hasClientExports?this.localState.addExportedVariables(w.query,w.variables,w.context).then(S):S(w.variables));return E.cleanup((function(){n.fetchCancelFns.delete(e);var i=t.nextFetchPolicy;i&&(t.nextFetchPolicy=void 0,t.fetchPolicy="function"==typeof i?i.call(t,t.fetchPolicy||"cache-first"):i)})),E},e.prototype.fetchQueryByPolicy=function(e,t,i){var s=this,o=t.query,a=t.variables,l=t.fetchPolicy,c=t.errorPolicy,h=t.returnPartialData,u=t.context;e.init({document:o,variables:a,lastRequestId:this.generateRequestId(),networkStatus:i});var p=function(){return e.getDiff(a)},m=function(t,i){void 0===i&&(i=e.networkStatus||d.I.loading);var l=t.result;var c=function(e){return r.y$.of((0,n.pi)({data:e,loading:(0,d.O)(i),networkStatus:i},t.complete?null:{partial:!0}))};return s.transform(o).hasForcedResolvers?s.localState.runResolvers({document:o,remoteResult:{data:l},context:u,variables:a,onlyRunForcedResolvers:!0}).then((function(e){return c(e.data)})):c(l)},g=function(t){return s.getResultsFromLink(e,t,{variables:a,context:u,fetchPolicy:l,errorPolicy:c})};switch(l){default:case"cache-first":return(f=p()).complete?[m(f,e.markReady())]:h?[m(f),g(!0)]:[g(!0)];case"cache-and-network":var f;return(f=p()).complete||h?[m(f),g(!0)]:[g(!0)];case"cache-only":return[m(p(),e.markReady())];case"network-only":return[g(!0)];case"no-cache":return[g(!1)];case"standby":return[]}},e.prototype.getQuery=function(e){return e&&!this.queries.has(e)&&this.queries.set(e,new y(this.cache)),this.queries.get(e)},e.prototype.prepareContext=function(e){void 0===e&&(e={});var t=this.localState.prepareContext(e);return(0,n.pi)((0,n.pi)({},t),{clientAwareness:this.clientAwareness})},e}();function E(e,t){return(0,r.oA)(e,t,t.variables&&{variables:(0,n.pi)((0,n.pi)({},e.variables),t.variables)})}var T=function(){function e(e){var t=this;this.defaultOptions={},this.resetStoreCallbacks=[],this.clearStoreCallbacks=[];var i=e.uri,n=e.credentials,r=e.headers,l=e.cache,c=e.ssrMode,h=void 0!==c&&c,d=e.ssrForceFetchDelay,u=void 0===d?0:d,p=e.connectToDevTools,g=void 0===p?"object"==typeof window&&!window.__APOLLO_CLIENT__&&!1:p,f=e.queryDeduplication,v=void 0===f||f,y=e.defaultOptions,b=e.assumeImmutableResults,w=void 0!==b&&b,E=e.resolvers,T=e.typeDefs,M=e.fragmentMatcher,_=e.name,x=e.version,A=e.link;if(A||(A=i?new a.uG({uri:i,credentials:n,headers:r}):o.i0.empty()),!l)throw new s.ej(9);this.link=A,this.cache=l,this.disableNetworkFetches=h||u>0,this.queryDeduplication=v,this.defaultOptions=y||{},this.typeDefs=T,u&&setTimeout((function(){return t.disableNetworkFetches=!1}),u),this.watchQuery=this.watchQuery.bind(this),this.query=this.query.bind(this),this.mutate=this.mutate.bind(this),this.resetStore=this.resetStore.bind(this),this.reFetchObservableQueries=this.reFetchObservableQueries.bind(this),g&&"object"==typeof window&&(window.__APOLLO_CLIENT__=this),this.version="3.3.11",this.localState=new m({cache:l,client:this,resolvers:E,fragmentMatcher:M}),this.queryManager=new S({cache:this.cache,link:this.link,queryDeduplication:v,ssrMode:h,clientAwareness:{name:_,version:x},localState:this.localState,assumeImmutableResults:w,onBroadcast:g?function(){t.devToolsHookCb&&t.devToolsHookCb({action:{},state:{queries:t.queryManager.getQueryStore(),mutations:t.queryManager.mutationStore||{}},dataWithOptimisticResults:t.cache.extract(!0)})}:void 0})}return e.prototype.stop=function(){this.queryManager.stop()},e.prototype.watchQuery=function(e){return this.defaultOptions.watchQuery&&(e=E(this.defaultOptions.watchQuery,e)),!this.disableNetworkFetches||"network-only"!==e.fetchPolicy&&"cache-and-network"!==e.fetchPolicy||(e=(0,n.pi)((0,n.pi)({},e),{fetchPolicy:"cache-first"})),this.queryManager.watchQuery(e)},e.prototype.query=function(e){return this.defaultOptions.query&&(e=E(this.defaultOptions.query,e)),(0,s.kG)("cache-and-network"!==e.fetchPolicy,10),this.disableNetworkFetches&&"network-only"===e.fetchPolicy&&(e=(0,n.pi)((0,n.pi)({},e),{fetchPolicy:"cache-first"})),this.queryManager.query(e)},e.prototype.mutate=function(e){return this.defaultOptions.mutate&&(e=E(this.defaultOptions.mutate,e)),this.queryManager.mutate(e)},e.prototype.subscribe=function(e){return this.queryManager.startGraphQLSubscription(e)},e.prototype.readQuery=function(e,t){return void 0===t&&(t=!1),this.cache.readQuery(e,t)},e.prototype.readFragment=function(e,t){return void 0===t&&(t=!1),this.cache.readFragment(e,t)},e.prototype.writeQuery=function(e){this.cache.writeQuery(e),this.queryManager.broadcastQueries()},e.prototype.writeFragment=function(e){this.cache.writeFragment(e),this.queryManager.broadcastQueries()},e.prototype.__actionHookForDevTools=function(e){this.devToolsHookCb=e},e.prototype.__requestRaw=function(e){return(0,o.ht)(this.link,e)},e.prototype.resetStore=function(){var e=this;return Promise.resolve().then((function(){return e.queryManager.clearStore()})).then((function(){return Promise.all(e.resetStoreCallbacks.map((function(e){return e()})))})).then((function(){return e.reFetchObservableQueries()}))},e.prototype.clearStore=function(){var e=this;return Promise.resolve().then((function(){return e.queryManager.clearStore()})).then((function(){return Promise.all(e.clearStoreCallbacks.map((function(e){return e()})))}))},e.prototype.onResetStore=function(e){var t=this;return this.resetStoreCallbacks.push(e),function(){t.resetStoreCallbacks=t.resetStoreCallbacks.filter((function(t){return t!==e}))}},e.prototype.onClearStore=function(e){var t=this;return this.clearStoreCallbacks.push(e),function(){t.clearStoreCallbacks=t.clearStoreCallbacks.filter((function(t){return t!==e}))}},e.prototype.reFetchObservableQueries=function(e){return this.queryManager.reFetchObservableQueries(e)},e.prototype.extract=function(e){return this.cache.extract(e)},e.prototype.restore=function(e){return this.cache.restore(e)},e.prototype.addResolvers=function(e){this.localState.addResolvers(e)},e.prototype.setResolvers=function(e){this.localState.setResolvers(e)},e.prototype.getResolvers=function(){return this.localState.getResolvers()},e.prototype.setLocalStateFragmentMatcher=function(e){this.localState.setFragmentMatcher(e)},e.prototype.setLink=function(e){this.link=this.queryManager.link=e},e}()},66282:(e,t,i)=>{"use strict";i.d(t,{u:()=>c});var n=i(70655),s=i(92924),o=i(82152),r=i(85942),a=i(80496),l=function(){function e(e,t,i,n){this.observer=e,this.options=t,this.fetch=i,this.shouldFetch=n}return e.prototype.reobserve=function(e,t){e?this.updateOptions(e):this.updatePolling();var i=this.fetch(this.options,t);return this.concast&&this.concast.removeObserver(this.observer,!0),i.addObserver(this.observer),(this.concast=i).promise},e.prototype.updateOptions=function(e){return Object.assign(this.options,(0,a.oA)(e)),this.updatePolling(),this},e.prototype.stop=function(){this.concast&&(this.concast.removeObserver(this.observer),delete this.concast),this.pollingInfo&&(clearTimeout(this.pollingInfo.timeout),this.options.pollInterval=0,this.updatePolling())},e.prototype.updatePolling=function(){var e=this,t=this.pollingInfo,i=this.options.pollInterval;if(i){if((!t||t.interval!==i)&&((0,s.kG)(i,20),!1!==this.shouldFetch)){(t||(this.pollingInfo={})).interval=i;var n=function(){e.pollingInfo&&(e.shouldFetch&&e.shouldFetch()?e.reobserve({fetchPolicy:"network-only",nextFetchPolicy:e.options.fetchPolicy||"cache-first"},r.I.poll).then(o,o):o())},o=function(){var t=e.pollingInfo;t&&(clearTimeout(t.timeout),t.timeout=setTimeout(n,t.interval))};o()}}else t&&(clearTimeout(t.timeout),delete this.pollingInfo)},e}(),c=function(e){function t(t){var i=t.queryManager,s=t.queryInfo,o=t.options,l=e.call(this,(function(e){return l.onSubscribe(e)}))||this;l.observers=new Set,l.subscriptions=new Set,l.observer={next:function(e){(l.lastError||l.isDifferentFromLastResult(e))&&(l.updateLastResult(e),(0,a.pM)(l.observers,"next",e))},error:function(e){l.updateLastResult((0,n.pi)((0,n.pi)({},l.lastResult),{error:e,errors:e.graphQLErrors,networkStatus:r.I.error,loading:!1})),(0,a.pM)(l.observers,"error",l.lastError=e)}},l.isTornDown=!1,l.options=o,l.queryId=i.generateQueryId();var c=(0,a.$H)(o.query);return l.queryName=c&&c.name&&c.name.value,l.queryManager=i,l.queryInfo=s,l}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"variables",{get:function(){return this.options.variables},enumerable:!1,configurable:!0}),t.prototype.result=function(){var e=this;return new Promise((function(t,i){var n={next:function(i){t(i),e.observers.delete(n),e.observers.size||e.queryManager.removeQuery(e.queryId),setTimeout((function(){s.unsubscribe()}),0)},error:i},s=e.subscribe(n)}))},t.prototype.getCurrentResult=function(e){void 0===e&&(e=!0);var t=this.lastResult,i=this.queryInfo.networkStatus||t&&t.networkStatus||r.I.ready,s=(0,n.pi)((0,n.pi)({},t),{loading:(0,r.O)(i),networkStatus:i});if(this.isTornDown)return s;var o=this.options.fetchPolicy,a=void 0===o?"cache-first":o;if("no-cache"===a||"network-only"===a)delete s.partial;else if(!s.data||!this.queryManager.transform(this.options.query).hasForcedResolvers){var l=this.queryInfo.getDiff();s.data=l.complete||this.options.returnPartialData?l.result:void 0,l.complete?(s.networkStatus!==r.I.loading||"cache-first"!==a&&"cache-only"!==a||(s.networkStatus=r.I.ready,s.loading=!1),delete s.partial):s.partial=!0}return e&&this.updateLastResult(s),s},t.prototype.isDifferentFromLastResult=function(e){return!(0,o.D)(this.lastResultSnapshot,e)},t.prototype.getLastResult=function(){return this.lastResult},t.prototype.getLastError=function(){return this.lastError},t.prototype.resetLastResults=function(){delete this.lastResult,delete this.lastResultSnapshot,delete this.lastError,this.isTornDown=!1},t.prototype.resetQueryStoreErrors=function(){this.queryManager.resetErrors(this.queryId)},t.prototype.refetch=function(e){var t={pollInterval:0},i=this.options.fetchPolicy;return"no-cache"!==i&&"cache-and-network"!==i&&(t.fetchPolicy="network-only",t.nextFetchPolicy=i||"cache-first"),e&&!(0,o.D)(this.options.variables,e)&&(t.variables=this.options.variables=(0,n.pi)((0,n.pi)({},this.options.variables),e)),this.newReobserver(!1).reobserve(t,r.I.refetch)},t.prototype.fetchMore=function(e){var t=this,i=(0,n.pi)((0,n.pi)({},e.query?e:(0,n.pi)((0,n.pi)((0,n.pi)({},this.options),e),{variables:(0,n.pi)((0,n.pi)({},this.options.variables),e.variables)})),{fetchPolicy:"no-cache"}),s=this.queryManager.generateQueryId();return i.notifyOnNetworkStatusChange&&(this.queryInfo.networkStatus=r.I.fetchMore,this.observe()),this.queryManager.fetchQuery(s,i,r.I.fetchMore).then((function(n){var s=n.data,o=e.updateQuery;return o?t.updateQuery((function(e){return o(e,{fetchMoreResult:s,variables:i.variables})})):t.queryManager.cache.writeQuery({query:i.query,variables:i.variables,data:s}),n})).finally((function(){t.queryManager.stopQuery(s),t.reobserve()}))},t.prototype.subscribeToMore=function(e){var t=this,i=this.queryManager.startGraphQLSubscription({query:e.document,variables:e.variables,context:e.context}).subscribe({next:function(i){var n=e.updateQuery;n&&t.updateQuery((function(e,t){var s=t.variables;return n(e,{subscriptionData:i,variables:s})}))},error:function(t){e.onError&&e.onError(t)}});return this.subscriptions.add(i),function(){t.subscriptions.delete(i)&&i.unsubscribe()}},t.prototype.setOptions=function(e){return this.reobserve(e)},t.prototype.setVariables=function(e){if((0,o.D)(this.variables,e))return this.observers.size?this.result():Promise.resolve();if(this.options.variables=e,!this.observers.size)return Promise.resolve();var t=this.options.fetchPolicy,i=void 0===t?"cache-first":t,n={fetchPolicy:i,variables:e};return"cache-first"!==i&&"no-cache"!==i&&"network-only"!==i&&(n.fetchPolicy="cache-and-network",n.nextFetchPolicy=i),this.reobserve(n,r.I.setVariables)},t.prototype.updateQuery=function(e){var t,i=this.queryManager,n=e(i.cache.diff({query:this.options.query,variables:this.variables,previousResult:null===(t=this.lastResult)||void 0===t?void 0:t.data,returnPartialData:!0,optimistic:!1}).result,{variables:this.variables});n&&(i.cache.writeQuery({query:this.options.query,data:n,variables:this.variables}),i.broadcastQueries())},t.prototype.startPolling=function(e){this.getReobserver().updateOptions({pollInterval:e})},t.prototype.stopPolling=function(){this.reobserver&&this.reobserver.updateOptions({pollInterval:0})},t.prototype.updateLastResult=function(e){var t=this.lastResult;return this.lastResult=e,this.lastResultSnapshot=this.queryManager.assumeImmutableResults?e:(0,a.Xh)(e),(0,a.Of)(e.errors)||delete this.lastError,t},t.prototype.onSubscribe=function(e){var t=this;if(e===this.observer)return function(){};try{var i=e._subscription._observer;i&&!i.error&&(i.error=h)}catch(e){}var n=!this.observers.size;return this.observers.add(e),this.lastError?e.error&&e.error(this.lastError):this.lastResult&&e.next&&e.next(this.lastResult),n&&this.reobserve().catch((function(e){})),function(){t.observers.delete(e)&&!t.observers.size&&t.tearDownQuery()}},t.prototype.getReobserver=function(){return this.reobserver||(this.reobserver=this.newReobserver(!0))},t.prototype.newReobserver=function(e){var t=this,i=this.queryManager,s=this.queryId;return i.setObservableQuery(this),new l(this.observer,e?this.options:(0,n.pi)({},this.options),(function(e,n){return i.setObservableQuery(t),i.fetchQueryObservable(s,e,n)}),!i.ssrMode&&function(){return!(0,r.O)(t.queryInfo.networkStatus)})},t.prototype.reobserve=function(e,t){return this.isTornDown=!1,this.getReobserver().reobserve(e,t)},t.prototype.observe=function(){this.observer.next(this.getCurrentResult(!1))},t.prototype.hasObservers=function(){return this.observers.size>0},t.prototype.tearDownQuery=function(){this.isTornDown||(this.reobserver&&(this.reobserver.stop(),delete this.reobserver),this.subscriptions.forEach((function(e){return e.unsubscribe()})),this.subscriptions.clear(),this.queryManager.stopQuery(this.queryId),this.observers.clear(),this.isTornDown=!0)},t}(a.y$);function h(e){}(0,a.Dy)(c)},71439:(e,t,i)=>{"use strict";i.d(t,{fe:()=>n.f,h4:()=>o.h4,createHttpLink:()=>l.LQ,Ps:()=>h.ZP});var n=i(55765),s=(i(66282),i(85942),i(72191));i.o(s,"createHttpLink")&&i.d(t,{createHttpLink:function(){return s.createHttpLink}});i(21498);var o=i(62634),r=i(35367);i.o(r,"createHttpLink")&&i.d(t,{createHttpLink:function(){return r.createHttpLink}});var a=i(81707);i.o(a,"createHttpLink")&&i.d(t,{createHttpLink:function(){return a.createHttpLink}});var l=i(96593),c=(i(84913),i(80496),i(92924)),h=i(91466);(0,c.U6)("log");h.ZP.resetCaches,h.ZP.disableFragmentWarnings,h.ZP.enableExperimentalFragmentVariables,h.ZP.disableExperimentalFragmentVariables},85942:(e,t,i)=>{"use strict";var n;function s(e){return!!e&&e<7}i.d(t,{I:()=>n,O:()=>s}),function(e){e[e.loading=1]="loading",e[e.setVariables=2]="setVariables",e[e.fetchMore=3]="fetchMore",e[e.refetch=4]="refetch",e[e.poll=6]="poll",e[e.ready=7]="ready",e[e.error=8]="error"}(n||(n={}))},72191:()=>{},21498:(e,t,i)=>{"use strict";i.d(t,{M:()=>o,c:()=>r});var n=i(70655),s=i(80496);function o(e){return e.hasOwnProperty("graphQLErrors")}var r=function(e){function t(i){var n,o,r=i.graphQLErrors,a=i.networkError,l=i.errorMessage,c=i.extraInfo,h=e.call(this,l)||this;return h.graphQLErrors=r||[],h.networkError=a||null,h.message=l||(n=h,o="",(0,s.Of)(n.graphQLErrors)&&n.graphQLErrors.forEach((function(e){var t=e?e.message:"Error message not found.";o+=t+"\n"})),n.networkError&&(o+=n.networkError.message+"\n"),o=o.replace(/\n$/,"")),h.extraInfo=c,h.__proto__=t.prototype,h}return(0,n.ZT)(t,e),t}(Error)},97222:(e,t,i)=>{"use strict";i.d(t,{i:()=>h});var n=i(70655),s=i(92924),o=i(80496),r=i(84913);function a(e,t){return t?t(e):o.y$.of()}function l(e){return"function"==typeof e?new h(e):e}function c(e){return e.request.length<=1}!function(e){function t(t,i){var n=e.call(this,t)||this;return n.link=i,n}(0,n.ZT)(t,e)}(Error);var h=function(){function e(e){e&&(this.request=e)}return e.empty=function(){return new e((function(){return o.y$.of()}))},e.from=function(t){return 0===t.length?e.empty():t.map(l).reduce((function(e,t){return e.concat(t)}))},e.split=function(t,i,n){var s=l(i),r=l(n||new e(a));return c(s)&&c(r)?new e((function(e){return t(e)?s.request(e)||o.y$.of():r.request(e)||o.y$.of()})):new e((function(e,i){return t(e)?s.request(e,i)||o.y$.of():r.request(e,i)||o.y$.of()}))},e.execute=function(e,t){return e.request((0,r.zi)(t.context,(0,r.DQ)((0,r.Ak)(t))))||o.y$.of()},e.concat=function(t,i){var n=l(t);if(c(n))return n;var s=l(i);return c(s)?new e((function(e){return n.request(e,(function(e){return s.request(e)||o.y$.of()}))||o.y$.of()})):new e((function(e,t){return n.request(e,(function(e){return s.request(e,t)||o.y$.of()}))||o.y$.of()}))},e.prototype.split=function(t,i,n){return this.concat(e.split(t,i,n||new e(a)))},e.prototype.concat=function(t){return e.concat(this,t)},e.prototype.request=function(e,t){throw new s.ej(21)},e.prototype.onError=function(e,t){if(t&&t.error)return t.error(e),!1;throw e},e.prototype.setOnError=function(e){return this.onError=e,this},e}()},24957:(e,t,i)=>{"use strict";i(97222).i.concat},67325:(e,t,i)=>{"use strict";i(97222).i.empty},2550:(e,t,i)=>{"use strict";i.d(t,{h:()=>n});var n=i(97222).i.execute},34674:(e,t,i)=>{"use strict";i(97222).i.from},81707:(e,t,i)=>{"use strict";i.d(t,{ht:()=>n.h,i0:()=>s.i});i(67325),i(34674),i(64738),i(24957);var n=i(2550),s=i(97222),o=i(79875);i.o(o,"createHttpLink")&&i.d(t,{createHttpLink:function(){return o.createHttpLink}})},64738:(e,t,i)=>{"use strict";i(97222).i.split},79875:()=>{},96593:(e,t,i)=>{"use strict";i.d(t,{uG:()=>m,LQ:()=>p});var n=i(84913),s=Object.prototype.hasOwnProperty;var o=i(92924),r=function(e,t){var i;try{i=JSON.stringify(e)}catch(e){var n=new o.ej(23);throw n.parseError=e,n}return i},a=i(70655),l=i(90778),c={http:{includeQuery:!0,includeExtensions:!1},headers:{accept:"*/*","content-type":"application/json"},options:{method:"POST"}},h=i(80285),d=i(81707),u=i(80496);var p=function(e){void 0===e&&(e={});var t=e.uri,i=void 0===t?"/graphql":t,p=e.fetch,m=e.includeExtensions,g=e.useGETForQueries,f=e.includeUnusedVariables,v=void 0!==f&&f,y=(0,a._T)(e,["uri","fetch","includeExtensions","useGETForQueries","includeUnusedVariables"]);!function(e){if(!e&&"undefined"==typeof fetch)throw new o.ej(22)}(p),p||(p=fetch);var b={http:{includeExtensions:m},options:y.fetchOptions,credentials:y.credentials,headers:y.headers};return new d.i0((function(e){var t=function(e,t){return e.getContext().uri||("function"==typeof t?t(e):t||"/graphql")}(e,i),o=e.getContext(),d={};if(o.clientAwareness){var m=o.clientAwareness,f=m.name,y=m.version;f&&(d["apollographql-client-name"]=f),y&&(d["apollographql-client-version"]=y)}var w,S=(0,a.pi)((0,a.pi)({},d),o.headers),E={http:o.http,options:o.fetchOptions,credentials:o.credentials,headers:S},T=function(e,t){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];var s=(0,a.pi)((0,a.pi)({},t.options),{headers:t.headers,credentials:t.credentials}),o=t.http||{};i.forEach((function(e){s=(0,a.pi)((0,a.pi)((0,a.pi)({},s),e.options),{headers:(0,a.pi)((0,a.pi)({},s.headers),e.headers)}),e.credentials&&(s.credentials=e.credentials),o=(0,a.pi)((0,a.pi)({},o),e.http)}));var r=e.operationName,c=e.extensions,h=e.variables,d=e.query,u={operationName:r,variables:h};return o.includeExtensions&&(u.extensions=c),o.includeQuery&&(u.query=(0,l.S)(d)),{options:s,body:u}}(e,c,b,E),M=T.options,_=T.body;if(_.variables&&!v){var x=new Set(Object.keys(_.variables));(0,h.Vn)(e.query,{Variable:function(e,t,i){i&&"VariableDefinition"!==i.kind&&x.delete(e.name.value)}}),x.size&&(_.variables=(0,a.pi)({},_.variables),x.forEach((function(e){delete _.variables[e]})))}if(!M.signal){var A=function(){if("undefined"==typeof AbortController)return{controller:!1,signal:!1};var e=new AbortController;return{controller:e,signal:e.signal}}(),O=A.controller,P=A.signal;(w=O)&&(M.signal=P)}if(g&&!e.query.definitions.some((function(e){return"OperationDefinition"===e.kind&&"mutation"===e.operation}))&&(M.method="GET"),"GET"===M.method){var C=function(e,t){var i=[],n=function(e,t){i.push(e+"="+encodeURIComponent(t))};if("query"in t&&n("query",t.query),t.operationName&&n("operationName",t.operationName),t.variables){var s=void 0;try{s=r(t.variables)}catch(e){return{parseError:e}}n("variables",s)}if(t.extensions){var o=void 0;try{o=r(t.extensions)}catch(e){return{parseError:e}}n("extensions",o)}var a="",l=e,c=e.indexOf("#");-1!==c&&(a=e.substr(c),l=e.substr(0,c));var h=-1===l.indexOf("?")?"?":"&";return{newURI:l+h+i.join("&")+a}}(t,_),D=C.newURI,I=C.parseError;if(I)return(0,n.Qc)(I);t=D}else try{M.body=r(_)}catch(I){return(0,n.Qc)(I)}return new u.y$((function(i){var o;return p(t,M).then((function(t){return e.setContext({response:t}),t})).then((o=e,function(e){return e.text().then((function(t){try{return JSON.parse(t)}catch(n){var i=n;throw i.name="ServerParseError",i.response=e,i.statusCode=e.status,i.bodyText=t,i}})).then((function(t){return e.status>=300&&(0,n.PW)(e,t,"Response not successful: Received status code "+e.status),Array.isArray(t)||s.call(t,"data")||s.call(t,"errors")||(0,n.PW)(e,t,"Server response was missing for query '"+(Array.isArray(o)?o.map((function(e){return e.operationName})):o.operationName)+"'."),t}))})).then((function(e){return i.next(e),i.complete(),e})).catch((function(e){"AbortError"!==e.name&&(e.result&&e.result.errors&&e.result.data&&i.next(e.result),i.error(e))})),function(){w&&w.abort()}}))}))},m=function(e){function t(t){void 0===t&&(t={});var i=e.call(this,p(t).request)||this;return i.options=t,i}return(0,a.ZT)(t,e),t}(d.i0)},84913:(e,t,i)=>{"use strict";i.d(t,{zi:()=>c,Qc:()=>s,PW:()=>r,DQ:()=>h,Ak:()=>a});var n=i(80496);function s(e){return new n.y$((function(t){t.error(e)}))}var o=i(92924);var r=function(e,t,i){var n=new Error(i);throw n.name="ServerError",n.response=e,n.statusCode=e.status,n.result=t,n};function a(e){for(var t=["query","operationName","variables","extensions","context"],i=0,n=Object.keys(e);i<n.length;i++){var s=n[i];if(t.indexOf(s)<0)throw new o.ej(26)}return e}var l=i(70655);function c(e,t){var i=(0,l.pi)({},e);return Object.defineProperty(t,"setContext",{enumerable:!1,value:function(e){i="function"==typeof e?(0,l.pi)((0,l.pi)({},i),e(i)):(0,l.pi)((0,l.pi)({},i),e)}}),Object.defineProperty(t,"getContext",{enumerable:!1,value:function(){return(0,l.pi)({},i)}}),t}function h(e){var t={variables:e.variables||{},extensions:e.extensions||{},operationName:e.operationName,query:e.query};return t.operationName||(t.operationName="string"!=typeof t.query?(0,n.rY)(t.query)||void 0:""),t}},91466:(e,t,i)=>{"use strict";i.d(t,{ZP:()=>ee});var n=i(70655);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}"function"==typeof Symbol&&null!=Symbol.iterator&&Symbol.iterator,"function"==typeof Symbol&&null!=Symbol.asyncIterator&&Symbol.asyncIterator;var o="function"==typeof Symbol&&null!=Symbol.toStringTag?Symbol.toStringTag:"@@toStringTag";function r(e,t){for(var i,n=/\r\n|[\n\r]/g,s=1,o=t+1;(i=n.exec(e.body))&&i.index<t;)s+=1,o=t+1-(i.index+i[0].length);return{line:s,column:o}}function a(e){return l(e.source,r(e.source,e.start))}function l(e,t){var i=e.locationOffset.column-1,n=h(i)+e.body,s=t.line-1,o=e.locationOffset.line-1,r=t.line+o,a=1===t.line?i:0,l=t.column+a,d="".concat(e.name,":").concat(r,":").concat(l,"\n"),u=n.split(/\r\n|[\n\r]/g),p=u[s];if(p.length>120){for(var m=Math.floor(l/80),g=l%80,f=[],v=0;v<p.length;v+=80)f.push(p.slice(v,v+80));return d+c([["".concat(r),f[0]]].concat(f.slice(1,m+1).map((function(e){return["",e]})),[[" ",h(g-1)+"^"],["",f[m+1]]]))}return d+c([["".concat(r-1),u[s-1]],["".concat(r),p],["",h(l-1)+"^"],["".concat(r+1),u[s+1]]])}function c(e){var t=e.filter((function(e){e[0];return void 0!==e[1]})),i=Math.max.apply(Math,t.map((function(e){return e[0].length})));return t.map((function(e){var t,n=e[0],s=e[1];return h(i-(t=n).length)+t+(s?" | "+s:" |")})).join("\n")}function h(e){return Array(e+1).join(" ")}function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function p(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?m(e):t}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(e){var t="function"==typeof Map?new Map:void 0;return(g=function(e){if(null===e||(i=e,-1===Function.toString.call(i).indexOf("[native code]")))return e;var i;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return f(e,arguments,b(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),y(n,e)})(e)}function f(e,t,i){return(f=v()?Reflect.construct:function(e,t,i){var n=[null];n.push.apply(n,t);var s=new(Function.bind.apply(e,n));return i&&y(s,i.prototype),s}).apply(null,arguments)}function v(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var w=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(g,e);var t,i,n,c,h,d=(t=g,i=v(),function(){var e,n=b(t);if(i){var s=b(this).constructor;e=Reflect.construct(n,arguments,s)}else e=n.apply(this,arguments);return p(this,e)});function g(e,t,i,n,o,a,l){var c,h,u,f,v;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,g),v=d.call(this,e);var y,b=Array.isArray(t)?0!==t.length?t:void 0:t?[t]:void 0,w=i;!w&&b&&(w=null===(y=b[0].loc)||void 0===y?void 0:y.source);var S,E=n;!E&&b&&(E=b.reduce((function(e,t){return t.loc&&e.push(t.loc.start),e}),[])),E&&0===E.length&&(E=void 0),n&&i?S=n.map((function(e){return r(i,e)})):b&&(S=b.reduce((function(e,t){return t.loc&&e.push(r(t.loc.source,t.loc.start)),e}),[]));var T,M=l;if(null==M&&null!=a){var _=a.extensions;"object"==s(T=_)&&null!==T&&(M=_)}return Object.defineProperties(m(v),{name:{value:"GraphQLError"},message:{value:e,enumerable:!0,writable:!0},locations:{value:null!==(c=S)&&void 0!==c?c:void 0,enumerable:null!=S},path:{value:null!=o?o:void 0,enumerable:null!=o},nodes:{value:null!=b?b:void 0},source:{value:null!==(h=w)&&void 0!==h?h:void 0},positions:{value:null!==(u=E)&&void 0!==u?u:void 0},originalError:{value:a},extensions:{value:null!==(f=M)&&void 0!==f?f:void 0,enumerable:null!=M}}),null!=a&&a.stack?(Object.defineProperty(m(v),"stack",{value:a.stack,writable:!0,configurable:!0}),p(v)):(Error.captureStackTrace?Error.captureStackTrace(m(v),g):Object.defineProperty(m(v),"stack",{value:Error().stack,writable:!0,configurable:!0}),v)}return n=g,(c=[{key:"toString",value:function(){return function(e){var t=e.message;if(e.nodes)for(var i=0,n=e.nodes;i<n.length;i++){var s=n[i];s.loc&&(t+="\n\n"+a(s.loc))}else if(e.source&&e.locations)for(var o=0,r=e.locations;o<r.length;o++){var c=r[o];t+="\n\n"+l(e.source,c)}return t}(this)}},{key:o,get:function(){return"Object"}}])&&u(n.prototype,c),h&&u(n,h),g}(g(Error));function S(e,t,i){return new w("Syntax Error: ".concat(i),void 0,e,[t])}var E=Object.freeze({NAME:"Name",DOCUMENT:"Document",OPERATION_DEFINITION:"OperationDefinition",VARIABLE_DEFINITION:"VariableDefinition",SELECTION_SET:"SelectionSet",FIELD:"Field",ARGUMENT:"Argument",FRAGMENT_SPREAD:"FragmentSpread",INLINE_FRAGMENT:"InlineFragment",FRAGMENT_DEFINITION:"FragmentDefinition",VARIABLE:"Variable",INT:"IntValue",FLOAT:"FloatValue",STRING:"StringValue",BOOLEAN:"BooleanValue",NULL:"NullValue",ENUM:"EnumValue",LIST:"ListValue",OBJECT:"ObjectValue",OBJECT_FIELD:"ObjectField",DIRECTIVE:"Directive",NAMED_TYPE:"NamedType",LIST_TYPE:"ListType",NON_NULL_TYPE:"NonNullType",SCHEMA_DEFINITION:"SchemaDefinition",OPERATION_TYPE_DEFINITION:"OperationTypeDefinition",SCALAR_TYPE_DEFINITION:"ScalarTypeDefinition",OBJECT_TYPE_DEFINITION:"ObjectTypeDefinition",FIELD_DEFINITION:"FieldDefinition",INPUT_VALUE_DEFINITION:"InputValueDefinition",INTERFACE_TYPE_DEFINITION:"InterfaceTypeDefinition",UNION_TYPE_DEFINITION:"UnionTypeDefinition",ENUM_TYPE_DEFINITION:"EnumTypeDefinition",ENUM_VALUE_DEFINITION:"EnumValueDefinition",INPUT_OBJECT_TYPE_DEFINITION:"InputObjectTypeDefinition",DIRECTIVE_DEFINITION:"DirectiveDefinition",SCHEMA_EXTENSION:"SchemaExtension",SCALAR_TYPE_EXTENSION:"ScalarTypeExtension",OBJECT_TYPE_EXTENSION:"ObjectTypeExtension",INTERFACE_TYPE_EXTENSION:"InterfaceTypeExtension",UNION_TYPE_EXTENSION:"UnionTypeExtension",ENUM_TYPE_EXTENSION:"EnumTypeExtension",INPUT_OBJECT_TYPE_EXTENSION:"InputObjectTypeExtension"}),T=i(83059),M=Object.freeze({SOF:"<SOF>",EOF:"<EOF>",BANG:"!",DOLLAR:"$",AMP:"&",PAREN_L:"(",PAREN_R:")",SPREAD:"...",COLON:":",EQUALS:"=",AT:"@",BRACKET_L:"[",BRACKET_R:"]",BRACE_L:"{",PIPE:"|",BRACE_R:"}",NAME:"Name",INT:"Int",FLOAT:"Float",STRING:"String",BLOCK_STRING:"BlockString",COMMENT:"Comment"}),_=i(6589);function x(e,t){if(!Boolean(e))throw new Error(t)}const A=function(e,t){return e instanceof t};function O(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var P=function(){function e(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GraphQL request",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{line:1,column:1};"string"==typeof e||x(0,"Body must be a string. Received: ".concat((0,_.Z)(e),".")),this.body=e,this.name=t,this.locationOffset=i,this.locationOffset.line>0||x(0,"line in locationOffset is 1-indexed and must be positive."),this.locationOffset.column>0||x(0,"column in locationOffset is 1-indexed and must be positive.")}var t,i,n;return t=e,(i=[{key:o,get:function(){return"Source"}}])&&O(t.prototype,i),n&&O(t,n),e}();var C=Object.freeze({QUERY:"QUERY",MUTATION:"MUTATION",SUBSCRIPTION:"SUBSCRIPTION",FIELD:"FIELD",FRAGMENT_DEFINITION:"FRAGMENT_DEFINITION",FRAGMENT_SPREAD:"FRAGMENT_SPREAD",INLINE_FRAGMENT:"INLINE_FRAGMENT",VARIABLE_DEFINITION:"VARIABLE_DEFINITION",SCHEMA:"SCHEMA",SCALAR:"SCALAR",OBJECT:"OBJECT",FIELD_DEFINITION:"FIELD_DEFINITION",ARGUMENT_DEFINITION:"ARGUMENT_DEFINITION",INTERFACE:"INTERFACE",UNION:"UNION",ENUM:"ENUM",ENUM_VALUE:"ENUM_VALUE",INPUT_OBJECT:"INPUT_OBJECT",INPUT_FIELD_DEFINITION:"INPUT_FIELD_DEFINITION"}),D=i(7420),I=function(){function e(e){var t=new T.WU(M.SOF,0,0,0,0,null);this.source=e,this.lastToken=t,this.token=t,this.line=1,this.lineStart=0}var t=e.prototype;return t.advance=function(){return this.lastToken=this.token,this.token=this.lookahead()},t.lookahead=function(){var e=this.token;if(e.kind!==M.EOF)do{var t;e=null!==(t=e.next)&&void 0!==t?t:e.next=L(this,e)}while(e.kind===M.COMMENT);return e},e}();function R(e){return isNaN(e)?M.EOF:e<127?JSON.stringify(String.fromCharCode(e)):'"\\u'.concat(("00"+e.toString(16).toUpperCase()).slice(-4),'"')}function L(e,t){for(var i=e.source,n=i.body,s=n.length,o=t.end;o<s;){var r=n.charCodeAt(o),a=e.line,l=1+o-e.lineStart;switch(r){case 65279:case 9:case 32:case 44:++o;continue;case 10:++o,++e.line,e.lineStart=o;continue;case 13:10===n.charCodeAt(o+1)?o+=2:++o,++e.line,e.lineStart=o;continue;case 33:return new T.WU(M.BANG,o,o+1,a,l,t);case 35:return k(i,o,a,l,t);case 36:return new T.WU(M.DOLLAR,o,o+1,a,l,t);case 38:return new T.WU(M.AMP,o,o+1,a,l,t);case 40:return new T.WU(M.PAREN_L,o,o+1,a,l,t);case 41:return new T.WU(M.PAREN_R,o,o+1,a,l,t);case 46:if(46===n.charCodeAt(o+1)&&46===n.charCodeAt(o+2))return new T.WU(M.SPREAD,o,o+3,a,l,t);break;case 58:return new T.WU(M.COLON,o,o+1,a,l,t);case 61:return new T.WU(M.EQUALS,o,o+1,a,l,t);case 64:return new T.WU(M.AT,o,o+1,a,l,t);case 91:return new T.WU(M.BRACKET_L,o,o+1,a,l,t);case 93:return new T.WU(M.BRACKET_R,o,o+1,a,l,t);case 123:return new T.WU(M.BRACE_L,o,o+1,a,l,t);case 124:return new T.WU(M.PIPE,o,o+1,a,l,t);case 125:return new T.WU(M.BRACE_R,o,o+1,a,l,t);case 34:return 34===n.charCodeAt(o+1)&&34===n.charCodeAt(o+2)?V(i,o,a,l,t,e):U(i,o,a,l,t);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return B(i,o,r,a,l,t);case 65:case 66:case 67:case 68:case 69:case 70:case 71:case 72:case 73:case 74:case 75:case 76:case 77:case 78:case 79:case 80:case 81:case 82:case 83:case 84:case 85:case 86:case 87:case 88:case 89:case 90:case 95:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 106:case 107:case 108:case 109:case 110:case 111:case 112:case 113:case 114:case 115:case 116:case 117:case 118:case 119:case 120:case 121:case 122:return G(i,o,a,l,t)}throw S(i,o,N(r))}var c=e.line,h=1+o-e.lineStart;return new T.WU(M.EOF,s,s,c,h,t)}function N(e){return e<32&&9!==e&&10!==e&&13!==e?"Cannot contain the invalid character ".concat(R(e),"."):39===e?"Unexpected single quote character ('), did you mean to use a double quote (\")?":"Cannot parse the unexpected character ".concat(R(e),".")}function k(e,t,i,n,s){var o,r=e.body,a=t;do{o=r.charCodeAt(++a)}while(!isNaN(o)&&(o>31||9===o));return new T.WU(M.COMMENT,t,a,i,n,s,r.slice(t+1,a))}function B(e,t,i,n,s,o){var r=e.body,a=i,l=t,c=!1;if(45===a&&(a=r.charCodeAt(++l)),48===a){if((a=r.charCodeAt(++l))>=48&&a<=57)throw S(e,l,"Invalid number, unexpected digit after 0: ".concat(R(a),"."))}else l=F(e,l,a),a=r.charCodeAt(l);if(46===a&&(c=!0,a=r.charCodeAt(++l),l=F(e,l,a),a=r.charCodeAt(l)),69!==a&&101!==a||(c=!0,43!==(a=r.charCodeAt(++l))&&45!==a||(a=r.charCodeAt(++l)),l=F(e,l,a),a=r.charCodeAt(l)),46===a||function(e){return 95===e||e>=65&&e<=90||e>=97&&e<=122}(a))throw S(e,l,"Invalid number, expected digit but got: ".concat(R(a),"."));return new T.WU(c?M.FLOAT:M.INT,t,l,n,s,o,r.slice(t,l))}function F(e,t,i){var n=e.body,s=t,o=i;if(o>=48&&o<=57){do{o=n.charCodeAt(++s)}while(o>=48&&o<=57);return s}throw S(e,s,"Invalid number, expected digit but got: ".concat(R(o),"."))}function U(e,t,i,n,s){for(var o,r,a,l,c=e.body,h=t+1,d=h,u=0,p="";h<c.length&&!isNaN(u=c.charCodeAt(h))&&10!==u&&13!==u;){if(34===u)return p+=c.slice(d,h),new T.WU(M.STRING,t,h+1,i,n,s,p);if(u<32&&9!==u)throw S(e,h,"Invalid character within String: ".concat(R(u),"."));if(++h,92===u){switch(p+=c.slice(d,h-1),u=c.charCodeAt(h)){case 34:p+='"';break;case 47:p+="/";break;case 92:p+="\\";break;case 98:p+="\b";break;case 102:p+="\f";break;case 110:p+="\n";break;case 114:p+="\r";break;case 116:p+="\t";break;case 117:var m=(o=c.charCodeAt(h+1),r=c.charCodeAt(h+2),a=c.charCodeAt(h+3),l=c.charCodeAt(h+4),H(o)<<12|H(r)<<8|H(a)<<4|H(l));if(m<0){var g=c.slice(h+1,h+5);throw S(e,h,"Invalid character escape sequence: \\u".concat(g,"."))}p+=String.fromCharCode(m),h+=4;break;default:throw S(e,h,"Invalid character escape sequence: \\".concat(String.fromCharCode(u),"."))}d=++h}}throw S(e,h,"Unterminated string.")}function V(e,t,i,n,s,o){for(var r=e.body,a=t+3,l=a,c=0,h="";a<r.length&&!isNaN(c=r.charCodeAt(a));){if(34===c&&34===r.charCodeAt(a+1)&&34===r.charCodeAt(a+2))return h+=r.slice(l,a),new T.WU(M.BLOCK_STRING,t,a+3,i,n,s,(0,D.W7)(h));if(c<32&&9!==c&&10!==c&&13!==c)throw S(e,a,"Invalid character within String: ".concat(R(c),"."));10===c?(++a,++o.line,o.lineStart=a):13===c?(10===r.charCodeAt(a+1)?a+=2:++a,++o.line,o.lineStart=a):92===c&&34===r.charCodeAt(a+1)&&34===r.charCodeAt(a+2)&&34===r.charCodeAt(a+3)?(h+=r.slice(l,a)+'"""',l=a+=4):++a}throw S(e,a,"Unterminated string.")}function H(e){return e>=48&&e<=57?e-48:e>=65&&e<=70?e-55:e>=97&&e<=102?e-87:-1}function G(e,t,i,n,s){for(var o=e.body,r=o.length,a=t+1,l=0;a!==r&&!isNaN(l=o.charCodeAt(a))&&(95===l||l>=48&&l<=57||l>=65&&l<=90||l>=97&&l<=122);)++a;return new T.WU(M.NAME,t,a,i,n,s,o.slice(t,a))}var z=function(){function e(e,t){var i=function(e){return A(e,P)}(e)?e:new P(e);this._lexer=new I(i),this._options=t}var t=e.prototype;return t.parseName=function(){var e=this.expectToken(M.NAME);return{kind:E.NAME,value:e.value,loc:this.loc(e)}},t.parseDocument=function(){var e=this._lexer.token;return{kind:E.DOCUMENT,definitions:this.many(M.SOF,this.parseDefinition,M.EOF),loc:this.loc(e)}},t.parseDefinition=function(){if(this.peek(M.NAME))switch(this._lexer.token.value){case"query":case"mutation":case"subscription":return this.parseOperationDefinition();case"fragment":return this.parseFragmentDefinition();case"schema":case"scalar":case"type":case"interface":case"union":case"enum":case"input":case"directive":return this.parseTypeSystemDefinition();case"extend":return this.parseTypeSystemExtension()}else{if(this.peek(M.BRACE_L))return this.parseOperationDefinition();if(this.peekDescription())return this.parseTypeSystemDefinition()}throw this.unexpected()},t.parseOperationDefinition=function(){var e=this._lexer.token;if(this.peek(M.BRACE_L))return{kind:E.OPERATION_DEFINITION,operation:"query",name:void 0,variableDefinitions:[],directives:[],selectionSet:this.parseSelectionSet(),loc:this.loc(e)};var t,i=this.parseOperationType();return this.peek(M.NAME)&&(t=this.parseName()),{kind:E.OPERATION_DEFINITION,operation:i,name:t,variableDefinitions:this.parseVariableDefinitions(),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet(),loc:this.loc(e)}},t.parseOperationType=function(){var e=this.expectToken(M.NAME);switch(e.value){case"query":return"query";case"mutation":return"mutation";case"subscription":return"subscription"}throw this.unexpected(e)},t.parseVariableDefinitions=function(){return this.optionalMany(M.PAREN_L,this.parseVariableDefinition,M.PAREN_R)},t.parseVariableDefinition=function(){var e=this._lexer.token;return{kind:E.VARIABLE_DEFINITION,variable:this.parseVariable(),type:(this.expectToken(M.COLON),this.parseTypeReference()),defaultValue:this.expectOptionalToken(M.EQUALS)?this.parseValueLiteral(!0):void 0,directives:this.parseDirectives(!0),loc:this.loc(e)}},t.parseVariable=function(){var e=this._lexer.token;return this.expectToken(M.DOLLAR),{kind:E.VARIABLE,name:this.parseName(),loc:this.loc(e)}},t.parseSelectionSet=function(){var e=this._lexer.token;return{kind:E.SELECTION_SET,selections:this.many(M.BRACE_L,this.parseSelection,M.BRACE_R),loc:this.loc(e)}},t.parseSelection=function(){return this.peek(M.SPREAD)?this.parseFragment():this.parseField()},t.parseField=function(){var e,t,i=this._lexer.token,n=this.parseName();return this.expectOptionalToken(M.COLON)?(e=n,t=this.parseName()):t=n,{kind:E.FIELD,alias:e,name:t,arguments:this.parseArguments(!1),directives:this.parseDirectives(!1),selectionSet:this.peek(M.BRACE_L)?this.parseSelectionSet():void 0,loc:this.loc(i)}},t.parseArguments=function(e){var t=e?this.parseConstArgument:this.parseArgument;return this.optionalMany(M.PAREN_L,t,M.PAREN_R)},t.parseArgument=function(){var e=this._lexer.token,t=this.parseName();return this.expectToken(M.COLON),{kind:E.ARGUMENT,name:t,value:this.parseValueLiteral(!1),loc:this.loc(e)}},t.parseConstArgument=function(){var e=this._lexer.token;return{kind:E.ARGUMENT,name:this.parseName(),value:(this.expectToken(M.COLON),this.parseValueLiteral(!0)),loc:this.loc(e)}},t.parseFragment=function(){var e=this._lexer.token;this.expectToken(M.SPREAD);var t=this.expectOptionalKeyword("on");return!t&&this.peek(M.NAME)?{kind:E.FRAGMENT_SPREAD,name:this.parseFragmentName(),directives:this.parseDirectives(!1),loc:this.loc(e)}:{kind:E.INLINE_FRAGMENT,typeCondition:t?this.parseNamedType():void 0,directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet(),loc:this.loc(e)}},t.parseFragmentDefinition=function(){var e,t=this._lexer.token;return this.expectKeyword("fragment"),!0===(null===(e=this._options)||void 0===e?void 0:e.experimentalFragmentVariables)?{kind:E.FRAGMENT_DEFINITION,name:this.parseFragmentName(),variableDefinitions:this.parseVariableDefinitions(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet(),loc:this.loc(t)}:{kind:E.FRAGMENT_DEFINITION,name:this.parseFragmentName(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet(),loc:this.loc(t)}},t.parseFragmentName=function(){if("on"===this._lexer.token.value)throw this.unexpected();return this.parseName()},t.parseValueLiteral=function(e){var t=this._lexer.token;switch(t.kind){case M.BRACKET_L:return this.parseList(e);case M.BRACE_L:return this.parseObject(e);case M.INT:return this._lexer.advance(),{kind:E.INT,value:t.value,loc:this.loc(t)};case M.FLOAT:return this._lexer.advance(),{kind:E.FLOAT,value:t.value,loc:this.loc(t)};case M.STRING:case M.BLOCK_STRING:return this.parseStringLiteral();case M.NAME:switch(this._lexer.advance(),t.value){case"true":return{kind:E.BOOLEAN,value:!0,loc:this.loc(t)};case"false":return{kind:E.BOOLEAN,value:!1,loc:this.loc(t)};case"null":return{kind:E.NULL,loc:this.loc(t)};default:return{kind:E.ENUM,value:t.value,loc:this.loc(t)}}case M.DOLLAR:if(!e)return this.parseVariable()}throw this.unexpected()},t.parseStringLiteral=function(){var e=this._lexer.token;return this._lexer.advance(),{kind:E.STRING,value:e.value,block:e.kind===M.BLOCK_STRING,loc:this.loc(e)}},t.parseList=function(e){var t=this,i=this._lexer.token;return{kind:E.LIST,values:this.any(M.BRACKET_L,(function(){return t.parseValueLiteral(e)}),M.BRACKET_R),loc:this.loc(i)}},t.parseObject=function(e){var t=this,i=this._lexer.token;return{kind:E.OBJECT,fields:this.any(M.BRACE_L,(function(){return t.parseObjectField(e)}),M.BRACE_R),loc:this.loc(i)}},t.parseObjectField=function(e){var t=this._lexer.token,i=this.parseName();return this.expectToken(M.COLON),{kind:E.OBJECT_FIELD,name:i,value:this.parseValueLiteral(e),loc:this.loc(t)}},t.parseDirectives=function(e){for(var t=[];this.peek(M.AT);)t.push(this.parseDirective(e));return t},t.parseDirective=function(e){var t=this._lexer.token;return this.expectToken(M.AT),{kind:E.DIRECTIVE,name:this.parseName(),arguments:this.parseArguments(e),loc:this.loc(t)}},t.parseTypeReference=function(){var e,t=this._lexer.token;return this.expectOptionalToken(M.BRACKET_L)?(e=this.parseTypeReference(),this.expectToken(M.BRACKET_R),e={kind:E.LIST_TYPE,type:e,loc:this.loc(t)}):e=this.parseNamedType(),this.expectOptionalToken(M.BANG)?{kind:E.NON_NULL_TYPE,type:e,loc:this.loc(t)}:e},t.parseNamedType=function(){var e=this._lexer.token;return{kind:E.NAMED_TYPE,name:this.parseName(),loc:this.loc(e)}},t.parseTypeSystemDefinition=function(){var e=this.peekDescription()?this._lexer.lookahead():this._lexer.token;if(e.kind===M.NAME)switch(e.value){case"schema":return this.parseSchemaDefinition();case"scalar":return this.parseScalarTypeDefinition();case"type":return this.parseObjectTypeDefinition();case"interface":return this.parseInterfaceTypeDefinition();case"union":return this.parseUnionTypeDefinition();case"enum":return this.parseEnumTypeDefinition();case"input":return this.parseInputObjectTypeDefinition();case"directive":return this.parseDirectiveDefinition()}throw this.unexpected(e)},t.peekDescription=function(){return this.peek(M.STRING)||this.peek(M.BLOCK_STRING)},t.parseDescription=function(){if(this.peekDescription())return this.parseStringLiteral()},t.parseSchemaDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("schema");var i=this.parseDirectives(!0),n=this.many(M.BRACE_L,this.parseOperationTypeDefinition,M.BRACE_R);return{kind:E.SCHEMA_DEFINITION,description:t,directives:i,operationTypes:n,loc:this.loc(e)}},t.parseOperationTypeDefinition=function(){var e=this._lexer.token,t=this.parseOperationType();this.expectToken(M.COLON);var i=this.parseNamedType();return{kind:E.OPERATION_TYPE_DEFINITION,operation:t,type:i,loc:this.loc(e)}},t.parseScalarTypeDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("scalar");var i=this.parseName(),n=this.parseDirectives(!0);return{kind:E.SCALAR_TYPE_DEFINITION,description:t,name:i,directives:n,loc:this.loc(e)}},t.parseObjectTypeDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("type");var i=this.parseName(),n=this.parseImplementsInterfaces(),s=this.parseDirectives(!0),o=this.parseFieldsDefinition();return{kind:E.OBJECT_TYPE_DEFINITION,description:t,name:i,interfaces:n,directives:s,fields:o,loc:this.loc(e)}},t.parseImplementsInterfaces=function(){var e;if(!this.expectOptionalKeyword("implements"))return[];if(!0===(null===(e=this._options)||void 0===e?void 0:e.allowLegacySDLImplementsInterfaces)){var t=[];this.expectOptionalToken(M.AMP);do{t.push(this.parseNamedType())}while(this.expectOptionalToken(M.AMP)||this.peek(M.NAME));return t}return this.delimitedMany(M.AMP,this.parseNamedType)},t.parseFieldsDefinition=function(){var e;return!0===(null===(e=this._options)||void 0===e?void 0:e.allowLegacySDLEmptyFields)&&this.peek(M.BRACE_L)&&this._lexer.lookahead().kind===M.BRACE_R?(this._lexer.advance(),this._lexer.advance(),[]):this.optionalMany(M.BRACE_L,this.parseFieldDefinition,M.BRACE_R)},t.parseFieldDefinition=function(){var e=this._lexer.token,t=this.parseDescription(),i=this.parseName(),n=this.parseArgumentDefs();this.expectToken(M.COLON);var s=this.parseTypeReference(),o=this.parseDirectives(!0);return{kind:E.FIELD_DEFINITION,description:t,name:i,arguments:n,type:s,directives:o,loc:this.loc(e)}},t.parseArgumentDefs=function(){return this.optionalMany(M.PAREN_L,this.parseInputValueDef,M.PAREN_R)},t.parseInputValueDef=function(){var e=this._lexer.token,t=this.parseDescription(),i=this.parseName();this.expectToken(M.COLON);var n,s=this.parseTypeReference();this.expectOptionalToken(M.EQUALS)&&(n=this.parseValueLiteral(!0));var o=this.parseDirectives(!0);return{kind:E.INPUT_VALUE_DEFINITION,description:t,name:i,type:s,defaultValue:n,directives:o,loc:this.loc(e)}},t.parseInterfaceTypeDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("interface");var i=this.parseName(),n=this.parseImplementsInterfaces(),s=this.parseDirectives(!0),o=this.parseFieldsDefinition();return{kind:E.INTERFACE_TYPE_DEFINITION,description:t,name:i,interfaces:n,directives:s,fields:o,loc:this.loc(e)}},t.parseUnionTypeDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("union");var i=this.parseName(),n=this.parseDirectives(!0),s=this.parseUnionMemberTypes();return{kind:E.UNION_TYPE_DEFINITION,description:t,name:i,directives:n,types:s,loc:this.loc(e)}},t.parseUnionMemberTypes=function(){return this.expectOptionalToken(M.EQUALS)?this.delimitedMany(M.PIPE,this.parseNamedType):[]},t.parseEnumTypeDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("enum");var i=this.parseName(),n=this.parseDirectives(!0),s=this.parseEnumValuesDefinition();return{kind:E.ENUM_TYPE_DEFINITION,description:t,name:i,directives:n,values:s,loc:this.loc(e)}},t.parseEnumValuesDefinition=function(){return this.optionalMany(M.BRACE_L,this.parseEnumValueDefinition,M.BRACE_R)},t.parseEnumValueDefinition=function(){var e=this._lexer.token,t=this.parseDescription(),i=this.parseName(),n=this.parseDirectives(!0);return{kind:E.ENUM_VALUE_DEFINITION,description:t,name:i,directives:n,loc:this.loc(e)}},t.parseInputObjectTypeDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("input");var i=this.parseName(),n=this.parseDirectives(!0),s=this.parseInputFieldsDefinition();return{kind:E.INPUT_OBJECT_TYPE_DEFINITION,description:t,name:i,directives:n,fields:s,loc:this.loc(e)}},t.parseInputFieldsDefinition=function(){return this.optionalMany(M.BRACE_L,this.parseInputValueDef,M.BRACE_R)},t.parseTypeSystemExtension=function(){var e=this._lexer.lookahead();if(e.kind===M.NAME)switch(e.value){case"schema":return this.parseSchemaExtension();case"scalar":return this.parseScalarTypeExtension();case"type":return this.parseObjectTypeExtension();case"interface":return this.parseInterfaceTypeExtension();case"union":return this.parseUnionTypeExtension();case"enum":return this.parseEnumTypeExtension();case"input":return this.parseInputObjectTypeExtension()}throw this.unexpected(e)},t.parseSchemaExtension=function(){var e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("schema");var t=this.parseDirectives(!0),i=this.optionalMany(M.BRACE_L,this.parseOperationTypeDefinition,M.BRACE_R);if(0===t.length&&0===i.length)throw this.unexpected();return{kind:E.SCHEMA_EXTENSION,directives:t,operationTypes:i,loc:this.loc(e)}},t.parseScalarTypeExtension=function(){var e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("scalar");var t=this.parseName(),i=this.parseDirectives(!0);if(0===i.length)throw this.unexpected();return{kind:E.SCALAR_TYPE_EXTENSION,name:t,directives:i,loc:this.loc(e)}},t.parseObjectTypeExtension=function(){var e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("type");var t=this.parseName(),i=this.parseImplementsInterfaces(),n=this.parseDirectives(!0),s=this.parseFieldsDefinition();if(0===i.length&&0===n.length&&0===s.length)throw this.unexpected();return{kind:E.OBJECT_TYPE_EXTENSION,name:t,interfaces:i,directives:n,fields:s,loc:this.loc(e)}},t.parseInterfaceTypeExtension=function(){var e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("interface");var t=this.parseName(),i=this.parseImplementsInterfaces(),n=this.parseDirectives(!0),s=this.parseFieldsDefinition();if(0===i.length&&0===n.length&&0===s.length)throw this.unexpected();return{kind:E.INTERFACE_TYPE_EXTENSION,name:t,interfaces:i,directives:n,fields:s,loc:this.loc(e)}},t.parseUnionTypeExtension=function(){var e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("union");var t=this.parseName(),i=this.parseDirectives(!0),n=this.parseUnionMemberTypes();if(0===i.length&&0===n.length)throw this.unexpected();return{kind:E.UNION_TYPE_EXTENSION,name:t,directives:i,types:n,loc:this.loc(e)}},t.parseEnumTypeExtension=function(){var e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("enum");var t=this.parseName(),i=this.parseDirectives(!0),n=this.parseEnumValuesDefinition();if(0===i.length&&0===n.length)throw this.unexpected();return{kind:E.ENUM_TYPE_EXTENSION,name:t,directives:i,values:n,loc:this.loc(e)}},t.parseInputObjectTypeExtension=function(){var e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("input");var t=this.parseName(),i=this.parseDirectives(!0),n=this.parseInputFieldsDefinition();if(0===i.length&&0===n.length)throw this.unexpected();return{kind:E.INPUT_OBJECT_TYPE_EXTENSION,name:t,directives:i,fields:n,loc:this.loc(e)}},t.parseDirectiveDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("directive"),this.expectToken(M.AT);var i=this.parseName(),n=this.parseArgumentDefs(),s=this.expectOptionalKeyword("repeatable");this.expectKeyword("on");var o=this.parseDirectiveLocations();return{kind:E.DIRECTIVE_DEFINITION,description:t,name:i,arguments:n,repeatable:s,locations:o,loc:this.loc(e)}},t.parseDirectiveLocations=function(){return this.delimitedMany(M.PIPE,this.parseDirectiveLocation)},t.parseDirectiveLocation=function(){var e=this._lexer.token,t=this.parseName();if(void 0!==C[t.value])return t;throw this.unexpected(e)},t.loc=function(e){var t;if(!0!==(null===(t=this._options)||void 0===t?void 0:t.noLocation))return new T.Ye(e,this._lexer.lastToken,this._lexer.source)},t.peek=function(e){return this._lexer.token.kind===e},t.expectToken=function(e){var t=this._lexer.token;if(t.kind===e)return this._lexer.advance(),t;throw S(this._lexer.source,t.start,"Expected ".concat(W(e),", found ").concat(j(t),"."))},t.expectOptionalToken=function(e){var t=this._lexer.token;if(t.kind===e)return this._lexer.advance(),t},t.expectKeyword=function(e){var t=this._lexer.token;if(t.kind!==M.NAME||t.value!==e)throw S(this._lexer.source,t.start,'Expected "'.concat(e,'", found ').concat(j(t),"."));this._lexer.advance()},t.expectOptionalKeyword=function(e){var t=this._lexer.token;return t.kind===M.NAME&&t.value===e&&(this._lexer.advance(),!0)},t.unexpected=function(e){var t=null!=e?e:this._lexer.token;return S(this._lexer.source,t.start,"Unexpected ".concat(j(t),"."))},t.any=function(e,t,i){this.expectToken(e);for(var n=[];!this.expectOptionalToken(i);)n.push(t.call(this));return n},t.optionalMany=function(e,t,i){if(this.expectOptionalToken(e)){var n=[];do{n.push(t.call(this))}while(!this.expectOptionalToken(i));return n}return[]},t.many=function(e,t,i){this.expectToken(e);var n=[];do{n.push(t.call(this))}while(!this.expectOptionalToken(i));return n},t.delimitedMany=function(e,t){this.expectOptionalToken(e);var i=[];do{i.push(t.call(this))}while(this.expectOptionalToken(e));return i},e}();function j(e){var t=e.value;return W(e.kind)+(null!=t?' "'.concat(t,'"'):"")}function W(e){return function(e){return e===M.BANG||e===M.DOLLAR||e===M.AMP||e===M.PAREN_L||e===M.PAREN_R||e===M.SPREAD||e===M.COLON||e===M.EQUALS||e===M.AT||e===M.BRACKET_L||e===M.BRACKET_R||e===M.BRACE_L||e===M.PIPE||e===M.BRACE_R}(e)?'"'.concat(e,'"'):e}var Z=new Map,q=new Map,K=!0,Y=!1;function $(e){return e.replace(/[\s,]+/g," ").trim()}function X(e){var t=new Set,i=[];return e.definitions.forEach((function(e){if("FragmentDefinition"===e.kind){var n=e.name.value,s=$((r=e.loc).source.body.substring(r.start,r.end)),o=q.get(n);o&&!o.has(s)?K&&console.warn("Warning: fragment with name "+n+" already exists.\ngraphql-tag enforces all fragment names across your application to be unique; read more about\nthis in the docs: http://dev.apollodata.com/core/fragments.html#unique-names"):o||q.set(n,o=new Set),o.add(s),t.has(s)||(t.add(s),i.push(e))}else i.push(e);var r})),(0,n.pi)((0,n.pi)({},e),{definitions:i})}function Q(e){var t=$(e);if(!Z.has(t)){var i=function(e,t){return new z(e,t).parseDocument()}(e,{experimentalFragmentVariables:Y});if(!i||"Document"!==i.kind)throw new Error("Not a valid GraphQL document.");Z.set(t,function(e){var t=new Set(e.definitions);t.forEach((function(e){e.loc&&delete e.loc,Object.keys(e).forEach((function(i){var n=e[i];n&&"object"==typeof n&&t.add(n)}))}));var i=e.loc;return i&&(delete i.startToken,delete i.endToken),e}(X(i)))}return Z.get(t)}function J(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];"string"==typeof e&&(e=[e]);var n=e[0];return t.forEach((function(t,i){t&&"Document"===t.kind?n+=t.loc.source.body:n+=t,n+=e[i+1]})),Q(n)}const ee=Object.assign(J,{gql:J,default:J,resetCaches:function(){Z.clear(),q.clear()},disableFragmentWarnings:function(){K=!1},enableExperimentalFragmentVariables:function(){Y=!0},disableExperimentalFragmentVariables:function(){Y=!1}})},80496:(e,t,i)=>{"use strict";i.d(t,{X_:()=>re,w0:()=>Y,y$:()=>X(),Gw:()=>F,NC:()=>w,sz:()=>ne,aL:()=>G,mr:()=>ce,Xh:()=>J,oA:()=>he,F:()=>h,Dy:()=>se,O4:()=>D,kU:()=>O,hi:()=>d,Yk:()=>c,p$:()=>C,$H:()=>x,rY:()=>A,iW:()=>P,PT:()=>b,qw:()=>E,d2:()=>le,mj:()=>a,FS:()=>r,My:()=>T,Ao:()=>M,Of:()=>ae,hh:()=>g,pM:()=>ie,kQ:()=>m,Jv:()=>te,Ee:()=>W,bw:()=>Z,ob:()=>z,Fo:()=>V,u2:()=>S,LZ:()=>o,vf:()=>v});var n=i(27636),s=i(92924);function o(e,t){var i=e.directives;return!i||!i.length||function(e){var t=[];e&&e.length&&e.forEach((function(e){if(function(e){var t=e.name.value;return"skip"===t||"include"===t}(e)){var i=e.arguments;e.name.value;(0,s.kG)(i&&1===i.length,39);var n=i[0];(0,s.kG)(n.name&&"if"===n.name.value,40);var o=n.value;(0,s.kG)(o&&("Variable"===o.kind||"BooleanValue"===o.kind),41),t.push({directive:e,ifArgument:n})}}));return t}(i).every((function(e){var i=e.directive,n=e.ifArgument,o=!1;return"Variable"===n.value.kind?(o=t&&t[n.value.name.value],(0,s.kG)(void 0!==o,38)):o=n.value.value,"skip"===i.name.value?!o:o}))}function r(e,t){return function(e){var t=[];return(0,n.Vn)(e,{Directive:function(e){t.push(e.name.value)}}),t}(t).some((function(t){return e.indexOf(t)>-1}))}function a(e){return e&&r(["client"],e)&&r(["export"],e)}var l=i(70655);function c(e,t){var i=t,n=[];return e.definitions.forEach((function(e){if("OperationDefinition"===e.kind)throw new s.ej(42);"FragmentDefinition"===e.kind&&n.push(e)})),void 0===i&&((0,s.kG)(1===n.length,43),i=n[0].name.value),(0,l.pi)((0,l.pi)({},e),{definitions:(0,l.pr)([{kind:"OperationDefinition",operation:"query",selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:i}}]}}],e.definitions)})}function h(e){void 0===e&&(e=[]);var t={};return e.forEach((function(e){t[e.name.value]=e})),t}function d(e,t){switch(e.kind){case"InlineFragment":return e;case"FragmentSpread":var i=t&&t[e.name.value];return(0,s.kG)(i,44),i;default:return null}}var u=i(35035),p=i.n(u);function m(e){return{__ref:String(e)}}function g(e){return Boolean(e&&"object"==typeof e&&"string"==typeof e.__ref)}function f(e,t,i,n){if(function(e){return"IntValue"===e.kind}(i)||function(e){return"FloatValue"===e.kind}(i))e[t.value]=Number(i.value);else if(function(e){return"BooleanValue"===e.kind}(i)||function(e){return"StringValue"===e.kind}(i))e[t.value]=i.value;else if(function(e){return"ObjectValue"===e.kind}(i)){var o={};i.fields.map((function(e){return f(o,e.name,e.value,n)})),e[t.value]=o}else if(function(e){return"Variable"===e.kind}(i)){var r=(n||{})[i.name.value];e[t.value]=r}else if(function(e){return"ListValue"===e.kind}(i))e[t.value]=i.values.map((function(e){var i={};return f(i,t,e,n),i[t.value]}));else if(function(e){return"EnumValue"===e.kind}(i))e[t.value]=i.value;else{if(!function(e){return"NullValue"===e.kind}(i))throw new s.ej(53);e[t.value]=null}}function v(e,t){var i=null;e.directives&&(i={},e.directives.forEach((function(e){i[e.name.value]={},e.arguments&&e.arguments.forEach((function(n){var s=n.name,o=n.value;return f(i[e.name.value],s,o,t)}))})));var n=null;return e.arguments&&e.arguments.length&&(n={},e.arguments.forEach((function(e){var i=e.name,s=e.value;return f(n,i,s,t)}))),b(e.name.value,n,i)}var y=["connection","include","skip","client","rest","export"];function b(e,t,i){if(t&&i&&i.connection&&i.connection.key){if(i.connection.filter&&i.connection.filter.length>0){var n=i.connection.filter?i.connection.filter:[];n.sort();var s={};return n.forEach((function(e){s[e]=t[e]})),i.connection.key+"("+JSON.stringify(s)+")"}return i.connection.key}var o=e;if(t){var r=p()(t);o+="("+r+")"}return i&&Object.keys(i).forEach((function(e){-1===y.indexOf(e)&&(i[e]&&Object.keys(i[e]).length?o+="@"+e+"("+JSON.stringify(i[e])+")":o+="@"+e)})),o}function w(e,t){if(e.arguments&&e.arguments.length){var i={};return e.arguments.forEach((function(e){var n=e.name,s=e.value;return f(i,n,s,t)})),i}return null}function S(e){return e.alias?e.alias.value:e.name.value}function E(e,t,i){if("string"==typeof e.__typename)return e.__typename;for(var n=0,s=t.selections;n<s.length;n++){var o=s[n];if(T(o)){if("__typename"===o.name.value)return e[S(o)]}else{var r=E(e,d(o,i).selectionSet,i);if("string"==typeof r)return r}}}function T(e){return"Field"===e.kind}function M(e){return"InlineFragment"===e.kind}function _(e){(0,s.kG)(e&&"Document"===e.kind,45);var t=e.definitions.filter((function(e){return"FragmentDefinition"!==e.kind})).map((function(e){if("OperationDefinition"!==e.kind)throw new s.ej(46);return e}));return(0,s.kG)(t.length<=1,47),e}function x(e){return _(e),e.definitions.filter((function(e){return"OperationDefinition"===e.kind}))[0]}function A(e){return e.definitions.filter((function(e){return"OperationDefinition"===e.kind&&e.name})).map((function(e){return e.name.value}))[0]||null}function O(e){return e.definitions.filter((function(e){return"FragmentDefinition"===e.kind}))}function P(e){var t=x(e);return(0,s.kG)(t&&"query"===t.operation,48),t}function C(e){var t;_(e);for(var i=0,n=e.definitions;i<n.length;i++){var o=n[i];if("OperationDefinition"===o.kind){var r=o.operation;if("query"===r||"mutation"===r||"subscription"===r)return o}"FragmentDefinition"!==o.kind||t||(t=o)}if(t)return t;throw new s.ej(52)}function D(e){var t=Object.create(null),i=e&&e.variableDefinitions;return i&&i.length&&i.forEach((function(e){e.defaultValue&&f(t,e.variable.name,e.defaultValue)})),t}function I(e,t,i){var n=0;return e.forEach((function(i,s){t.call(this,i,s,e)&&(e[n++]=i)}),i),e.length=n,e}var R={kind:"Field",name:{kind:"Name",value:"__typename"}};function L(e,t){return e.selectionSet.selections.every((function(e){return"FragmentSpread"===e.kind&&L(t[e.name.value],t)}))}function N(e){return L(x(e)||function(e){(0,s.kG)("Document"===e.kind,49),(0,s.kG)(e.definitions.length<=1,50);var t=e.definitions[0];return(0,s.kG)("FragmentDefinition"===t.kind,51),t}(e),h(O(e)))?null:e}function k(e){return function(t){return e.some((function(e){return e.name&&e.name===t.name.value||e.test&&e.test(t)}))}}function B(e,t){var i=Object.create(null),s=[],o=Object.create(null),r=[],a=N((0,n.Vn)(t,{Variable:{enter:function(e,t,n){"VariableDefinition"!==n.kind&&(i[e.name.value]=!0)}},Field:{enter:function(t){if(e&&t.directives&&(e.some((function(e){return e.remove}))&&t.directives&&t.directives.some(k(e))))return t.arguments&&t.arguments.forEach((function(e){"Variable"===e.value.kind&&s.push({name:e.value.name.value})})),t.selectionSet&&H(t.selectionSet).forEach((function(e){r.push({name:e.name.value})})),null}},FragmentSpread:{enter:function(e){o[e.name.value]=!0}},Directive:{enter:function(t){if(k(e)(t))return null}}}));return a&&I(s,(function(e){return!!e.name&&!i[e.name]})).length&&(a=function(e,t){var i=function(e){return function(t){return e.some((function(e){return t.value&&"Variable"===t.value.kind&&t.value.name&&(e.name===t.value.name.value||e.test&&e.test(t))}))}}(e);return N((0,n.Vn)(t,{OperationDefinition:{enter:function(t){return(0,l.pi)((0,l.pi)({},t),{variableDefinitions:t.variableDefinitions?t.variableDefinitions.filter((function(t){return!e.some((function(e){return e.name===t.variable.name.value}))})):[]})}},Field:{enter:function(t){if(e.some((function(e){return e.remove}))){var n=0;if(t.arguments&&t.arguments.forEach((function(e){i(e)&&(n+=1)})),1===n)return null}}},Argument:{enter:function(e){if(i(e))return null}}}))}(s,a)),a&&I(r,(function(e){return!!e.name&&!o[e.name]})).length&&(a=function(e,t){function i(t){if(e.some((function(e){return e.name===t.name.value})))return null}return N((0,n.Vn)(t,{FragmentSpread:{enter:i},FragmentDefinition:{enter:i}}))}(r,a)),a}function F(e){return(0,n.Vn)(_(e),{SelectionSet:{enter:function(e,t,i){if(!i||"OperationDefinition"!==i.kind){var n=e.selections;if(n)if(!n.some((function(e){return T(e)&&("__typename"===e.name.value||0===e.name.value.lastIndexOf("__",0))}))){var s=i;if(!(T(s)&&s.directives&&s.directives.some((function(e){return"export"===e.name.value}))))return(0,l.pi)((0,l.pi)({},e),{selections:(0,l.pr)(n,[R])})}}}}})}F.added=function(e){return e===R};var U={test:function(e){var t="connection"===e.name.value;return t&&(!e.arguments||e.arguments.some((function(e){return"key"===e.name.value}))),t}};function V(e){return B([U],_(e))}function H(e){var t=[];return e.selections.forEach((function(e){(T(e)||M(e))&&e.selectionSet?H(e.selectionSet).forEach((function(e){return t.push(e)})):"FragmentSpread"===e.kind&&t.push(e)})),t}function G(e){return"query"===C(e).operation?e:(0,n.Vn)(e,{OperationDefinition:{enter:function(e){return(0,l.pi)((0,l.pi)({},e),{operation:"query"})}}})}function z(e){_(e);var t=B([{test:function(e){return"client"===e.name.value},remove:!0}],e);return t&&(t=(0,n.Vn)(t,{FragmentDefinition:{enter:function(e){if(e.selectionSet&&e.selectionSet.selections.every((function(e){return T(e)&&"__typename"===e.name.value})))return null}}})),t}var j=Object.prototype.hasOwnProperty;function W(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Z(e)}function Z(e){var t=e[0]||{},i=e.length;if(i>1)for(var n=new Y,s=1;s<i;++s)t=n.merge(t,e[s]);return t}function q(e){return null!==e&&"object"==typeof e}var K=function(e,t,i){return this.merge(e[i],t[i])},Y=function(){function e(e){void 0===e&&(e=K),this.reconciler=e,this.isObject=q,this.pastCopies=new Set}return e.prototype.merge=function(e,t){for(var i=this,n=[],s=2;s<arguments.length;s++)n[s-2]=arguments[s];return q(t)&&q(e)?(Object.keys(t).forEach((function(s){if(j.call(e,s)){var o=e[s];if(t[s]!==o){var r=i.reconciler.apply(i,(0,l.pr)([e,t,s],n));r!==o&&((e=i.shallowCopyForMerge(e))[s]=r)}}else(e=i.shallowCopyForMerge(e))[s]=t[s]})),e):t},e.prototype.shallowCopyForMerge=function(e){return q(e)&&!this.pastCopies.has(e)&&(e=Array.isArray(e)?e.slice(0):(0,l.pi)({__proto__:Object.getPrototypeOf(e)},e),this.pastCopies.add(e)),e},e}();var $=i(49329),X=i.n($);i(67121);X().prototype["@@observable"]=function(){return this};var Q=Object.prototype.toString;function J(e){return ee(e)}function ee(e,t){switch(Q.call(e)){case"[object Array]":if((t=t||new Map).has(e))return t.get(e);var i=e.slice(0);return t.set(e,i),i.forEach((function(e,n){i[n]=ee(e,t)})),i;case"[object Object]":if((t=t||new Map).has(e))return t.get(e);var n=Object.create(Object.getPrototypeOf(e));return t.set(e,n),Object.keys(e).forEach((function(i){n[i]=ee(e[i],t)})),n;default:return e}}function te(e){return e}function ie(e,t,i){var n=[];e.forEach((function(e){return e[t]&&n.push(e)})),n.forEach((function(e){return e[t](i)}))}function ne(e,t,i){return new(X())((function(n){var s=n.next,o=n.error,r=n.complete,a=0,l=!1;function c(e,t){return e?function(t){++a,new Promise((function(i){return i(e(t))})).then((function(e){--a,s&&s.call(n,e),l&&h.complete()}),(function(e){--a,o&&o.call(n,e)}))}:function(e){return t&&t.call(n,e)}}var h={next:c(t,s),error:c(i,o),complete:function(){l=!0,a||r&&r.call(n)}},d=e.subscribe(h);return function(){return d.unsubscribe()}}))}function se(e){function t(t){Object.defineProperty(e,t,{value:X()})}return"function"==typeof Symbol&&Symbol.species&&t(Symbol.species),t("@@species"),e}function oe(e){return e&&"function"==typeof e.then}var re=function(e){function t(t){var i=e.call(this,(function(e){return i.addObserver(e),function(){return i.removeObserver(e)}}))||this;return i.observers=new Set,i.addCount=0,i.promise=new Promise((function(e,t){i.resolve=e,i.reject=t})),i.handlers={next:function(e){null!==i.sub&&(i.latest=["next",e],ie(i.observers,"next",e))},error:function(e){var t=i.sub;null!==t&&(t&&Promise.resolve().then((function(){return t.unsubscribe()})),i.sub=null,i.latest=["error",e],i.reject(e),ie(i.observers,"error",e))},complete:function(){if(null!==i.sub){var e=i.sources.shift();e?oe(e)?e.then((function(e){return i.sub=e.subscribe(i.handlers)})):i.sub=e.subscribe(i.handlers):(i.sub=null,i.latest&&"next"===i.latest[0]?i.resolve(i.latest[1]):i.resolve(),ie(i.observers,"complete"))}}},i.cancel=function(e){i.reject(e),i.sources=[],i.handlers.complete()},i.promise.catch((function(e){})),"function"==typeof t&&(t=[new(X())(t)]),oe(t)?t.then((function(e){return i.start(e)}),i.handlers.error):i.start(t),i}return(0,l.ZT)(t,e),t.prototype.start=function(e){void 0===this.sub&&(this.sources=Array.from(e),this.handlers.complete())},t.prototype.deliverLastMessage=function(e){if(this.latest){var t=this.latest[0],i=e[t];i&&i.call(e,this.latest[1]),null===this.sub&&"next"===t&&e.complete&&e.complete()}},t.prototype.addObserver=function(e){this.observers.has(e)||(this.deliverLastMessage(e),this.observers.add(e),++this.addCount)},t.prototype.removeObserver=function(e,t){this.observers.delete(e)&&--this.addCount<1&&!t&&this.handlers.error(new Error("Observable cancelled prematurely"))},t.prototype.cleanup=function(e){var t=this,i=!1,n=function(){i||(i=!0,t.observers.delete(s),e())},s={next:n,error:n,complete:n},o=this.addCount;this.addObserver(s),this.addCount=o},t}(X());function ae(e){return Array.isArray(e)&&e.length>0}function le(e){return e.errors&&e.errors.length>0||!1}se(re);var ce="function"==typeof WeakMap&&!("object"==typeof navigator&&"ReactNative"===navigator.product);function he(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=Object.create(null);return e.forEach((function(e){e&&Object.keys(e).forEach((function(t){var n=e[t];void 0!==n&&(i[t]=n)}))})),i}},81506:e=>{e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},34575:e=>{e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},93913:e=>{function t(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}e.exports=function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}},16525:(e,t,i)=>{var n=i(58331);function s(t,i,o){return"undefined"!=typeof Reflect&&Reflect.get?e.exports=s=Reflect.get:e.exports=s=function(e,t,i){var s=n(e,t);if(s){var o=Object.getOwnPropertyDescriptor(s,t);return o.get?o.get.call(i):o.value}},s(t,i,o||t)}e.exports=s},29754:e=>{function t(i){return e.exports=t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},t(i)}e.exports=t},2205:(e,t,i)=>{var n=i(99489);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}},95318:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}}},78585:(e,t,i)=>{var n=i(50008),s=i(81506);e.exports=function(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?s(e):t}},99489:e=>{function t(i,n){return e.exports=t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},t(i,n)}e.exports=t},58331:(e,t,i)=>{var n=i(29754);e.exports=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=n(e)););return e}},50008:e=>{function t(i){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=t=function(e){return typeof e}:e.exports=t=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(i)}e.exports=t},25179:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var n=i(6308);class MDCComponent{static attachTo(e){return new MDCComponent(e,new n.Z)}constructor(e,t,...i){this.root_=e,this.initialize(...i),this.foundation_=void 0===t?this.getDefaultFoundation():t,this.foundation_.init(),this.initialSyncWithDOM()}initialize(){}getDefaultFoundation(){throw new Error("Subclasses must override getDefaultFoundation to return a properly configured foundation class")}initialSyncWithDOM(){}destroy(){this.foundation_.destroy()}listen(e,t){this.root_.addEventListener(e,t)}unlisten(e,t){this.root_.removeEventListener(e,t)}emit(e,t,i=!1){let n;"function"==typeof CustomEvent?n=new CustomEvent(e,{detail:t,bubbles:i}):(n=document.createEvent("CustomEvent"),n.initCustomEvent(e,i,!1,t)),this.root_.dispatchEvent(n)}}const s=MDCComponent},6308:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});const n=class MDCFoundation{static get cssClasses(){return{}}static get strings(){return{}}static get numbers(){return{}}static get defaultAdapter(){return{}}constructor(e={}){this.adapter_=e}init(){}destroy(){}}},30888:(e,t,i)=>{"use strict";i.r(t),i.d(t,{MDCRipple:()=>MDCRipple,MDCRippleFoundation:()=>y,RippleCapableSurface:()=>RippleCapableSurface,util:()=>n});var n={};i.r(n),i.d(n,{applyPassive:()=>u,getMatchesProperty:()=>p,getNormalizedEventCoords:()=>m,supportsCssVariables:()=>d});var s=i(25179),o=i(6308);const r={ROOT:"mdc-ripple-upgraded",UNBOUNDED:"mdc-ripple-upgraded--unbounded",BG_FOCUSED:"mdc-ripple-upgraded--background-focused",FG_ACTIVATION:"mdc-ripple-upgraded--foreground-activation",FG_DEACTIVATION:"mdc-ripple-upgraded--foreground-deactivation"},a={VAR_LEFT:"--mdc-ripple-left",VAR_TOP:"--mdc-ripple-top",VAR_FG_SIZE:"--mdc-ripple-fg-size",VAR_FG_SCALE:"--mdc-ripple-fg-scale",VAR_FG_TRANSLATE_START:"--mdc-ripple-fg-translate-start",VAR_FG_TRANSLATE_END:"--mdc-ripple-fg-translate-end"},l={PADDING:10,INITIAL_ORIGIN_SCALE:.6,DEACTIVATION_TIMEOUT_MS:225,FG_DEACTIVATION_MS:150,TAP_DELAY_MS:300};let c,h;function d(e,t=!1){let i=c;if("boolean"==typeof c&&!t)return i;if(!(e.CSS&&"function"==typeof e.CSS.supports))return;const n=e.CSS.supports("--css-vars","yes"),s=e.CSS.supports("(--css-vars: yes)")&&e.CSS.supports("color","#00000000");return i=!(!n&&!s)&&!function(e){const t=e.document,i=t.createElement("div");i.className="mdc-ripple-surface--test-edge-var-bug",t.body.appendChild(i);const n=e.getComputedStyle(i),s=null!==n&&"solid"===n.borderTopStyle;return i.remove(),s}(e),t||(c=i),i}function u(e=window,t=!1){if(void 0===h||t){let t=!1;try{e.document.addEventListener("test",null,{get passive(){t=!0}})}catch(e){}h=t}return!!h&&{passive:!0}}function p(e){return["webkitMatchesSelector","msMatchesSelector","matches"].filter((t=>t in e)).pop()}function m(e,t,i){const{x:n,y:s}=t,o=n+i.left,r=s+i.top;let a,l;return"touchstart"===e.type?(a=e.changedTouches[0].pageX-o,l=e.changedTouches[0].pageY-r):(a=e.pageX-o,l=e.pageY-r),{x:a,y:l}}const g=["touchstart","pointerdown","mousedown","keydown"],f=["touchend","pointerup","mouseup"];let v=[];class MDCRippleFoundation extends o.Z{static get cssClasses(){return r}static get strings(){return a}static get numbers(){return l}static get defaultAdapter(){return{browserSupportsCssVars:()=>{},isUnbounded:()=>{},isSurfaceActive:()=>{},isSurfaceDisabled:()=>{},addClass:()=>{},removeClass:()=>{},containsEventTarget:()=>{},registerInteractionHandler:()=>{},deregisterInteractionHandler:()=>{},registerDocumentInteractionHandler:()=>{},deregisterDocumentInteractionHandler:()=>{},registerResizeHandler:()=>{},deregisterResizeHandler:()=>{},updateCssVariable:()=>{},computeBoundingRect:()=>{},getWindowPageOffset:()=>{}}}constructor(e){super(Object.assign(MDCRippleFoundation.defaultAdapter,e)),this.layoutFrame_=0,this.frame_={width:0,height:0},this.activationState_=this.defaultActivationState_(),this.initialSize_=0,this.maxRadius_=0,this.activateHandler_=e=>this.activate_(e),this.deactivateHandler_=e=>this.deactivate_(e),this.focusHandler_=()=>this.handleFocus(),this.blurHandler_=()=>this.handleBlur(),this.resizeHandler_=()=>this.layout(),this.unboundedCoords_={left:0,top:0},this.fgScale_=0,this.activationTimer_=0,this.fgDeactivationRemovalTimer_=0,this.activationAnimationHasEnded_=!1,this.activationTimerCallback_=()=>{this.activationAnimationHasEnded_=!0,this.runDeactivationUXLogicIfReady_()},this.previousActivationEvent_=null}supportsPressRipple_(){return this.adapter_.browserSupportsCssVars()}defaultActivationState_(){return{isActivated:!1,hasDeactivationUXRun:!1,wasActivatedByPointer:!1,wasElementMadeActive:!1,activationEvent:null,isProgrammatic:!1}}init(){const e=this.supportsPressRipple_();if(this.registerRootHandlers_(e),e){const{ROOT:e,UNBOUNDED:t}=MDCRippleFoundation.cssClasses;requestAnimationFrame((()=>{this.adapter_.addClass(e),this.adapter_.isUnbounded()&&(this.adapter_.addClass(t),this.layoutInternal_())}))}}destroy(){if(this.supportsPressRipple_()){this.activationTimer_&&(clearTimeout(this.activationTimer_),this.activationTimer_=0,this.adapter_.removeClass(MDCRippleFoundation.cssClasses.FG_ACTIVATION)),this.fgDeactivationRemovalTimer_&&(clearTimeout(this.fgDeactivationRemovalTimer_),this.fgDeactivationRemovalTimer_=0,this.adapter_.removeClass(MDCRippleFoundation.cssClasses.FG_DEACTIVATION));const{ROOT:e,UNBOUNDED:t}=MDCRippleFoundation.cssClasses;requestAnimationFrame((()=>{this.adapter_.removeClass(e),this.adapter_.removeClass(t),this.removeCssVars_()}))}this.deregisterRootHandlers_(),this.deregisterDeactivationHandlers_()}registerRootHandlers_(e){e&&(g.forEach((e=>{this.adapter_.registerInteractionHandler(e,this.activateHandler_)})),this.adapter_.isUnbounded()&&this.adapter_.registerResizeHandler(this.resizeHandler_)),this.adapter_.registerInteractionHandler("focus",this.focusHandler_),this.adapter_.registerInteractionHandler("blur",this.blurHandler_)}registerDeactivationHandlers_(e){"keydown"===e.type?this.adapter_.registerInteractionHandler("keyup",this.deactivateHandler_):f.forEach((e=>{this.adapter_.registerDocumentInteractionHandler(e,this.deactivateHandler_)}))}deregisterRootHandlers_(){g.forEach((e=>{this.adapter_.deregisterInteractionHandler(e,this.activateHandler_)})),this.adapter_.deregisterInteractionHandler("focus",this.focusHandler_),this.adapter_.deregisterInteractionHandler("blur",this.blurHandler_),this.adapter_.isUnbounded()&&this.adapter_.deregisterResizeHandler(this.resizeHandler_)}deregisterDeactivationHandlers_(){this.adapter_.deregisterInteractionHandler("keyup",this.deactivateHandler_),f.forEach((e=>{this.adapter_.deregisterDocumentInteractionHandler(e,this.deactivateHandler_)}))}removeCssVars_(){const{strings:e}=MDCRippleFoundation;Object.keys(e).forEach((t=>{0===t.indexOf("VAR_")&&this.adapter_.updateCssVariable(e[t],null)}))}activate_(e){if(this.adapter_.isSurfaceDisabled())return;const t=this.activationState_;if(t.isActivated)return;const i=this.previousActivationEvent_;if(i&&e&&i.type!==e.type)return;t.isActivated=!0,t.isProgrammatic=null===e,t.activationEvent=e,t.wasActivatedByPointer=!t.isProgrammatic&&("mousedown"===e.type||"touchstart"===e.type||"pointerdown"===e.type);e&&v.length>0&&v.some((e=>this.adapter_.containsEventTarget(e)))?this.resetActivationState_():(e&&(v.push(e.target),this.registerDeactivationHandlers_(e)),t.wasElementMadeActive=this.checkElementMadeActive_(e),t.wasElementMadeActive&&this.animateActivation_(),requestAnimationFrame((()=>{v=[],t.wasElementMadeActive||" "!==e.key&&32!==e.keyCode||(t.wasElementMadeActive=this.checkElementMadeActive_(e),t.wasElementMadeActive&&this.animateActivation_()),t.wasElementMadeActive||(this.activationState_=this.defaultActivationState_())})))}checkElementMadeActive_(e){return!e||"keydown"!==e.type||this.adapter_.isSurfaceActive()}activate(e=null){this.activate_(e)}animateActivation_(){const{VAR_FG_TRANSLATE_START:e,VAR_FG_TRANSLATE_END:t}=MDCRippleFoundation.strings,{FG_DEACTIVATION:i,FG_ACTIVATION:n}=MDCRippleFoundation.cssClasses,{DEACTIVATION_TIMEOUT_MS:s}=MDCRippleFoundation.numbers;this.layoutInternal_();let o="",r="";if(!this.adapter_.isUnbounded()){const{startPoint:e,endPoint:t}=this.getFgTranslationCoordinates_();o=`${e.x}px, ${e.y}px`,r=`${t.x}px, ${t.y}px`}this.adapter_.updateCssVariable(e,o),this.adapter_.updateCssVariable(t,r),clearTimeout(this.activationTimer_),clearTimeout(this.fgDeactivationRemovalTimer_),this.rmBoundedActivationClasses_(),this.adapter_.removeClass(i),this.adapter_.computeBoundingRect(),this.adapter_.addClass(n),this.activationTimer_=setTimeout((()=>this.activationTimerCallback_()),s)}getFgTranslationCoordinates_(){const{activationEvent:e,wasActivatedByPointer:t}=this.activationState_;let i;i=t?m(e,this.adapter_.getWindowPageOffset(),this.adapter_.computeBoundingRect()):{x:this.frame_.width/2,y:this.frame_.height/2},i={x:i.x-this.initialSize_/2,y:i.y-this.initialSize_/2};return{startPoint:i,endPoint:{x:this.frame_.width/2-this.initialSize_/2,y:this.frame_.height/2-this.initialSize_/2}}}runDeactivationUXLogicIfReady_(){const{FG_DEACTIVATION:e}=MDCRippleFoundation.cssClasses,{hasDeactivationUXRun:t,isActivated:i}=this.activationState_;(t||!i)&&this.activationAnimationHasEnded_&&(this.rmBoundedActivationClasses_(),this.adapter_.addClass(e),this.fgDeactivationRemovalTimer_=setTimeout((()=>{this.adapter_.removeClass(e)}),l.FG_DEACTIVATION_MS))}rmBoundedActivationClasses_(){const{FG_ACTIVATION:e}=MDCRippleFoundation.cssClasses;this.adapter_.removeClass(e),this.activationAnimationHasEnded_=!1,this.adapter_.computeBoundingRect()}resetActivationState_(){this.previousActivationEvent_=this.activationState_.activationEvent,this.activationState_=this.defaultActivationState_(),setTimeout((()=>this.previousActivationEvent_=null),MDCRippleFoundation.numbers.TAP_DELAY_MS)}deactivate_(e){const t=this.activationState_;if(!t.isActivated)return;const i=Object.assign({},t);if(t.isProgrammatic){const e=null;requestAnimationFrame((()=>this.animateDeactivation_(e,i))),this.resetActivationState_()}else this.deregisterDeactivationHandlers_(),requestAnimationFrame((()=>{this.activationState_.hasDeactivationUXRun=!0,this.animateDeactivation_(e,i),this.resetActivationState_()}))}deactivate(e=null){this.deactivate_(e)}animateDeactivation_(e,{wasActivatedByPointer:t,wasElementMadeActive:i}){(t||i)&&this.runDeactivationUXLogicIfReady_()}layout(){this.layoutFrame_&&cancelAnimationFrame(this.layoutFrame_),this.layoutFrame_=requestAnimationFrame((()=>{this.layoutInternal_(),this.layoutFrame_=0}))}layoutInternal_(){this.frame_=this.adapter_.computeBoundingRect();const e=Math.max(this.frame_.height,this.frame_.width);this.maxRadius_=this.adapter_.isUnbounded()?e:(()=>Math.sqrt(Math.pow(this.frame_.width,2)+Math.pow(this.frame_.height,2))+MDCRippleFoundation.numbers.PADDING)(),this.initialSize_=e*MDCRippleFoundation.numbers.INITIAL_ORIGIN_SCALE,this.fgScale_=this.maxRadius_/this.initialSize_,this.updateLayoutCssVars_()}updateLayoutCssVars_(){const{VAR_FG_SIZE:e,VAR_LEFT:t,VAR_TOP:i,VAR_FG_SCALE:n}=MDCRippleFoundation.strings;this.adapter_.updateCssVariable(e,`${this.initialSize_}px`),this.adapter_.updateCssVariable(n,this.fgScale_),this.adapter_.isUnbounded()&&(this.unboundedCoords_={left:Math.round(this.frame_.width/2-this.initialSize_/2),top:Math.round(this.frame_.height/2-this.initialSize_/2)},this.adapter_.updateCssVariable(t,`${this.unboundedCoords_.left}px`),this.adapter_.updateCssVariable(i,`${this.unboundedCoords_.top}px`))}setUnbounded(e){const{UNBOUNDED:t}=MDCRippleFoundation.cssClasses;e?this.adapter_.addClass(t):this.adapter_.removeClass(t)}handleFocus(){requestAnimationFrame((()=>this.adapter_.addClass(MDCRippleFoundation.cssClasses.BG_FOCUSED)))}handleBlur(){requestAnimationFrame((()=>this.adapter_.removeClass(MDCRippleFoundation.cssClasses.BG_FOCUSED)))}}const y=MDCRippleFoundation;class MDCRipple extends s.Z{constructor(...e){super(...e),this.disabled=!1,this.unbounded_}static attachTo(e,{isUnbounded:t}={}){const i=new MDCRipple(e);return void 0!==t&&(i.unbounded=t),i}static createAdapter(e){const t=p(HTMLElement.prototype);return{browserSupportsCssVars:()=>d(window),isUnbounded:()=>e.unbounded,isSurfaceActive:()=>e.root_[t](":active"),isSurfaceDisabled:()=>e.disabled,addClass:t=>e.root_.classList.add(t),removeClass:t=>e.root_.classList.remove(t),containsEventTarget:t=>e.root_.contains(t),registerInteractionHandler:(t,i)=>e.root_.addEventListener(t,i,u()),deregisterInteractionHandler:(t,i)=>e.root_.removeEventListener(t,i,u()),registerDocumentInteractionHandler:(e,t)=>document.documentElement.addEventListener(e,t,u()),deregisterDocumentInteractionHandler:(e,t)=>document.documentElement.removeEventListener(e,t,u()),registerResizeHandler:e=>window.addEventListener("resize",e),deregisterResizeHandler:e=>window.removeEventListener("resize",e),updateCssVariable:(t,i)=>e.root_.style.setProperty(t,i),computeBoundingRect:()=>e.root_.getBoundingClientRect(),getWindowPageOffset:()=>({x:window.pageXOffset,y:window.pageYOffset})}}get unbounded(){return this.unbounded_}set unbounded(e){this.unbounded_=Boolean(e),this.setUnbounded_()}setUnbounded_(){this.foundation_.setUnbounded(this.unbounded_)}activate(){this.foundation_.activate()}deactivate(){this.foundation_.deactivate()}layout(){this.foundation_.layout()}getDefaultFoundation(){return new y(MDCRipple.createAdapter(this))}initialSyncWithDOM(){this.unbounded="mdcRippleIsUnbounded"in this.root_.dataset}}class RippleCapableSurface{}RippleCapableSurface.prototype.root_,RippleCapableSurface.prototype.unbounded,RippleCapableSurface.prototype.disabled},69826:(e,t,i)=>{"use strict";i.r(t),i.d(t,{MDCSlider:()=>MDCSlider,MDCSliderFoundation:()=>T});var n=i(25179);const s={ACTIVE:"mdc-slider--active",DISABLED:"mdc-slider--disabled",DISCRETE:"mdc-slider--discrete",FOCUS:"mdc-slider--focus",IN_TRANSIT:"mdc-slider--in-transit",IS_DISCRETE:"mdc-slider--discrete",HAS_TRACK_MARKER:"mdc-slider--display-markers"},o={TRACK_SELECTOR:".mdc-slider__track",TRACK_MARKER_CONTAINER_SELECTOR:".mdc-slider__track-marker-container",LAST_TRACK_MARKER_SELECTOR:".mdc-slider__track-marker:last-child",THUMB_CONTAINER_SELECTOR:".mdc-slider__thumb-container",PIN_VALUE_MARKER_SELECTOR:".mdc-slider__pin-value-marker",ARIA_VALUEMIN:"aria-valuemin",ARIA_VALUEMAX:"aria-valuemax",ARIA_VALUENOW:"aria-valuenow",ARIA_DISABLED:"aria-disabled",STEP_DATA_ATTR:"data-step",CHANGE_EVENT:"MDCSlider:change",INPUT_EVENT:"MDCSlider:input"},r={PAGE_FACTOR:4};const a={animationstart:{noPrefix:"animationstart",webkitPrefix:"webkitAnimationStart",styleProperty:"animation"},animationend:{noPrefix:"animationend",webkitPrefix:"webkitAnimationEnd",styleProperty:"animation"},animationiteration:{noPrefix:"animationiteration",webkitPrefix:"webkitAnimationIteration",styleProperty:"animation"},transitionend:{noPrefix:"transitionend",webkitPrefix:"webkitTransitionEnd",styleProperty:"transition"}},l={animation:{noPrefix:"animation",webkitPrefix:"-webkit-animation"},transform:{noPrefix:"transform",webkitPrefix:"-webkit-transform"},transition:{noPrefix:"transition",webkitPrefix:"-webkit-transition"}};function c(e,t){if(!function(e){return void 0!==e.document&&"function"==typeof e.document.createElement}(e)||!function(e){return e in a||e in l}(t))return t;const i=t in a?a:l,n=e.document.createElement("div");let s="";return s=i===a?function(e,t,i){return t[e].styleProperty in i.style?t[e].noPrefix:t[e].webkitPrefix}(t,i,n):i[t].noPrefix in n.style?i[t].noPrefix:i[t].webkitPrefix,s}function h(e,t){return c(e,t)}var d=i(6308);const u="ArrowLeft",p="ArrowRight",m="ArrowUp",g="ArrowDown",f="Home",v="End",y="PageUp",b="PageDown",w={mousedown:"mousemove",touchstart:"touchmove",pointerdown:"pointermove"},S=["mousedown","pointerdown","touchstart"],E=["mouseup","pointerup","touchend"];class MDCSliderFoundation extends d.Z{static get cssClasses(){return s}static get strings(){return o}static get numbers(){return r}static get defaultAdapter(){return{hasClass:()=>!1,addClass:()=>{},removeClass:()=>{},getAttribute:()=>null,setAttribute:()=>{},removeAttribute:()=>{},computeBoundingRect:()=>({top:0,right:0,bottom:0,left:0,width:0,height:0}),getTabIndex:()=>0,registerInteractionHandler:()=>{},deregisterInteractionHandler:()=>{},registerThumbContainerInteractionHandler:()=>{},deregisterThumbContainerInteractionHandler:()=>{},registerBodyInteractionHandler:()=>{},deregisterBodyInteractionHandler:()=>{},registerResizeHandler:()=>{},deregisterResizeHandler:()=>{},notifyInput:()=>{},notifyChange:()=>{},setThumbContainerStyleProperty:()=>{},setTrackStyleProperty:()=>{},setMarkerValue:()=>{},appendTrackMarkers:()=>{},removeTrackMarkers:()=>{},setLastTrackMarkersStyleProperty:()=>{},isRTL:()=>!1}}constructor(e){super(Object.assign(MDCSliderFoundation.defaultAdapter,e)),this.rect_=null,this.savedTabIndex_=NaN,this.active_=!1,this.inTransit_=!1,this.isDiscrete_=!1,this.hasTrackMarker_=!1,this.handlingThumbTargetEvt_=!1,this.min_=0,this.max_=100,this.step_=0,this.value_=0,this.disabled_=!1,this.preventFocusState_=!1,this.updateUIFrame_=0,this.thumbContainerPointerHandler_=()=>{this.handlingThumbTargetEvt_=!0},this.interactionStartHandler_=e=>this.handleDown_(e),this.keydownHandler_=e=>this.handleKeydown_(e),this.focusHandler_=()=>this.handleFocus_(),this.blurHandler_=()=>this.handleBlur_(),this.resizeHandler_=()=>this.layout()}init(){this.isDiscrete_=this.adapter_.hasClass(s.IS_DISCRETE),this.hasTrackMarker_=this.adapter_.hasClass(s.HAS_TRACK_MARKER),S.forEach((e=>this.adapter_.registerInteractionHandler(e,this.interactionStartHandler_))),this.adapter_.registerInteractionHandler("keydown",this.keydownHandler_),this.adapter_.registerInteractionHandler("focus",this.focusHandler_),this.adapter_.registerInteractionHandler("blur",this.blurHandler_),S.forEach((e=>{this.adapter_.registerThumbContainerInteractionHandler(e,this.thumbContainerPointerHandler_)})),this.adapter_.registerResizeHandler(this.resizeHandler_),this.layout(),this.isDiscrete_&&0==this.getStep()&&(this.step_=1)}destroy(){S.forEach((e=>{this.adapter_.deregisterInteractionHandler(e,this.interactionStartHandler_)})),this.adapter_.deregisterInteractionHandler("keydown",this.keydownHandler_),this.adapter_.deregisterInteractionHandler("focus",this.focusHandler_),this.adapter_.deregisterInteractionHandler("blur",this.blurHandler_),S.forEach((e=>{this.adapter_.deregisterThumbContainerInteractionHandler(e,this.thumbContainerPointerHandler_)})),this.adapter_.deregisterResizeHandler(this.resizeHandler_)}setupTrackMarker(){if(this.isDiscrete_&&this.hasTrackMarker_&&0!=this.getStep()){const e=this.getMin(),t=this.getMax(),i=this.getStep();let n=(t-e)/i;const s=Math.ceil(n)!==n;if(s&&(n=Math.ceil(n)),this.adapter_.removeTrackMarkers(),this.adapter_.appendTrackMarkers(n),s){const e=(t-n*i)/i+1,s=h(window,"flex");this.adapter_.setLastTrackMarkersStyleProperty(s,String(e))}}}layout(){this.rect_=this.adapter_.computeBoundingRect(),this.updateUIForCurrentValue_()}getValue(){return this.value_}setValue(e){this.setValue_(e,!1)}getMax(){return this.max_}setMax(e){if(e<this.min_)throw new Error("Cannot set max to be less than the slider's minimum value");this.max_=e,this.setValue_(this.value_,!1,!0),this.adapter_.setAttribute(o.ARIA_VALUEMAX,String(this.max_)),this.setupTrackMarker()}getMin(){return this.min_}setMin(e){if(e>this.max_)throw new Error("Cannot set min to be greater than the slider's maximum value");this.min_=e,this.setValue_(this.value_,!1,!0),this.adapter_.setAttribute(o.ARIA_VALUEMIN,String(this.min_)),this.setupTrackMarker()}getStep(){return this.step_}setStep(e){if(e<0)throw new Error("Step cannot be set to a negative number");this.isDiscrete_&&("number"!=typeof e||e<1)&&(e=1),this.step_=e,this.setValue_(this.value_,!1,!0),this.setupTrackMarker()}isDisabled(){return this.disabled_}setDisabled(e){this.disabled_=e,this.toggleClass_(s.DISABLED,this.disabled_),this.disabled_?(this.savedTabIndex_=this.adapter_.getTabIndex(),this.adapter_.setAttribute(o.ARIA_DISABLED,"true"),this.adapter_.removeAttribute("tabindex")):(this.adapter_.removeAttribute(o.ARIA_DISABLED),isNaN(this.savedTabIndex_)||this.adapter_.setAttribute("tabindex",String(this.savedTabIndex_)))}handleDown_(e){if(this.disabled_)return;this.preventFocusState_=!0,this.setInTransit_(!this.handlingThumbTargetEvt_),this.handlingThumbTargetEvt_=!1,this.setActive_(!0);const t=e=>{this.handleMove_(e)},i=()=>{this.handleUp_(),this.adapter_.deregisterBodyInteractionHandler(w[e.type],t),E.forEach((e=>this.adapter_.deregisterBodyInteractionHandler(e,i)))};this.adapter_.registerBodyInteractionHandler(w[e.type],t),E.forEach((e=>this.adapter_.registerBodyInteractionHandler(e,i))),this.setValueFromEvt_(e)}handleMove_(e){e.preventDefault(),this.setValueFromEvt_(e)}handleUp_(){this.setActive_(!1),this.adapter_.notifyChange()}getPageX_(e){return e.targetTouches&&e.targetTouches.length>0?e.targetTouches[0].pageX:e.pageX}setValueFromEvt_(e){const t=this.getPageX_(e),i=this.computeValueFromPageX_(t);this.setValue_(i,!0)}computeValueFromPageX_(e){const{max_:t,min_:i}=this;let n=(e-this.rect_.left)/this.rect_.width;return this.adapter_.isRTL()&&(n=1-n),i+n*(t-i)}handleKeydown_(e){const t=this.getKeyId_(e),i=this.getValueForKeyId_(t);isNaN(i)||(e.preventDefault(),this.adapter_.addClass(s.FOCUS),this.setValue_(i,!0),this.adapter_.notifyChange())}getKeyId_(e){return e.key===u||37===e.keyCode?u:e.key===p||39===e.keyCode?p:e.key===m||38===e.keyCode?m:e.key===g||40===e.keyCode?g:e.key===f||36===e.keyCode?f:e.key===v||35===e.keyCode?v:e.key===y||33===e.keyCode?y:e.key===b||34===e.keyCode?b:""}getValueForKeyId_(e){const{max_:t,min_:i,step_:n}=this;let s=n||(t-i)/100;switch(this.adapter_.isRTL()&&(e===u||e===p)&&(s=-s),e){case u:case g:return this.value_-s;case p:case m:return this.value_+s;case f:return this.min_;case v:return this.max_;case y:return this.value_+s*r.PAGE_FACTOR;case b:return this.value_-s*r.PAGE_FACTOR;default:return NaN}}handleFocus_(){this.preventFocusState_||this.adapter_.addClass(s.FOCUS)}handleBlur_(){this.preventFocusState_=!1,this.adapter_.removeClass(s.FOCUS)}setValue_(e,t,i=!1){if(e===this.value_&&!i)return;const{min_:n,max_:s}=this,r=e===n||e===s;this.step_&&!r&&(e=this.quantize_(e)),e<n?e=n:e>s&&(e=s),this.value_=e,this.adapter_.setAttribute(o.ARIA_VALUENOW,String(this.value_)),this.updateUIForCurrentValue_(),t&&(this.adapter_.notifyInput(),this.isDiscrete_&&this.adapter_.setMarkerValue(e))}quantize_(e){return Math.round(e/this.step_)*this.step_}updateUIForCurrentValue_(){const{max_:e,min_:t,value_:i}=this,n=(i-t)/(e-t);let s=n*this.rect_.width;this.adapter_.isRTL()&&(s=this.rect_.width-s);const o=h(window,"transform"),r=c(window,"transitionend");if(this.inTransit_){const e=()=>{this.setInTransit_(!1),this.adapter_.deregisterThumbContainerInteractionHandler(r,e)};this.adapter_.registerThumbContainerInteractionHandler(r,e)}this.updateUIFrame_=requestAnimationFrame((()=>{this.adapter_.setThumbContainerStyleProperty(o,`translateX(${s}px) translateX(-50%)`),this.adapter_.setTrackStyleProperty(o,`scaleX(${n})`)}))}setActive_(e){this.active_=e,this.toggleClass_(s.ACTIVE,this.active_)}setInTransit_(e){this.inTransit_=e,this.toggleClass_(s.IN_TRANSIT,this.inTransit_)}toggleClass_(e,t){t?this.adapter_.addClass(e):this.adapter_.removeClass(e)}}const T=MDCSliderFoundation;class MDCSlider extends n.Z{static attachTo(e){return new MDCSlider(e)}constructor(...e){super(...e),this.thumbContainer_,this.track_,this.pinValueMarker_,this.trackMarkerContainer_}get value(){return this.foundation_.getValue()}set value(e){this.foundation_.setValue(e)}get min(){return this.foundation_.getMin()}set min(e){this.foundation_.setMin(e)}get max(){return this.foundation_.getMax()}set max(e){this.foundation_.setMax(e)}get step(){return this.foundation_.getStep()}set step(e){this.foundation_.setStep(e)}get disabled(){return this.foundation_.isDisabled()}set disabled(e){this.foundation_.setDisabled(e)}initialize(){this.thumbContainer_=this.root_.querySelector(o.THUMB_CONTAINER_SELECTOR),this.track_=this.root_.querySelector(o.TRACK_SELECTOR),this.pinValueMarker_=this.root_.querySelector(o.PIN_VALUE_MARKER_SELECTOR),this.trackMarkerContainer_=this.root_.querySelector(o.TRACK_MARKER_CONTAINER_SELECTOR)}getDefaultFoundation(){return new T({hasClass:e=>this.root_.classList.contains(e),addClass:e=>this.root_.classList.add(e),removeClass:e=>this.root_.classList.remove(e),getAttribute:e=>this.root_.getAttribute(e),setAttribute:(e,t)=>this.root_.setAttribute(e,t),removeAttribute:e=>this.root_.removeAttribute(e),computeBoundingRect:()=>this.root_.getBoundingClientRect(),getTabIndex:()=>this.root_.tabIndex,registerInteractionHandler:(e,t)=>{this.root_.addEventListener(e,t)},deregisterInteractionHandler:(e,t)=>{this.root_.removeEventListener(e,t)},registerThumbContainerInteractionHandler:(e,t)=>{this.thumbContainer_.addEventListener(e,t)},deregisterThumbContainerInteractionHandler:(e,t)=>{this.thumbContainer_.removeEventListener(e,t)},registerBodyInteractionHandler:(e,t)=>{document.body.addEventListener(e,t)},deregisterBodyInteractionHandler:(e,t)=>{document.body.removeEventListener(e,t)},registerResizeHandler:e=>{window.addEventListener("resize",e)},deregisterResizeHandler:e=>{window.removeEventListener("resize",e)},notifyInput:()=>{this.emit(o.INPUT_EVENT,this)},notifyChange:()=>{this.emit(o.CHANGE_EVENT,this)},setThumbContainerStyleProperty:(e,t)=>{this.thumbContainer_.style.setProperty(e,t)},setTrackStyleProperty:(e,t)=>{this.track_.style.setProperty(e,t)},setMarkerValue:e=>{this.pinValueMarker_.innerText=e},appendTrackMarkers:e=>{const t=document.createDocumentFragment();for(let i=0;i<e;i++){const e=document.createElement("div");e.classList.add("mdc-slider__track-marker"),t.appendChild(e)}this.trackMarkerContainer_.appendChild(t)},removeTrackMarkers:()=>{for(;this.trackMarkerContainer_.firstChild;)this.trackMarkerContainer_.removeChild(this.trackMarkerContainer_.firstChild)},setLastTrackMarkersStyleProperty:(e,t)=>{this.root_.querySelector(o.LAST_TRACK_MARKER_SELECTOR).style.setProperty(e,t)},isRTL:()=>"rtl"===getComputedStyle(this.root_).direction})}initialSyncWithDOM(){const e=parseFloat(this.root_.getAttribute(o.ARIA_VALUENOW));this.min=parseFloat(this.root_.getAttribute(o.ARIA_VALUEMIN))||this.min,this.max=parseFloat(this.root_.getAttribute(o.ARIA_VALUEMAX))||this.max,this.step=parseFloat(this.root_.getAttribute(o.STEP_DATA_ATTR))||this.step,this.value=e||this.value,this.disabled=this.root_.hasAttribute(o.ARIA_DISABLED)&&"false"!==this.root_.getAttribute(o.ARIA_DISABLED),this.foundation_.setupTrackMarker()}layout(){this.foundation_.layout()}stepUp(e=this.step||1){this.value+=e}stepDown(e=this.step||1){this.value-=e}}},82152:(e,t,i)=>{"use strict";i.d(t,{D:()=>l});var n=Object.prototype,s=n.toString,o=n.hasOwnProperty,r=Function.prototype.toString,a=new Map;function l(e,t){try{return c(e,t)}finally{a.clear()}}function c(e,t){if(e===t)return!0;var i,n,a,l=s.call(e);if(l!==s.call(t))return!1;switch(l){case"[object Array]":if(e.length!==t.length)return!1;case"[object Object]":if(p(e,t))return!0;var d=h(e),m=h(t),g=d.length;if(g!==m.length)return!1;for(var f=0;f<g;++f)if(!o.call(t,d[f]))return!1;for(f=0;f<g;++f){var v=d[f];if(!c(e[v],t[v]))return!1}return!0;case"[object Error]":return e.name===t.name&&e.message===t.message;case"[object Number]":if(e!=e)return t!=t;case"[object Boolean]":case"[object Date]":return+e==+t;case"[object RegExp]":case"[object String]":return e==""+t;case"[object Map]":case"[object Set]":if(e.size!==t.size)return!1;if(p(e,t))return!0;for(var y=e.entries(),b="[object Map]"===l;;){var w=y.next();if(w.done)break;var S=w.value,E=S[0],T=S[1];if(!t.has(E))return!1;if(b&&!c(T,t.get(E)))return!1}return!0;case"[object Function]":var M=r.call(e);return M===r.call(t)&&(n=u,!((a=(i=M).length-n.length)>=0&&i.indexOf(n,a)===a))}return!1}function h(e){return Object.keys(e).filter(d,e)}function d(e){return void 0!==this[e]}var u="{ [native code] }";function p(e,t){var i=a.get(e);if(i){if(i.has(t))return!0}else a.set(e,i=new Set);return i.add(t),!1}},34515:e=>{var t=Object.prototype.toString;e.exports=function(e){return e.BYTES_PER_ELEMENT&&"[object ArrayBuffer]"===t.call(e.buffer)||Array.isArray(e)}},14176:e=>{e.exports=function(e,t){return"number"==typeof e?e:"number"==typeof t?t:0}},47056:(e,t)=>{"use strict";var i;function n(e,t,n){if(!n||typeof n.value!==i.typeOfFunction)throw new TypeError("Only methods can be decorated with @bind. <"+t+"> is not a method!");return{configurable:i.boolTrue,get:function(){var e=n.value.bind(this);return Object.defineProperty(this,t,{value:e,configurable:i.boolTrue,writable:i.boolTrue}),e}}}Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.typeOfFunction="function",e.boolTrue=!0}(i||(i={})),t.bind=n,t.default=n},21924:(e,t,i)=>{"use strict";var n=i(40210),s=i(55559),o=s(n("String.prototype.indexOf"));e.exports=function(e,t){var i=n(e,!!t);return"function"==typeof i&&o(e,".prototype.")>-1?s(i):i}},55559:(e,t,i)=>{"use strict";var n=i(58612),s=i(40210),o=s("%Function.prototype.apply%"),r=s("%Function.prototype.call%"),a=s("%Reflect.apply%",!0)||n.call(r,o),l=s("%Object.getOwnPropertyDescriptor%",!0),c=s("%Object.defineProperty%",!0),h=s("%Math.max%");if(c)try{c({},"a",{value:1})}catch(e){c=null}e.exports=function(e){var t=a(n,r,arguments);if(l&&c){var i=l(t,"length");i.configurable&&c(t,"length",{value:1+h(0,e.length-(arguments.length-1))})}return t};var d=function(){return a(n,o,arguments)};c?c(e.exports,"apply",{value:d}):e.exports.apply=d},94184:(e,t)=>{var i;!function(){"use strict";var n={}.hasOwnProperty;function s(){for(var e=[],t=0;t<arguments.length;t++){var i=arguments[t];if(i){var o=typeof i;if("string"===o||"number"===o)e.push(i);else if(Array.isArray(i)&&i.length){var r=s.apply(null,i);r&&e.push(r)}else if("object"===o)for(var a in i)n.call(i,a)&&i[a]&&e.push(a)}}return e.join(" ")}e.exports?(s.default=s,e.exports=s):void 0===(i=function(){return s}.apply(t,[]))||(e.exports=i)}()},4289:(e,t,i)=>{"use strict";var n=i(82215),s="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),o=Object.prototype.toString,r=Array.prototype.concat,a=Object.defineProperty,l=a&&function(){var e={};try{for(var t in a(e,"x",{enumerable:!1,value:e}),e)return!1;return e.x===e}catch(e){return!1}}(),c=function(e,t,i,n){var s;(!(t in e)||"function"==typeof(s=n)&&"[object Function]"===o.call(s)&&n())&&(l?a(e,t,{configurable:!0,enumerable:!1,value:i,writable:!0}):e[t]=i)},h=function(e,t){var i=arguments.length>2?arguments[2]:{},o=n(t);s&&(o=r.call(o,Object.getOwnPropertySymbols(t)));for(var a=0;a<o.length;a+=1)c(e,o[a],t[o[a]],i[o[a]])};h.supportsDescriptors=!!l,e.exports=h},2823:e=>{e.exports=function(e){switch(e){case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array;case"array":return Array;case"uint8_clamped":return Uint8ClampedArray}}},13733:(e,t,i)=>{"use strict";e.exports=i(28631)},27308:(e,t,i)=>{"use strict";var n=i(40210),s=n("%String%"),o=n("%TypeError%");e.exports=function(e){if("symbol"==typeof e)throw new o("Cannot convert a Symbol value to a string");return s(e)}},28631:(e,t,i)=>{"use strict";var n=i(40210)("%TypeError%");e.exports=function(e,t){if(null==e)throw new n(t||"Cannot call method on "+e);return e}},17187:e=>{function t(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function n(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}e.exports=t,t.EventEmitter=t,t.prototype._events=void 0,t.prototype._maxListeners=void 0,t.defaultMaxListeners=10,t.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},t.prototype.emit=function(e){var t,o,r,a,l,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||n(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var h=new Error('Uncaught, unspecified "error" event. ('+t+")");throw h.context=t,h}if(s(o=this._events[e]))return!1;if(i(o))switch(arguments.length){case 1:o.call(this);break;case 2:o.call(this,arguments[1]);break;case 3:o.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),o.apply(this,a)}else if(n(o))for(a=Array.prototype.slice.call(arguments,1),r=(c=o.slice()).length,l=0;l<r;l++)c[l].apply(this,a);return!0},t.prototype.addListener=function(e,o){var r;if(!i(o))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(o.listener)?o.listener:o),this._events[e]?n(this._events[e])?this._events[e].push(o):this._events[e]=[this._events[e],o]:this._events[e]=o,n(this._events[e])&&!this._events[e].warned&&(r=s(this._maxListeners)?t.defaultMaxListeners:this._maxListeners)&&r>0&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},t.prototype.on=t.prototype.addListener,t.prototype.once=function(e,t){if(!i(t))throw TypeError("listener must be a function");var n=!1;function s(){this.removeListener(e,s),n||(n=!0,t.apply(this,arguments))}return s.listener=t,this.on(e,s),this},t.prototype.removeListener=function(e,t){var s,o,r,a;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(r=(s=this._events[e]).length,o=-1,s===t||i(s.listener)&&s.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(n(s)){for(a=r;a-- >0;)if(s[a]===t||s[a].listener&&s[a].listener===t){o=a;break}if(o<0)return this;1===s.length?(s.length=0,delete this._events[e]):s.splice(o,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},t.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(i(n=this._events[e]))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},t.prototype.listeners=function(e){return this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},t.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},t.listenerCount=function(e,t){return e.listenerCount(t)}},35035:e=>{"use strict";e.exports=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var i,n="boolean"==typeof t.cycles&&t.cycles,s=t.cmp&&(i=t.cmp,function(e){return function(t,n){var s={key:t,value:e[t]},o={key:n,value:e[n]};return i(s,o)}}),o=[];return function e(t){if(t&&t.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0!==t){if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);var i,r;if(Array.isArray(t)){for(r="[",i=0;i<t.length;i++)i&&(r+=","),r+=e(t[i])||"null";return r+"]"}if(null===t)return"null";if(-1!==o.indexOf(t)){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var a=o.push(t)-1,l=Object.keys(t).sort(s&&s(t));for(r="",i=0;i<l.length;i++){var c=l[i],h=e(t[c]);h&&(r&&(r+=","),r+=JSON.stringify(c)+":"+h)}return o.splice(a,1),"{"+r+"}"}}(e)}},94029:(e,t,i)=>{"use strict";var n=i(95320),s=Object.prototype.toString,o=Object.prototype.hasOwnProperty,r=function(e,t,i){for(var n=0,s=e.length;n<s;n++)o.call(e,n)&&(null==i?t(e[n],n,e):t.call(i,e[n],n,e))},a=function(e,t,i){for(var n=0,s=e.length;n<s;n++)null==i?t(e.charAt(n),n,e):t.call(i,e.charAt(n),n,e)},l=function(e,t,i){for(var n in e)o.call(e,n)&&(null==i?t(e[n],n,e):t.call(i,e[n],n,e))};e.exports=function(e,t,i){if(!n(t))throw new TypeError("iterator must be a function");var o;arguments.length>=3&&(o=i),"[object Array]"===s.call(e)?r(e,t,o):"string"==typeof e?a(e,t,o):l(e,t,o)}},17648:e=>{"use strict";var t="Function.prototype.bind called on incompatible ",i=Array.prototype.slice,n=Object.prototype.toString,s="[object Function]";e.exports=function(e){var o=this;if("function"!=typeof o||n.call(o)!==s)throw new TypeError(t+o);for(var r,a=i.call(arguments,1),l=function(){if(this instanceof r){var t=o.apply(this,a.concat(i.call(arguments)));return Object(t)===t?t:this}return o.apply(e,a.concat(i.call(arguments)))},c=Math.max(0,o.length-a.length),h=[],d=0;d<c;d++)h.push("$"+d);if(r=Function("binder","return function ("+h.join(",")+"){ return binder.apply(this,arguments); }")(l),o.prototype){var u=function(){};u.prototype=o.prototype,r.prototype=new u,u.prototype=null}return r}},58612:(e,t,i)=>{"use strict";var n=i(17648);e.exports=Function.prototype.bind||n},40210:(e,t,i)=>{"use strict";var n,s=SyntaxError,o=Function,r=TypeError,a=function(e){try{return Function('"use strict"; return ('+e+").constructor;")()}catch(e){}},l=Object.getOwnPropertyDescriptor;if(l)try{l({},"")}catch(e){l=null}var c=function(){throw new r},h=l?function(){try{return c}catch(e){try{return l(arguments,"callee").get}catch(e){return c}}}():c,d=i(41405)(),u=Object.getPrototypeOf||function(e){return e.__proto__},p=a("async function* () {}"),m=p?p.prototype:n,g=m?m.prototype:n,f="undefined"==typeof Uint8Array?n:u(Uint8Array),v={"%AggregateError%":"undefined"==typeof AggregateError?n:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?n:ArrayBuffer,"%ArrayIteratorPrototype%":d?u([][Symbol.iterator]()):n,"%AsyncFromSyncIteratorPrototype%":n,"%AsyncFunction%":a("async function () {}"),"%AsyncGenerator%":m,"%AsyncGeneratorFunction%":p,"%AsyncIteratorPrototype%":g?u(g):n,"%Atomics%":"undefined"==typeof Atomics?n:Atomics,"%BigInt%":"undefined"==typeof BigInt?n:BigInt,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?n:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?n:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?n:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?n:FinalizationRegistry,"%Function%":o,"%GeneratorFunction%":a("function* () {}"),"%Int8Array%":"undefined"==typeof Int8Array?n:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?n:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?n:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":d?u(u([][Symbol.iterator]())):n,"%JSON%":"object"==typeof JSON?JSON:n,"%Map%":"undefined"==typeof Map?n:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&d?u((new Map)[Symbol.iterator]()):n,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?n:Promise,"%Proxy%":"undefined"==typeof Proxy?n:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?n:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?n:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&d?u((new Set)[Symbol.iterator]()):n,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?n:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":d?u(""[Symbol.iterator]()):n,"%Symbol%":d?Symbol:n,"%SyntaxError%":s,"%ThrowTypeError%":h,"%TypedArray%":f,"%TypeError%":r,"%Uint8Array%":"undefined"==typeof Uint8Array?n:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?n:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?n:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?n:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?n:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?n:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?n:WeakSet},y={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},b=i(58612),w=i(17642),S=b.call(Function.call,Array.prototype.concat),E=b.call(Function.apply,Array.prototype.splice),T=b.call(Function.call,String.prototype.replace),M=b.call(Function.call,String.prototype.slice),_=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,x=/\\(\\)?/g,A=function(e){var t=M(e,0,1),i=M(e,-1);if("%"===t&&"%"!==i)throw new s("invalid intrinsic syntax, expected closing `%`");if("%"===i&&"%"!==t)throw new s("invalid intrinsic syntax, expected opening `%`");var n=[];return T(e,_,(function(e,t,i,s){n[n.length]=i?T(s,x,"$1"):t||e})),n},O=function(e,t){var i,n=e;if(w(y,n)&&(n="%"+(i=y[n])[0]+"%"),w(v,n)){var o=v[n];if(void 0===o&&!t)throw new r("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:i,name:n,value:o}}throw new s("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new r("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new r('"allowMissing" argument must be a boolean');var i=A(e),n=i.length>0?i[0]:"",o=O("%"+n+"%",t),a=o.name,c=o.value,h=!1,d=o.alias;d&&(n=d[0],E(i,S([0,1],d)));for(var u=1,p=!0;u<i.length;u+=1){var m=i[u],g=M(m,0,1),f=M(m,-1);if(('"'===g||"'"===g||"`"===g||'"'===f||"'"===f||"`"===f)&&g!==f)throw new s("property names with quotes must have matching quotes");if("constructor"!==m&&p||(h=!0),w(v,a="%"+(n+="."+m)+"%"))c=v[a];else if(null!=c){if(!(m in c)){if(!t)throw new r("base intrinsic for "+e+" exists, but the property is not available.");return}if(l&&u+1>=i.length){var y=l(c,m);c=(p=!!y)&&"get"in y&&!("originalValue"in y.get)?y.get:c[m]}else p=w(c,m),c=c[m];p&&!h&&(v[a]=c)}}return c}},6875:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetFloors"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"floors"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"FloorDetails"},directives:[]}]}}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"FloorDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ModelFloor"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"classification"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"label"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"sequence"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"dimensions"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"areaFloor"},arguments:[],directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"PatchFloor"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"floorId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"FloorPatch"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"patchFloor"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"floorId"},value:{kind:"Variable",name:{kind:"Name",value:"floorId"}}},{kind:"Argument",name:{kind:"Name",value:"patch"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:380}};t.loc.source={body:"query GetFloors($modelId: ID!) {\n  model(id: $modelId) {\n    id\n    floors { ...FloorDetails }\n  }\n}\n\nfragment FloorDetails on ModelFloor {\n  id\n  meshId\n  classification\n  label\n  sequence\n  dimensions {\n    areaFloor\n  }\n}\n\nmutation PatchFloor($modelId: ID!, $floorId: ID!, $data: FloorPatch!) {\n  patchFloor(modelId: $modelId, , floorId: $floorId, patch: $data) {\n    id\n  }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}var n={};function s(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function o(e,t){var i={kind:e.kind,definitions:[s(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var o=n[t]||new Set,r=new Set,a=new Set;for(o.forEach((function(e){a.add(e)}));a.size>0;){var l=a;a=new Set,l.forEach((function(e){r.has(e)||(r.add(e),(n[e]||new Set).forEach((function(e){a.add(e)})))}))}return r.forEach((function(t){var n=s(e,t);n&&i.definitions.push(n)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),n[e.name.value]=t}})),e.exports=t,e.exports.GetFloors=o(t,"GetFloors"),e.exports.FloorDetails=o(t,"FloorDetails"),e.exports.PatchFloor=o(t,"PatchFloor")},23637:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetLabels"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeDisabled"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"labels"},arguments:[{kind:"Argument",name:{kind:"Name",value:"includeDisabled"},value:{kind:"Variable",name:{kind:"Name",value:"includeDisabled"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"LabelDetails"},directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AddLabel"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"labelId"}},type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"LabelDetails"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"addLabel"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"labelId"},value:{kind:"Variable",name:{kind:"Name",value:"labelId"}}},{kind:"Argument",name:{kind:"Name",value:"label"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"LabelDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"PatchLabel"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"labelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"LabelPatch"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"patchLabel"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"labelId"},value:{kind:"Variable",name:{kind:"Name",value:"labelId"}}},{kind:"Argument",name:{kind:"Name",value:"patch"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"LabelDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DeleteLabel"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"labelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deleteLabel"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"labelId"},value:{kind:"Variable",name:{kind:"Name",value:"labelId"}}}],directives:[]}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"LabelDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Label"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"position"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"z"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"floor"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"room"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"label"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"enabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"created"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modified"},arguments:[],directives:[]}]}}],loc:{start:0,end:929}};t.loc.source={body:"# Read all labels for the given model\nquery GetLabels($modelId: ID!, $includeDisabled: Boolean!) {\n  model(id: $modelId) {\n    id,\n    labels (includeDisabled: $includeDisabled) {\n      ...LabelDetails\n    }\n  }\n}\n\n# Create a new label\nmutation AddLabel ($modelId: ID!, $labelId: ID, $data: LabelDetails!) {\n  addLabel(modelId: $modelId, labelId: $labelId, label: $data) {\n    ...LabelDetails\n  }\n}\n\n# Update a single label\nmutation PatchLabel ($modelId: ID!, $labelId: ID!, $data: LabelPatch!) {\n  patchLabel(modelId: $modelId, , labelId: $labelId, patch: $data) {\n    ...LabelDetails\n  }\n}\n\n# Deletes a single label\nmutation DeleteLabel ($modelId: ID!, ,$labelId: ID!) {\n  deleteLabel(modelId: $modelId, ,labelId: $labelId)\n}\n\n# Default Label properties used by Showcase and Workshop\nfragment LabelDetails on Label {\n  id\n  position { x y z }\n  floor { id meshId }\n  room { id meshId }\n  label\n  enabled\n  created\n  modified\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}var n={};function s(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function o(e,t){var i={kind:e.kind,definitions:[s(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var o=n[t]||new Set,r=new Set,a=new Set;for(o.forEach((function(e){a.add(e)}));a.size>0;){var l=a;a=new Set,l.forEach((function(e){r.has(e)||(r.add(e),(n[e]||new Set).forEach((function(e){a.add(e)})))}))}return r.forEach((function(t){var n=s(e,t);n&&i.definitions.push(n)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),n[e.name.value]=t}})),e.exports=t,e.exports.GetLabels=o(t,"GetLabels"),e.exports.AddLabel=o(t,"AddLabel"),e.exports.PatchLabel=o(t,"PatchLabel"),e.exports.DeleteLabel=o(t,"DeleteLabel"),e.exports.LabelDetails=o(t,"LabelDetails")},55482:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetMattertags"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeDisabled"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"mattertags"},arguments:[{kind:"Argument",name:{kind:"Name",value:"includeDisabled"},value:{kind:"Variable",name:{kind:"Name",value:"includeDisabled"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"MattertagDetails"},directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AddMattertag"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"mattertagId"}},type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"MattertagDetails"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"addMattertag"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"mattertagId"},value:{kind:"Variable",name:{kind:"Name",value:"mattertagId"}}},{kind:"Argument",name:{kind:"Name",value:"mattertag"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"created"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modified"},arguments:[],directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DeleteMattertag"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"mattertagId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deleteMattertag"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"mattertagId"},value:{kind:"Variable",name:{kind:"Name",value:"mattertagId"}}}],directives:[]}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"MattertagDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Mattertag"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"label"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"description"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"color"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"enabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"floor"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"room"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"anchorPosition"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"z"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"stemEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"stemNormal"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"z"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"stemLength"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"media"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"mediaType"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"created"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modified"},arguments:[],directives:[]}]}}],loc:{start:0,end:930}};t.loc.source={body:"# read all mattertags for the specified model\nquery GetMattertags($modelId: ID!, $includeDisabled: Boolean!) {\n  model(id: $modelId) {\n    id,\n    mattertags(includeDisabled: $includeDisabled) {\n      ...MattertagDetails\n    }\n  }\n}\n\n# add a new mattertag\nmutation AddMattertag($modelId:ID!, $mattertagId: ID, $data: MattertagDetails!) {\n  addMattertag(modelId: $modelId, mattertagId: $mattertagId, mattertag: $data) {\n    id\n    created\n    modified\n  }\n}\n\n# delete an existing tag by id\nmutation DeleteMattertag($modelId: ID!, $mattertagId: ID!) {\n  deleteMattertag(modelId: $modelId, mattertagId: $mattertagId)\n}\n\n# common Mattertag properties used by Showcase and Workshop\nfragment MattertagDetails on Mattertag {\n  id\n  label\n  description\n  color\n  enabled\n  floor { id, meshId }\n  room { id, meshId }\n  anchorPosition { x y z }\n  stemEnabled\n  stemNormal { x, y, z }\n  stemLength\n  media\n  mediaType\n  created\n  modified\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}var n={};function s(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function o(e,t){var i={kind:e.kind,definitions:[s(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var o=n[t]||new Set,r=new Set,a=new Set;for(o.forEach((function(e){a.add(e)}));a.size>0;){var l=a;a=new Set,l.forEach((function(e){r.has(e)||(r.add(e),(n[e]||new Set).forEach((function(e){a.add(e)})))}))}return r.forEach((function(t){var n=s(e,t);n&&i.definitions.push(n)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),n[e.name.value]=t}})),e.exports=t,e.exports.GetMattertags=o(t,"GetMattertags"),e.exports.AddMattertag=o(t,"AddMattertag"),e.exports.DeleteMattertag=o(t,"DeleteMattertag"),e.exports.MattertagDetails=o(t,"MattertagDetails")},52227:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetModelOptions"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"publication"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"options"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PublicationOptions"},directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"options"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ModelOptions"},directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetModelDetails"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"organization"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"visibility"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"image"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ModelImage"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"address"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"AddressDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"publication"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PublicationDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"options"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ModelOptions"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"assets"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"meshes"},arguments:[{kind:"Argument",name:{kind:"Name",value:"formats"},value:{kind:"StringValue",value:"dam",block:!1}},{kind:"Argument",name:{kind:"Name",value:"resolutions"},value:{kind:"ListValue",values:[{kind:"StringValue",value:"50k",block:!1},{kind:"StringValue",value:"500k",block:!1}]}},{kind:"Argument",name:{kind:"Name",value:"compressions"},value:{kind:"EnumValue",value:"none"}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"MeshDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"textures"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"TextureDetails"},directives:[]}]}}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"PatchModel"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"patch"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ModelPatch"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"patchModel"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"patch"},value:{kind:"Variable",name:{kind:"Name",value:"patch"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"MeshDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Mesh"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"filename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"format"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"resolution"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"validUntil"},arguments:[],directives:[]}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"TextureDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Texture"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"format"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"resolution"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"quality"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"urlTemplate"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"validUntil"},arguments:[],directives:[]}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"PublicationDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ModelPublicationDetails"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"published"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"lastPublished"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"presentedBy"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"summary"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"externalUrl"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"contact"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"email"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"phoneNumber"},arguments:[],directives:[]}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"AddressDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Address"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"streetAddressLines"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"administrativeArea"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"locality"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"dependentLocality"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"postalCode"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"sortingCode"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"countryCode"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"countryName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"lines"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"address"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"ModelOptions"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ModelOptions"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"tourButtonsEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"dollhouseEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"dollhouseLabelsEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"floorplanEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"floorSelectEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"labelsEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"highlightReelEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tourFastTransitionsEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"backgroundColor"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"socialSharingEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tourPanAngle"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tourPanSpeed"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tourPanDirection"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tourTransitionSpeed"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tourTransitionTime"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tourZoomDuration"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tourDollhousePanSpeed"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"unitType"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"measurements"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"vrEnabled"},arguments:[],directives:[]}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"PublicationOptions"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ModelPublicationOptions"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"contactEmail"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"contactName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"contactPhone"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modelName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modelSummary"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"presentedBy"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"address"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"externalUrl"},arguments:[],directives:[]}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"ModelImage"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Photo"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",alias:{kind:"Name",value:"thumbnailUrl"},name:{kind:"Name",value:"resizeUrl"},arguments:[{kind:"Argument",name:{kind:"Name",value:"resolution"},value:{kind:"EnumValue",value:"thumbnail"}}],directives:[]},{kind:"Field",alias:{kind:"Name",value:"presentationUrl"},name:{kind:"Name",value:"resizeUrl"},arguments:[{kind:"Argument",name:{kind:"Name",value:"resolution"},value:{kind:"EnumValue",value:"presentation"}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"width"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"height"},arguments:[],directives:[]}]}}],loc:{start:0,end:2042}};t.loc.source={body:'query GetModelOptions($modelId: ID!) {\n  model(id: $modelId) {\n    id\n    publication {\n      options { ...PublicationOptions }\n    }\n    options { ...ModelOptions }\n  }\n}\n\nquery GetModelDetails($modelId: ID!) {\n  model(id: $modelId) {\n    id\n    name\n    organization\n    visibility\n    image { ...ModelImage }\n    address { ...AddressDetails }\n    publication { ...PublicationDetails }\n    options { ...ModelOptions }\n    assets {\n      meshes(formats: "dam", resolutions: ["50k", "500k"], compressions: none) { ...MeshDetails }\n      textures { ...TextureDetails }\n    }\n  }\n}\n\nmutation PatchModel($modelId: ID!, $patch: ModelPatch!) {\n  patchModel(id: $modelId, , patch: $patch) {\n    id\n  }\n}\n\nfragment MeshDetails on Mesh {\n  id\n  status\n  filename\n  format\n  resolution\n  url\n  validUntil\n}\n\nfragment TextureDetails on Texture {\n  id\n  status\n  format\n  resolution\n  quality\n  urlTemplate\n  validUntil\n}\n\nfragment PublicationDetails on ModelPublicationDetails {\n  published\n  lastPublished\n  presentedBy\n  summary\n  externalUrl\n  contact {\n    name\n    email\n    phoneNumber\n  }\n}\n\nfragment AddressDetails on Address {\n  streetAddressLines\n  administrativeArea\n  locality\n  dependentLocality\n  postalCode\n  sortingCode\n  countryCode\n  countryName\n  lines\n  address\n  status\n}\n\nfragment ModelOptions on ModelOptions {\n  tourButtonsEnabled\n  dollhouseEnabled\n  dollhouseLabelsEnabled\n  floorplanEnabled\n  floorSelectEnabled\n  labelsEnabled\n  highlightReelEnabled\n  tourFastTransitionsEnabled\n  backgroundColor\n  socialSharingEnabled\n  tourPanAngle\n  tourPanSpeed\n  tourPanDirection\n  tourTransitionSpeed\n  tourTransitionTime\n  tourZoomDuration\n  tourDollhousePanSpeed\n  unitType\n  measurements\n  vrEnabled\n}\n\nfragment PublicationOptions on ModelPublicationOptions {\n  contactEmail\n  contactName\n  contactPhone\n  modelName\n  modelSummary\n  presentedBy\n  address\n  externalUrl\n}\n\nfragment ModelImage on Photo {\n  id\n  thumbnailUrl: resizeUrl(resolution: thumbnail)\n  presentationUrl: resizeUrl(resolution: presentation)\n  width\n  height\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}var n={};function s(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function o(e,t){var i={kind:e.kind,definitions:[s(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var o=n[t]||new Set,r=new Set,a=new Set;for(o.forEach((function(e){a.add(e)}));a.size>0;){var l=a;a=new Set,l.forEach((function(e){r.has(e)||(r.add(e),(n[e]||new Set).forEach((function(e){a.add(e)})))}))}return r.forEach((function(t){var n=s(e,t);n&&i.definitions.push(n)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),n[e.name.value]=t}})),e.exports=t,e.exports.GetModelOptions=o(t,"GetModelOptions"),e.exports.GetModelDetails=o(t,"GetModelDetails"),e.exports.PatchModel=o(t,"PatchModel"),e.exports.MeshDetails=o(t,"MeshDetails"),e.exports.TextureDetails=o(t,"TextureDetails"),e.exports.PublicationDetails=o(t,"PublicationDetails"),e.exports.AddressDetails=o(t,"AddressDetails"),e.exports.ModelOptions=o(t,"ModelOptions"),e.exports.PublicationOptions=o(t,"PublicationOptions"),e.exports.ModelImage=o(t,"ModelImage")},20619:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetNotes"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeDisabled"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"notes"},arguments:[{kind:"Argument",name:{kind:"Name",value:"includeDisabled"},value:{kind:"Variable",name:{kind:"Name",value:"includeDisabled"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"NoteDetails"},directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AddNote"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"NoteDetails"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"addNote"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"note"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"NoteDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AddNoteComment"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"noteId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CommentDetails"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"addNoteComment"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"noteId"},value:{kind:"Variable",name:{kind:"Name",value:"noteId"}}},{kind:"Argument",name:{kind:"Name",value:"comment"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"CommentDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DeleteComment"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"commentId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deleteComment"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"commentId"},value:{kind:"Variable",name:{kind:"Name",value:"commentId"}}}],directives:[]}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DeleteNote"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"noteId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deleteNote"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"noteId"},value:{kind:"Variable",name:{kind:"Name",value:"noteId"}}}],directives:[]}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"PatchComment"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"commentId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CommentPatch"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"patchComment"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"commentId"},value:{kind:"Variable",name:{kind:"Name",value:"commentId"}}},{kind:"Argument",name:{kind:"Name",value:"patch"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"CommentDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"PatchNote"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"noteId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"NotePatch"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"patchNote"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"noteId"},value:{kind:"Variable",name:{kind:"Name",value:"noteId"}}},{kind:"Argument",name:{kind:"Name",value:"patch"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"NoteDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ReopenNote"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"noteId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"reopenNote"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"noteId"},value:{kind:"Variable",name:{kind:"Name",value:"noteId"}}}],directives:[]}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ResolveNote"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"noteId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"resolveNote"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"noteId"},value:{kind:"Variable",name:{kind:"Name",value:"noteId"}}}],directives:[]}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"ExternalAttachmentDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ExternalAttachment"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"created"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modified"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"thumbnailUrl"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"mediaType"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"category"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"height"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"width"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"parentDetails"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"type"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"parent"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"CommentDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Comment"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"created"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modified"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"edited"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"text"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"createdBy"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"firstName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"lastName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"email"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"externalAttachments"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ExternalAttachmentDetails"},directives:[]}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"NoteDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Note"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"createdBy"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"firstName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"lastName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"email"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"color"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"enabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"floor"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"room"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"anchorPosition"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"z"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"stemEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"stemNormal"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"z"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"stemLength"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"resolution"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"created"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modified"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"lastCommentAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"comments"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"results"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"CommentDetails"},directives:[]}]}}]}}]}}],loc:{start:0,end:2280}};t.loc.source={body:"# read all notes for the specified model\nquery GetNotes($modelId: ID!, $includeDisabled: Boolean!) {\n  model(id: $modelId) {\n    id\n    notes(includeDisabled: $includeDisabled) {\n      ...NoteDetails\n    }\n  }\n}\n\n# Create a new note\nmutation AddNote($modelId: ID!, $data: NoteDetails!) {\n  addNote(modelId: $modelId, , note: $data) {\n    ...NoteDetails\n  }\n}\n\n# Add a comment to the note\nmutation AddNoteComment($modelId: ID!, $noteId: ID!, $data: CommentDetails!) {\n  addNoteComment(modelId: $modelId, , noteId: $noteId, comment: $data) {\n    ...CommentDetails\n  }\n}\n\n# Deletes a single comment\nmutation DeleteComment ($modelId: ID!, $commentId: ID!) {\n  deleteComment(modelId: $modelId, , commentId: $commentId)\n}\n\n# Deletes a single note\nmutation DeleteNote ($modelId: ID!, $noteId: ID!) {\n  deleteNote(modelId: $modelId, , noteId: $noteId)\n}\n\n# Update a single comment\nmutation PatchComment($modelId: ID!, $commentId: ID!, $data: CommentPatch!) {\n  patchComment(modelId: $modelId, , commentId: $commentId, patch: $data) {\n    ...CommentDetails\n  }\n}\n\n# Update a single note\nmutation PatchNote($modelId: ID!, $noteId: ID!, $data: NotePatch!) {\n  patchNote(modelId: $modelId, , noteId: $noteId, patch: $data) {\n    ...NoteDetails\n  }\n}\n\n# Reopen a note\nmutation ReopenNote ($modelId: ID!, $noteId: ID!) {\n  reopenNote(modelId: $modelId, , noteId: $noteId)\n}\n\n# Resolve a note\nmutation ResolveNote($modelId: ID!, $noteId: ID!) {\n  resolveNote(modelId: $modelId, , noteId: $noteId)\n}\n\n# common ExternalAttachment properties\nfragment ExternalAttachmentDetails on ExternalAttachment {\n  id\n  created\n  modified\n  thumbnailUrl\n  url\n  mediaType\n  category\n  height\n  width\n  parentDetails { type, parent { id } }\n}\n\n# common Comment properties\nfragment CommentDetails on Comment {\n  id\n  created\n  modified\n  edited\n  text\n  createdBy { id, firstName, lastName, email }\n  externalAttachments { ...ExternalAttachmentDetails }\n}\n\n# common Note properties\nfragment NoteDetails on Note {\n  id\n  createdBy { id, firstName, lastName, email }\n  color\n  enabled\n  floor { id, meshId }\n  room { id, meshId }\n  anchorPosition { x, y, z }\n  stemEnabled\n  stemNormal { x, y, z }\n  stemLength\n  resolution\n  created\n  modified\n  lastCommentAt\n  comments {\n    results { ...CommentDetails }\n  }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}var n={};function s(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function o(e,t){var i={kind:e.kind,definitions:[s(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var o=n[t]||new Set,r=new Set,a=new Set;for(o.forEach((function(e){a.add(e)}));a.size>0;){var l=a;a=new Set,l.forEach((function(e){r.has(e)||(r.add(e),(n[e]||new Set).forEach((function(e){a.add(e)})))}))}return r.forEach((function(t){var n=s(e,t);n&&i.definitions.push(n)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),n[e.name.value]=t}})),e.exports=t,e.exports.GetNotes=o(t,"GetNotes"),e.exports.AddNote=o(t,"AddNote"),e.exports.AddNoteComment=o(t,"AddNoteComment"),e.exports.DeleteComment=o(t,"DeleteComment"),e.exports.DeleteNote=o(t,"DeleteNote"),e.exports.PatchComment=o(t,"PatchComment"),e.exports.PatchNote=o(t,"PatchNote"),e.exports.ReopenNote=o(t,"ReopenNote"),e.exports.ResolveNote=o(t,"ResolveNote"),e.exports.ExternalAttachmentDetails=o(t,"ExternalAttachmentDetails"),e.exports.CommentDetails=o(t,"CommentDetails"),e.exports.NoteDetails=o(t,"NoteDetails")},24411:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetSnapshots"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"assets"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"photos"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PhotoDetails"},directives:[]}]}}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"PatchPhoto"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"photoId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"label"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"patchPhoto"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"photoId"},value:{kind:"Variable",name:{kind:"Name",value:"photoId"}}},{kind:"Argument",name:{kind:"Name",value:"label"},value:{kind:"Variable",name:{kind:"Name",value:"label"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PhotoDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DeletePhoto"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"photoId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deletePhoto"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"photoId"},value:{kind:"Variable",name:{kind:"Name",value:"photoId"}}}],directives:[]}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"UploadHighlightReelSnapshot"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"contents"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"FileUpload"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"label"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"snapshotLocation"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"SnapshotLocationInput"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"snapshot"},name:{kind:"Name",value:"uploadHighlightReelSnapshot"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"contents"},value:{kind:"Variable",name:{kind:"Name",value:"contents"}}},{kind:"Argument",name:{kind:"Name",value:"label"},value:{kind:"Variable",name:{kind:"Name",value:"label"}}},{kind:"Argument",name:{kind:"Name",value:"snapshotLocation"},value:{kind:"Variable",name:{kind:"Name",value:"snapshotLocation"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PhotoDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"UploadModelSnapshot"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"contents"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"FileUpload"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"label"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"snapshotLocation"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"SnapshotLocationInput"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"photoType"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"PhotoType"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"snapshot"},name:{kind:"Name",value:"uploadModelSnapshot"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"contents"},value:{kind:"Variable",name:{kind:"Name",value:"contents"}}},{kind:"Argument",name:{kind:"Name",value:"label"},value:{kind:"Variable",name:{kind:"Name",value:"label"}}},{kind:"Argument",name:{kind:"Name",value:"snapshotLocation"},value:{kind:"Variable",name:{kind:"Name",value:"snapshotLocation"}}},{kind:"Argument",name:{kind:"Name",value:"photoType"},value:{kind:"Variable",name:{kind:"Name",value:"photoType"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PhotoDetails"},directives:[]}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"PhotoDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Photo"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"label"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"classification"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"category"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"height"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"width"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"created"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modified"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"filename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"format"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"resolutions"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"type"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"origin"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"validUntil"},arguments:[],directives:[]},{kind:"Field",alias:{kind:"Name",value:"thumbnailUrl"},name:{kind:"Name",value:"resizeUrl"},arguments:[{kind:"Argument",name:{kind:"Name",value:"resolution"},value:{kind:"EnumValue",value:"thumbnail"}}],directives:[]},{kind:"Field",alias:{kind:"Name",value:"presentationUrl"},name:{kind:"Name",value:"resizeUrl"},arguments:[{kind:"Argument",name:{kind:"Name",value:"resolution"},value:{kind:"EnumValue",value:"presentation"}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"snapshotLocation"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"viewMode"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"position"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"z"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"rotation"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"z"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"w"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"zoom"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"floorVisibility"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"sequence"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"anchor"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"pano"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"placement"},arguments:[],directives:[]}]}}]}}]}}]}}],loc:{start:0,end:1551}};t.loc.source={body:"query GetSnapshots($modelId: ID!) {\n  model(id: $modelId) {\n    id\n    assets {\n      photos { ...PhotoDetails }\n    }\n  }\n}\n\nmutation PatchPhoto($modelId: ID!, $photoId: ID!, $label: String!) {\n  patchPhoto(modelId: $modelId, photoId: $photoId, label: $label) {\n    ...PhotoDetails\n  }\n}\n\nmutation DeletePhoto($modelId: ID!, $photoId: ID!) {\n  deletePhoto(modelId: $modelId, photoId: $photoId)\n}\n\nmutation UploadHighlightReelSnapshot($modelId: ID!, $contents: FileUpload!, $label: String!, $snapshotLocation: SnapshotLocationInput!) {\n  snapshot: uploadHighlightReelSnapshot(id: $modelId, contents: $contents, label: $label, snapshotLocation: $snapshotLocation) {\n    ...PhotoDetails\n  }\n}\n\nmutation UploadModelSnapshot($modelId: ID!, $contents: FileUpload!, $label: String!, $snapshotLocation: SnapshotLocationInput!, $photoType: PhotoType!) {\n  snapshot: uploadModelSnapshot(id: $modelId, contents: $contents, label: $label, snapshotLocation: $snapshotLocation, photoType: $photoType) {\n    ...PhotoDetails\n  }\n}\n\nfragment PhotoDetails on Photo {\n  id\n  label\n  classification\n  category\n  height\n  width\n  created\n  modified\n  status\n  filename\n  format\n  url\n  resolutions\n  type\n  origin\n  validUntil\n  thumbnailUrl: resizeUrl(resolution: thumbnail)\n  presentationUrl: resizeUrl(resolution: presentation)\n  snapshotLocation {\n    viewMode\n    position { x y z }\n    rotation { x y z w }\n    zoom\n    floorVisibility {\n      id\n      meshId\n      sequence\n    }\n    anchor {\n      id\n      pano {\n        id\n        placement\n      }\n    }\n  }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}var n={};function s(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function o(e,t){var i={kind:e.kind,definitions:[s(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var o=n[t]||new Set,r=new Set,a=new Set;for(o.forEach((function(e){a.add(e)}));a.size>0;){var l=a;a=new Set,l.forEach((function(e){r.has(e)||(r.add(e),(n[e]||new Set).forEach((function(e){a.add(e)})))}))}return r.forEach((function(t){var n=s(e,t);n&&i.definitions.push(n)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),n[e.name.value]=t}})),e.exports=t,e.exports.GetSnapshots=o(t,"GetSnapshots"),e.exports.PatchPhoto=o(t,"PatchPhoto"),e.exports.DeletePhoto=o(t,"DeletePhoto"),e.exports.UploadHighlightReelSnapshot=o(t,"UploadHighlightReelSnapshot"),e.exports.UploadModelSnapshot=o(t,"UploadModelSnapshot"),e.exports.PhotoDetails=o(t,"PhotoDetails")},20540:(e,t,i)=>{var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetModelPrefetch"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"address"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"AddressDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"assets"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"meshes"},arguments:[{kind:"Argument",name:{kind:"Name",value:"formats"},value:{kind:"StringValue",value:"dam",block:!1}},{kind:"Argument",name:{kind:"Name",value:"resolutions"},value:{kind:"ListValue",values:[{kind:"StringValue",value:"50k",block:!1},{kind:"StringValue",value:"500k",block:!1}]}},{kind:"Argument",name:{kind:"Name",value:"compressions"},value:{kind:"EnumValue",value:"none"}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"MeshDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"textures"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"TextureDetails"},directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"floors"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"FloorDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"image"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ModelImage"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"locations"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"AnchorLocationDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"options"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ModelOptions"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"organization"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"publication"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PublicationDetails"},directives:[]},{kind:"Field",name:{kind:"Name",value:"options"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PublicationOptions"},directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"rooms"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"RoomDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"visibility"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:814}};n.loc.source={body:'#import "./floors.gql"\n#import "./model.gql"\n#import "./rooms.gql"\n#import "./photos.gql"\n#import "./sweeps.gql"\n\n# Preloaded model data to be embedded into Showcase HTML page,\n# only load data that is required for Showcase to start (ie. NO Mattertags)\nquery GetModelPrefetch($modelId: ID!) {\n  model(id: $modelId) {\n    id\n    address { ...AddressDetails }\n    assets {\n      meshes(formats: "dam", resolutions: ["50k", "500k"], compressions: none) { ...MeshDetails }\n      textures { ...TextureDetails }\n    }\n    floors { ...FloorDetails }\n    image { ...ModelImage }\n    locations { ...AnchorLocationDetails }\n    name\n    options { ...ModelOptions }\n    organization\n    publication {\n      ...PublicationDetails\n      options { ...PublicationOptions }\n    }\n    rooms { ...RoomDetails }\n    visibility\n  }\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};var s={};function o(e){return e.filter((function(e){if("FragmentDefinition"!==e.kind)return!0;var t=e.name.value;return!s[t]&&(s[t]=!0,!0)}))}function r(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var i=e.type;"NamedType"===i.kind&&t.add(i.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){r(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){r(e,t)})),e.definitions&&e.definitions.forEach((function(e){r(e,t)}))}n.definitions=n.definitions.concat(o(i(6875).definitions)),n.definitions=n.definitions.concat(o(i(52227).definitions)),n.definitions=n.definitions.concat(o(i(52050).definitions)),n.definitions=n.definitions.concat(o(i(24411).definitions)),n.definitions=n.definitions.concat(o(i(36690).definitions));var a={};function l(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}n.definitions.forEach((function(e){if(e.name){var t=new Set;r(e,t),a[e.name.value]=t}})),e.exports=n,e.exports.GetModelPrefetch=function(e,t){var i={kind:e.kind,definitions:[l(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var n=a[t]||new Set,s=new Set,o=new Set;for(n.forEach((function(e){o.add(e)}));o.size>0;){var r=o;o=new Set,r.forEach((function(e){s.has(e)||(s.add(e),(a[e]||new Set).forEach((function(e){o.add(e)})))}))}return s.forEach((function(t){var n=l(e,t);n&&i.definitions.push(n)})),i}(n,"GetModelPrefetch")},52050:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetRooms"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"rooms"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"RoomDetails"},directives:[]}]}}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"RoomDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ModelRoom"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"floor"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"dimensions"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"height"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"width"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"depth"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"areaFloor"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"tags"},arguments:[],directives:[]}]}}],loc:{start:0,end:266}};t.loc.source={body:"\nquery GetRooms ($modelId: ID!) {\n  model(id: $modelId) {\n    id\n    rooms {\n      ...RoomDetails\n    }\n  }\n}\n\nfragment RoomDetails on ModelRoom {\n  id\n  meshId\n  floor {\n    id\n    meshId\n  }\n  dimensions {\n    height\n    width\n    depth\n    areaFloor\n  }\n  tags\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}var n={};function s(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function o(e,t){var i={kind:e.kind,definitions:[s(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var o=n[t]||new Set,r=new Set,a=new Set;for(o.forEach((function(e){a.add(e)}));a.size>0;){var l=a;a=new Set,l.forEach((function(e){r.has(e)||(r.add(e),(n[e]||new Set).forEach((function(e){a.add(e)})))}))}return r.forEach((function(t){var n=s(e,t);n&&i.definitions.push(n)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),n[e.name.value]=t}})),e.exports=t,e.exports.GetRooms=o(t,"GetRooms"),e.exports.RoomDetails=o(t,"RoomDetails")},36690:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetSweeps"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"locations"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"AnchorLocationDetails"},directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetShowcaseSweeps"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"locations"},arguments:[{kind:"Argument",name:{kind:"Name",value:"tags"},value:{kind:"StringValue",value:"showcase",block:!1}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"AnchorLocationDetails"},directives:[]}]}}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"SkyboxDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"SkyboxPanorama"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"resolution"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"urlTemplate"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tileResolution"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tileCount"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tileUrlTemplate"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"validUntil"},arguments:[],directives:[]}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"SkyboxUrlDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"PanoramicImageLocation"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"resolutions"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"skyboxes"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"SkyboxDetails"},directives:[]}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"AnchorLocationDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"AnchorLocation"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"index"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"floor"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"room"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"neighbors"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tags"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"position"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"z"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"pano"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"sweepUuid"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"label"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"placement"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"source"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"position"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"z"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"rotation"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"z"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"w"},arguments:[],directives:[]}]}},{kind:"FragmentSpread",name:{kind:"Name",value:"SkyboxUrlDetails"},directives:[]}]}}]}}],loc:{start:0,end:954}};t.loc.source={body:'\nquery GetSweeps($modelId: ID!) {\n  model(id: $modelId) {\n    id,\n    locations {\n      ...AnchorLocationDetails\n    }\n  }\n}\n\nquery GetShowcaseSweeps($modelId: ID!) {\n  model(id: $modelId) {\n    id,\n    locations(tags: "showcase") {\n      ...AnchorLocationDetails\n    }\n  }\n}\n\nfragment SkyboxDetails on SkyboxPanorama {\n  # TODO(PL-5928) all SkyboxDetail results have the same non-unique id,\n  # using it as a map key will yield unexpected results\n  # id\n  resolution\n  status\n  urlTemplate\n  tileResolution\n  tileCount\n  tileUrlTemplate\n  validUntil\n}\n\nfragment SkyboxUrlDetails on PanoramicImageLocation {\n  id\n  resolutions\n  skyboxes { ...SkyboxDetails }\n}\n\nfragment AnchorLocationDetails on AnchorLocation {\n  id\n  index\n  floor { id, meshId }\n  room { id, meshId }\n  neighbors\n  tags\n  position { x y z }\n  pano {\n    id\n    sweepUuid\n    label\n    placement\n    source\n    position { x y z }\n    rotation { x y z w }\n    ...SkyboxUrlDetails\n  }\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}var n={};function s(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function o(e,t){var i={kind:e.kind,definitions:[s(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var o=n[t]||new Set,r=new Set,a=new Set;for(o.forEach((function(e){a.add(e)}));a.size>0;){var l=a;a=new Set,l.forEach((function(e){r.has(e)||(r.add(e),(n[e]||new Set).forEach((function(e){a.add(e)})))}))}return r.forEach((function(t){var n=s(e,t);n&&i.definitions.push(n)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),n[e.name.value]=t}})),e.exports=t,e.exports.GetSweeps=o(t,"GetSweeps"),e.exports.GetShowcaseSweeps=o(t,"GetShowcaseSweeps"),e.exports.SkyboxDetails=o(t,"SkyboxDetails"),e.exports.SkyboxUrlDetails=o(t,"SkyboxUrlDetails"),e.exports.AnchorLocationDetails=o(t,"AnchorLocationDetails")},8260:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetUsers"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"search"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"ids"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"emails"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"users"},arguments:[{kind:"Argument",name:{kind:"Name",value:"search"},value:{kind:"Variable",name:{kind:"Name",value:"search"}}},{kind:"Argument",name:{kind:"Name",value:"ids"},value:{kind:"Variable",name:{kind:"Name",value:"ids"}}},{kind:"Argument",name:{kind:"Name",value:"emails"},value:{kind:"Variable",name:{kind:"Name",value:"emails"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"results"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"email"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"firstName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"lastName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modelAccess"},arguments:[],directives:[]}]}}]}}]}}]}}],loc:{start:0,end:326}};t.loc.source={body:"# get users with access to the specified model\nquery GetUsers($modelId: ID!, $search: String, $ids: [ID!], $emails: [String!]) {\n  model(id: $modelId) {\n    users(search: $search, ids: $ids, emails: $emails) {\n      results {\n        id\n        email\n        firstName\n        lastName\n        modelAccess\n      }\n    }\n  }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}var n={};function s(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),n[e.name.value]=t}})),e.exports=t,e.exports.GetUsers=function(e,t){var i={kind:e.kind,definitions:[s(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var o=n[t]||new Set,r=new Set,a=new Set;for(o.forEach((function(e){a.add(e)}));a.size>0;){var l=a;a=new Set,l.forEach((function(e){r.has(e)||(r.add(e),(n[e]||new Set).forEach((function(e){a.add(e)})))}))}return r.forEach((function(t){var n=s(e,t);n&&i.definitions.push(n)})),i}(t,"GetUsers")},20517:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetMergeDiff"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"viewId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"viewId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"mergeDiff"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"src"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"dest"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"typesModified"},arguments:[],directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetViews"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"views"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"type"},arguments:[],directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"PublishView"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"viewId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"mergeMutator"},arguments:[{kind:"Argument",name:{kind:"Name",value:"src"},value:{kind:"Variable",name:{kind:"Name",value:"viewId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"merge"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"RevertView"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"viewId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"mergeTypes"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"MergeableType"}}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"mergeMutator"},arguments:[{kind:"Argument",name:{kind:"Name",value:"src"},value:{kind:"Variable",name:{kind:"Name",value:"viewId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"revert"},arguments:[{kind:"Argument",name:{kind:"Name",value:"types"},value:{kind:"Variable",name:{kind:"Name",value:"mergeTypes"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:721}};t.loc.source={body:"\n# Gets the data types that have changed between a view and the base model\nquery GetMergeDiff($viewId: ID!) {\n  model(id: $viewId) {\n    id\n    mergeDiff {\n      src\n      dest\n      typesModified\n    }\n  }\n}\n\n# Get available views for a model\nquery GetViews($modelId: ID!) {\n  model(id: $modelId) {\n    id\n    views {\n      id\n      type\n    }\n  }\n}\n\n# Merges the given view into the base model view\nmutation PublishView($viewId: ID!) {\n  mergeMutator(src: $viewId) {\n    merge {\n      id\n    }\n  }\n}\n\n# Resets the provided view to be the same as the base model view\nmutation RevertView($viewId: ID!, $mergeTypes: [MergeableType!]) {\n  mergeMutator(src: $viewId) {\n    revert(types: $mergeTypes ) {\n      id\n    }\n  }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}var n={};function s(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function o(e,t){var i={kind:e.kind,definitions:[s(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var o=n[t]||new Set,r=new Set,a=new Set;for(o.forEach((function(e){a.add(e)}));a.size>0;){var l=a;a=new Set,l.forEach((function(e){r.has(e)||(r.add(e),(n[e]||new Set).forEach((function(e){a.add(e)})))}))}return r.forEach((function(t){var n=s(e,t);n&&i.definitions.push(n)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),n[e.name.value]=t}})),e.exports=t,e.exports.GetMergeDiff=o(t,"GetMergeDiff"),e.exports.GetViews=o(t,"GetViews"),e.exports.PublishView=o(t,"PublishView"),e.exports.RevertView=o(t,"RevertView")},50972:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=e.prototype.toJSON;"function"==typeof t||(0,n.default)(0),e.prototype.inspect=t,s.default&&(e.prototype[s.default]=t)};var n=o(i(7706)),s=o(i(18554));function o(e){return e&&e.__esModule?e:{default:e}}},8002:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return r(e,[])};var n,s=(n=i(18554))&&n.__esModule?n:{default:n};function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){switch(o(e)){case"string":return JSON.stringify(e);case"function":return e.name?"[function ".concat(e.name,"]"):"[function]";case"object":return null===e?"null":function(e,t){if(-1!==t.indexOf(e))return"[Circular]";var i=[].concat(t,[e]),n=function(e){var t=e[String(s.default)];if("function"==typeof t)return t;if("function"==typeof e.inspect)return e.inspect}(e);if(void 0!==n){var o=n.call(e);if(o!==e)return"string"==typeof o?o:r(o,i)}else if(Array.isArray(e))return function(e,t){if(0===e.length)return"[]";if(t.length>2)return"[Array]";for(var i=Math.min(10,e.length),n=e.length-i,s=[],o=0;o<i;++o)s.push(r(e[o],t));1===n?s.push("... 1 more item"):n>1&&s.push("... ".concat(n," more items"));return"["+s.join(", ")+"]"}(e,i);return function(e,t){var i=Object.keys(e);if(0===i.length)return"{}";if(t.length>2)return"["+function(e){var t=Object.prototype.toString.call(e).replace(/^\[object /,"").replace(/]$/,"");if("Object"===t&&"function"==typeof e.constructor){var i=e.constructor.name;if("string"==typeof i&&""!==i)return i}return t}(e)+"]";return"{ "+i.map((function(i){return i+": "+r(e[i],t)})).join(", ")+" }"}(e,i)}(e,t);default:return String(e)}}},6589:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o});var n=i(97986);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e){return r(e,[])}function r(e,t){switch(s(e)){case"string":return JSON.stringify(e);case"function":return e.name?"[function ".concat(e.name,"]"):"[function]";case"object":return null===e?"null":function(e,t){if(-1!==t.indexOf(e))return"[Circular]";var i=[].concat(t,[e]),s=function(e){var t=e[String(n.Z)];if("function"==typeof t)return t;if("function"==typeof e.inspect)return e.inspect}(e);if(void 0!==s){var o=s.call(e);if(o!==e)return"string"==typeof o?o:r(o,i)}else if(Array.isArray(e))return function(e,t){if(0===e.length)return"[]";if(t.length>2)return"[Array]";for(var i=Math.min(10,e.length),n=e.length-i,s=[],o=0;o<i;++o)s.push(r(e[o],t));1===n?s.push("... 1 more item"):n>1&&s.push("... ".concat(n," more items"));return"["+s.join(", ")+"]"}(e,i);return function(e,t){var i=Object.keys(e);if(0===i.length)return"{}";if(t.length>2)return"["+function(e){var t=Object.prototype.toString.call(e).replace(/^\[object /,"").replace(/]$/,"");if("Object"===t&&"function"==typeof e.constructor){var i=e.constructor.name;if("string"==typeof i&&""!==i)return i}return t}(e)+"]";return"{ "+i.map((function(i){return i+": "+r(e[i],t)})).join(", ")+" }"}(e,i)}(e,t);default:return String(e)}}},7706:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(!Boolean(e))throw new Error(null!=t?t:"Unexpected invariant triggered.")}},18554:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):void 0;t.default=i},97986:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});const n="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):void 0},91807:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isNode=function(e){return null!=e&&"string"==typeof e.kind},t.Token=t.Location=void 0;var n,s=(n=i(50972))&&n.__esModule?n:{default:n};var o=function(){function e(e,t,i){this.start=e.start,this.end=t.end,this.startToken=e,this.endToken=t,this.source=i}return e.prototype.toJSON=function(){return{start:this.start,end:this.end}},e}();t.Location=o,(0,s.default)(o);var r=function(){function e(e,t,i,n,s,o,r){this.kind=e,this.start=t,this.end=i,this.line=n,this.column=s,this.value=r,this.prev=o,this.next=null}return e.prototype.toJSON=function(){return{kind:this.kind,value:this.value,line:this.line,column:this.column}},e}();t.Token=r,(0,s.default)(r)},83059:(e,t,i)=>{"use strict";i.d(t,{Ye:()=>o,WU:()=>r,UG:()=>a});var n=i(97986);function s(e){var t=e.prototype.toJSON;"function"==typeof t||function(e,t){if(!Boolean(e))throw new Error(null!=t?t:"Unexpected invariant triggered.")}(0),e.prototype.inspect=t,n.Z&&(e.prototype[n.Z]=t)}var o=function(){function e(e,t,i){this.start=e.start,this.end=t.end,this.startToken=e,this.endToken=t,this.source=i}return e.prototype.toJSON=function(){return{start:this.start,end:this.end}},e}();s(o);var r=function(){function e(e,t,i,n,s,o,r){this.kind=e,this.start=t,this.end=i,this.line=n,this.column=s,this.value=r,this.prev=o,this.next=null}return e.prototype.toJSON=function(){return{kind:this.kind,value:this.value,line:this.line,column:this.column}},e}();function a(e){return null!=e&&"string"==typeof e.kind}s(r)},7420:(e,t,i)=>{"use strict";function n(e){var t=e.split(/\r\n|[\n\r]/g),i=function(e){for(var t,i=!0,n=!0,s=0,o=null,r=0;r<e.length;++r)switch(e.charCodeAt(r)){case 13:10===e.charCodeAt(r+1)&&++r;case 10:i=!1,n=!0,s=0;break;case 9:case 32:++s;break;default:n&&!i&&(null===o||s<o)&&(o=s),n=!1}return null!==(t=o)&&void 0!==t?t:0}(e);if(0!==i)for(var n=1;n<t.length;n++)t[n]=t[n].slice(i);for(var o=0;o<t.length&&s(t[o]);)++o;for(var r=t.length;r>o&&s(t[r-1]);)--r;return t.slice(o,r).join("\n")}function s(e){for(var t=0;t<e.length;++t)if(" "!==e[t]&&"\t"!==e[t])return!1;return!0}function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=-1===e.indexOf("\n"),s=" "===e[0]||"\t"===e[0],o='"'===e[e.length-1],r="\\"===e[e.length-1],a=!n||o||r||i,l="";return!a||n&&s||(l+="\n"+t),l+=t?e.replace(/\n/g,"\n"+t):e,a&&(l+="\n"),'"""'+l.replace(/"""/g,'\\"""')+'"""'}i.d(t,{W7:()=>n,LZ:()=>o})},90778:(e,t,i)=>{"use strict";i.d(t,{S:()=>o});var n=i(27636),s=i(7420);function o(e){return(0,n.Vn)(e,{leave:r})}var r={Name:function(e){return e.value},Variable:function(e){return"$"+e.name},Document:function(e){return l(e.definitions,"\n\n")+"\n"},OperationDefinition:function(e){var t=e.operation,i=e.name,n=h("(",l(e.variableDefinitions,", "),")"),s=l(e.directives," "),o=e.selectionSet;return i||s||n||"query"!==t?l([t,l([i,n]),s,o]," "):o},VariableDefinition:function(e){var t=e.variable,i=e.type,n=e.defaultValue,s=e.directives;return t+": "+i+h(" = ",n)+h(" ",l(s," "))},SelectionSet:function(e){return c(e.selections)},Field:function(e){var t=e.alias,i=e.name,n=e.arguments,s=e.directives,o=e.selectionSet,r=h("",t,": ")+i,a=r+h("(",l(n,", "),")");return a.length>80&&(a=r+h("(\n",d(l(n,"\n")),"\n)")),l([a,l(s," "),o]," ")},Argument:function(e){return e.name+": "+e.value},FragmentSpread:function(e){return"..."+e.name+h(" ",l(e.directives," "))},InlineFragment:function(e){var t=e.typeCondition,i=e.directives,n=e.selectionSet;return l(["...",h("on ",t),l(i," "),n]," ")},FragmentDefinition:function(e){var t=e.name,i=e.typeCondition,n=e.variableDefinitions,s=e.directives,o=e.selectionSet;return"fragment ".concat(t).concat(h("(",l(n,", "),")")," ")+"on ".concat(i," ").concat(h("",l(s," ")," "))+o},IntValue:function(e){return e.value},FloatValue:function(e){return e.value},StringValue:function(e,t){var i=e.value;return e.block?(0,s.LZ)(i,"description"===t?"":"  "):JSON.stringify(i)},BooleanValue:function(e){return e.value?"true":"false"},NullValue:function(){return"null"},EnumValue:function(e){return e.value},ListValue:function(e){return"["+l(e.values,", ")+"]"},ObjectValue:function(e){return"{"+l(e.fields,", ")+"}"},ObjectField:function(e){return e.name+": "+e.value},Directive:function(e){return"@"+e.name+h("(",l(e.arguments,", "),")")},NamedType:function(e){return e.name},ListType:function(e){return"["+e.type+"]"},NonNullType:function(e){return e.type+"!"},SchemaDefinition:a((function(e){var t=e.directives,i=e.operationTypes;return l(["schema",l(t," "),c(i)]," ")})),OperationTypeDefinition:function(e){return e.operation+": "+e.type},ScalarTypeDefinition:a((function(e){return l(["scalar",e.name,l(e.directives," ")]," ")})),ObjectTypeDefinition:a((function(e){var t=e.name,i=e.interfaces,n=e.directives,s=e.fields;return l(["type",t,h("implements ",l(i," & ")),l(n," "),c(s)]," ")})),FieldDefinition:a((function(e){var t=e.name,i=e.arguments,n=e.type,s=e.directives;return t+(p(i)?h("(\n",d(l(i,"\n")),"\n)"):h("(",l(i,", "),")"))+": "+n+h(" ",l(s," "))})),InputValueDefinition:a((function(e){var t=e.name,i=e.type,n=e.defaultValue,s=e.directives;return l([t+": "+i,h("= ",n),l(s," ")]," ")})),InterfaceTypeDefinition:a((function(e){var t=e.name,i=e.interfaces,n=e.directives,s=e.fields;return l(["interface",t,h("implements ",l(i," & ")),l(n," "),c(s)]," ")})),UnionTypeDefinition:a((function(e){var t=e.name,i=e.directives,n=e.types;return l(["union",t,l(i," "),n&&0!==n.length?"= "+l(n," | "):""]," ")})),EnumTypeDefinition:a((function(e){var t=e.name,i=e.directives,n=e.values;return l(["enum",t,l(i," "),c(n)]," ")})),EnumValueDefinition:a((function(e){return l([e.name,l(e.directives," ")]," ")})),InputObjectTypeDefinition:a((function(e){var t=e.name,i=e.directives,n=e.fields;return l(["input",t,l(i," "),c(n)]," ")})),DirectiveDefinition:a((function(e){var t=e.name,i=e.arguments,n=e.repeatable,s=e.locations;return"directive @"+t+(p(i)?h("(\n",d(l(i,"\n")),"\n)"):h("(",l(i,", "),")"))+(n?" repeatable":"")+" on "+l(s," | ")})),SchemaExtension:function(e){var t=e.directives,i=e.operationTypes;return l(["extend schema",l(t," "),c(i)]," ")},ScalarTypeExtension:function(e){return l(["extend scalar",e.name,l(e.directives," ")]," ")},ObjectTypeExtension:function(e){var t=e.name,i=e.interfaces,n=e.directives,s=e.fields;return l(["extend type",t,h("implements ",l(i," & ")),l(n," "),c(s)]," ")},InterfaceTypeExtension:function(e){var t=e.name,i=e.interfaces,n=e.directives,s=e.fields;return l(["extend interface",t,h("implements ",l(i," & ")),l(n," "),c(s)]," ")},UnionTypeExtension:function(e){var t=e.name,i=e.directives,n=e.types;return l(["extend union",t,l(i," "),n&&0!==n.length?"= "+l(n," | "):""]," ")},EnumTypeExtension:function(e){var t=e.name,i=e.directives,n=e.values;return l(["extend enum",t,l(i," "),c(n)]," ")},InputObjectTypeExtension:function(e){var t=e.name,i=e.directives,n=e.fields;return l(["extend input",t,l(i," "),c(n)]," ")}};function a(e){return function(t){return l([t.description,e(t)],"\n")}}function l(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return null!==(t=null==e?void 0:e.filter((function(e){return e})).join(i))&&void 0!==t?t:""}function c(e){return h("{\n",d(l(e,"\n")),"\n}")}function h(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return null!=t&&""!==t?e+t+i:""}function d(e){return h("  ",e.replace(/\n/g,"\n  "))}function u(e){return-1!==e.indexOf("\n")}function p(e){return null!=e&&e.some(u)}},80285:(e,t,i)=>{"use strict";t.Vn=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r,n=void 0,c=Array.isArray(e),h=[e],d=-1,u=[],p=void 0,m=void 0,g=void 0,f=[],v=[],y=e;do{var b=++d===h.length,w=b&&0!==u.length;if(b){if(m=0===v.length?void 0:f[f.length-1],p=g,g=v.pop(),w){if(c)p=p.slice();else{for(var S={},E=0,T=Object.keys(p);E<T.length;E++){var M=T[E];S[M]=p[M]}p=S}for(var _=0,x=0;x<u.length;x++){var A=u[x][0],O=u[x][1];c&&(A-=_),c&&null===O?(p.splice(A,1),_++):p[A]=O}}d=n.index,h=n.keys,u=n.edits,c=n.inArray,n=n.prev}else{if(m=g?c?d:h[d]:void 0,null==(p=g?g[m]:y))continue;g&&f.push(m)}var P,C=void 0;if(!Array.isArray(p)){if(!(0,o.isNode)(p))throw new Error("Invalid AST Node: ".concat((0,s.default)(p),"."));var D=l(t,p.kind,b);if(D){if((C=D.call(t,p,m,g,f,v))===a)break;if(!1===C){if(!b){f.pop();continue}}else if(void 0!==C&&(u.push([m,C]),!b)){if(!(0,o.isNode)(C)){f.pop();continue}p=C}}}if(void 0===C&&w&&u.push([m,p]),b)f.pop();else n={inArray:c,index:d,keys:h,edits:u,prev:n},c=Array.isArray(p),h=c?p:null!==(P=i[p.kind])&&void 0!==P?P:[],d=-1,u=[],g&&v.push(g),g=p}while(void 0!==n);0!==u.length&&(y=u[u.length-1][1]);return y};var n,s=(n=i(8002))&&n.__esModule?n:{default:n},o=i(91807);var r={Name:[],Document:["definitions"],OperationDefinition:["name","variableDefinitions","directives","selectionSet"],VariableDefinition:["variable","type","defaultValue","directives"],Variable:["name"],SelectionSet:["selections"],Field:["alias","name","arguments","directives","selectionSet"],Argument:["name","value"],FragmentSpread:["name","directives"],InlineFragment:["typeCondition","directives","selectionSet"],FragmentDefinition:["name","variableDefinitions","typeCondition","directives","selectionSet"],IntValue:[],FloatValue:[],StringValue:[],BooleanValue:[],NullValue:[],EnumValue:[],ListValue:["values"],ObjectValue:["fields"],ObjectField:["name","value"],Directive:["name","arguments"],NamedType:["name"],ListType:["type"],NonNullType:["type"],SchemaDefinition:["description","directives","operationTypes"],OperationTypeDefinition:["type"],ScalarTypeDefinition:["description","name","directives"],ObjectTypeDefinition:["description","name","interfaces","directives","fields"],FieldDefinition:["description","name","arguments","type","directives"],InputValueDefinition:["description","name","type","defaultValue","directives"],InterfaceTypeDefinition:["description","name","interfaces","directives","fields"],UnionTypeDefinition:["description","name","directives","types"],EnumTypeDefinition:["description","name","directives","values"],EnumValueDefinition:["description","name","directives"],InputObjectTypeDefinition:["description","name","directives","fields"],DirectiveDefinition:["description","name","arguments","locations"],SchemaExtension:["directives","operationTypes"],ScalarTypeExtension:["name","directives"],ObjectTypeExtension:["name","interfaces","directives","fields"],InterfaceTypeExtension:["name","interfaces","directives","fields"],UnionTypeExtension:["name","directives","types"],EnumTypeExtension:["name","directives","values"],InputObjectTypeExtension:["name","directives","fields"]};var a=Object.freeze({});function l(e,t,i){var n=e[t];if(n){if(!i&&"function"==typeof n)return n;var s=i?n.leave:n.enter;if("function"==typeof s)return s}else{var o=i?e.leave:e.enter;if(o){if("function"==typeof o)return o;var r=o[t];if("function"==typeof r)return r}}}},27636:(e,t,i)=>{"use strict";i.d(t,{$_:()=>r,Vn:()=>a});var n=i(6589),s=i(83059),o={Name:[],Document:["definitions"],OperationDefinition:["name","variableDefinitions","directives","selectionSet"],VariableDefinition:["variable","type","defaultValue","directives"],Variable:["name"],SelectionSet:["selections"],Field:["alias","name","arguments","directives","selectionSet"],Argument:["name","value"],FragmentSpread:["name","directives"],InlineFragment:["typeCondition","directives","selectionSet"],FragmentDefinition:["name","variableDefinitions","typeCondition","directives","selectionSet"],IntValue:[],FloatValue:[],StringValue:[],BooleanValue:[],NullValue:[],EnumValue:[],ListValue:["values"],ObjectValue:["fields"],ObjectField:["name","value"],Directive:["name","arguments"],NamedType:["name"],ListType:["type"],NonNullType:["type"],SchemaDefinition:["description","directives","operationTypes"],OperationTypeDefinition:["type"],ScalarTypeDefinition:["description","name","directives"],ObjectTypeDefinition:["description","name","interfaces","directives","fields"],FieldDefinition:["description","name","arguments","type","directives"],InputValueDefinition:["description","name","type","defaultValue","directives"],InterfaceTypeDefinition:["description","name","interfaces","directives","fields"],UnionTypeDefinition:["description","name","directives","types"],EnumTypeDefinition:["description","name","directives","values"],EnumValueDefinition:["description","name","directives"],InputObjectTypeDefinition:["description","name","directives","fields"],DirectiveDefinition:["description","name","arguments","locations"],SchemaExtension:["directives","operationTypes"],ScalarTypeExtension:["name","directives"],ObjectTypeExtension:["name","interfaces","directives","fields"],InterfaceTypeExtension:["name","interfaces","directives","fields"],UnionTypeExtension:["name","directives","types"],EnumTypeExtension:["name","directives","values"],InputObjectTypeExtension:["name","directives","fields"]},r=Object.freeze({});function a(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o,a=void 0,c=Array.isArray(e),h=[e],d=-1,u=[],p=void 0,m=void 0,g=void 0,f=[],v=[],y=e;do{var b=++d===h.length,w=b&&0!==u.length;if(b){if(m=0===v.length?void 0:f[f.length-1],p=g,g=v.pop(),w){if(c)p=p.slice();else{for(var S={},E=0,T=Object.keys(p);E<T.length;E++){var M=T[E];S[M]=p[M]}p=S}for(var _=0,x=0;x<u.length;x++){var A=u[x][0],O=u[x][1];c&&(A-=_),c&&null===O?(p.splice(A,1),_++):p[A]=O}}d=a.index,h=a.keys,u=a.edits,c=a.inArray,a=a.prev}else{if(m=g?c?d:h[d]:void 0,null==(p=g?g[m]:y))continue;g&&f.push(m)}var P,C=void 0;if(!Array.isArray(p)){if(!(0,s.UG)(p))throw new Error("Invalid AST Node: ".concat((0,n.Z)(p),"."));var D=l(t,p.kind,b);if(D){if((C=D.call(t,p,m,g,f,v))===r)break;if(!1===C){if(!b){f.pop();continue}}else if(void 0!==C&&(u.push([m,C]),!b)){if(!(0,s.UG)(C)){f.pop();continue}p=C}}}if(void 0===C&&w&&u.push([m,p]),b)f.pop();else a={inArray:c,index:d,keys:h,edits:u,prev:a},h=(c=Array.isArray(p))?p:null!==(P=i[p.kind])&&void 0!==P?P:[],d=-1,u=[],g&&v.push(g),g=p}while(void 0!==a);return 0!==u.length&&(y=u[u.length-1][1]),y}function l(e,t,i){var n=e[t];if(n){if(!i&&"function"==typeof n)return n;var s=i?n.leave:n.enter;if("function"==typeof s)return s}else{var o=i?e.leave:e.enter;if(o){if("function"==typeof o)return o;var r=o[t];if("function"==typeof r)return r}}}},41405:(e,t,i)=>{"use strict";var n=i.g.Symbol,s=i(55419);e.exports=function(){return"function"==typeof n&&("function"==typeof Symbol&&("symbol"==typeof n("foo")&&("symbol"==typeof Symbol("bar")&&s())))}},55419:e=>{"use strict";e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),i=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(i))return!1;for(t in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var n=Object.getOwnPropertySymbols(e);if(1!==n.length||n[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var s=Object.getOwnPropertyDescriptor(e,t);if(42!==s.value||!0!==s.enumerable)return!1}return!0}},17642:(e,t,i)=>{"use strict";var n=i(58612);e.exports=n.call(Function.call,Object.prototype.hasOwnProperty)},80645:(e,t)=>{t.read=function(e,t,i,n,s){var o,r,a=8*s-n-1,l=(1<<a)-1,c=l>>1,h=-7,d=i?s-1:0,u=i?-1:1,p=e[t+d];for(d+=u,o=p&(1<<-h)-1,p>>=-h,h+=a;h>0;o=256*o+e[t+d],d+=u,h-=8);for(r=o&(1<<-h)-1,o>>=-h,h+=n;h>0;r=256*r+e[t+d],d+=u,h-=8);if(0===o)o=1-c;else{if(o===l)return r?NaN:1/0*(p?-1:1);r+=Math.pow(2,n),o-=c}return(p?-1:1)*r*Math.pow(2,o-n)},t.write=function(e,t,i,n,s,o){var r,a,l,c=8*o-s-1,h=(1<<c)-1,d=h>>1,u=23===s?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:o-1,m=n?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,r=h):(r=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-r))<1&&(r--,l*=2),(t+=r+d>=1?u/l:u*Math.pow(2,1-d))*l>=2&&(r++,l/=2),r+d>=h?(a=0,r=h):r+d>=1?(a=(t*l-1)*Math.pow(2,s),r+=d):(a=t*Math.pow(2,d-1)*Math.pow(2,s),r=0));s>=8;e[i+p]=255&a,p+=m,a/=256,s-=8);for(r=r<<s|a,c+=s;c>0;e[i+p]=255&r,p+=m,r/=256,c-=8);e[i+p-m]|=128*g}},35717:e=>{"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var i=function(){};i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}}},48738:e=>{function t(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}e.exports=function(e){return null!=e&&(t(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&t(e.slice(0,0))}(e)||!!e._isBuffer)}},95320:e=>{"use strict";var t,i,n=Function.prototype.toString,s="object"==typeof Reflect&&null!==Reflect&&Reflect.apply;if("function"==typeof s&&"function"==typeof Object.defineProperty)try{t=Object.defineProperty({},"length",{get:function(){throw i}}),i={},s((function(){throw 42}),null,t)}catch(e){e!==i&&(s=null)}else s=null;var o=/^\s*class\b/,r=function(e){try{var t=n.call(e);return o.test(t)}catch(e){return!1}},a=Object.prototype.toString,l="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag;e.exports=s?function(e){if(!e)return!1;if("function"!=typeof e&&"object"!=typeof e)return!1;if("function"==typeof e&&!e.prototype)return!0;try{s(e,null,t)}catch(e){if(e!==i)return!1}return!r(e)}:function(e){if(!e)return!1;if("function"!=typeof e&&"object"!=typeof e)return!1;if("function"==typeof e&&!e.prototype)return!0;if(l)return function(e){try{return!r(e)&&(n.call(e),!0)}catch(e){return!1}}(e);if(r(e))return!1;var t=a.call(e);return"[object Function]"===t||"[object GeneratorFunction]"===t}},73134:(e,t,i)=>{var n=i(12739),s=i(47529),o=i(14176),r=["x","e","a","o","n","s","r","c","u","m","v","w","z"],a=["m","w"],l=["H","I","N","E","F","K","L","T","U","V","W","X","Y","Z"],c="\t".charCodeAt(0),h=" ".charCodeAt(0);function d(e){this.glyphs=[],this._measure=this.computeMetrics.bind(this),this.update(e)}function u(e){return new Function(["return function "+e+"() {","  return this._"+e,"}"].join("\n"))()}function p(e,t){if(!e.chars||0===e.chars.length)return null;var i=g(e.chars,t);return i>=0?e.chars[i]:null}function m(e,t,i){if(!e.kernings||0===e.kernings.length)return 0;for(var n=e.kernings,s=0;s<n.length;s++){var o=n[s];if(o.first===t&&o.second===i)return o.amount}return 0}function g(e,t,i){for(var n=i=i||0;n<e.length;n++)if(e[n].id===t)return n;return-1}e.exports=function(e){return new d(e)},d.prototype.update=function(e){if(e=s({measure:this._measure},e),this._opt=e,this._opt.tabSize=o(this._opt.tabSize,4),!e.font)throw new Error("must provide a valid bitmap font");var t=this.glyphs,i=e.text||"",a=e.font;this._setupSpaceGlyphs(a);var c=n.lines(i,e);t.length=0;var h=c.reduce((function(e,t){return Math.max(e,t.width,0)}),0),d=0,u=0,p=o(e.lineHeight,a.common.lineHeight),f=a.common.base,v=p-f,y=e.letterSpacing||0,b=p*c.length-v,w=function(e){if("center"===e)return 1;if("right"===e)return 2;return 0}(this._opt.align);u-=b,this._width=h,this._height=b,this._descender=p-f,this._baseline=f,this._xHeight=function(e){for(var t=0;t<r.length;t++){var i=r[t].charCodeAt(0),n=g(e.chars,i);if(n>=0)return e.chars[n].height}return 0}(a),this._capHeight=function(e){for(var t=0;t<l.length;t++){var i=l[t].charCodeAt(0),n=g(e.chars,i);if(n>=0)return e.chars[n].height}return 0}(a),this._lineHeight=p,this._ascender=p-v-this._xHeight;var S=this;c.forEach((function(e,n){for(var s,o=e.start,r=e.end,l=e.width,c=o;c<r;c++){var g=i.charCodeAt(c),f=S.getGlyph(a,g);if(f){s&&(d+=m(a,s.id,f.id));var v=d;1===w?v+=(h-l)/2:2===w&&(v+=h-l),t.push({position:[v,u],data:f,index:c,line:n}),d+=f.xadvance+y,s=f}}u+=p,d=0})),this._linesTotal=c.length},d.prototype._setupSpaceGlyphs=function(e){if(this._fallbackSpaceGlyph=null,this._fallbackTabGlyph=null,e.chars&&0!==e.chars.length){var t=p(e,h)||function(e){for(var t=0;t<a.length;t++){var i=a[t].charCodeAt(0),n=g(e.chars,i);if(n>=0)return e.chars[n]}return 0}(e)||e.chars[0],i=this._opt.tabSize*t.xadvance;this._fallbackSpaceGlyph=t,this._fallbackTabGlyph=s(t,{x:0,y:0,xadvance:i,id:c,xoffset:0,yoffset:0,width:0,height:0})}},d.prototype.getGlyph=function(e,t){var i=p(e,t);return i||(t===c?this._fallbackTabGlyph:t===h?this._fallbackSpaceGlyph:null)},d.prototype.computeMetrics=function(e,t,i,n){var s,o=this._opt.letterSpacing||0,r=this._opt.font,a=0,l=0,c=0;if(!r.chars||0===r.chars.length)return{start:t,end:t,width:0};i=Math.min(e.length,i);for(var h=t;h<i;h++){var d,u=e.charCodeAt(h);if(d=this.getGlyph(r,u)){d.xoffset;var p=(a+=s?m(r,s.id,d.id):0)+d.xadvance+o,g=a+d.width;if(g>=n||p>=n)break;a=p,l=g,s=d}c++}return s&&(l+=s.xoffset),{start:t,end:t+c,width:l}},["width","height","descender","ascender","xHeight","baseline","capHeight","lineHeight"].forEach((function(e){Object.defineProperty(d.prototype,e,{get:u(e),configurable:!0})}))},6225:()=>{},54078:(e,t,i)=>{"use strict";var n=i(94029),s=i(42473),o=i(17642),r=i(46057),a=function(e){s(!1,e)},l=String.prototype.replace,c=String.prototype.split,h="||||",d=function(e){var t=e%100,i=t%10;return 11!==t&&1===i?0:2<=i&&i<=4&&!(t>=12&&t<=14)?1:2},u={pluralTypes:{arabic:function(e){if(e<3)return e;var t=e%100;return t>=3&&t<=10?3:t>=11?4:5},bosnian_serbian:d,chinese:function(){return 0},croatian:d,french:function(e){return e>1?1:0},german:function(e){return 1!==e?1:0},russian:d,lithuanian:function(e){return e%10==1&&e%100!=11?0:e%10>=2&&e%10<=9&&(e%100<11||e%100>19)?1:2},czech:function(e){return 1===e?0:e>=2&&e<=4?1:2},polish:function(e){if(1===e)return 0;var t=e%10;return 2<=t&&t<=4&&(e%100<10||e%100>=20)?1:2},icelandic:function(e){return e%10!=1||e%100==11?1:0},slovenian:function(e){var t=e%100;return 1===t?0:2===t?1:3===t||4===t?2:3}},pluralTypeToLanguages:{arabic:["ar"],bosnian_serbian:["bs-Latn-BA","bs-Cyrl-BA","srl-RS","sr-RS"],chinese:["id","id-ID","ja","ko","ko-KR","lo","ms","th","th-TH","zh"],croatian:["hr","hr-HR"],german:["fa","da","de","en","es","fi","el","he","hi-IN","hu","hu-HU","it","nl","no","pt","sv","tr"],french:["fr","tl","pt-br"],russian:["ru","ru-RU"],lithuanian:["lt"],czech:["cs","cs-CZ","sk"],polish:["pl"],icelandic:["is"],slovenian:["sl-SL"]}};function p(e,t){var i,s,o=(i=e.pluralTypeToLanguages,s={},n(i,(function(e,t){n(e,(function(e){s[e]=t}))})),s);return o[t]||o[c.call(t,/-/,1)[0]]||o.en}function m(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var g=/%\{(.*?)\}/g;function f(e,t,i,n,s){if("string"!=typeof e)throw new TypeError("Polyglot.transformPhrase expects argument #1 to be string");if(null==t)return e;var a=e,d=n||g,m=s||u,f="number"==typeof t?{smart_count:t}:t;if(null!=f.smart_count&&a){var v=c.call(a,h);a=r(v[function(e,t,i){return e.pluralTypes[p(e,t)](i)}(m,i||"en",f.smart_count)]||v[0])}return a=l.call(a,d,(function(e,t){return o(f,t)&&null!=f[t]?f[t]:e}))}function v(e){var t=e||{};this.phrases={},this.extend(t.phrases||{}),this.currentLocale=t.locale||"en";var i=t.allowMissing?f:null;this.onMissingKey="function"==typeof t.onMissingKey?t.onMissingKey:i,this.warn=t.warn||a,this.tokenRegex=function(e){var t=e&&e.prefix||"%{",i=e&&e.suffix||"}";if(t===h||i===h)throw new RangeError('"||||" token is reserved for pluralization');return new RegExp(m(t)+"(.*?)"+m(i),"g")}(t.interpolation),this.pluralRules=t.pluralRules||u}v.prototype.locale=function(e){return e&&(this.currentLocale=e),this.currentLocale},v.prototype.extend=function(e,t){n(e,(function(e,i){var n=t?t+"."+i:i;"object"==typeof e?this.extend(e,n):this.phrases[n]=e}),this)},v.prototype.unset=function(e,t){"string"==typeof e?delete this.phrases[e]:n(e,(function(e,i){var n=t?t+"."+i:i;"object"==typeof e?this.unset(e,n):delete this.phrases[n]}),this)},v.prototype.clear=function(){this.phrases={}},v.prototype.replace=function(e){this.clear(),this.extend(e)},v.prototype.t=function(e,t){var i,n,s=null==t?{}:t;if("string"==typeof this.phrases[e])i=this.phrases[e];else if("string"==typeof s._)i=s._;else if(this.onMissingKey){n=(0,this.onMissingKey)(e,s,this.currentLocale,this.tokenRegex,this.pluralRules)}else this.warn('Missing translation for key: "'+e+'"'),n=e;return"string"==typeof i&&(n=f(i,s,this.currentLocale,this.tokenRegex,this.pluralRules)),n},v.prototype.has=function(e){return o(this.phrases,e)},v.transformPhrase=function(e,t,i){return f(e,t,i)},e.exports=v},18987:(e,t,i)=>{"use strict";var n;if(!Object.keys){var s=Object.prototype.hasOwnProperty,o=Object.prototype.toString,r=i(21414),a=Object.prototype.propertyIsEnumerable,l=!a.call({toString:null},"toString"),c=a.call((function(){}),"prototype"),h=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],d=function(e){var t=e.constructor;return t&&t.prototype===e},u={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},p=function(){if("undefined"==typeof window)return!1;for(var e in window)try{if(!u["$"+e]&&s.call(window,e)&&null!==window[e]&&"object"==typeof window[e])try{d(window[e])}catch(e){return!0}}catch(e){return!0}return!1}();n=function(e){var t=null!==e&&"object"==typeof e,i="[object Function]"===o.call(e),n=r(e),a=t&&"[object String]"===o.call(e),u=[];if(!t&&!i&&!n)throw new TypeError("Object.keys called on a non-object");var m=c&&i;if(a&&e.length>0&&!s.call(e,0))for(var g=0;g<e.length;++g)u.push(String(g));if(n&&e.length>0)for(var f=0;f<e.length;++f)u.push(String(f));else for(var v in e)m&&"prototype"===v||!s.call(e,v)||u.push(String(v));if(l)for(var y=function(e){if("undefined"==typeof window||!p)return d(e);try{return d(e)}catch(e){return!1}}(e),b=0;b<h.length;++b)y&&"constructor"===h[b]||!s.call(e,h[b])||u.push(h[b]);return u}}e.exports=n},82215:(e,t,i)=>{"use strict";var n=Array.prototype.slice,s=i(21414),o=Object.keys,r=o?function(e){return o(e)}:i(18987),a=Object.keys;r.shim=function(){Object.keys?function(){var e=Object.keys(arguments);return e&&e.length===arguments.length}(1,2)||(Object.keys=function(e){return s(e)?a(n.call(e)):a(e)}):Object.keys=r;return Object.keys||r},e.exports=r},21414:e=>{"use strict";var t=Object.prototype.toString;e.exports=function(e){var i=t.call(e),n="[object Arguments]"===i;return n||(n="[object Array]"!==i&&null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&"[object Function]"===t.call(e.callee)),n}},16801:(e,t)=>{"use strict";var i=t.uO={};i.read=function(e,t){return e.readFields(i._readField,{chunk:[],quantized_chunk:[]},t)},i._readField=function(e,t,i){1===e?t.chunk.push(o.read(i,i.readVarint()+i.pos)):2===e&&t.quantized_chunk.push(c.read(i,i.readVarint()+i.pos))},i.write=function(e,t){if(e.chunk)for(var i=0;i<e.chunk.length;i++)t.writeMessage(1,o.write,e.chunk[i]);if(e.quantized_chunk)for(i=0;i<e.quantized_chunk.length;i++)t.writeMessage(2,c.write,e.quantized_chunk[i])};var n={};n.read=function(e,t){return e.readFields(n._readField,{xyz:[],uv:[]},t)},n._readField=function(e,t,i){1===e?i.readPackedFloat(t.xyz):2===e&&i.readPackedFloat(t.uv)},n.write=function(e,t){e.xyz&&t.writePackedFloat(1,e.xyz),e.uv&&t.writePackedFloat(2,e.uv)};var s={};s.read=function(e,t){return e.readFields(s._readField,{faces:[]},t)},s._readField=function(e,t,i){1===e&&i.readPackedVarint(t.faces)},s.write=function(e,t){e.faces&&t.writePackedVarint(1,e.faces)};var o={};o.read=function(e,t){return e.readFields(o._readField,{vertices:null,faces:null,chunk_name:"",material_name:""},t)},o._readField=function(e,t,i){1===e?t.vertices=n.read(i,i.readVarint()+i.pos):2===e?t.faces=s.read(i,i.readVarint()+i.pos):3===e?t.chunk_name=i.readString():4===e&&(t.material_name=i.readString())},o.write=function(e,t){e.vertices&&t.writeMessage(1,n.write,e.vertices),e.faces&&t.writeMessage(2,s.write,e.faces),e.chunk_name&&t.writeStringField(3,e.chunk_name),e.material_name&&t.writeStringField(4,e.material_name)};var r={};r.read=function(e,t){return e.readFields(r._readField,{quantization:0,translation:[],x:[],y:[],z:[]},t)},r._readField=function(e,t,i){1===e?t.quantization=i.readFloat():2===e?i.readPackedFloat(t.translation):3===e?i.readPackedSVarint(t.x):4===e?i.readPackedSVarint(t.y):5===e&&i.readPackedSVarint(t.z)},r.write=function(e,t){e.quantization&&t.writeFloatField(1,e.quantization),e.translation&&t.writePackedFloat(2,e.translation),e.x&&t.writePackedSVarint(3,e.x),e.y&&t.writePackedSVarint(4,e.y),e.z&&t.writePackedSVarint(5,e.z)};var a={};a.read=function(e,t){return e.readFields(a._readField,{name:"",quantization:0,u:[],v:[]},t)},a._readField=function(e,t,i){1===e?t.name=i.readString():2===e?t.quantization=i.readFloat():3===e?i.readPackedSVarint(t.u):4===e&&i.readPackedSVarint(t.v)},a.write=function(e,t){e.name&&t.writeStringField(1,e.name),e.quantization&&t.writeFloatField(2,e.quantization),e.u&&t.writePackedSVarint(3,e.u),e.v&&t.writePackedSVarint(4,e.v)};var l={};l.read=function(e,t){return e.readFields(l._readField,{faces:[]},t)},l._readField=function(e,t,i){1===e&&i.readPackedSVarint(t.faces)},l.write=function(e,t){e.faces&&t.writePackedSVarint(1,e.faces)};var c={};c.read=function(e,t){return e.readFields(c._readField,{chunk_name:"",material_name:"",vertices:null,uvs:[],faces:null},t)},c._readField=function(e,t,i){1===e?t.chunk_name=i.readString():2===e?t.material_name=i.readString():3===e?t.vertices=r.read(i,i.readVarint()+i.pos):4===e?t.uvs.push(a.read(i,i.readVarint()+i.pos)):5===e&&(t.faces=s.read(i,i.readVarint()+i.pos))},c.write=function(e,t){if(e.chunk_name&&t.writeStringField(1,e.chunk_name),e.material_name&&t.writeStringField(2,e.material_name),e.vertices&&t.writeMessage(3,r.write,e.vertices),e.uvs)for(var i=0;i<e.uvs.length;i++)t.writeMessage(4,a.write,e.uvs[i]);e.faces&&t.writeMessage(5,s.write,e.faces)}},3614:(e,t,i)=>{"use strict";e.exports=s;var n=i(80645);function s(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}s.Varint=0,s.Fixed64=1,s.Bytes=2,s.Fixed32=5;var o=4294967296,r=1/o;function a(e){return e.type===s.Bytes?e.readVarint()+e.pos:e.pos+1}function l(e,t,i){return i?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function c(e,t,i){var n=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.ceil(Math.log(t)/(7*Math.LN2));i.realloc(n);for(var s=i.pos-1;s>=e;s--)i.buf[s+n]=i.buf[s]}function h(e,t){for(var i=0;i<e.length;i++)t.writeVarint(e[i])}function d(e,t){for(var i=0;i<e.length;i++)t.writeSVarint(e[i])}function u(e,t){for(var i=0;i<e.length;i++)t.writeFloat(e[i])}function p(e,t){for(var i=0;i<e.length;i++)t.writeDouble(e[i])}function m(e,t){for(var i=0;i<e.length;i++)t.writeBoolean(e[i])}function g(e,t){for(var i=0;i<e.length;i++)t.writeFixed32(e[i])}function f(e,t){for(var i=0;i<e.length;i++)t.writeSFixed32(e[i])}function v(e,t){for(var i=0;i<e.length;i++)t.writeFixed64(e[i])}function y(e,t){for(var i=0;i<e.length;i++)t.writeSFixed64(e[i])}function b(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function w(e,t,i){e[i]=t,e[i+1]=t>>>8,e[i+2]=t>>>16,e[i+3]=t>>>24}function S(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}s.prototype={destroy:function(){this.buf=null},readFields:function(e,t,i){for(i=i||this.length;this.pos<i;){var n=this.readVarint(),s=n>>3,o=this.pos;this.type=7&n,e(s,t,this),this.pos===o&&this.skip(n)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=b(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=S(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=b(this.buf,this.pos)+b(this.buf,this.pos+4)*o;return this.pos+=8,e},readSFixed64:function(){var e=b(this.buf,this.pos)+S(this.buf,this.pos+4)*o;return this.pos+=8,e},readFloat:function(){var e=n.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=n.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,i,n=this.buf;return t=127&(i=n[this.pos++]),i<128?t:(t|=(127&(i=n[this.pos++]))<<7,i<128?t:(t|=(127&(i=n[this.pos++]))<<14,i<128?t:(t|=(127&(i=n[this.pos++]))<<21,i<128?t:function(e,t,i){var n,s,o=i.buf;if(s=o[i.pos++],n=(112&s)>>4,s<128)return l(e,n,t);if(s=o[i.pos++],n|=(127&s)<<3,s<128)return l(e,n,t);if(s=o[i.pos++],n|=(127&s)<<10,s<128)return l(e,n,t);if(s=o[i.pos++],n|=(127&s)<<17,s<128)return l(e,n,t);if(s=o[i.pos++],n|=(127&s)<<24,s<128)return l(e,n,t);if(s=o[i.pos++],n|=(1&s)<<31,s<128)return l(e,n,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(i=n[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=function(e,t,i){var n="",s=t;for(;s<i;){var o,r,a,l=e[s],c=null,h=l>239?4:l>223?3:l>191?2:1;if(s+h>i)break;1===h?l<128&&(c=l):2===h?128==(192&(o=e[s+1]))&&(c=(31&l)<<6|63&o)<=127&&(c=null):3===h?(o=e[s+1],r=e[s+2],128==(192&o)&&128==(192&r)&&((c=(15&l)<<12|(63&o)<<6|63&r)<=2047||c>=55296&&c<=57343)&&(c=null)):4===h&&(o=e[s+1],r=e[s+2],a=e[s+3],128==(192&o)&&128==(192&r)&&128==(192&a)&&((c=(15&l)<<18|(63&o)<<12|(63&r)<<6|63&a)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,h=1):c>65535&&(c-=65536,n+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),n+=String.fromCharCode(c),s+=h}return n}(this.buf,this.pos,e);return this.pos=e,t},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){var i=a(this);for(e=e||[];this.pos<i;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){var t=a(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){var t=a(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){var t=a(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){var t=a(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){var t=a(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){var t=a(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){var t=a(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){var t=a(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===s.Varint)for(;this.buf[this.pos++]>127;);else if(t===s.Bytes)this.pos=this.readVarint()+this.pos;else if(t===s.Fixed32)this.pos+=4;else{if(t!==s.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),w(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),w(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),w(this.buf,-1&e,this.pos),w(this.buf,Math.floor(e*r),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),w(this.buf,-1&e,this.pos),w(this.buf,Math.floor(e*r),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var i,n;e>=0?(i=e%4294967296|0,n=e/4294967296|0):(n=~(-e/4294967296),4294967295^(i=~(-e%4294967296))?i=i+1|0:(i=0,n=n+1|0));if(e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,i){i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos]=127&e}(i,0,t),function(e,t){var i=(7&e)<<4;if(t.buf[t.pos++]|=i|((e>>>=3)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;t.buf[t.pos++]=127&e}(n,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,i){for(var n,s,o=0;o<t.length;o++){if((n=t.charCodeAt(o))>55295&&n<57344){if(!s){n>56319||o+1===t.length?(e[i++]=239,e[i++]=191,e[i++]=189):s=n;continue}if(n<56320){e[i++]=239,e[i++]=191,e[i++]=189,s=n;continue}n=s-55296<<10|n-56320|65536,s=null}else s&&(e[i++]=239,e[i++]=191,e[i++]=189,s=null);n<128?e[i++]=n:(n<2048?e[i++]=n>>6|192:(n<65536?e[i++]=n>>12|224:(e[i++]=n>>18|240,e[i++]=n>>12&63|128),e[i++]=n>>6&63|128),e[i++]=63&n|128)}return i}(this.buf,e,this.pos);var i=this.pos-t;i>=128&&c(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeFloat:function(e){this.realloc(4),n.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),n.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=e[i]},writeRawMessage:function(e,t){this.pos++;var i=this.pos;e(t,this);var n=this.pos-i;n>=128&&c(i,n,this),this.pos=i-1,this.writeVarint(n),this.pos+=n},writeMessage:function(e,t,i){this.writeTag(e,s.Bytes),this.writeRawMessage(t,i)},writePackedVarint:function(e,t){this.writeMessage(e,h,t)},writePackedSVarint:function(e,t){this.writeMessage(e,d,t)},writePackedBoolean:function(e,t){this.writeMessage(e,m,t)},writePackedFloat:function(e,t){this.writeMessage(e,u,t)},writePackedDouble:function(e,t){this.writeMessage(e,p,t)},writePackedFixed32:function(e,t){this.writeMessage(e,g,t)},writePackedSFixed32:function(e,t){this.writeMessage(e,f,t)},writePackedFixed64:function(e,t){this.writeMessage(e,v,t)},writePackedSFixed64:function(e,t){this.writeMessage(e,y,t)},writeBytesField:function(e,t){this.writeTag(e,s.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,s.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,s.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,s.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,s.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,s.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,s.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,s.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,s.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,s.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}}},17141:(e,t,i)=>{var n;!function(s,o){var r={};function a(e){return function(){var t={method:e},i=Array.prototype.slice.call(arguments);/^get/.test(e)?(r.assert(i.length>0,"Get methods require a callback."),i.unshift(t)):(/^set/.test(e)&&(r.assert(0!==i.length,"Set methods require a value."),t.value=i[0]),i=[t]),this.send.apply(this,i)}}r.DEBUG=!1,r.VERSION="0.0.11",r.CONTEXT="player.js",r.POST_MESSAGE=!!s.postMessage,r.origin=function(e){return"//"===e.substr(0,2)&&(e=s.location.protocol+e),e.split("/").slice(0,3).join("/")},r.addEvent=function(e,t,i){e&&(e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent?e.attachEvent("on"+t,i):e["on"+t]=i)},r.log=function(){r.log.history=r.log.history||[],r.log.history.push(arguments),s.console&&r.DEBUG&&s.console.log(Array.prototype.slice.call(arguments))},r.isString=function(e){return"[object String]"===Object.prototype.toString.call(e)},r.isObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)},r.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},r.isNone=function(e){return null==e},r.has=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.indexOf=function(e,t){if(null==e)return-1;var i=0,n=e.length;if(Array.prototype.IndexOf&&e.indexOf===Array.prototype.IndexOf)return e.indexOf(t);for(;i<n;i++)if(e[i]===t)return i;return-1},r.assert=function(e,t){if(!e)throw t||"Player.js Assert Failed"},r.Keeper=function(){this.init()},r.Keeper.prototype.init=function(){this.data={}},r.Keeper.prototype.getUUID=function(){return"listener-xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},r.Keeper.prototype.has=function(e,t){if(!this.data.hasOwnProperty(e))return!1;if(r.isNone(t))return!0;for(var i=this.data[e],n=0;n<i.length;n++)if(i[n].id===t)return!0;return!1},r.Keeper.prototype.add=function(e,t,i,n,s){var o={id:e,event:t,cb:i,ctx:n,one:s};this.has(t)?this.data[t].push(o):this.data[t]=[o]},r.Keeper.prototype.execute=function(e,t,i,n){if(!this.has(e,t))return!1;for(var s=[],o=[],a=0;a<this.data[e].length;a++){var l=this.data[e][a];r.isNone(t)||!r.isNone(t)&&l.id===t?(o.push({cb:l.cb,ctx:l.ctx?l.ctx:n,data:i}),!1===l.one&&s.push(l)):s.push(l)}0===s.length?delete this.data[e]:this.data[e]=s;for(var c=0;c<o.length;c++){var h=o[c];h.cb.call(h.ctx,h.data)}},r.Keeper.prototype.on=function(e,t,i,n){this.add(e,t,i,n,!1)},r.Keeper.prototype.one=function(e,t,i,n){this.add(e,t,i,n,!0)},r.Keeper.prototype.off=function(e,t){var i=[];if(!this.data.hasOwnProperty(e))return i;for(var n=[],s=0;s<this.data[e].length;s++){var o=this.data[e][s];r.isNone(t)||o.cb===t?r.isNone(o.id)||i.push(o.id):n.push(o)}return 0===n.length?delete this.data[e]:this.data[e]=n,i},r.Player=function(e,t){if(!(this instanceof r.Player))return new r.Player(e,t);this.init(e,t)},r.EVENTS={READY:"ready",PLAY:"play",PAUSE:"pause",ENDED:"ended",TIMEUPDATE:"timeupdate",PROGRESS:"progress",ERROR:"error"},r.EVENTS.all=function(){var e=[];for(var t in r.EVENTS)r.has(r.EVENTS,t)&&r.isString(r.EVENTS[t])&&e.push(r.EVENTS[t]);return e},r.METHODS={PLAY:"play",PAUSE:"pause",GETPAUSED:"getPaused",MUTE:"mute",UNMUTE:"unmute",GETMUTED:"getMuted",SETVOLUME:"setVolume",GETVOLUME:"getVolume",GETDURATION:"getDuration",SETCURRENTTIME:"setCurrentTime",GETCURRENTTIME:"getCurrentTime",SETLOOP:"setLoop",GETLOOP:"getLoop",REMOVEEVENTLISTENER:"removeEventListener",ADDEVENTLISTENER:"addEventListener"},r.METHODS.all=function(){var e=[];for(var t in r.METHODS)r.has(r.METHODS,t)&&r.isString(r.METHODS[t])&&e.push(r.METHODS[t]);return e},r.READIED=[],r.Player.prototype.init=function(e,t){var i=this;r.isString(e)&&(e=o.getElementById(e)),this.elem=e,r.assert("IFRAME"===e.nodeName,'playerjs.Player constructor requires an Iframe, got "'+e.nodeName+'"'),r.assert(e.src,"playerjs.Player constructor requires a Iframe with a 'src' attribute."),this.origin=r.origin(e.src),this.keeper=new r.Keeper,this.isReady=!1,this.queue=[],this.events=r.EVENTS.all(),this.methods=r.METHODS.all(),r.POST_MESSAGE?r.addEvent(s,"message",(function(e){i.receive(e)})):r.log("Post Message is not Available."),r.indexOf(r.READIED,e.src)>-1?i.loaded=!0:this.elem.onload=function(){i.loaded=!0}},r.Player.prototype.send=function(e,t,i){if(e.context=r.CONTEXT,e.version=r.VERSION,t){var n=this.keeper.getUUID();e.listener=n,this.keeper.one(n,e.method,t,i)}return this.isReady||"ready"===e.value?(r.log("Player.send",e,this.origin),!0===this.loaded&&this.elem.contentWindow.postMessage(JSON.stringify(e),this.origin),!0):(r.log("Player.queue",e),this.queue.push(e),!1)},r.Player.prototype.receive=function(e){if(r.log("Player.receive",e),e.origin!==this.origin)return!1;var t;try{t=JSON.parse(e.data)}catch(e){return!1}if(t.context!==r.CONTEXT)return!1;"ready"===t.event&&t.value&&t.value.src===this.elem.src&&this.ready(t),this.keeper.has(t.event,t.listener)&&this.keeper.execute(t.event,t.listener,t.value,this)},r.Player.prototype.ready=function(e){if(!0===this.isReady)return!1;e.value.events&&(this.events=e.value.events),e.value.methods&&(this.methods=e.value.methods),this.isReady=!0,this.loaded=!0;for(var t=0;t<this.queue.length;t++){var i=this.queue[t];r.log("Player.dequeue",i),"ready"===e.event&&this.keeper.execute(i.event,i.listener,!0,this),this.send(i)}this.queue=[]},r.Player.prototype.on=function(e,t,i){var n=this.keeper.getUUID();return"ready"===e?this.keeper.one(n,e,t,i):this.keeper.on(n,e,t,i),this.send({method:"addEventListener",value:e,listener:n}),!0},r.Player.prototype.off=function(e,t){var i=this.keeper.off(e,t);if(r.log("Player.off",i),i.length>0)for(var n in i)return this.send({method:"removeEventListener",value:e,listener:i[n]}),!0;return!1},r.Player.prototype.supports=function(e,t){r.assert(r.indexOf(["method","event"],e)>-1,'evtOrMethod needs to be either "event" or "method" got '+e),t=r.isArray(t)?t:[t];for(var i="event"===e?this.events:this.methods,n=0;n<t.length;n++)if(-1===r.indexOf(i,t[n]))return!1;return!0};for(var l=0,c=r.METHODS.all().length;l<c;l++){var h=r.METHODS.all()[l];r.Player.prototype.hasOwnProperty(h)||(r.Player.prototype[h]=a(h))}r.addEvent(s,"message",(function(e){var t;try{t=JSON.parse(e.data)}catch(e){return!1}if(t.context!==r.CONTEXT)return!1;"ready"===t.event&&t.value&&t.value.src&&r.READIED.push(t.value.src)})),r.Receiver=function(e,t){this.init(e,t)},r.Receiver.prototype.init=function(e,t){var i=this;this.isReady=!1,this.origin=r.origin(o.referrer),this.methods={},this.supported={events:e||r.EVENTS.all(),methods:t||r.METHODS.all()},this.eventListeners={},this.reject=!(s.self!==s.top&&r.POST_MESSAGE),this.reject||r.addEvent(s,"message",(function(e){i.receive(e)}))},r.Receiver.prototype.receive=function(e){if(e.origin!==this.origin)return!1;var t={};if(r.isObject(e.data))t=e.data;else try{t=s.JSON.parse(e.data)}catch(e){r.log("JSON Parse Error",e)}if(r.log("Receiver.receive",e,t),!t.method)return!1;if(t.context!==r.CONTEXT)return!1;if(-1===r.indexOf(r.METHODS.all(),t.method))return this.emit("error",{code:2,msg:'Invalid Method "'+t.method+'"'}),!1;var i=r.isNone(t.listener)?null:t.listener;if("addEventListener"===t.method)this.eventListeners.hasOwnProperty(t.value)?-1===r.indexOf(this.eventListeners[t.value],i)&&this.eventListeners[t.value].push(i):this.eventListeners[t.value]=[i],"ready"===t.value&&this.isReady&&this.ready();else if("removeEventListener"===t.method){if(this.eventListeners.hasOwnProperty(t.value)){var n=r.indexOf(this.eventListeners[t.value],i);n>-1&&this.eventListeners[t.value].splice(n,1),0===this.eventListeners[t.value].length&&delete this.eventListeners[t.value]}}else this.get(t.method,t.value,i)},r.Receiver.prototype.get=function(e,t,i){var n=this;if(!this.methods.hasOwnProperty(e))return this.emit("error",{code:3,msg:'Method Not Supported"'+e+'"'}),!1;var s=this.methods[e];if("get"===e.substr(0,3)){s.call(this,(function(t){n.send(e,t,i)}))}else s.call(this,t)},r.Receiver.prototype.on=function(e,t){this.methods[e]=t},r.Receiver.prototype.send=function(e,t,i){if(r.log("Receiver.send",e,t,i),this.reject)return r.log("Receiver.send.reject",e,t,i),!1;var n={context:r.CONTEXT,version:r.VERSION,event:e};r.isNone(t)||(n.value=t),r.isNone(i)||(n.listener=i);var o=JSON.stringify(n);s.parent.postMessage(o,""===this.origin?"*":this.origin)},r.Receiver.prototype.emit=function(e,t){if(!this.eventListeners.hasOwnProperty(e))return!1;r.log("Instance.emit",e,t,this.eventListeners[e]);for(var i=0;i<this.eventListeners[e].length;i++){var n=this.eventListeners[e][i];this.send(e,t,n)}return!0},r.Receiver.prototype.ready=function(){r.log("Receiver.ready"),this.isReady=!0;var e={src:s.location.toString(),events:this.supported.events,methods:this.supported.methods};this.emit("ready",e)||this.send("ready",e)},r.HTML5Adapter=function(e){if(!(this instanceof r.HTML5Adapter))return new r.HTML5Adapter(e);this.init(e)},r.HTML5Adapter.prototype.init=function(e){r.assert(e,"playerjs.HTML5Adapter requires a video element");var t=this.receiver=new r.Receiver;e.addEventListener("playing",(function(){t.emit("play")})),e.addEventListener("pause",(function(){t.emit("pause")})),e.addEventListener("ended",(function(){t.emit("ended")})),e.addEventListener("timeupdate",(function(){t.emit("timeupdate",{seconds:e.currentTime,duration:e.duration})})),e.addEventListener("progress",(function(){t.emit("buffered",{percent:e.buffered.length})})),t.on("play",(function(){e.play()})),t.on("pause",(function(){e.pause()})),t.on("getPaused",(function(t){t(e.paused)})),t.on("getCurrentTime",(function(t){t(e.currentTime)})),t.on("setCurrentTime",(function(t){e.currentTime=t})),t.on("getDuration",(function(t){t(e.duration)})),t.on("getVolume",(function(t){t(100*e.volume)})),t.on("setVolume",(function(t){e.volume=t/100})),t.on("mute",(function(){e.muted=!0})),t.on("unmute",(function(){e.muted=!1})),t.on("getMuted",(function(t){t(e.muted)})),t.on("getLoop",(function(t){t(e.loop)})),t.on("setLoop",(function(t){e.loop=t}))},r.HTML5Adapter.prototype.ready=function(){this.receiver.ready()},r.JWPlayerAdapter=function(e){if(!(this instanceof r.JWPlayerAdapter))return new r.JWPlayerAdapter(e);this.init(e)},r.JWPlayerAdapter.prototype.init=function(e){r.assert(e,"playerjs.JWPlayerAdapter requires a player object");var t=this.receiver=new r.Receiver;this.looped=!1,e.on("pause",(function(){t.emit("pause")})),e.on("play",(function(){t.emit("play")})),e.on("time",(function(e){var i=e.position,n=e.duration;if(!i||!n)return!1;var s={seconds:i,duration:n};t.emit("timeupdate",s)}));var i=this;e.on("complete",(function(){!0===i.looped?e.seek(0):t.emit("ended")})),e.on("error",(function(){t.emit("error")})),t.on("play",(function(){e.play(!0)})),t.on("pause",(function(){e.pause(!0)})),t.on("getPaused",(function(t){t(e.getState().toLowerCase()!=="PLAYING".toLowerCase())})),t.on("getCurrentTime",(function(t){t(e.getPosition())})),t.on("setCurrentTime",(function(t){e.seek(t)})),t.on("getDuration",(function(t){t(e.getDuration())})),t.on("getVolume",(function(t){t(e.getVolume())})),t.on("setVolume",(function(t){e.setVolume(t)})),t.on("mute",(function(){e.setMute(!0)})),t.on("unmute",(function(){e.setMute(!1)})),t.on("getMuted",(function(t){t(!0===e.getMute())})),t.on("getLoop",(function(e){e(this.looped)}),this),t.on("setLoop",(function(e){this.looped=e}),this)},r.JWPlayerAdapter.prototype.ready=function(){this.receiver.ready()},r.MockAdapter=function(){if(!(this instanceof r.MockAdapter))return new r.MockAdapter;this.init()},r.MockAdapter.prototype.init=function(){var e={duration:20,currentTime:0,interval:null,timeupdate:function(){},volume:100,mute:!1,playing:!1,loop:!1,play:function(){e.interval=setInterval((function(){e.currentTime+=.25,e.timeupdate({seconds:e.currentTime,duration:e.duration})}),250),e.playing=!0},pause:function(){clearInterval(e.interval),e.playing=!1}},t=this.receiver=new r.Receiver;t.on("play",(function(){var t=this;e.play(),this.emit("play"),e.timeupdate=function(e){t.emit("timeupdate",e)}})),t.on("pause",(function(){e.pause(),this.emit("pause")})),t.on("getPaused",(function(t){t(!e.playing)})),t.on("getCurrentTime",(function(t){t(e.currentTime)})),t.on("setCurrentTime",(function(t){e.currentTime=t})),t.on("getDuration",(function(t){t(e.duration)})),t.on("getVolume",(function(t){t(e.volume)})),t.on("setVolume",(function(t){e.volume=t})),t.on("mute",(function(){e.mute=!0})),t.on("unmute",(function(){e.mute=!1})),t.on("getMuted",(function(t){t(e.mute)})),t.on("getLoop",(function(t){t(e.loop)})),t.on("setLoop",(function(t){e.loop=t}))},r.MockAdapter.prototype.ready=function(){this.receiver.ready()},r.VideoJSAdapter=function(e){if(!(this instanceof r.VideoJSAdapter))return new r.VideoJSAdapter(e);this.init(e)},r.VideoJSAdapter.prototype.init=function(e){r.assert(e,"playerjs.VideoJSReceiver requires a player object");var t=this.receiver=new r.Receiver;e.on("pause",(function(){t.emit("pause")})),e.on("play",(function(){t.emit("play")})),e.on("timeupdate",(function(i){var n=e.currentTime(),s=e.duration();if(!n||!s)return!1;var o={seconds:n,duration:s};t.emit("timeupdate",o)})),e.on("ended",(function(){t.emit("ended")})),e.on("error",(function(){t.emit("error")})),t.on("play",(function(){e.play()})),t.on("pause",(function(){e.pause()})),t.on("getPaused",(function(t){t(e.paused())})),t.on("getCurrentTime",(function(t){t(e.currentTime())})),t.on("setCurrentTime",(function(t){e.currentTime(t)})),t.on("getDuration",(function(t){t(e.duration())})),t.on("getVolume",(function(t){t(100*e.volume())})),t.on("setVolume",(function(t){e.volume(t/100)})),t.on("mute",(function(){e.volume(0)})),t.on("unmute",(function(){e.volume(1)})),t.on("getMuted",(function(t){t(0===e.volume())})),t.on("getLoop",(function(t){t(e.loop())})),t.on("setLoop",(function(t){e.loop(t)}))},r.VideoJSAdapter.prototype.ready=function(){this.receiver.ready()},void 0===(n=function(){return r}.call(t,i,t,e))||(e.exports=n)}(window,document)},49613:(e,t,i)=>{"use strict";var n=i(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.MaterialComponent=void 0;var s=n(i(34575)),o=n(i(93913)),r=n(i(78585)),a=n(i(29754)),l=n(i(2205)),c=n(i(50008)),h=i(30888),d=i(47056),u=i(26605),p=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===("undefined"==typeof Reflect?"undefined":(0,c.default)(Reflect))&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r},m=["disabled"],g=function(e){function t(){return(0,s.default)(this,t),(0,r.default)(this,(0,a.default)(t).apply(this,arguments))}return(0,l.default)(t,e),(0,o.default)(t,[{key:"render",value:function(e){this.classText||(this.classText=this.buildClassName(e));var t=e,i=t.className||t.class||"";t.class&&delete t.class,t.className&&delete t.className;var n=this.materialDom(t),s="attributes";return"props"in n?(s="props",n.props=n.props||{}):n.attributes=n.attributes||{},n[s].className="".concat(i," ").concat(this.getClassName(n)).split(" ").filter((function(e,t,i){return i.indexOf(e)===t&&""!==e})).join(" "),this.mdcProps.forEach((function(e){e in m||delete n[s][e]})),n}},{key:"componentDidMount",value:function(){this.props.ripple&&this.control&&(this.ripple=new h.MDCRipple(this.control))}},{key:"componentWillReceiveProps",value:function(e){if(this.MDComponent&&this.mdcNotifyProps){var t=!0,i=!1,n=void 0;try{for(var s,o=this.mdcNotifyProps[Symbol.iterator]();!(t=(s=o.next()).done);t=!0){var r=s.value;this.props[r]!==e[r]&&(this.MDComponent[r]=e[r])}}catch(e){i=!0,n=e}finally{try{t||null==o.return||o.return()}finally{if(i)throw n}}}var a=!0,l=!1,c=void 0;try{for(var h,d=this.mdcProps[Symbol.iterator]();!(a=(h=d.next()).done);a=!0){var u=h.value;if(this.props[u]!==e[u]){this.classText=this.buildClassName(e);break}}}catch(e){l=!0,c=e}finally{try{a||null==d.return||d.return()}finally{if(l)throw c}}}},{key:"componentWillUnmount",value:function(){this.ripple&&this.ripple.destroy()}},{key:"afterComponentDidMount",value:function(){if(this.MDComponent&&this.mdcNotifyProps){var e=!0,t=!1,i=void 0;try{for(var n,s=this.mdcNotifyProps[Symbol.iterator]();!(e=(n=s.next()).done);e=!0){var o=n.value;this.MDComponent[o]=this.props[o]}}catch(e){t=!0,i=e}finally{try{e||null==s.return||s.return()}finally{if(t)throw i}}}}},{key:"setControlRef",value:function(e){this.control=e}},{key:"buildClassName",value:function(e){var t="mdc-"+this.componentName;for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];"boolean"==typeof n&&n&&-1!==this.mdcProps.indexOf(i)&&(t+=" mdc-".concat(this.componentName,"--").concat(i))}return t}},{key:"getClassName",value:function(e){if(!e)return"";var t="attributes";"props"in e?(t="props",e.props=e.props||{}):e.attributes=e.attributes||{};var i=e[t]=e[t]||{},n=this.classText;return i.class&&(n+=" "+i.class),i.className&&i.className!==i.class&&(n+=" "+i.className),n}}]),t}(u.Component);t.MaterialComponent=g,p([d.bind],g.prototype,"setControlRef",null);var f=g;t.default=f},28276:(e,t,i)=>{"use strict";var n=i(95318);t.ZP=void 0;var s=n(i(34575)),o=n(i(93913)),r=n(i(78585)),a=n(i(29754)),l=n(i(16525)),c=n(i(2205)),h=n(i(50008)),d=i(69826),u=i(47056),p=i(26605),m=n(i(49613)),g=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===("undefined"==typeof Reflect?"undefined":(0,h.default)(Reflect))&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r},f=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(i[n[s]]=e[n[s]])}return i},v=function(e){function t(){var e;return(0,s.default)(this,t),(e=(0,r.default)(this,(0,a.default)(t).apply(this,arguments))).componentName="slider",e.mdcProps=["discrete"],e}return(0,c.default)(t,e),(0,o.default)(t,[{key:"componentDidMount",value:function(){(0,l.default)((0,a.default)(t.prototype),"componentDidMount",this).call(this),this.control&&(this.MDComponent=new d.MDCSlider(this.control),this.MDComponent.listen("MDCSlider:change",this.onChange),this.MDComponent.listen("MDCSlider:input",this.onInput)),this.setValue(this.props.value)}},{key:"componentWillUnmount",value:function(){(0,l.default)((0,a.default)(t.prototype),"componentWillUnmount",this).call(this),this.MDComponent&&(this.MDComponent.unlisten("MDCSlider:change",this.onChange),this.MDComponent.unlisten("MDCSlider:input",this.onInput),this.MDComponent.destroy())}},{key:"getValue",value:function(){if(this.MDComponent)return this.MDComponent.value}},{key:"setValue",value:function(e){var t=this.props,i=t.disabled,n=void 0!==i&&i,s=t.min,o=void 0===s?0:s,r=t.max,a=void 0===r?100:r,l=t.step;this.MDComponent&&(o>this.MDComponent.max?(this.MDComponent.max=a,this.MDComponent.min=o):(this.MDComponent.min=o,this.MDComponent.max=a),e&&(this.MDComponent.value=e),this.MDComponent.disabled=n,l&&(this.MDComponent.step=l))}},{key:"onChange",value:function(e){this.props.onChange&&this.props.onChange(e)}},{key:"onInput",value:function(e){this.props.onInput&&this.props.onInput(e)}},{key:"materialDom",value:function(e){var t=e.tabindex,i=void 0===t?0:t,n=f(e,["tabindex"]);return this.setValue(e),(0,p.h)("div",Object.assign({tabIndex:i,role:"slider","aria-label":"Select Value",ref:this.setControlRef},n),(0,p.h)("div",{class:"mdc-slider__track-container"},(0,p.h)("div",{class:"mdc-slider__track"})),(0,p.h)("div",{class:"mdc-slider__thumb-container"},n.discrete&&(0,p.h)("div",{class:"mdc-slider__pin"},(0,p.h)("span",{class:"mdc-slider__pin-value-marker"})),(0,p.h)("svg",{class:"mdc-slider__thumb",width:"21",height:"21"},(0,p.h)("circle",{cx:"10.5",cy:"10.5",r:"7.875"})),(0,p.h)("div",{class:"mdc-slider__focus-ring"})))}}]),t}(m.default);g([u.bind],v.prototype,"onChange",null),g([u.bind],v.prototype,"onInput",null);var y=v;t.ZP=y},26605:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>V,h:()=>a,createElement:()=>a,cloneElement:()=>d,createRef:()=>U,Component:()=>B,render:()=>F,rerender:()=>g,options:()=>s});var n=function(){},s={},o=[],r=[];function a(e,t){var i,a,l,c,h=r;for(c=arguments.length;c-- >2;)o.push(arguments[c]);for(t&&null!=t.children&&(o.length||o.push(t.children),delete t.children);o.length;)if((a=o.pop())&&void 0!==a.pop)for(c=a.length;c--;)o.push(a[c]);else"boolean"==typeof a&&(a=null),(l="function"!=typeof e)&&(null==a?a="":"number"==typeof a?a=String(a):"string"!=typeof a&&(l=!1)),l&&i?h[h.length-1]+=a:h===r?h=[a]:h.push(a),i=l;var d=new n;return d.nodeName=e,d.children=h,d.attributes=null==t?void 0:t,d.key=null==t?void 0:t.key,void 0!==s.vnode&&s.vnode(d),d}function l(e,t){for(var i in t)e[i]=t[i];return e}function c(e,t){e&&("function"==typeof e?e(t):e.current=t)}var h="function"==typeof Promise?Promise.resolve().then.bind(Promise.resolve()):setTimeout;function d(e,t){return a(e.nodeName,l(l({},e.attributes),t),arguments.length>2?[].slice.call(arguments,2):e.children)}var u=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,p=[];function m(e){!e._dirty&&(e._dirty=!0)&&1==p.push(e)&&(s.debounceRendering||h)(g)}function g(){for(var e;e=p.pop();)e._dirty&&N(e)}function f(e,t,i){return"string"==typeof t||"number"==typeof t?void 0!==e.splitText:"string"==typeof t.nodeName?!e._componentConstructor&&v(e,t.nodeName):i||e._componentConstructor===t.nodeName}function v(e,t){return e.normalizedNodeName===t||e.nodeName.toLowerCase()===t.toLowerCase()}function y(e){var t=l({},e.attributes);t.children=e.children;var i=e.nodeName.defaultProps;if(void 0!==i)for(var n in i)void 0===t[n]&&(t[n]=i[n]);return t}function b(e){var t=e.parentNode;t&&t.removeChild(e)}function w(e,t,i,n,s){if("className"===t&&(t="class"),"key"===t);else if("ref"===t)c(i,null),c(n,e);else if("class"!==t||s)if("style"===t){if(n&&"string"!=typeof n&&"string"!=typeof i||(e.style.cssText=n||""),n&&"object"==typeof n){if("string"!=typeof i)for(var o in i)o in n||(e.style[o]="");for(var o in n)e.style[o]="number"==typeof n[o]&&!1===u.test(o)?n[o]+"px":n[o]}}else if("dangerouslySetInnerHTML"===t)n&&(e.innerHTML=n.__html||"");else if("o"==t[0]&&"n"==t[1]){var r=t!==(t=t.replace(/Capture$/,""));t=t.toLowerCase().substring(2),n?i||e.addEventListener(t,S,r):e.removeEventListener(t,S,r),(e._listeners||(e._listeners={}))[t]=n}else if("list"!==t&&"type"!==t&&!s&&t in e){try{e[t]=null==n?"":n}catch(e){}null!=n&&!1!==n||"spellcheck"==t||e.removeAttribute(t)}else{var a=s&&t!==(t=t.replace(/^xlink:?/,""));null==n||!1===n?a?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.removeAttribute(t):"function"!=typeof n&&(a?e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),n):e.setAttribute(t,n))}else e.className=n||""}function S(e){return this._listeners[e.type](s.event&&s.event(e)||e)}var E=[],T=0,M=!1,_=!1;function x(){for(var e;e=E.shift();)s.afterMount&&s.afterMount(e),e.componentDidMount&&e.componentDidMount()}function A(e,t,i,n,s,o){T++||(M=null!=s&&void 0!==s.ownerSVGElement,_=null!=e&&!("__preactattr_"in e));var r=O(e,t,i,n,o);return s&&r.parentNode!==s&&s.appendChild(r),--T||(_=!1,o||x()),r}function O(e,t,i,n,s){var o=e,r=M;if(null!=t&&"boolean"!=typeof t||(t=""),"string"==typeof t||"number"==typeof t)return e&&void 0!==e.splitText&&e.parentNode&&(!e._component||s)?e.nodeValue!=t&&(e.nodeValue=t):(o=document.createTextNode(t),e&&(e.parentNode&&e.parentNode.replaceChild(o,e),P(e,!0))),o.__preactattr_=!0,o;var a,l,c=t.nodeName;if("function"==typeof c)return function(e,t,i,n){var s=e&&e._component,o=s,r=e,a=s&&e._componentConstructor===t.nodeName,l=a,c=y(t);for(;s&&!l&&(s=s._parentComponent);)l=s.constructor===t.nodeName;s&&l&&(!n||s._component)?(L(s,c,3,i,n),e=s.base):(o&&!a&&(k(o),e=r=null),s=I(t.nodeName,c,i),e&&!s.nextBase&&(s.nextBase=e,r=null),L(s,c,1,i,n),e=s.base,r&&e!==r&&(r._component=null,P(r,!1)));return e}(e,t,i,n);if(M="svg"===c||"foreignObject"!==c&&M,c=String(c),(!e||!v(e,c))&&(a=c,(l=M?document.createElementNS("http://www.w3.org/2000/svg",a):document.createElement(a)).normalizedNodeName=a,o=l,e)){for(;e.firstChild;)o.appendChild(e.firstChild);e.parentNode&&e.parentNode.replaceChild(o,e),P(e,!0)}var h=o.firstChild,d=o.__preactattr_,u=t.children;if(null==d){d=o.__preactattr_={};for(var p=o.attributes,m=p.length;m--;)d[p[m].name]=p[m].value}return!_&&u&&1===u.length&&"string"==typeof u[0]&&null!=h&&void 0!==h.splitText&&null==h.nextSibling?h.nodeValue!=u[0]&&(h.nodeValue=u[0]):(u&&u.length||null!=h)&&function(e,t,i,n,s){var o,r,a,l,c,h=e.childNodes,d=[],u={},p=0,m=0,g=h.length,v=0,y=t?t.length:0;if(0!==g)for(var w=0;w<g;w++){var S=h[w],E=S.__preactattr_;null!=(T=y&&E?S._component?S._component.__key:E.key:null)?(p++,u[T]=S):(E||(void 0!==S.splitText?!s||S.nodeValue.trim():s))&&(d[v++]=S)}if(0!==y)for(w=0;w<y;w++){var T;if(c=null,null!=(T=(l=t[w]).key))p&&void 0!==u[T]&&(c=u[T],u[T]=void 0,p--);else if(m<v)for(o=m;o<v;o++)if(void 0!==d[o]&&f(r=d[o],l,s)){c=r,d[o]=void 0,o===v-1&&v--,o===m&&m++;break}c=O(c,l,i,n),a=h[w],c&&c!==e&&c!==a&&(null==a?e.appendChild(c):c===a.nextSibling?b(a):e.insertBefore(c,a))}if(p)for(var w in u)void 0!==u[w]&&P(u[w],!1);for(;m<=v;)void 0!==(c=d[v--])&&P(c,!1)}(o,u,i,n,_||null!=d.dangerouslySetInnerHTML),function(e,t,i){var n;for(n in i)t&&null!=t[n]||null==i[n]||w(e,n,i[n],i[n]=void 0,M);for(n in t)"children"===n||"innerHTML"===n||n in i&&t[n]===("value"===n||"checked"===n?e[n]:i[n])||w(e,n,i[n],i[n]=t[n],M)}(o,t.attributes,d),M=r,o}function P(e,t){var i=e._component;i?k(i):(null!=e.__preactattr_&&c(e.__preactattr_.ref,null),!1!==t&&null!=e.__preactattr_||b(e),C(e))}function C(e){for(e=e.lastChild;e;){var t=e.previousSibling;P(e,!0),e=t}}var D=[];function I(e,t,i){var n,s=D.length;for(e.prototype&&e.prototype.render?(n=new e(t,i),B.call(n,t,i)):((n=new B(t,i)).constructor=e,n.render=R);s--;)if(D[s].constructor===e)return n.nextBase=D[s].nextBase,D.splice(s,1),n;return n}function R(e,t,i){return this.constructor(e,i)}function L(e,t,i,n,o){e._disable||(e._disable=!0,e.__ref=t.ref,e.__key=t.key,delete t.ref,delete t.key,void 0===e.constructor.getDerivedStateFromProps&&(!e.base||o?e.componentWillMount&&e.componentWillMount():e.componentWillReceiveProps&&e.componentWillReceiveProps(t,n)),n&&n!==e.context&&(e.prevContext||(e.prevContext=e.context),e.context=n),e.prevProps||(e.prevProps=e.props),e.props=t,e._disable=!1,0!==i&&(1!==i&&!1===s.syncComponentUpdates&&e.base?m(e):N(e,1,o)),c(e.__ref,e))}function N(e,t,i,n){if(!e._disable){var o,r,a,c=e.props,h=e.state,d=e.context,u=e.prevProps||c,p=e.prevState||h,m=e.prevContext||d,g=e.base,f=e.nextBase,v=g||f,b=e._component,w=!1,S=m;if(e.constructor.getDerivedStateFromProps&&(h=l(l({},h),e.constructor.getDerivedStateFromProps(c,h)),e.state=h),g&&(e.props=u,e.state=p,e.context=m,2!==t&&e.shouldComponentUpdate&&!1===e.shouldComponentUpdate(c,h,d)?w=!0:e.componentWillUpdate&&e.componentWillUpdate(c,h,d),e.props=c,e.state=h,e.context=d),e.prevProps=e.prevState=e.prevContext=e.nextBase=null,e._dirty=!1,!w){o=e.render(c,h,d),e.getChildContext&&(d=l(l({},d),e.getChildContext())),g&&e.getSnapshotBeforeUpdate&&(S=e.getSnapshotBeforeUpdate(u,p));var M,_,O=o&&o.nodeName;if("function"==typeof O){var C=y(o);(r=b)&&r.constructor===O&&C.key==r.__key?L(r,C,1,d,!1):(M=r,e._component=r=I(O,C,d),r.nextBase=r.nextBase||f,r._parentComponent=e,L(r,C,0,d,!1),N(r,1,i,!0)),_=r.base}else a=v,(M=b)&&(a=e._component=null),(v||1===t)&&(a&&(a._component=null),_=A(a,o,d,i||!g,v&&v.parentNode,!0));if(v&&_!==v&&r!==b){var D=v.parentNode;D&&_!==D&&(D.replaceChild(_,v),M||(v._component=null,P(v,!1)))}if(M&&k(M),e.base=_,_&&!n){for(var R=e,B=e;B=B._parentComponent;)(R=B).base=_;_._component=R,_._componentConstructor=R.constructor}}for(!g||i?E.push(e):w||(e.componentDidUpdate&&e.componentDidUpdate(u,p,S),s.afterUpdate&&s.afterUpdate(e));e._renderCallbacks.length;)e._renderCallbacks.pop().call(e);T||n||x()}}function k(e){s.beforeUnmount&&s.beforeUnmount(e);var t=e.base;e._disable=!0,e.componentWillUnmount&&e.componentWillUnmount(),e.base=null;var i=e._component;i?k(i):t&&(null!=t.__preactattr_&&c(t.__preactattr_.ref,null),e.nextBase=t,b(t),D.push(e),C(t)),c(e.__ref,null)}function B(e,t){this._dirty=!0,this.context=t,this.props=e,this.state=this.state||{},this._renderCallbacks=[]}function F(e,t,i){return A(i,e,{},!1,t,!1)}function U(){return{}}l(B.prototype,{setState:function(e,t){this.prevState||(this.prevState=this.state),this.state=l(l({},this.state),"function"==typeof e?e(this.state,this.props):e),t&&this._renderCallbacks.push(t),m(this)},forceUpdate:function(e){e&&this._renderCallbacks.push(e),N(this,2)},render:function(){}});const V={h:a,createElement:a,cloneElement:d,createRef:U,Component:B,render:F,rerender:g,options:s}},77824:(e,t,i)=>{var n=i(2823),s=i(34515),o=i(48738),r=[0,2,3],a=[2,1,3];e.exports=function(e,t){e&&(s(e)||o(e))||(t=e||{},e=null);for(var i="string"==typeof(t="number"==typeof t?{count:t}:t||{}).type?t.type:"uint16",l="number"==typeof t.count?t.count:1,c=t.start||0,h=!1!==t.clockwise?r:a,d=h[0],u=h[1],p=h[2],m=6*l,g=e||new(n(i))(m),f=0,v=0;f<m;f+=6,v+=4){var y=f+c;g[y+0]=v+0,g[y+1]=v+1,g[y+2]=v+2,g[y+3]=v+d,g[y+4]=v+u,g[y+5]=v+p}return g}},62587:e=>{"use strict";function t(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,i,n,s){i=i||"&",n=n||"=";var o={};if("string"!=typeof e||0===e.length)return o;var r=/\+/g;e=e.split(i);var a=1e3;s&&"number"==typeof s.maxKeys&&(a=s.maxKeys);var l=e.length;a>0&&l>a&&(l=a);for(var c=0;c<l;++c){var h,d,u,p,m=e[c].replace(r,"%20"),g=m.indexOf(n);g>=0?(h=m.substr(0,g),d=m.substr(g+1)):(h=m,d=""),u=decodeURIComponent(h),p=decodeURIComponent(d),t(o,u)?Array.isArray(o[u])?o[u].push(p):o[u]=[o[u],p]:o[u]=p}return o}},12361:e=>{"use strict";var t=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,i,n,s){return i=i||"&",n=n||"=",null===e&&(e=void 0),"object"==typeof e?Object.keys(e).map((function(s){var o=encodeURIComponent(t(s))+n;return Array.isArray(e[s])?e[s].map((function(e){return o+encodeURIComponent(t(e))})).join(i):o+encodeURIComponent(t(e[s]))})).join(i):s?encodeURIComponent(t(s))+n+encodeURIComponent(t(e)):""}},17673:(e,t,i)=>{"use strict";t.decode=t.parse=i(62587),t.encode=t.stringify=i(12361)},82582:function(e){e.exports=function(){"use strict";function e(e,n,s,o,r){!function e(i,n,s,o,r){for(;o>s;){if(o-s>600){var a=o-s+1,l=n-s+1,c=Math.log(a),h=.5*Math.exp(2*c/3),d=.5*Math.sqrt(c*h*(a-h)/a)*(l-a/2<0?-1:1);e(i,n,Math.max(s,Math.floor(n-l*h/a+d)),Math.min(o,Math.floor(n+(a-l)*h/a+d)),r)}var u=i[n],p=s,m=o;for(t(i,s,n),r(i[o],u)>0&&t(i,s,o);p<m;){for(t(i,p,m),p++,m--;r(i[p],u)<0;)p++;for(;r(i[m],u)>0;)m--}0===r(i[s],u)?t(i,s,m):t(i,++m,o),m<=n&&(s=m+1),n<=m&&(o=m-1)}}(e,n,s||0,o||e.length-1,r||i)}function t(e,t,i){var n=e[t];e[t]=e[i],e[i]=n}function i(e,t){return e<t?-1:e>t?1:0}var n=function(e){void 0===e&&(e=9),this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function s(e,t,i){if(!i)return t.indexOf(e);for(var n=0;n<t.length;n++)if(i(e,t[n]))return n;return-1}function o(e,t){r(e,0,e.children.length,t,e)}function r(e,t,i,n,s){s||(s=m(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(var o=t;o<i;o++){var r=e.children[o];a(s,e.leaf?n(r):r)}return s}function a(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function l(e,t){return e.minX-t.minX}function c(e,t){return e.minY-t.minY}function h(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function d(e){return e.maxX-e.minX+(e.maxY-e.minY)}function u(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function p(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function m(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function g(t,i,n,s,o){for(var r=[i,n];r.length;)if(!((n=r.pop())-(i=r.pop())<=s)){var a=i+Math.ceil((n-i)/s/2)*s;e(t,a,i,n,o),r.push(i,a,a,n)}}return n.prototype.all=function(){return this._all(this.data,[])},n.prototype.search=function(e){var t=this.data,i=[];if(!p(e,t))return i;for(var n=this.toBBox,s=[];t;){for(var o=0;o<t.children.length;o++){var r=t.children[o],a=t.leaf?n(r):r;p(e,a)&&(t.leaf?i.push(r):u(e,a)?this._all(r,i):s.push(r))}t=s.pop()}return i},n.prototype.collides=function(e){var t=this.data;if(!p(e,t))return!1;for(var i=[];t;){for(var n=0;n<t.children.length;n++){var s=t.children[n],o=t.leaf?this.toBBox(s):s;if(p(e,o)){if(t.leaf||u(e,o))return!0;i.push(s)}}t=i.pop()}return!1},n.prototype.load=function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0;t<e.length;t++)this.insert(e[t]);return this}var i=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var n=this.data;this.data=i,i=n}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},n.prototype.insert=function(e){return e&&this._insert(e,this.data.height-1),this},n.prototype.clear=function(){return this.data=m([]),this},n.prototype.remove=function(e,t){if(!e)return this;for(var i,n,o,r=this.data,a=this.toBBox(e),l=[],c=[];r||l.length;){if(r||(r=l.pop(),n=l[l.length-1],i=c.pop(),o=!0),r.leaf){var h=s(e,r.children,t);if(-1!==h)return r.children.splice(h,1),l.push(r),this._condense(l),this}o||r.leaf||!u(r,a)?n?(i++,r=n.children[i],o=!1):r=null:(l.push(r),c.push(i),i=0,n=r,r=r.children[0])}return this},n.prototype.toBBox=function(e){return e},n.prototype.compareMinX=function(e,t){return e.minX-t.minX},n.prototype.compareMinY=function(e,t){return e.minY-t.minY},n.prototype.toJSON=function(){return this.data},n.prototype.fromJSON=function(e){return this.data=e,this},n.prototype._all=function(e,t){for(var i=[];e;)e.leaf?t.push.apply(t,e.children):i.push.apply(i,e.children),e=i.pop();return t},n.prototype._build=function(e,t,i,n){var s,r=i-t+1,a=this._maxEntries;if(r<=a)return o(s=m(e.slice(t,i+1)),this.toBBox),s;n||(n=Math.ceil(Math.log(r)/Math.log(a)),a=Math.ceil(r/Math.pow(a,n-1))),(s=m([])).leaf=!1,s.height=n;var l=Math.ceil(r/a),c=l*Math.ceil(Math.sqrt(a));g(e,t,i,c,this.compareMinX);for(var h=t;h<=i;h+=c){var d=Math.min(h+c-1,i);g(e,h,d,l,this.compareMinY);for(var u=h;u<=d;u+=l){var p=Math.min(u+l-1,d);s.children.push(this._build(e,u,p,n-1))}}return o(s,this.toBBox),s},n.prototype._chooseSubtree=function(e,t,i,n){for(;n.push(t),!t.leaf&&n.length-1!==i;){for(var s=1/0,o=1/0,r=void 0,a=0;a<t.children.length;a++){var l=t.children[a],c=h(l),d=(u=e,p=l,(Math.max(p.maxX,u.maxX)-Math.min(p.minX,u.minX))*(Math.max(p.maxY,u.maxY)-Math.min(p.minY,u.minY))-c);d<o?(o=d,s=c<s?c:s,r=l):d===o&&c<s&&(s=c,r=l)}t=r||t.children[0]}var u,p;return t},n.prototype._insert=function(e,t,i){var n=i?e:this.toBBox(e),s=[],o=this._chooseSubtree(n,this.data,t,s);for(o.children.push(e),a(o,n);t>=0&&s[t].children.length>this._maxEntries;)this._split(s,t),t--;this._adjustParentBBoxes(n,s,t)},n.prototype._split=function(e,t){var i=e[t],n=i.children.length,s=this._minEntries;this._chooseSplitAxis(i,s,n);var r=this._chooseSplitIndex(i,s,n),a=m(i.children.splice(r,i.children.length-r));a.height=i.height,a.leaf=i.leaf,o(i,this.toBBox),o(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(i,a)},n.prototype._splitRoot=function(e,t){this.data=m([e,t]),this.data.height=e.height+1,this.data.leaf=!1,o(this.data,this.toBBox)},n.prototype._chooseSplitIndex=function(e,t,i){for(var n,s,o,a,l,c,d,u=1/0,p=1/0,m=t;m<=i-t;m++){var g=r(e,0,m,this.toBBox),f=r(e,m,i,this.toBBox),v=(s=g,o=f,a=void 0,l=void 0,c=void 0,d=void 0,a=Math.max(s.minX,o.minX),l=Math.max(s.minY,o.minY),c=Math.min(s.maxX,o.maxX),d=Math.min(s.maxY,o.maxY),Math.max(0,c-a)*Math.max(0,d-l)),y=h(g)+h(f);v<u?(u=v,n=m,p=y<p?y:p):v===u&&y<p&&(p=y,n=m)}return n||i-t},n.prototype._chooseSplitAxis=function(e,t,i){var n=e.leaf?this.compareMinX:l,s=e.leaf?this.compareMinY:c;this._allDistMargin(e,t,i,n)<this._allDistMargin(e,t,i,s)&&e.children.sort(n)},n.prototype._allDistMargin=function(e,t,i,n){e.children.sort(n);for(var s=this.toBBox,o=r(e,0,t,s),l=r(e,i-t,i,s),c=d(o)+d(l),h=t;h<i-t;h++){var u=e.children[h];a(o,e.leaf?s(u):u),c+=d(o)}for(var p=i-t-1;p>=t;p--){var m=e.children[p];a(l,e.leaf?s(m):m),c+=d(l)}return c},n.prototype._adjustParentBBoxes=function(e,t,i){for(var n=i;n>=0;n--)a(t[n],e)},n.prototype._condense=function(e){for(var t=e.length-1,i=void 0;t>=0;t--)0===e[t].children.length?t>0?(i=e[t-1].children).splice(i.indexOf(e[t]),1):this.clear():o(e[t],this.toBBox)},n}()},91033:(e,t,i)=>{"use strict";i.d(t,{Z:()=>M});var n=function(){if("undefined"!=typeof Map)return Map;function e(e,t){var i=-1;return e.some((function(e,n){return e[0]===t&&(i=n,!0)})),i}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(t){var i=e(this.__entries__,t),n=this.__entries__[i];return n&&n[1]},t.prototype.set=function(t,i){var n=e(this.__entries__,t);~n?this.__entries__[n][1]=i:this.__entries__.push([t,i])},t.prototype.delete=function(t){var i=this.__entries__,n=e(i,t);~n&&i.splice(n,1)},t.prototype.has=function(t){return!!~e(this.__entries__,t)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(e,t){void 0===t&&(t=null);for(var i=0,n=this.__entries__;i<n.length;i++){var s=n[i];e.call(t,s[1],s[0])}},t}()}(),s="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,o=void 0!==i.g&&i.g.Math===Math?i.g:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),r="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(o):function(e){return setTimeout((function(){return e(Date.now())}),1e3/60)};var a=["top","right","bottom","left","width","height","size","weight"],l="undefined"!=typeof MutationObserver,c=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(e,t){var i=!1,n=!1,s=0;function o(){i&&(i=!1,e()),n&&l()}function a(){r(o)}function l(){var e=Date.now();if(i){if(e-s<2)return;n=!0}else i=!0,n=!1,setTimeout(a,t);s=e}return l}(this.refresh.bind(this),20)}return e.prototype.addObserver=function(e){~this.observers_.indexOf(e)||this.observers_.push(e),this.connected_||this.connect_()},e.prototype.removeObserver=function(e){var t=this.observers_,i=t.indexOf(e);~i&&t.splice(i,1),!t.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},e.prototype.updateObservers_=function(){var e=this.observers_.filter((function(e){return e.gatherActive(),e.hasActive()}));return e.forEach((function(e){return e.broadcastActive()})),e.length>0},e.prototype.connect_=function(){s&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),l?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){s&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(e){var t=e.propertyName,i=void 0===t?"":t;a.some((function(e){return!!~i.indexOf(e)}))&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),h=function(e,t){for(var i=0,n=Object.keys(t);i<n.length;i++){var s=n[i];Object.defineProperty(e,s,{value:t[s],enumerable:!1,writable:!1,configurable:!0})}return e},d=function(e){return e&&e.ownerDocument&&e.ownerDocument.defaultView||o},u=y(0,0,0,0);function p(e){return parseFloat(e)||0}function m(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];return t.reduce((function(t,i){return t+p(e["border-"+i+"-width"])}),0)}function g(e){var t=e.clientWidth,i=e.clientHeight;if(!t&&!i)return u;var n=d(e).getComputedStyle(e),s=function(e){for(var t={},i=0,n=["top","right","bottom","left"];i<n.length;i++){var s=n[i],o=e["padding-"+s];t[s]=p(o)}return t}(n),o=s.left+s.right,r=s.top+s.bottom,a=p(n.width),l=p(n.height);if("border-box"===n.boxSizing&&(Math.round(a+o)!==t&&(a-=m(n,"left","right")+o),Math.round(l+r)!==i&&(l-=m(n,"top","bottom")+r)),!function(e){return e===d(e).document.documentElement}(e)){var c=Math.round(a+o)-t,h=Math.round(l+r)-i;1!==Math.abs(c)&&(a-=c),1!==Math.abs(h)&&(l-=h)}return y(s.left,s.top,a,l)}var f="undefined"!=typeof SVGGraphicsElement?function(e){return e instanceof d(e).SVGGraphicsElement}:function(e){return e instanceof d(e).SVGElement&&"function"==typeof e.getBBox};function v(e){return s?f(e)?function(e){var t=e.getBBox();return y(0,0,t.width,t.height)}(e):g(e):u}function y(e,t,i,n){return{x:e,y:t,width:i,height:n}}var b=function(){function e(e){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=y(0,0,0,0),this.target=e}return e.prototype.isActive=function(){var e=v(this.target);return this.contentRect_=e,e.width!==this.broadcastWidth||e.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var e=this.contentRect_;return this.broadcastWidth=e.width,this.broadcastHeight=e.height,e},e}(),w=function(e,t){var i,n,s,o,r,a,l,c=(n=(i=t).x,s=i.y,o=i.width,r=i.height,a="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,l=Object.create(a.prototype),h(l,{x:n,y:s,width:o,height:r,top:s,right:n+o,bottom:r+s,left:n}),l);h(this,{target:e,contentRect:c})},S=function(){function e(e,t,i){if(this.activeObservations_=[],this.observations_=new n,"function"!=typeof e)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=e,this.controller_=t,this.callbackCtx_=i}return e.prototype.observe=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof d(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)||(t.set(e,new b(e)),this.controller_.addObserver(this),this.controller_.refresh())}},e.prototype.unobserve=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof d(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)&&(t.delete(e),t.size||this.controller_.removeObserver(this))}},e.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},e.prototype.gatherActive=function(){var e=this;this.clearActive(),this.observations_.forEach((function(t){t.isActive()&&e.activeObservations_.push(t)}))},e.prototype.broadcastActive=function(){if(this.hasActive()){var e=this.callbackCtx_,t=this.activeObservations_.map((function(e){return new w(e.target,e.broadcastRect())}));this.callback_.call(e,t,e),this.clearActive()}},e.prototype.clearActive=function(){this.activeObservations_.splice(0)},e.prototype.hasActive=function(){return this.activeObservations_.length>0},e}(),E="undefined"!=typeof WeakMap?new WeakMap:new n,T=function e(t){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var i=c.getInstance(),n=new S(t,i,this);E.set(this,n)};["observe","unobserve","disconnect"].forEach((function(e){T.prototype[e]=function(){var t;return(t=E.get(this))[e].apply(t,arguments)}}));const M=void 0!==o.ResizeObserver?o.ResizeObserver:T},5277:(e,t,i)=>{var n,s,o;o=function(){var e,t,i=document,n=i.getElementsByTagName("head")[0],s={},o={},r={},a={};function l(e,t){for(var i=0,n=e.length;i<n;++i)if(!t(e[i]))return!1;return 1}function c(e,t){l(e,(function(e){return t(e),1}))}function h(t,i,n){t=t.push?t:[t];var u=i&&i.call,p=u?i:n,m=u?t.join(""):i,g=t.length;function f(e){return e.call?e():s[e]}function v(){if(!--g)for(var e in s[m]=1,p&&p(),r)l(e.split("|"),f)&&!c(r[e],f)&&(r[e]=[])}return setTimeout((function(){c(t,(function t(i,n){return null===i?v():(n||/^https?:\/\//.test(i)||!e||(i=-1===i.indexOf(".js")?e+i+".js":e+i),a[i]?(m&&(o[m]=1),2==a[i]?v():setTimeout((function(){t(i,!0)}),0)):(a[i]=1,m&&(o[m]=1),void d(i,v)))}))}),0),h}function d(e,s){var o,r=i.createElement("script");r.onload=r.onerror=r.onreadystatechange=function(){r.readyState&&!/^c|loade/.test(r.readyState)||o||(r.onload=r.onreadystatechange=null,o=1,a[e]=2,s())},r.async=1,r.src=t?e+(-1===e.indexOf("?")?"?":"&")+t:e,n.insertBefore(r,n.lastChild)}return h.get=d,h.order=function(e,t,i){!function n(s){s=e.shift(),e.length?h(s,n):h(s,t,i)}()},h.path=function(t){e=t},h.urlArgs=function(e){t=e},h.ready=function(e,t,i){e=e.push?e:[e];var n,o=[];return!c(e,(function(e){s[e]||o.push(e)}))&&l(e,(function(e){return s[e]}))?t():(n=e.join("|"),r[n]=r[n]||[],r[n].push(t),i&&i(o)),h},h.done=function(e){h([null],e)},h},e.exports?e.exports=o():void 0===(s="function"==typeof(n=o)?n.call(t,i,t,e):n)||(e.exports=s)},61040:(e,t,i)=>{"use strict";var n=i(13733),s=i(27308),o=i(21924)("String.prototype.replace"),r=/^[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]+/,a=/[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]+$/;e.exports=function(){var e=s(n(this));return o(o(e,r,""),a,"")}},46057:(e,t,i)=>{"use strict";var n=i(55559),s=i(4289),o=i(61040),r=i(30254),a=i(60029),l=n(r());s(l,{getPolyfill:r,implementation:o,shim:a}),e.exports=l},30254:(e,t,i)=>{"use strict";var n=i(61040);e.exports=function(){return String.prototype.trim&&"​"==="​".trim()?String.prototype.trim:n}},60029:(e,t,i)=>{"use strict";var n=i(4289),s=i(30254);e.exports=function(){var e=s();return n(String.prototype,{trim:e},{trim:function(){return String.prototype.trim!==e}}),e}},67121:(e,t,i)=>{"use strict";e=i.hmd(e);!function(e){var t,i=e.Symbol;if("function"==typeof i)if(i.observable)t=i.observable;else{t=i.for("https://github.com/benlesh/symbol-observable");try{i.observable=t}catch(e){}}else t="@@observable"}("undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==i.g?i.g:e)},11385:(e,t,i)=>{var n=i(73134),s=i(35717),o=i(77824),r=i(82910),a=i(70162),l=THREE.BufferGeometry;function c(e){l.call(this),"string"==typeof e&&(e={text:e}),this._opt=Object.assign({},e),e&&this.update(e)}e.exports=function(e){return new c(e)},s(c,l),c.prototype.update=function(e){if("string"==typeof e&&(e={text:e}),!(e=Object.assign({},this._opt,e)).font)throw new TypeError("must specify a { font } in options");this.layout=n(e);var t=!1!==e.flipY,i=e.font,s=i.common.scaleW,a=i.common.scaleH,l=this.layout.glyphs.filter((function(e){var t=e.data;return t.width*t.height>0}));this.visibleGlyphs=l;var c=r.positions(l),h=r.uvs(l,s,a,t),d=o([],{clockwise:!0,type:"uint16",count:l.length});if(this.setIndex(d),this.setAttribute("position",new THREE.BufferAttribute(c,2)),this.setAttribute("uv",new THREE.BufferAttribute(h,2)),!e.multipage&&"page"in this.attributes)this.removeAttribute("page");else if(e.multipage){var u=r.pages(l);this.setAttribute("page",new THREE.BufferAttribute(u,1))}},c.prototype.computeBoundingSphere=function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere);var e=this.attributes.position.array,t=this.attributes.position.itemSize;if(!e||!t||e.length<2)return this.boundingSphere.radius=0,void this.boundingSphere.center.set(0,0,0);a.computeSphere(e,this.boundingSphere),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')},c.prototype.computeBoundingBox=function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);var e=this.boundingBox,t=this.attributes.position.array,i=this.attributes.position.itemSize;!t||!i||t.length<2?e.makeEmpty():a.computeBox(t,e)}},70162:e=>{var t={min:[0,0],max:[0,0]};function i(e){var i=e.length/2;t.min[0]=e[0],t.min[1]=e[1],t.max[0]=e[0],t.max[1]=e[1];for(var n=0;n<i;n++){var s=e[2*n+0],o=e[2*n+1];t.min[0]=Math.min(s,t.min[0]),t.min[1]=Math.min(o,t.min[1]),t.max[0]=Math.max(s,t.max[0]),t.max[1]=Math.max(o,t.max[1])}}e.exports.computeBox=function(e,n){i(e),n.min.set(t.min[0],t.min[1],0),n.max.set(t.max[0],t.max[1],0)},e.exports.computeSphere=function(e,n){i(e);var s=t.min[0],o=t.min[1],r=t.max[0]-s,a=t.max[1]-o,l=Math.sqrt(r*r+a*a);n.center.set(s+r/2,o+a/2,0),n.radius=l/2}},82910:e=>{e.exports.pages=function(e){var t=new Float32Array(4*e.length*1),i=0;return e.forEach((function(e){var n=e.data.page||0;t[i++]=n,t[i++]=n,t[i++]=n,t[i++]=n})),t},e.exports.uvs=function(e,t,i,n){var s=new Float32Array(4*e.length*2),o=0;return e.forEach((function(e){var r=e.data,a=r.x+r.width,l=r.y+r.height,c=r.x/t,h=r.y/i,d=a/t,u=l/i;n&&(h=(i-r.y)/i,u=(i-l)/i),s[o++]=c,s[o++]=h,s[o++]=c,s[o++]=u,s[o++]=d,s[o++]=u,s[o++]=d,s[o++]=h})),s},e.exports.positions=function(e){var t=new Float32Array(4*e.length*2),i=0;return e.forEach((function(e){var n=e.data,s=e.position[0]+n.xoffset,o=e.position[1]+n.yoffset,r=n.width,a=n.height;t[i++]=s,t[i++]=o,t[i++]=s,t[i++]=o+a,t[i++]=s+r,t[i++]=o+a,t[i++]=s+r,t[i++]=o})),t}},2212:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ACESFilmicToneMapping:()=>ie,AddEquation:()=>_,AddOperation:()=>X,AdditiveAnimationBlendMode:()=>Zt,AdditiveBlending:()=>S,AlphaFormat:()=>ke,AlwaysDepth:()=>G,AlwaysStencilFunc:()=>Ti,AmbientLight:()=>Oh,AmbientLightProbe:()=>Kh,AnimationClip:()=>Nc,AnimationLoader:()=>zc,AnimationMixer:()=>Sd,AnimationObjectGroup:()=>wd,AnimationUtils:()=>Ec,ArcCurve:()=>Xc,ArrayCamera:()=>ua,ArrowHelper:()=>ArrowHelper,Audio:()=>Audio,AudioAnalyser:()=>AudioAnalyser,AudioContext:()=>Wh,AudioListener:()=>AudioListener,AudioLoader:()=>Zh,AxesHelper:()=>AxesHelper,AxisHelper:()=>Ku,BackSide:()=>g,BasicDepthPacking:()=>si,BasicShadowMap:()=>h,BinaryTextureLoader:()=>Ju,Bone:()=>qa,BooleanKeyframeTrack:()=>Oc,BoundingBoxHelper:()=>Yu,Box2:()=>Box2,Box3:()=>Box3,Box3Helper:()=>Box3Helper,BoxBufferGeometry:()=>BoxBufferGeometry,BoxGeometry:()=>BoxGeometry,BoxHelper:()=>BoxHelper,BufferAttribute:()=>hs,BufferGeometry:()=>Ds,BufferGeometryLoader:()=>Nh,ByteType:()=>_e,Cache:()=>Bc,Camera:()=>io,CameraHelper:()=>CameraHelper,CanvasRenderer:()=>ip,CanvasTexture:()=>El,CatmullRomCurve3:()=>nh,CineonToneMapping:()=>te,CircleBufferGeometry:()=>CircleBufferGeometry,CircleGeometry:()=>CircleGeometry,ClampToEdgeWrapping:()=>ue,Clock:()=>Clock,ClosedSplineCurve3:()=>Wu,Color:()=>Color,ColorKeyframeTrack:()=>Pc,CompressedTexture:()=>Sl,CompressedTextureLoader:()=>jc,ConeBufferGeometry:()=>ConeBufferGeometry,ConeGeometry:()=>ConeGeometry,CubeCamera:()=>oo,CubeGeometry:()=>BoxGeometry,CubeReflectionMapping:()=>oe,CubeRefractionMapping:()=>re,CubeTexture:()=>ro,CubeTextureLoader:()=>Zc,CubeUVReflectionMapping:()=>ce,CubeUVRefractionMapping:()=>he,CubicBezierCurve:()=>ah,CubicBezierCurve3:()=>lh,CubicInterpolant:()=>Mc,CullFaceBack:()=>a,CullFaceFront:()=>l,CullFaceFrontBack:()=>c,CullFaceNone:()=>r,Curve:()=>Yc,CurvePath:()=>gh,CustomBlending:()=>M,CustomToneMapping:()=>ne,CylinderBufferGeometry:()=>CylinderBufferGeometry,CylinderGeometry:()=>CylinderGeometry,Cylindrical:()=>Cylindrical,DataTexture:()=>lo,DataTexture2DArray:()=>Do,DataTexture3D:()=>Io,DataTextureLoader:()=>qc,DataUtils:()=>Xd,DecrementStencilOp:()=>ui,DecrementWrapStencilOp:()=>mi,DefaultLoadingManager:()=>Uc,DepthFormat:()=>Ge,DepthStencilFormat:()=>ze,DepthTexture:()=>Tl,DirectionalLight:()=>Ah,DirectionalLightHelper:()=>DirectionalLightHelper,DiscreteInterpolant:()=>xc,DodecahedronBufferGeometry:()=>DodecahedronBufferGeometry,DodecahedronGeometry:()=>DodecahedronGeometry,DoubleSide:()=>f,DstAlphaFactor:()=>k,DstColorFactor:()=>F,DynamicBufferAttribute:()=>Nu,DynamicCopyUsage:()=>Di,DynamicDrawUsage:()=>_i,DynamicReadUsage:()=>Oi,EdgesGeometry:()=>EdgesGeometry,EdgesHelper:()=>$u,EllipseCurve:()=>$c,EqualDepth:()=>W,EqualStencilFunc:()=>yi,EquirectangularReflectionMapping:()=>ae,EquirectangularRefractionMapping:()=>le,Euler:()=>Euler,EventDispatcher:()=>Ni,ExtrudeBufferGeometry:()=>ExtrudeBufferGeometry,ExtrudeGeometry:()=>ExtrudeGeometry,Face3:()=>Face3,Face4:()=>wu,FaceColors:()=>Mu,FileLoader:()=>Gc,FlatShading:()=>v,Float16BufferAttribute:()=>ys,Float32Attribute:()=>zu,Float32BufferAttribute:()=>bs,Float64Attribute:()=>ju,Float64BufferAttribute:()=>ws,FloatType:()=>Ce,Fog:()=>Fog,FogExp2:()=>FogExp2,Font:()=>Hh,FontLoader:()=>zh,FrontSide:()=>m,Frustum:()=>Frustum,GLBufferAttribute:()=>Td,GLSL1:()=>Ri,GLSL3:()=>Li,GammaEncoding:()=>Qt,Geometry:()=>Ol,GeometryUtils:()=>tp,GreaterDepth:()=>q,GreaterEqualDepth:()=>Z,GreaterEqualStencilFunc:()=>Ei,GreaterStencilFunc:()=>wi,GridHelper:()=>GridHelper,Group:()=>pa,HalfFloatType:()=>De,HemisphereLight:()=>bh,HemisphereLightHelper:()=>HemisphereLightHelper,HemisphereLightProbe:()=>qh,IcosahedronBufferGeometry:()=>IcosahedronBufferGeometry,IcosahedronGeometry:()=>IcosahedronGeometry,ImageBitmapLoader:()=>Uh,ImageLoader:()=>Wc,ImageUtils:()=>Vi,ImmediateRenderObject:()=>Cd,IncrementStencilOp:()=>di,IncrementWrapStencilOp:()=>pi,InstancedBufferAttribute:()=>Lh,InstancedBufferGeometry:()=>Rh,InstancedInterleavedBuffer:()=>Ed,InstancedMesh:()=>tl,Int16Attribute:()=>Uu,Int16BufferAttribute:()=>ms,Int32Attribute:()=>Hu,Int32BufferAttribute:()=>fs,Int8Attribute:()=>ku,Int8BufferAttribute:()=>ds,IntType:()=>Oe,InterleavedBuffer:()=>ba,InterleavedBufferAttribute:()=>Sa,Interpolant:()=>Tc,InterpolateDiscrete:()=>Ut,InterpolateLinear:()=>Vt,InterpolateSmooth:()=>Ht,InvertStencilOp:()=>gi,JSONLoader:()=>np,KeepStencilOp:()=>ci,KeyframeTrack:()=>Ac,LOD:()=>Va,LatheBufferGeometry:()=>LatheBufferGeometry,LatheGeometry:()=>LatheGeometry,Layers:()=>Layers,LensFlare:()=>op,LessDepth:()=>z,LessEqualDepth:()=>j,LessEqualStencilFunc:()=>bi,LessStencilFunc:()=>vi,Light:()=>yh,LightProbe:()=>Ch,Line:()=>ll,Line3:()=>Line3,LineBasicMaterial:()=>il,LineCurve:()=>ch,LineCurve3:()=>hh,LineDashedMaterial:()=>wc,LineLoop:()=>ul,LinePieces:()=>Eu,LineSegments:()=>dl,LineStrip:()=>Su,LinearEncoding:()=>$t,LinearFilter:()=>be,LinearInterpolant:()=>_c,LinearMipMapLinearFilter:()=>Te,LinearMipMapNearestFilter:()=>Se,LinearMipmapLinearFilter:()=>Ee,LinearMipmapNearestFilter:()=>we,LinearToneMapping:()=>J,Loader:()=>Vc,LoaderUtils:()=>Ih,LoadingManager:()=>Fc,LogLuvEncoding:()=>ei,LoopOnce:()=>kt,LoopPingPong:()=>Ft,LoopRepeat:()=>Bt,LuminanceAlphaFormat:()=>Ve,LuminanceFormat:()=>Ue,MOUSE:()=>s,Material:()=>rs,MaterialLoader:()=>Dh,Math:()=>Fi,MathUtils:()=>Fi,Matrix3:()=>Matrix3,Matrix4:()=>Matrix4,MaxEquation:()=>P,Mesh:()=>Ys,MeshBasicMaterial:()=>as,MeshDepthMaterial:()=>ra,MeshDistanceMaterial:()=>aa,MeshFaceMaterial:()=>xu,MeshLambertMaterial:()=>yc,MeshMatcapMaterial:()=>bc,MeshNormalMaterial:()=>vc,MeshPhongMaterial:()=>gc,MeshPhysicalMaterial:()=>mc,MeshStandardMaterial:()=>pc,MeshToonMaterial:()=>fc,MinEquation:()=>O,MirroredRepeatWrapping:()=>pe,MixOperation:()=>$,MultiMaterial:()=>Au,MultiplyBlending:()=>T,MultiplyOperation:()=>Y,NearestFilter:()=>me,NearestMipMapLinearFilter:()=>ye,NearestMipMapNearestFilter:()=>fe,NearestMipmapLinearFilter:()=>ve,NearestMipmapNearestFilter:()=>ge,NeverDepth:()=>H,NeverStencilFunc:()=>fi,NoBlending:()=>b,NoColors:()=>Tu,NoToneMapping:()=>Q,NormalAnimationBlendMode:()=>Wt,NormalBlending:()=>w,NotEqualDepth:()=>K,NotEqualStencilFunc:()=>Si,NumberKeyframeTrack:()=>Cc,Object3D:()=>Un,ObjectLoader:()=>ObjectLoader,ObjectSpaceNormalMap:()=>ai,OctahedronBufferGeometry:()=>OctahedronBufferGeometry,OctahedronGeometry:()=>OctahedronGeometry,OneFactor:()=>D,OneMinusDstAlphaFactor:()=>B,OneMinusDstColorFactor:()=>U,OneMinusSrcAlphaFactor:()=>N,OneMinusSrcColorFactor:()=>R,OrthographicCamera:()=>_h,PCFShadowMap:()=>d,PCFSoftShadowMap:()=>u,PMREMGenerator:()=>PMREMGenerator,ParametricBufferGeometry:()=>lc,ParametricGeometry:()=>cc,Particle:()=>Pu,ParticleBasicMaterial:()=>Iu,ParticleSystem:()=>Cu,ParticleSystemMaterial:()=>Ru,Path:()=>fh,PerspectiveCamera:()=>no,Plane:()=>Plane,PlaneBufferGeometry:()=>PlaneBufferGeometry,PlaneGeometry:()=>PlaneGeometry,PlaneHelper:()=>PlaneHelper,PointCloud:()=>Ou,PointCloudMaterial:()=>Du,PointLight:()=>Mh,PointLightHelper:()=>PointLightHelper,Points:()=>yl,PointsMaterial:()=>pl,PolarGridHelper:()=>PolarGridHelper,PolyhedronBufferGeometry:()=>PolyhedronBufferGeometry,PolyhedronGeometry:()=>PolyhedronGeometry,PositionalAudio:()=>PositionalAudio,PropertyBinding:()=>bd,PropertyMixer:()=>ad,QuadraticBezierCurve:()=>dh,QuadraticBezierCurve3:()=>uh,Quaternion:()=>Quaternion,QuaternionKeyframeTrack:()=>Ic,QuaternionLinearInterpolant:()=>Dc,REVISION:()=>n,RGBADepthPacking:()=>oi,RGBAFormat:()=>Fe,RGBAIntegerFormat:()=>Ye,RGBA_ASTC_10x10_Format:()=>yt,RGBA_ASTC_10x5_Format:()=>gt,RGBA_ASTC_10x6_Format:()=>ft,RGBA_ASTC_10x8_Format:()=>vt,RGBA_ASTC_12x10_Format:()=>bt,RGBA_ASTC_12x12_Format:()=>wt,RGBA_ASTC_4x4_Format:()=>at,RGBA_ASTC_5x4_Format:()=>lt,RGBA_ASTC_5x5_Format:()=>ct,RGBA_ASTC_6x5_Format:()=>ht,RGBA_ASTC_6x6_Format:()=>dt,RGBA_ASTC_8x5_Format:()=>ut,RGBA_ASTC_8x6_Format:()=>pt,RGBA_ASTC_8x8_Format:()=>mt,RGBA_BPTC_Format:()=>St,RGBA_ETC2_EAC_Format:()=>rt,RGBA_PVRTC_2BPPV1_Format:()=>nt,RGBA_PVRTC_4BPPV1_Format:()=>it,RGBA_S3TC_DXT1_Format:()=>Xe,RGBA_S3TC_DXT3_Format:()=>Qe,RGBA_S3TC_DXT5_Format:()=>Je,RGBDEncoding:()=>ni,RGBEEncoding:()=>Jt,RGBEFormat:()=>He,RGBFormat:()=>Be,RGBIntegerFormat:()=>Ke,RGBM16Encoding:()=>ii,RGBM7Encoding:()=>ti,RGB_ETC1_Format:()=>st,RGB_ETC2_Format:()=>ot,RGB_PVRTC_2BPPV1_Format:()=>tt,RGB_PVRTC_4BPPV1_Format:()=>et,RGB_S3TC_DXT1_Format:()=>$e,RGFormat:()=>Ze,RGIntegerFormat:()=>qe,RawShaderMaterial:()=>uc,Ray:()=>Ray,Raycaster:()=>Md,RectAreaLight:()=>Ph,RedFormat:()=>je,RedIntegerFormat:()=>We,ReinhardToneMapping:()=>ee,RepeatWrapping:()=>de,ReplaceStencilOp:()=>hi,ReverseSubtractEquation:()=>A,RingBufferGeometry:()=>RingBufferGeometry,RingGeometry:()=>RingGeometry,SRGB8_ALPHA8_ASTC_10x10_Format:()=>Rt,SRGB8_ALPHA8_ASTC_10x5_Format:()=>Ct,SRGB8_ALPHA8_ASTC_10x6_Format:()=>Dt,SRGB8_ALPHA8_ASTC_10x8_Format:()=>It,SRGB8_ALPHA8_ASTC_12x10_Format:()=>Lt,SRGB8_ALPHA8_ASTC_12x12_Format:()=>Nt,SRGB8_ALPHA8_ASTC_4x4_Format:()=>Et,SRGB8_ALPHA8_ASTC_5x4_Format:()=>Tt,SRGB8_ALPHA8_ASTC_5x5_Format:()=>Mt,SRGB8_ALPHA8_ASTC_6x5_Format:()=>_t,SRGB8_ALPHA8_ASTC_6x6_Format:()=>xt,SRGB8_ALPHA8_ASTC_8x5_Format:()=>At,SRGB8_ALPHA8_ASTC_8x6_Format:()=>Ot,SRGB8_ALPHA8_ASTC_8x8_Format:()=>Pt,Scene:()=>Scene,SceneUtils:()=>sp,ShaderChunk:()=>mo,ShaderLib:()=>fo,ShaderMaterial:()=>to,ShadowMaterial:()=>dc,Shape:()=>vh,ShapeBufferGeometry:()=>ShapeBufferGeometry,ShapeGeometry:()=>ShapeGeometry,ShapePath:()=>Vh,ShapeUtils:()=>sc,ShortType:()=>xe,Skeleton:()=>$a,SkeletonHelper:()=>SkeletonHelper,SkinnedMesh:()=>Za,SmoothShading:()=>y,Sphere:()=>Sphere,SphereBufferGeometry:()=>SphereBufferGeometry,SphereGeometry:()=>SphereGeometry,Spherical:()=>Spherical,SphericalHarmonics3:()=>SphericalHarmonics3,Spline:()=>qu,SplineCurve:()=>ph,SplineCurve3:()=>Zu,SpotLight:()=>Eh,SpotLightHelper:()=>SpotLightHelper,Sprite:()=>ka,SpriteMaterial:()=>Ea,SrcAlphaFactor:()=>L,SrcAlphaSaturateFactor:()=>V,SrcColorFactor:()=>I,StaticCopyUsage:()=>Ci,StaticDrawUsage:()=>Mi,StaticReadUsage:()=>Ai,StereoCamera:()=>Xh,StreamCopyUsage:()=>Ii,StreamDrawUsage:()=>xi,StreamReadUsage:()=>Pi,StringKeyframeTrack:()=>Rc,SubtractEquation:()=>x,SubtractiveBlending:()=>E,TOUCH:()=>o,TangentSpaceNormalMap:()=>ri,TetrahedronBufferGeometry:()=>TetrahedronBufferGeometry,TetrahedronGeometry:()=>TetrahedronGeometry,TextBufferGeometry:()=>TextBufferGeometry,TextGeometry:()=>TextGeometry,Texture:()=>Gi,TextureLoader:()=>Kc,TorusBufferGeometry:()=>TorusBufferGeometry,TorusGeometry:()=>TorusGeometry,TorusKnotBufferGeometry:()=>TorusKnotBufferGeometry,TorusKnotGeometry:()=>TorusKnotGeometry,Triangle:()=>Triangle,TriangleFanDrawMode:()=>Yt,TriangleStripDrawMode:()=>Kt,TrianglesDrawMode:()=>qt,TubeBufferGeometry:()=>TubeBufferGeometry,TubeGeometry:()=>TubeGeometry,UVMapping:()=>se,Uint16Attribute:()=>Vu,Uint16BufferAttribute:()=>gs,Uint32Attribute:()=>Gu,Uint32BufferAttribute:()=>vs,Uint8Attribute:()=>Bu,Uint8BufferAttribute:()=>us,Uint8ClampedAttribute:()=>Fu,Uint8ClampedBufferAttribute:()=>ps,Uniform:()=>Uniform,UniformsLib:()=>go,UniformsUtils:()=>eo,UnsignedByteType:()=>Me,UnsignedInt248Type:()=>Ne,UnsignedIntType:()=>Pe,UnsignedShort4444Type:()=>Ie,UnsignedShort5551Type:()=>Re,UnsignedShort565Type:()=>Le,UnsignedShortType:()=>Ae,VSMShadowMap:()=>p,Vector2:()=>Vector2,Vector3:()=>Vector3,Vector4:()=>Vector4,VectorKeyframeTrack:()=>Lc,Vertex:()=>Lu,VertexColors:()=>_u,VideoTexture:()=>wl,WebGL1Renderer:()=>ya,WebGLCubeRenderTarget:()=>ao,WebGLMultisampleRenderTarget:()=>Wi,WebGLRenderTarget:()=>ji,WebGLRenderTargetCube:()=>ep,WebGLRenderer:()=>va,WebGLUtils:()=>da,WireframeGeometry:()=>WireframeGeometry,WireframeHelper:()=>Xu,WrapAroundEnding:()=>jt,XHRLoader:()=>Qu,ZeroCurvatureEnding:()=>Gt,ZeroFactor:()=>C,ZeroSlopeEnding:()=>zt,ZeroStencilOp:()=>li,sRGBEncoding:()=>Xt});const n="124",s={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},o={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},r=0,a=1,l=2,c=3,h=0,d=1,u=2,p=3,m=0,g=1,f=2,v=1,y=2,b=0,w=1,S=2,E=3,T=4,M=5,_=100,x=101,A=102,O=103,P=104,C=200,D=201,I=202,R=203,L=204,N=205,k=206,B=207,F=208,U=209,V=210,H=0,G=1,z=2,j=3,W=4,Z=5,q=6,K=7,Y=0,$=1,X=2,Q=0,J=1,ee=2,te=3,ie=4,ne=5,se=300,oe=301,re=302,ae=303,le=304,ce=306,he=307,de=1e3,ue=1001,pe=1002,me=1003,ge=1004,fe=1004,ve=1005,ye=1005,be=1006,we=1007,Se=1007,Ee=1008,Te=1008,Me=1009,_e=1010,xe=1011,Ae=1012,Oe=1013,Pe=1014,Ce=1015,De=1016,Ie=1017,Re=1018,Le=1019,Ne=1020,ke=1021,Be=1022,Fe=1023,Ue=1024,Ve=1025,He=Fe,Ge=1026,ze=1027,je=1028,We=1029,Ze=1030,qe=1031,Ke=1032,Ye=1033,$e=33776,Xe=33777,Qe=33778,Je=33779,et=35840,tt=35841,it=35842,nt=35843,st=36196,ot=37492,rt=37496,at=37808,lt=37809,ct=37810,ht=37811,dt=37812,ut=37813,pt=37814,mt=37815,gt=37816,ft=37817,vt=37818,yt=37819,bt=37820,wt=37821,St=36492,Et=37840,Tt=37841,Mt=37842,_t=37843,xt=37844,At=37845,Ot=37846,Pt=37847,Ct=37848,Dt=37849,It=37850,Rt=37851,Lt=37852,Nt=37853,kt=2200,Bt=2201,Ft=2202,Ut=2300,Vt=2301,Ht=2302,Gt=2400,zt=2401,jt=2402,Wt=2500,Zt=2501,qt=0,Kt=1,Yt=2,$t=3e3,Xt=3001,Qt=3007,Jt=3002,ei=3003,ti=3004,ii=3005,ni=3006,si=3200,oi=3201,ri=0,ai=1,li=0,ci=7680,hi=7681,di=7682,ui=7683,pi=34055,mi=34056,gi=5386,fi=512,vi=513,yi=514,bi=515,wi=516,Si=517,Ei=518,Ti=519,Mi=35044,_i=35048,xi=35040,Ai=35045,Oi=35049,Pi=35041,Ci=35046,Di=35050,Ii=35042,Ri="100",Li="300 es";function Ni(){}Object.assign(Ni.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)},removeEventListener:function(e,t){if(void 0===this._listeners)return;const i=this._listeners[e];if(void 0!==i){const e=i.indexOf(t);-1!==e&&i.splice(e,1)}},dispatchEvent:function(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const i=t.slice(0);for(let t=0,n=i.length;t<n;t++)i[t].call(this,e)}}});const ki=[];for(let e=0;e<256;e++)ki[e]=(e<16?"0":"")+e.toString(16);let Bi=1234567;const Fi={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(ki[255&e]+ki[e>>8&255]+ki[e>>16&255]+ki[e>>24&255]+"-"+ki[255&t]+ki[t>>8&255]+"-"+ki[t>>16&15|64]+ki[t>>24&255]+"-"+ki[63&i|128]+ki[i>>8&255]+"-"+ki[i>>16&255]+ki[i>>24&255]+ki[255&n]+ki[n>>8&255]+ki[n>>16&255]+ki[n>>24&255]).toUpperCase()},clamp:function(e,t,i){return Math.max(t,Math.min(i,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,i,n,s){return n+(e-t)*(s-n)/(i-t)},lerp:function(e,t,i){return(1-i)*e+i*t},smoothstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)},smootherstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){return void 0!==e&&(Bi=e%2147483647),Bi=16807*Bi%2147483647,(Bi-1)/2147483646},degToRad:function(e){return e*Fi.DEG2RAD},radToDeg:function(e){return e*Fi.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,i,n,s){const o=Math.cos,r=Math.sin,a=o(i/2),l=r(i/2),c=o((t+n)/2),h=r((t+n)/2),d=o((t-n)/2),u=r((t-n)/2),p=o((n-t)/2),m=r((n-t)/2);switch(s){case"XYX":e.set(a*h,l*d,l*u,a*c);break;case"YZY":e.set(l*u,a*h,l*d,a*c);break;case"ZXZ":e.set(l*d,l*u,a*h,a*c);break;case"XZX":e.set(a*h,l*m,l*p,a*c);break;case"YXY":e.set(l*p,a*h,l*m,a*c);break;case"ZYZ":e.set(l*m,l*p,a*h,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}};class Vector2{constructor(e=0,t=0){Object.defineProperty(this,"isVector2",{value:!0}),this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6],this.y=n[1]*t+n[4]*i+n[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),n=Math.sin(t),s=this.x-e.x,o=this.y-e.y;return this.x=s*i-o*n+e.x,this.y=s*n+o*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}class Matrix3{constructor(){Object.defineProperty(this,"isMatrix3",{value:!0}),this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,i,n,s,o,r,a,l){const c=this.elements;return c[0]=e,c[1]=n,c[2]=r,c[3]=t,c[4]=s,c[5]=a,c[6]=i,c[7]=o,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}clone(){return(new this.constructor).fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,n=t.elements,s=this.elements,o=i[0],r=i[3],a=i[6],l=i[1],c=i[4],h=i[7],d=i[2],u=i[5],p=i[8],m=n[0],g=n[3],f=n[6],v=n[1],y=n[4],b=n[7],w=n[2],S=n[5],E=n[8];return s[0]=o*m+r*v+a*w,s[3]=o*g+r*y+a*S,s[6]=o*f+r*b+a*E,s[1]=l*m+c*v+h*w,s[4]=l*g+c*y+h*S,s[7]=l*f+c*b+h*E,s[2]=d*m+u*v+p*w,s[5]=d*g+u*y+p*S,s[8]=d*f+u*b+p*E,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],n=e[2],s=e[3],o=e[4],r=e[5],a=e[6],l=e[7],c=e[8];return t*o*c-t*r*l-i*s*c+i*r*a+n*s*l-n*o*a}invert(){const e=this.elements,t=e[0],i=e[1],n=e[2],s=e[3],o=e[4],r=e[5],a=e[6],l=e[7],c=e[8],h=c*o-r*l,d=r*a-c*s,u=l*s-o*a,p=t*h+i*d+n*u;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return e[0]=h*m,e[1]=(n*l-c*i)*m,e[2]=(r*i-n*o)*m,e[3]=d*m,e[4]=(c*t-n*a)*m,e[5]=(n*s-r*t)*m,e[6]=u*m,e[7]=(i*a-l*t)*m,e[8]=(o*t-i*s)*m,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).copy(this).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,n,s,o,r){const a=Math.cos(s),l=Math.sin(s);return this.set(i*a,i*l,-i*(a*o+l*r)+o+e,-n*l,n*a,-n*(-l*o+a*r)+r+t,0,0,1),this}scale(e,t){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=t,i[4]*=t,i[7]*=t,this}rotate(e){const t=Math.cos(e),i=Math.sin(e),n=this.elements,s=n[0],o=n[3],r=n[6],a=n[1],l=n[4],c=n[7];return n[0]=t*s+i*a,n[3]=t*o+i*l,n[6]=t*r+i*c,n[1]=-i*s+t*a,n[4]=-i*o+t*l,n[7]=-i*r+t*c,this}translate(e,t){const i=this.elements;return i[0]+=e*i[2],i[3]+=e*i[5],i[6]+=e*i[8],i[1]+=t*i[2],i[4]+=t*i[5],i[7]+=t*i[8],this}equals(e){const t=this.elements,i=e.elements;for(let e=0;e<9;e++)if(t[e]!==i[e])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}}let Ui;const Vi={getDataURL:function(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Ui&&(Ui=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Ui.width=e.width,Ui.height=e.height;const i=Ui.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=Ui}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}};let Hi=0;function Gi(e=Gi.DEFAULT_IMAGE,t=Gi.DEFAULT_MAPPING,i=ue,n=ue,s=be,o=Ee,r=Fe,a=Me,l=1,c=$t){Object.defineProperty(this,"id",{value:Hi++}),this.uuid=Fi.generateUUID(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=i,this.wrapT=n,this.magFilter=s,this.minFilter=o,this.anisotropy=l,this.format=r,this.internalFormat=null,this.type=a,this.offset=new Vector2(0,0),this.repeat=new Vector2(1,1),this.center=new Vector2(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Matrix3,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.version=0,this.onUpdate=null}function zi(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?Vi.getDataURL(e):e.data?{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}Gi.DEFAULT_IMAGE=void 0,Gi.DEFAULT_MAPPING=se,Gi.prototype=Object.assign(Object.create(Ni.prototype),{constructor:Gi,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const n=this.image;if(void 0===n.uuid&&(n.uuid=Fi.generateUUID()),!t&&void 0===e.images[n.uuid]){let t;if(Array.isArray(n)){t=[];for(let e=0,i=n.length;e<i;e++)n[e].isDataTexture?t.push(zi(n[e].image)):t.push(zi(n[e]))}else t=zi(n);e.images[n.uuid]={uuid:n.uuid,url:t}}i.image=n.uuid}return t||(e.textures[this.uuid]=i),i},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(this.mapping!==se)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case de:e.x=e.x-Math.floor(e.x);break;case ue:e.x=e.x<0?0:1;break;case pe:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case de:e.y=e.y-Math.floor(e.y);break;case ue:e.y=e.y<0?0:1;break;case pe:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(Gi.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}});class Vector4{constructor(e=0,t=0,i=0,n=1){Object.defineProperty(this,"isVector4",{value:!0}),this.x=e,this.y=t,this.z=i,this.w=n}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,n=this.z,s=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*n+o[12]*s,this.y=o[1]*t+o[5]*i+o[9]*n+o[13]*s,this.z=o[2]*t+o[6]*i+o[10]*n+o[14]*s,this.w=o[3]*t+o[7]*i+o[11]*n+o[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,n,s;const o=.01,r=.1,a=e.elements,l=a[0],c=a[4],h=a[8],d=a[1],u=a[5],p=a[9],m=a[2],g=a[6],f=a[10];if(Math.abs(c-d)<o&&Math.abs(h-m)<o&&Math.abs(p-g)<o){if(Math.abs(c+d)<r&&Math.abs(h+m)<r&&Math.abs(p+g)<r&&Math.abs(l+u+f-3)<r)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,a=(u+1)/2,v=(f+1)/2,y=(c+d)/4,b=(h+m)/4,w=(p+g)/4;return e>a&&e>v?e<o?(i=0,n=.707106781,s=.707106781):(i=Math.sqrt(e),n=y/i,s=b/i):a>v?a<o?(i=.707106781,n=0,s=.707106781):(n=Math.sqrt(a),i=y/n,s=w/n):v<o?(i=.707106781,n=.707106781,s=0):(s=Math.sqrt(v),i=b/s,n=w/s),this.set(i,n,s,t),this}let v=Math.sqrt((g-p)*(g-p)+(h-m)*(h-m)+(d-c)*(d-c));return Math.abs(v)<.001&&(v=1),this.x=(g-p)/v,this.y=(h-m)/v,this.z=(d-c)/v,this.w=Math.acos((l+u+f-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,i){return void 0!==i&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}function ji(e,t,i){this.width=e,this.height=t,this.scissor=new Vector4(0,0,e,t),this.scissorTest=!1,this.viewport=new Vector4(0,0,e,t),i=i||{},this.texture=new Gi(void 0,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:be,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null}function Wi(e,t,i){ji.call(this,e,t,i),this.samples=4}ji.prototype=Object.assign(Object.create(Ni.prototype),{constructor:ji,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.texture.image.width=e,this.texture.image.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Wi.prototype=Object.assign(Object.create(ji.prototype),{constructor:Wi,isWebGLMultisampleRenderTarget:!0,copy:function(e){return ji.prototype.copy.call(this,e),this.samples=e.samples,this}});class Quaternion{constructor(e=0,t=0,i=0,n=1){Object.defineProperty(this,"isQuaternion",{value:!0}),this._x=e,this._y=t,this._z=i,this._w=n}static slerp(e,t,i,n){return i.copy(e).slerp(t,n)}static slerpFlat(e,t,i,n,s,o,r){let a=i[n+0],l=i[n+1],c=i[n+2],h=i[n+3];const d=s[o+0],u=s[o+1],p=s[o+2],m=s[o+3];if(h!==m||a!==d||l!==u||c!==p){let e=1-r;const t=a*d+l*u+c*p+h*m,i=t>=0?1:-1,n=1-t*t;if(n>Number.EPSILON){const s=Math.sqrt(n),o=Math.atan2(s,t*i);e=Math.sin(e*o)/s,r=Math.sin(r*o)/s}const s=r*i;if(a=a*e+d*s,l=l*e+u*s,c=c*e+p*s,h=h*e+m*s,e===1-r){const e=1/Math.sqrt(a*a+l*l+c*c+h*h);a*=e,l*=e,c*=e,h*=e}}e[t]=a,e[t+1]=l,e[t+2]=c,e[t+3]=h}static multiplyQuaternionsFlat(e,t,i,n,s,o){const r=i[n],a=i[n+1],l=i[n+2],c=i[n+3],h=s[o],d=s[o+1],u=s[o+2],p=s[o+3];return e[t]=r*p+c*h+a*u-l*d,e[t+1]=a*p+c*d+l*h-r*u,e[t+2]=l*p+c*u+r*d-a*h,e[t+3]=c*p-r*h-a*d-l*u,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=e._x,n=e._y,s=e._z,o=e._order,r=Math.cos,a=Math.sin,l=r(i/2),c=r(n/2),h=r(s/2),d=a(i/2),u=a(n/2),p=a(s/2);switch(o){case"XYZ":this._x=d*c*h+l*u*p,this._y=l*u*h-d*c*p,this._z=l*c*p+d*u*h,this._w=l*c*h-d*u*p;break;case"YXZ":this._x=d*c*h+l*u*p,this._y=l*u*h-d*c*p,this._z=l*c*p-d*u*h,this._w=l*c*h+d*u*p;break;case"ZXY":this._x=d*c*h-l*u*p,this._y=l*u*h+d*c*p,this._z=l*c*p+d*u*h,this._w=l*c*h-d*u*p;break;case"ZYX":this._x=d*c*h-l*u*p,this._y=l*u*h+d*c*p,this._z=l*c*p-d*u*h,this._w=l*c*h+d*u*p;break;case"YZX":this._x=d*c*h+l*u*p,this._y=l*u*h+d*c*p,this._z=l*c*p-d*u*h,this._w=l*c*h-d*u*p;break;case"XZY":this._x=d*c*h-l*u*p,this._y=l*u*h-d*c*p,this._z=l*c*p+d*u*h,this._w=l*c*h+d*u*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,n=Math.sin(i);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],n=t[4],s=t[8],o=t[1],r=t[5],a=t[9],l=t[2],c=t[6],h=t[10],d=i+r+h;if(d>0){const e=.5/Math.sqrt(d+1);this._w=.25/e,this._x=(c-a)*e,this._y=(s-l)*e,this._z=(o-n)*e}else if(i>r&&i>h){const e=2*Math.sqrt(1+i-r-h);this._w=(c-a)/e,this._x=.25*e,this._y=(n+o)/e,this._z=(s+l)/e}else if(r>h){const e=2*Math.sqrt(1+r-i-h);this._w=(s-l)/e,this._x=(n+o)/e,this._y=.25*e,this._z=(a+c)/e}else{const e=2*Math.sqrt(1+h-i-r);this._w=(o-n)/e,this._x=(s+l)/e,this._y=(a+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<1e-6?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Fi.clamp(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(0===i)return this;const n=Math.min(1,t/i);return this.slerp(e,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,n=e._y,s=e._z,o=e._w,r=t._x,a=t._y,l=t._z,c=t._w;return this._x=i*c+o*r+n*l-s*a,this._y=n*c+o*a+s*r-i*l,this._z=s*c+o*l+i*a-n*r,this._w=o*c-i*r-n*a-s*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const i=this._x,n=this._y,s=this._z,o=this._w;let r=o*e._w+i*e._x+n*e._y+s*e._z;if(r<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,r=-r):this.copy(e),r>=1)return this._w=o,this._x=i,this._y=n,this._z=s,this;const a=1-r*r;if(a<=Number.EPSILON){const e=1-t;return this._w=e*o+t*this._w,this._x=e*i+t*this._x,this._y=e*n+t*this._y,this._z=e*s+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(a),c=Math.atan2(l,r),h=Math.sin((1-t)*c)/l,d=Math.sin(t*c)/l;return this._w=o*h+this._w*d,this._x=i*h+this._x*d,this._y=n*h+this._y*d,this._z=s*h+this._z*d,this._onChangeCallback(),this}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}class Vector3{constructor(e=0,t=0,i=0){Object.defineProperty(this,"isVector3",{value:!0}),this.x=e,this.y=t,this.z=i}set(e,t,i){return void 0===i&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(qi.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(qi.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,n=this.z,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6]*n,this.y=s[1]*t+s[4]*i+s[7]*n,this.z=s[2]*t+s[5]*i+s[8]*n,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,n=this.z,s=e.elements,o=1/(s[3]*t+s[7]*i+s[11]*n+s[15]);return this.x=(s[0]*t+s[4]*i+s[8]*n+s[12])*o,this.y=(s[1]*t+s[5]*i+s[9]*n+s[13])*o,this.z=(s[2]*t+s[6]*i+s[10]*n+s[14])*o,this}applyQuaternion(e){const t=this.x,i=this.y,n=this.z,s=e.x,o=e.y,r=e.z,a=e.w,l=a*t+o*n-r*i,c=a*i+r*t-s*n,h=a*n+s*i-o*t,d=-s*t-o*i-r*n;return this.x=l*a+d*-s+c*-r-h*-o,this.y=c*a+d*-o+h*-s-l*-r,this.z=h*a+d*-r+l*-o-c*-s,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,n=this.z,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*n,this.y=s[1]*t+s[5]*i+s[9]*n,this.z=s[2]*t+s[6]*i+s[10]*n,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,n=e.y,s=e.z,o=t.x,r=t.y,a=t.z;return this.x=n*a-s*r,this.y=s*o-i*a,this.z=i*r-n*o,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return Zi.copy(this).projectOnVector(e),this.sub(Zi)}reflect(e){return this.sub(Zi.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(Fi.clamp(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,n=this.z-e.z;return t*t+i*i+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const n=Math.sin(t)*e;return this.x=n*Math.sin(i),this.y=Math.cos(t)*e,this.z=n*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=n,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}const Zi=new Vector3,qi=new Quaternion;class Box3{constructor(e,t){Object.defineProperty(this,"isBox3",{value:!0}),this.min=void 0!==e?e:new Vector3(1/0,1/0,1/0),this.max=void 0!==t?t:new Vector3(-1/0,-1/0,-1/0)}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,i=1/0,n=1/0,s=-1/0,o=-1/0,r=-1/0;for(let a=0,l=e.length;a<l;a+=3){const l=e[a],c=e[a+1],h=e[a+2];l<t&&(t=l),c<i&&(i=c),h<n&&(n=h),l>s&&(s=l),c>o&&(o=c),h>r&&(r=h)}return this.min.set(t,i,n),this.max.set(s,o,r),this}setFromBufferAttribute(e){let t=1/0,i=1/0,n=1/0,s=-1/0,o=-1/0,r=-1/0;for(let a=0,l=e.count;a<l;a++){const l=e.getX(a),c=e.getY(a),h=e.getZ(a);l<t&&(t=l),c<i&&(i=c),h<n&&(n=h),l>s&&(s=l),c>o&&(o=c),h>r&&(r=h)}return this.min.set(t,i,n),this.max.set(s,o,r),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=$i.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new Vector3),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new Vector3),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);const t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),Xi.copy(t.boundingBox),Xi.applyMatrix4(e.matrixWorld),this.union(Xi));const i=e.children;for(let e=0,t=i.length;e<t;e++)this.expandByObject(i[e]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new Vector3),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,$i),$i.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(on),rn.subVectors(this.max,on),Qi.subVectors(e.a,on),Ji.subVectors(e.b,on),en.subVectors(e.c,on),tn.subVectors(Ji,Qi),nn.subVectors(en,Ji),sn.subVectors(Qi,en);let t=[0,-tn.z,tn.y,0,-nn.z,nn.y,0,-sn.z,sn.y,tn.z,0,-tn.x,nn.z,0,-nn.x,sn.z,0,-sn.x,-tn.y,tn.x,0,-nn.y,nn.x,0,-sn.y,sn.x,0];return!!Ki(t,Qi,Ji,en,rn)&&(t=[1,0,0,0,1,0,0,0,1],!!Ki(t,Qi,Ji,en,rn)&&(an.crossVectors(tn,nn),t=[an.x,an.y,an.z],Ki(t,Qi,Ji,en,rn)))}clampPoint(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new Vector3),t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return $i.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return void 0===e&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=.5*this.getSize($i).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Yi[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Yi[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Yi[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Yi[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Yi[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Yi[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Yi[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Yi[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Yi)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}function Ki(e,t,i,n,s){for(let o=0,r=e.length-3;o<=r;o+=3){ln.fromArray(e,o);const r=s.x*Math.abs(ln.x)+s.y*Math.abs(ln.y)+s.z*Math.abs(ln.z),a=t.dot(ln),l=i.dot(ln),c=n.dot(ln);if(Math.max(-Math.max(a,l,c),Math.min(a,l,c))>r)return!1}return!0}const Yi=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3],$i=new Vector3,Xi=new Box3,Qi=new Vector3,Ji=new Vector3,en=new Vector3,tn=new Vector3,nn=new Vector3,sn=new Vector3,on=new Vector3,rn=new Vector3,an=new Vector3,ln=new Vector3,cn=new Box3;class Sphere{constructor(e,t){this.center=void 0!==e?e:new Vector3,this.radius=void 0!==t?t:-1}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;void 0!==t?i.copy(t):cn.setFromPoints(e).getCenter(i);let n=0;for(let t=0,s=e.length;t<s;t++)n=Math.max(n,i.distanceToSquared(e[t]));return this.radius=Math.sqrt(n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new Vector3),t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new Box3),this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}}const hn=new Vector3,dn=new Vector3,un=new Vector3,pn=new Vector3,mn=new Vector3,gn=new Vector3,fn=new Vector3;class Ray{constructor(e,t){this.origin=void 0!==e?e:new Vector3,this.direction=void 0!==t?t:new Vector3(0,0,-1)}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new Vector3),t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,hn)),this}closestPointToPoint(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new Vector3),t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=hn.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(hn.copy(this.direction).multiplyScalar(t).add(this.origin),hn.distanceToSquared(e))}distanceSqToSegment(e,t,i,n){dn.copy(e).add(t).multiplyScalar(.5),un.copy(t).sub(e).normalize(),pn.copy(this.origin).sub(dn);const s=.5*e.distanceTo(t),o=-this.direction.dot(un),r=pn.dot(this.direction),a=-pn.dot(un),l=pn.lengthSq(),c=Math.abs(1-o*o);let h,d,u,p;if(c>0)if(h=o*a-r,d=o*r-a,p=s*c,h>=0)if(d>=-p)if(d<=p){const e=1/c;h*=e,d*=e,u=h*(h+o*d+2*r)+d*(o*h+d+2*a)+l}else d=s,h=Math.max(0,-(o*d+r)),u=-h*h+d*(d+2*a)+l;else d=-s,h=Math.max(0,-(o*d+r)),u=-h*h+d*(d+2*a)+l;else d<=-p?(h=Math.max(0,-(-o*s+r)),d=h>0?-s:Math.min(Math.max(-s,-a),s),u=-h*h+d*(d+2*a)+l):d<=p?(h=0,d=Math.min(Math.max(-s,-a),s),u=d*(d+2*a)+l):(h=Math.max(0,-(o*s+r)),d=h>0?s:Math.min(Math.max(-s,-a),s),u=-h*h+d*(d+2*a)+l);else d=o>0?-s:s,h=Math.max(0,-(o*d+r)),u=-h*h+d*(d+2*a)+l;return i&&i.copy(this.direction).multiplyScalar(h).add(this.origin),n&&n.copy(un).multiplyScalar(d).add(dn),u}intersectSphere(e,t){hn.subVectors(e.center,this.origin);const i=hn.dot(this.direction),n=hn.dot(hn)-i*i,s=e.radius*e.radius;if(n>s)return null;const o=Math.sqrt(s-n),r=i-o,a=i+o;return r<0&&a<0?null:r<0?this.at(a,t):this.at(r,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return null===i?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);if(0===t)return!0;return e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,n,s,o,r,a;const l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,d=this.origin;return l>=0?(i=(e.min.x-d.x)*l,n=(e.max.x-d.x)*l):(i=(e.max.x-d.x)*l,n=(e.min.x-d.x)*l),c>=0?(s=(e.min.y-d.y)*c,o=(e.max.y-d.y)*c):(s=(e.max.y-d.y)*c,o=(e.min.y-d.y)*c),i>o||s>n?null:((s>i||i!=i)&&(i=s),(o<n||n!=n)&&(n=o),h>=0?(r=(e.min.z-d.z)*h,a=(e.max.z-d.z)*h):(r=(e.max.z-d.z)*h,a=(e.min.z-d.z)*h),i>a||r>n?null:((r>i||i!=i)&&(i=r),(a<n||n!=n)&&(n=a),n<0?null:this.at(i>=0?i:n,t)))}intersectsBox(e){return null!==this.intersectBox(e,hn)}intersectTriangle(e,t,i,n,s){mn.subVectors(t,e),gn.subVectors(i,e),fn.crossVectors(mn,gn);let o,r=this.direction.dot(fn);if(r>0){if(n)return null;o=1}else{if(!(r<0))return null;o=-1,r=-r}pn.subVectors(this.origin,e);const a=o*this.direction.dot(gn.crossVectors(pn,gn));if(a<0)return null;const l=o*this.direction.dot(mn.cross(pn));if(l<0)return null;if(a+l>r)return null;const c=-o*pn.dot(fn);return c<0?null:this.at(c/r,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}class Matrix4{constructor(){Object.defineProperty(this,"isMatrix4",{value:!0}),this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,i,n,s,o,r,a,l,c,h,d,u,p,m,g){const f=this.elements;return f[0]=e,f[4]=t,f[8]=i,f[12]=n,f[1]=s,f[5]=o,f[9]=r,f[13]=a,f[2]=l,f[6]=c,f[10]=h,f[14]=d,f[3]=u,f[7]=p,f[11]=m,f[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Matrix4).fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,n=1/vn.setFromMatrixColumn(e,0).length(),s=1/vn.setFromMatrixColumn(e,1).length(),o=1/vn.setFromMatrixColumn(e,2).length();return t[0]=i[0]*n,t[1]=i[1]*n,t[2]=i[2]*n,t[3]=0,t[4]=i[4]*s,t[5]=i[5]*s,t[6]=i[6]*s,t[7]=0,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,i=e.x,n=e.y,s=e.z,o=Math.cos(i),r=Math.sin(i),a=Math.cos(n),l=Math.sin(n),c=Math.cos(s),h=Math.sin(s);if("XYZ"===e.order){const e=o*c,i=o*h,n=r*c,s=r*h;t[0]=a*c,t[4]=-a*h,t[8]=l,t[1]=i+n*l,t[5]=e-s*l,t[9]=-r*a,t[2]=s-e*l,t[6]=n+i*l,t[10]=o*a}else if("YXZ"===e.order){const e=a*c,i=a*h,n=l*c,s=l*h;t[0]=e+s*r,t[4]=n*r-i,t[8]=o*l,t[1]=o*h,t[5]=o*c,t[9]=-r,t[2]=i*r-n,t[6]=s+e*r,t[10]=o*a}else if("ZXY"===e.order){const e=a*c,i=a*h,n=l*c,s=l*h;t[0]=e-s*r,t[4]=-o*h,t[8]=n+i*r,t[1]=i+n*r,t[5]=o*c,t[9]=s-e*r,t[2]=-o*l,t[6]=r,t[10]=o*a}else if("ZYX"===e.order){const e=o*c,i=o*h,n=r*c,s=r*h;t[0]=a*c,t[4]=n*l-i,t[8]=e*l+s,t[1]=a*h,t[5]=s*l+e,t[9]=i*l-n,t[2]=-l,t[6]=r*a,t[10]=o*a}else if("YZX"===e.order){const e=o*a,i=o*l,n=r*a,s=r*l;t[0]=a*c,t[4]=s-e*h,t[8]=n*h+i,t[1]=h,t[5]=o*c,t[9]=-r*c,t[2]=-l*c,t[6]=i*h+n,t[10]=e-s*h}else if("XZY"===e.order){const e=o*a,i=o*l,n=r*a,s=r*l;t[0]=a*c,t[4]=-h,t[8]=l*c,t[1]=e*h+s,t[5]=o*c,t[9]=i*h-n,t[2]=n*h-i,t[6]=r*c,t[10]=s*h+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(bn,e,wn)}lookAt(e,t,i){const n=this.elements;return Tn.subVectors(e,t),0===Tn.lengthSq()&&(Tn.z=1),Tn.normalize(),Sn.crossVectors(i,Tn),0===Sn.lengthSq()&&(1===Math.abs(i.z)?Tn.x+=1e-4:Tn.z+=1e-4,Tn.normalize(),Sn.crossVectors(i,Tn)),Sn.normalize(),En.crossVectors(Tn,Sn),n[0]=Sn.x,n[4]=En.x,n[8]=Tn.x,n[1]=Sn.y,n[5]=En.y,n[9]=Tn.y,n[2]=Sn.z,n[6]=En.z,n[10]=Tn.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,n=t.elements,s=this.elements,o=i[0],r=i[4],a=i[8],l=i[12],c=i[1],h=i[5],d=i[9],u=i[13],p=i[2],m=i[6],g=i[10],f=i[14],v=i[3],y=i[7],b=i[11],w=i[15],S=n[0],E=n[4],T=n[8],M=n[12],_=n[1],x=n[5],A=n[9],O=n[13],P=n[2],C=n[6],D=n[10],I=n[14],R=n[3],L=n[7],N=n[11],k=n[15];return s[0]=o*S+r*_+a*P+l*R,s[4]=o*E+r*x+a*C+l*L,s[8]=o*T+r*A+a*D+l*N,s[12]=o*M+r*O+a*I+l*k,s[1]=c*S+h*_+d*P+u*R,s[5]=c*E+h*x+d*C+u*L,s[9]=c*T+h*A+d*D+u*N,s[13]=c*M+h*O+d*I+u*k,s[2]=p*S+m*_+g*P+f*R,s[6]=p*E+m*x+g*C+f*L,s[10]=p*T+m*A+g*D+f*N,s[14]=p*M+m*O+g*I+f*k,s[3]=v*S+y*_+b*P+w*R,s[7]=v*E+y*x+b*C+w*L,s[11]=v*T+y*A+b*D+w*N,s[15]=v*M+y*O+b*I+w*k,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],n=e[8],s=e[12],o=e[1],r=e[5],a=e[9],l=e[13],c=e[2],h=e[6],d=e[10],u=e[14];return e[3]*(+s*a*h-n*l*h-s*r*d+i*l*d+n*r*u-i*a*u)+e[7]*(+t*a*u-t*l*d+s*o*d-n*o*u+n*l*c-s*a*c)+e[11]*(+t*l*h-t*r*u-s*o*h+i*o*u+s*r*c-i*l*c)+e[15]*(-n*r*c-t*a*h+t*r*d+n*o*h-i*o*d+i*a*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=t,n[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],n=e[2],s=e[3],o=e[4],r=e[5],a=e[6],l=e[7],c=e[8],h=e[9],d=e[10],u=e[11],p=e[12],m=e[13],g=e[14],f=e[15],v=h*g*l-m*d*l+m*a*u-r*g*u-h*a*f+r*d*f,y=p*d*l-c*g*l-p*a*u+o*g*u+c*a*f-o*d*f,b=c*m*l-p*h*l+p*r*u-o*m*u-c*r*f+o*h*f,w=p*h*a-c*m*a-p*r*d+o*m*d+c*r*g-o*h*g,S=t*v+i*y+n*b+s*w;if(0===S)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const E=1/S;return e[0]=v*E,e[1]=(m*d*s-h*g*s-m*n*u+i*g*u+h*n*f-i*d*f)*E,e[2]=(r*g*s-m*a*s+m*n*l-i*g*l-r*n*f+i*a*f)*E,e[3]=(h*a*s-r*d*s-h*n*l+i*d*l+r*n*u-i*a*u)*E,e[4]=y*E,e[5]=(c*g*s-p*d*s+p*n*u-t*g*u-c*n*f+t*d*f)*E,e[6]=(p*a*s-o*g*s-p*n*l+t*g*l+o*n*f-t*a*f)*E,e[7]=(o*d*s-c*a*s+c*n*l-t*d*l-o*n*u+t*a*u)*E,e[8]=b*E,e[9]=(p*h*s-c*m*s-p*i*u+t*m*u+c*i*f-t*h*f)*E,e[10]=(o*m*s-p*r*s+p*i*l-t*m*l-o*i*f+t*r*f)*E,e[11]=(c*r*s-o*h*s-c*i*l+t*h*l+o*i*u-t*r*u)*E,e[12]=w*E,e[13]=(c*m*n-p*h*n+p*i*d-t*m*d-c*i*g+t*h*g)*E,e[14]=(p*r*n-o*m*n-p*i*a+t*m*a+o*i*g-t*r*g)*E,e[15]=(o*h*n-c*r*n+c*i*a-t*h*a-o*i*d+t*r*d)*E,this}scale(e){const t=this.elements,i=e.x,n=e.y,s=e.z;return t[0]*=i,t[4]*=n,t[8]*=s,t[1]*=i,t[5]*=n,t[9]*=s,t[2]*=i,t[6]*=n,t[10]*=s,t[3]*=i,t[7]*=n,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,n))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),n=Math.sin(t),s=1-i,o=e.x,r=e.y,a=e.z,l=s*o,c=s*r;return this.set(l*o+i,l*r-n*a,l*a+n*r,0,l*r+n*a,c*r+i,c*a-n*o,0,l*a-n*r,c*a+n*o,s*a*a+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i){return this.set(1,t,i,0,e,1,i,0,e,t,1,0,0,0,0,1),this}compose(e,t,i){const n=this.elements,s=t._x,o=t._y,r=t._z,a=t._w,l=s+s,c=o+o,h=r+r,d=s*l,u=s*c,p=s*h,m=o*c,g=o*h,f=r*h,v=a*l,y=a*c,b=a*h,w=i.x,S=i.y,E=i.z;return n[0]=(1-(m+f))*w,n[1]=(u+b)*w,n[2]=(p-y)*w,n[3]=0,n[4]=(u-b)*S,n[5]=(1-(d+f))*S,n[6]=(g+v)*S,n[7]=0,n[8]=(p+y)*E,n[9]=(g-v)*E,n[10]=(1-(d+m))*E,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}decompose(e,t,i){const n=this.elements;let s=vn.set(n[0],n[1],n[2]).length();const o=vn.set(n[4],n[5],n[6]).length(),r=vn.set(n[8],n[9],n[10]).length();this.determinant()<0&&(s=-s),e.x=n[12],e.y=n[13],e.z=n[14],yn.copy(this);const a=1/s,l=1/o,c=1/r;return yn.elements[0]*=a,yn.elements[1]*=a,yn.elements[2]*=a,yn.elements[4]*=l,yn.elements[5]*=l,yn.elements[6]*=l,yn.elements[8]*=c,yn.elements[9]*=c,yn.elements[10]*=c,t.setFromRotationMatrix(yn),i.x=s,i.y=o,i.z=r,this}makePerspective(e,t,i,n,s,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const r=this.elements,a=2*s/(t-e),l=2*s/(i-n),c=(t+e)/(t-e),h=(i+n)/(i-n),d=-(o+s)/(o-s),u=-2*o*s/(o-s);return r[0]=a,r[4]=0,r[8]=c,r[12]=0,r[1]=0,r[5]=l,r[9]=h,r[13]=0,r[2]=0,r[6]=0,r[10]=d,r[14]=u,r[3]=0,r[7]=0,r[11]=-1,r[15]=0,this}makeOrthographic(e,t,i,n,s,o){const r=this.elements,a=1/(t-e),l=1/(i-n),c=1/(o-s),h=(t+e)*a,d=(i+n)*l,u=(o+s)*c;return r[0]=2*a,r[4]=0,r[8]=0,r[12]=-h,r[1]=0,r[5]=2*l,r[9]=0,r[13]=-d,r[2]=0,r[6]=0,r[10]=-2*c,r[14]=-u,r[3]=0,r[7]=0,r[11]=0,r[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let e=0;e<16;e++)if(t[e]!==i[e])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const vn=new Vector3,yn=new Matrix4,bn=new Vector3(0,0,0),wn=new Vector3(1,1,1),Sn=new Vector3,En=new Vector3,Tn=new Vector3;class Euler{constructor(e=0,t=0,i=0,n=Euler.DefaultOrder){Object.defineProperty(this,"isEuler",{value:!0}),this._x=e,this._y=t,this._z=i,this._order=n}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._order=n||this._order,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t,i){const n=Fi.clamp,s=e.elements,o=s[0],r=s[4],a=s[8],l=s[1],c=s[5],h=s[9],d=s[2],u=s[6],p=s[10];switch(t=t||this._order){case"XYZ":this._y=Math.asin(n(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-h,p),this._z=Math.atan2(-r,o)):(this._x=Math.atan2(u,c),this._z=0);break;case"YXZ":this._x=Math.asin(-n(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(a,p),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-d,o),this._z=0);break;case"ZXY":this._x=Math.asin(n(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-d,p),this._z=Math.atan2(-r,c)):(this._y=0,this._z=Math.atan2(l,o));break;case"ZYX":this._y=Math.asin(-n(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(u,p),this._z=Math.atan2(l,o)):(this._x=0,this._z=Math.atan2(-r,c));break;case"YZX":this._z=Math.asin(n(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-h,c),this._y=Math.atan2(-d,o)):(this._x=0,this._y=Math.atan2(a,p));break;case"XZY":this._z=Math.asin(-n(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(u,c),this._y=Math.atan2(a,o)):(this._x=Math.atan2(-h,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!1!==i&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return Mn.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Mn,t,i)}setFromVector3(e,t){return this.set(e.x,e.y,e.z,t||this._order)}reorder(e){return _n.setFromEuler(this),this.setFromQuaternion(_n,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new Vector3(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Euler.DefaultOrder="XYZ",Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];const Mn=new Matrix4,_n=new Quaternion;class Layers{constructor(){this.mask=1}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}}let xn=0;const An=new Vector3,On=new Quaternion,Pn=new Matrix4,Cn=new Vector3,Dn=new Vector3,In=new Vector3,Rn=new Quaternion,Ln=new Vector3(1,0,0),Nn=new Vector3(0,1,0),kn=new Vector3(0,0,1),Bn={type:"added"},Fn={type:"removed"};function Un(){Object.defineProperty(this,"id",{value:xn++}),this.uuid=Fi.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Un.DefaultUp.clone();const e=new Vector3,t=new Euler,i=new Quaternion,n=new Vector3(1,1,1);t._onChange((function(){i.setFromEuler(t,!1)})),i._onChange((function(){t.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}}),this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=Un.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}Un.DefaultUp=new Vector3(0,1,0),Un.DefaultMatrixAutoUpdate=!0,Un.prototype=Object.assign(Object.create(Ni.prototype),{constructor:Un,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(e,t){return On.setFromAxisAngle(e,t),this.quaternion.multiply(On),this},rotateOnWorldAxis:function(e,t){return On.setFromAxisAngle(e,t),this.quaternion.premultiply(On),this},rotateX:function(e){return this.rotateOnAxis(Ln,e)},rotateY:function(e){return this.rotateOnAxis(Nn,e)},rotateZ:function(e){return this.rotateOnAxis(kn,e)},translateOnAxis:function(e,t){return An.copy(e).applyQuaternion(this.quaternion),this.position.add(An.multiplyScalar(t)),this},translateX:function(e){return this.translateOnAxis(Ln,e)},translateY:function(e){return this.translateOnAxis(Nn,e)},translateZ:function(e){return this.translateOnAxis(kn,e)},localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(e){return e.applyMatrix4(Pn.copy(this.matrixWorld).invert())},lookAt:function(e,t,i){e.isVector3?Cn.copy(e):Cn.set(e,t,i);const n=this.parent;this.updateWorldMatrix(!0,!1),Dn.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Pn.lookAt(Dn,Cn,this.up):Pn.lookAt(Cn,Dn,this.up),this.quaternion.setFromRotationMatrix(Pn),n&&(Pn.extractRotation(n.matrixWorld),On.setFromRotationMatrix(Pn),this.quaternion.premultiply(On.invert()))},add:function(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Bn)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Fn)),this},clear:function(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(Fn)}return this.children.length=0,this},attach:function(e){return this.updateWorldMatrix(!0,!1),Pn.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Pn.multiply(e.parent.matrixWorld)),e.applyMatrix4(Pn),e.updateWorldMatrix(!1,!1),this.add(e),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(let i=0,n=this.children.length;i<n;i++){const n=this.children[i].getObjectByProperty(e,t);if(void 0!==n)return n}},getWorldPosition:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new Vector3),this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new Quaternion),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Dn,e,In),e},getWorldScale:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new Vector3),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Dn,Rn,e),e},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new Vector3),this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverse(e)},traverseVisible:function(e){if(!1===this.visible)return;e(this);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverseVisible(e)},traverseAncestors:function(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){const i=this.parent;if(!0===e&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,i=e.length;t<i;t++)e[t].updateWorldMatrix(!1,!0)}},toJSON:function(e){const t=void 0===e||"string"==typeof e,i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const n={};function s(t,i){return void 0===t[i.uuid]&&(t[i.uuid]=i.toJSON(e)),i.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){n.geometry=s(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const i=t.shapes;if(Array.isArray(i))for(let t=0,n=i.length;t<n;t++){const n=i[t];s(e.shapes,n)}else s(e.shapes,i)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(s(e.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let i=0,n=this.material.length;i<n;i++)t.push(s(e.materials,this.material[i]));n.material=t}else n.material=s(e.materials,this.material);if(this.children.length>0){n.children=[];for(let t=0;t<this.children.length;t++)n.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){n.animations=[];for(let t=0;t<this.animations.length;t++){const i=this.animations[t];n.animations.push(s(e.animations,i))}}if(t){const t=o(e.geometries),n=o(e.materials),s=o(e.textures),r=o(e.images),a=o(e.shapes),l=o(e.skeletons),c=o(e.animations);t.length>0&&(i.geometries=t),n.length>0&&(i.materials=n),s.length>0&&(i.textures=s),r.length>0&&(i.images=r),a.length>0&&(i.shapes=a),l.length>0&&(i.skeletons=l),c.length>0&&(i.animations=c)}return i.object=n,i;function o(e){const t=[];for(const i in e){const n=e[i];delete n.metadata,t.push(n)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const i=e.children[t];this.add(i.clone())}return this}});const Vn=new Vector3,Hn=new Vector3,Gn=new Matrix3;class Plane{constructor(e,t){Object.defineProperty(this,"isPlane",{value:!0}),this.normal=void 0!==e?e:new Vector3(1,0,0),this.constant=void 0!==t?t:0}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,n){return this.normal.set(e,t,i),this.constant=n,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const n=Vn.subVectors(i,t).cross(Hn.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(n,e),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new Vector3),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){void 0===t&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new Vector3);const i=e.delta(Vn),n=this.normal.dot(i);if(0===n)return 0===this.distanceToPoint(e.start)?t.copy(e.start):void 0;const s=-(e.start.dot(this.normal)+this.constant)/n;return s<0||s>1?void 0:t.copy(i).multiplyScalar(s).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new Vector3),e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||Gn.getNormalMatrix(e),n=this.coplanarPoint(Vn).applyMatrix4(e),s=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}const zn=new Vector3,jn=new Vector3,Wn=new Vector3,Zn=new Vector3,qn=new Vector3,Kn=new Vector3,Yn=new Vector3,$n=new Vector3,Xn=new Vector3,Qn=new Vector3;class Triangle{constructor(e,t,i){this.a=void 0!==e?e:new Vector3,this.b=void 0!==t?t:new Vector3,this.c=void 0!==i?i:new Vector3}static getNormal(e,t,i,n){void 0===n&&(console.warn("THREE.Triangle: .getNormal() target is now required"),n=new Vector3),n.subVectors(i,t),zn.subVectors(e,t),n.cross(zn);const s=n.lengthSq();return s>0?n.multiplyScalar(1/Math.sqrt(s)):n.set(0,0,0)}static getBarycoord(e,t,i,n,s){zn.subVectors(n,t),jn.subVectors(i,t),Wn.subVectors(e,t);const o=zn.dot(zn),r=zn.dot(jn),a=zn.dot(Wn),l=jn.dot(jn),c=jn.dot(Wn),h=o*l-r*r;if(void 0===s&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),s=new Vector3),0===h)return s.set(-2,-1,-1);const d=1/h,u=(l*a-r*c)*d,p=(o*c-r*a)*d;return s.set(1-u-p,p,u)}static containsPoint(e,t,i,n){return this.getBarycoord(e,t,i,n,Zn),Zn.x>=0&&Zn.y>=0&&Zn.x+Zn.y<=1}static getUV(e,t,i,n,s,o,r,a){return this.getBarycoord(e,t,i,n,Zn),a.set(0,0),a.addScaledVector(s,Zn.x),a.addScaledVector(o,Zn.y),a.addScaledVector(r,Zn.z),a}static isFrontFacing(e,t,i,n){return zn.subVectors(i,t),jn.subVectors(e,t),zn.cross(jn).dot(n)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,n){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[n]),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return zn.subVectors(this.c,this.b),jn.subVectors(this.a,this.b),.5*zn.cross(jn).length()}getMidpoint(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new Vector3),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Triangle.getNormal(this.a,this.b,this.c,e)}getPlane(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new Plane),e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Triangle.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,n,s){return Triangle.getUV(e,this.a,this.b,this.c,t,i,n,s)}containsPoint(e){return Triangle.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Triangle.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){void 0===t&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new Vector3);const i=this.a,n=this.b,s=this.c;let o,r;qn.subVectors(n,i),Kn.subVectors(s,i),$n.subVectors(e,i);const a=qn.dot($n),l=Kn.dot($n);if(a<=0&&l<=0)return t.copy(i);Xn.subVectors(e,n);const c=qn.dot(Xn),h=Kn.dot(Xn);if(c>=0&&h<=c)return t.copy(n);const d=a*h-c*l;if(d<=0&&a>=0&&c<=0)return o=a/(a-c),t.copy(i).addScaledVector(qn,o);Qn.subVectors(e,s);const u=qn.dot(Qn),p=Kn.dot(Qn);if(p>=0&&u<=p)return t.copy(s);const m=u*l-a*p;if(m<=0&&l>=0&&p<=0)return r=l/(l-p),t.copy(i).addScaledVector(Kn,r);const g=c*p-u*h;if(g<=0&&h-c>=0&&u-p>=0)return Yn.subVectors(s,n),r=(h-c)/(h-c+(u-p)),t.copy(n).addScaledVector(Yn,r);const f=1/(g+m+d);return o=m*f,r=d*f,t.copy(i).addScaledVector(qn,o).addScaledVector(Kn,r)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const Jn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},es={h:0,s:0,l:0},ts={h:0,s:0,l:0};function is(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+6*(t-e)*(2/3-i):e}function ns(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function ss(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}class Color{constructor(e,t,i){return Object.defineProperty(this,"isColor",{value:!0}),void 0===t&&void 0===i?this.set(e):this.setRGB(e,t,i)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}setRGB(e,t,i){return this.r=e,this.g=t,this.b=i,this}setHSL(e,t,i){if(e=Fi.euclideanModulo(e,1),t=Fi.clamp(t,0,1),i=Fi.clamp(i,0,1),0===t)this.r=this.g=this.b=i;else{const n=i<=.5?i*(1+t):i+t-i*t,s=2*i-n;this.r=is(s,n,e+1/3),this.g=is(s,n,e),this.b=is(s,n,e-1/3)}return this}setStyle(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){let e;const n=i[1],s=i[2];switch(n){case"rgb":case"rgba":if(e=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,t(e[4]),this;if(e=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,t(e[4]),this;break;case"hsl":case"hsla":if(e=/^(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s)){const i=parseFloat(e[1])/360,n=parseInt(e[2],10)/100,s=parseInt(e[3],10)/100;return t(e[4]),this.setHSL(i,n,s)}}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const e=i[1],t=e.length;if(3===t)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,this;if(6===t)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){const t=Jn[e];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinear(e,t=2){return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}copyLinearToGamma(e,t=2){const i=t>0?1/t:1;return this.r=Math.pow(e.r,i),this.g=Math.pow(e.g,i),this.b=Math.pow(e.b,i),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.r=ns(e.r),this.g=ns(e.g),this.b=ns(e.b),this}copyLinearToSRGB(e){return this.r=ss(e.r),this.g=ss(e.g),this.b=ss(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});const t=this.r,i=this.g,n=this.b,s=Math.max(t,i,n),o=Math.min(t,i,n);let r,a;const l=(o+s)/2;if(o===s)r=0,a=0;else{const e=s-o;switch(a=l<=.5?e/(s+o):e/(2-s-o),s){case t:r=(i-n)/e+(i<n?6:0);break;case i:r=(n-t)/e+2;break;case n:r=(t-i)/e+4}r/=6}return e.h=r,e.s=a,e.l=l,e}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(e,t,i){return this.getHSL(es),es.h+=e,es.s+=t,es.l+=i,this.setHSL(es.h,es.s,es.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpHSL(e,t){this.getHSL(es),e.getHSL(ts);const i=Fi.lerp(es.h,ts.h,t),n=Fi.lerp(es.s,ts.s,t),s=Fi.lerp(es.l,ts.l,t);return this.setHSL(i,n,s),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}Color.NAMES=Jn,Color.prototype.r=1,Color.prototype.g=1,Color.prototype.b=1;class Face3{constructor(e,t,i,n,s,o=0){this.a=e,this.b=t,this.c=i,this.normal=n&&n.isVector3?n:new Vector3,this.vertexNormals=Array.isArray(n)?n:[],this.color=s&&s.isColor?s:new Color,this.vertexColors=Array.isArray(s)?s:[],this.materialIndex=o}clone(){return(new this.constructor).copy(this)}copy(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(let t=0,i=e.vertexNormals.length;t<i;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(let t=0,i=e.vertexColors.length;t<i;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}}let os=0;function rs(){Object.defineProperty(this,"id",{value:os++}),this.uuid=Fi.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=w,this.side=m,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=L,this.blendDst=N,this.blendEquation=_,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=j,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Ti,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ci,this.stencilZFail=ci,this.stencilZPass=ci,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function as(e){rs.call(this),this.type="MeshBasicMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Y,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(e)}rs.prototype=Object.assign(Object.create(Ni.prototype),{constructor:rs,isMaterial:!0,onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(e){if(void 0!==e)for(const t in e){const i=e[t];if(void 0===i){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if("shading"===t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=i===v;continue}const n=this[t];void 0!==n?n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[t]=i:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}},toJSON:function(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(e){const t=[];for(const i in e){const n=e[i];delete n.metadata,t.push(n)}return t}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(i.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,i.reflectivity=this.reflectivity,i.refractionRatio=this.refractionRatio,void 0!==this.combine&&(i.combine=this.combine),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(i.size=this.size),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==w&&(i.blending=this.blending),!0===this.flatShading&&(i.flatShading=this.flatShading),this.side!==m&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(i.morphTargets=!0),!0===this.morphNormals&&(i.morphNormals=!0),!0===this.skinning&&(i.skinning=!0),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),t){const t=n(e.textures),s=n(e.images);t.length>0&&(i.textures=t),s.length>0&&(i.images=s)}return i},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(null!==t){const e=t.length;i=new Array(e);for(let n=0;n!==e;++n)i[n]=t[n].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(rs.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),as.prototype=Object.create(rs.prototype),as.prototype.constructor=as,as.prototype.isMeshBasicMaterial=!0,as.prototype.copy=function(e){return rs.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this};const ls=new Vector3,cs=new Vector2;function hs(e,t,i){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===i,this.usage=Mi,this.updateRange={offset:0,count:-1},this.version=0}function ds(e,t,i){hs.call(this,new Int8Array(e),t,i)}function us(e,t,i){hs.call(this,new Uint8Array(e),t,i)}function ps(e,t,i){hs.call(this,new Uint8ClampedArray(e),t,i)}function ms(e,t,i){hs.call(this,new Int16Array(e),t,i)}function gs(e,t,i){hs.call(this,new Uint16Array(e),t,i)}function fs(e,t,i){hs.call(this,new Int32Array(e),t,i)}function vs(e,t,i){hs.call(this,new Uint32Array(e),t,i)}function ys(e,t,i){hs.call(this,new Uint16Array(e),t,i)}function bs(e,t,i){hs.call(this,new Float32Array(e),t,i)}function ws(e,t,i){hs.call(this,new Float64Array(e),t,i)}Object.defineProperty(hs.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(hs.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this},copyAt:function(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let n=0,s=this.itemSize;n<s;n++)this.array[e+n]=t.array[i+n];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){const t=this.array;let i=0;for(let n=0,s=e.length;n<s;n++){let s=e[n];void 0===s&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),s=new Color),t[i++]=s.r,t[i++]=s.g,t[i++]=s.b}return this},copyVector2sArray:function(e){const t=this.array;let i=0;for(let n=0,s=e.length;n<s;n++){let s=e[n];void 0===s&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),s=new Vector2),t[i++]=s.x,t[i++]=s.y}return this},copyVector3sArray:function(e){const t=this.array;let i=0;for(let n=0,s=e.length;n<s;n++){let s=e[n];void 0===s&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),s=new Vector3),t[i++]=s.x,t[i++]=s.y,t[i++]=s.z}return this},copyVector4sArray:function(e){const t=this.array;let i=0;for(let n=0,s=e.length;n<s;n++){let s=e[n];void 0===s&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),s=new Vector4),t[i++]=s.x,t[i++]=s.y,t[i++]=s.z,t[i++]=s.w}return this},applyMatrix3:function(e){if(2===this.itemSize)for(let t=0,i=this.count;t<i;t++)cs.fromBufferAttribute(this,t),cs.applyMatrix3(e),this.setXY(t,cs.x,cs.y);else if(3===this.itemSize)for(let t=0,i=this.count;t<i;t++)ls.fromBufferAttribute(this,t),ls.applyMatrix3(e),this.setXYZ(t,ls.x,ls.y,ls.z);return this},applyMatrix4:function(e){for(let t=0,i=this.count;t<i;t++)ls.x=this.getX(t),ls.y=this.getY(t),ls.z=this.getZ(t),ls.applyMatrix4(e),this.setXYZ(t,ls.x,ls.y,ls.z);return this},applyNormalMatrix:function(e){for(let t=0,i=this.count;t<i;t++)ls.x=this.getX(t),ls.y=this.getY(t),ls.z=this.getZ(t),ls.applyNormalMatrix(e),this.setXYZ(t,ls.x,ls.y,ls.z);return this},transformDirection:function(e){for(let t=0,i=this.count;t<i;t++)ls.x=this.getX(t),ls.y=this.getY(t),ls.z=this.getZ(t),ls.transformDirection(e),this.setXYZ(t,ls.x,ls.y,ls.z);return this},set:function(e,t=0){return this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this},setXYZ:function(e,t,i,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this},setXYZW:function(e,t,i,n,s){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this.array[e+3]=s,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),ds.prototype=Object.create(hs.prototype),ds.prototype.constructor=ds,us.prototype=Object.create(hs.prototype),us.prototype.constructor=us,ps.prototype=Object.create(hs.prototype),ps.prototype.constructor=ps,ms.prototype=Object.create(hs.prototype),ms.prototype.constructor=ms,gs.prototype=Object.create(hs.prototype),gs.prototype.constructor=gs,fs.prototype=Object.create(hs.prototype),fs.prototype.constructor=fs,vs.prototype=Object.create(hs.prototype),vs.prototype.constructor=vs,ys.prototype=Object.create(hs.prototype),ys.prototype.constructor=ys,ys.prototype.isFloat16BufferAttribute=!0,bs.prototype=Object.create(hs.prototype),bs.prototype.constructor=bs,ws.prototype=Object.create(hs.prototype),ws.prototype.constructor=ws;class DirectGeometry{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(e){const t=[];let i,n,s;const o=e.faces;for(n=0;n<o.length;n++){const e=o[n];e.materialIndex!==s&&(s=e.materialIndex,void 0!==i&&(i.count=3*n-i.start,t.push(i)),i={start:3*n,materialIndex:s})}void 0!==i&&(i.count=3*n-i.start,t.push(i)),this.groups=t}fromGeometry(e){const t=e.faces,i=e.vertices,n=e.faceVertexUvs,s=n[0]&&n[0].length>0,o=n[1]&&n[1].length>0,r=e.morphTargets,a=r.length;let l;if(a>0){l=[];for(let e=0;e<a;e++)l[e]={name:r[e].name,data:[]};this.morphTargets.position=l}const c=e.morphNormals,h=c.length;let d;if(h>0){d=[];for(let e=0;e<h;e++)d[e]={name:c[e].name,data:[]};this.morphTargets.normal=d}const u=e.skinIndices,p=e.skinWeights,m=u.length===i.length,g=p.length===i.length;i.length>0&&0===t.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let e=0;e<t.length;e++){const f=t[e];this.vertices.push(i[f.a],i[f.b],i[f.c]);const v=f.vertexNormals;if(3===v.length)this.normals.push(v[0],v[1],v[2]);else{const e=f.normal;this.normals.push(e,e,e)}const y=f.vertexColors;if(3===y.length)this.colors.push(y[0],y[1],y[2]);else{const e=f.color;this.colors.push(e,e,e)}if(!0===s){const t=n[0][e];void 0!==t?this.uvs.push(t[0],t[1],t[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",e),this.uvs.push(new Vector2,new Vector2,new Vector2))}if(!0===o){const t=n[1][e];void 0!==t?this.uvs2.push(t[0],t[1],t[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",e),this.uvs2.push(new Vector2,new Vector2,new Vector2))}for(let e=0;e<a;e++){const t=r[e].vertices;l[e].data.push(t[f.a],t[f.b],t[f.c])}for(let t=0;t<h;t++){const i=c[t].vertexNormals[e];d[t].data.push(i.a,i.b,i.c)}m&&this.skinIndices.push(u[f.a],u[f.b],u[f.c]),g&&this.skinWeights.push(p[f.a],p[f.b],p[f.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this}}function Ss(e){if(0===e.length)return-1/0;let t=e[0];for(let i=1,n=e.length;i<n;++i)e[i]>t&&(t=e[i]);return t}const Es={Int8Array,Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Ts(e,t){return new Es[e](t)}let Ms=1;const _s=new Matrix4,xs=new Un,As=new Vector3,Os=new Box3,Ps=new Box3,Cs=new Vector3;function Ds(){Object.defineProperty(this,"id",{value:Ms+=2}),this.uuid=Fi.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}Ds.prototype=Object.assign(Object.create(Ni.prototype),{constructor:Ds,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){return Array.isArray(e)?this.index=new(Ss(e)>65535?vs:gs)(e,1):this.index=e,this},getAttribute:function(e){return this.attributes[e]},setAttribute:function(e,t){return this.attributes[e]=t,this},deleteAttribute:function(e){return delete this.attributes[e],this},hasAttribute:function(e){return void 0!==this.attributes[e]},addGroup:function(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix4:function(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const t=(new Matrix3).getNormalMatrix(e);i.applyNormalMatrix(t),i.needsUpdate=!0}const n=this.attributes.tangent;return void 0!==n&&(n.transformDirection(e),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(e){return _s.makeRotationX(e),this.applyMatrix4(_s),this},rotateY:function(e){return _s.makeRotationY(e),this.applyMatrix4(_s),this},rotateZ:function(e){return _s.makeRotationZ(e),this.applyMatrix4(_s),this},translate:function(e,t,i){return _s.makeTranslation(e,t,i),this.applyMatrix4(_s),this},scale:function(e,t,i){return _s.makeScale(e,t,i),this.applyMatrix4(_s),this},lookAt:function(e){return xs.lookAt(e),xs.updateMatrix(),this.applyMatrix4(xs.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(As).negate(),this.translate(As.x,As.y,As.z),this},setFromObject:function(e){const t=e.geometry;if(e.isPoints||e.isLine){const e=new bs(3*t.vertices.length,3),i=new bs(3*t.colors.length,3);if(this.setAttribute("position",e.copyVector3sArray(t.vertices)),this.setAttribute("color",i.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){const e=new bs(t.lineDistances.length,1);this.setAttribute("lineDistance",e.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){const t=[];for(let i=0,n=e.length;i<n;i++){const n=e[i];t.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new bs(t,3)),this},updateFromObject:function(e){let t=e.geometry;if(e.isMesh){let e=t.__directGeometry;if(!0===t.elementsNeedUpdate&&(e=void 0,t.elementsNeedUpdate=!1),void 0===e)return this.fromGeometry(t);e.verticesNeedUpdate=t.verticesNeedUpdate,e.normalsNeedUpdate=t.normalsNeedUpdate,e.colorsNeedUpdate=t.colorsNeedUpdate,e.uvsNeedUpdate=t.uvsNeedUpdate,e.groupsNeedUpdate=t.groupsNeedUpdate,t.verticesNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.groupsNeedUpdate=!1,t=e}if(!0===t.verticesNeedUpdate){const e=this.attributes.position;void 0!==e&&(e.copyVector3sArray(t.vertices),e.needsUpdate=!0),t.verticesNeedUpdate=!1}if(!0===t.normalsNeedUpdate){const e=this.attributes.normal;void 0!==e&&(e.copyVector3sArray(t.normals),e.needsUpdate=!0),t.normalsNeedUpdate=!1}if(!0===t.colorsNeedUpdate){const e=this.attributes.color;void 0!==e&&(e.copyColorsArray(t.colors),e.needsUpdate=!0),t.colorsNeedUpdate=!1}if(t.uvsNeedUpdate){const e=this.attributes.uv;void 0!==e&&(e.copyVector2sArray(t.uvs),e.needsUpdate=!0),t.uvsNeedUpdate=!1}if(t.lineDistancesNeedUpdate){const e=this.attributes.lineDistance;void 0!==e&&(e.copyArray(t.lineDistances),e.needsUpdate=!0),t.lineDistancesNeedUpdate=!1}return t.groupsNeedUpdate&&(t.computeGroups(e.geometry),this.groups=t.groups,t.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new DirectGeometry).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){const t=new Float32Array(3*e.vertices.length);if(this.setAttribute("position",new hs(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){const t=new Float32Array(3*e.normals.length);this.setAttribute("normal",new hs(t,3).copyVector3sArray(e.normals))}if(e.colors.length>0){const t=new Float32Array(3*e.colors.length);this.setAttribute("color",new hs(t,3).copyColorsArray(e.colors))}if(e.uvs.length>0){const t=new Float32Array(2*e.uvs.length);this.setAttribute("uv",new hs(t,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){const t=new Float32Array(2*e.uvs2.length);this.setAttribute("uv2",new hs(t,2).copyVector2sArray(e.uvs2))}this.groups=e.groups;for(const t in e.morphTargets){const i=[],n=e.morphTargets[t];for(let e=0,t=n.length;e<t;e++){const t=n[e],s=new bs(3*t.data.length,3);s.name=t.name,i.push(s.copyVector3sArray(t.data))}this.morphAttributes[t]=i}if(e.skinIndices.length>0){const t=new bs(4*e.skinIndices.length,4);this.setAttribute("skinIndex",t.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){const t=new bs(4*e.skinWeights.length,4);this.setAttribute("skinWeight",t.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Box3);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Vector3(-1/0,-1/0,-1/0),new Vector3(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,i=t.length;e<i;e++){const i=t[e];Os.setFromBufferAttribute(i),this.morphTargetsRelative?(Cs.addVectors(this.boundingBox.min,Os.min),this.boundingBox.expandByPoint(Cs),Cs.addVectors(this.boundingBox.max,Os.max),this.boundingBox.expandByPoint(Cs)):(this.boundingBox.expandByPoint(Os.min),this.boundingBox.expandByPoint(Os.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Sphere);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Vector3,1/0);if(e){const i=this.boundingSphere.center;if(Os.setFromBufferAttribute(e),t)for(let e=0,i=t.length;e<i;e++){const i=t[e];Ps.setFromBufferAttribute(i),this.morphTargetsRelative?(Cs.addVectors(Os.min,Ps.min),Os.expandByPoint(Cs),Cs.addVectors(Os.max,Ps.max),Os.expandByPoint(Cs)):(Os.expandByPoint(Ps.min),Os.expandByPoint(Ps.max))}Os.getCenter(i);let n=0;for(let t=0,s=e.count;t<s;t++)Cs.fromBufferAttribute(e,t),n=Math.max(n,i.distanceToSquared(Cs));if(t)for(let s=0,o=t.length;s<o;s++){const o=t[s],r=this.morphTargetsRelative;for(let t=0,s=o.count;t<s;t++)Cs.fromBufferAttribute(o,t),r&&(As.fromBufferAttribute(e,t),Cs.add(As)),n=Math.max(n,i.distanceToSquared(Cs))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let i=this.getAttribute("normal");if(void 0===i)i=new hs(new Float32Array(3*t.count),3),this.setAttribute("normal",i);else for(let e=0,t=i.count;e<t;e++)i.setXYZ(e,0,0,0);const n=new Vector3,s=new Vector3,o=new Vector3,r=new Vector3,a=new Vector3,l=new Vector3,c=new Vector3,h=new Vector3;if(e)for(let d=0,u=e.count;d<u;d+=3){const u=e.getX(d+0),p=e.getX(d+1),m=e.getX(d+2);n.fromBufferAttribute(t,u),s.fromBufferAttribute(t,p),o.fromBufferAttribute(t,m),c.subVectors(o,s),h.subVectors(n,s),c.cross(h),r.fromBufferAttribute(i,u),a.fromBufferAttribute(i,p),l.fromBufferAttribute(i,m),r.add(c),a.add(c),l.add(c),i.setXYZ(u,r.x,r.y,r.z),i.setXYZ(p,a.x,a.y,a.z),i.setXYZ(m,l.x,l.y,l.z)}else for(let e=0,r=t.count;e<r;e+=3)n.fromBufferAttribute(t,e+0),s.fromBufferAttribute(t,e+1),o.fromBufferAttribute(t,e+2),c.subVectors(o,s),h.subVectors(n,s),c.cross(h),i.setXYZ(e+0,c.x,c.y,c.z),i.setXYZ(e+1,c.x,c.y,c.z),i.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}},merge:function(e,t){if(!e||!e.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const i=this.attributes;for(const n in i){if(void 0===e.attributes[n])continue;const s=i[n].array,o=e.attributes[n],r=o.array,a=o.itemSize*t,l=Math.min(r.length,s.length-a);for(let e=0,t=a;e<l;e++,t++)s[t]=r[e]}return this},normalizeNormals:function(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)Cs.fromBufferAttribute(e,t),Cs.normalize(),e.setXYZ(t,Cs.x,Cs.y,Cs.z)},toNonIndexed:function(){function e(e,t){const i=e.array,n=e.itemSize,s=e.normalized,o=new i.constructor(t.length*n);let r=0,a=0;for(let e=0,s=t.length;e<s;e++){r=t[e]*n;for(let e=0;e<n;e++)o[a++]=i[r++]}return new hs(o,n,s)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;const t=new Ds,i=this.index.array,n=this.attributes;for(const s in n){const o=e(n[s],i);t.setAttribute(s,o)}const s=this.morphAttributes;for(const n in s){const o=[],r=s[n];for(let t=0,n=r.length;t<n;t++){const n=e(r[t],i);o.push(n)}t.morphAttributes[n]=o}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let e=0,i=o.length;e<i;e++){const i=o[e];t.addGroup(i.start,i.count,i.materialIndex)}return t},toJSON:function(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const i in t)void 0!==t[i]&&(e[i]=t[i]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const t in i){const n=i[t],s=n.toJSON(e.data);""!==n.name&&(s.name=n.name),e.data.attributes[t]=s}const n={};let s=!1;for(const t in this.morphAttributes){const i=this.morphAttributes[t],o=[];for(let t=0,n=i.length;t<n;t++){const n=i[t],s=n.toJSON(e.data);""!==n.name&&(s.name=n.name),o.push(s)}o.length>0&&(n[t]=o,s=!0)}s&&(e.data.morphAttributes=n,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const r=this.boundingSphere;return null!==r&&(e.data.boundingSphere={center:r.center.toArray(),radius:r.radius}),e},clone:function(){return(new Ds).copy(this)},copy:function(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;null!==i&&this.setIndex(i.clone(t));const n=e.attributes;for(const e in n){const i=n[e];this.setAttribute(e,i.clone(t))}const s=e.morphAttributes;for(const e in s){const i=[],n=s[e];for(let e=0,s=n.length;e<s;e++)i.push(n[e].clone(t));this.morphAttributes[e]=i}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let e=0,t=o.length;e<t;e++){const t=o[e];this.addGroup(t.start,t.count,t.materialIndex)}const r=e.boundingBox;null!==r&&(this.boundingBox=r.clone());const a=e.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});const Is=new Matrix4,Rs=new Ray,Ls=new Sphere,Ns=new Vector3,ks=new Vector3,Bs=new Vector3,Fs=new Vector3,Us=new Vector3,Vs=new Vector3,Hs=new Vector3,Gs=new Vector3,zs=new Vector3,js=new Vector2,Ws=new Vector2,Zs=new Vector2,qs=new Vector3,Ks=new Vector3;function Ys(e=new Ds,t=new as){Un.call(this),this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}function $s(e,t,i,n,s,o,r,a){let l;if(l=t.side===g?n.intersectTriangle(r,o,s,!0,a):n.intersectTriangle(s,o,r,t.side!==f,a),null===l)return null;Ks.copy(a),Ks.applyMatrix4(e.matrixWorld);const c=i.ray.origin.distanceTo(Ks);return c<i.near||c>i.far?null:{distance:c,point:Ks.clone(),object:e}}function Xs(e,t,i,n,s,o,r,a,l,c,h,d){Ns.fromBufferAttribute(s,c),ks.fromBufferAttribute(s,h),Bs.fromBufferAttribute(s,d);const u=e.morphTargetInfluences;if(t.morphTargets&&o&&u){Hs.set(0,0,0),Gs.set(0,0,0),zs.set(0,0,0);for(let e=0,t=o.length;e<t;e++){const t=u[e],i=o[e];0!==t&&(Fs.fromBufferAttribute(i,c),Us.fromBufferAttribute(i,h),Vs.fromBufferAttribute(i,d),r?(Hs.addScaledVector(Fs,t),Gs.addScaledVector(Us,t),zs.addScaledVector(Vs,t)):(Hs.addScaledVector(Fs.sub(Ns),t),Gs.addScaledVector(Us.sub(ks),t),zs.addScaledVector(Vs.sub(Bs),t)))}Ns.add(Hs),ks.add(Gs),Bs.add(zs)}e.isSkinnedMesh&&(e.boneTransform(c,Ns),e.boneTransform(h,ks),e.boneTransform(d,Bs));const p=$s(e,t,i,n,Ns,ks,Bs,qs);if(p){a&&(js.fromBufferAttribute(a,c),Ws.fromBufferAttribute(a,h),Zs.fromBufferAttribute(a,d),p.uv=Triangle.getUV(qs,Ns,ks,Bs,js,Ws,Zs,new Vector2)),l&&(js.fromBufferAttribute(l,c),Ws.fromBufferAttribute(l,h),Zs.fromBufferAttribute(l,d),p.uv2=Triangle.getUV(qs,Ns,ks,Bs,js,Ws,Zs,new Vector2));const e=new Face3(c,h,d);Triangle.getNormal(Ns,ks,Bs,e.normal),p.face=e}return p}Ys.prototype=Object.assign(Object.create(Un.prototype),{constructor:Ys,isMesh:!0,copy:function(e){return Un.prototype.copy.call(this,e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this},updateMorphTargets:function(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const e=t[i[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,i=e.length;t<i;t++){const i=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(e,t){const i=this.geometry,n=this.material,s=this.matrixWorld;if(void 0===n)return;if(null===i.boundingSphere&&i.computeBoundingSphere(),Ls.copy(i.boundingSphere),Ls.applyMatrix4(s),!1===e.ray.intersectsSphere(Ls))return;if(Is.copy(s).invert(),Rs.copy(e.ray).applyMatrix4(Is),null!==i.boundingBox&&!1===Rs.intersectsBox(i.boundingBox))return;let o;if(i.isBufferGeometry){const s=i.index,r=i.attributes.position,a=i.morphAttributes.position,l=i.morphTargetsRelative,c=i.attributes.uv,h=i.attributes.uv2,d=i.groups,u=i.drawRange;if(null!==s)if(Array.isArray(n))for(let i=0,p=d.length;i<p;i++){const p=d[i],m=n[p.materialIndex];for(let i=Math.max(p.start,u.start),n=Math.min(p.start+p.count,u.start+u.count);i<n;i+=3){const n=s.getX(i),d=s.getX(i+1),u=s.getX(i+2);o=Xs(this,m,e,Rs,r,a,l,c,h,n,d,u),o&&(o.faceIndex=Math.floor(i/3),o.face.materialIndex=p.materialIndex,t.push(o))}}else{for(let i=Math.max(0,u.start),d=Math.min(s.count,u.start+u.count);i<d;i+=3){const d=s.getX(i),u=s.getX(i+1),p=s.getX(i+2);o=Xs(this,n,e,Rs,r,a,l,c,h,d,u,p),o&&(o.faceIndex=Math.floor(i/3),t.push(o))}}else if(void 0!==r)if(Array.isArray(n))for(let i=0,s=d.length;i<s;i++){const s=d[i],p=n[s.materialIndex];for(let i=Math.max(s.start,u.start),n=Math.min(s.start+s.count,u.start+u.count);i<n;i+=3){o=Xs(this,p,e,Rs,r,a,l,c,h,i,i+1,i+2),o&&(o.faceIndex=Math.floor(i/3),o.face.materialIndex=s.materialIndex,t.push(o))}}else{for(let i=Math.max(0,u.start),s=Math.min(r.count,u.start+u.count);i<s;i+=3){o=Xs(this,n,e,Rs,r,a,l,c,h,i,i+1,i+2),o&&(o.faceIndex=Math.floor(i/3),t.push(o))}}}else if(i.isGeometry){const s=Array.isArray(n),r=i.vertices,a=i.faces;let l;const c=i.faceVertexUvs[0];c.length>0&&(l=c);for(let i=0,c=a.length;i<c;i++){const c=a[i],h=s?n[c.materialIndex]:n;if(void 0===h)continue;const d=r[c.a],u=r[c.b],p=r[c.c];if(o=$s(this,h,e,Rs,d,u,p,qs),o){if(l&&l[i]){const e=l[i];js.copy(e[0]),Ws.copy(e[1]),Zs.copy(e[2]),o.uv=Triangle.getUV(qs,d,u,p,js,Ws,Zs,new Vector2)}o.face=c,o.faceIndex=i,t.push(o)}}}}});class BoxBufferGeometry extends Ds{constructor(e=1,t=1,i=1,n=1,s=1,o=1){super(),this.type="BoxBufferGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:n,heightSegments:s,depthSegments:o};const r=this;n=Math.floor(n),s=Math.floor(s),o=Math.floor(o);const a=[],l=[],c=[],h=[];let d=0,u=0;function p(e,t,i,n,s,o,p,m,g,f,v){const y=o/g,b=p/f,w=o/2,S=p/2,E=m/2,T=g+1,M=f+1;let _=0,x=0;const A=new Vector3;for(let o=0;o<M;o++){const r=o*b-S;for(let a=0;a<T;a++){const d=a*y-w;A[e]=d*n,A[t]=r*s,A[i]=E,l.push(A.x,A.y,A.z),A[e]=0,A[t]=0,A[i]=m>0?1:-1,c.push(A.x,A.y,A.z),h.push(a/g),h.push(1-o/f),_+=1}}for(let e=0;e<f;e++)for(let t=0;t<g;t++){const i=d+t+T*e,n=d+t+T*(e+1),s=d+(t+1)+T*(e+1),o=d+(t+1)+T*e;a.push(i,n,o),a.push(n,s,o),x+=6}r.addGroup(u,x,v),u+=x,d+=_}p("z","y","x",-1,-1,i,t,e,o,s,0),p("z","y","x",1,-1,i,t,-e,o,s,1),p("x","z","y",1,1,e,i,t,n,o,2),p("x","z","y",1,-1,e,i,-t,n,o,3),p("x","y","z",1,-1,e,t,i,n,s,4),p("x","y","z",-1,-1,e,t,-i,n,s,5),this.setIndex(a),this.setAttribute("position",new bs(l,3)),this.setAttribute("normal",new bs(c,3)),this.setAttribute("uv",new bs(h,2))}}function Qs(e){const t={};for(const i in e){t[i]={};for(const n in e[i]){const s=e[i][n];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture)?t[i][n]=s.clone():Array.isArray(s)?t[i][n]=s.slice():t[i][n]=s}}return t}function Js(e){const t={};for(let i=0;i<e.length;i++){const n=Qs(e[i]);for(const e in n)t[e]=n[e]}return t}const eo={clone:Qs,merge:Js};function to(e){rs.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function io(){Un.call(this),this.type="Camera",this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4,this.projectionMatrixInverse=new Matrix4}function no(e=50,t=1,i=.1,n=2e3){io.call(this),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}to.prototype=Object.create(rs.prototype),to.prototype.constructor=to,to.prototype.isShaderMaterial=!0,to.prototype.copy=function(e){return rs.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Qs(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this},to.prototype.toJSON=function(e){const t=rs.prototype.toJSON.call(this,e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const n=this.uniforms[i].value;n&&n.isTexture?t.uniforms[i]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[i]={type:"m4",value:n.toArray()}:t.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const i={};for(const e in this.extensions)!0===this.extensions[e]&&(i[e]=!0);return Object.keys(i).length>0&&(t.extensions=i),t},io.prototype=Object.assign(Object.create(Un.prototype),{constructor:io,isCamera:!0,copy:function(e,t){return Un.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new Vector3),this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){Un.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()},updateWorldMatrix:function(e,t){Un.prototype.updateWorldMatrix.call(this,e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()},clone:function(){return(new this.constructor).copy(this)}}),no.prototype=Object.assign(Object.create(io.prototype),{constructor:no,isPerspectiveCamera:!0,copy:function(e,t){return io.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Fi.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){const e=Math.tan(.5*Fi.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*Fi.RAD2DEG*Math.atan(Math.tan(.5*Fi.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,i,n,s,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const e=this.near;let t=e*Math.tan(.5*Fi.DEG2RAD*this.fov)/this.zoom,i=2*t,n=this.aspect*i,s=-.5*n;const o=this.view;if(null!==this.view&&this.view.enabled){const e=o.fullWidth,r=o.fullHeight;s+=o.offsetX*n/e,t-=o.offsetY*i/r,n*=o.width/e,i*=o.height/r}const r=this.filmOffset;0!==r&&(s+=e*r/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+n,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(e){const t=Un.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}});const so=90;function oo(e,t,i){if(Un.call(this),this.type="CubeCamera",!0!==i.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=i;const n=new no(so,1,e,t);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new Vector3(1,0,0)),this.add(n);const s=new no(so,1,e,t);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new Vector3(-1,0,0)),this.add(s);const o=new no(so,1,e,t);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new Vector3(0,1,0)),this.add(o);const r=new no(so,1,e,t);r.layers=this.layers,r.up.set(0,0,-1),r.lookAt(new Vector3(0,-1,0)),this.add(r);const a=new no(so,1,e,t);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new Vector3(0,0,1)),this.add(a);const l=new no(so,1,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new Vector3(0,0,-1)),this.add(l),this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();const c=e.xr.enabled,h=e.getRenderTarget();e.xr.enabled=!1;const d=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,n),e.setRenderTarget(i,1),e.render(t,s),e.setRenderTarget(i,2),e.render(t,o),e.setRenderTarget(i,3),e.render(t,r),e.setRenderTarget(i,4),e.render(t,a),i.texture.generateMipmaps=d,e.setRenderTarget(i,5),e.render(t,l),e.setRenderTarget(h),e.xr.enabled=c}}function ro(e,t,i,n,s,o,r,a,l,c){e=void 0!==e?e:[],t=void 0!==t?t:oe,r=void 0!==r?r:Be,Gi.call(this,e,t,i,n,s,o,r,a,l,c),this.flipY=!1,this._needsFlipEnvMap=!0}function ao(e,t,i){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=i),ji.call(this,e,e,t),t=t||{},this.texture=new ro(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture._needsFlipEnvMap=!1}function lo(e,t,i,n,s,o,r,a,l,c,h,d){Gi.call(this,null,o,r,a,l,c,n,s,h,d),this.image={data:e||null,width:t||1,height:i||1},this.magFilter=void 0!==l?l:me,this.minFilter=void 0!==c?c:me,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}oo.prototype=Object.create(Un.prototype),oo.prototype.constructor=oo,ro.prototype=Object.create(Gi.prototype),ro.prototype.constructor=ro,ro.prototype.isCubeTexture=!0,Object.defineProperty(ro.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}}),ao.prototype=Object.create(ji.prototype),ao.prototype.constructor=ao,ao.prototype.isWebGLCubeRenderTarget=!0,ao.prototype.fromEquirectangularTexture=function(e,t){this.texture.type=t.type,this.texture.format=Fe,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t#include <begin_vertex>\n\t\t\t\t#include <project_vertex>\n\n\t\t\t}\n\t\t",fragmentShader:"\n\n\t\t\tuniform sampler2D tEquirect;\n\n\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t}\n\t\t"},n=new BoxBufferGeometry(5,5,5),s=new to({name:"CubemapFromEquirect",uniforms:Qs(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:g,blending:b});s.uniforms.tEquirect.value=t;const o=new Ys(n,s),r=t.minFilter;t.minFilter===Ee&&(t.minFilter=be);return new oo(1,10,this).update(e,o),t.minFilter=r,o.geometry.dispose(),o.material.dispose(),this},ao.prototype.clear=function(e,t,i,n){const s=e.getRenderTarget();for(let s=0;s<6;s++)e.setRenderTarget(this,s),e.clear(t,i,n);e.setRenderTarget(s)},lo.prototype=Object.create(Gi.prototype),lo.prototype.constructor=lo,lo.prototype.isDataTexture=!0;const co=new Sphere,ho=new Vector3;class Frustum{constructor(e,t,i,n,s,o){this.planes=[void 0!==e?e:new Plane,void 0!==t?t:new Plane,void 0!==i?i:new Plane,void 0!==n?n:new Plane,void 0!==s?s:new Plane,void 0!==o?o:new Plane]}set(e,t,i,n,s,o){const r=this.planes;return r[0].copy(e),r[1].copy(t),r[2].copy(i),r[3].copy(n),r[4].copy(s),r[5].copy(o),this}clone(){return(new this.constructor).copy(this)}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){const t=this.planes,i=e.elements,n=i[0],s=i[1],o=i[2],r=i[3],a=i[4],l=i[5],c=i[6],h=i[7],d=i[8],u=i[9],p=i[10],m=i[11],g=i[12],f=i[13],v=i[14],y=i[15];return t[0].setComponents(r-n,h-a,m-d,y-g).normalize(),t[1].setComponents(r+n,h+a,m+d,y+g).normalize(),t[2].setComponents(r+s,h+l,m+u,y+f).normalize(),t[3].setComponents(r-s,h-l,m-u,y-f).normalize(),t[4].setComponents(r-o,h-c,m-p,y-v).normalize(),t[5].setComponents(r+o,h+c,m+p,y+v).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),co.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(co)}intersectsSprite(e){return co.center.set(0,0,0),co.radius=.7071067811865476,co.applyMatrix4(e.matrixWorld),this.intersectsSphere(co)}intersectsSphere(e){const t=this.planes,i=e.center,n=-e.radius;for(let e=0;e<6;e++){if(t[e].distanceToPoint(i)<n)return!1}return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const n=t[i];if(ho.x=n.normal.x>0?e.max.x:e.min.x,ho.y=n.normal.y>0?e.max.y:e.min.y,ho.z=n.normal.z>0?e.max.z:e.min.z,n.distanceToPoint(ho)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}}function uo(){let e=null,t=!1,i=null,n=null;function s(t,o){i(t,o),n=e.requestAnimationFrame(s)}return{start:function(){!0!==t&&null!==i&&(n=e.requestAnimationFrame(s),t=!0)},stop:function(){e.cancelAnimationFrame(n),t=!1},setAnimationLoop:function(e){i=e},setContext:function(t){e=t}}}function po(e,t){const i=t.isWebGL2,n=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),n.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const i=n.get(t);i&&(e.deleteBuffer(i.buffer),n.delete(t))},update:function(t,s){if(t.isGLBufferAttribute){const e=n.get(t);return void((!e||e.version<t.version)&&n.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const o=n.get(t);void 0===o?n.set(t,function(t,n){const s=t.array,o=t.usage,r=e.createBuffer();e.bindBuffer(n,r),e.bufferData(n,s,o),t.onUploadCallback();let a=5126;return s instanceof Float32Array?a=5126:s instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):s instanceof Uint16Array?t.isFloat16BufferAttribute?i?a=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):a=5123:s instanceof Int16Array?a=5122:s instanceof Uint32Array?a=5125:s instanceof Int32Array?a=5124:s instanceof Int8Array?a=5120:s instanceof Uint8Array&&(a=5121),{buffer:r,type:a,bytesPerElement:s.BYTES_PER_ELEMENT,version:t.version}}(t,s)):o.version<t.version&&(!function(t,n,s){const o=n.array,r=n.updateRange;e.bindBuffer(s,t),-1===r.count?e.bufferSubData(s,0,o):(i?e.bufferSubData(s,r.offset*o.BYTES_PER_ELEMENT,o,r.offset,r.count):e.bufferSubData(s,r.offset*o.BYTES_PER_ELEMENT,o.subarray(r.offset,r.offset+r.count)),r.count=-1)}(o.buffer,t,s),o.version=t.version)}}}class PlaneBufferGeometry extends Ds{constructor(e=1,t=1,i=1,n=1){super(),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:n};const s=e/2,o=t/2,r=Math.floor(i),a=Math.floor(n),l=r+1,c=a+1,h=e/r,d=t/a,u=[],p=[],m=[],g=[];for(let e=0;e<c;e++){const t=e*d-o;for(let i=0;i<l;i++){const n=i*h-s;p.push(n,-t,0),m.push(0,0,1),g.push(i/r),g.push(1-e/a)}}for(let e=0;e<a;e++)for(let t=0;t<r;t++){const i=t+l*e,n=t+l*(e+1),s=t+1+l*(e+1),o=t+1+l*e;u.push(i,n,o),u.push(n,s,o)}this.setIndex(u),this.setAttribute("position",new bs(p,3)),this.setAttribute("normal",new bs(m,3)),this.setAttribute("uv",new bs(g,2))}}const mo={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor.xyz *= color.xyz;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat specularRoughness;\n\tvec3 specularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\t\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\t\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmissionmap_fragment:"#ifdef USE_TRANSMISSIONMAP\n\ttotalTransmission *= texture2D( transmissionMap, vUv ).r;\n#endif",transmissionmap_pars_fragment:"#ifdef USE_TRANSMISSIONMAP\n\tuniform sampler2D transmissionMap;\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSMISSION\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSMISSION\n\tuniform float transmission;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <transmissionmap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#ifdef TRANSMISSION\n\t\tfloat totalTransmission = transmission;\n\t#endif\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <transmissionmap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSMISSION\n\t\tdiffuseColor.a *= mix( saturate( 1. - totalTransmission + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) ), 1.0, metalness );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},go={common:{diffuse:{value:new Color(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Matrix3},uv2Transform:{value:new Matrix3},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Color(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Color(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Matrix3}},sprite:{diffuse:{value:new Color(15658734)},opacity:{value:1},center:{value:new Vector2(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Matrix3}}},fo={basic:{uniforms:Js([go.common,go.specularmap,go.envmap,go.aomap,go.lightmap,go.fog]),vertexShader:mo.meshbasic_vert,fragmentShader:mo.meshbasic_frag},lambert:{uniforms:Js([go.common,go.specularmap,go.envmap,go.aomap,go.lightmap,go.emissivemap,go.fog,go.lights,{emissive:{value:new Color(0)}}]),vertexShader:mo.meshlambert_vert,fragmentShader:mo.meshlambert_frag},phong:{uniforms:Js([go.common,go.specularmap,go.envmap,go.aomap,go.lightmap,go.emissivemap,go.bumpmap,go.normalmap,go.displacementmap,go.fog,go.lights,{emissive:{value:new Color(0)},specular:{value:new Color(1118481)},shininess:{value:30}}]),vertexShader:mo.meshphong_vert,fragmentShader:mo.meshphong_frag},standard:{uniforms:Js([go.common,go.envmap,go.aomap,go.lightmap,go.emissivemap,go.bumpmap,go.normalmap,go.displacementmap,go.roughnessmap,go.metalnessmap,go.fog,go.lights,{emissive:{value:new Color(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:mo.meshphysical_vert,fragmentShader:mo.meshphysical_frag},toon:{uniforms:Js([go.common,go.aomap,go.lightmap,go.emissivemap,go.bumpmap,go.normalmap,go.displacementmap,go.gradientmap,go.fog,go.lights,{emissive:{value:new Color(0)}}]),vertexShader:mo.meshtoon_vert,fragmentShader:mo.meshtoon_frag},matcap:{uniforms:Js([go.common,go.bumpmap,go.normalmap,go.displacementmap,go.fog,{matcap:{value:null}}]),vertexShader:mo.meshmatcap_vert,fragmentShader:mo.meshmatcap_frag},points:{uniforms:Js([go.points,go.fog]),vertexShader:mo.points_vert,fragmentShader:mo.points_frag},dashed:{uniforms:Js([go.common,go.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:mo.linedashed_vert,fragmentShader:mo.linedashed_frag},depth:{uniforms:Js([go.common,go.displacementmap]),vertexShader:mo.depth_vert,fragmentShader:mo.depth_frag},normal:{uniforms:Js([go.common,go.bumpmap,go.normalmap,go.displacementmap,{opacity:{value:1}}]),vertexShader:mo.normal_vert,fragmentShader:mo.normal_frag},sprite:{uniforms:Js([go.sprite,go.fog]),vertexShader:mo.sprite_vert,fragmentShader:mo.sprite_frag},background:{uniforms:{uvTransform:{value:new Matrix3},t2D:{value:null}},vertexShader:mo.background_vert,fragmentShader:mo.background_frag},cube:{uniforms:Js([go.envmap,{opacity:{value:1}}]),vertexShader:mo.cube_vert,fragmentShader:mo.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:mo.equirect_vert,fragmentShader:mo.equirect_frag},distanceRGBA:{uniforms:Js([go.common,go.displacementmap,{referencePosition:{value:new Vector3},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:mo.distanceRGBA_vert,fragmentShader:mo.distanceRGBA_frag},shadow:{uniforms:Js([go.lights,go.fog,{color:{value:new Color(0)},opacity:{value:1}}]),vertexShader:mo.shadow_vert,fragmentShader:mo.shadow_frag}};function vo(e,t,i,n,s){const o=new Color(0);let r,a,l=0,c=null,h=0,d=null;function u(e,t){i.buffers.color.setClear(e.r,e.g,e.b,t,s)}return{getClearColor:function(){return o},setClearColor:function(e,t=1){o.set(e),l=t,u(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(e){l=e,u(o,l)},render:function(i,s,p,f){let v=!0===s.isScene?s.background:null;v&&v.isTexture&&(v=t.get(v));const y=e.xr,b=y.getSession&&y.getSession();b&&"additive"===b.environmentBlendMode&&(v=null),null===v?u(o,l):v&&v.isColor&&(u(v,1),f=!0),(e.autoClear||f)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),v&&(v.isCubeTexture||v.isWebGLCubeRenderTarget||v.mapping===ce)?(void 0===a&&(a=new Ys(new BoxBufferGeometry(1,1,1),new to({name:"BackgroundCubeMaterial",uniforms:Qs(fo.cube.uniforms),vertexShader:fo.cube.vertexShader,fragmentShader:fo.cube.fragmentShader,side:g,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),a.geometry.deleteAttribute("uv"),a.onBeforeRender=function(e,t,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(a.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(a)),v.isWebGLCubeRenderTarget&&(v=v.texture),a.material.uniforms.envMap.value=v,a.material.uniforms.flipEnvMap.value=v.isCubeTexture&&v._needsFlipEnvMap?-1:1,c===v&&h===v.version&&d===e.toneMapping||(a.material.needsUpdate=!0,c=v,h=v.version,d=e.toneMapping),i.unshift(a,a.geometry,a.material,0,0,null)):v&&v.isTexture&&(void 0===r&&(r=new Ys(new PlaneBufferGeometry(2,2),new to({name:"BackgroundMaterial",uniforms:Qs(fo.background.uniforms),vertexShader:fo.background.vertexShader,fragmentShader:fo.background.fragmentShader,side:m,depthTest:!1,depthWrite:!1,fog:!1})),r.geometry.deleteAttribute("normal"),Object.defineProperty(r.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(r)),r.material.uniforms.t2D.value=v,!0===v.matrixAutoUpdate&&v.updateMatrix(),r.material.uniforms.uvTransform.value.copy(v.matrix),c===v&&h===v.version&&d===e.toneMapping||(r.material.needsUpdate=!0,c=v,h=v.version,d=e.toneMapping),i.unshift(r,r.geometry,r.material,0,0,null))}}}function yo(e,t,i,n){const s=e.getParameter(34921),o=n.isWebGL2?null:t.get("OES_vertex_array_object"),r=n.isWebGL2||null!==o,a={},l=u(null);let c=l;function h(t){return n.isWebGL2?e.bindVertexArray(t):o.bindVertexArrayOES(t)}function d(t){return n.isWebGL2?e.deleteVertexArray(t):o.deleteVertexArrayOES(t)}function u(e){const t=[],i=[],n=[];for(let e=0;e<s;e++)t[e]=0,i[e]=0,n[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:i,attributeDivisors:n,object:e,attributes:{},index:null}}function p(){const e=c.newAttributes;for(let t=0,i=e.length;t<i;t++)e[t]=0}function m(e){g(e,0)}function g(i,s){const o=c.newAttributes,r=c.enabledAttributes,a=c.attributeDivisors;if(o[i]=1,0===r[i]&&(e.enableVertexAttribArray(i),r[i]=1),a[i]!==s){(n.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](i,s),a[i]=s}}function f(){const t=c.newAttributes,i=c.enabledAttributes;for(let n=0,s=i.length;n<s;n++)i[n]!==t[n]&&(e.disableVertexAttribArray(n),i[n]=0)}function v(t,i,s,o,r,a){!0!==n.isWebGL2||5124!==s&&5125!==s?e.vertexAttribPointer(t,i,s,o,r,a):e.vertexAttribIPointer(t,i,s,r,a)}function y(){b(),c!==l&&(c=l,h(c.object))}function b(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(s,l,d,y,b){let w=!1;if(r){const t=function(t,i,s){const r=!0===s.wireframe;let l=a[t.id];void 0===l&&(l={},a[t.id]=l);let c=l[i.id];void 0===c&&(c={},l[i.id]=c);let h=c[r];void 0===h&&(h=u(n.isWebGL2?e.createVertexArray():o.createVertexArrayOES()),c[r]=h);return h}(y,d,l);c!==t&&(c=t,h(c.object)),w=function(e,t){const i=c.attributes,n=e.attributes;let s=0;for(const e in n){const t=i[e],o=n[e];if(void 0===t)return!0;if(t.attribute!==o)return!0;if(t.data!==o.data)return!0;s++}return c.attributesNum!==s||c.index!==t}(y,b),w&&function(e,t){const i={},n=e.attributes;let s=0;for(const e in n){const t=n[e],o={};o.attribute=t,t.data&&(o.data=t.data),i[e]=o,s++}c.attributes=i,c.attributesNum=s,c.index=t}(y,b)}else{const e=!0===l.wireframe;c.geometry===y.id&&c.program===d.id&&c.wireframe===e||(c.geometry=y.id,c.program=d.id,c.wireframe=e,w=!0)}!0===s.isInstancedMesh&&(w=!0),null!==b&&i.update(b,34963),w&&(!function(s,o,r,a){if(!1===n.isWebGL2&&(s.isInstancedMesh||a.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;p();const l=a.attributes,c=r.getAttributes(),h=o.defaultAttributeValues;for(const t in c){const n=c[t];if(n>=0){const o=l[t];if(void 0!==o){const t=o.normalized,s=o.itemSize,r=i.get(o);if(void 0===r)continue;const l=r.buffer,c=r.type,h=r.bytesPerElement;if(o.isInterleavedBufferAttribute){const i=o.data,r=i.stride,d=o.offset;i&&i.isInstancedInterleavedBuffer?(g(n,i.meshPerAttribute),void 0===a._maxInstanceCount&&(a._maxInstanceCount=i.meshPerAttribute*i.count)):m(n),e.bindBuffer(34962,l),v(n,s,c,t,r*h,d*h)}else o.isInstancedBufferAttribute?(g(n,o.meshPerAttribute),void 0===a._maxInstanceCount&&(a._maxInstanceCount=o.meshPerAttribute*o.count)):m(n),e.bindBuffer(34962,l),v(n,s,c,t,0,0)}else if("instanceMatrix"===t){const t=i.get(s.instanceMatrix);if(void 0===t)continue;const o=t.buffer,r=t.type;g(n+0,1),g(n+1,1),g(n+2,1),g(n+3,1),e.bindBuffer(34962,o),e.vertexAttribPointer(n+0,4,r,!1,64,0),e.vertexAttribPointer(n+1,4,r,!1,64,16),e.vertexAttribPointer(n+2,4,r,!1,64,32),e.vertexAttribPointer(n+3,4,r,!1,64,48)}else if("instanceColor"===t){const t=i.get(s.instanceColor);if(void 0===t)continue;const o=t.buffer,r=t.type;g(n,1),e.bindBuffer(34962,o),e.vertexAttribPointer(n,3,r,!1,12,0)}else if(void 0!==h){const i=h[t];if(void 0!==i)switch(i.length){case 2:e.vertexAttrib2fv(n,i);break;case 3:e.vertexAttrib3fv(n,i);break;case 4:e.vertexAttrib4fv(n,i);break;default:e.vertexAttrib1fv(n,i)}}}}f()}(s,l,d,y),null!==b&&e.bindBuffer(34963,i.get(b).buffer))},reset:y,resetDefaultState:b,dispose:function(){y();for(const e in a){const t=a[e];for(const e in t){const i=t[e];for(const e in i)d(i[e].object),delete i[e];delete t[e]}delete a[e]}},releaseStatesOfGeometry:function(e){if(void 0===a[e.id])return;const t=a[e.id];for(const e in t){const i=t[e];for(const e in i)d(i[e].object),delete i[e];delete t[e]}delete a[e.id]},releaseStatesOfProgram:function(e){for(const t in a){const i=a[t];if(void 0===i[e.id])continue;const n=i[e.id];for(const e in n)d(n[e].object),delete n[e];delete i[e.id]}},initAttributes:p,enableAttribute:m,disableUnusedAttributes:f}}function bo(e,t,i,n){const s=n.isWebGL2;let o;this.setMode=function(e){o=e},this.render=function(t,n){e.drawArrays(o,t,n),i.update(n,o,1)},this.renderInstances=function(n,r,a){if(0===a)return;let l,c;if(s)l=e,c="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](o,n,r,a),i.update(r,o,a)}}function wo(e,t,i){let n;function s(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const o="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext;let r=void 0!==i.precision?i.precision:"highp";const a=s(r);a!==r&&(console.warn("THREE.WebGLRenderer:",r,"not supported, using",a,"instead."),r=a);const l=!0===i.logarithmicDepthBuffer,c=e.getParameter(34930),h=e.getParameter(35660),d=e.getParameter(3379),u=e.getParameter(34076),p=e.getParameter(34921),m=e.getParameter(36347),g=e.getParameter(36348),f=e.getParameter(36349),v=h>0,y=o||!!t.get("OES_texture_float");return{isWebGL2:o,getMaxAnisotropy:function(){if(void 0!==n)return n;const i=t.get("EXT_texture_filter_anisotropic");return n=null!==i?e.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,n},getMaxPrecision:s,precision:r,logarithmicDepthBuffer:l,maxTextures:c,maxVertexTextures:h,maxTextureSize:d,maxCubemapSize:u,maxAttributes:p,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:f,vertexTextures:v,floatFragmentTextures:y,floatVertexTextures:v&&y,maxSamples:o?e.getParameter(36183):0}}function So(e){const t=this;let i=null,n=0,s=!1,o=!1;const r=new Plane,a=new Matrix3,l={value:null,needsUpdate:!1};function c(){l.value!==i&&(l.value=i,l.needsUpdate=n>0),t.numPlanes=n,t.numIntersection=0}function h(e,i,n,s){const o=null!==e?e.length:0;let c=null;if(0!==o){if(c=l.value,!0!==s||null===c){const t=n+4*o,s=i.matrixWorldInverse;a.getNormalMatrix(s),(null===c||c.length<t)&&(c=new Float32Array(t));for(let t=0,i=n;t!==o;++t,i+=4)r.copy(e[t]).applyMatrix4(s,a),r.normal.toArray(c,i),c[i+3]=r.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=o,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,o){const r=0!==e.length||t||0!==n||s;return s=t,i=h(e,o,0),n=e.length,r},this.beginShadows=function(){o=!0,h(null)},this.endShadows=function(){o=!1,c()},this.setState=function(t,r,a){const d=t.clippingPlanes,u=t.clipIntersection,p=t.clipShadows,m=e.get(t);if(!s||null===d||0===d.length||o&&!p)o?h(null):c();else{const e=o?0:n,t=4*e;let s=m.clippingState||null;l.value=s,s=h(d,r,t,a);for(let e=0;e!==t;++e)s[e]=i[e];m.clippingState=s,this.numIntersection=u?this.numPlanes:0,this.numPlanes+=e}}}function Eo(e){let t=new WeakMap;function i(e,t){return t===ae?e.mapping=oe:t===le&&(e.mapping=re),e}function n(e){const i=e.target;i.removeEventListener("dispose",n);const s=t.get(i);void 0!==s&&(t.delete(i),s.dispose())}return{get:function(s){if(s&&s.isTexture){const o=s.mapping;if(o===ae||o===le){if(t.has(s)){return i(t.get(s).texture,s.mapping)}{const o=s.image;if(o&&o.height>0){const r=e.getRenderList(),a=e.getRenderTarget(),l=new ao(o.height/2);return l.fromEquirectangularTexture(e,s),t.set(s,l),e.setRenderTarget(a),e.setRenderList(r),s.addEventListener("dispose",n),i(l.texture,s.mapping)}return null}}}return s},dispose:function(){t=new WeakMap}}}function To(e){const t={};return{has:function(i){if(void 0!==t[i])return null!==t[i];let n;switch(i){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(i)}return t[i]=n,null!==n},get:function(e){return this.has(e)||console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t[e]}}}function Mo(e,t,i,n){const s=new WeakMap,o=new WeakMap;function r(e){const a=e.target,l=s.get(a);null!==l.index&&t.remove(l.index);for(const e in l.attributes)t.remove(l.attributes[e]);a.removeEventListener("dispose",r),s.delete(a);const c=o.get(l);c&&(t.remove(c),o.delete(l)),n.releaseStatesOfGeometry(l),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,i.memory.geometries--}function a(e){const i=[],n=e.index,s=e.attributes.position;let r=0;if(null!==n){const e=n.array;r=n.version;for(let t=0,n=e.length;t<n;t+=3){const n=e[t+0],s=e[t+1],o=e[t+2];i.push(n,s,s,o,o,n)}}else{const e=s.array;r=s.version;for(let t=0,n=e.length/3-1;t<n;t+=3){const e=t+0,n=t+1,s=t+2;i.push(e,n,n,s,s,e)}}const a=new(Ss(i)>65535?vs:gs)(i,1);a.version=r;const l=o.get(e);l&&t.remove(l),o.set(e,a)}return{get:function(e,t){let n=s.get(t);return n||(t.addEventListener("dispose",r),t.isBufferGeometry?n=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new Ds).setFromObject(e)),n=t._bufferGeometry),s.set(t,n),i.memory.geometries++,n)},update:function(e){const i=e.attributes;for(const e in i)t.update(i[e],34962);const n=e.morphAttributes;for(const e in n){const i=n[e];for(let e=0,n=i.length;e<n;e++)t.update(i[e],34962)}},getWireframeAttribute:function(e){const t=o.get(e);if(t){const i=e.index;null!==i&&t.version<i.version&&a(e)}else a(e);return o.get(e)}}}function _o(e,t,i,n){const s=n.isWebGL2;let o,r,a;this.setMode=function(e){o=e},this.setIndex=function(e){r=e.type,a=e.bytesPerElement},this.render=function(t,n){e.drawElements(o,n,r,t*a),i.update(n,o,1)},this.renderInstances=function(n,l,c){if(0===c)return;let h,d;if(s)h=e,d="drawElementsInstanced";else if(h=t.get("ANGLE_instanced_arrays"),d="drawElementsInstancedANGLE",null===h)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[d](o,l,r,n*a,c),i.update(l,o,c)}}function xo(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,i,n){switch(t.calls++,i){case 4:t.triangles+=n*(e/3);break;case 1:t.lines+=n*(e/2);break;case 3:t.lines+=n*(e-1);break;case 2:t.lines+=n*e;break;case 0:t.points+=n*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}function Ao(e,t){return e[0]-t[0]}function Oo(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Po(e){const t={},i=new Float32Array(8),n=[];for(let e=0;e<8;e++)n[e]=[e,0];return{update:function(s,o,r,a){const l=s.morphTargetInfluences,c=void 0===l?0:l.length;let h=t[o.id];if(void 0===h){h=[];for(let e=0;e<c;e++)h[e]=[e,0];t[o.id]=h}for(let e=0;e<c;e++){const t=h[e];t[0]=e,t[1]=l[e]}h.sort(Oo);for(let e=0;e<8;e++)e<c&&h[e][1]?(n[e][0]=h[e][0],n[e][1]=h[e][1]):(n[e][0]=Number.MAX_SAFE_INTEGER,n[e][1]=0);n.sort(Ao);const d=r.morphTargets&&o.morphAttributes.position,u=r.morphNormals&&o.morphAttributes.normal;let p=0;for(let e=0;e<8;e++){const t=n[e],s=t[0],r=t[1];s!==Number.MAX_SAFE_INTEGER&&r?(d&&o.getAttribute("morphTarget"+e)!==d[s]&&o.setAttribute("morphTarget"+e,d[s]),u&&o.getAttribute("morphNormal"+e)!==u[s]&&o.setAttribute("morphNormal"+e,u[s]),i[e]=r,p+=r):(d&&!0===o.hasAttribute("morphTarget"+e)&&o.deleteAttribute("morphTarget"+e),u&&!0===o.hasAttribute("morphNormal"+e)&&o.deleteAttribute("morphNormal"+e),i[e]=0)}const m=o.morphTargetsRelative?1:1-p;a.getUniforms().setValue(e,"morphTargetBaseInfluence",m),a.getUniforms().setValue(e,"morphTargetInfluences",i)}}}function Co(e,t,i,n){let s=new WeakMap;function o(e){const t=e.target;t.removeEventListener("dispose",o),i.remove(t.instanceMatrix),null!==t.instanceColor&&i.remove(t.instanceColor)}return{update:function(e){const r=n.render.frame,a=e.geometry,l=t.get(e,a);return s.get(l)!==r&&(a.isGeometry&&l.updateFromObject(e),t.update(l),s.set(l,r)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",o)&&e.addEventListener("dispose",o),i.update(e.instanceMatrix,34962),null!==e.instanceColor&&i.update(e.instanceColor,34962)),l},dispose:function(){s=new WeakMap}}}function Do(e=null,t=1,i=1,n=1){Gi.call(this,null),this.image={data:e,width:t,height:i,depth:n},this.magFilter=me,this.minFilter=me,this.wrapR=ue,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function Io(e=null,t=1,i=1,n=1){Gi.call(this,null),this.image={data:e,width:t,height:i,depth:n},this.magFilter=me,this.minFilter=me,this.wrapR=ue,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}fo.physical={uniforms:Js([fo.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Vector2(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new Color(0)},transmission:{value:0},transmissionMap:{value:null}}]),vertexShader:mo.meshphysical_vert,fragmentShader:mo.meshphysical_frag},Do.prototype=Object.create(Gi.prototype),Do.prototype.constructor=Do,Do.prototype.isDataTexture2DArray=!0,Io.prototype=Object.create(Gi.prototype),Io.prototype.constructor=Io,Io.prototype.isDataTexture3D=!0;const Ro=new Gi,Lo=new Do,No=new Io,ko=new ro,Bo=[],Fo=[],Uo=new Float32Array(16),Vo=new Float32Array(9),Ho=new Float32Array(4);function Go(e,t,i){const n=e[0];if(n<=0||n>0)return e;const s=t*i;let o=Bo[s];if(void 0===o&&(o=new Float32Array(s),Bo[s]=o),0!==t){n.toArray(o,0);for(let n=1,s=0;n!==t;++n)s+=i,e[n].toArray(o,s)}return o}function zo(e,t){if(e.length!==t.length)return!1;for(let i=0,n=e.length;i<n;i++)if(e[i]!==t[i])return!1;return!0}function jo(e,t){for(let i=0,n=t.length;i<n;i++)e[i]=t[i]}function Wo(e,t){let i=Fo[t];void 0===i&&(i=new Int32Array(t),Fo[t]=i);for(let n=0;n!==t;++n)i[n]=e.allocateTextureUnit();return i}function Zo(e,t){const i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function qo(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(zo(i,t))return;e.uniform2fv(this.addr,t),jo(i,t)}}function Ko(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(void 0!==t.r)i[0]===t.r&&i[1]===t.g&&i[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(zo(i,t))return;e.uniform3fv(this.addr,t),jo(i,t)}}function Yo(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z&&i[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(zo(i,t))return;e.uniform4fv(this.addr,t),jo(i,t)}}function $o(e,t){const i=this.cache,n=t.elements;if(void 0===n){if(zo(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),jo(i,t)}else{if(zo(i,n))return;Ho.set(n),e.uniformMatrix2fv(this.addr,!1,Ho),jo(i,n)}}function Xo(e,t){const i=this.cache,n=t.elements;if(void 0===n){if(zo(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),jo(i,t)}else{if(zo(i,n))return;Vo.set(n),e.uniformMatrix3fv(this.addr,!1,Vo),jo(i,n)}}function Qo(e,t){const i=this.cache,n=t.elements;if(void 0===n){if(zo(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),jo(i,t)}else{if(zo(i,n))return;Uo.set(n),e.uniformMatrix4fv(this.addr,!1,Uo),jo(i,n)}}function Jo(e,t,i){const n=this.cache,s=i.allocateTextureUnit();n[0]!==s&&(e.uniform1i(this.addr,s),n[0]=s),i.safeSetTexture2D(t||Ro,s)}function er(e,t,i){const n=this.cache,s=i.allocateTextureUnit();n[0]!==s&&(e.uniform1i(this.addr,s),n[0]=s),i.setTexture2DArray(t||Lo,s)}function tr(e,t,i){const n=this.cache,s=i.allocateTextureUnit();n[0]!==s&&(e.uniform1i(this.addr,s),n[0]=s),i.setTexture3D(t||No,s)}function ir(e,t,i){const n=this.cache,s=i.allocateTextureUnit();n[0]!==s&&(e.uniform1i(this.addr,s),n[0]=s),i.safeSetTextureCube(t||ko,s)}function nr(e,t){const i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function sr(e,t){const i=this.cache;zo(i,t)||(e.uniform2iv(this.addr,t),jo(i,t))}function or(e,t){const i=this.cache;zo(i,t)||(e.uniform3iv(this.addr,t),jo(i,t))}function rr(e,t){const i=this.cache;zo(i,t)||(e.uniform4iv(this.addr,t),jo(i,t))}function ar(e,t){const i=this.cache;i[0]!==t&&(e.uniform1ui(this.addr,t),i[0]=t)}function lr(e,t){e.uniform1fv(this.addr,t)}function cr(e,t){e.uniform1iv(this.addr,t)}function hr(e,t){e.uniform2iv(this.addr,t)}function dr(e,t){e.uniform3iv(this.addr,t)}function ur(e,t){e.uniform4iv(this.addr,t)}function pr(e,t){const i=Go(t,this.size,2);e.uniform2fv(this.addr,i)}function mr(e,t){const i=Go(t,this.size,3);e.uniform3fv(this.addr,i)}function gr(e,t){const i=Go(t,this.size,4);e.uniform4fv(this.addr,i)}function fr(e,t){const i=Go(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function vr(e,t){const i=Go(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function yr(e,t){const i=Go(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function br(e,t,i){const n=t.length,s=Wo(i,n);e.uniform1iv(this.addr,s);for(let e=0;e!==n;++e)i.safeSetTexture2D(t[e]||Ro,s[e])}function wr(e,t,i){const n=t.length,s=Wo(i,n);e.uniform1iv(this.addr,s);for(let e=0;e!==n;++e)i.safeSetTextureCube(t[e]||ko,s[e])}function Sr(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=function(e){switch(e){case 5126:return Zo;case 35664:return qo;case 35665:return Ko;case 35666:return Yo;case 35674:return $o;case 35675:return Xo;case 35676:return Qo;case 5124:case 35670:return nr;case 35667:case 35671:return sr;case 35668:case 35672:return or;case 35669:case 35673:return rr;case 5125:return ar;case 35678:case 36198:case 36298:case 36306:case 35682:return Jo;case 35679:case 36299:case 36307:return tr;case 35680:case 36300:case 36308:case 36293:return ir;case 36289:case 36303:case 36311:case 36292:return er}}(t.type)}function Er(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return lr;case 35664:return pr;case 35665:return mr;case 35666:return gr;case 35674:return fr;case 35675:return vr;case 35676:return yr;case 5124:case 35670:return cr;case 35667:case 35671:return hr;case 35668:case 35672:return dr;case 35669:case 35673:return ur;case 35678:case 36198:case 36298:case 36306:case 35682:return br;case 35680:case 36300:case 36308:case 36293:return wr}}(t.type)}function Tr(e){this.id=e,this.seq=[],this.map={}}Er.prototype.updateCache=function(e){const t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),jo(t,e)},Tr.prototype.setValue=function(e,t,i){const n=this.seq;for(let s=0,o=n.length;s!==o;++s){const o=n[s];o.setValue(e,t[o.id],i)}};const Mr=/(\w+)(\])?(\[|\.)?/g;function _r(e,t){e.seq.push(t),e.map[t.id]=t}function xr(e,t,i){const n=e.name,s=n.length;for(Mr.lastIndex=0;;){const o=Mr.exec(n),r=Mr.lastIndex;let a=o[1];const l="]"===o[2],c=o[3];if(l&&(a|=0),void 0===c||"["===c&&r+2===s){_r(i,void 0===c?new Sr(a,e,t):new Er(a,e,t));break}{let e=i.map[a];void 0===e&&(e=new Tr(a),_r(i,e)),i=e}}}function Ar(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,35718);for(let n=0;n<i;++n){const i=e.getActiveUniform(t,n);xr(i,e.getUniformLocation(t,i.name),this)}}function Or(e,t,i){const n=e.createShader(t);return e.shaderSource(n,i),e.compileShader(n),n}Ar.prototype.setValue=function(e,t,i,n){const s=this.map[t];void 0!==s&&s.setValue(e,i,n)},Ar.prototype.setOptional=function(e,t,i){const n=t[i];void 0!==n&&this.setValue(e,i,n)},Ar.upload=function(e,t,i,n){for(let s=0,o=t.length;s!==o;++s){const o=t[s],r=i[o.id];!1!==r.needsUpdate&&o.setValue(e,r.value,n)}},Ar.seqWithValue=function(e,t){const i=[];for(let n=0,s=e.length;n!==s;++n){const s=e[n];s.id in t&&i.push(s)}return i};let Pr=0;function Cr(e){switch(e){case $t:return["Linear","( value )"];case Xt:return["sRGB","( value )"];case Jt:return["RGBE","( value )"];case ti:return["RGBM","( value, 7.0 )"];case ii:return["RGBM","( value, 16.0 )"];case ni:return["RGBD","( value, 256.0 )"];case Qt:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case ei:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function Dr(e,t,i){const n=e.getShaderParameter(t,35713),s=e.getShaderInfoLog(t).trim();if(n&&""===s)return"";return"THREE.WebGLShader: gl.getShaderInfoLog() "+i+"\n"+s+function(e){const t=e.split("\n");for(let e=0;e<t.length;e++)t[e]=e+1+": "+t[e];return t.join("\n")}(e.getShaderSource(t))}function Ir(e,t){const i=Cr(t);return"vec4 "+e+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function Rr(e,t){const i=Cr(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function Lr(e,t){let i;switch(t){case J:i="Linear";break;case ee:i="Reinhard";break;case te:i="OptimizedCineon";break;case ie:i="ACESFilmic";break;case ne:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),i="Linear"}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function Nr(e){return""!==e}function kr(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Br(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const Fr=/^[ \t]*#include +<([\w\d./]+)>/gm;function Ur(e){return e.replace(Fr,Vr)}function Vr(e,t){const i=mo[t];if(void 0===i)throw new Error("Can not resolve #include <"+t+">");return Ur(i)}const Hr=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,Gr=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function zr(e){return e.replace(Gr,Wr).replace(Hr,jr)}function jr(e,t,i,n){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Wr(e,t,i,n)}function Wr(e,t,i,n){let s="";for(let e=parseInt(t);e<parseInt(i);e++)s+=n.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return s}function Zr(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function qr(e,t,i,n){const s=e.getContext(),o=i.defines;let r=i.vertexShader,a=i.fragmentShader;const l=function(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===d?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===u?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===p&&(t="SHADOWMAP_TYPE_VSM"),t}(i),c=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case oe:case re:t="ENVMAP_TYPE_CUBE";break;case ce:case he:t="ENVMAP_TYPE_CUBE_UV"}return t}(i),h=function(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case re:case he:t="ENVMAP_MODE_REFRACTION"}return t}(i),m=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case Y:t="ENVMAP_BLENDING_MULTIPLY";break;case $:t="ENVMAP_BLENDING_MIX";break;case X:t="ENVMAP_BLENDING_ADD"}return t}(i),g=e.gammaFactor>0?e.gammaFactor:1,f=i.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Nr).join("\n")}(i),v=function(e){const t=[];for(const i in e){const n=e[i];!1!==n&&t.push("#define "+i+" "+n)}return t.join("\n")}(o),y=s.createProgram();let b,w,S=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?(b=[v].filter(Nr).join("\n"),b.length>0&&(b+="\n"),w=[f,v].filter(Nr).join("\n"),w.length>0&&(w+="\n")):(b=[Zr(i),"#define SHADER_NAME "+i.shaderName,v,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+g,"#define MAX_BONES "+i.maxBones,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+h:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Nr).join("\n"),w=[f,Zr(i),"#define SHADER_NAME "+i.shaderName,v,i.alphaTest?"#define ALPHATEST "+i.alphaTest+(i.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+g,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.envMap?"#define "+h:"",i.envMap?"#define "+m:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.sheen?"#define USE_SHEEN":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(i.extensionShaderTextureLOD||i.envMap)&&i.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==Q?"#define TONE_MAPPING":"",i.toneMapping!==Q?mo.tonemapping_pars_fragment:"",i.toneMapping!==Q?Lr("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",mo.encodings_pars_fragment,i.map?Ir("mapTexelToLinear",i.mapEncoding):"",i.matcap?Ir("matcapTexelToLinear",i.matcapEncoding):"",i.envMap?Ir("envMapTexelToLinear",i.envMapEncoding):"",i.emissiveMap?Ir("emissiveMapTexelToLinear",i.emissiveMapEncoding):"",i.lightMap?Ir("lightMapTexelToLinear",i.lightMapEncoding):"",Rr("linearToOutputTexel",i.outputEncoding),i.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(Nr).join("\n")),r=Ur(r),r=kr(r,i),r=Br(r,i),a=Ur(a),a=kr(a,i),a=Br(a,i),r=zr(r),a=zr(a),i.isWebGL2&&!0!==i.isRawShaderMaterial&&(S="#version 300 es\n",b=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+b,w=["#define varying in",i.glslVersion===Li?"":"out highp vec4 pc_fragColor;",i.glslVersion===Li?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+w);const E=S+w+a,T=Or(s,35633,S+b+r),M=Or(s,35632,E);if(s.attachShader(y,T),s.attachShader(y,M),void 0!==i.index0AttributeName?s.bindAttribLocation(y,0,i.index0AttributeName):!0===i.morphTargets&&s.bindAttribLocation(y,0,"position"),s.linkProgram(y),e.debug.checkShaderErrors){const e=s.getProgramInfoLog(y).trim(),t=s.getShaderInfoLog(T).trim(),i=s.getShaderInfoLog(M).trim();let n=!0,o=!0;if(!1===s.getProgramParameter(y,35714)){n=!1;const t=Dr(s,T,"vertex"),i=Dr(s,M,"fragment");console.error("THREE.WebGLProgram: shader error: ",s.getError(),"35715",s.getProgramParameter(y,35715),"gl.getProgramInfoLog",e,t,i)}else""!==e?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",e):""!==t&&""!==i||(o=!1);o&&(this.diagnostics={runnable:n,programLog:e,vertexShader:{log:t,prefix:b},fragmentShader:{log:i,prefix:w}})}let _,x;return s.deleteShader(T),s.deleteShader(M),this.getUniforms=function(){return void 0===_&&(_=new Ar(s,y)),_},this.getAttributes=function(){return void 0===x&&(x=function(e,t){const i={},n=e.getProgramParameter(t,35721);for(let s=0;s<n;s++){const n=e.getActiveAttrib(t,s).name;i[n]=e.getAttribLocation(t,n)}return i}(s,y)),x},this.destroy=function(){n.releaseStatesOfProgram(this),s.deleteProgram(y),this.program=void 0},this.name=i.shaderName,this.id=Pr++,this.cacheKey=t,this.usedTimes=1,this.program=y,this.vertexShader=T,this.fragmentShader=M,this}function Kr(e,t,i,n,s,o){const r=[],a=n.isWebGL2,l=n.logarithmicDepthBuffer,c=n.floatVertexTextures,h=n.maxVertexUniforms,d=n.vertexTextures;let u=n.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},m=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmissionMap"];function v(e){let t;return e&&e.isTexture?t=e.encoding:e&&e.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=e.texture.encoding):t=$t,t}return{getParameters:function(s,r,m,y,b){const w=y.fog,S=s.isMeshStandardMaterial?y.environment:null,E=t.get(s.envMap||S),T=p[s.type],M=b.isSkinnedMesh?function(e){const t=e.skeleton.bones;if(c)return 1024;{const e=h,i=Math.floor((e-20)/4),n=Math.min(i,t.length);return n<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+n+"."),0):n}}(b):0;let _,x;if(null!==s.precision&&(u=n.getMaxPrecision(s.precision),u!==s.precision&&console.warn("THREE.WebGLProgram.getParameters:",s.precision,"not supported, using",u,"instead.")),T){const e=fo[T];_=e.vertexShader,x=e.fragmentShader}else _=s.vertexShader,x=s.fragmentShader;const A=e.getRenderTarget();return{isWebGL2:a,shaderID:T,shaderName:s.type,vertexShader:_,fragmentShader:x,defines:s.defines,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:u,instancing:!0===b.isInstancedMesh,instancingColor:!0===b.isInstancedMesh&&null!==b.instanceColor,supportsVertexTextures:d,outputEncoding:null!==A?v(A.texture):e.outputEncoding,map:!!s.map,mapEncoding:v(s.map),matcap:!!s.matcap,matcapEncoding:v(s.matcap),envMap:!!E,envMapMode:E&&E.mapping,envMapEncoding:v(E),envMapCubeUV:!!E&&(E.mapping===ce||E.mapping===he),lightMap:!!s.lightMap,lightMapEncoding:v(s.lightMap),aoMap:!!s.aoMap,emissiveMap:!!s.emissiveMap,emissiveMapEncoding:v(s.emissiveMap),bumpMap:!!s.bumpMap,normalMap:!!s.normalMap,objectSpaceNormalMap:s.normalMapType===ai,tangentSpaceNormalMap:s.normalMapType===ri,clearcoatMap:!!s.clearcoatMap,clearcoatRoughnessMap:!!s.clearcoatRoughnessMap,clearcoatNormalMap:!!s.clearcoatNormalMap,displacementMap:!!s.displacementMap,roughnessMap:!!s.roughnessMap,metalnessMap:!!s.metalnessMap,specularMap:!!s.specularMap,alphaMap:!!s.alphaMap,gradientMap:!!s.gradientMap,sheen:!!s.sheen,transmissionMap:!!s.transmissionMap,combine:s.combine,vertexTangents:s.normalMap&&s.vertexTangents,vertexColors:s.vertexColors,vertexUvs:!!(s.map||s.bumpMap||s.normalMap||s.specularMap||s.alphaMap||s.emissiveMap||s.roughnessMap||s.metalnessMap||s.clearcoatMap||s.clearcoatRoughnessMap||s.clearcoatNormalMap||s.displacementMap||s.transmissionMap),uvsVertexOnly:!(s.map||s.bumpMap||s.normalMap||s.specularMap||s.alphaMap||s.emissiveMap||s.roughnessMap||s.metalnessMap||s.clearcoatNormalMap||s.transmissionMap||!s.displacementMap),fog:!!w,useFog:s.fog,fogExp2:w&&w.isFogExp2,flatShading:s.flatShading,sizeAttenuation:s.sizeAttenuation,logarithmicDepthBuffer:l,skinning:s.skinning&&M>0,maxBones:M,useVertexTexture:c,morphTargets:s.morphTargets,morphNormals:s.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:r.directional.length,numPointLights:r.point.length,numSpotLights:r.spot.length,numRectAreaLights:r.rectArea.length,numHemiLights:r.hemi.length,numDirLightShadows:r.directionalShadowMap.length,numPointLightShadows:r.pointShadowMap.length,numSpotLightShadows:r.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:s.dithering,shadowMapEnabled:e.shadowMap.enabled&&m.length>0,shadowMapType:e.shadowMap.type,toneMapping:s.toneMapped?e.toneMapping:Q,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:s.premultipliedAlpha,alphaTest:s.alphaTest,doubleSided:s.side===f,flipSided:s.side===g,depthPacking:void 0!==s.depthPacking&&s.depthPacking,index0AttributeName:s.index0AttributeName,extensionDerivatives:s.extensions&&s.extensions.derivatives,extensionFragDepth:s.extensions&&s.extensions.fragDepth,extensionDrawBuffers:s.extensions&&s.extensions.drawBuffers,extensionShaderTextureLOD:s.extensions&&s.extensions.shaderTextureLOD,rendererExtensionFragDepth:a||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:a||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:a||i.has("EXT_shader_texture_lod"),customProgramCacheKey:s.customProgramCacheKey()}},getProgramCacheKey:function(t){const i=[];if(t.shaderID?i.push(t.shaderID):(i.push(t.fragmentShader),i.push(t.vertexShader)),void 0!==t.defines)for(const e in t.defines)i.push(e),i.push(t.defines[e]);if(!1===t.isRawShaderMaterial){for(let e=0;e<m.length;e++)i.push(t[m[e]]);i.push(e.outputEncoding),i.push(e.gammaFactor)}return i.push(t.customProgramCacheKey),i.join()},getUniforms:function(e){const t=p[e.type];let i;if(t){const e=fo[t];i=eo.clone(e.uniforms)}else i=e.uniforms;return i},acquireProgram:function(t,i){let n;for(let e=0,t=r.length;e<t;e++){const t=r[e];if(t.cacheKey===i){n=t,++n.usedTimes;break}}return void 0===n&&(n=new qr(e,i,t,s),r.push(n)),n},releaseProgram:function(e){if(0==--e.usedTimes){const t=r.indexOf(e);r[t]=r[r.length-1],r.pop(),e.destroy()}},programs:r}}function Yr(){let e=new WeakMap;return{get:function(t){let i=e.get(t);return void 0===i&&(i={},e.set(t,i)),i},remove:function(t){e.delete(t)},update:function(t,i,n){e.get(t)[i]=n},dispose:function(){e=new WeakMap}}}function $r(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Xr(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Qr(e){const t=[];let i=0;const n=[],s=[],o={id:-1};function r(n,s,r,a,l,c){let h=t[i];const d=e.get(r);return void 0===h?(h={id:n.id,object:n,geometry:s,material:r,program:d.program||o,groupOrder:a,renderOrder:n.renderOrder,z:l,group:c},t[i]=h):(h.id=n.id,h.object=n,h.geometry=s,h.material=r,h.program=d.program||o,h.groupOrder=a,h.renderOrder=n.renderOrder,h.z=l,h.group=c),i++,h}return{opaque:n,transparent:s,init:function(){i=0,n.length=0,s.length=0},push:function(e,t,i,o,a,l){const c=r(e,t,i,o,a,l);(!0===i.transparent?s:n).push(c)},unshift:function(e,t,i,o,a,l){const c=r(e,t,i,o,a,l);(!0===i.transparent?s:n).unshift(c)},finish:function(){for(let e=i,n=t.length;e<n;e++){const i=t[e];if(null===i.id)break;i.id=null,i.object=null,i.geometry=null,i.material=null,i.program=null,i.group=null}},sort:function(e,t){n.length>1&&n.sort(e||$r),s.length>1&&s.sort(t||Xr)}}}function Jr(e){let t=new WeakMap;return{get:function(i,n){const s=t.get(i);let o;return void 0===s?(o=new Qr(e),t.set(i,new WeakMap),t.get(i).set(n,o)):(o=s.get(n),void 0===o&&(o=new Qr(e),s.set(n,o))),o},dispose:function(){t=new WeakMap}}}function ea(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let i;switch(t.type){case"DirectionalLight":i={direction:new Vector3,color:new Color};break;case"SpotLight":i={position:new Vector3,direction:new Vector3,color:new Color,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new Vector3,color:new Color,distance:0,decay:0};break;case"HemisphereLight":i={direction:new Vector3,skyColor:new Color,groundColor:new Color};break;case"RectAreaLight":i={color:new Color,position:new Vector3,halfWidth:new Vector3,halfHeight:new Vector3}}return e[t.id]=i,i}}}let ta=0;function ia(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function na(e,t){const i=new ea,n=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let i;switch(t.type){case"DirectionalLight":case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=i,i}}}(),s={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let e=0;e<9;e++)s.probe.push(new Vector3);const o=new Vector3,r=new Matrix4,a=new Matrix4;return{setup:function(o){let r=0,a=0,l=0;for(let e=0;e<9;e++)s.probe[e].set(0,0,0);let c=0,h=0,d=0,u=0,p=0,m=0,g=0,f=0;o.sort(ia);for(let e=0,t=o.length;e<t;e++){const t=o[e],v=t.color,y=t.intensity,b=t.distance,w=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)r+=v.r*y,a+=v.g*y,l+=v.b*y;else if(t.isLightProbe)for(let e=0;e<9;e++)s.probe[e].addScaledVector(t.sh.coefficients[e],y);else if(t.isDirectionalLight){const e=i.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity),t.castShadow){const e=t.shadow,i=n.get(t);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,s.directionalShadow[c]=i,s.directionalShadowMap[c]=w,s.directionalShadowMatrix[c]=t.shadow.matrix,m++}s.directional[c]=e,c++}else if(t.isSpotLight){const e=i.get(t);if(e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(v).multiplyScalar(y),e.distance=b,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,t.castShadow){const e=t.shadow,i=n.get(t);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,s.spotShadow[d]=i,s.spotShadowMap[d]=w,s.spotShadowMatrix[d]=t.shadow.matrix,f++}s.spot[d]=e,d++}else if(t.isRectAreaLight){const e=i.get(t);e.color.copy(v).multiplyScalar(y),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),s.rectArea[u]=e,u++}else if(t.isPointLight){const e=i.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,i=n.get(t);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,i.shadowCameraNear=e.camera.near,i.shadowCameraFar=e.camera.far,s.pointShadow[h]=i,s.pointShadowMap[h]=w,s.pointShadowMatrix[h]=t.shadow.matrix,g++}s.point[h]=e,h++}else if(t.isHemisphereLight){const e=i.get(t);e.skyColor.copy(t.color).multiplyScalar(y),e.groundColor.copy(t.groundColor).multiplyScalar(y),s.hemi[p]=e,p++}}u>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(s.rectAreaLTC1=go.LTC_FLOAT_1,s.rectAreaLTC2=go.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(s.rectAreaLTC1=go.LTC_HALF_1,s.rectAreaLTC2=go.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),s.ambient[0]=r,s.ambient[1]=a,s.ambient[2]=l;const v=s.hash;v.directionalLength===c&&v.pointLength===h&&v.spotLength===d&&v.rectAreaLength===u&&v.hemiLength===p&&v.numDirectionalShadows===m&&v.numPointShadows===g&&v.numSpotShadows===f||(s.directional.length=c,s.spot.length=d,s.rectArea.length=u,s.point.length=h,s.hemi.length=p,s.directionalShadow.length=m,s.directionalShadowMap.length=m,s.pointShadow.length=g,s.pointShadowMap.length=g,s.spotShadow.length=f,s.spotShadowMap.length=f,s.directionalShadowMatrix.length=m,s.pointShadowMatrix.length=g,s.spotShadowMatrix.length=f,v.directionalLength=c,v.pointLength=h,v.spotLength=d,v.rectAreaLength=u,v.hemiLength=p,v.numDirectionalShadows=m,v.numPointShadows=g,v.numSpotShadows=f,s.version=ta++)},setupView:function(e,t){let i=0,n=0,l=0,c=0,h=0;const d=t.matrixWorldInverse;for(let t=0,u=e.length;t<u;t++){const u=e[t];if(u.isDirectionalLight){const e=s.directional[i];e.direction.setFromMatrixPosition(u.matrixWorld),o.setFromMatrixPosition(u.target.matrixWorld),e.direction.sub(o),e.direction.transformDirection(d),i++}else if(u.isSpotLight){const e=s.spot[l];e.position.setFromMatrixPosition(u.matrixWorld),e.position.applyMatrix4(d),e.direction.setFromMatrixPosition(u.matrixWorld),o.setFromMatrixPosition(u.target.matrixWorld),e.direction.sub(o),e.direction.transformDirection(d),l++}else if(u.isRectAreaLight){const e=s.rectArea[c];e.position.setFromMatrixPosition(u.matrixWorld),e.position.applyMatrix4(d),a.identity(),r.copy(u.matrixWorld),r.premultiply(d),a.extractRotation(r),e.halfWidth.set(.5*u.width,0,0),e.halfHeight.set(0,.5*u.height,0),e.halfWidth.applyMatrix4(a),e.halfHeight.applyMatrix4(a),c++}else if(u.isPointLight){const e=s.point[n];e.position.setFromMatrixPosition(u.matrixWorld),e.position.applyMatrix4(d),n++}else if(u.isHemisphereLight){const e=s.hemi[h];e.direction.setFromMatrixPosition(u.matrixWorld),e.direction.transformDirection(d),e.direction.normalize(),h++}}},state:s}}function sa(e,t){const i=new na(e,t),n=[],s=[];return{init:function(){n.length=0,s.length=0},state:{lightsArray:n,shadowsArray:s,lights:i},setupLights:function(){i.setup(n)},setupLightsView:function(e){i.setupView(n,e)},pushLight:function(e){n.push(e)},pushShadow:function(e){s.push(e)}}}function oa(e,t){let i=new WeakMap;return{get:function(n,s=0){let o;return!1===i.has(n)?(o=new sa(e,t),i.set(n,[]),i.get(n).push(o)):s>=i.get(n).length?(o=new sa(e,t),i.get(n).push(o)):o=i.get(n)[s],o},dispose:function(){i=new WeakMap}}}function ra(e){rs.call(this),this.type="MeshDepthMaterial",this.depthPacking=si,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}function aa(e){rs.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Vector3,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}ra.prototype=Object.create(rs.prototype),ra.prototype.constructor=ra,ra.prototype.isMeshDepthMaterial=!0,ra.prototype.copy=function(e){return rs.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},aa.prototype=Object.create(rs.prototype),aa.prototype.constructor=aa,aa.prototype.isMeshDistanceMaterial=!0,aa.prototype.copy=function(e){return rs.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this};function la(e,t,i){let n=new Frustum;const s=new Vector2,o=new Vector2,r=new Vector4,a=[],l=[],c={},h={0:g,1:m,2:f},u=new to({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Vector2},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );\n\tfor ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean * HALF_SAMPLE_RATE;\n\tsquared_mean = squared_mean * HALF_SAMPLE_RATE;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),v=u.clone();v.defines.HORIZONTAL_PASS=1;const y=new Ds;y.setAttribute("position",new hs(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const w=new Ys(y,u),S=this;function E(i,n){const s=t.update(w);u.uniforms.shadow_pass.value=i.map.texture,u.uniforms.resolution.value=i.mapSize,u.uniforms.radius.value=i.radius,e.setRenderTarget(i.mapPass),e.clear(),e.renderBufferDirect(n,null,s,u,w,null),v.uniforms.shadow_pass.value=i.mapPass.texture,v.uniforms.resolution.value=i.mapSize,v.uniforms.radius.value=i.radius,e.setRenderTarget(i.map),e.clear(),e.renderBufferDirect(n,null,s,v,w,null)}function T(e,t,i){const n=e<<0|t<<1|i<<2;let s=a[n];return void 0===s&&(s=new ra({depthPacking:oi,morphTargets:e,skinning:t}),a[n]=s),s}function M(e,t,i){const n=e<<0|t<<1|i<<2;let s=l[n];return void 0===s&&(s=new aa({morphTargets:e,skinning:t}),l[n]=s),s}function _(t,i,n,s,o,r,a){let l=null,d=T,u=t.customDepthMaterial;if(!0===s.isPointLight&&(d=M,u=t.customDistanceMaterial),void 0===u){let e=!1;!0===n.morphTargets&&(e=i.morphAttributes&&i.morphAttributes.position&&i.morphAttributes.position.length>0);let s=!1;!0===t.isSkinnedMesh&&(!0===n.skinning?s=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t));l=d(e,s,!0===t.isInstancedMesh)}else l=u;if(e.localClippingEnabled&&!0===n.clipShadows&&0!==n.clippingPlanes.length){const e=l.uuid,t=n.uuid;let i=c[e];void 0===i&&(i={},c[e]=i);let s=i[t];void 0===s&&(s=l.clone(),i[t]=s),l=s}return l.visible=n.visible,l.wireframe=n.wireframe,l.side=a===p?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:h[n.side],l.clipShadows=n.clipShadows,l.clippingPlanes=n.clippingPlanes,l.clipIntersection=n.clipIntersection,l.wireframeLinewidth=n.wireframeLinewidth,l.linewidth=n.linewidth,!0===s.isPointLight&&!0===l.isMeshDistanceMaterial&&(l.referencePosition.setFromMatrixPosition(s.matrixWorld),l.nearDistance=o,l.farDistance=r),l}function x(i,s,o,r,a){if(!1===i.visible)return;if(i.layers.test(s.layers)&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&a===p)&&(!i.frustumCulled||n.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,i.matrixWorld);const n=t.update(i),s=i.material;if(Array.isArray(s)){const t=n.groups;for(let l=0,c=t.length;l<c;l++){const c=t[l],h=s[c.materialIndex];if(h&&h.visible){const t=_(i,n,h,r,o.near,o.far,a);e.renderBufferDirect(o,null,n,t,i,c)}}}else if(s.visible){const t=_(i,n,s,r,o.near,o.far,a);e.renderBufferDirect(o,null,n,t,i,null)}}const l=i.children;for(let e=0,t=l.length;e<t;e++)x(l[e],s,o,r,a)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=d,this.render=function(t,a,l){if(!1===S.enabled)return;if(!1===S.autoUpdate&&!1===S.needsUpdate)return;if(0===t.length)return;const c=e.getRenderTarget(),h=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),u=e.state;u.setBlending(b),u.buffers.color.setClear(1,1,1,1),u.buffers.depth.setTest(!0),u.setScissorTest(!1);for(let c=0,h=t.length;c<h;c++){const h=t[c],d=h.shadow;if(void 0===d){console.warn("THREE.WebGLShadowMap:",h,"has no shadow.");continue}if(!1===d.autoUpdate&&!1===d.needsUpdate)continue;s.copy(d.mapSize);const m=d.getFrameExtents();if(s.multiply(m),o.copy(d.mapSize),(s.x>i||s.y>i)&&(s.x>i&&(o.x=Math.floor(i/m.x),s.x=o.x*m.x,d.mapSize.x=o.x),s.y>i&&(o.y=Math.floor(i/m.y),s.y=o.y*m.y,d.mapSize.y=o.y)),null===d.map&&!d.isPointLightShadow&&this.type===p){const e={minFilter:be,magFilter:be,format:Fe};d.map=new ji(s.x,s.y,e),d.map.texture.name=h.name+".shadowMap",d.mapPass=new ji(s.x,s.y,e),d.camera.updateProjectionMatrix()}if(null===d.map){const e={minFilter:me,magFilter:me,format:Fe};d.map=new ji(s.x,s.y,e),d.map.texture.name=h.name+".shadowMap",d.camera.updateProjectionMatrix()}e.setRenderTarget(d.map),e.clear();const g=d.getViewportCount();for(let e=0;e<g;e++){const t=d.getViewport(e);r.set(o.x*t.x,o.y*t.y,o.x*t.z,o.y*t.w),u.viewport(r),d.updateMatrices(h,e),n=d.getFrustum(),x(a,l,d.camera,h,this.type)}d.isPointLightShadow||this.type!==p||E(d,l),d.needsUpdate=!1}S.needsUpdate=!1,e.setRenderTarget(c,h,d)}}function ca(e,t,i){const n=i.isWebGL2;const s=new function(){let t=!1;const i=new Vector4;let n=null;const s=new Vector4(0,0,0,0);return{setMask:function(i){n===i||t||(e.colorMask(i,i,i,i),n=i)},setLocked:function(e){t=e},setClear:function(t,n,o,r,a){!0===a&&(t*=r,n*=r,o*=r),i.set(t,n,o,r),!1===s.equals(i)&&(e.clearColor(t,n,o,r),s.copy(i))},reset:function(){t=!1,n=null,s.set(-1,0,0,0)}}},o=new function(){let t=!1,i=null,n=null,s=null;return{setTest:function(e){e?me(2929):ge(2929)},setMask:function(n){i===n||t||(e.depthMask(n),i=n)},setFunc:function(t){if(n!==t){if(t)switch(t){case H:e.depthFunc(512);break;case G:e.depthFunc(519);break;case z:e.depthFunc(513);break;case j:e.depthFunc(515);break;case W:e.depthFunc(514);break;case Z:e.depthFunc(518);break;case q:e.depthFunc(516);break;case K:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);n=t}},setLocked:function(e){t=e},setClear:function(t){s!==t&&(e.clearDepth(t),s=t)},reset:function(){t=!1,i=null,n=null,s=null}}},c=new function(){let t=!1,i=null,n=null,s=null,o=null,r=null,a=null,l=null,c=null;return{setTest:function(e){t||(e?me(2960):ge(2960))},setMask:function(n){i===n||t||(e.stencilMask(n),i=n)},setFunc:function(t,i,r){n===t&&s===i&&o===r||(e.stencilFunc(t,i,r),n=t,s=i,o=r)},setOp:function(t,i,n){r===t&&a===i&&l===n||(e.stencilOp(t,i,n),r=t,a=i,l=n)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,i=null,n=null,s=null,o=null,r=null,a=null,l=null,c=null}}};let h={},d=null,u=null,p=null,m=null,v=null,y=null,Y=null,$=null,X=null,Q=!1,J=null,ee=null,te=null,ie=null,ne=null;const se=e.getParameter(35661);let oe=!1,re=0;const ae=e.getParameter(7938);-1!==ae.indexOf("WebGL")?(re=parseFloat(/^WebGL (\d)/.exec(ae)[1]),oe=re>=1):-1!==ae.indexOf("OpenGL ES")&&(re=parseFloat(/^OpenGL ES (\d)/.exec(ae)[1]),oe=re>=2);let le=null,ce={};const he=new Vector4,de=new Vector4;function ue(t,i,n){const s=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(let t=0;t<n;t++)e.texImage2D(i+t,0,6408,1,1,0,6408,5121,s);return o}const pe={};function me(t){!0!==h[t]&&(e.enable(t),h[t]=!0)}function ge(t){!1!==h[t]&&(e.disable(t),h[t]=!1)}pe[3553]=ue(3553,3553,1),pe[34067]=ue(34067,34069,6),s.setClear(0,0,0,1),o.setClear(1),c.setClear(0),me(2929),o.setFunc(j),be(!1),we(a),me(2884),ye(b);const fe={[_]:32774,[x]:32778,[A]:32779};if(n)fe[O]=32775,fe[P]=32776;else{const e=t.get("EXT_blend_minmax");null!==e&&(fe[O]=e.MIN_EXT,fe[P]=e.MAX_EXT)}const ve={[C]:0,[D]:1,[I]:768,[L]:770,[V]:776,[F]:774,[k]:772,[R]:769,[N]:771,[U]:775,[B]:773};function ye(t,i,n,s,o,r,a,l){if(t!==b){if(u||(me(3042),u=!0),t===M)o=o||i,r=r||n,a=a||s,i===m&&o===Y||(e.blendEquationSeparate(fe[i],fe[o]),m=i,Y=o),n===v&&s===y&&r===$&&a===X||(e.blendFuncSeparate(ve[n],ve[s],ve[r],ve[a]),v=n,y=s,$=r,X=a),p=t,Q=null;else if(t!==p||l!==Q){if(m===_&&Y===_||(e.blendEquation(32774),m=_,Y=_),l)switch(t){case w:e.blendFuncSeparate(1,771,1,771);break;case S:e.blendFunc(1,1);break;case E:e.blendFuncSeparate(0,0,769,771);break;case T:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case w:e.blendFuncSeparate(770,771,1,771);break;case S:e.blendFunc(770,1);break;case E:e.blendFunc(0,769);break;case T:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}v=null,y=null,$=null,X=null,p=t,Q=l}}else u&&(ge(3042),u=!1)}function be(t){J!==t&&(t?e.frontFace(2304):e.frontFace(2305),J=t)}function we(t){t!==r?(me(2884),t!==ee&&(t===a?e.cullFace(1029):t===l?e.cullFace(1028):e.cullFace(1032))):ge(2884),ee=t}function Se(t,i,n){t?(me(32823),ie===i&&ne===n||(e.polygonOffset(i,n),ie=i,ne=n)):ge(32823)}function Ee(t){void 0===t&&(t=33984+se-1),le!==t&&(e.activeTexture(t),le=t)}return{buffers:{color:s,depth:o,stencil:c},enable:me,disable:ge,useProgram:function(t){return d!==t&&(e.useProgram(t),d=t,!0)},setBlending:ye,setMaterial:function(e,t){e.side===f?ge(2884):me(2884);let i=e.side===g;t&&(i=!i),be(i),e.blending===w&&!1===e.transparent?ye(b):ye(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),o.setFunc(e.depthFunc),o.setTest(e.depthTest),o.setMask(e.depthWrite),s.setMask(e.colorWrite);const n=e.stencilWrite;c.setTest(n),n&&(c.setMask(e.stencilWriteMask),c.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),c.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),Se(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)},setFlipSided:be,setCullFace:we,setLineWidth:function(t){t!==te&&(oe&&e.lineWidth(t),te=t)},setPolygonOffset:Se,setScissorTest:function(e){e?me(3089):ge(3089)},activeTexture:Ee,bindTexture:function(t,i){null===le&&Ee();let n=ce[le];void 0===n&&(n={type:void 0,texture:void 0},ce[le]=n),n.type===t&&n.texture===i||(e.bindTexture(t,i||pe[t]),n.type=t,n.texture=i)},unbindTexture:function(){const t=ce[le];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===he.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),he.copy(t))},viewport:function(t){!1===de.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),de.copy(t))},reset:function(){h={},le=null,ce={},d=null,u=null,p=null,m=null,v=null,y=null,Y=null,$=null,X=null,Q=!1,J=null,ee=null,te=null,ie=null,ne=null,s.reset(),o.reset(),c.reset()}}}function ha(e,t,i,n,s,o,r){const a=s.isWebGL2,l=s.maxTextures,c=s.maxCubemapSize,h=s.maxTextureSize,d=s.maxSamples,u=new WeakMap;let p,m=!1;try{m="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function g(e,t){return m?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function f(e,t,i,n){let s=1;if((e.width>n||e.height>n)&&(s=n/Math.max(e.width,e.height)),s<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const n=t?Fi.floorPowerOfTwo:Math.floor,o=n(s*e.width),r=n(s*e.height);void 0===p&&(p=g(o,r));const a=i?g(o,r):p;a.width=o,a.height=r;return a.getContext("2d").drawImage(e,0,0,o,r),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+o+"x"+r+")."),a}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function v(e){return Fi.isPowerOfTwo(e.width)&&Fi.isPowerOfTwo(e.height)}function y(e,t){return e.generateMipmaps&&t&&e.minFilter!==me&&e.minFilter!==be}function b(t,i,s,o){e.generateMipmap(t);n.get(i).__maxMipLevel=Math.log(Math.max(s,o))*Math.LOG2E}function w(i,n,s){if(!1===a)return n;if(null!==i){if(void 0!==e[i])return e[i];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+i+"'")}let o=n;return 6403===n&&(5126===s&&(o=33326),5131===s&&(o=33325),5121===s&&(o=33321)),6407===n&&(5126===s&&(o=34837),5131===s&&(o=34843),5121===s&&(o=32849)),6408===n&&(5126===s&&(o=34836),5131===s&&(o=34842),5121===s&&(o=32856)),33325!==o&&33326!==o&&34842!==o&&34836!==o||t.get("EXT_color_buffer_float"),o}function S(e){return e===me||e===ge||e===ve?9728:9729}function E(t){const i=t.target;i.removeEventListener("dispose",E),function(t){const i=n.get(t);if(void 0===i.__webglInit)return;e.deleteTexture(i.__webglTexture),n.remove(t)}(i),i.isVideoTexture&&u.delete(i),r.memory.textures--}function T(t){const i=t.target;i.removeEventListener("dispose",T),function(t){const i=n.get(t),s=n.get(t.texture);if(!t)return;void 0!==s.__webglTexture&&e.deleteTexture(s.__webglTexture);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++)e.deleteFramebuffer(i.__webglFramebuffer[t]),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer[t]);else e.deleteFramebuffer(i.__webglFramebuffer),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer),i.__webglMultisampledFramebuffer&&e.deleteFramebuffer(i.__webglMultisampledFramebuffer),i.__webglColorRenderbuffer&&e.deleteRenderbuffer(i.__webglColorRenderbuffer),i.__webglDepthRenderbuffer&&e.deleteRenderbuffer(i.__webglDepthRenderbuffer);n.remove(t.texture),n.remove(t)}(i),r.memory.textures--}let M=0;function _(e,t){const s=n.get(e);if(e.isVideoTexture&&function(e){const t=r.render.frame;u.get(e)!==t&&(u.set(e,t),e.update())}(e),e.version>0&&s.__version!==e.version){const i=e.image;if(void 0===i)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==i.complete)return void D(s,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}i.activeTexture(33984+t),i.bindTexture(3553,s.__webglTexture)}function x(t,s){const r=n.get(t);t.version>0&&r.__version!==t.version?function(t,n,s){if(6!==n.image.length)return;C(t,n),i.activeTexture(33984+s),i.bindTexture(34067,t.__webglTexture),e.pixelStorei(37440,n.flipY);const r=n&&(n.isCompressedTexture||n.image[0].isCompressedTexture),l=n.image[0]&&n.image[0].isDataTexture,h=[];for(let e=0;e<6;e++)h[e]=r||l?l?n.image[e].image:n.image[e]:f(n.image[e],!1,!0,c);const d=h[0],u=v(d)||a,p=o.convert(n.format),m=o.convert(n.type),g=w(n.internalFormat,p,m);let S;if(P(34067,n,u),r){for(let e=0;e<6;e++){S=h[e].mipmaps;for(let t=0;t<S.length;t++){const s=S[t];n.format!==Fe&&n.format!==Be?null!==p?i.compressedTexImage2D(34069+e,t,g,s.width,s.height,0,s.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):i.texImage2D(34069+e,t,g,s.width,s.height,0,p,m,s.data)}}t.__maxMipLevel=S.length-1}else{S=n.mipmaps;for(let e=0;e<6;e++)if(l){i.texImage2D(34069+e,0,g,h[e].width,h[e].height,0,p,m,h[e].data);for(let t=0;t<S.length;t++){const n=S[t].image[e].image;i.texImage2D(34069+e,t+1,g,n.width,n.height,0,p,m,n.data)}}else{i.texImage2D(34069+e,0,g,p,m,h[e]);for(let t=0;t<S.length;t++){const n=S[t];i.texImage2D(34069+e,t+1,g,p,m,n.image[e])}}t.__maxMipLevel=S.length}y(n,u)&&b(34067,n,d.width,d.height);t.__version=n.version,n.onUpdate&&n.onUpdate(n)}(r,t,s):(i.activeTexture(33984+s),i.bindTexture(34067,r.__webglTexture))}const A={[de]:10497,[ue]:33071,[pe]:33648},O={[me]:9728,[ge]:9984,[ve]:9986,[be]:9729,[we]:9985,[Ee]:9987};function P(i,o,r){r?(e.texParameteri(i,10242,A[o.wrapS]),e.texParameteri(i,10243,A[o.wrapT]),32879!==i&&35866!==i||e.texParameteri(i,32882,A[o.wrapR]),e.texParameteri(i,10240,O[o.magFilter]),e.texParameteri(i,10241,O[o.minFilter])):(e.texParameteri(i,10242,33071),e.texParameteri(i,10243,33071),32879!==i&&35866!==i||e.texParameteri(i,32882,33071),o.wrapS===ue&&o.wrapT===ue||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(i,10240,S(o.magFilter)),e.texParameteri(i,10241,S(o.minFilter)),o.minFilter!==me&&o.minFilter!==be&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));const l=t.get("EXT_texture_filter_anisotropic");if(l){if(o.type===Ce&&null===t.get("OES_texture_float_linear"))return;if(o.type===De&&null===(a||t.get("OES_texture_half_float_linear")))return;(o.anisotropy>1||n.get(o).__currentAnisotropy)&&(e.texParameterf(i,l.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,s.getMaxAnisotropy())),n.get(o).__currentAnisotropy=o.anisotropy)}}function C(t,i){void 0===t.__webglInit&&(t.__webglInit=!0,i.addEventListener("dispose",E),t.__webglTexture=e.createTexture(),r.memory.textures++)}function D(t,n,s){let r=3553;n.isDataTexture2DArray&&(r=35866),n.isDataTexture3D&&(r=32879),C(t,n),i.activeTexture(33984+s),i.bindTexture(r,t.__webglTexture),e.pixelStorei(37440,n.flipY),e.pixelStorei(37441,n.premultiplyAlpha),e.pixelStorei(3317,n.unpackAlignment);const l=function(e){return!a&&(e.wrapS!==ue||e.wrapT!==ue||e.minFilter!==me&&e.minFilter!==be)}(n)&&!1===v(n.image),c=f(n.image,l,!1,h),d=v(c)||a,u=o.convert(n.format);let p,m=o.convert(n.type),g=w(n.internalFormat,u,m);P(r,n,d);const S=n.mipmaps;if(n.isDepthTexture)g=6402,a?g=n.type===Ce?36012:n.type===Pe?33190:n.type===Ne?35056:33189:n.type===Ce&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),n.format===Ge&&6402===g&&n.type!==Ae&&n.type!==Pe&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),n.type=Ae,m=o.convert(n.type)),n.format===ze&&6402===g&&(g=34041,n.type!==Ne&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),n.type=Ne,m=o.convert(n.type))),i.texImage2D(3553,0,g,c.width,c.height,0,u,m,null);else if(n.isDataTexture)if(S.length>0&&d){for(let e=0,t=S.length;e<t;e++)p=S[e],i.texImage2D(3553,e,g,p.width,p.height,0,u,m,p.data);n.generateMipmaps=!1,t.__maxMipLevel=S.length-1}else i.texImage2D(3553,0,g,c.width,c.height,0,u,m,c.data),t.__maxMipLevel=0;else if(n.isCompressedTexture){for(let e=0,t=S.length;e<t;e++)p=S[e],n.format!==Fe&&n.format!==Be?null!==u?i.compressedTexImage2D(3553,e,g,p.width,p.height,0,p.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):i.texImage2D(3553,e,g,p.width,p.height,0,u,m,p.data);t.__maxMipLevel=S.length-1}else if(n.isDataTexture2DArray)i.texImage3D(35866,0,g,c.width,c.height,c.depth,0,u,m,c.data),t.__maxMipLevel=0;else if(n.isDataTexture3D)i.texImage3D(32879,0,g,c.width,c.height,c.depth,0,u,m,c.data),t.__maxMipLevel=0;else if(S.length>0&&d){for(let e=0,t=S.length;e<t;e++)p=S[e],i.texImage2D(3553,e,g,u,m,p);n.generateMipmaps=!1,t.__maxMipLevel=S.length-1}else i.texImage2D(3553,0,g,u,m,c),t.__maxMipLevel=0;y(n,d)&&b(r,n,c.width,c.height),t.__version=n.version,n.onUpdate&&n.onUpdate(n)}function I(t,s,r,a){const l=o.convert(s.texture.format),c=o.convert(s.texture.type),h=w(s.texture.internalFormat,l,c);i.texImage2D(a,0,h,s.width,s.height,0,l,c,null),e.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,r,a,n.get(s.texture).__webglTexture,0),e.bindFramebuffer(36160,null)}function R(t,i,n){if(e.bindRenderbuffer(36161,t),i.depthBuffer&&!i.stencilBuffer){let s=33189;if(n){const t=i.depthTexture;t&&t.isDepthTexture&&(t.type===Ce?s=36012:t.type===Pe&&(s=33190));const n=N(i);e.renderbufferStorageMultisample(36161,n,s,i.width,i.height)}else e.renderbufferStorage(36161,s,i.width,i.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(i.depthBuffer&&i.stencilBuffer){if(n){const t=N(i);e.renderbufferStorageMultisample(36161,t,35056,i.width,i.height)}else e.renderbufferStorage(36161,34041,i.width,i.height);e.framebufferRenderbuffer(36160,33306,36161,t)}else{const t=o.convert(i.texture.format),s=o.convert(i.texture.type),r=w(i.texture.internalFormat,t,s);if(n){const t=N(i);e.renderbufferStorageMultisample(36161,t,r,i.width,i.height)}else e.renderbufferStorage(36161,r,i.width,i.height)}e.bindRenderbuffer(36161,null)}function L(t){const i=n.get(t),s=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,i){if(i&&i.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,t),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),_(i.depthTexture,0);const s=n.get(i.depthTexture).__webglTexture;if(i.depthTexture.format===Ge)e.framebufferTexture2D(36160,36096,3553,s,0);else{if(i.depthTexture.format!==ze)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,s,0)}}(i.__webglFramebuffer,t)}else if(s){i.__webglDepthbuffer=[];for(let n=0;n<6;n++)e.bindFramebuffer(36160,i.__webglFramebuffer[n]),i.__webglDepthbuffer[n]=e.createRenderbuffer(),R(i.__webglDepthbuffer[n],t,!1)}else e.bindFramebuffer(36160,i.__webglFramebuffer),i.__webglDepthbuffer=e.createRenderbuffer(),R(i.__webglDepthbuffer,t,!1);e.bindFramebuffer(36160,null)}function N(e){return a&&e.isWebGLMultisampleRenderTarget?Math.min(d,e.samples):0}let k=!1,B=!1;this.allocateTextureUnit=function(){const e=M;return e>=l&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+l),M+=1,e},this.resetTextureUnits=function(){M=0},this.setTexture2D=_,this.setTexture2DArray=function(e,t){const s=n.get(e);e.version>0&&s.__version!==e.version?D(s,e,t):(i.activeTexture(33984+t),i.bindTexture(35866,s.__webglTexture))},this.setTexture3D=function(e,t){const s=n.get(e);e.version>0&&s.__version!==e.version?D(s,e,t):(i.activeTexture(33984+t),i.bindTexture(32879,s.__webglTexture))},this.setTextureCube=x,this.setupRenderTarget=function(t){const s=n.get(t),l=n.get(t.texture);t.addEventListener("dispose",T),l.__webglTexture=e.createTexture(),r.memory.textures++;const c=!0===t.isWebGLCubeRenderTarget,h=!0===t.isWebGLMultisampleRenderTarget,d=v(t)||a;if(!a||t.texture.format!==Be||t.texture.type!==Ce&&t.texture.type!==De||(t.texture.format=Fe,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),c){s.__webglFramebuffer=[];for(let t=0;t<6;t++)s.__webglFramebuffer[t]=e.createFramebuffer()}else if(s.__webglFramebuffer=e.createFramebuffer(),h)if(a){s.__webglMultisampledFramebuffer=e.createFramebuffer(),s.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,s.__webglColorRenderbuffer);const i=o.convert(t.texture.format),n=o.convert(t.texture.type),r=w(t.texture.internalFormat,i,n),a=N(t);e.renderbufferStorageMultisample(36161,a,r,t.width,t.height),e.bindFramebuffer(36160,s.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,s.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),t.depthBuffer&&(s.__webglDepthRenderbuffer=e.createRenderbuffer(),R(s.__webglDepthRenderbuffer,t,!0)),e.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(c){i.bindTexture(34067,l.__webglTexture),P(34067,t.texture,d);for(let e=0;e<6;e++)I(s.__webglFramebuffer[e],t,36064,34069+e);y(t.texture,d)&&b(34067,t.texture,t.width,t.height),i.bindTexture(34067,null)}else i.bindTexture(3553,l.__webglTexture),P(3553,t.texture,d),I(s.__webglFramebuffer,t,36064,3553),y(t.texture,d)&&b(3553,t.texture,t.width,t.height),i.bindTexture(3553,null);t.depthBuffer&&L(t)},this.updateRenderTargetMipmap=function(e){const t=e.texture;if(y(t,v(e)||a)){const s=e.isWebGLCubeRenderTarget?34067:3553,o=n.get(t).__webglTexture;i.bindTexture(s,o),b(s,t,e.width,e.height),i.bindTexture(s,null)}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(a){const i=n.get(t);e.bindFramebuffer(36008,i.__webglMultisampledFramebuffer),e.bindFramebuffer(36009,i.__webglFramebuffer);const s=t.width,o=t.height;let r=16384;t.depthBuffer&&(r|=256),t.stencilBuffer&&(r|=1024),e.blitFramebuffer(0,0,s,o,0,0,s,o,r,9728),e.bindFramebuffer(36160,i.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===k&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),k=!0),e=e.texture),_(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===B&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),B=!0),e=e.texture),x(e,t)}}function da(e,t,i){const n=i.isWebGL2;return{convert:function(e){let i;if(e===Me)return 5121;if(e===Ie)return 32819;if(e===Re)return 32820;if(e===Le)return 33635;if(e===_e)return 5120;if(e===xe)return 5122;if(e===Ae)return 5123;if(e===Oe)return 5124;if(e===Pe)return 5125;if(e===Ce)return 5126;if(e===De)return n?5131:(i=t.get("OES_texture_half_float"),null!==i?i.HALF_FLOAT_OES:null);if(e===ke)return 6406;if(e===Be)return 6407;if(e===Fe)return 6408;if(e===Ue)return 6409;if(e===Ve)return 6410;if(e===Ge)return 6402;if(e===ze)return 34041;if(e===je)return 6403;if(e===We)return 36244;if(e===Ze)return 33319;if(e===qe)return 33320;if(e===Ke)return 36248;if(e===Ye)return 36249;if(e===$e||e===Xe||e===Qe||e===Je){if(i=t.get("WEBGL_compressed_texture_s3tc"),null===i)return null;if(e===$e)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===Xe)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===Qe)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===Je)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(e===et||e===tt||e===it||e===nt){if(i=t.get("WEBGL_compressed_texture_pvrtc"),null===i)return null;if(e===et)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===tt)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===it)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===nt)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===st)return i=t.get("WEBGL_compressed_texture_etc1"),null!==i?i.COMPRESSED_RGB_ETC1_WEBGL:null;if((e===ot||e===rt)&&(i=t.get("WEBGL_compressed_texture_etc"),null!==i)){if(e===ot)return i.COMPRESSED_RGB8_ETC2;if(e===rt)return i.COMPRESSED_RGBA8_ETC2_EAC}return e===at||e===lt||e===ct||e===ht||e===dt||e===ut||e===pt||e===mt||e===gt||e===ft||e===vt||e===yt||e===bt||e===wt||e===Et||e===Tt||e===Mt||e===_t||e===xt||e===At||e===Ot||e===Pt||e===Ct||e===Dt||e===It||e===Rt||e===Lt||e===Nt?(i=t.get("WEBGL_compressed_texture_astc"),null!==i?e:null):e===St?(i=t.get("EXT_texture_compression_bptc"),null!==i?e:null):e===Ne?n?34042:(i=t.get("WEBGL_depth_texture"),null!==i?i.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}function ua(e=[]){no.call(this),this.cameras=e}function pa(){Un.call(this),this.type="Group"}function ma(){this._targetRay=null,this._grip=null,this._hand=null}function ga(e,t){const i=this;let n=null,s=1,o=null,r="local-floor",a=null;const l=[],c=new Map,h=new no;h.layers.enable(1),h.viewport=new Vector4;const d=new no;d.layers.enable(2),d.viewport=new Vector4;const u=[h,d],p=new ua;p.layers.enable(1),p.layers.enable(2);let m=null,g=null;function f(e){const t=c.get(e.inputSource);t&&t.dispatchEvent({type:e.type,data:e.inputSource})}function v(){c.forEach((function(e,t){e.disconnect(t)})),c.clear(),e.setFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),M.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function y(e){o=e,M.setContext(n),M.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}function b(e){const t=n.inputSources;for(let e=0;e<l.length;e++)c.set(t[e],l[e]);for(let t=0;t<e.removed.length;t++){const i=e.removed[t],n=c.get(i);n&&(n.dispatchEvent({type:"disconnected",data:i}),c.delete(i))}for(let t=0;t<e.added.length;t++){const i=e.added[t],n=c.get(i);n&&n.dispatchEvent({type:"connected",data:i})}}this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=l[e];return void 0===t&&(t=new ma,l[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=l[e];return void 0===t&&(t=new ma,l[e]=t),t.getGripSpace()},this.getHand=function(e){let t=l[e];return void 0===t&&(t=new ma,l[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){s=e,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){r=e,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o},this.getSession=function(){return n},this.setSession=function(e){if(n=e,null!==n){n.addEventListener("select",f),n.addEventListener("selectstart",f),n.addEventListener("selectend",f),n.addEventListener("squeeze",f),n.addEventListener("squeezestart",f),n.addEventListener("squeezeend",f),n.addEventListener("end",v);const e=t.getContextAttributes();!0!==e.xrCompatible&&t.makeXRCompatible();const i={antialias:e.antialias,alpha:e.alpha,depth:e.depth,stencil:e.stencil,framebufferScaleFactor:s},o=new XRWebGLLayer(n,t,i);n.updateRenderState({baseLayer:o}),n.requestReferenceSpace(r).then(y),n.addEventListener("inputsourceschange",b)}};const w=new Vector3,S=new Vector3;function E(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.getCamera=function(e){p.near=d.near=h.near=e.near,p.far=d.far=h.far=e.far,m===p.near&&g===p.far||(n.updateRenderState({depthNear:p.near,depthFar:p.far}),m=p.near,g=p.far);const t=e.parent,i=p.cameras;E(p,t);for(let e=0;e<i.length;e++)E(i[e],t);e.matrixWorld.copy(p.matrixWorld);const s=e.children;for(let e=0,t=s.length;e<t;e++)s[e].updateMatrixWorld(!0);return 2===i.length?function(e,t,i){w.setFromMatrixPosition(t.matrixWorld),S.setFromMatrixPosition(i.matrixWorld);const n=w.distanceTo(S),s=t.projectionMatrix.elements,o=i.projectionMatrix.elements,r=s[14]/(s[10]-1),a=s[14]/(s[10]+1),l=(s[9]+1)/s[5],c=(s[9]-1)/s[5],h=(s[8]-1)/s[0],d=(o[8]+1)/o[0],u=r*h,p=r*d,m=n/(-h+d),g=m*-h;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(g),e.translateZ(m),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const f=r+m,v=a+m,y=u-g,b=p+(n-g),E=l*a/v*f,T=c*a/v*f;e.projectionMatrix.makePerspective(y,b,E,T,f,v)}(p,h,d):p.projectionMatrix.copy(h.projectionMatrix),p};let T=null;const M=new uo;M.setAnimationLoop((function(t,i){if(a=i.getViewerPose(o),null!==a){const t=a.views,i=n.renderState.baseLayer;e.setFramebuffer(i.framebuffer);let s=!1;t.length!==p.cameras.length&&(p.cameras.length=0,s=!0);for(let e=0;e<t.length;e++){const n=t[e],o=i.getViewport(n),r=u[e];r.matrix.fromArray(n.transform.matrix),r.projectionMatrix.fromArray(n.projectionMatrix),r.viewport.set(o.x,o.y,o.width,o.height),0===e&&p.matrix.copy(r.matrix),!0===s&&p.cameras.push(r)}}const s=n.inputSources;for(let e=0;e<l.length;e++){const t=l[e],n=s[e];t.update(n,i,o)}T&&T(t,i)})),this.setAnimationLoop=function(e){T=e},this.dispose=function(){}}function fa(e){function t(t,i){t.opacity.value=i.opacity,i.color&&t.diffuse.value.copy(i.color),i.emissive&&t.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(t.map.value=i.map),i.alphaMap&&(t.alphaMap.value=i.alphaMap),i.specularMap&&(t.specularMap.value=i.specularMap);const n=e.get(i).envMap;if(n){t.envMap.value=n,t.flipEnvMap.value=n.isCubeTexture&&n._needsFlipEnvMap?-1:1,t.reflectivity.value=i.reflectivity,t.refractionRatio.value=i.refractionRatio;const s=e.get(n).__maxMipLevel;void 0!==s&&(t.maxMipLevel.value=s)}let s,o;i.lightMap&&(t.lightMap.value=i.lightMap,t.lightMapIntensity.value=i.lightMapIntensity),i.aoMap&&(t.aoMap.value=i.aoMap,t.aoMapIntensity.value=i.aoMapIntensity),i.map?s=i.map:i.specularMap?s=i.specularMap:i.displacementMap?s=i.displacementMap:i.normalMap?s=i.normalMap:i.bumpMap?s=i.bumpMap:i.roughnessMap?s=i.roughnessMap:i.metalnessMap?s=i.metalnessMap:i.alphaMap?s=i.alphaMap:i.emissiveMap?s=i.emissiveMap:i.clearcoatMap?s=i.clearcoatMap:i.clearcoatNormalMap?s=i.clearcoatNormalMap:i.clearcoatRoughnessMap&&(s=i.clearcoatRoughnessMap),void 0!==s&&(s.isWebGLRenderTarget&&(s=s.texture),!0===s.matrixAutoUpdate&&s.updateMatrix(),t.uvTransform.value.copy(s.matrix)),i.aoMap?o=i.aoMap:i.lightMap&&(o=i.lightMap),void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),t.uv2Transform.value.copy(o.matrix))}function i(t,i){t.roughness.value=i.roughness,t.metalness.value=i.metalness,i.roughnessMap&&(t.roughnessMap.value=i.roughnessMap),i.metalnessMap&&(t.metalnessMap.value=i.metalnessMap),i.emissiveMap&&(t.emissiveMap.value=i.emissiveMap),i.bumpMap&&(t.bumpMap.value=i.bumpMap,t.bumpScale.value=i.bumpScale,i.side===g&&(t.bumpScale.value*=-1)),i.normalMap&&(t.normalMap.value=i.normalMap,t.normalScale.value.copy(i.normalScale),i.side===g&&t.normalScale.value.negate()),i.displacementMap&&(t.displacementMap.value=i.displacementMap,t.displacementScale.value=i.displacementScale,t.displacementBias.value=i.displacementBias);e.get(i).envMap&&(t.envMapIntensity.value=i.envMapIntensity)}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,n,s,o){n.isMeshBasicMaterial?t(e,n):n.isMeshLambertMaterial?(t(e,n),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(e,n)):n.isMeshToonMaterial?(t(e,n),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap);t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===g&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===g&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,n)):n.isMeshPhongMaterial?(t(e,n),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===g&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===g&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,n)):n.isMeshStandardMaterial?(t(e,n),n.isMeshPhysicalMaterial?function(e,t){i(e,t),e.reflectivity.value=t.reflectivity,e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.sheen&&e.sheen.value.copy(t.sheen);t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap);t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap);t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===g&&e.clearcoatNormalScale.value.negate());e.transmission.value=t.transmission,t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap)}(e,n):i(e,n)):n.isMeshMatcapMaterial?(t(e,n),function(e,t){t.matcap&&(e.matcap.value=t.matcap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===g&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===g&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,n)):n.isMeshDepthMaterial?(t(e,n),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,n)):n.isMeshDistanceMaterial?(t(e,n),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,n)):n.isMeshNormalMaterial?(t(e,n),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===g&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===g&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,n)):n.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,n),n.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,n)):n.isPointsMaterial?function(e,t,i,n){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*i,e.scale.value=.5*n,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);let s;t.map?s=t.map:t.alphaMap&&(s=t.alphaMap);void 0!==s&&(!0===s.matrixAutoUpdate&&s.updateMatrix(),e.uvTransform.value.copy(s.matrix))}(e,n,s,o):n.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);let i;t.map?i=t.map:t.alphaMap&&(i=t.alphaMap);void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix))}(e,n):n.isShadowMaterial?(e.color.value.copy(n.color),e.opacity.value=n.opacity):n.isShaderMaterial&&(n.uniformsNeedUpdate=!1)}}}function va(e){const t=void 0!==(e=e||{}).canvas?e.canvas:function(){const e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return e.style.display="block",e}(),i=void 0!==e.context?e.context:null,n=void 0!==e.alpha&&e.alpha,s=void 0===e.depth||e.depth,o=void 0===e.stencil||e.stencil,r=void 0!==e.antialias&&e.antialias,a=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=void 0!==e.powerPreference?e.powerPreference:"default",h=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;let d=null,u=null;const p=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=$t,this.physicallyCorrectLights=!1,this.toneMapping=Q,this.toneMappingExposure=1,this.maxMorphTargets=8,this.maxMorphNormals=4;const m=this;let g=!1,f=null,v=0,y=0,b=null,w=null,S=-1,E=null;const T=new Vector4,M=new Vector4;let _=null,x=t.width,A=t.height,O=1,P=null,C=null;const D=new Vector4(0,0,x,A),I=new Vector4(0,0,x,A);let R=!1;const L=new Frustum;let N=!1,k=!1;const B=new Matrix4,F=new Vector3,U={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function V(){return null===b?O:1}let H,G,z,j,W,Z,q,K,Y,$,X,J,ee,te,ie,ne,se,oe,re,ae,le,ce=i;function he(e,i){for(let n=0;n<e.length;n++){const s=e[n],o=t.getContext(s,i);if(null!==o)return o}return null}try{const e={alpha:n,depth:s,stencil:o,antialias:r,premultipliedAlpha:a,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:h};if(t.addEventListener("webglcontextlost",me,!1),t.addEventListener("webglcontextrestored",ge,!1),null===ce){const t=["webgl2","webgl","experimental-webgl"];if(!0===m.isWebGL1Renderer&&t.shift(),ce=he(t,e),null===ce)throw he(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===ce.getShaderPrecisionFormat&&(ce.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function de(){H=new To(ce),G=new wo(ce,H,e),!1===G.isWebGL2&&(H.get("WEBGL_depth_texture"),H.get("OES_texture_float"),H.get("OES_texture_half_float"),H.get("OES_texture_half_float_linear"),H.get("OES_standard_derivatives"),H.get("OES_element_index_uint"),H.get("OES_vertex_array_object"),H.get("ANGLE_instanced_arrays")),H.get("OES_texture_float_linear"),ae=new da(ce,H,G),z=new ca(ce,H,G),z.scissor(M.copy(I).multiplyScalar(O).floor()),z.viewport(T.copy(D).multiplyScalar(O).floor()),j=new xo(ce),W=new Yr,Z=new ha(ce,H,z,W,G,ae,j),q=new Eo(m),K=new po(ce,G),le=new yo(ce,H,K,G),Y=new Mo(ce,K,j,le),$=new Co(ce,Y,K,j),se=new Po(ce),ie=new So(W),X=new Kr(m,q,H,G,le,ie),J=new fa(W),ee=new Jr(W),te=new oa(H,G),ne=new vo(m,q,z,$,a),oe=new bo(ce,H,j,G),re=new _o(ce,H,j,G),j.programs=X.programs,m.capabilities=G,m.extensions=H,m.properties=W,m.renderLists=ee,m.state=z,m.info=j}de();const ue=new ga(m,ce);this.xr=ue;const pe=new la(m,$,G.maxTextureSize);function me(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),g=!0}function ge(){console.log("THREE.WebGLRenderer: Context Restored."),g=!1,de()}function fe(e){const t=e.target;t.removeEventListener("dispose",fe),function(e){ve(e),W.remove(e)}(t)}function ve(e){const t=W.get(e).program;void 0!==t&&X.releaseProgram(t)}this.shadowMap=pe,this.getContext=function(){return ce},this.getContextAttributes=function(){return ce.getContextAttributes()},this.forceContextLoss=function(){const e=H.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=H.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return O},this.setPixelRatio=function(e){void 0!==e&&(O=e,this.setSize(x,A,!1))},this.getSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),e=new Vector2),e.set(x,A)},this.setSize=function(e,i,n){ue.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(x=e,A=i,t.width=Math.floor(e*O),t.height=Math.floor(i*O),!1!==n&&(t.style.width=e+"px",t.style.height=i+"px"),this.setViewport(0,0,e,i))},this.getDrawingBufferSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),e=new Vector2),e.set(x*O,A*O).floor()},this.setDrawingBufferSize=function(e,i,n){x=e,A=i,O=n,t.width=Math.floor(e*n),t.height=Math.floor(i*n),this.setViewport(0,0,e,i)},this.getCurrentViewport=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),e=new Vector4),e.copy(T)},this.getViewport=function(e){return e.copy(D)},this.setViewport=function(e,t,i,n){e.isVector4?D.set(e.x,e.y,e.z,e.w):D.set(e,t,i,n),z.viewport(T.copy(D).multiplyScalar(O).floor())},this.getScissor=function(e){return e.copy(I)},this.setScissor=function(e,t,i,n){e.isVector4?I.set(e.x,e.y,e.z,e.w):I.set(e,t,i,n),z.scissor(M.copy(I).multiplyScalar(O).floor())},this.getScissorTest=function(){return R},this.setScissorTest=function(e){z.setScissorTest(R=e)},this.setOpaqueSort=function(e){P=e},this.setTransparentSort=function(e){C=e},this.getClearColor=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getClearColor() now requires a Color as an argument"),e=new Color),e.copy(ne.getClearColor())},this.setClearColor=function(){ne.setClearColor.apply(ne,arguments)},this.getClearAlpha=function(){return ne.getClearAlpha()},this.setClearAlpha=function(){ne.setClearAlpha.apply(ne,arguments)},this.clear=function(e,t,i){let n=0;(void 0===e||e)&&(n|=16384),(void 0===t||t)&&(n|=256),(void 0===i||i)&&(n|=1024),ce.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",me,!1),t.removeEventListener("webglcontextrestored",ge,!1),ee.dispose(),te.dispose(),W.dispose(),q.dispose(),$.dispose(),le.dispose(),ue.dispose(),be.stop()},this.renderBufferImmediate=function(e,t){le.initAttributes();const i=W.get(e);e.hasPositions&&!i.position&&(i.position=ce.createBuffer()),e.hasNormals&&!i.normal&&(i.normal=ce.createBuffer()),e.hasUvs&&!i.uv&&(i.uv=ce.createBuffer()),e.hasColors&&!i.color&&(i.color=ce.createBuffer());const n=t.getAttributes();e.hasPositions&&(ce.bindBuffer(34962,i.position),ce.bufferData(34962,e.positionArray,35048),le.enableAttribute(n.position),ce.vertexAttribPointer(n.position,3,5126,!1,0,0)),e.hasNormals&&(ce.bindBuffer(34962,i.normal),ce.bufferData(34962,e.normalArray,35048),le.enableAttribute(n.normal),ce.vertexAttribPointer(n.normal,3,5126,!1,0,0)),e.hasUvs&&(ce.bindBuffer(34962,i.uv),ce.bufferData(34962,e.uvArray,35048),le.enableAttribute(n.uv),ce.vertexAttribPointer(n.uv,2,5126,!1,0,0)),e.hasColors&&(ce.bindBuffer(34962,i.color),ce.bufferData(34962,e.colorArray,35048),le.enableAttribute(n.color),ce.vertexAttribPointer(n.color,3,5126,!1,0,0)),le.disableUnusedAttributes(),ce.drawArrays(4,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,i,n,s,o){null===t&&(t=U);const r=s.isMesh&&s.matrixWorld.determinant()<0,a=_e(e,t,n,s);z.setMaterial(n,r);let l=i.index;const c=i.attributes.position;if(null===l){if(void 0===c||0===c.count)return}else if(0===l.count)return;let h,d=1;!0===n.wireframe&&(l=Y.getWireframeAttribute(i),d=2),(n.morphTargets||n.morphNormals)&&se.update(s,i,n,a),le.setup(s,n,a,i,l);let u=oe;null!==l&&(h=K.get(l),u=re,u.setIndex(h));const p=null!==l?l.count:c.count,m=i.drawRange.start*d,g=i.drawRange.count*d,f=null!==o?o.start*d:0,v=null!==o?o.count*d:1/0,y=Math.max(m,f),b=Math.min(p,m+g,f+v)-1,w=Math.max(0,b-y+1);if(0!==w){if(s.isMesh)!0===n.wireframe?(z.setLineWidth(n.wireframeLinewidth*V()),u.setMode(1)):u.setMode(4);else if(s.isLine){let e=n.linewidth;void 0===e&&(e=1),z.setLineWidth(e*V()),s.isLineSegments?u.setMode(1):s.isLineLoop?u.setMode(2):u.setMode(3)}else s.isPoints?u.setMode(0):s.isSprite&&u.setMode(4);if(s.isInstancedMesh)u.renderInstances(y,w,s.count);else if(i.isInstancedBufferGeometry){const e=Math.min(i.instanceCount,i._maxInstanceCount);u.renderInstances(y,w,e)}else u.render(y,w)}},this.compile=function(e,t){u=te.get(e),u.init(),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(u.pushLight(e),e.castShadow&&u.pushShadow(e))})),u.setupLights();const i=new WeakMap;e.traverse((function(t){const n=t.material;if(n)if(Array.isArray(n))for(let s=0;s<n.length;s++){const o=n[s];!1===i.has(o)&&(Te(o,e,t),i.set(o))}else!1===i.has(n)&&(Te(n,e,t),i.set(n))}))};let ye=null;const be=new uo;function we(e,t,i,n){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)i=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)u.pushLight(e),e.castShadow&&u.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||L.intersectsSprite(e)){n&&F.setFromMatrixPosition(e.matrixWorld).applyMatrix4(B);const t=$.update(e),s=e.material;s.visible&&d.push(e,t,s,i,F.z,null)}}else if(e.isImmediateRenderObject)n&&F.setFromMatrixPosition(e.matrixWorld).applyMatrix4(B),d.push(e,null,e.material,i,F.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==j.render.frame&&(e.skeleton.update(),e.skeleton.frame=j.render.frame),!e.frustumCulled||L.intersectsObject(e))){n&&F.setFromMatrixPosition(e.matrixWorld).applyMatrix4(B);const t=$.update(e),s=e.material;if(Array.isArray(s)){const n=t.groups;for(let o=0,r=n.length;o<r;o++){const r=n[o],a=s[r.materialIndex];a&&a.visible&&d.push(e,t,a,i,F.z,r)}}else s.visible&&d.push(e,t,s,i,F.z,null)}const s=e.children;for(let e=0,o=s.length;e<o;e++)we(s[e],t,i,n)}function Se(e,t,i){const n=!0===t.isScene?t.overrideMaterial:null;for(let s=0,o=e.length;s<o;s++){const o=e[s],r=o.object,a=o.geometry,l=null===n?o.material:n,c=o.group;if(i.isArrayCamera){const e=i.cameras;for(let i=0,n=e.length;i<n;i++){const n=e[i];r.layers.test(n.layers)&&(z.viewport(T.copy(n.viewport)),u.setupLightsView(n),Ee(r,t,n,a,l,c))}}else Ee(r,t,i,a,l,c)}}function Ee(e,t,i,n,s,o){if(e.onBeforeRender(m,t,i,n,s,o),e.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){const n=_e(i,t,s,e);z.setMaterial(s),le.reset(),function(e,t){e.render((function(e){m.renderBufferImmediate(e,t)}))}(e,n)}else m.renderBufferDirect(i,t,n,s,e,o);e.onAfterRender(m,t,i,n,s,o)}function Te(e,t,i){!0!==t.isScene&&(t=U);const n=W.get(e),s=u.state.lights,o=u.state.shadowsArray,r=s.state.version,a=X.getParameters(e,s.state,o,t,i),l=X.getProgramCacheKey(a);let c=n.program,h=!0;if(void 0===c)e.addEventListener("dispose",fe);else if(c.cacheKey!==l)ve(e);else if(n.lightsStateVersion!==r)h=!1;else{if(void 0!==a.shaderID){const i=e.isMeshStandardMaterial?t.environment:null;return void(n.envMap=q.get(e.envMap||i))}h=!1}h&&(a.uniforms=X.getUniforms(e),e.onBeforeCompile(a,m),c=X.acquireProgram(a,l),n.program=c,n.uniforms=a.uniforms,n.outputEncoding=a.outputEncoding);const d=n.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(n.numClippingPlanes=ie.numPlanes,n.numIntersection=ie.numIntersection,d.clippingPlanes=ie.uniform),n.environment=e.isMeshStandardMaterial?t.environment:null,n.fog=t.fog,n.envMap=q.get(e.envMap||n.environment),n.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),n.lightsStateVersion=r,n.needsLights&&(d.ambientLightColor.value=s.state.ambient,d.lightProbe.value=s.state.probe,d.directionalLights.value=s.state.directional,d.directionalLightShadows.value=s.state.directionalShadow,d.spotLights.value=s.state.spot,d.spotLightShadows.value=s.state.spotShadow,d.rectAreaLights.value=s.state.rectArea,d.ltc_1.value=s.state.rectAreaLTC1,d.ltc_2.value=s.state.rectAreaLTC2,d.pointLights.value=s.state.point,d.pointLightShadows.value=s.state.pointShadow,d.hemisphereLights.value=s.state.hemi,d.directionalShadowMap.value=s.state.directionalShadowMap,d.directionalShadowMatrix.value=s.state.directionalShadowMatrix,d.spotShadowMap.value=s.state.spotShadowMap,d.spotShadowMatrix.value=s.state.spotShadowMatrix,d.pointShadowMap.value=s.state.pointShadowMap,d.pointShadowMatrix.value=s.state.pointShadowMatrix);const p=n.program.getUniforms(),g=Ar.seqWithValue(p.seq,d);n.uniformsList=g}function _e(e,t,i,n){!0!==t.isScene&&(t=U),Z.resetTextureUnits();const s=t.fog,o=i.isMeshStandardMaterial?t.environment:null,r=null===b?m.outputEncoding:b.texture.encoding,a=q.get(i.envMap||o),l=W.get(i),c=u.state.lights;if(!0===N&&(!0===k||e!==E)){const t=e===E&&i.id===S;ie.setState(i,e,t)}i.version===l.__version?i.fog&&l.fog!==s||l.environment!==o||l.needsLights&&l.lightsStateVersion!==c.state.version?Te(i,t,n):void 0===l.numClippingPlanes||l.numClippingPlanes===ie.numPlanes&&l.numIntersection===ie.numIntersection?(l.outputEncoding!==r||l.envMap!==a)&&Te(i,t,n):Te(i,t,n):(Te(i,t,n),l.__version=i.version);let h=!1,d=!1,p=!1;const g=l.program,f=g.getUniforms(),v=l.uniforms;if(z.useProgram(g.program)&&(h=!0,d=!0,p=!0),i.id!==S&&(S=i.id,d=!0),h||E!==e){if(f.setValue(ce,"projectionMatrix",e.projectionMatrix),G.logarithmicDepthBuffer&&f.setValue(ce,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),E!==e&&(E=e,d=!0,p=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshStandardMaterial||i.envMap){const t=f.map.cameraPosition;void 0!==t&&t.setValue(ce,F.setFromMatrixPosition(e.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&f.setValue(ce,"isOrthographic",!0===e.isOrthographicCamera),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.isShadowMaterial||i.skinning)&&f.setValue(ce,"viewMatrix",e.matrixWorldInverse)}if(i.skinning){f.setOptional(ce,n,"bindMatrix"),f.setOptional(ce,n,"bindMatrixInverse");const e=n.skeleton;if(e){const t=e.bones;if(G.floatVertexTextures){if(null===e.boneTexture){let i=Math.sqrt(4*t.length);i=Fi.ceilPowerOfTwo(i),i=Math.max(i,4);const n=new Float32Array(i*i*4);n.set(e.boneMatrices);const s=new lo(n,i,i,Fe,Ce);e.boneMatrices=n,e.boneTexture=s,e.boneTextureSize=i}f.setValue(ce,"boneTexture",e.boneTexture,Z),f.setValue(ce,"boneTextureSize",e.boneTextureSize)}else f.setOptional(ce,e,"boneMatrices")}}var y,w;return(d||l.receiveShadow!==n.receiveShadow)&&(l.receiveShadow=n.receiveShadow,f.setValue(ce,"receiveShadow",n.receiveShadow)),d&&(f.setValue(ce,"toneMappingExposure",m.toneMappingExposure),l.needsLights&&(w=p,(y=v).ambientLightColor.needsUpdate=w,y.lightProbe.needsUpdate=w,y.directionalLights.needsUpdate=w,y.directionalLightShadows.needsUpdate=w,y.pointLights.needsUpdate=w,y.pointLightShadows.needsUpdate=w,y.spotLights.needsUpdate=w,y.spotLightShadows.needsUpdate=w,y.rectAreaLights.needsUpdate=w,y.hemisphereLights.needsUpdate=w),s&&i.fog&&J.refreshFogUniforms(v,s),J.refreshMaterialUniforms(v,i,O,A),Ar.upload(ce,l.uniformsList,v,Z)),i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(Ar.upload(ce,l.uniformsList,v,Z),i.uniformsNeedUpdate=!1),i.isSpriteMaterial&&f.setValue(ce,"center",n.center),f.setValue(ce,"modelViewMatrix",n.modelViewMatrix),f.setValue(ce,"normalMatrix",n.normalMatrix),f.setValue(ce,"modelMatrix",n.matrixWorld),g}be.setAnimationLoop((function(e){ue.isPresenting||ye&&ye(e)})),"undefined"!=typeof window&&be.setContext(window),this.setAnimationLoop=function(e){ye=e,ue.setAnimationLoop(e),null===e?be.stop():be.start()},this.render=function(e,t){let i,n;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),i=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),n=arguments[3]),void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===g)return;le.resetDefaultState(),S=-1,E=null,!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===ue.enabled&&!0===ue.isPresenting&&(t=ue.getCamera(t)),!0===e.isScene&&e.onBeforeRender(m,e,t,i||b),u=te.get(e,p.length),u.init(),p.push(u),B.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),L.setFromProjectionMatrix(B),k=this.localClippingEnabled,N=ie.init(this.clippingPlanes,k,t),d=ee.get(e,t),d.init(),we(e,t,0,m.sortObjects),d.finish(),!0===m.sortObjects&&d.sort(P,C),!0===N&&ie.beginShadows();const s=u.state.shadowsArray;pe.render(s,e,t),u.setupLights(),u.setupLightsView(t),!0===N&&ie.endShadows(),!0===this.info.autoReset&&this.info.reset(),void 0!==i&&this.setRenderTarget(i),ne.render(d,e,t,n);const o=d.opaque,r=d.transparent;o.length>0&&Se(o,e,t),r.length>0&&Se(r,e,t),!0===e.isScene&&e.onAfterRender(m,e,t),null!==b&&(Z.updateRenderTargetMipmap(b),Z.updateMultisampleRenderTarget(b)),z.buffers.depth.setTest(!0),z.buffers.depth.setMask(!0),z.buffers.color.setMask(!0),z.setPolygonOffset(!1),p.pop(),u=p.length>0?p[p.length-1]:null,d=null},this.setFramebuffer=function(e){f!==e&&null===b&&ce.bindFramebuffer(36160,e),f=e},this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return y},this.getRenderList=function(){return d},this.setRenderList=function(e){d=e},this.getRenderTarget=function(){return b},this.setRenderTarget=function(e,t=0,i=0){b=e,v=t,y=i,e&&void 0===W.get(e).__webglFramebuffer&&Z.setupRenderTarget(e);let n=f,s=!1;if(e){const i=W.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(n=i[t],s=!0):n=e.isWebGLMultisampleRenderTarget?W.get(e).__webglMultisampledFramebuffer:i,T.copy(e.viewport),M.copy(e.scissor),_=e.scissorTest}else T.copy(D).multiplyScalar(O).floor(),M.copy(I).multiplyScalar(O).floor(),_=R;if(w!==n&&(ce.bindFramebuffer(36160,n),w=n),z.viewport(T),z.scissor(M),z.setScissorTest(_),s){const n=W.get(e.texture);ce.framebufferTexture2D(36160,36064,34069+t,n.__webglTexture,i)}},this.readRenderTargetPixels=function(e,t,i,n,s,o,r){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=W.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==r&&(a=a[r]),a){let r=!1;a!==w&&(ce.bindFramebuffer(36160,a),r=!0);try{const a=e.texture,l=a.format,c=a.type;if(l!==Fe&&ae.convert(l)!==ce.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(c===Me||ae.convert(c)===ce.getParameter(35738)||c===Ce&&(G.isWebGL2||H.get("OES_texture_float")||H.get("WEBGL_color_buffer_float"))||c===De&&(G.isWebGL2?H.get("EXT_color_buffer_float"):H.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===ce.checkFramebufferStatus(36160)?t>=0&&t<=e.width-n&&i>=0&&i<=e.height-s&&ce.readPixels(t,i,n,s,ae.convert(l),ae.convert(c),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{r&&ce.bindFramebuffer(36160,w)}}},this.copyFramebufferToTexture=function(e,t,i=0){const n=Math.pow(2,-i),s=Math.floor(t.image.width*n),o=Math.floor(t.image.height*n),r=ae.convert(t.format);Z.setTexture2D(t,0),ce.copyTexImage2D(3553,i,r,e.x,e.y,s,o,0),z.unbindTexture()},this.copyTextureToTexture=function(e,t,i,n=0){const s=t.image.width,o=t.image.height,r=ae.convert(i.format),a=ae.convert(i.type);Z.setTexture2D(i,0),ce.pixelStorei(37440,i.flipY),ce.pixelStorei(37441,i.premultiplyAlpha),ce.pixelStorei(3317,i.unpackAlignment),t.isDataTexture?ce.texSubImage2D(3553,n,e.x,e.y,s,o,r,a,t.image.data):t.isCompressedTexture?ce.compressedTexSubImage2D(3553,n,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,r,t.mipmaps[0].data):ce.texSubImage2D(3553,n,e.x,e.y,r,a,t.image),0===n&&i.generateMipmaps&&ce.generateMipmap(3553),z.unbindTexture()},this.initTexture=function(e){Z.setTexture2D(e,0),z.unbindTexture()},this.resetState=function(){z.reset(),le.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function ya(e){va.call(this,e)}ua.prototype=Object.assign(Object.create(no.prototype),{constructor:ua,isArrayCamera:!0}),pa.prototype=Object.assign(Object.create(Un.prototype),{constructor:pa,isGroup:!0}),Object.assign(ma.prototype,{constructor:ma,getHandSpace:function(){if(null===this._hand&&(this._hand=new pa,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints=[],this._hand.inputState={pinching:!1},window.XRHand))for(let e=0;e<=window.XRHand.LITTLE_PHALANX_TIP;e++){const e=new pa;e.matrixAutoUpdate=!1,e.visible=!1,this._hand.joints.push(e),this._hand.add(e)}return this._hand},getTargetRaySpace:function(){return null===this._targetRay&&(this._targetRay=new pa,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return null===this._grip&&(this._grip=new pa,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this},disconnect:function(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this},update:function(e,t,i){let n=null,s=null,o=null;const r=this._targetRay,a=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState)if(l&&e.hand){o=!0;for(let n=0;n<=window.XRHand.LITTLE_PHALANX_TIP;n++)if(e.hand[n]){const s=t.getJointPose(e.hand[n],i),o=l.joints[n];null!==s&&(o.matrix.fromArray(s.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.jointRadius=s.radius),o.visible=null!==s;const r=l.joints[window.XRHand.INDEX_PHALANX_TIP],a=l.joints[window.XRHand.THUMB_PHALANX_TIP],c=r.position.distanceTo(a.position),h=.02,d=.005;l.inputState.pinching&&c>h+d?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&c<=h-d&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}}else null!==r&&(n=t.getPose(e.targetRaySpace,i),null!==n&&(r.matrix.fromArray(n.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale))),null!==a&&e.gripSpace&&(s=t.getPose(e.gripSpace,i),null!==s&&(a.matrix.fromArray(s.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale)));return null!==r&&(r.visible=null!==n),null!==a&&(a.visible=null!==s),null!==l&&(l.visible=null!==o),this}}),Object.assign(ga.prototype,Ni.prototype),ya.prototype=Object.assign(Object.create(va.prototype),{constructor:ya,isWebGL1Renderer:!0});class FogExp2{constructor(e,t){Object.defineProperty(this,"isFogExp2",{value:!0}),this.name="",this.color=new Color(e),this.density=void 0!==t?t:25e-5}clone(){return new FogExp2(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class Fog{constructor(e,t,i){Object.defineProperty(this,"isFog",{value:!0}),this.name="",this.color=new Color(e),this.near=void 0!==t?t:1,this.far=void 0!==i?i:1e3}clone(){return new Fog(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class Scene extends Un{constructor(){super(),Object.defineProperty(this,"isScene",{value:!0}),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.environment&&(t.object.environment=this.environment.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}function ba(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=Mi,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Fi.generateUUID()}Object.defineProperty(ba.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(ba.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this},copyAt:function(e,t,i){e*=this.stride,i*=t.stride;for(let n=0,s=this.stride;n<s;n++)this.array[e+n]=t.array[i+n];return this},set:function(e,t=0){return this.array.set(e,t),this},clone:function(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Fi.generateUUID()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new ba(new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),this.stride);return t.setUsage(this.usage),t},onUpload:function(e){return this.onUploadCallback=e,this},toJSON:function(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Fi.generateUUID()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});const wa=new Vector3;function Sa(e,t,i,n){this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=!0===n}function Ea(e){rs.call(this),this.type="SpriteMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}let Ta;Object.defineProperties(Sa.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}},needsUpdate:{set:function(e){this.data.needsUpdate=e}}}),Object.assign(Sa.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(e){for(let t=0,i=this.data.count;t<i;t++)wa.x=this.getX(t),wa.y=this.getY(t),wa.z=this.getZ(t),wa.applyMatrix4(e),this.setXYZ(t,wa.x,wa.y,wa.z);return this},setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this},setXYZ:function(e,t,i,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this},setXYZW:function(e,t,i,n,s){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this.data.array[e+3]=s,this},clone:function(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const i=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[i+t])}return new hs(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Sa(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)},toJSON:function(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const i=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[i+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}),Ea.prototype=Object.create(rs.prototype),Ea.prototype.constructor=Ea,Ea.prototype.isSpriteMaterial=!0,Ea.prototype.copy=function(e){return rs.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this};const Ma=new Vector3,_a=new Vector3,xa=new Vector3,Aa=new Vector2,Oa=new Vector2,Pa=new Matrix4,Ca=new Vector3,Da=new Vector3,Ia=new Vector3,Ra=new Vector2,La=new Vector2,Na=new Vector2;function ka(e){if(Un.call(this),this.type="Sprite",void 0===Ta){Ta=new Ds;const e=new ba(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);Ta.setIndex([0,1,2,0,2,3]),Ta.setAttribute("position",new Sa(e,3,0,!1)),Ta.setAttribute("uv",new Sa(e,2,3,!1))}this.geometry=Ta,this.material=void 0!==e?e:new Ea,this.center=new Vector2(.5,.5)}function Ba(e,t,i,n,s,o){Aa.subVectors(e,i).addScalar(.5).multiply(n),void 0!==s?(Oa.x=o*Aa.x-s*Aa.y,Oa.y=s*Aa.x+o*Aa.y):Oa.copy(Aa),e.copy(t),e.x+=Oa.x,e.y+=Oa.y,e.applyMatrix4(Pa)}ka.prototype=Object.assign(Object.create(Un.prototype),{constructor:ka,isSprite:!0,raycast:function(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),_a.setFromMatrixScale(this.matrixWorld),Pa.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),xa.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&_a.multiplyScalar(-xa.z);const i=this.material.rotation;let n,s;0!==i&&(s=Math.cos(i),n=Math.sin(i));const o=this.center;Ba(Ca.set(-.5,-.5,0),xa,o,_a,n,s),Ba(Da.set(.5,-.5,0),xa,o,_a,n,s),Ba(Ia.set(.5,.5,0),xa,o,_a,n,s),Ra.set(0,0),La.set(1,0),Na.set(1,1);let r=e.ray.intersectTriangle(Ca,Da,Ia,!1,Ma);if(null===r&&(Ba(Da.set(-.5,.5,0),xa,o,_a,n,s),La.set(0,1),r=e.ray.intersectTriangle(Ca,Ia,Da,!1,Ma),null===r))return;const a=e.ray.origin.distanceTo(Ma);a<e.near||a>e.far||t.push({distance:a,point:Ma.clone(),uv:Triangle.getUV(Ma,Ca,Da,Ia,Ra,La,Na,new Vector2),face:null,object:this})},copy:function(e){return Un.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}});const Fa=new Vector3,Ua=new Vector3;function Va(){Un.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}Va.prototype=Object.assign(Object.create(Un.prototype),{constructor:Va,isLOD:!0,copy:function(e){Un.prototype.copy.call(this,e,!1);const t=e.levels;for(let e=0,i=t.length;e<i;e++){const i=t[e];this.addLevel(i.object.clone(),i.distance)}return this.autoUpdate=e.autoUpdate,this},addLevel:function(e,t=0){t=Math.abs(t);const i=this.levels;let n;for(n=0;n<i.length&&!(t<i[n].distance);n++);return i.splice(n,0,{distance:t,object:e}),this.add(e),this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(e){const t=this.levels;if(t.length>0){let i,n;for(i=1,n=t.length;i<n&&!(e<t[i].distance);i++);return t[i-1].object}return null},raycast:function(e,t){if(this.levels.length>0){Fa.setFromMatrixPosition(this.matrixWorld);const i=e.ray.origin.distanceTo(Fa);this.getObjectForDistance(i).raycast(e,t)}},update:function(e){const t=this.levels;if(t.length>1){Fa.setFromMatrixPosition(e.matrixWorld),Ua.setFromMatrixPosition(this.matrixWorld);const i=Fa.distanceTo(Ua)/e.zoom;let n,s;for(t[0].object.visible=!0,n=1,s=t.length;n<s&&i>=t[n].distance;n++)t[n-1].object.visible=!1,t[n].object.visible=!0;for(this._currentLevel=n-1;n<s;n++)t[n].object.visible=!1}},toJSON:function(e){const t=Un.prototype.toJSON.call(this,e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const i=this.levels;for(let e=0,n=i.length;e<n;e++){const n=i[e];t.object.levels.push({object:n.object.uuid,distance:n.distance})}return t}});const Ha=new Vector3,Ga=new Vector4,za=new Vector4,ja=new Vector3,Wa=new Matrix4;function Za(e,t){e&&e.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),Ys.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Matrix4,this.bindMatrixInverse=new Matrix4}function qa(){Un.call(this),this.type="Bone"}Za.prototype=Object.assign(Object.create(Ys.prototype),{constructor:Za,isSkinnedMesh:!0,copy:function(e){return Ys.prototype.copy.call(this,e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this},bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){const e=new Vector4,t=this.geometry.attributes.skinWeight;for(let i=0,n=t.count;i<n;i++){e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.w=t.getW(i);const n=1/e.manhattanLength();n!==1/0?e.multiplyScalar(n):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){Ys.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},boneTransform:function(e,t){const i=this.skeleton,n=this.geometry;Ga.fromBufferAttribute(n.attributes.skinIndex,e),za.fromBufferAttribute(n.attributes.skinWeight,e),Ha.fromBufferAttribute(n.attributes.position,e).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){const n=za.getComponent(e);if(0!==n){const s=Ga.getComponent(e);Wa.multiplyMatrices(i.bones[s].matrixWorld,i.boneInverses[s]),t.addScaledVector(ja.copy(Ha).applyMatrix4(Wa),n)}}return t.applyMatrix4(this.bindMatrixInverse)}}),qa.prototype=Object.assign(Object.create(Un.prototype),{constructor:qa,isBone:!0});const Ka=new Matrix4,Ya=new Matrix4;function $a(e=[],t=[]){this.uuid=Fi.generateUUID(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}Object.assign($a.prototype,{init:function(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new Matrix4)}},calculateInverses:function(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new Matrix4;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}},pose:function(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}},update:function(){const e=this.bones,t=this.boneInverses,i=this.boneMatrices,n=this.boneTexture;for(let n=0,s=e.length;n<s;n++){const s=e[n]?e[n].matrixWorld:Ya;Ka.multiplyMatrices(s,t[n]),Ka.toArray(i,16*n)}null!==n&&(n.needsUpdate=!0)},clone:function(){return new $a(this.bones,this.boneInverses)},getBoneByName:function(e){for(let t=0,i=this.bones.length;t<i;t++){const i=this.bones[t];if(i.name===e)return i}},dispose:function(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)},fromJSON:function(e,t){this.uuid=e.uuid;for(let i=0,n=e.bones.length;i<n;i++){const n=e.bones[i];let s=t[n];void 0===s&&(console.warn("THREE.Skeleton: No bone found with UUID:",n),s=new qa),this.bones.push(s),this.boneInverses.push((new Matrix4).fromArray(e.boneInverses[i]))}return this.init(),this},toJSON:function(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,i=this.boneInverses;for(let n=0,s=t.length;n<s;n++){const s=t[n];e.bones.push(s.uuid);const o=i[n];e.boneInverses.push(o.toArray())}return e}});const Xa=new Matrix4,Qa=new Matrix4,Ja=[],el=new Ys;function tl(e,t,i){Ys.call(this,e,t),this.instanceMatrix=new hs(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1}function il(e){rs.call(this),this.type="LineBasicMaterial",this.color=new Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(e)}tl.prototype=Object.assign(Object.create(Ys.prototype),{constructor:tl,isInstancedMesh:!0,copy:function(e){return Ys.prototype.copy.call(this,e),this.instanceMatrix.copy(e.instanceMatrix),this.count=e.count,this},getColorAt:function(e,t){t.fromArray(this.instanceColor.array,3*e)},getMatrixAt:function(e,t){t.fromArray(this.instanceMatrix.array,16*e)},raycast:function(e,t){const i=this.matrixWorld,n=this.count;if(el.geometry=this.geometry,el.material=this.material,void 0!==el.material)for(let s=0;s<n;s++){this.getMatrixAt(s,Xa),Qa.multiplyMatrices(i,Xa),el.matrixWorld=Qa,el.raycast(e,Ja);for(let e=0,i=Ja.length;e<i;e++){const i=Ja[e];i.instanceId=s,i.object=this,t.push(i)}Ja.length=0}},setColorAt:function(e,t){null===this.instanceColor&&(this.instanceColor=new hs(new Float32Array(3*this.count),3)),t.toArray(this.instanceColor.array,3*e)},setMatrixAt:function(e,t){t.toArray(this.instanceMatrix.array,16*e)},updateMorphTargets:function(){},dispose:function(){this.dispatchEvent({type:"dispose"})}}),il.prototype=Object.create(rs.prototype),il.prototype.constructor=il,il.prototype.isLineBasicMaterial=!0,il.prototype.copy=function(e){return rs.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.morphTargets=e.morphTargets,this};const nl=new Vector3,sl=new Vector3,ol=new Matrix4,rl=new Ray,al=new Sphere;function ll(e=new Ds,t=new il){Un.call(this),this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}ll.prototype=Object.assign(Object.create(Un.prototype),{constructor:ll,isLine:!0,copy:function(e){return Un.prototype.copy.call(this,e),this.material=e.material,this.geometry=e.geometry,this},computeLineDistances:function(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,i=[0];for(let e=1,n=t.count;e<n;e++)nl.fromBufferAttribute(t,e-1),sl.fromBufferAttribute(t,e),i[e]=i[e-1],i[e]+=nl.distanceTo(sl);e.setAttribute("lineDistance",new bs(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){const t=e.vertices,i=e.lineDistances;i[0]=0;for(let e=1,n=t.length;e<n;e++)i[e]=i[e-1],i[e]+=t[e-1].distanceTo(t[e])}return this},raycast:function(e,t){const i=this.geometry,n=this.matrixWorld,s=e.params.Line.threshold;if(null===i.boundingSphere&&i.computeBoundingSphere(),al.copy(i.boundingSphere),al.applyMatrix4(n),al.radius+=s,!1===e.ray.intersectsSphere(al))return;ol.copy(n).invert(),rl.copy(e.ray).applyMatrix4(ol);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),r=o*o,a=new Vector3,l=new Vector3,c=new Vector3,h=new Vector3,d=this.isLineSegments?2:1;if(i.isBufferGeometry){const n=i.index,s=i.attributes.position;if(null!==n){const i=n.array;for(let n=0,o=i.length-1;n<o;n+=d){const o=i[n],d=i[n+1];a.fromBufferAttribute(s,o),l.fromBufferAttribute(s,d);if(rl.distanceSqToSegment(a,l,h,c)>r)continue;h.applyMatrix4(this.matrixWorld);const u=e.ray.origin.distanceTo(h);u<e.near||u>e.far||t.push({distance:u,point:c.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else for(let i=0,n=s.count-1;i<n;i+=d){a.fromBufferAttribute(s,i),l.fromBufferAttribute(s,i+1);if(rl.distanceSqToSegment(a,l,h,c)>r)continue;h.applyMatrix4(this.matrixWorld);const n=e.ray.origin.distanceTo(h);n<e.near||n>e.far||t.push({distance:n,point:c.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}else if(i.isGeometry){const n=i.vertices,s=n.length;for(let i=0;i<s-1;i+=d){if(rl.distanceSqToSegment(n[i],n[i+1],h,c)>r)continue;h.applyMatrix4(this.matrixWorld);const s=e.ray.origin.distanceTo(h);s<e.near||s>e.far||t.push({distance:s,point:c.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}},updateMorphTargets:function(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const e=t[i[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,i=e.length;t<i;t++){const i=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});const cl=new Vector3,hl=new Vector3;function dl(e,t){ll.call(this,e,t),this.type="LineSegments"}function ul(e,t){ll.call(this,e,t),this.type="LineLoop"}function pl(e){rs.call(this),this.type="PointsMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}dl.prototype=Object.assign(Object.create(ll.prototype),{constructor:dl,isLineSegments:!0,computeLineDistances:function(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,i=[];for(let e=0,n=t.count;e<n;e+=2)cl.fromBufferAttribute(t,e),hl.fromBufferAttribute(t,e+1),i[e]=0===e?0:i[e-1],i[e+1]=i[e]+cl.distanceTo(hl);e.setAttribute("lineDistance",new bs(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){const t=e.vertices,i=e.lineDistances;for(let e=0,n=t.length;e<n;e+=2)cl.copy(t[e]),hl.copy(t[e+1]),i[e]=0===e?0:i[e-1],i[e+1]=i[e]+cl.distanceTo(hl)}return this}}),ul.prototype=Object.assign(Object.create(ll.prototype),{constructor:ul,isLineLoop:!0}),pl.prototype=Object.create(rs.prototype),pl.prototype.constructor=pl,pl.prototype.isPointsMaterial=!0,pl.prototype.copy=function(e){return rs.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this};const ml=new Matrix4,gl=new Ray,fl=new Sphere,vl=new Vector3;function yl(e=new Ds,t=new pl){Un.call(this),this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}function bl(e,t,i,n,s,o,r){const a=gl.distanceSqToPoint(e);if(a<i){const i=new Vector3;gl.closestPointToPoint(e,i),i.applyMatrix4(n);const l=s.ray.origin.distanceTo(i);if(l<s.near||l>s.far)return;o.push({distance:l,distanceToRay:Math.sqrt(a),point:i,index:t,face:null,object:r})}}function wl(e,t,i,n,s,o,r,a,l){Gi.call(this,e,t,i,n,s,o,r,a,l),this.format=void 0!==r?r:Be,this.minFilter=void 0!==o?o:be,this.magFilter=void 0!==s?s:be,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){c.needsUpdate=!0,e.requestVideoFrameCallback(t)}))}function Sl(e,t,i,n,s,o,r,a,l,c,h,d){Gi.call(this,null,o,r,a,l,c,n,s,h,d),this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function El(e,t,i,n,s,o,r,a,l){Gi.call(this,e,t,i,n,s,o,r,a,l),this.needsUpdate=!0}function Tl(e,t,i,n,s,o,r,a,l,c){if((c=void 0!==c?c:Ge)!==Ge&&c!==ze)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&c===Ge&&(i=Ae),void 0===i&&c===ze&&(i=Ne),Gi.call(this,null,n,s,o,r,a,c,i,l),this.image={width:e,height:t},this.magFilter=void 0!==r?r:me,this.minFilter=void 0!==a?a:me,this.flipY=!1,this.generateMipmaps=!1}yl.prototype=Object.assign(Object.create(Un.prototype),{constructor:yl,isPoints:!0,copy:function(e){return Un.prototype.copy.call(this,e),this.material=e.material,this.geometry=e.geometry,this},raycast:function(e,t){const i=this.geometry,n=this.matrixWorld,s=e.params.Points.threshold;if(null===i.boundingSphere&&i.computeBoundingSphere(),fl.copy(i.boundingSphere),fl.applyMatrix4(n),fl.radius+=s,!1===e.ray.intersectsSphere(fl))return;ml.copy(n).invert(),gl.copy(e.ray).applyMatrix4(ml);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),r=o*o;if(i.isBufferGeometry){const s=i.index,o=i.attributes.position;if(null!==s){const i=s.array;for(let s=0,a=i.length;s<a;s++){const a=i[s];vl.fromBufferAttribute(o,a),bl(vl,a,r,n,e,t,this)}}else for(let i=0,s=o.count;i<s;i++)vl.fromBufferAttribute(o,i),bl(vl,i,r,n,e,t,this)}else{const s=i.vertices;for(let i=0,o=s.length;i<o;i++)bl(s[i],i,r,n,e,t,this)}},updateMorphTargets:function(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const e=t[i[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,i=e.length;t<i;t++){const i=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}),wl.prototype=Object.assign(Object.create(Gi.prototype),{constructor:wl,clone:function(){return new this.constructor(this.image).copy(this)},isVideoTexture:!0,update:function(){const e=this.image;!1==="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),Sl.prototype=Object.create(Gi.prototype),Sl.prototype.constructor=Sl,Sl.prototype.isCompressedTexture=!0,El.prototype=Object.create(Gi.prototype),El.prototype.constructor=El,El.prototype.isCanvasTexture=!0,Tl.prototype=Object.create(Gi.prototype),Tl.prototype.constructor=Tl,Tl.prototype.isDepthTexture=!0;let Ml=0;const _l=new Matrix4,xl=new Un,Al=new Vector3;function Ol(){Object.defineProperty(this,"id",{value:Ml+=2}),this.uuid=Fi.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}Ol.prototype=Object.assign(Object.create(Ni.prototype),{constructor:Ol,isGeometry:!0,applyMatrix4:function(e){const t=(new Matrix3).getNormalMatrix(e);for(let t=0,i=this.vertices.length;t<i;t++){this.vertices[t].applyMatrix4(e)}for(let e=0,i=this.faces.length;e<i;e++){const i=this.faces[e];i.normal.applyMatrix3(t).normalize();for(let e=0,n=i.vertexNormals.length;e<n;e++)i.vertexNormals[e].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(e){return _l.makeRotationX(e),this.applyMatrix4(_l),this},rotateY:function(e){return _l.makeRotationY(e),this.applyMatrix4(_l),this},rotateZ:function(e){return _l.makeRotationZ(e),this.applyMatrix4(_l),this},translate:function(e,t,i){return _l.makeTranslation(e,t,i),this.applyMatrix4(_l),this},scale:function(e,t,i){return _l.makeScale(e,t,i),this.applyMatrix4(_l),this},lookAt:function(e){return xl.lookAt(e),xl.updateMatrix(),this.applyMatrix4(xl.matrix),this},fromBufferGeometry:function(e){const t=this,i=null!==e.index?e.index:void 0,n=e.attributes;if(void 0===n.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;const s=n.position,o=n.normal,r=n.color,a=n.uv,l=n.uv2;void 0!==l&&(this.faceVertexUvs[1]=[]);for(let e=0;e<s.count;e++)t.vertices.push((new Vector3).fromBufferAttribute(s,e)),void 0!==r&&t.colors.push((new Color).fromBufferAttribute(r,e));function c(e,i,n,s){const c=void 0===r?[]:[t.colors[e].clone(),t.colors[i].clone(),t.colors[n].clone()],h=void 0===o?[]:[(new Vector3).fromBufferAttribute(o,e),(new Vector3).fromBufferAttribute(o,i),(new Vector3).fromBufferAttribute(o,n)],d=new Face3(e,i,n,h,c,s);t.faces.push(d),void 0!==a&&t.faceVertexUvs[0].push([(new Vector2).fromBufferAttribute(a,e),(new Vector2).fromBufferAttribute(a,i),(new Vector2).fromBufferAttribute(a,n)]),void 0!==l&&t.faceVertexUvs[1].push([(new Vector2).fromBufferAttribute(l,e),(new Vector2).fromBufferAttribute(l,i),(new Vector2).fromBufferAttribute(l,n)])}const h=e.groups;if(h.length>0)for(let e=0;e<h.length;e++){const t=h[e],n=t.start;for(let e=n,s=n+t.count;e<s;e+=3)void 0!==i?c(i.getX(e),i.getX(e+1),i.getX(e+2),t.materialIndex):c(e,e+1,e+2,t.materialIndex)}else if(void 0!==i)for(let e=0;e<i.count;e+=3)c(i.getX(e),i.getX(e+1),i.getX(e+2));else for(let e=0;e<s.count;e+=3)c(e,e+1,e+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Al).negate(),this.translate(Al.x,Al.y,Al.z),this},normalize:function(){this.computeBoundingSphere();const e=this.boundingSphere.center,t=this.boundingSphere.radius,i=0===t?1:1/t,n=new Matrix4;return n.set(i,0,0,-i*e.x,0,i,0,-i*e.y,0,0,i,-i*e.z,0,0,0,1),this.applyMatrix4(n),this},computeFaceNormals:function(){const e=new Vector3,t=new Vector3;for(let i=0,n=this.faces.length;i<n;i++){const n=this.faces[i],s=this.vertices[n.a],o=this.vertices[n.b],r=this.vertices[n.c];e.subVectors(r,o),t.subVectors(s,o),e.cross(t),e.normalize(),n.normal.copy(e)}},computeVertexNormals:function(e=!0){const t=new Array(this.vertices.length);for(let e=0,i=this.vertices.length;e<i;e++)t[e]=new Vector3;if(e){const e=new Vector3,i=new Vector3;for(let n=0,s=this.faces.length;n<s;n++){const s=this.faces[n],o=this.vertices[s.a],r=this.vertices[s.b],a=this.vertices[s.c];e.subVectors(a,r),i.subVectors(o,r),e.cross(i),t[s.a].add(e),t[s.b].add(e),t[s.c].add(e)}}else{this.computeFaceNormals();for(let e=0,i=this.faces.length;e<i;e++){const i=this.faces[e];t[i.a].add(i.normal),t[i.b].add(i.normal),t[i.c].add(i.normal)}}for(let e=0,i=this.vertices.length;e<i;e++)t[e].normalize();for(let e=0,i=this.faces.length;e<i;e++){const i=this.faces[e],n=i.vertexNormals;3===n.length?(n[0].copy(t[i.a]),n[1].copy(t[i.b]),n[2].copy(t[i.c])):(n[0]=t[i.a].clone(),n[1]=t[i.b].clone(),n[2]=t[i.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){this.computeFaceNormals();for(let e=0,t=this.faces.length;e<t;e++){const t=this.faces[e],i=t.vertexNormals;3===i.length?(i[0].copy(t.normal),i[1].copy(t.normal),i[2].copy(t.normal)):(i[0]=t.normal.clone(),i[1]=t.normal.clone(),i[2]=t.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){for(let e=0,t=this.faces.length;e<t;e++){const t=this.faces[e];t.__originalFaceNormal?t.__originalFaceNormal.copy(t.normal):t.__originalFaceNormal=t.normal.clone(),t.__originalVertexNormals||(t.__originalVertexNormals=[]);for(let e=0,i=t.vertexNormals.length;e<i;e++)t.__originalVertexNormals[e]?t.__originalVertexNormals[e].copy(t.vertexNormals[e]):t.__originalVertexNormals[e]=t.vertexNormals[e].clone()}const e=new Ol;e.faces=this.faces;for(let t=0,i=this.morphTargets.length;t<i;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];const e=this.morphNormals[t].faceNormals,i=this.morphNormals[t].vertexNormals;for(let t=0,n=this.faces.length;t<n;t++){const t=new Vector3,n={a:new Vector3,b:new Vector3,c:new Vector3};e.push(t),i.push(n)}}const i=this.morphNormals[t];e.vertices=this.morphTargets[t].vertices,e.computeFaceNormals(),e.computeVertexNormals();for(let e=0,t=this.faces.length;e<t;e++){const t=this.faces[e],n=i.faceNormals[e],s=i.vertexNormals[e];n.copy(t.normal),s.a.copy(t.vertexNormals[0]),s.b.copy(t.vertexNormals[1]),s.c.copy(t.vertexNormals[2])}}for(let e=0,t=this.faces.length;e<t;e++){const t=this.faces[e];t.normal=t.__originalFaceNormal,t.vertexNormals=t.__originalVertexNormals}},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,i=0){if(!e||!e.isGeometry)return void console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);let n;const s=this.vertices.length,o=this.vertices,r=e.vertices,a=this.faces,l=e.faces,c=this.colors,h=e.colors;void 0!==t&&(n=(new Matrix3).getNormalMatrix(t));for(let e=0,i=r.length;e<i;e++){const i=r[e].clone();void 0!==t&&i.applyMatrix4(t),o.push(i)}for(let e=0,t=h.length;e<t;e++)c.push(h[e].clone());for(let e=0,t=l.length;e<t;e++){const t=l[e];let o,r;const c=t.vertexNormals,h=t.vertexColors,d=new Face3(t.a+s,t.b+s,t.c+s);d.normal.copy(t.normal),void 0!==n&&d.normal.applyMatrix3(n).normalize();for(let e=0,t=c.length;e<t;e++)o=c[e].clone(),void 0!==n&&o.applyMatrix3(n).normalize(),d.vertexNormals.push(o);d.color.copy(t.color);for(let e=0,t=h.length;e<t;e++)r=h[e],d.vertexColors.push(r.clone());d.materialIndex=t.materialIndex+i,a.push(d)}for(let t=0,i=e.faceVertexUvs.length;t<i;t++){const i=e.faceVertexUvs[t];void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]);for(let e=0,n=i.length;e<n;e++){const n=i[e],s=[];for(let e=0,t=n.length;e<t;e++)s.push(n[e].clone());this.faceVertexUvs[t].push(s)}}},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(e=4){const t={},i=[],n=[],s=Math.pow(10,e);for(let e=0,o=this.vertices.length;e<o;e++){const o=this.vertices[e],r=Math.round(o.x*s)+"_"+Math.round(o.y*s)+"_"+Math.round(o.z*s);void 0===t[r]?(t[r]=e,i.push(this.vertices[e]),n[e]=i.length-1):n[e]=n[t[r]]}const o=[];for(let e=0,t=this.faces.length;e<t;e++){const t=this.faces[e];t.a=n[t.a],t.b=n[t.b],t.c=n[t.c];const i=[t.a,t.b,t.c];for(let t=0;t<3;t++)if(i[t]===i[(t+1)%3]){o.push(e);break}}for(let e=o.length-1;e>=0;e--){const t=o[e];this.faces.splice(t,1);for(let e=0,i=this.faceVertexUvs.length;e<i;e++)this.faceVertexUvs[e].splice(t,1)}const r=this.vertices.length-i.length;return this.vertices=i,r},setFromPoints:function(e){this.vertices=[];for(let t=0,i=e.length;t<i;t++){const i=e[t];this.vertices.push(new Vector3(i.x,i.y,i.z||0))}return this},sortFacesByMaterialIndex:function(){const e=this.faces,t=e.length;for(let i=0;i<t;i++)e[i]._id=i;e.sort((function(e,t){return e.materialIndex-t.materialIndex}));const i=this.faceVertexUvs[0],n=this.faceVertexUvs[1];let s,o;i&&i.length===t&&(s=[]),n&&n.length===t&&(o=[]);for(let r=0;r<t;r++){const t=e[r]._id;s&&s.push(i[t]),o&&o.push(n[t])}s&&(this.faceVertexUvs[0]=s),o&&(this.faceVertexUvs[1]=o)},toJSON:function(){const e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){const t=this.parameters;for(const i in t)void 0!==t[i]&&(e[i]=t[i]);return e}const t=[];for(let e=0;e<this.vertices.length;e++){const i=this.vertices[e];t.push(i.x,i.y,i.z)}const i=[],n=[],s={},o=[],r={},a=[],l={};for(let e=0;e<this.faces.length;e++){const t=this.faces[e],n=!0,s=!1,o=void 0!==this.faceVertexUvs[0][e],r=t.normal.length()>0,a=t.vertexNormals.length>0,l=1!==t.color.r||1!==t.color.g||1!==t.color.b,p=t.vertexColors.length>0;let m=0;if(m=c(m,0,0),m=c(m,1,n),m=c(m,2,s),m=c(m,3,o),m=c(m,4,r),m=c(m,5,a),m=c(m,6,l),m=c(m,7,p),i.push(m),i.push(t.a,t.b,t.c),i.push(t.materialIndex),o){const t=this.faceVertexUvs[0][e];i.push(u(t[0]),u(t[1]),u(t[2]))}if(r&&i.push(h(t.normal)),a){const e=t.vertexNormals;i.push(h(e[0]),h(e[1]),h(e[2]))}if(l&&i.push(d(t.color)),p){const e=t.vertexColors;i.push(d(e[0]),d(e[1]),d(e[2]))}}function c(e,t,i){return i?e|1<<t:e&~(1<<t)}function h(e){const t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==s[t]||(s[t]=n.length/3,n.push(e.x,e.y,e.z)),s[t]}function d(e){const t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==r[t]||(r[t]=o.length,o.push(e.getHex())),r[t]}function u(e){const t=e.x.toString()+e.y.toString();return void 0!==l[t]||(l[t]=a.length/2,a.push(e.x,e.y)),l[t]}return e.data={},e.data.vertices=t,e.data.normals=n,o.length>0&&(e.data.colors=o),a.length>0&&(e.data.uvs=[a]),e.data.faces=i,e},clone:function(){return(new Ol).copy(this)},copy:function(e){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;const t=e.vertices;for(let e=0,i=t.length;e<i;e++)this.vertices.push(t[e].clone());const i=e.colors;for(let e=0,t=i.length;e<t;e++)this.colors.push(i[e].clone());const n=e.faces;for(let e=0,t=n.length;e<t;e++)this.faces.push(n[e].clone());for(let t=0,i=e.faceVertexUvs.length;t<i;t++){const i=e.faceVertexUvs[t];void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]);for(let e=0,n=i.length;e<n;e++){const n=i[e],s=[];for(let e=0,t=n.length;e<t;e++){const t=n[e];s.push(t.clone())}this.faceVertexUvs[t].push(s)}}const s=e.morphTargets;for(let e=0,t=s.length;e<t;e++){const t={};if(t.name=s[e].name,void 0!==s[e].vertices){t.vertices=[];for(let i=0,n=s[e].vertices.length;i<n;i++)t.vertices.push(s[e].vertices[i].clone())}if(void 0!==s[e].normals){t.normals=[];for(let i=0,n=s[e].normals.length;i<n;i++)t.normals.push(s[e].normals[i].clone())}this.morphTargets.push(t)}const o=e.morphNormals;for(let e=0,t=o.length;e<t;e++){const t={};if(void 0!==o[e].vertexNormals){t.vertexNormals=[];for(let i=0,n=o[e].vertexNormals.length;i<n;i++){const n=o[e].vertexNormals[i],s={};s.a=n.a.clone(),s.b=n.b.clone(),s.c=n.c.clone(),t.vertexNormals.push(s)}}if(void 0!==o[e].faceNormals){t.faceNormals=[];for(let i=0,n=o[e].faceNormals.length;i<n;i++)t.faceNormals.push(o[e].faceNormals[i].clone())}this.morphNormals.push(t)}const r=e.skinWeights;for(let e=0,t=r.length;e<t;e++)this.skinWeights.push(r[e].clone());const a=e.skinIndices;for(let e=0,t=a.length;e<t;e++)this.skinIndices.push(a[e].clone());const l=e.lineDistances;for(let e=0,t=l.length;e<t;e++)this.lineDistances.push(l[e]);const c=e.boundingBox;null!==c&&(this.boundingBox=c.clone());const h=e.boundingSphere;return null!==h&&(this.boundingSphere=h.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});class BoxGeometry extends Ol{constructor(e,t,i,n,s,o){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:n,heightSegments:s,depthSegments:o},this.fromBufferGeometry(new BoxBufferGeometry(e,t,i,n,s,o)),this.mergeVertices()}}class CircleBufferGeometry extends Ds{constructor(e=1,t=8,i=0,n=2*Math.PI){super(),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:n},t=Math.max(3,t);const s=[],o=[],r=[],a=[],l=new Vector3,c=new Vector2;o.push(0,0,0),r.push(0,0,1),a.push(.5,.5);for(let s=0,h=3;s<=t;s++,h+=3){const d=i+s/t*n;l.x=e*Math.cos(d),l.y=e*Math.sin(d),o.push(l.x,l.y,l.z),r.push(0,0,1),c.x=(o[h]/e+1)/2,c.y=(o[h+1]/e+1)/2,a.push(c.x,c.y)}for(let e=1;e<=t;e++)s.push(e,e+1,0);this.setIndex(s),this.setAttribute("position",new bs(o,3)),this.setAttribute("normal",new bs(r,3)),this.setAttribute("uv",new bs(a,2))}}class CircleGeometry extends Ol{constructor(e,t,i,n){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:n},this.fromBufferGeometry(new CircleBufferGeometry(e,t,i,n)),this.mergeVertices()}}class CylinderBufferGeometry extends Ds{constructor(e=1,t=1,i=1,n=8,s=1,o=!1,r=0,a=2*Math.PI){super(),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:n,heightSegments:s,openEnded:o,thetaStart:r,thetaLength:a};const l=this;n=Math.floor(n),s=Math.floor(s);const c=[],h=[],d=[],u=[];let p=0;const m=[],g=i/2;let f=0;function v(i){const s=p,o=new Vector2,m=new Vector3;let v=0;const y=!0===i?e:t,b=!0===i?1:-1;for(let e=1;e<=n;e++)h.push(0,g*b,0),d.push(0,b,0),u.push(.5,.5),p++;const w=p;for(let e=0;e<=n;e++){const t=e/n*a+r,i=Math.cos(t),s=Math.sin(t);m.x=y*s,m.y=g*b,m.z=y*i,h.push(m.x,m.y,m.z),d.push(0,b,0),o.x=.5*i+.5,o.y=.5*s*b+.5,u.push(o.x,o.y),p++}for(let e=0;e<n;e++){const t=s+e,n=w+e;!0===i?c.push(n,n+1,t):c.push(n+1,n,t),v+=3}l.addGroup(f,v,!0===i?1:2),f+=v}!function(){const o=new Vector3,v=new Vector3;let y=0;const b=(t-e)/i;for(let l=0;l<=s;l++){const c=[],f=l/s,y=f*(t-e)+e;for(let e=0;e<=n;e++){const t=e/n,s=t*a+r,l=Math.sin(s),m=Math.cos(s);v.x=y*l,v.y=-f*i+g,v.z=y*m,h.push(v.x,v.y,v.z),o.set(l,b,m).normalize(),d.push(o.x,o.y,o.z),u.push(t,1-f),c.push(p++)}m.push(c)}for(let e=0;e<n;e++)for(let t=0;t<s;t++){const i=m[t][e],n=m[t+1][e],s=m[t+1][e+1],o=m[t][e+1];c.push(i,n,o),c.push(n,s,o),y+=6}l.addGroup(f,y,0),f+=y}(),!1===o&&(e>0&&v(!0),t>0&&v(!1)),this.setIndex(c),this.setAttribute("position",new bs(h,3)),this.setAttribute("normal",new bs(d,3)),this.setAttribute("uv",new bs(u,2))}}class CylinderGeometry extends Ol{constructor(e,t,i,n,s,o,r,a){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:n,heightSegments:s,openEnded:o,thetaStart:r,thetaLength:a},this.fromBufferGeometry(new CylinderBufferGeometry(e,t,i,n,s,o,r,a)),this.mergeVertices()}}class ConeGeometry extends CylinderGeometry{constructor(e,t,i,n,s,o,r){super(0,e,t,i,n,s,o,r),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:n,openEnded:s,thetaStart:o,thetaLength:r}}}class ConeBufferGeometry extends CylinderBufferGeometry{constructor(e=1,t=1,i=8,n=1,s=!1,o=0,r=2*Math.PI){super(0,e,t,i,n,s,o,r),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:n,openEnded:s,thetaStart:o,thetaLength:r}}}class PolyhedronBufferGeometry extends Ds{constructor(e,t,i=1,n=0){super(),this.type="PolyhedronBufferGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:n};const s=[],o=[];function r(e,t,i,n){const s=n+1,o=[];for(let n=0;n<=s;n++){o[n]=[];const r=e.clone().lerp(i,n/s),a=t.clone().lerp(i,n/s),l=s-n;for(let e=0;e<=l;e++)o[n][e]=0===e&&n===s?r:r.clone().lerp(a,e/l)}for(let e=0;e<s;e++)for(let t=0;t<2*(s-e)-1;t++){const i=Math.floor(t/2);t%2==0?(a(o[e][i+1]),a(o[e+1][i]),a(o[e][i])):(a(o[e][i+1]),a(o[e+1][i+1]),a(o[e+1][i]))}}function a(e){s.push(e.x,e.y,e.z)}function l(t,i){const n=3*t;i.x=e[n+0],i.y=e[n+1],i.z=e[n+2]}function c(e,t,i,n){n<0&&1===e.x&&(o[t]=e.x-1),0===i.x&&0===i.z&&(o[t]=n/2/Math.PI+.5)}function h(e){return Math.atan2(e.z,-e.x)}!function(e){const i=new Vector3,n=new Vector3,s=new Vector3;for(let o=0;o<t.length;o+=3)l(t[o+0],i),l(t[o+1],n),l(t[o+2],s),r(i,n,s,e)}(n),function(e){const t=new Vector3;for(let i=0;i<s.length;i+=3)t.x=s[i+0],t.y=s[i+1],t.z=s[i+2],t.normalize().multiplyScalar(e),s[i+0]=t.x,s[i+1]=t.y,s[i+2]=t.z}(i),function(){const e=new Vector3;for(let i=0;i<s.length;i+=3){e.x=s[i+0],e.y=s[i+1],e.z=s[i+2];const n=h(e)/2/Math.PI+.5,r=(t=e,Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5);o.push(n,1-r)}var t;(function(){const e=new Vector3,t=new Vector3,i=new Vector3,n=new Vector3,r=new Vector2,a=new Vector2,l=new Vector2;for(let d=0,u=0;d<s.length;d+=9,u+=6){e.set(s[d+0],s[d+1],s[d+2]),t.set(s[d+3],s[d+4],s[d+5]),i.set(s[d+6],s[d+7],s[d+8]),r.set(o[u+0],o[u+1]),a.set(o[u+2],o[u+3]),l.set(o[u+4],o[u+5]),n.copy(e).add(t).add(i).divideScalar(3);const p=h(n);c(r,u+0,e,p),c(a,u+2,t,p),c(l,u+4,i,p)}})(),function(){for(let e=0;e<o.length;e+=6){const t=o[e+0],i=o[e+2],n=o[e+4],s=Math.max(t,i,n),r=Math.min(t,i,n);s>.9&&r<.1&&(t<.2&&(o[e+0]+=1),i<.2&&(o[e+2]+=1),n<.2&&(o[e+4]+=1))}}()}(),this.setAttribute("position",new bs(s,3)),this.setAttribute("normal",new bs(s.slice(),3)),this.setAttribute("uv",new bs(o,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}}class DodecahedronBufferGeometry extends PolyhedronBufferGeometry{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2,n=1/i;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-i,0,-n,i,0,n,-i,0,n,i,-n,-i,0,-n,i,0,n,-i,0,n,i,0,-i,0,-n,i,0,-n,-i,0,n,i,0,n],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}}class DodecahedronGeometry extends Ol{constructor(e,t){super(),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new DodecahedronBufferGeometry(e,t)),this.mergeVertices()}}const Pl=new Vector3,Cl=new Vector3,Dl=new Vector3,Il=new Triangle;class EdgesGeometry extends Ds{constructor(e,t){super(),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0!==t?t:1,e.isGeometry&&(e=(new Ds).fromGeometry(e));const i=Math.pow(10,4),n=Math.cos(Fi.DEG2RAD*t),s=e.getIndex(),o=e.getAttribute("position"),r=s?s.count:o.count,a=[0,0,0],l=["a","b","c"],c=new Array(3),h={},d=[];for(let e=0;e<r;e+=3){s?(a[0]=s.getX(e),a[1]=s.getX(e+1),a[2]=s.getX(e+2)):(a[0]=e,a[1]=e+1,a[2]=e+2);const{a:t,b:r,c:u}=Il;if(t.fromBufferAttribute(o,a[0]),r.fromBufferAttribute(o,a[1]),u.fromBufferAttribute(o,a[2]),Il.getNormal(Dl),c[0]=`${Math.round(t.x*i)},${Math.round(t.y*i)},${Math.round(t.z*i)}`,c[1]=`${Math.round(r.x*i)},${Math.round(r.y*i)},${Math.round(r.z*i)}`,c[2]=`${Math.round(u.x*i)},${Math.round(u.y*i)},${Math.round(u.z*i)}`,c[0]!==c[1]&&c[1]!==c[2]&&c[2]!==c[0])for(let e=0;e<3;e++){const t=(e+1)%3,i=c[e],s=c[t],o=Il[l[e]],r=Il[l[t]],u=`${i}_${s}`,p=`${s}_${i}`;p in h&&h[p]?(Dl.dot(h[p].normal)<=n&&(d.push(o.x,o.y,o.z),d.push(r.x,r.y,r.z)),h[p]=null):u in h||(h[u]={index0:a[e],index1:a[t],normal:Dl.clone()})}}for(const e in h)if(h[e]){const{index0:t,index1:i}=h[e];Pl.fromBufferAttribute(o,t),Cl.fromBufferAttribute(o,i),d.push(Pl.x,Pl.y,Pl.z),d.push(Cl.x,Cl.y,Cl.z)}this.setAttribute("position",new bs(d,3))}}const Rl=function(e,t,i){i=i||2;const n=t&&t.length,s=n?t[0]*i:e.length;let o=Ll(e,0,s,i,!0);const r=[];if(!o||o.next===o.prev)return r;let a,l,c,h,d,u,p;if(n&&(o=function(e,t,i,n){const s=[];let o,r,a,l,c;for(o=0,r=t.length;o<r;o++)a=t[o]*n,l=o<r-1?t[o+1]*n:e.length,c=Ll(e,a,l,n,!1),c===c.next&&(c.steiner=!0),s.push(Wl(c));for(s.sort(Hl),o=0;o<s.length;o++)Gl(s[o],i),i=Nl(i,i.next);return i}(e,t,o,i)),e.length>80*i){a=c=e[0],l=h=e[1];for(let t=i;t<s;t+=i)d=e[t],u=e[t+1],d<a&&(a=d),u<l&&(l=u),d>c&&(c=d),u>h&&(h=u);p=Math.max(c-a,h-l),p=0!==p?1/p:0}return kl(o,r,i,a,l,p),r};function Ll(e,t,i,n,s){let o,r;if(s===function(e,t,i,n){let s=0;for(let o=t,r=i-n;o<i;o+=n)s+=(e[r]-e[o])*(e[o+1]+e[r+1]),r=o;return s}(e,t,i,n)>0)for(o=t;o<i;o+=n)r=tc(o,e[o],e[o+1],r);else for(o=i-n;o>=t;o-=n)r=tc(o,e[o],e[o+1],r);return r&&Yl(r,r.next)&&(ic(r),r=r.next),r}function Nl(e,t){if(!e)return e;t||(t=e);let i,n=e;do{if(i=!1,n.steiner||!Yl(n,n.next)&&0!==Kl(n.prev,n,n.next))n=n.next;else{if(ic(n),n=t=n.prev,n===n.next)break;i=!0}}while(i||n!==t);return t}function kl(e,t,i,n,s,o,r){if(!e)return;!r&&o&&function(e,t,i,n){let s=e;do{null===s.z&&(s.z=jl(s.x,s.y,t,i,n)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next}while(s!==e);s.prevZ.nextZ=null,s.prevZ=null,function(e){let t,i,n,s,o,r,a,l,c=1;do{for(i=e,e=null,o=null,r=0;i;){for(r++,n=i,a=0,t=0;t<c&&(a++,n=n.nextZ,n);t++);for(l=c;a>0||l>0&&n;)0!==a&&(0===l||!n||i.z<=n.z)?(s=i,i=i.nextZ,a--):(s=n,n=n.nextZ,l--),o?o.nextZ=s:e=s,s.prevZ=o,o=s;i=n}o.nextZ=null,c*=2}while(r>1)}(s)}(e,n,s,o);let a,l,c=e;for(;e.prev!==e.next;)if(a=e.prev,l=e.next,o?Fl(e,n,s,o):Bl(e))t.push(a.i/i),t.push(e.i/i),t.push(l.i/i),ic(e),e=l.next,c=l.next;else if((e=l)===c){r?1===r?kl(e=Ul(Nl(e),t,i),t,i,n,s,o,2):2===r&&Vl(e,t,i,n,s,o):kl(Nl(e),t,i,n,s,o,1);break}}function Bl(e){const t=e.prev,i=e,n=e.next;if(Kl(t,i,n)>=0)return!1;let s=e.next.next;for(;s!==e.prev;){if(Zl(t.x,t.y,i.x,i.y,n.x,n.y,s.x,s.y)&&Kl(s.prev,s,s.next)>=0)return!1;s=s.next}return!0}function Fl(e,t,i,n){const s=e.prev,o=e,r=e.next;if(Kl(s,o,r)>=0)return!1;const a=s.x<o.x?s.x<r.x?s.x:r.x:o.x<r.x?o.x:r.x,l=s.y<o.y?s.y<r.y?s.y:r.y:o.y<r.y?o.y:r.y,c=s.x>o.x?s.x>r.x?s.x:r.x:o.x>r.x?o.x:r.x,h=s.y>o.y?s.y>r.y?s.y:r.y:o.y>r.y?o.y:r.y,d=jl(a,l,t,i,n),u=jl(c,h,t,i,n);let p=e.prevZ,m=e.nextZ;for(;p&&p.z>=d&&m&&m.z<=u;){if(p!==e.prev&&p!==e.next&&Zl(s.x,s.y,o.x,o.y,r.x,r.y,p.x,p.y)&&Kl(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,m!==e.prev&&m!==e.next&&Zl(s.x,s.y,o.x,o.y,r.x,r.y,m.x,m.y)&&Kl(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;p&&p.z>=d;){if(p!==e.prev&&p!==e.next&&Zl(s.x,s.y,o.x,o.y,r.x,r.y,p.x,p.y)&&Kl(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;m&&m.z<=u;){if(m!==e.prev&&m!==e.next&&Zl(s.x,s.y,o.x,o.y,r.x,r.y,m.x,m.y)&&Kl(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function Ul(e,t,i){let n=e;do{const s=n.prev,o=n.next.next;!Yl(s,o)&&$l(s,n,n.next,o)&&Jl(s,o)&&Jl(o,s)&&(t.push(s.i/i),t.push(n.i/i),t.push(o.i/i),ic(n),ic(n.next),n=e=o),n=n.next}while(n!==e);return Nl(n)}function Vl(e,t,i,n,s,o){let r=e;do{let e=r.next.next;for(;e!==r.prev;){if(r.i!==e.i&&ql(r,e)){let a=ec(r,e);return r=Nl(r,r.next),a=Nl(a,a.next),kl(r,t,i,n,s,o),void kl(a,t,i,n,s,o)}e=e.next}r=r.next}while(r!==e)}function Hl(e,t){return e.x-t.x}function Gl(e,t){if(t=function(e,t){let i=t;const n=e.x,s=e.y;let o,r=-1/0;do{if(s<=i.y&&s>=i.next.y&&i.next.y!==i.y){const e=i.x+(s-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(e<=n&&e>r){if(r=e,e===n){if(s===i.y)return i;if(s===i.next.y)return i.next}o=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!o)return null;if(n===r)return o;const a=o,l=o.x,c=o.y;let h,d=1/0;i=o;do{n>=i.x&&i.x>=l&&n!==i.x&&Zl(s<c?n:r,s,l,c,s<c?r:n,s,i.x,i.y)&&(h=Math.abs(s-i.y)/(n-i.x),Jl(i,e)&&(h<d||h===d&&(i.x>o.x||i.x===o.x&&zl(o,i)))&&(o=i,d=h)),i=i.next}while(i!==a);return o}(e,t)){const i=ec(t,e);Nl(t,t.next),Nl(i,i.next)}}function zl(e,t){return Kl(e.prev,e,t.prev)<0&&Kl(t.next,e,e.next)<0}function jl(e,t,i,n,s){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*s)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*s)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Wl(e){let t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function Zl(e,t,i,n,s,o,r,a){return(s-r)*(t-a)-(e-r)*(o-a)>=0&&(e-r)*(n-a)-(i-r)*(t-a)>=0&&(i-r)*(o-a)-(s-r)*(n-a)>=0}function ql(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&$l(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(Jl(e,t)&&Jl(t,e)&&function(e,t){let i=e,n=!1;const s=(e.x+t.x)/2,o=(e.y+t.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&s<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==e);return n}(e,t)&&(Kl(e.prev,e,t.prev)||Kl(e,t.prev,t))||Yl(e,t)&&Kl(e.prev,e,e.next)>0&&Kl(t.prev,t,t.next)>0)}function Kl(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function Yl(e,t){return e.x===t.x&&e.y===t.y}function $l(e,t,i,n){const s=Ql(Kl(e,t,i)),o=Ql(Kl(e,t,n)),r=Ql(Kl(i,n,e)),a=Ql(Kl(i,n,t));return s!==o&&r!==a||(!(0!==s||!Xl(e,i,t))||(!(0!==o||!Xl(e,n,t))||(!(0!==r||!Xl(i,e,n))||!(0!==a||!Xl(i,t,n)))))}function Xl(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function Ql(e){return e>0?1:e<0?-1:0}function Jl(e,t){return Kl(e.prev,e,e.next)<0?Kl(e,t,e.next)>=0&&Kl(e,e.prev,t)>=0:Kl(e,t,e.prev)<0||Kl(e,e.next,t)<0}function ec(e,t){const i=new nc(e.i,e.x,e.y),n=new nc(t.i,t.x,t.y),s=e.next,o=t.prev;return e.next=t,t.prev=e,i.next=s,s.prev=i,n.next=i,i.prev=n,o.next=n,n.prev=o,n}function tc(e,t,i,n){const s=new nc(e,t,i);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s}function ic(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function nc(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}const sc={area:function(e){const t=e.length;let i=0;for(let n=t-1,s=0;s<t;n=s++)i+=e[n].x*e[s].y-e[s].x*e[n].y;return.5*i},isClockWise:function(e){return sc.area(e)<0},triangulateShape:function(e,t){const i=[],n=[],s=[];oc(e),rc(i,e);let o=e.length;t.forEach(oc);for(let e=0;e<t.length;e++)n.push(o),o+=t[e].length,rc(i,t[e]);const r=Rl(i,n);for(let e=0;e<r.length;e+=3)s.push(r.slice(e,e+3));return s}};function oc(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function rc(e,t){for(let i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}class ExtrudeBufferGeometry extends Ds{constructor(e,t){super(),this.type="ExtrudeBufferGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const i=this,n=[],s=[];for(let t=0,i=e.length;t<i;t++){o(e[t])}function o(e){const o=[],r=void 0!==t.curveSegments?t.curveSegments:12,a=void 0!==t.steps?t.steps:1;let l=void 0!==t.depth?t.depth:100,c=void 0===t.bevelEnabled||t.bevelEnabled,h=void 0!==t.bevelThickness?t.bevelThickness:6,d=void 0!==t.bevelSize?t.bevelSize:h-2,u=void 0!==t.bevelOffset?t.bevelOffset:0,p=void 0!==t.bevelSegments?t.bevelSegments:3;const m=t.extrudePath,g=void 0!==t.UVGenerator?t.UVGenerator:ac;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=t.amount);let f,v,y,b,w,S=!1;m&&(f=m.getSpacedPoints(a),S=!0,c=!1,v=m.computeFrenetFrames(a,!1),y=new Vector3,b=new Vector3,w=new Vector3),c||(p=0,h=0,d=0,u=0);const E=e.extractPoints(r);let T=E.shape;const M=E.holes;if(!sc.isClockWise(T)){T=T.reverse();for(let e=0,t=M.length;e<t;e++){const t=M[e];sc.isClockWise(t)&&(M[e]=t.reverse())}}const _=sc.triangulateShape(T,M),x=T;for(let e=0,t=M.length;e<t;e++){const t=M[e];T=T.concat(t)}function A(e,t,i){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(i).add(e)}const O=T.length,P=_.length;function C(e,t,i){let n,s,o;const r=e.x-t.x,a=e.y-t.y,l=i.x-e.x,c=i.y-e.y,h=r*r+a*a,d=r*c-a*l;if(Math.abs(d)>Number.EPSILON){const d=Math.sqrt(h),u=Math.sqrt(l*l+c*c),p=t.x-a/d,m=t.y+r/d,g=((i.x-c/u-p)*c-(i.y+l/u-m)*l)/(r*c-a*l);n=p+r*g-e.x,s=m+a*g-e.y;const f=n*n+s*s;if(f<=2)return new Vector2(n,s);o=Math.sqrt(f/2)}else{let e=!1;r>Number.EPSILON?l>Number.EPSILON&&(e=!0):r<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(a)===Math.sign(c)&&(e=!0),e?(n=-a,s=r,o=Math.sqrt(h)):(n=r,s=a,o=Math.sqrt(h/2))}return new Vector2(n/o,s/o)}const D=[];for(let e=0,t=x.length,i=t-1,n=e+1;e<t;e++,i++,n++)i===t&&(i=0),n===t&&(n=0),D[e]=C(x[e],x[i],x[n]);const I=[];let R,L=D.concat();for(let e=0,t=M.length;e<t;e++){const t=M[e];R=[];for(let e=0,i=t.length,n=i-1,s=e+1;e<i;e++,n++,s++)n===i&&(n=0),s===i&&(s=0),R[e]=C(t[e],t[n],t[s]);I.push(R),L=L.concat(R)}for(let e=0;e<p;e++){const t=e/p,i=h*Math.cos(t*Math.PI/2),n=d*Math.sin(t*Math.PI/2)+u;for(let e=0,t=x.length;e<t;e++){const t=A(x[e],D[e],n);B(t.x,t.y,-i)}for(let e=0,t=M.length;e<t;e++){const t=M[e];R=I[e];for(let e=0,s=t.length;e<s;e++){const s=A(t[e],R[e],n);B(s.x,s.y,-i)}}}const N=d+u;for(let e=0;e<O;e++){const t=c?A(T[e],L[e],N):T[e];S?(b.copy(v.normals[0]).multiplyScalar(t.x),y.copy(v.binormals[0]).multiplyScalar(t.y),w.copy(f[0]).add(b).add(y),B(w.x,w.y,w.z)):B(t.x,t.y,0)}for(let e=1;e<=a;e++)for(let t=0;t<O;t++){const i=c?A(T[t],L[t],N):T[t];S?(b.copy(v.normals[e]).multiplyScalar(i.x),y.copy(v.binormals[e]).multiplyScalar(i.y),w.copy(f[e]).add(b).add(y),B(w.x,w.y,w.z)):B(i.x,i.y,l/a*e)}for(let e=p-1;e>=0;e--){const t=e/p,i=h*Math.cos(t*Math.PI/2),n=d*Math.sin(t*Math.PI/2)+u;for(let e=0,t=x.length;e<t;e++){const t=A(x[e],D[e],n);B(t.x,t.y,l+i)}for(let e=0,t=M.length;e<t;e++){const t=M[e];R=I[e];for(let e=0,s=t.length;e<s;e++){const s=A(t[e],R[e],n);S?B(s.x,s.y+f[a-1].y,f[a-1].x+i):B(s.x,s.y,l+i)}}}function k(e,t){let i=e.length;for(;--i>=0;){const n=i;let s=i-1;s<0&&(s=e.length-1);for(let e=0,i=a+2*p;e<i;e++){const i=O*e,o=O*(e+1);U(t+n+i,t+s+i,t+s+o,t+n+o)}}}function B(e,t,i){o.push(e),o.push(t),o.push(i)}function F(e,t,s){V(e),V(t),V(s);const o=n.length/3,r=g.generateTopUV(i,n,o-3,o-2,o-1);H(r[0]),H(r[1]),H(r[2])}function U(e,t,s,o){V(e),V(t),V(o),V(t),V(s),V(o);const r=n.length/3,a=g.generateSideWallUV(i,n,r-6,r-3,r-2,r-1);H(a[0]),H(a[1]),H(a[3]),H(a[1]),H(a[2]),H(a[3])}function V(e){n.push(o[3*e+0]),n.push(o[3*e+1]),n.push(o[3*e+2])}function H(e){s.push(e.x),s.push(e.y)}!function(){const e=n.length/3;if(c){let e=0,t=O*e;for(let e=0;e<P;e++){const i=_[e];F(i[2]+t,i[1]+t,i[0]+t)}e=a+2*p,t=O*e;for(let e=0;e<P;e++){const i=_[e];F(i[0]+t,i[1]+t,i[2]+t)}}else{for(let e=0;e<P;e++){const t=_[e];F(t[2],t[1],t[0])}for(let e=0;e<P;e++){const t=_[e];F(t[0]+O*a,t[1]+O*a,t[2]+O*a)}}i.addGroup(e,n.length/3-e,0)}(),function(){const e=n.length/3;let t=0;k(x,t),t+=x.length;for(let e=0,i=M.length;e<i;e++){const i=M[e];k(i,t),t+=i.length}i.addGroup(e,n.length/3-e,1)}()}this.setAttribute("position",new bs(n,3)),this.setAttribute("uv",new bs(s,2)),this.computeVertexNormals()}toJSON(){const e=Ds.prototype.toJSON.call(this);return function(e,t,i){if(i.shapes=[],Array.isArray(e))for(let t=0,n=e.length;t<n;t++){const n=e[t];i.shapes.push(n.uuid)}else i.shapes.push(e.uuid);void 0!==t.extrudePath&&(i.options.extrudePath=t.extrudePath.toJSON());return i}(this.parameters.shapes,this.parameters.options,e)}}const ac={generateTopUV:function(e,t,i,n,s){const o=t[3*i],r=t[3*i+1],a=t[3*n],l=t[3*n+1],c=t[3*s],h=t[3*s+1];return[new Vector2(o,r),new Vector2(a,l),new Vector2(c,h)]},generateSideWallUV:function(e,t,i,n,s,o){const r=t[3*i],a=t[3*i+1],l=t[3*i+2],c=t[3*n],h=t[3*n+1],d=t[3*n+2],u=t[3*s],p=t[3*s+1],m=t[3*s+2],g=t[3*o],f=t[3*o+1],v=t[3*o+2];return Math.abs(a-h)<.01?[new Vector2(r,1-l),new Vector2(c,1-d),new Vector2(u,1-m),new Vector2(g,1-v)]:[new Vector2(a,1-l),new Vector2(h,1-d),new Vector2(p,1-m),new Vector2(f,1-v)]}};class ExtrudeGeometry extends Ol{constructor(e,t){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new ExtrudeBufferGeometry(e,t)),this.mergeVertices()}toJSON(){const e=super.toJSON();return function(e,t,i){if(i.shapes=[],Array.isArray(e))for(let t=0,n=e.length;t<n;t++){const n=e[t];i.shapes.push(n.uuid)}else i.shapes.push(e.uuid);void 0!==t.extrudePath&&(i.options.extrudePath=t.extrudePath.toJSON());return i}(this.parameters.shapes,this.parameters.options,e)}}class IcosahedronBufferGeometry extends PolyhedronBufferGeometry{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2;super([-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}}class IcosahedronGeometry extends Ol{constructor(e,t){super(),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new IcosahedronBufferGeometry(e,t)),this.mergeVertices()}}class LatheBufferGeometry extends Ds{constructor(e,t=12,i=0,n=2*Math.PI){super(),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:n},t=Math.floor(t),n=Fi.clamp(n,0,2*Math.PI);const s=[],o=[],r=[],a=1/t,l=new Vector3,c=new Vector2;for(let s=0;s<=t;s++){const h=i+s*a*n,d=Math.sin(h),u=Math.cos(h);for(let i=0;i<=e.length-1;i++)l.x=e[i].x*d,l.y=e[i].y,l.z=e[i].x*u,o.push(l.x,l.y,l.z),c.x=s/t,c.y=i/(e.length-1),r.push(c.x,c.y)}for(let i=0;i<t;i++)for(let t=0;t<e.length-1;t++){const n=t+i*e.length,o=n,r=n+e.length,a=n+e.length+1,l=n+1;s.push(o,r,l),s.push(r,a,l)}if(this.setIndex(s),this.setAttribute("position",new bs(o,3)),this.setAttribute("uv",new bs(r,2)),this.computeVertexNormals(),n===2*Math.PI){const i=this.attributes.normal.array,n=new Vector3,s=new Vector3,o=new Vector3,r=t*e.length*3;for(let t=0,a=0;t<e.length;t++,a+=3)n.x=i[a+0],n.y=i[a+1],n.z=i[a+2],s.x=i[r+a+0],s.y=i[r+a+1],s.z=i[r+a+2],o.addVectors(n,s).normalize(),i[a+0]=i[r+a+0]=o.x,i[a+1]=i[r+a+1]=o.y,i[a+2]=i[r+a+2]=o.z}}}class LatheGeometry extends Ol{constructor(e,t,i,n){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:n},this.fromBufferGeometry(new LatheBufferGeometry(e,t,i,n)),this.mergeVertices()}}class OctahedronBufferGeometry extends PolyhedronBufferGeometry{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}}class OctahedronGeometry extends Ol{constructor(e,t){super(),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new OctahedronBufferGeometry(e,t)),this.mergeVertices()}}function lc(e,t,i){Ds.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:i};const n=[],s=[],o=[],r=[],a=1e-5,l=new Vector3,c=new Vector3,h=new Vector3,d=new Vector3,u=new Vector3;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");const p=t+1;for(let n=0;n<=i;n++){const p=n/i;for(let i=0;i<=t;i++){const n=i/t;e(n,p,c),s.push(c.x,c.y,c.z),n-a>=0?(e(n-a,p,h),d.subVectors(c,h)):(e(n+a,p,h),d.subVectors(h,c)),p-a>=0?(e(n,p-a,h),u.subVectors(c,h)):(e(n,p+a,h),u.subVectors(h,c)),l.crossVectors(d,u).normalize(),o.push(l.x,l.y,l.z),r.push(n,p)}}for(let e=0;e<i;e++)for(let i=0;i<t;i++){const t=e*p+i,s=e*p+i+1,o=(e+1)*p+i+1,r=(e+1)*p+i;n.push(t,s,r),n.push(s,o,r)}this.setIndex(n),this.setAttribute("position",new bs(s,3)),this.setAttribute("normal",new bs(o,3)),this.setAttribute("uv",new bs(r,2))}function cc(e,t,i){Ol.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:i},this.fromBufferGeometry(new lc(e,t,i)),this.mergeVertices()}lc.prototype=Object.create(Ds.prototype),lc.prototype.constructor=lc,cc.prototype=Object.create(Ol.prototype),cc.prototype.constructor=cc;class PlaneGeometry extends Ol{constructor(e,t,i,n){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:n},this.fromBufferGeometry(new PlaneBufferGeometry(e,t,i,n)),this.mergeVertices()}}class PolyhedronGeometry extends Ol{constructor(e,t,i,n){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:n},this.fromBufferGeometry(new PolyhedronBufferGeometry(e,t,i,n)),this.mergeVertices()}}class RingBufferGeometry extends Ds{constructor(e=.5,t=1,i=8,n=1,s=0,o=2*Math.PI){super(),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:n,thetaStart:s,thetaLength:o},i=Math.max(3,i);const r=[],a=[],l=[],c=[];let h=e;const d=(t-e)/(n=Math.max(1,n)),u=new Vector3,p=new Vector2;for(let e=0;e<=n;e++){for(let e=0;e<=i;e++){const n=s+e/i*o;u.x=h*Math.cos(n),u.y=h*Math.sin(n),a.push(u.x,u.y,u.z),l.push(0,0,1),p.x=(u.x/t+1)/2,p.y=(u.y/t+1)/2,c.push(p.x,p.y)}h+=d}for(let e=0;e<n;e++){const t=e*(i+1);for(let e=0;e<i;e++){const n=e+t,s=n,o=n+i+1,a=n+i+2,l=n+1;r.push(s,o,l),r.push(o,a,l)}}this.setIndex(r),this.setAttribute("position",new bs(a,3)),this.setAttribute("normal",new bs(l,3)),this.setAttribute("uv",new bs(c,2))}}class RingGeometry extends Ol{constructor(e,t,i,n,s,o){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:n,thetaStart:s,thetaLength:o},this.fromBufferGeometry(new RingBufferGeometry(e,t,i,n,s,o)),this.mergeVertices()}}class ShapeBufferGeometry extends Ds{constructor(e,t=12){super(),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t};const i=[],n=[],s=[],o=[];let r=0,a=0;if(!1===Array.isArray(e))l(e);else for(let t=0;t<e.length;t++)l(e[t]),this.addGroup(r,a,t),r+=a,a=0;function l(e){const r=n.length/3,l=e.extractPoints(t);let c=l.shape;const h=l.holes;!1===sc.isClockWise(c)&&(c=c.reverse());for(let e=0,t=h.length;e<t;e++){const t=h[e];!0===sc.isClockWise(t)&&(h[e]=t.reverse())}const d=sc.triangulateShape(c,h);for(let e=0,t=h.length;e<t;e++){const t=h[e];c=c.concat(t)}for(let e=0,t=c.length;e<t;e++){const t=c[e];n.push(t.x,t.y,0),s.push(0,0,1),o.push(t.x,t.y)}for(let e=0,t=d.length;e<t;e++){const t=d[e],n=t[0]+r,s=t[1]+r,o=t[2]+r;i.push(n,s,o),a+=3}}this.setIndex(i),this.setAttribute("position",new bs(n,3)),this.setAttribute("normal",new bs(s,3)),this.setAttribute("uv",new bs(o,2))}toJSON(){const e=Ds.prototype.toJSON.call(this);return function(e,t){if(t.shapes=[],Array.isArray(e))for(let i=0,n=e.length;i<n;i++){const n=e[i];t.shapes.push(n.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}}class ShapeGeometry extends Ol{constructor(e,t){super(),this.type="ShapeGeometry","object"==typeof t&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new ShapeBufferGeometry(e,t)),this.mergeVertices()}toJSON(){const e=Ol.prototype.toJSON.call(this);return function(e,t){if(t.shapes=[],Array.isArray(e))for(let i=0,n=e.length;i<n;i++){const n=e[i];t.shapes.push(n.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}}class SphereBufferGeometry extends Ds{constructor(e=1,t=8,i=6,n=0,s=2*Math.PI,o=0,r=Math.PI){super(),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:n,phiLength:s,thetaStart:o,thetaLength:r},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const a=Math.min(o+r,Math.PI);let l=0;const c=[],h=new Vector3,d=new Vector3,u=[],p=[],m=[],g=[];for(let u=0;u<=i;u++){const f=[],v=u/i;let y=0;0==u&&0==o?y=.5/t:u==i&&a==Math.PI&&(y=-.5/t);for(let i=0;i<=t;i++){const a=i/t;h.x=-e*Math.cos(n+a*s)*Math.sin(o+v*r),h.y=e*Math.cos(o+v*r),h.z=e*Math.sin(n+a*s)*Math.sin(o+v*r),p.push(h.x,h.y,h.z),d.copy(h).normalize(),m.push(d.x,d.y,d.z),g.push(a+y,1-v),f.push(l++)}c.push(f)}for(let e=0;e<i;e++)for(let n=0;n<t;n++){const t=c[e][n+1],s=c[e][n],r=c[e+1][n],l=c[e+1][n+1];(0!==e||o>0)&&u.push(t,s,l),(e!==i-1||a<Math.PI)&&u.push(s,r,l)}this.setIndex(u),this.setAttribute("position",new bs(p,3)),this.setAttribute("normal",new bs(m,3)),this.setAttribute("uv",new bs(g,2))}}class SphereGeometry extends Ol{constructor(e,t,i,n,s,o,r){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:n,phiLength:s,thetaStart:o,thetaLength:r},this.fromBufferGeometry(new SphereBufferGeometry(e,t,i,n,s,o,r)),this.mergeVertices()}}class TetrahedronBufferGeometry extends PolyhedronBufferGeometry{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}}class TetrahedronGeometry extends Ol{constructor(e,t){super(),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new TetrahedronBufferGeometry(e,t)),this.mergeVertices()}}class TextBufferGeometry extends ExtrudeBufferGeometry{constructor(e,t={}){const i=t.font;if(!i||!i.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new Ds;const n=i.generateShapes(e,t.size);t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),super(n,t),this.type="TextBufferGeometry"}}class TextGeometry extends Ol{constructor(e,t){super(),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new TextBufferGeometry(e,t)),this.mergeVertices()}}class TorusBufferGeometry extends Ds{constructor(e=1,t=.4,i=8,n=6,s=2*Math.PI){super(),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:n,arc:s},i=Math.floor(i),n=Math.floor(n);const o=[],r=[],a=[],l=[],c=new Vector3,h=new Vector3,d=new Vector3;for(let o=0;o<=i;o++)for(let u=0;u<=n;u++){const p=u/n*s,m=o/i*Math.PI*2;h.x=(e+t*Math.cos(m))*Math.cos(p),h.y=(e+t*Math.cos(m))*Math.sin(p),h.z=t*Math.sin(m),r.push(h.x,h.y,h.z),c.x=e*Math.cos(p),c.y=e*Math.sin(p),d.subVectors(h,c).normalize(),a.push(d.x,d.y,d.z),l.push(u/n),l.push(o/i)}for(let e=1;e<=i;e++)for(let t=1;t<=n;t++){const i=(n+1)*e+t-1,s=(n+1)*(e-1)+t-1,r=(n+1)*(e-1)+t,a=(n+1)*e+t;o.push(i,s,a),o.push(s,r,a)}this.setIndex(o),this.setAttribute("position",new bs(r,3)),this.setAttribute("normal",new bs(a,3)),this.setAttribute("uv",new bs(l,2))}}class TorusGeometry extends Ol{constructor(e,t,i,n,s){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:n,arc:s},this.fromBufferGeometry(new TorusBufferGeometry(e,t,i,n,s)),this.mergeVertices()}}class TorusKnotBufferGeometry extends Ds{constructor(e=1,t=.4,i=64,n=8,s=2,o=3){super(),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:n,p:s,q:o},i=Math.floor(i),n=Math.floor(n);const r=[],a=[],l=[],c=[],h=new Vector3,d=new Vector3,u=new Vector3,p=new Vector3,m=new Vector3,g=new Vector3,f=new Vector3;for(let r=0;r<=i;++r){const y=r/i*s*Math.PI*2;v(y,s,o,e,u),v(y+.01,s,o,e,p),g.subVectors(p,u),f.addVectors(p,u),m.crossVectors(g,f),f.crossVectors(m,g),m.normalize(),f.normalize();for(let e=0;e<=n;++e){const s=e/n*Math.PI*2,o=-t*Math.cos(s),p=t*Math.sin(s);h.x=u.x+(o*f.x+p*m.x),h.y=u.y+(o*f.y+p*m.y),h.z=u.z+(o*f.z+p*m.z),a.push(h.x,h.y,h.z),d.subVectors(h,u).normalize(),l.push(d.x,d.y,d.z),c.push(r/i),c.push(e/n)}}for(let e=1;e<=i;e++)for(let t=1;t<=n;t++){const i=(n+1)*(e-1)+(t-1),s=(n+1)*e+(t-1),o=(n+1)*e+t,a=(n+1)*(e-1)+t;r.push(i,s,a),r.push(s,o,a)}function v(e,t,i,n,s){const o=Math.cos(e),r=Math.sin(e),a=i/t*e,l=Math.cos(a);s.x=n*(2+l)*.5*o,s.y=n*(2+l)*r*.5,s.z=n*Math.sin(a)*.5}this.setIndex(r),this.setAttribute("position",new bs(a,3)),this.setAttribute("normal",new bs(l,3)),this.setAttribute("uv",new bs(c,2))}}class TorusKnotGeometry extends Ol{constructor(e,t,i,n,s,o,r){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:n,p:s,q:o},void 0!==r&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new TorusKnotBufferGeometry(e,t,i,n,s,o)),this.mergeVertices()}}class TubeBufferGeometry extends Ds{constructor(e,t=64,i=1,n=8,s=!1){super(),this.type="TubeBufferGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:n,closed:s};const o=e.computeFrenetFrames(t,s);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const r=new Vector3,a=new Vector3,l=new Vector2;let c=new Vector3;const h=[],d=[],u=[],p=[];function m(s){c=e.getPointAt(s/t,c);const l=o.normals[s],u=o.binormals[s];for(let e=0;e<=n;e++){const t=e/n*Math.PI*2,s=Math.sin(t),o=-Math.cos(t);a.x=o*l.x+s*u.x,a.y=o*l.y+s*u.y,a.z=o*l.z+s*u.z,a.normalize(),d.push(a.x,a.y,a.z),r.x=c.x+i*a.x,r.y=c.y+i*a.y,r.z=c.z+i*a.z,h.push(r.x,r.y,r.z)}}!function(){for(let e=0;e<t;e++)m(e);m(!1===s?t:0),function(){for(let e=0;e<=t;e++)for(let i=0;i<=n;i++)l.x=e/t,l.y=i/n,u.push(l.x,l.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=n;t++){const i=(n+1)*(e-1)+(t-1),s=(n+1)*e+(t-1),o=(n+1)*e+t,r=(n+1)*(e-1)+t;p.push(i,s,r),p.push(s,o,r)}}()}(),this.setIndex(p),this.setAttribute("position",new bs(h,3)),this.setAttribute("normal",new bs(d,3)),this.setAttribute("uv",new bs(u,2))}toJSON(){const e=Ds.prototype.toJSON.call(this);return e.path=this.parameters.path.toJSON(),e}}class TubeGeometry extends Ol{constructor(e,t,i,n,s,o){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:n,closed:s},void 0!==o&&console.warn("THREE.TubeGeometry: taper has been removed.");const r=new TubeBufferGeometry(e,t,i,n,s);this.tangents=r.tangents,this.normals=r.normals,this.binormals=r.binormals,this.fromBufferGeometry(r),this.mergeVertices()}}class WireframeGeometry extends Ds{constructor(e){super(),this.type="WireframeGeometry";const t=[],i=[0,0],n={},s=["a","b","c"];if(e&&e.isGeometry){const o=e.faces;for(let e=0,t=o.length;e<t;e++){const t=o[e];for(let e=0;e<3;e++){const o=t[s[e]],r=t[s[(e+1)%3]];i[0]=Math.min(o,r),i[1]=Math.max(o,r);const a=i[0]+","+i[1];void 0===n[a]&&(n[a]={index1:i[0],index2:i[1]})}}for(const i in n){const s=n[i];let o=e.vertices[s.index1];t.push(o.x,o.y,o.z),o=e.vertices[s.index2],t.push(o.x,o.y,o.z)}}else if(e&&e.isBufferGeometry){const s=new Vector3;if(null!==e.index){const o=e.attributes.position,r=e.index;let a=e.groups;0===a.length&&(a=[{start:0,count:r.count,materialIndex:0}]);for(let e=0,t=a.length;e<t;++e){const t=a[e],s=t.start;for(let e=s,o=s+t.count;e<o;e+=3)for(let t=0;t<3;t++){const s=r.getX(e+t),o=r.getX(e+(t+1)%3);i[0]=Math.min(s,o),i[1]=Math.max(s,o);const a=i[0]+","+i[1];void 0===n[a]&&(n[a]={index1:i[0],index2:i[1]})}}for(const e in n){const i=n[e];s.fromBufferAttribute(o,i.index1),t.push(s.x,s.y,s.z),s.fromBufferAttribute(o,i.index2),t.push(s.x,s.y,s.z)}}else{const i=e.attributes.position;for(let e=0,n=i.count/3;e<n;e++)for(let n=0;n<3;n++){const o=3*e+n;s.fromBufferAttribute(i,o),t.push(s.x,s.y,s.z);const r=3*e+(n+1)%3;s.fromBufferAttribute(i,r),t.push(s.x,s.y,s.z)}}}this.setAttribute("position",new bs(t,3))}}var hc=Object.freeze({__proto__:null,BoxGeometry,BoxBufferGeometry,CircleGeometry,CircleBufferGeometry,ConeGeometry,ConeBufferGeometry,CylinderGeometry,CylinderBufferGeometry,DodecahedronGeometry,DodecahedronBufferGeometry,EdgesGeometry,ExtrudeGeometry,ExtrudeBufferGeometry,IcosahedronGeometry,IcosahedronBufferGeometry,LatheGeometry,LatheBufferGeometry,OctahedronGeometry,OctahedronBufferGeometry,ParametricGeometry:cc,ParametricBufferGeometry:lc,PlaneGeometry,PlaneBufferGeometry,PolyhedronGeometry,PolyhedronBufferGeometry,RingGeometry,RingBufferGeometry,ShapeGeometry,ShapeBufferGeometry,SphereGeometry,SphereBufferGeometry,TetrahedronGeometry,TetrahedronBufferGeometry,TextGeometry,TextBufferGeometry,TorusGeometry,TorusBufferGeometry,TorusKnotGeometry,TorusKnotBufferGeometry,TubeGeometry,TubeBufferGeometry,WireframeGeometry});function dc(e){rs.call(this),this.type="ShadowMaterial",this.color=new Color(0),this.transparent=!0,this.setValues(e)}function uc(e){to.call(this,e),this.type="RawShaderMaterial"}function pc(e){rs.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Color(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ri,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(e)}function mc(e){pc.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Vector2(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(e){this.reflectivity=Fi.clamp(2.5*(e-1)/(e+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.setValues(e)}function gc(e){rs.call(this),this.type="MeshPhongMaterial",this.color=new Color(16777215),this.specular=new Color(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ri,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Y,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function fc(e){rs.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Color(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ri,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function vc(e){rs.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ri,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function yc(e){rs.call(this),this.type="MeshLambertMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Y,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function bc(e){rs.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Color(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ri,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function wc(e){il.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}dc.prototype=Object.create(rs.prototype),dc.prototype.constructor=dc,dc.prototype.isShadowMaterial=!0,dc.prototype.copy=function(e){return rs.prototype.copy.call(this,e),this.color.copy(e.color),this},uc.prototype=Object.create(to.prototype),uc.prototype.constructor=uc,uc.prototype.isRawShaderMaterial=!0,pc.prototype=Object.create(rs.prototype),pc.prototype.constructor=pc,pc.prototype.isMeshStandardMaterial=!0,pc.prototype.copy=function(e){return rs.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.vertexTangents=e.vertexTangents,this},mc.prototype=Object.create(pc.prototype),mc.prototype.constructor=mc,mc.prototype.isMeshPhysicalMaterial=!0,mc.prototype.copy=function(e){return pc.prototype.copy.call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.reflectivity=e.reflectivity,e.sheen?this.sheen=(this.sheen||new Color).copy(e.sheen):this.sheen=null,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this},gc.prototype=Object.create(rs.prototype),gc.prototype.constructor=gc,gc.prototype.isMeshPhongMaterial=!0,gc.prototype.copy=function(e){return rs.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},fc.prototype=Object.create(rs.prototype),fc.prototype.constructor=fc,fc.prototype.isMeshToonMaterial=!0,fc.prototype.copy=function(e){return rs.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},vc.prototype=Object.create(rs.prototype),vc.prototype.constructor=vc,vc.prototype.isMeshNormalMaterial=!0,vc.prototype.copy=function(e){return rs.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},yc.prototype=Object.create(rs.prototype),yc.prototype.constructor=yc,yc.prototype.isMeshLambertMaterial=!0,yc.prototype.copy=function(e){return rs.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},bc.prototype=Object.create(rs.prototype),bc.prototype.constructor=bc,bc.prototype.isMeshMatcapMaterial=!0,bc.prototype.copy=function(e){return rs.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},wc.prototype=Object.create(il.prototype),wc.prototype.constructor=wc,wc.prototype.isLineDashedMaterial=!0,wc.prototype.copy=function(e){return il.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var Sc=Object.freeze({__proto__:null,ShadowMaterial:dc,SpriteMaterial:Ea,RawShaderMaterial:uc,ShaderMaterial:to,PointsMaterial:pl,MeshPhysicalMaterial:mc,MeshStandardMaterial:pc,MeshPhongMaterial:gc,MeshToonMaterial:fc,MeshNormalMaterial:vc,MeshLambertMaterial:yc,MeshDepthMaterial:ra,MeshDistanceMaterial:aa,MeshBasicMaterial:as,MeshMatcapMaterial:bc,LineDashedMaterial:wc,LineBasicMaterial:il,Material:rs});const Ec={arraySlice:function(e,t,i){return Ec.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==i?i:e.length)):e.slice(t,i)},convertArray:function(e,t,i){return!e||!i&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){const t=e.length,i=new Array(t);for(let e=0;e!==t;++e)i[e]=e;return i.sort((function(t,i){return e[t]-e[i]})),i},sortedArray:function(e,t,i){const n=e.length,s=new e.constructor(n);for(let o=0,r=0;r!==n;++o){const n=i[o]*t;for(let i=0;i!==t;++i)s[r++]=e[n+i]}return s},flattenJSON:function(e,t,i,n){let s=1,o=e[0];for(;void 0!==o&&void 0===o[n];)o=e[s++];if(void 0===o)return;let r=o[n];if(void 0!==r)if(Array.isArray(r))do{r=o[n],void 0!==r&&(t.push(o.time),i.push.apply(i,r)),o=e[s++]}while(void 0!==o);else if(void 0!==r.toArray)do{r=o[n],void 0!==r&&(t.push(o.time),r.toArray(i,i.length)),o=e[s++]}while(void 0!==o);else do{r=o[n],void 0!==r&&(t.push(o.time),i.push(r)),o=e[s++]}while(void 0!==o)},subclip:function(e,t,i,n,s=30){const o=e.clone();o.name=t;const r=[];for(let e=0;e<o.tracks.length;++e){const t=o.tracks[e],a=t.getValueSize(),l=[],c=[];for(let e=0;e<t.times.length;++e){const o=t.times[e]*s;if(!(o<i||o>=n)){l.push(t.times[e]);for(let i=0;i<a;++i)c.push(t.values[e*a+i])}}0!==l.length&&(t.times=Ec.convertArray(l,t.times.constructor),t.values=Ec.convertArray(c,t.values.constructor),r.push(t))}o.tracks=r;let a=1/0;for(let e=0;e<o.tracks.length;++e)a>o.tracks[e].times[0]&&(a=o.tracks[e].times[0]);for(let e=0;e<o.tracks.length;++e)o.tracks[e].shift(-1*a);return o.resetDuration(),o},makeClipAdditive:function(e,t=0,i=e,n=30){n<=0&&(n=30);const s=i.tracks.length,o=t/n;for(let t=0;t<s;++t){const n=i.tracks[t],s=n.ValueTypeName;if("bool"===s||"string"===s)continue;const r=e.tracks.find((function(e){return e.name===n.name&&e.ValueTypeName===s}));if(void 0===r)continue;let a=0;const l=n.getValueSize();n.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(a=l/3);let c=0;const h=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=h/3);const d=n.times.length-1;let u;if(o<=n.times[0]){const e=a,t=l-a;u=Ec.arraySlice(n.values,e,t)}else if(o>=n.times[d]){const e=d*l+a,t=e+l-a;u=Ec.arraySlice(n.values,e,t)}else{const e=n.createInterpolant(),t=a,i=l-a;e.evaluate(o),u=Ec.arraySlice(e.resultBuffer,t,i)}if("quaternion"===s){(new Quaternion).fromArray(u).normalize().conjugate().toArray(u)}const p=r.times.length;for(let e=0;e<p;++e){const t=e*h+c;if("quaternion"===s)Quaternion.multiplyQuaternionsFlat(r.values,t,u,0,r.values,t);else{const e=h-2*c;for(let i=0;i<e;++i)r.values[t+i]-=u[i]}}}return e.blendMode=Zt,e}};function Tc(e,t,i,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new t.constructor(i),this.sampleValues=t,this.valueSize=i}function Mc(e,t,i,n){Tc.call(this,e,t,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function _c(e,t,i,n){Tc.call(this,e,t,i,n)}function xc(e,t,i,n){Tc.call(this,e,t,i,n)}function Ac(e,t,i,n){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Ec.convertArray(t,this.TimeBufferType),this.values=Ec.convertArray(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}function Oc(e,t,i){Ac.call(this,e,t,i)}function Pc(e,t,i,n){Ac.call(this,e,t,i,n)}function Cc(e,t,i,n){Ac.call(this,e,t,i,n)}function Dc(e,t,i,n){Tc.call(this,e,t,i,n)}function Ic(e,t,i,n){Ac.call(this,e,t,i,n)}function Rc(e,t,i,n){Ac.call(this,e,t,i,n)}function Lc(e,t,i,n){Ac.call(this,e,t,i,n)}function Nc(e,t=-1,i,n=Wt){this.name=e,this.tracks=i,this.duration=t,this.blendMode=n,this.uuid=Fi.generateUUID(),this.duration<0&&this.resetDuration()}function kc(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Cc;case"vector":case"vector2":case"vector3":case"vector4":return Lc;case"color":return Pc;case"quaternion":return Ic;case"bool":case"boolean":return Oc;case"string":return Rc}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],i=[];Ec.flattenJSON(e.keys,t,i,"value"),e.times=t,e.values=i}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}Object.assign(Tc.prototype,{evaluate:function(e){const t=this.parameterPositions;let i=this._cachedIndex,n=t[i],s=t[i-1];e:{t:{let o;i:{n:if(!(e<n)){for(let o=i+2;;){if(void 0===n){if(e<s)break n;return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,e,s)}if(i===o)break;if(s=n,n=t[++i],e<n)break t}o=t.length;break i}if(e>=s)break e;{const r=t[1];e<r&&(i=2,s=r);for(let o=i-2;;){if(void 0===s)return this._cachedIndex=0,this.beforeStart_(0,e,n);if(i===o)break;if(n=s,s=t[--i-1],e>=s)break t}o=i,i=0}}for(;i<o;){const n=i+o>>>1;e<t[n]?o=n:i=n+1}if(n=t[i],s=t[i-1],void 0===s)return this._cachedIndex=0,this.beforeStart_(0,e,n);if(void 0===n)return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,s,e)}this._cachedIndex=i,this.intervalChanged_(i,s,n)}return this.interpolate_(i,s,e,n)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){const t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,s=e*n;for(let e=0;e!==n;++e)t[e]=i[s+e];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(Tc.prototype,{beforeStart_:Tc.prototype.copySampleValue_,afterEnd_:Tc.prototype.copySampleValue_}),Mc.prototype=Object.assign(Object.create(Tc.prototype),{constructor:Mc,DefaultSettings_:{endingStart:Gt,endingEnd:Gt},intervalChanged_:function(e,t,i){const n=this.parameterPositions;let s=e-2,o=e+1,r=n[s],a=n[o];if(void 0===r)switch(this.getSettings_().endingStart){case zt:s=e,r=2*t-i;break;case jt:s=n.length-2,r=t+n[s]-n[s+1];break;default:s=e,r=i}if(void 0===a)switch(this.getSettings_().endingEnd){case zt:o=e,a=2*i-t;break;case jt:o=1,a=i+n[1]-n[0];break;default:o=e-1,a=t}const l=.5*(i-t),c=this.valueSize;this._weightPrev=l/(t-r),this._weightNext=l/(a-i),this._offsetPrev=s*c,this._offsetNext=o*c},interpolate_:function(e,t,i,n){const s=this.resultBuffer,o=this.sampleValues,r=this.valueSize,a=e*r,l=a-r,c=this._offsetPrev,h=this._offsetNext,d=this._weightPrev,u=this._weightNext,p=(i-t)/(n-t),m=p*p,g=m*p,f=-d*g+2*d*m-d*p,v=(1+d)*g+(-1.5-2*d)*m+(-.5+d)*p+1,y=(-1-u)*g+(1.5+u)*m+.5*p,b=u*g-u*m;for(let e=0;e!==r;++e)s[e]=f*o[c+e]+v*o[l+e]+y*o[a+e]+b*o[h+e];return s}}),_c.prototype=Object.assign(Object.create(Tc.prototype),{constructor:_c,interpolate_:function(e,t,i,n){const s=this.resultBuffer,o=this.sampleValues,r=this.valueSize,a=e*r,l=a-r,c=(i-t)/(n-t),h=1-c;for(let e=0;e!==r;++e)s[e]=o[l+e]*h+o[a+e]*c;return s}}),xc.prototype=Object.assign(Object.create(Tc.prototype),{constructor:xc,interpolate_:function(e){return this.copySampleValue_(e-1)}}),Object.assign(Ac,{toJSON:function(e){const t=e.constructor;let i;if(void 0!==t.toJSON)i=t.toJSON(e);else{i={name:e.name,times:Ec.convertArray(e.times,Array),values:Ec.convertArray(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(i.interpolation=t)}return i.type=e.ValueTypeName,i}}),Object.assign(Ac.prototype,{constructor:Ac,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:Vt,InterpolantFactoryMethodDiscrete:function(e){return new xc(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new _c(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new Mc(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){let t;switch(e){case Ut:t=this.InterpolantFactoryMethodDiscrete;break;case Vt:t=this.InterpolantFactoryMethodLinear;break;case Ht:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Ut;case this.InterpolantFactoryMethodLinear:return Vt;case this.InterpolantFactoryMethodSmooth:return Ht}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e){const t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]+=e}return this},scale:function(e){if(1!==e){const t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]*=e}return this},trim:function(e,t){const i=this.times,n=i.length;let s=0,o=n-1;for(;s!==n&&i[s]<e;)++s;for(;-1!==o&&i[o]>t;)--o;if(++o,0!==s||o!==n){s>=o&&(o=Math.max(o,1),s=o-1);const e=this.getValueSize();this.times=Ec.arraySlice(i,s,o),this.values=Ec.arraySlice(this.values,s*e,o*e)}return this},validate:function(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,n=this.values,s=i.length;0===s&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let t=0;t!==s;t++){const n=i[t];if("number"==typeof n&&isNaN(n)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,n),e=!1;break}if(null!==o&&o>n){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,n,o),e=!1;break}o=n}if(void 0!==n&&Ec.isTypedArray(n))for(let t=0,i=n.length;t!==i;++t){const i=n[t];if(isNaN(i)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,i),e=!1;break}}return e},optimize:function(){const e=Ec.arraySlice(this.times),t=Ec.arraySlice(this.values),i=this.getValueSize(),n=this.getInterpolation()===Ht,s=e.length-1;let o=1;for(let r=1;r<s;++r){let s=!1;const a=e[r];if(a!==e[r+1]&&(1!==r||a!==a[0]))if(n)s=!0;else{const e=r*i,n=e-i,o=e+i;for(let r=0;r!==i;++r){const i=t[e+r];if(i!==t[n+r]||i!==t[o+r]){s=!0;break}}}if(s){if(r!==o){e[o]=e[r];const n=r*i,s=o*i;for(let e=0;e!==i;++e)t[s+e]=t[n+e]}++o}}if(s>0){e[o]=e[s];for(let e=s*i,n=o*i,r=0;r!==i;++r)t[n+r]=t[e+r];++o}return o!==e.length?(this.times=Ec.arraySlice(e,0,o),this.values=Ec.arraySlice(t,0,o*i)):(this.times=e,this.values=t),this},clone:function(){const e=Ec.arraySlice(this.times,0),t=Ec.arraySlice(this.values,0),i=new(0,this.constructor)(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}}),Oc.prototype=Object.assign(Object.create(Ac.prototype),{constructor:Oc,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:Ut,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Pc.prototype=Object.assign(Object.create(Ac.prototype),{constructor:Pc,ValueTypeName:"color"}),Cc.prototype=Object.assign(Object.create(Ac.prototype),{constructor:Cc,ValueTypeName:"number"}),Dc.prototype=Object.assign(Object.create(Tc.prototype),{constructor:Dc,interpolate_:function(e,t,i,n){const s=this.resultBuffer,o=this.sampleValues,r=this.valueSize,a=(i-t)/(n-t);let l=e*r;for(let e=l+r;l!==e;l+=4)Quaternion.slerpFlat(s,0,o,l-r,o,l,a);return s}}),Ic.prototype=Object.assign(Object.create(Ac.prototype),{constructor:Ic,ValueTypeName:"quaternion",DefaultInterpolation:Vt,InterpolantFactoryMethodLinear:function(e){return new Dc(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),Rc.prototype=Object.assign(Object.create(Ac.prototype),{constructor:Rc,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:Ut,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Lc.prototype=Object.assign(Object.create(Ac.prototype),{constructor:Lc,ValueTypeName:"vector"}),Object.assign(Nc,{parse:function(e){const t=[],i=e.tracks,n=1/(e.fps||1);for(let e=0,s=i.length;e!==s;++e)t.push(kc(i[e]).scale(n));const s=new Nc(e.name,e.duration,t,e.blendMode);return s.uuid=e.uuid,s},toJSON:function(e){const t=[],i=e.tracks,n={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,n=i.length;e!==n;++e)t.push(Ac.toJSON(i[e]));return n},CreateFromMorphTargetSequence:function(e,t,i,n){const s=t.length,o=[];for(let e=0;e<s;e++){let r=[],a=[];r.push((e+s-1)%s,e,(e+1)%s),a.push(0,1,0);const l=Ec.getKeyframeOrder(r);r=Ec.sortedArray(r,1,l),a=Ec.sortedArray(a,1,l),n||0!==r[0]||(r.push(s),a.push(a[0])),o.push(new Cc(".morphTargetInfluences["+t[e].name+"]",r,a).scale(1/i))}return new Nc(e,-1,o)},findByName:function(e,t){let i=e;if(!Array.isArray(e)){const t=e;i=t.geometry&&t.geometry.animations||t.animations}for(let e=0;e<i.length;e++)if(i[e].name===t)return i[e];return null},CreateClipsFromMorphTargetSequences:function(e,t,i){const n={},s=/^([\w-]*?)([\d]+)$/;for(let t=0,i=e.length;t<i;t++){const i=e[t],o=i.name.match(s);if(o&&o.length>1){const e=o[1];let t=n[e];t||(n[e]=t=[]),t.push(i)}}const o=[];for(const e in n)o.push(Nc.CreateFromMorphTargetSequence(e,n[e],t,i));return o},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(e,t,i,n,s){if(0!==i.length){const o=[],r=[];Ec.flattenJSON(i,o,r,n),0!==o.length&&s.push(new e(t,o,r))}},n=[],s=e.name||"default",o=e.fps||30,r=e.blendMode;let a=e.length||-1;const l=e.hierarchy||[];for(let e=0;e<l.length;e++){const s=l[e].keys;if(s&&0!==s.length)if(s[0].morphTargets){const e={};let t;for(t=0;t<s.length;t++)if(s[t].morphTargets)for(let i=0;i<s[t].morphTargets.length;i++)e[s[t].morphTargets[i]]=-1;for(const i in e){const e=[],o=[];for(let n=0;n!==s[t].morphTargets.length;++n){const n=s[t];e.push(n.time),o.push(n.morphTarget===i?1:0)}n.push(new Cc(".morphTargetInfluence["+i+"]",e,o))}a=e.length*(o||1)}else{const o=".bones["+t[e].name+"]";i(Lc,o+".position",s,"pos",n),i(Ic,o+".quaternion",s,"rot",n),i(Lc,o+".scale",s,"scl",n)}}if(0===n.length)return null;return new Nc(s,a,n,r)}}),Object.assign(Nc.prototype,{resetDuration:function(){let e=0;for(let t=0,i=this.tracks.length;t!==i;++t){const i=this.tracks[t];e=Math.max(e,i.times[i.times.length-1])}return this.duration=e,this},trim:function(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this},clone:function(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new Nc(this.name,this.duration,e,this.blendMode)},toJSON:function(){return Nc.toJSON(this)}});const Bc={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function Fc(e,t,i){const n=this;let s,o=!1,r=0,a=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(e){a++,!1===o&&void 0!==n.onStart&&n.onStart(e,r,a),o=!0},this.itemEnd=function(e){r++,void 0!==n.onProgress&&n.onProgress(e,r,a),r===a&&(o=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(e){void 0!==n.onError&&n.onError(e)},this.resolveURL=function(e){return s?s(e):e},this.setURLModifier=function(e){return s=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,i=l.length;t<i;t+=2){const i=l[t],n=l[t+1];if(i.global&&(i.lastIndex=0),i.test(e))return n}return null}}const Uc=new Fc;function Vc(e){this.manager=void 0!==e?e:Uc,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}Object.assign(Vc.prototype,{load:function(){},loadAsync:function(e,t){const i=this;return new Promise((function(n,s){i.load(e,n,t,s)}))},parse:function(){},setCrossOrigin:function(e){return this.crossOrigin=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}});const Hc={};function Gc(e){Vc.call(this,e)}function zc(e){Vc.call(this,e)}function jc(e){Vc.call(this,e)}function Wc(e){Vc.call(this,e)}function Zc(e){Vc.call(this,e)}function qc(e){Vc.call(this,e)}function Kc(e){Vc.call(this,e)}function Yc(){this.type="Curve",this.arcLengthDivisions=200}function $c(e,t,i,n,s,o,r,a){Yc.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=i||1,this.yRadius=n||1,this.aStartAngle=s||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=r||!1,this.aRotation=a||0}function Xc(e,t,i,n,s,o){$c.call(this,e,t,i,i,n,s,o),this.type="ArcCurve"}function Qc(){let e=0,t=0,i=0,n=0;function s(s,o,r,a){e=s,t=r,i=-3*s+3*o-2*r-a,n=2*s-2*o+r+a}return{initCatmullRom:function(e,t,i,n,o){s(t,i,o*(i-e),o*(n-t))},initNonuniformCatmullRom:function(e,t,i,n,o,r,a){let l=(t-e)/o-(i-e)/(o+r)+(i-t)/r,c=(i-t)/r-(n-t)/(r+a)+(n-i)/a;l*=r,c*=r,s(t,i,l,c)},calc:function(s){const o=s*s;return e+t*s+i*o+n*(o*s)}}}Gc.prototype=Object.assign(Object.create(Vc.prototype),{constructor:Gc,load:function(e,t,i,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=Bc.get(e);if(void 0!==o)return s.manager.itemStart(e),setTimeout((function(){t&&t(o),s.manager.itemEnd(e)}),0),o;if(void 0!==Hc[e])return void Hc[e].push({onLoad:t,onProgress:i,onError:n});const r=e.match(/^data:(.*?)(;base64)?,(.*)$/);let a;if(r){const i=r[1],o=!!r[2];let a=r[3];a=decodeURIComponent(a),o&&(a=atob(a));try{let n;const o=(this.responseType||"").toLowerCase();switch(o){case"arraybuffer":case"blob":const e=new Uint8Array(a.length);for(let t=0;t<a.length;t++)e[t]=a.charCodeAt(t);n="blob"===o?new Blob([e.buffer],{type:i}):e.buffer;break;case"document":const t=new DOMParser;n=t.parseFromString(a,i);break;case"json":n=JSON.parse(a);break;default:n=a}setTimeout((function(){t&&t(n),s.manager.itemEnd(e)}),0)}catch(t){setTimeout((function(){n&&n(t),s.manager.itemError(e),s.manager.itemEnd(e)}),0)}}else{Hc[e]=[],Hc[e].push({onLoad:t,onProgress:i,onError:n}),a=new XMLHttpRequest,a.open("GET",e,!0),a.addEventListener("load",(function(t){const i=this.response,n=Hc[e];if(delete Hc[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Bc.add(e,i);for(let e=0,t=n.length;e<t;e++){const t=n[e];t.onLoad&&t.onLoad(i)}s.manager.itemEnd(e)}else{for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onError&&i.onError(t)}s.manager.itemError(e),s.manager.itemEnd(e)}}),!1),a.addEventListener("progress",(function(t){const i=Hc[e];for(let e=0,n=i.length;e<n;e++){const n=i[e];n.onProgress&&n.onProgress(t)}}),!1),a.addEventListener("error",(function(t){const i=Hc[e];delete Hc[e];for(let e=0,n=i.length;e<n;e++){const n=i[e];n.onError&&n.onError(t)}s.manager.itemError(e),s.manager.itemEnd(e)}),!1),a.addEventListener("abort",(function(t){const i=Hc[e];delete Hc[e];for(let e=0,n=i.length;e<n;e++){const n=i[e];n.onError&&n.onError(t)}s.manager.itemError(e),s.manager.itemEnd(e)}),!1),void 0!==this.responseType&&(a.responseType=this.responseType),void 0!==this.withCredentials&&(a.withCredentials=this.withCredentials),a.overrideMimeType&&a.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(const e in this.requestHeader)a.setRequestHeader(e,this.requestHeader[e]);a.send(null)}return s.manager.itemStart(e),a},setResponseType:function(e){return this.responseType=e,this},setMimeType:function(e){return this.mimeType=e,this}}),zc.prototype=Object.assign(Object.create(Vc.prototype),{constructor:zc,load:function(e,t,i,n){const s=this,o=new Gc(s.manager);o.setPath(s.path),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(e,(function(i){try{t(s.parse(JSON.parse(i)))}catch(t){n?n(t):console.error(t),s.manager.itemError(e)}}),i,n)},parse:function(e){const t=[];for(let i=0;i<e.length;i++){const n=Nc.parse(e[i]);t.push(n)}return t}}),jc.prototype=Object.assign(Object.create(Vc.prototype),{constructor:jc,load:function(e,t,i,n){const s=this,o=[],r=new Sl,a=new Gc(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(s.withCredentials);let l=0;function c(c){a.load(e[c],(function(e){const i=s.parse(e,!0);o[c]={width:i.width,height:i.height,format:i.format,mipmaps:i.mipmaps},l+=1,6===l&&(1===i.mipmapCount&&(r.minFilter=be),r.image=o,r.format=i.format,r.needsUpdate=!0,t&&t(r))}),i,n)}if(Array.isArray(e))for(let t=0,i=e.length;t<i;++t)c(t);else a.load(e,(function(e){const i=s.parse(e,!0);if(i.isCubemap){const e=i.mipmaps.length/i.mipmapCount;for(let t=0;t<e;t++){o[t]={mipmaps:[]};for(let e=0;e<i.mipmapCount;e++)o[t].mipmaps.push(i.mipmaps[t*i.mipmapCount+e]),o[t].format=i.format,o[t].width=i.width,o[t].height=i.height}r.image=o}else r.image.width=i.width,r.image.height=i.height,r.mipmaps=i.mipmaps;1===i.mipmapCount&&(r.minFilter=be),r.format=i.format,r.needsUpdate=!0,t&&t(r)}),i,n);return r}}),Wc.prototype=Object.assign(Object.create(Vc.prototype),{constructor:Wc,load:function(e,t,i,n){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=Bc.get(e);if(void 0!==o)return s.manager.itemStart(e),setTimeout((function(){t&&t(o),s.manager.itemEnd(e)}),0),o;const r=document.createElementNS("http://www.w3.org/1999/xhtml","img");function a(){r.removeEventListener("load",a,!1),r.removeEventListener("error",l,!1),Bc.add(e,this),t&&t(this),s.manager.itemEnd(e)}function l(t){r.removeEventListener("load",a,!1),r.removeEventListener("error",l,!1),n&&n(t),s.manager.itemError(e),s.manager.itemEnd(e)}return r.addEventListener("load",a,!1),r.addEventListener("error",l,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(r.crossOrigin=this.crossOrigin),s.manager.itemStart(e),r.src=e,r}}),Zc.prototype=Object.assign(Object.create(Vc.prototype),{constructor:Zc,load:function(e,t,i,n){const s=new ro,o=new Wc(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let r=0;function a(i){o.load(e[i],(function(e){s.images[i]=e,r++,6===r&&(s.needsUpdate=!0,t&&t(s))}),void 0,n)}for(let t=0;t<e.length;++t)a(t);return s}}),qc.prototype=Object.assign(Object.create(Vc.prototype),{constructor:qc,load:function(e,t,i,n){const s=this,o=new lo,r=new Gc(this.manager);return r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setPath(this.path),r.setWithCredentials(s.withCredentials),r.load(e,(function(e){const i=s.parse(e);i&&(void 0!==i.image?o.image=i.image:void 0!==i.data&&(o.image.width=i.width,o.image.height=i.height,o.image.data=i.data),o.wrapS=void 0!==i.wrapS?i.wrapS:ue,o.wrapT=void 0!==i.wrapT?i.wrapT:ue,o.magFilter=void 0!==i.magFilter?i.magFilter:be,o.minFilter=void 0!==i.minFilter?i.minFilter:be,o.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,void 0!==i.format&&(o.format=i.format),void 0!==i.type&&(o.type=i.type),void 0!==i.mipmaps&&(o.mipmaps=i.mipmaps,o.minFilter=Ee),1===i.mipmapCount&&(o.minFilter=be),o.needsUpdate=!0,t&&t(o,i))}),i,n),o}}),Kc.prototype=Object.assign(Object.create(Vc.prototype),{constructor:Kc,load:function(e,t,i,n){const s=new Gi,o=new Wc(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,(function(i){s.image=i;const n=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);s.format=n?Be:Fe,s.needsUpdate=!0,void 0!==t&&t(s)}),i,n),s}}),Object.assign(Yc.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)},getPoints:function(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t},getSpacedPoints:function(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t},getLength:function(){const e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,n=this.getPoint(0),s=0;t.push(0);for(let o=1;o<=e;o++)i=this.getPoint(o/e),s+=i.distanceTo(n),t.push(s),n=i;return this.cacheArcLengths=t,t},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){const i=this.getLengths();let n=0;const s=i.length;let o;o=t||e*i[s-1];let r,a=0,l=s-1;for(;a<=l;)if(n=Math.floor(a+(l-a)/2),r=i[n]-o,r<0)a=n+1;else{if(!(r>0)){l=n;break}l=n-1}if(n=l,i[n]===o)return n/(s-1);const c=i[n];return(n+(o-c)/(i[n+1]-c))/(s-1)},getTangent:function(e,t){const i=1e-4;let n=e-i,s=e+i;n<0&&(n=0),s>1&&(s=1);const o=this.getPoint(n),r=this.getPoint(s),a=t||(o.isVector2?new Vector2:new Vector3);return a.copy(r).sub(o).normalize(),a},getTangentAt:function(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)},computeFrenetFrames:function(e,t){const i=new Vector3,n=[],s=[],o=[],r=new Vector3,a=new Matrix4;for(let t=0;t<=e;t++){const i=t/e;n[t]=this.getTangentAt(i,new Vector3),n[t].normalize()}s[0]=new Vector3,o[0]=new Vector3;let l=Number.MAX_VALUE;const c=Math.abs(n[0].x),h=Math.abs(n[0].y),d=Math.abs(n[0].z);c<=l&&(l=c,i.set(1,0,0)),h<=l&&(l=h,i.set(0,1,0)),d<=l&&i.set(0,0,1),r.crossVectors(n[0],i).normalize(),s[0].crossVectors(n[0],r),o[0].crossVectors(n[0],s[0]);for(let t=1;t<=e;t++){if(s[t]=s[t-1].clone(),o[t]=o[t-1].clone(),r.crossVectors(n[t-1],n[t]),r.length()>Number.EPSILON){r.normalize();const e=Math.acos(Fi.clamp(n[t-1].dot(n[t]),-1,1));s[t].applyMatrix4(a.makeRotationAxis(r,e))}o[t].crossVectors(n[t],s[t])}if(!0===t){let t=Math.acos(Fi.clamp(s[0].dot(s[e]),-1,1));t/=e,n[0].dot(r.crossVectors(s[0],s[e]))>0&&(t=-t);for(let i=1;i<=e;i++)s[i].applyMatrix4(a.makeRotationAxis(n[i],t*i)),o[i].crossVectors(n[i],s[i])}return{tangents:n,normals:s,binormals:o}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),$c.prototype=Object.create(Yc.prototype),$c.prototype.constructor=$c,$c.prototype.isEllipseCurve=!0,$c.prototype.getPoint=function(e,t){const i=t||new Vector2,n=2*Math.PI;let s=this.aEndAngle-this.aStartAngle;const o=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=n;for(;s>n;)s-=n;s<Number.EPSILON&&(s=o?0:n),!0!==this.aClockwise||o||(s===n?s=-n:s-=n);const r=this.aStartAngle+e*s;let a=this.aX+this.xRadius*Math.cos(r),l=this.aY+this.yRadius*Math.sin(r);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),i=a-this.aX,n=l-this.aY;a=i*e-n*t+this.aX,l=i*t+n*e+this.aY}return i.set(a,l)},$c.prototype.copy=function(e){return Yc.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},$c.prototype.toJSON=function(){const e=Yc.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},$c.prototype.fromJSON=function(e){return Yc.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},Xc.prototype=Object.create($c.prototype),Xc.prototype.constructor=Xc,Xc.prototype.isArcCurve=!0;const Jc=new Vector3,eh=new Qc,th=new Qc,ih=new Qc;function nh(e=[],t=!1,i="centripetal",n=.5){Yc.call(this),this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=n}function sh(e,t,i,n,s){const o=.5*(n-t),r=.5*(s-i),a=e*e;return(2*i-2*n+o+r)*(e*a)+(-3*i+3*n-2*o-r)*a+o*e+i}function oh(e,t,i,n){return function(e,t){const i=1-e;return i*i*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,i)+function(e,t){return e*e*t}(e,n)}function rh(e,t,i,n,s){return function(e,t){const i=1-e;return i*i*i*t}(e,t)+function(e,t){const i=1-e;return 3*i*i*e*t}(e,i)+function(e,t){return 3*(1-e)*e*e*t}(e,n)+function(e,t){return e*e*e*t}(e,s)}function ah(e=new Vector2,t=new Vector2,i=new Vector2,n=new Vector2){Yc.call(this),this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=n}function lh(e=new Vector3,t=new Vector3,i=new Vector3,n=new Vector3){Yc.call(this),this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=n}function ch(e=new Vector2,t=new Vector2){Yc.call(this),this.type="LineCurve",this.v1=e,this.v2=t}function hh(e=new Vector3,t=new Vector3){Yc.call(this),this.type="LineCurve3",this.v1=e,this.v2=t}function dh(e=new Vector2,t=new Vector2,i=new Vector2){Yc.call(this),this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}function uh(e=new Vector3,t=new Vector3,i=new Vector3){Yc.call(this),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}function ph(e=[]){Yc.call(this),this.type="SplineCurve",this.points=e}nh.prototype=Object.create(Yc.prototype),nh.prototype.constructor=nh,nh.prototype.isCatmullRomCurve3=!0,nh.prototype.getPoint=function(e,t=new Vector3){const i=t,n=this.points,s=n.length,o=(s-(this.closed?0:1))*e;let r,a,l=Math.floor(o),c=o-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/s)+1)*s:0===c&&l===s-1&&(l=s-2,c=1),this.closed||l>0?r=n[(l-1)%s]:(Jc.subVectors(n[0],n[1]).add(n[0]),r=Jc);const h=n[l%s],d=n[(l+1)%s];if(this.closed||l+2<s?a=n[(l+2)%s]:(Jc.subVectors(n[s-1],n[s-2]).add(n[s-1]),a=Jc),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(r.distanceToSquared(h),e),i=Math.pow(h.distanceToSquared(d),e),n=Math.pow(d.distanceToSquared(a),e);i<1e-4&&(i=1),t<1e-4&&(t=i),n<1e-4&&(n=i),eh.initNonuniformCatmullRom(r.x,h.x,d.x,a.x,t,i,n),th.initNonuniformCatmullRom(r.y,h.y,d.y,a.y,t,i,n),ih.initNonuniformCatmullRom(r.z,h.z,d.z,a.z,t,i,n)}else"catmullrom"===this.curveType&&(eh.initCatmullRom(r.x,h.x,d.x,a.x,this.tension),th.initCatmullRom(r.y,h.y,d.y,a.y,this.tension),ih.initCatmullRom(r.z,h.z,d.z,a.z,this.tension));return i.set(eh.calc(c),th.calc(c),ih.calc(c)),i},nh.prototype.copy=function(e){Yc.prototype.copy.call(this,e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},nh.prototype.toJSON=function(){const e=Yc.prototype.toJSON.call(this);e.points=[];for(let t=0,i=this.points.length;t<i;t++){const i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},nh.prototype.fromJSON=function(e){Yc.prototype.fromJSON.call(this,e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push((new Vector3).fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},ah.prototype=Object.create(Yc.prototype),ah.prototype.constructor=ah,ah.prototype.isCubicBezierCurve=!0,ah.prototype.getPoint=function(e,t=new Vector2){const i=t,n=this.v0,s=this.v1,o=this.v2,r=this.v3;return i.set(rh(e,n.x,s.x,o.x,r.x),rh(e,n.y,s.y,o.y,r.y)),i},ah.prototype.copy=function(e){return Yc.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},ah.prototype.toJSON=function(){const e=Yc.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},ah.prototype.fromJSON=function(e){return Yc.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},lh.prototype=Object.create(Yc.prototype),lh.prototype.constructor=lh,lh.prototype.isCubicBezierCurve3=!0,lh.prototype.getPoint=function(e,t=new Vector3){const i=t,n=this.v0,s=this.v1,o=this.v2,r=this.v3;return i.set(rh(e,n.x,s.x,o.x,r.x),rh(e,n.y,s.y,o.y,r.y),rh(e,n.z,s.z,o.z,r.z)),i},lh.prototype.copy=function(e){return Yc.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},lh.prototype.toJSON=function(){const e=Yc.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},lh.prototype.fromJSON=function(e){return Yc.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},ch.prototype=Object.create(Yc.prototype),ch.prototype.constructor=ch,ch.prototype.isLineCurve=!0,ch.prototype.getPoint=function(e,t=new Vector2){const i=t;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i},ch.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},ch.prototype.getTangent=function(e,t){const i=t||new Vector2;return i.copy(this.v2).sub(this.v1).normalize(),i},ch.prototype.copy=function(e){return Yc.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},ch.prototype.toJSON=function(){const e=Yc.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},ch.prototype.fromJSON=function(e){return Yc.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},hh.prototype=Object.create(Yc.prototype),hh.prototype.constructor=hh,hh.prototype.isLineCurve3=!0,hh.prototype.getPoint=function(e,t=new Vector3){const i=t;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i},hh.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},hh.prototype.copy=function(e){return Yc.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},hh.prototype.toJSON=function(){const e=Yc.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},hh.prototype.fromJSON=function(e){return Yc.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},dh.prototype=Object.create(Yc.prototype),dh.prototype.constructor=dh,dh.prototype.isQuadraticBezierCurve=!0,dh.prototype.getPoint=function(e,t=new Vector2){const i=t,n=this.v0,s=this.v1,o=this.v2;return i.set(oh(e,n.x,s.x,o.x),oh(e,n.y,s.y,o.y)),i},dh.prototype.copy=function(e){return Yc.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},dh.prototype.toJSON=function(){const e=Yc.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},dh.prototype.fromJSON=function(e){return Yc.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},uh.prototype=Object.create(Yc.prototype),uh.prototype.constructor=uh,uh.prototype.isQuadraticBezierCurve3=!0,uh.prototype.getPoint=function(e,t=new Vector3){const i=t,n=this.v0,s=this.v1,o=this.v2;return i.set(oh(e,n.x,s.x,o.x),oh(e,n.y,s.y,o.y),oh(e,n.z,s.z,o.z)),i},uh.prototype.copy=function(e){return Yc.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},uh.prototype.toJSON=function(){const e=Yc.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},uh.prototype.fromJSON=function(e){return Yc.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},ph.prototype=Object.create(Yc.prototype),ph.prototype.constructor=ph,ph.prototype.isSplineCurve=!0,ph.prototype.getPoint=function(e,t=new Vector2){const i=t,n=this.points,s=(n.length-1)*e,o=Math.floor(s),r=s-o,a=n[0===o?o:o-1],l=n[o],c=n[o>n.length-2?n.length-1:o+1],h=n[o>n.length-3?n.length-1:o+2];return i.set(sh(r,a.x,l.x,c.x,h.x),sh(r,a.y,l.y,c.y,h.y)),i},ph.prototype.copy=function(e){Yc.prototype.copy.call(this,e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push(i.clone())}return this},ph.prototype.toJSON=function(){const e=Yc.prototype.toJSON.call(this);e.points=[];for(let t=0,i=this.points.length;t<i;t++){const i=this.points[t];e.points.push(i.toArray())}return e},ph.prototype.fromJSON=function(e){Yc.prototype.fromJSON.call(this,e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push((new Vector2).fromArray(i))}return this};var mh=Object.freeze({__proto__:null,ArcCurve:Xc,CatmullRomCurve3:nh,CubicBezierCurve:ah,CubicBezierCurve3:lh,EllipseCurve:$c,LineCurve:ch,LineCurve3:hh,QuadraticBezierCurve:dh,QuadraticBezierCurve3:uh,SplineCurve:ph});function gh(){Yc.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function fh(e){gh.call(this),this.type="Path",this.currentPoint=new Vector2,e&&this.setFromPoints(e)}function vh(e){fh.call(this,e),this.uuid=Fi.generateUUID(),this.type="Shape",this.holes=[]}function yh(e,t=1){Un.call(this),this.type="Light",this.color=new Color(e),this.intensity=t}function bh(e,t,i){yh.call(this,e,i),this.type="HemisphereLight",this.position.copy(Un.DefaultUp),this.updateMatrix(),this.groundColor=new Color(t)}function wh(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new Vector2(512,512),this.map=null,this.mapPass=null,this.matrix=new Matrix4,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Frustum,this._frameExtents=new Vector2(1,1),this._viewportCount=1,this._viewports=[new Vector4(0,0,1,1)]}function Sh(){wh.call(this,new no(50,1,.5,500)),this.focus=1}function Eh(e,t,i,n,s,o){yh.call(this,e,t),this.type="SpotLight",this.position.copy(Un.DefaultUp),this.updateMatrix(),this.target=new Un,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==i?i:0,this.angle=void 0!==n?n:Math.PI/3,this.penumbra=void 0!==s?s:0,this.decay=void 0!==o?o:1,this.shadow=new Sh}function Th(){wh.call(this,new no(90,1,.5,500)),this._frameExtents=new Vector2(4,2),this._viewportCount=6,this._viewports=[new Vector4(2,1,1,1),new Vector4(0,1,1,1),new Vector4(3,1,1,1),new Vector4(1,1,1,1),new Vector4(3,0,1,1),new Vector4(1,0,1,1)],this._cubeDirections=[new Vector3(1,0,0),new Vector3(-1,0,0),new Vector3(0,0,1),new Vector3(0,0,-1),new Vector3(0,1,0),new Vector3(0,-1,0)],this._cubeUps=[new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,0,1),new Vector3(0,0,-1)]}function Mh(e,t,i,n){yh.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==i?i:0,this.decay=void 0!==n?n:1,this.shadow=new Th}function _h(e=-1,t=1,i=1,n=-1,s=.1,o=2e3){io.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=n,this.near=s,this.far=o,this.updateProjectionMatrix()}function xh(){wh.call(this,new _h(-5,5,5,-5,.5,500))}function Ah(e,t){yh.call(this,e,t),this.type="DirectionalLight",this.position.copy(Un.DefaultUp),this.updateMatrix(),this.target=new Un,this.shadow=new xh}function Oh(e,t){yh.call(this,e,t),this.type="AmbientLight"}function Ph(e,t,i,n){yh.call(this,e,t),this.type="RectAreaLight",this.width=void 0!==i?i:10,this.height=void 0!==n?n:10}gh.prototype=Object.assign(Object.create(Yc.prototype),{constructor:gh,add:function(e){this.curves.push(e)},closePath:function(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new ch(t,e))},getPoint:function(e){const t=e*this.getLength(),i=this.getCurveLengths();let n=0;for(;n<i.length;){if(i[n]>=t){const e=i[n]-t,s=this.curves[n],o=s.getLength(),r=0===o?0:1-e/o;return s.getPointAt(r)}n++}return null},getLength:function(){const e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let i=0,n=this.curves.length;i<n;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function(e=40){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e=12){const t=[];let i;for(let n=0,s=this.curves;n<s.length;n++){const o=s[n],r=o&&o.isEllipseCurve?2*e:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?e*o.points.length:e,a=o.getPoints(r);for(let e=0;e<a.length;e++){const n=a[e];i&&i.equals(n)||(t.push(n),i=n)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t},copy:function(e){Yc.prototype.copy.call(this,e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){const e=Yc.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){const i=this.curves[t];e.curves.push(i.toJSON())}return e},fromJSON:function(e){Yc.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const i=e.curves[t];this.curves.push((new mh[i.type]).fromJSON(i))}return this}}),fh.prototype=Object.assign(Object.create(gh.prototype),{constructor:fh,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this},moveTo:function(e,t){return this.currentPoint.set(e,t),this},lineTo:function(e,t){const i=new ch(this.currentPoint.clone(),new Vector2(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this},quadraticCurveTo:function(e,t,i,n){const s=new dh(this.currentPoint.clone(),new Vector2(e,t),new Vector2(i,n));return this.curves.push(s),this.currentPoint.set(i,n),this},bezierCurveTo:function(e,t,i,n,s,o){const r=new ah(this.currentPoint.clone(),new Vector2(e,t),new Vector2(i,n),new Vector2(s,o));return this.curves.push(r),this.currentPoint.set(s,o),this},splineThru:function(e){const t=new ph([this.currentPoint.clone()].concat(e));return this.curves.push(t),this.currentPoint.copy(e[e.length-1]),this},arc:function(e,t,i,n,s,o){const r=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(e+r,t+a,i,n,s,o),this},absarc:function(e,t,i,n,s,o){return this.absellipse(e,t,i,i,n,s,o),this},ellipse:function(e,t,i,n,s,o,r,a){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,i,n,s,o,r,a),this},absellipse:function(e,t,i,n,s,o,r,a){const l=new $c(e,t,i,n,s,o,r,a);if(this.curves.length>0){const e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this},copy:function(e){return gh.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){const e=gh.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return gh.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),vh.prototype=Object.assign(Object.create(fh.prototype),{constructor:vh,getPointsHoles:function(e){const t=[];for(let i=0,n=this.holes.length;i<n;i++)t[i]=this.holes[i].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){fh.prototype.copy.call(this,e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const i=e.holes[t];this.holes.push(i.clone())}return this},toJSON:function(){const e=fh.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){const i=this.holes[t];e.holes.push(i.toJSON())}return e},fromJSON:function(e){fh.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const i=e.holes[t];this.holes.push((new fh).fromJSON(i))}return this}}),yh.prototype=Object.assign(Object.create(Un.prototype),{constructor:yh,isLight:!0,copy:function(e){return Un.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){const t=Un.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),bh.prototype=Object.assign(Object.create(yh.prototype),{constructor:bh,isHemisphereLight:!0,copy:function(e){return yh.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(wh.prototype,{_projScreenMatrix:new Matrix4,_lightPositionWorld:new Vector3,_lookTarget:new Vector3,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(e){const t=this.camera,i=this.matrix,n=this._projScreenMatrix,s=this._lookTarget,o=this._lightPositionWorld;o.setFromMatrixPosition(e.matrixWorld),t.position.copy(o),s.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(s),t.updateMatrixWorld(),n.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(n),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(t.projectionMatrix),i.multiply(t.matrixWorldInverse)},getViewport:function(e){return this._viewports[e]},getFrameExtents:function(){return this._frameExtents},copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),Sh.prototype=Object.assign(Object.create(wh.prototype),{constructor:Sh,isSpotLightShadow:!0,updateMatrices:function(e){const t=this.camera,i=2*Fi.RAD2DEG*e.angle*this.focus,n=this.mapSize.width/this.mapSize.height,s=e.distance||t.far;i===t.fov&&n===t.aspect&&s===t.far||(t.fov=i,t.aspect=n,t.far=s,t.updateProjectionMatrix()),wh.prototype.updateMatrices.call(this,e)}}),Eh.prototype=Object.assign(Object.create(yh.prototype),{constructor:Eh,isSpotLight:!0,copy:function(e){return yh.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),Th.prototype=Object.assign(Object.create(wh.prototype),{constructor:Th,isPointLightShadow:!0,updateMatrices:function(e,t=0){const i=this.camera,n=this.matrix,s=this._lightPositionWorld,o=this._lookTarget,r=this._projScreenMatrix;s.setFromMatrixPosition(e.matrixWorld),i.position.copy(s),o.copy(i.position),o.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(o),i.updateMatrixWorld(),n.makeTranslation(-s.x,-s.y,-s.z),r.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(r)}}),Mh.prototype=Object.assign(Object.create(yh.prototype),{constructor:Mh,isPointLight:!0,copy:function(e){return yh.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),_h.prototype=Object.assign(Object.create(io.prototype),{constructor:_h,isOrthographicCamera:!0,copy:function(e,t){return io.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,i,n,s,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let s=i-e,o=i+e,r=n+t,a=n-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=e*this.view.offsetX,o=s+e*this.view.width,r-=t*this.view.offsetY,a=r-t*this.view.height}this.projectionMatrix.makeOrthographic(s,o,r,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(e){const t=Un.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),xh.prototype=Object.assign(Object.create(wh.prototype),{constructor:xh,isDirectionalLightShadow:!0,updateMatrices:function(e){wh.prototype.updateMatrices.call(this,e)}}),Ah.prototype=Object.assign(Object.create(yh.prototype),{constructor:Ah,isDirectionalLight:!0,copy:function(e){return yh.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),Oh.prototype=Object.assign(Object.create(yh.prototype),{constructor:Oh,isAmbientLight:!0}),Ph.prototype=Object.assign(Object.create(yh.prototype),{constructor:Ph,isRectAreaLight:!0,copy:function(e){return yh.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){const t=yh.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}});class SphericalHarmonics3{constructor(){Object.defineProperty(this,"isSphericalHarmonics3",{value:!0}),this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new Vector3)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const i=e.x,n=e.y,s=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*n),t.addScaledVector(o[2],.488603*s),t.addScaledVector(o[3],.488603*i),t.addScaledVector(o[4],i*n*1.092548),t.addScaledVector(o[5],n*s*1.092548),t.addScaledVector(o[6],.315392*(3*s*s-1)),t.addScaledVector(o[7],i*s*1.092548),t.addScaledVector(o[8],.546274*(i*i-n*n)),t}getIrradianceAt(e,t){const i=e.x,n=e.y,s=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],1.023328*n),t.addScaledVector(o[2],1.023328*s),t.addScaledVector(o[3],1.023328*i),t.addScaledVector(o[4],.858086*i*n),t.addScaledVector(o[5],.858086*n*s),t.addScaledVector(o[6],.743125*s*s-.247708),t.addScaledVector(o[7],.858086*i*s),t.addScaledVector(o[8],.429043*(i*i-n*n)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].fromArray(e,t+3*n);return this}toArray(e=[],t=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].toArray(e,t+3*n);return e}static getBasisAt(e,t){const i=e.x,n=e.y,s=e.z;t[0]=.282095,t[1]=.488603*n,t[2]=.488603*s,t[3]=.488603*i,t[4]=1.092548*i*n,t[5]=1.092548*n*s,t[6]=.315392*(3*s*s-1),t[7]=1.092548*i*s,t[8]=.546274*(i*i-n*n)}}function Ch(e,t){yh.call(this,void 0,t),this.type="LightProbe",this.sh=void 0!==e?e:new SphericalHarmonics3}function Dh(e){Vc.call(this,e),this.textures={}}Ch.prototype=Object.assign(Object.create(yh.prototype),{constructor:Ch,isLightProbe:!0,copy:function(e){return yh.prototype.copy.call(this,e),this.sh.copy(e.sh),this},fromJSON:function(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this},toJSON:function(e){const t=yh.prototype.toJSON.call(this,e);return t.object.sh=this.sh.toArray(),t}}),Dh.prototype=Object.assign(Object.create(Vc.prototype),{constructor:Dh,load:function(e,t,i,n){const s=this,o=new Gc(s.manager);o.setPath(s.path),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(e,(function(i){try{t(s.parse(JSON.parse(i)))}catch(t){n?n(t):console.error(t),s.manager.itemError(e)}}),i,n)},parse:function(e){const t=this.textures;function i(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}const n=new Sc[e.type];if(void 0!==e.uuid&&(n.uuid=e.uuid),void 0!==e.name&&(n.name=e.name),void 0!==e.color&&void 0!==n.color&&n.color.setHex(e.color),void 0!==e.roughness&&(n.roughness=e.roughness),void 0!==e.metalness&&(n.metalness=e.metalness),void 0!==e.sheen&&(n.sheen=(new Color).setHex(e.sheen)),void 0!==e.emissive&&void 0!==n.emissive&&n.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==n.specular&&n.specular.setHex(e.specular),void 0!==e.shininess&&(n.shininess=e.shininess),void 0!==e.clearcoat&&(n.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(n.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.fog&&(n.fog=e.fog),void 0!==e.flatShading&&(n.flatShading=e.flatShading),void 0!==e.blending&&(n.blending=e.blending),void 0!==e.combine&&(n.combine=e.combine),void 0!==e.side&&(n.side=e.side),void 0!==e.opacity&&(n.opacity=e.opacity),void 0!==e.transparent&&(n.transparent=e.transparent),void 0!==e.alphaTest&&(n.alphaTest=e.alphaTest),void 0!==e.depthTest&&(n.depthTest=e.depthTest),void 0!==e.depthWrite&&(n.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(n.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(n.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(n.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(n.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(n.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(n.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(n.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(n.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(n.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(n.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(n.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(n.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(n.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(n.rotation=e.rotation),1!==e.linewidth&&(n.linewidth=e.linewidth),void 0!==e.dashSize&&(n.dashSize=e.dashSize),void 0!==e.gapSize&&(n.gapSize=e.gapSize),void 0!==e.scale&&(n.scale=e.scale),void 0!==e.polygonOffset&&(n.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(n.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(n.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(n.skinning=e.skinning),void 0!==e.morphTargets&&(n.morphTargets=e.morphTargets),void 0!==e.morphNormals&&(n.morphNormals=e.morphNormals),void 0!==e.dithering&&(n.dithering=e.dithering),void 0!==e.vertexTangents&&(n.vertexTangents=e.vertexTangents),void 0!==e.visible&&(n.visible=e.visible),void 0!==e.toneMapped&&(n.toneMapped=e.toneMapped),void 0!==e.userData&&(n.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?n.vertexColors=e.vertexColors>0:n.vertexColors=e.vertexColors),void 0!==e.uniforms)for(const t in e.uniforms){const s=e.uniforms[t];switch(n.uniforms[t]={},s.type){case"t":n.uniforms[t].value=i(s.value);break;case"c":n.uniforms[t].value=(new Color).setHex(s.value);break;case"v2":n.uniforms[t].value=(new Vector2).fromArray(s.value);break;case"v3":n.uniforms[t].value=(new Vector3).fromArray(s.value);break;case"v4":n.uniforms[t].value=(new Vector4).fromArray(s.value);break;case"m3":n.uniforms[t].value=(new Matrix3).fromArray(s.value);break;case"m4":n.uniforms[t].value=(new Matrix4).fromArray(s.value);break;default:n.uniforms[t].value=s.value}}if(void 0!==e.defines&&(n.defines=e.defines),void 0!==e.vertexShader&&(n.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(n.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(const t in e.extensions)n.extensions[t]=e.extensions[t];if(void 0!==e.shading&&(n.flatShading=1===e.shading),void 0!==e.size&&(n.size=e.size),void 0!==e.sizeAttenuation&&(n.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(n.map=i(e.map)),void 0!==e.matcap&&(n.matcap=i(e.matcap)),void 0!==e.alphaMap&&(n.alphaMap=i(e.alphaMap)),void 0!==e.bumpMap&&(n.bumpMap=i(e.bumpMap)),void 0!==e.bumpScale&&(n.bumpScale=e.bumpScale),void 0!==e.normalMap&&(n.normalMap=i(e.normalMap)),void 0!==e.normalMapType&&(n.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),n.normalScale=(new Vector2).fromArray(t)}return void 0!==e.displacementMap&&(n.displacementMap=i(e.displacementMap)),void 0!==e.displacementScale&&(n.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(n.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(n.roughnessMap=i(e.roughnessMap)),void 0!==e.metalnessMap&&(n.metalnessMap=i(e.metalnessMap)),void 0!==e.emissiveMap&&(n.emissiveMap=i(e.emissiveMap)),void 0!==e.emissiveIntensity&&(n.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(n.specularMap=i(e.specularMap)),void 0!==e.envMap&&(n.envMap=i(e.envMap)),void 0!==e.envMapIntensity&&(n.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(n.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(n.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(n.lightMap=i(e.lightMap)),void 0!==e.lightMapIntensity&&(n.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(n.aoMap=i(e.aoMap)),void 0!==e.aoMapIntensity&&(n.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(n.gradientMap=i(e.gradientMap)),void 0!==e.clearcoatMap&&(n.clearcoatMap=i(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(n.clearcoatRoughnessMap=i(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(n.clearcoatNormalMap=i(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(n.clearcoatNormalScale=(new Vector2).fromArray(e.clearcoatNormalScale)),void 0!==e.transmission&&(n.transmission=e.transmission),void 0!==e.transmissionMap&&(n.transmissionMap=i(e.transmissionMap)),n},setTextures:function(e){return this.textures=e,this}});const Ih={decodeText:function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let i=0,n=e.length;i<n;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch(e){return t}},extractUrlBase:function(e){const t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}};function Rh(){Ds.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}function Lh(e,t,i,n){"number"==typeof i&&(n=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),hs.call(this,e,t,i),this.meshPerAttribute=n||1}function Nh(e){Vc.call(this,e)}Rh.prototype=Object.assign(Object.create(Ds.prototype),{constructor:Rh,isInstancedBufferGeometry:!0,copy:function(e){return Ds.prototype.copy.call(this,e),this.instanceCount=e.instanceCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const e=Ds.prototype.toJSON.call(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}),Lh.prototype=Object.assign(Object.create(hs.prototype),{constructor:Lh,isInstancedBufferAttribute:!0,copy:function(e){return hs.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},toJSON:function(){const e=hs.prototype.toJSON.call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}),Nh.prototype=Object.assign(Object.create(Vc.prototype),{constructor:Nh,load:function(e,t,i,n){const s=this,o=new Gc(s.manager);o.setPath(s.path),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(e,(function(i){try{t(s.parse(JSON.parse(i)))}catch(t){n?n(t):console.error(t),s.manager.itemError(e)}}),i,n)},parse:function(e){const t={},i={};function n(e,n){if(void 0!==t[n])return t[n];const s=e.interleavedBuffers[n],o=function(e,t){if(void 0!==i[t])return i[t];const n=e.arrayBuffers[t],s=new Uint32Array(n).buffer;return i[t]=s,s}(e,s.buffer),r=new ba(Ts(s.type,o),s.stride);return r.uuid=s.uuid,t[n]=r,r}const s=e.isInstancedBufferGeometry?new Rh:new Ds,o=e.data.index;if(void 0!==o){const e=Ts(o.type,o.array);s.setIndex(new hs(e,1))}const r=e.data.attributes;for(const t in r){const i=r[t];let o;if(i.isInterleavedBufferAttribute){o=new Sa(n(e.data,i.data),i.itemSize,i.offset,i.normalized)}else{const e=Ts(i.type,i.array);o=new(i.isInstancedBufferAttribute?Lh:hs)(e,i.itemSize,i.normalized)}void 0!==i.name&&(o.name=i.name),s.setAttribute(t,o)}const a=e.data.morphAttributes;if(a)for(const t in a){const i=a[t],o=[];for(let t=0,s=i.length;t<s;t++){const s=i[t];let r;if(s.isInterleavedBufferAttribute){r=new Sa(n(e.data,s.data),s.itemSize,s.offset,s.normalized)}else{r=new hs(Ts(s.type,s.array),s.itemSize,s.normalized)}void 0!==s.name&&(r.name=s.name),o.push(r)}s.morphAttributes[t]=o}e.data.morphTargetsRelative&&(s.morphTargetsRelative=!0);const l=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==l)for(let e=0,t=l.length;e!==t;++e){const t=l[e];s.addGroup(t.start,t.count,t.materialIndex)}const c=e.data.boundingSphere;if(void 0!==c){const e=new Vector3;void 0!==c.center&&e.fromArray(c.center),s.boundingSphere=new Sphere(e,c.radius)}return e.name&&(s.name=e.name),e.userData&&(s.userData=e.userData),s}});class ObjectLoader extends Vc{constructor(e){super(e)}load(e,t,i,n){const s=this,o=""===this.path?Ih.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;const r=new Gc(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,(function(i){let o=null;try{o=JSON.parse(i)}catch(t){return void 0!==n&&n(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}const r=o.metadata;void 0!==r&&void 0!==r.type&&"geometry"!==r.type.toLowerCase()?s.parse(o,t):console.error("THREE.ObjectLoader: Can't load "+e)}),i,n)}parse(e,t){const i=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),s=this.parseGeometries(e.geometries,n),o=this.parseImages(e.images,(function(){void 0!==t&&t(l)})),r=this.parseTextures(e.textures,o),a=this.parseMaterials(e.materials,r),l=this.parseObject(e.object,s,a,i),c=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,c),void 0!==t){let e=!1;for(const t in o)if(o[t]instanceof HTMLImageElement){e=!0;break}!1===e&&t(l)}return l}parseShapes(e){const t={};if(void 0!==e)for(let i=0,n=e.length;i<n;i++){const n=(new vh).fromJSON(e[i]);t[n.uuid]=n}return t}parseSkeletons(e,t){const i={},n={};if(t.traverse((function(e){e.isBone&&(n[e.uuid]=e)})),void 0!==e)for(let t=0,s=e.length;t<s;t++){const s=(new $a).fromJSON(e[t],n);i[s.uuid]=s}return i}parseGeometries(e,t){const i={};let n;if(void 0!==e){const s=new Nh;for(let o=0,r=e.length;o<r;o++){let r;const a=e[o];switch(a.type){case"PlaneGeometry":case"PlaneBufferGeometry":r=new hc[a.type](a.width,a.height,a.widthSegments,a.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":r=new hc[a.type](a.width,a.height,a.depth,a.widthSegments,a.heightSegments,a.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":r=new hc[a.type](a.radius,a.segments,a.thetaStart,a.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":r=new hc[a.type](a.radiusTop,a.radiusBottom,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":r=new hc[a.type](a.radius,a.height,a.radialSegments,a.heightSegments,a.openEnded,a.thetaStart,a.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":r=new hc[a.type](a.radius,a.widthSegments,a.heightSegments,a.phiStart,a.phiLength,a.thetaStart,a.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":r=new hc[a.type](a.radius,a.detail);break;case"RingGeometry":case"RingBufferGeometry":r=new hc[a.type](a.innerRadius,a.outerRadius,a.thetaSegments,a.phiSegments,a.thetaStart,a.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":r=new hc[a.type](a.radius,a.tube,a.radialSegments,a.tubularSegments,a.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":r=new hc[a.type](a.radius,a.tube,a.tubularSegments,a.radialSegments,a.p,a.q);break;case"TubeGeometry":case"TubeBufferGeometry":r=new hc[a.type]((new mh[a.path.type]).fromJSON(a.path),a.tubularSegments,a.radius,a.radialSegments,a.closed);break;case"LatheGeometry":case"LatheBufferGeometry":r=new hc[a.type](a.points,a.segments,a.phiStart,a.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":r=new hc[a.type](a.vertices,a.indices,a.radius,a.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":n=[];for(let e=0,i=a.shapes.length;e<i;e++){const i=t[a.shapes[e]];n.push(i)}r=new hc[a.type](n,a.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":n=[];for(let e=0,i=a.shapes.length;e<i;e++){const i=t[a.shapes[e]];n.push(i)}const e=a.options.extrudePath;void 0!==e&&(a.options.extrudePath=(new mh[e.type]).fromJSON(e)),r=new hc[a.type](n,a.options);break;case"BufferGeometry":case"InstancedBufferGeometry":r=s.parse(a);break;case"Geometry":console.error('THREE.ObjectLoader: Loading "Geometry" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+a.type+'"');continue}r.uuid=a.uuid,void 0!==a.name&&(r.name=a.name),!0===r.isBufferGeometry&&void 0!==a.userData&&(r.userData=a.userData),i[a.uuid]=r}}return i}parseMaterials(e,t){const i={},n={};if(void 0!==e){const s=new Dh;s.setTextures(t);for(let t=0,o=e.length;t<o;t++){const o=e[t];if("MultiMaterial"===o.type){const e=[];for(let t=0;t<o.materials.length;t++){const n=o.materials[t];void 0===i[n.uuid]&&(i[n.uuid]=s.parse(n)),e.push(i[n.uuid])}n[o.uuid]=e}else void 0===i[o.uuid]&&(i[o.uuid]=s.parse(o)),n[o.uuid]=i[o.uuid]}}return n}parseAnimations(e){const t={};if(void 0!==e)for(let i=0;i<e.length;i++){const n=e[i],s=Nc.parse(n);t[s.uuid]=s}return t}parseImages(e,t){const i=this,n={};let s;function o(e){if("string"==typeof e){const t=e;return function(e){return i.manager.itemStart(e),s.load(e,(function(){i.manager.itemEnd(e)}),void 0,(function(){i.manager.itemError(e),i.manager.itemEnd(e)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:i.resourcePath+t)}return e.data?{data:Ts(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){const i=new Fc(t);s=new Wc(i),s.setCrossOrigin(this.crossOrigin);for(let t=0,i=e.length;t<i;t++){const i=e[t],s=i.url;if(Array.isArray(s)){n[i.uuid]=[];for(let e=0,t=s.length;e<t;e++){const t=o(s[e]);null!==t&&(t instanceof HTMLImageElement?n[i.uuid].push(t):n[i.uuid].push(new lo(t.data,t.width,t.height)))}}else{const e=o(i.url);null!==e&&(n[i.uuid]=e)}}}return n}parseTextures(e,t){function i(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}const n={};if(void 0!==e)for(let s=0,o=e.length;s<o;s++){const o=e[s];let r;void 0===o.image&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),void 0===t[o.image]&&console.warn("THREE.ObjectLoader: Undefined image",o.image);const a=t[o.image];Array.isArray(a)?(r=new ro(a),6===a.length&&(r.needsUpdate=!0)):(r=a&&a.data?new lo(a.data,a.width,a.height):new Gi(a),a&&(r.needsUpdate=!0)),r.uuid=o.uuid,void 0!==o.name&&(r.name=o.name),void 0!==o.mapping&&(r.mapping=i(o.mapping,kh)),void 0!==o.offset&&r.offset.fromArray(o.offset),void 0!==o.repeat&&r.repeat.fromArray(o.repeat),void 0!==o.center&&r.center.fromArray(o.center),void 0!==o.rotation&&(r.rotation=o.rotation),void 0!==o.wrap&&(r.wrapS=i(o.wrap[0],Bh),r.wrapT=i(o.wrap[1],Bh)),void 0!==o.format&&(r.format=o.format),void 0!==o.type&&(r.type=o.type),void 0!==o.encoding&&(r.encoding=o.encoding),void 0!==o.minFilter&&(r.minFilter=i(o.minFilter,Fh)),void 0!==o.magFilter&&(r.magFilter=i(o.magFilter,Fh)),void 0!==o.anisotropy&&(r.anisotropy=o.anisotropy),void 0!==o.flipY&&(r.flipY=o.flipY),void 0!==o.premultiplyAlpha&&(r.premultiplyAlpha=o.premultiplyAlpha),void 0!==o.unpackAlignment&&(r.unpackAlignment=o.unpackAlignment),n[o.uuid]=r}return n}parseObject(e,t,i,n){let s,o,r;function a(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function l(e){if(void 0!==e){if(Array.isArray(e)){const t=[];for(let n=0,s=e.length;n<s;n++){const s=e[n];void 0===i[s]&&console.warn("THREE.ObjectLoader: Undefined material",s),t.push(i[s])}return t}return void 0===i[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),i[e]}}switch(e.type){case"Scene":s=new Scene,void 0!==e.background&&Number.isInteger(e.background)&&(s.background=new Color(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?s.fog=new Fog(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(s.fog=new FogExp2(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":s=new no(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(s.focus=e.focus),void 0!==e.zoom&&(s.zoom=e.zoom),void 0!==e.filmGauge&&(s.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(s.filmOffset=e.filmOffset),void 0!==e.view&&(s.view=Object.assign({},e.view));break;case"OrthographicCamera":s=new _h(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(s.zoom=e.zoom),void 0!==e.view&&(s.view=Object.assign({},e.view));break;case"AmbientLight":s=new Oh(e.color,e.intensity);break;case"DirectionalLight":s=new Ah(e.color,e.intensity);break;case"PointLight":s=new Mh(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":s=new Ph(e.color,e.intensity,e.width,e.height);break;case"SpotLight":s=new Eh(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":s=new bh(e.color,e.groundColor,e.intensity);break;case"LightProbe":s=(new Ch).fromJSON(e);break;case"SkinnedMesh":o=a(e.geometry),r=l(e.material),s=new Za(o,r),void 0!==e.bindMode&&(s.bindMode=e.bindMode),void 0!==e.bindMatrix&&s.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(s.skeleton=e.skeleton);break;case"Mesh":o=a(e.geometry),r=l(e.material),s=new Ys(o,r);break;case"InstancedMesh":o=a(e.geometry),r=l(e.material);const t=e.count,i=e.instanceMatrix;s=new tl(o,r,t),s.instanceMatrix=new hs(new Float32Array(i.array),16);break;case"LOD":s=new Va;break;case"Line":s=new ll(a(e.geometry),l(e.material));break;case"LineLoop":s=new ul(a(e.geometry),l(e.material));break;case"LineSegments":s=new dl(a(e.geometry),l(e.material));break;case"PointCloud":case"Points":s=new yl(a(e.geometry),l(e.material));break;case"Sprite":s=new ka(l(e.material));break;case"Group":s=new pa;break;case"Bone":s=new qa;break;default:s=new Un}if(s.uuid=e.uuid,void 0!==e.name&&(s.name=e.name),void 0!==e.matrix?(s.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(s.matrixAutoUpdate=e.matrixAutoUpdate),s.matrixAutoUpdate&&s.matrix.decompose(s.position,s.quaternion,s.scale)):(void 0!==e.position&&s.position.fromArray(e.position),void 0!==e.rotation&&s.rotation.fromArray(e.rotation),void 0!==e.quaternion&&s.quaternion.fromArray(e.quaternion),void 0!==e.scale&&s.scale.fromArray(e.scale)),void 0!==e.castShadow&&(s.castShadow=e.castShadow),void 0!==e.receiveShadow&&(s.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(s.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(s.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(s.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&s.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(s.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(s.visible=e.visible),void 0!==e.frustumCulled&&(s.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(s.renderOrder=e.renderOrder),void 0!==e.userData&&(s.userData=e.userData),void 0!==e.layers&&(s.layers.mask=e.layers),void 0!==e.children){const o=e.children;for(let e=0;e<o.length;e++)s.add(this.parseObject(o[e],t,i,n))}if(void 0!==e.animations){const t=e.animations;for(let e=0;e<t.length;e++){const i=t[e];s.animations.push(n[i])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(s.autoUpdate=e.autoUpdate);const t=e.levels;for(let e=0;e<t.length;e++){const i=t[e],n=s.getObjectByProperty("uuid",i.object);void 0!==n&&s.addLevel(n,i.distance)}}return s}bindSkeletons(e,t){0!==Object.keys(t).length&&e.traverse((function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){const i=t[e.skeleton];void 0===i?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(i,e.bindMatrix)}}))}setTexturePath(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}const kh={UVMapping:se,CubeReflectionMapping:oe,CubeRefractionMapping:re,EquirectangularReflectionMapping:ae,EquirectangularRefractionMapping:le,CubeUVReflectionMapping:ce,CubeUVRefractionMapping:he},Bh={RepeatWrapping:de,ClampToEdgeWrapping:ue,MirroredRepeatWrapping:pe},Fh={NearestFilter:me,NearestMipmapNearestFilter:ge,NearestMipmapLinearFilter:ve,LinearFilter:be,LinearMipmapNearestFilter:we,LinearMipmapLinearFilter:Ee};function Uh(e){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),Vc.call(this,e),this.options={premultiplyAlpha:"none"}}function Vh(){this.type="ShapePath",this.color=new Color,this.subPaths=[],this.currentPath=null}function Hh(e){this.type="Font",this.data=e}function Gh(e,t,i,n,s){const o=s.glyphs[e]||s.glyphs["?"];if(!o)return void console.error('THREE.Font: character "'+e+'" does not exists in font family '+s.familyName+".");const r=new Vh;let a,l,c,h,d,u,p,m;if(o.o){const e=o._cachedOutline||(o._cachedOutline=o.o.split(" "));for(let s=0,o=e.length;s<o;){switch(e[s++]){case"m":a=e[s++]*t+i,l=e[s++]*t+n,r.moveTo(a,l);break;case"l":a=e[s++]*t+i,l=e[s++]*t+n,r.lineTo(a,l);break;case"q":c=e[s++]*t+i,h=e[s++]*t+n,d=e[s++]*t+i,u=e[s++]*t+n,r.quadraticCurveTo(d,u,c,h);break;case"b":c=e[s++]*t+i,h=e[s++]*t+n,d=e[s++]*t+i,u=e[s++]*t+n,p=e[s++]*t+i,m=e[s++]*t+n,r.bezierCurveTo(d,u,p,m,c,h)}}}return{offsetX:o.ha*t,path:r}}function zh(e){Vc.call(this,e)}let jh;Uh.prototype=Object.assign(Object.create(Vc.prototype),{constructor:Uh,isImageBitmapLoader:!0,setOptions:function(e){return this.options=e,this},load:function(e,t,i,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=Bc.get(e);if(void 0!==o)return s.manager.itemStart(e),setTimeout((function(){t&&t(o),s.manager.itemEnd(e)}),0),o;const r={};r.credentials="anonymous"===this.crossOrigin?"same-origin":"include",fetch(e,r).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,s.options)})).then((function(i){Bc.add(e,i),t&&t(i),s.manager.itemEnd(e)})).catch((function(t){n&&n(t),s.manager.itemError(e),s.manager.itemEnd(e)})),s.manager.itemStart(e)}}),Object.assign(Vh.prototype,{moveTo:function(e,t){return this.currentPath=new fh,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this},lineTo:function(e,t){return this.currentPath.lineTo(e,t),this},quadraticCurveTo:function(e,t,i,n){return this.currentPath.quadraticCurveTo(e,t,i,n),this},bezierCurveTo:function(e,t,i,n,s,o){return this.currentPath.bezierCurveTo(e,t,i,n,s,o),this},splineThru:function(e){return this.currentPath.splineThru(e),this},toShapes:function(e,t){function i(e){const t=[];for(let i=0,n=e.length;i<n;i++){const n=e[i],s=new vh;s.curves=n.curves,t.push(s)}return t}function n(e,t){const i=t.length;let n=!1;for(let s=i-1,o=0;o<i;s=o++){let i=t[s],r=t[o],a=r.x-i.x,l=r.y-i.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(i=t[o],a=-a,r=t[s],l=-l),e.y<i.y||e.y>r.y)continue;if(e.y===i.y){if(e.x===i.x)return!0}else{const t=l*(e.x-i.x)-a*(e.y-i.y);if(0===t)return!0;if(t<0)continue;n=!n}}else{if(e.y!==i.y)continue;if(r.x<=e.x&&e.x<=i.x||i.x<=e.x&&e.x<=r.x)return!0}}return n}const s=sc.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===t)return i(o);let r,a,l;const c=[];if(1===o.length)return a=o[0],l=new vh,l.curves=a.curves,c.push(l),c;let h=!s(o[0].getPoints());h=e?!h:h;const d=[],u=[];let p,m,g=[],f=0;u[f]=void 0,g[f]=[];for(let t=0,i=o.length;t<i;t++)a=o[t],p=a.getPoints(),r=s(p),r=e?!r:r,r?(!h&&u[f]&&f++,u[f]={s:new vh,p},u[f].s.curves=a.curves,h&&f++,g[f]=[]):g[f].push({h:a,p:p[0]});if(!u[0])return i(o);if(u.length>1){let e=!1;const t=[];for(let e=0,t=u.length;e<t;e++)d[e]=[];for(let i=0,s=u.length;i<s;i++){const s=g[i];for(let o=0;o<s.length;o++){const r=s[o];let a=!0;for(let s=0;s<u.length;s++)n(r.p,u[s].p)&&(i!==s&&t.push({froms:i,tos:s,hole:o}),a?(a=!1,d[s].push(r)):e=!0);a&&d[i].push(r)}}t.length>0&&(e||(g=d))}for(let e=0,t=u.length;e<t;e++){l=u[e].s,c.push(l),m=g[e];for(let e=0,t=m.length;e<t;e++)l.holes.push(m[e].h)}return c}}),Object.assign(Hh.prototype,{isFont:!0,generateShapes:function(e,t=100){const i=[],n=function(e,t,i){const n=Array.from?Array.from(e):String(e).split(""),s=t/i.resolution,o=(i.boundingBox.yMax-i.boundingBox.yMin+i.underlineThickness)*s,r=[];let a=0,l=0;for(let e=0;e<n.length;e++){const t=n[e];if("\n"===t)a=0,l-=o;else{const e=Gh(t,s,a,l,i);a+=e.offsetX,r.push(e.path)}}return r}(e,t,this.data);for(let e=0,t=n.length;e<t;e++)Array.prototype.push.apply(i,n[e].toShapes());return i}}),zh.prototype=Object.assign(Object.create(Vc.prototype),{constructor:zh,load:function(e,t,i,n){const s=this,o=new Gc(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(s.withCredentials),o.load(e,(function(e){let i;try{i=JSON.parse(e)}catch(t){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),i=JSON.parse(e.substring(65,e.length-2))}const n=s.parse(i);t&&t(n)}),i,n)},parse:function(e){return new Hh(e)}});const Wh={getContext:function(){return void 0===jh&&(jh=new(window.AudioContext||window.webkitAudioContext)),jh},setContext:function(e){jh=e}};function Zh(e){Vc.call(this,e)}function qh(e,t,i){Ch.call(this,void 0,i);const n=(new Color).set(e),s=(new Color).set(t),o=new Vector3(n.r,n.g,n.b),r=new Vector3(s.r,s.g,s.b),a=Math.sqrt(Math.PI),l=a*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(r).multiplyScalar(a),this.sh.coefficients[1].copy(o).sub(r).multiplyScalar(l)}function Kh(e,t){Ch.call(this,void 0,t);const i=(new Color).set(e);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}Zh.prototype=Object.assign(Object.create(Vc.prototype),{constructor:Zh,load:function(e,t,i,n){const s=this,o=new Gc(s.manager);o.setResponseType("arraybuffer"),o.setPath(s.path),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(e,(function(i){try{const e=i.slice(0);Wh.getContext().decodeAudioData(e,(function(e){t(e)}))}catch(t){n?n(t):console.error(t),s.manager.itemError(e)}}),i,n)}}),qh.prototype=Object.assign(Object.create(Ch.prototype),{constructor:qh,isHemisphereLightProbe:!0,copy:function(e){return Ch.prototype.copy.call(this,e),this},toJSON:function(e){return Ch.prototype.toJSON.call(this,e)}}),Kh.prototype=Object.assign(Object.create(Ch.prototype),{constructor:Kh,isAmbientLightProbe:!0,copy:function(e){return Ch.prototype.copy.call(this,e),this},toJSON:function(e){return Ch.prototype.toJSON.call(this,e)}});const Yh=new Matrix4,$h=new Matrix4;function Xh(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new no,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new no,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}Object.assign(Xh.prototype,{update:function(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;const i=e.projectionMatrix.clone(),n=t.eyeSep/2,s=n*t.near/t.focus,o=t.near*Math.tan(Fi.DEG2RAD*t.fov*.5)/t.zoom;let r,a;$h.elements[12]=-n,Yh.elements[12]=n,r=-o*t.aspect+s,a=o*t.aspect+s,i.elements[0]=2*t.near/(a-r),i.elements[8]=(a+r)/(a-r),this.cameraL.projectionMatrix.copy(i),r=-o*t.aspect-s,a=o*t.aspect-s,i.elements[0]=2*t.near/(a-r),i.elements[8]=(a+r)/(a-r),this.cameraR.projectionMatrix.copy(i)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply($h),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(Yh)}});class Clock{constructor(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Qh(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=Qh();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function Qh(){return("undefined"==typeof performance?Date:performance).now()}const Jh=new Vector3,ed=new Quaternion,td=new Vector3,id=new Vector3;class AudioListener extends Un{constructor(){super(),this.type="AudioListener",this.context=Wh.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Clock}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Jh,ed,td),id.set(0,0,-1).applyQuaternion(ed),t.positionX){const e=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Jh.x,e),t.positionY.linearRampToValueAtTime(Jh.y,e),t.positionZ.linearRampToValueAtTime(Jh.z,e),t.forwardX.linearRampToValueAtTime(id.x,e),t.forwardY.linearRampToValueAtTime(id.y,e),t.forwardZ.linearRampToValueAtTime(id.z,e),t.upX.linearRampToValueAtTime(i.x,e),t.upY.linearRampToValueAtTime(i.y,e),t.upZ.linearRampToValueAtTime(i.z,e)}else t.setPosition(Jh.x,Jh.y,Jh.z),t.setOrientation(id.x,id.y,id.z,i.x,i.y,i.z)}}class Audio extends Un{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const nd=new Vector3,sd=new Quaternion,od=new Vector3,rd=new Vector3;class PositionalAudio extends Audio{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,i){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=i,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(nd,sd,od),rd.set(0,0,1).applyQuaternion(sd);const t=this.panner;if(t.positionX){const e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(nd.x,e),t.positionY.linearRampToValueAtTime(nd.y,e),t.positionZ.linearRampToValueAtTime(nd.z,e),t.orientationX.linearRampToValueAtTime(rd.x,e),t.orientationY.linearRampToValueAtTime(rd.y,e),t.orientationZ.linearRampToValueAtTime(rd.z,e)}else t.setPosition(nd.x,nd.y,nd.z),t.setOrientation(rd.x,rd.y,rd.z)}}class AudioAnalyser{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let i=0;i<t.length;i++)e+=t[i];return e/t.length}}function ad(e,t,i){let n,s,o;switch(this.binding=e,this.valueSize=i,t){case"quaternion":n=this._slerp,s=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":n=this._select,s=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:n=this._lerp,s=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=s,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}Object.assign(ad.prototype,{accumulate:function(e,t){const i=this.buffer,n=this.valueSize,s=e*n+n;let o=this.cumulativeWeight;if(0===o){for(let e=0;e!==n;++e)i[s+e]=i[e];o=t}else{o+=t;const e=t/o;this._mixBufferRegion(i,s,0,e,n)}this.cumulativeWeight=o},accumulateAdditive:function(e){const t=this.buffer,i=this.valueSize,n=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,n,0,e,i),this.cumulativeWeightAdditive+=e},apply:function(e){const t=this.valueSize,i=this.buffer,n=e*t+t,s=this.cumulativeWeight,o=this.cumulativeWeightAdditive,r=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const e=t*this._origIndex;this._mixBufferRegion(i,n,e,1-s,t)}o>0&&this._mixBufferRegionAdditive(i,n,this._addIndex*t,1,t);for(let e=t,s=t+t;e!==s;++e)if(i[e]!==i[e+t]){r.setValue(i,n);break}},saveOriginalState:function(){const e=this.binding,t=this.buffer,i=this.valueSize,n=i*this._origIndex;e.getValue(t,n);for(let e=i,s=n;e!==s;++e)t[e]=t[n+e%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0},restoreOriginalState:function(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_setAdditiveIdentityNumeric:function(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0},_setAdditiveIdentityQuaternion:function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1},_setAdditiveIdentityOther:function(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]},_select:function(e,t,i,n,s){if(n>=.5)for(let n=0;n!==s;++n)e[t+n]=e[i+n]},_slerp:function(e,t,i,n){Quaternion.slerpFlat(e,t,e,t,e,i,n)},_slerpAdditive:function(e,t,i,n,s){const o=this._workIndex*s;Quaternion.multiplyQuaternionsFlat(e,o,e,t,e,i),Quaternion.slerpFlat(e,t,e,t,e,o,n)},_lerp:function(e,t,i,n,s){const o=1-n;for(let r=0;r!==s;++r){const s=t+r;e[s]=e[s]*o+e[i+r]*n}},_lerpAdditive:function(e,t,i,n,s){for(let o=0;o!==s;++o){const s=t+o;e[s]=e[s]+e[i+o]*n}}});const ld="\\[\\]\\.:\\/",cd=new RegExp("[\\[\\]\\.:\\/]","g"),hd="[^\\[\\]\\.:\\/]",dd="[^"+ld.replace("\\.","")+"]",ud=/((?:WC+[\/:])*)/.source.replace("WC",hd),pd=/(WCOD+)?/.source.replace("WCOD",dd),md=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",hd),gd=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",hd),fd=new RegExp("^"+ud+pd+md+gd+"$"),vd=["material","materials","bones"];function yd(e,t,i){const n=i||bd.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,n)}function bd(e,t,i){this.path=t,this.parsedPath=i||bd.parseTrackName(t),this.node=bd.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function wd(){this.uuid=Fi.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let t=0,i=arguments.length;t!==i;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}Object.assign(yd.prototype,{getValue:function(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,n=this._bindings[i];void 0!==n&&n.getValue(e,t)},setValue:function(e,t){const i=this._bindings;for(let n=this._targetGroup.nCachedObjects_,s=i.length;n!==s;++n)i[n].setValue(e,t)},bind:function(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()},unbind:function(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}),Object.assign(bd,{Composite:yd,create:function(e,t,i){return e&&e.isAnimationObjectGroup?new bd.Composite(e,t,i):new bd(e,t,i)},sanitizeNodeName:function(e){return e.replace(/\s/g,"_").replace(cd,"")},parseTrackName:function(e){const t=fd.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){const e=i.nodeName.substring(n+1);-1!==vd.indexOf(e)&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=e)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i},findNode:function(e,t){if(!t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(void 0!==i)return i}if(e.children){const i=function(e){for(let n=0;n<e.length;n++){const s=e[n];if(s.name===t||s.uuid===t)return s;const o=i(s.children);if(o)return o}return null},n=i(e.children);if(n)return n}return null}}),Object.assign(bd.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){const i=this.resolvedProperty;for(let n=0,s=i.length;n!==s;++n)e[t++]=i[n]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){const i=this.resolvedProperty;for(let n=0,s=i.length;n!==s;++n)i[n]=e[t++]},function(e,t){const i=this.resolvedProperty;for(let n=0,s=i.length;n!==s;++n)i[n]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){const i=this.resolvedProperty;for(let n=0,s=i.length;n!==s;++n)i[n]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){let e=this.node;const t=this.parsedPath,i=t.objectName,n=t.propertyName;let s=t.propertyIndex;if(e||(e=bd.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(i){let n=t.objectIndex;switch(i){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===n){n=t;break}break;default:if(void 0===e[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[i]}if(void 0!==n){if(void 0===e[n])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[n]}}const o=e[n];if(void 0===o){const i=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i+"."+n+" but it wasn't found.",e)}let r=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?r=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(r=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==s){if("morphTargetInfluences"===n){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[s]&&(s=e.morphTargetDictionary[s])}a=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=s}else void 0!==o.fromArray&&void 0!==o.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(a=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=n;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][r]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(bd.prototype,{_getValue_unbound:bd.prototype.getValue,_setValue_unbound:bd.prototype.setValue}),Object.assign(wd.prototype,{isAnimationObjectGroup:!0,add:function(){const e=this._objects,t=this._indicesByUUID,i=this._paths,n=this._parsedPaths,s=this._bindings,o=s.length;let r,a=e.length,l=this.nCachedObjects_;for(let c=0,h=arguments.length;c!==h;++c){const h=arguments[c],d=h.uuid;let u=t[d];if(void 0===u){u=a++,t[d]=u,e.push(h);for(let e=0,t=o;e!==t;++e)s[e].push(new bd(h,i[e],n[e]))}else if(u<l){r=e[u];const a=--l,c=e[a];t[c.uuid]=u,e[u]=c,t[d]=a,e[a]=h;for(let e=0,t=o;e!==t;++e){const t=s[e],o=t[a];let r=t[u];t[u]=o,void 0===r&&(r=new bd(h,i[e],n[e])),t[a]=r}}else e[u]!==r&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l},remove:function(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,n=i.length;let s=this.nCachedObjects_;for(let o=0,r=arguments.length;o!==r;++o){const r=arguments[o],a=r.uuid,l=t[a];if(void 0!==l&&l>=s){const o=s++,c=e[o];t[c.uuid]=l,e[l]=c,t[a]=o,e[o]=r;for(let e=0,t=n;e!==t;++e){const t=i[e],n=t[o],s=t[l];t[l]=n,t[o]=s}}}this.nCachedObjects_=s},uncache:function(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,n=i.length;let s=this.nCachedObjects_,o=e.length;for(let r=0,a=arguments.length;r!==a;++r){const a=arguments[r].uuid,l=t[a];if(void 0!==l)if(delete t[a],l<s){const r=--s,a=e[r],c=--o,h=e[c];t[a.uuid]=l,e[l]=a,t[h.uuid]=r,e[r]=h,e.pop();for(let e=0,t=n;e!==t;++e){const t=i[e],n=t[r],s=t[c];t[l]=n,t[r]=s,t.pop()}}else{const s=--o,r=e[s];s>0&&(t[r.uuid]=l),e[l]=r,e.pop();for(let e=0,t=n;e!==t;++e){const t=i[e];t[l]=t[s],t.pop()}}}this.nCachedObjects_=s},subscribe_:function(e,t){const i=this._bindingsIndicesByPath;let n=i[e];const s=this._bindings;if(void 0!==n)return s[n];const o=this._paths,r=this._parsedPaths,a=this._objects,l=a.length,c=this.nCachedObjects_,h=new Array(l);n=s.length,i[e]=n,o.push(e),r.push(t),s.push(h);for(let i=c,n=a.length;i!==n;++i){const n=a[i];h[i]=new bd(n,e,t)}return h},unsubscribe_:function(e){const t=this._bindingsIndicesByPath,i=t[e];if(void 0!==i){const n=this._paths,s=this._parsedPaths,o=this._bindings,r=o.length-1,a=o[r];t[e[r]]=i,o[i]=a,o.pop(),s[i]=s[r],s.pop(),n[i]=n[r],n.pop()}}});class AnimationAction{constructor(e,t,i=null,n=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=n;const s=t.tracks,o=s.length,r=new Array(o),a={endingStart:Gt,endingEnd:Gt};for(let e=0;e!==o;++e){const t=s[e].createInterpolant(null);r[e]=t,t.settings=a}this._interpolantSettings=a,this._interpolants=r,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Bt,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){const i=this._clip.duration,n=e._clip.duration,s=n/i,o=i/n;e.warp(1,s,t),this.warp(o,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){const n=this._mixer,s=n.time,o=this.timeScale;let r=this._timeScaleInterpolant;null===r&&(r=n._lendControlInterpolant(),this._timeScaleInterpolant=r);const a=r.parameterPositions,l=r.sampleValues;return a[0]=s,a[1]=s+i,l[0]=e/o,l[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,n){if(!this.enabled)return void this._updateWeight(e);const s=this._startTime;if(null!==s){const n=(e-s)*i;if(n<0||0===i)return;this._startTime=null,t=i*n}t*=this._updateTimeScale(e);const o=this._updateTime(t),r=this._updateWeight(e);if(r>0){const e=this._interpolants,t=this._propertyBindings;switch(this.blendMode){case Zt:for(let i=0,n=e.length;i!==n;++i)e[i].evaluate(o),t[i].accumulateAdditive(r);break;case Wt:default:for(let i=0,s=e.length;i!==s;++i)e[i].evaluate(o),t[i].accumulate(n,r)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const i=this._weightInterpolant;if(null!==i){const n=i.evaluate(e)[0];t*=n,e>i.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const i=this._timeScaleInterpolant;if(null!==i){t*=i.evaluate(e)[0],e>i.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,i=this.loop;let n=this.time+e,s=this._loopCount;const o=i===Ft;if(0===e)return-1===s?n:o&&1==(1&s)?t-n:n;if(i===kt){-1===s&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(n>=t)n=t;else{if(!(n<0)){this.time=n;break e}n=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===s&&(e>=0?(s=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),n>=t||n<0){const i=Math.floor(n/t);n-=t*i,s+=Math.abs(i);const r=this.repetitions-s;if(r<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=e>0?t:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===r){const t=e<0;this._setEndings(t,!t,o)}else this._setEndings(!1,!1,o);this._loopCount=s,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:i})}}else this.time=n;if(o&&1==(1&s))return t-n}return n}_setEndings(e,t,i){const n=this._interpolantSettings;i?(n.endingStart=zt,n.endingEnd=zt):(n.endingStart=e?this.zeroSlopeAtStart?zt:Gt:jt,n.endingEnd=t?this.zeroSlopeAtEnd?zt:Gt:jt)}_scheduleFading(e,t,i){const n=this._mixer,s=n.time;let o=this._weightInterpolant;null===o&&(o=n._lendControlInterpolant(),this._weightInterpolant=o);const r=o.parameterPositions,a=o.sampleValues;return r[0]=s,a[0]=t,r[1]=s+e,a[1]=i,this}}function Sd(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}Sd.prototype=Object.assign(Object.create(Ni.prototype),{constructor:Sd,_bindAction:function(e,t){const i=e._localRoot||this._root,n=e._clip.tracks,s=n.length,o=e._propertyBindings,r=e._interpolants,a=i.uuid,l=this._bindingsByRootAndName;let c=l[a];void 0===c&&(c={},l[a]=c);for(let e=0;e!==s;++e){const s=n[e],l=s.name;let h=c[l];if(void 0!==h)o[e]=h;else{if(h=o[e],void 0!==h){null===h._cacheIndex&&(++h.referenceCount,this._addInactiveBinding(h,a,l));continue}const n=t&&t._propertyBindings[e].binding.parsedPath;h=new ad(bd.create(i,l,n),s.ValueTypeName,s.getValueSize()),++h.referenceCount,this._addInactiveBinding(h,a,l),o[e]=h}r[e].resultBuffer=h.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,i=e._clip.uuid,n=this._actionsByClip[i];this._bindAction(e,n&&n.knownActions[0]),this._addInactiveAction(e,i,t)}const t=e._propertyBindings;for(let e=0,i=t.length;e!==i;++e){const i=t[e];0==i.useCount++&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,i=t.length;e!==i;++e){const i=t[e];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,i){const n=this._actions,s=this._actionsByClip;let o=s[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,s[t]=o;else{const t=o.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=n.length,n.push(e),o.actionByRoot[i]=e},_removeInactiveAction:function(e){const t=this._actions,i=t[t.length-1],n=e._cacheIndex;i._cacheIndex=n,t[n]=i,t.pop(),e._cacheIndex=null;const s=e._clip.uuid,o=this._actionsByClip,r=o[s],a=r.knownActions,l=a[a.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,a[c]=l,a.pop(),e._byClipCacheIndex=null;delete r.actionByRoot[(e._localRoot||this._root).uuid],0===a.length&&delete o[s],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){const t=e._propertyBindings;for(let e=0,i=t.length;e!==i;++e){const i=t[e];0==--i.referenceCount&&this._removeInactiveBinding(i)}},_lendAction:function(e){const t=this._actions,i=e._cacheIndex,n=this._nActiveActions++,s=t[n];e._cacheIndex=n,t[n]=e,s._cacheIndex=i,t[i]=s},_takeBackAction:function(e){const t=this._actions,i=e._cacheIndex,n=--this._nActiveActions,s=t[n];e._cacheIndex=n,t[n]=e,s._cacheIndex=i,t[i]=s},_addInactiveBinding:function(e,t,i){const n=this._bindingsByRootAndName,s=this._bindings;let o=n[t];void 0===o&&(o={},n[t]=o),o[i]=e,e._cacheIndex=s.length,s.push(e)},_removeInactiveBinding:function(e){const t=this._bindings,i=e.binding,n=i.rootNode.uuid,s=i.path,o=this._bindingsByRootAndName,r=o[n],a=t[t.length-1],l=e._cacheIndex;a._cacheIndex=l,t[l]=a,t.pop(),delete r[s],0===Object.keys(r).length&&delete o[n]},_lendBinding:function(e){const t=this._bindings,i=e._cacheIndex,n=this._nActiveBindings++,s=t[n];e._cacheIndex=n,t[n]=e,s._cacheIndex=i,t[i]=s},_takeBackBinding:function(e){const t=this._bindings,i=e._cacheIndex,n=--this._nActiveBindings,s=t[n];e._cacheIndex=n,t[n]=e,s._cacheIndex=i,t[i]=s},_lendControlInterpolant:function(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let i=e[t];return void 0===i&&(i=new _c(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),i.__cacheIndex=t,e[t]=i),i},_takeBackControlInterpolant:function(e){const t=this._controlInterpolants,i=e.__cacheIndex,n=--this._nActiveControlInterpolants,s=t[n];e.__cacheIndex=n,t[n]=e,s.__cacheIndex=i,t[i]=s},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t,i){const n=t||this._root,s=n.uuid;let o="string"==typeof e?Nc.findByName(n,e):e;const r=null!==o?o.uuid:e,a=this._actionsByClip[r];let l=null;if(void 0===i&&(i=null!==o?o.blendMode:Wt),void 0!==a){const e=a.actionByRoot[s];if(void 0!==e&&e.blendMode===i)return e;l=a.knownActions[0],null===o&&(o=l._clip)}if(null===o)return null;const c=new AnimationAction(this,o,t,i);return this._bindAction(c,l),this._addInactiveAction(c,r,s),c},existingAction:function(e,t){const i=t||this._root,n=i.uuid,s="string"==typeof e?Nc.findByName(i,e):e,o=s?s.uuid:e,r=this._actionsByClip[o];return void 0!==r&&r.actionByRoot[n]||null},stopAllAction:function(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this},update:function(e){e*=this.timeScale;const t=this._actions,i=this._nActiveActions,n=this.time+=e,s=Math.sign(e),o=this._accuIndex^=1;for(let r=0;r!==i;++r){t[r]._update(n,e,s,o)}const r=this._bindings,a=this._nActiveBindings;for(let e=0;e!==a;++e)r[e].apply(o);return this},setTime:function(e){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(e)},getRoot:function(){return this._root},uncacheClip:function(e){const t=this._actions,i=e.uuid,n=this._actionsByClip,s=n[i];if(void 0!==s){const e=s.knownActions;for(let i=0,n=e.length;i!==n;++i){const n=e[i];this._deactivateAction(n);const s=n._cacheIndex,o=t[t.length-1];n._cacheIndex=null,n._byClipCacheIndex=null,o._cacheIndex=s,t[s]=o,t.pop(),this._removeInactiveBindingsForAction(n)}delete n[i]}},uncacheRoot:function(e){const t=e.uuid,i=this._actionsByClip;for(const e in i){const n=i[e].actionByRoot[t];void 0!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}const n=this._bindingsByRootAndName[t];if(void 0!==n)for(const e in n){const t=n[e];t.restoreOriginalState(),this._removeInactiveBinding(t)}},uncacheAction:function(e,t){const i=this.existingAction(e,t);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}});class Uniform{constructor(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new Uniform(void 0===this.value.clone?this.value:this.value.clone())}}function Ed(e,t,i){ba.call(this,e,t),this.meshPerAttribute=i||1}function Td(e,t,i,n,s){this.buffer=e,this.type=t,this.itemSize=i,this.elementSize=n,this.count=s,this.version=0}function Md(e,t,i,n){this.ray=new Ray(e,t),this.near=i||0,this.far=n||1/0,this.camera=null,this.layers=new Layers,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function _d(e,t){return e.distance-t.distance}function xd(e,t,i,n){if(e.layers.test(t.layers)&&e.raycast(t,i),!0===n){const n=e.children;for(let e=0,s=n.length;e<s;e++)xd(n[e],t,i,!0)}}Ed.prototype=Object.assign(Object.create(ba.prototype),{constructor:Ed,isInstancedInterleavedBuffer:!0,copy:function(e){return ba.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},clone:function(e){const t=ba.prototype.clone.call(this,e);return t.meshPerAttribute=this.meshPerAttribute,t},toJSON:function(e){const t=ba.prototype.toJSON.call(this,e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}),Object.defineProperty(Td.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(Td.prototype,{isGLBufferAttribute:!0,setBuffer:function(e){return this.buffer=e,this},setType:function(e,t){return this.type=e,this.elementSize=t,this},setItemSize:function(e){return this.itemSize=e,this},setCount:function(e){return this.count=e,this}}),Object.assign(Md.prototype,{set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)},intersectObject:function(e,t,i){const n=i||[];return xd(e,this,n,t),n.sort(_d),n},intersectObjects:function(e,t,i){const n=i||[];if(!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),n;for(let i=0,s=e.length;i<s;i++)xd(e[i],this,n,t);return n.sort(_d),n}});class Spherical{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}clone(){return(new this.constructor).copy(this)}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(Fi.clamp(t/this.radius,-1,1))),this}}class Cylindrical{constructor(e,t,i){return this.radius=void 0!==e?e:1,this.theta=void 0!==t?t:0,this.y=void 0!==i?i:0,this}set(e,t,i){return this.radius=e,this.theta=t,this.y=i,this}clone(){return(new this.constructor).copy(this)}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+i*i),this.theta=Math.atan2(e,i),this.y=t,this}}const Ad=new Vector2;class Box2{constructor(e,t){Object.defineProperty(this,"isBox2",{value:!0}),this.min=void 0!==e?e:new Vector2(1/0,1/0),this.max=void 0!==t?t:new Vector2(-1/0,-1/0)}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=Ad.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new Vector2),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new Vector2),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new Vector2),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new Vector2),t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Ad.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Od=new Vector3,Pd=new Vector3;class Line3{constructor(e,t){this.start=void 0!==e?e:new Vector3,this.end=void 0!==t?t:new Vector3}set(e,t){return this.start.copy(e),this.end.copy(t),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new Vector3),e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new Vector3),e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new Vector3),this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){Od.subVectors(e,this.start),Pd.subVectors(this.end,this.start);const i=Pd.dot(Pd);let n=Pd.dot(Od)/i;return t&&(n=Fi.clamp(n,0,1)),n}closestPointToPoint(e,t,i){const n=this.closestPointToPointParameter(e,t);return void 0===i&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),i=new Vector3),this.delta(i).multiplyScalar(n).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}function Cd(e){Un.call(this),this.material=e,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}Cd.prototype=Object.create(Un.prototype),Cd.prototype.constructor=Cd,Cd.prototype.isImmediateRenderObject=!0;const Dd=new Vector3;class SpotLightHelper extends Un{constructor(e,t){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;const i=new Ds,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let e=0,t=1,i=32;e<i;e++,t++){const s=e/i*Math.PI*2,o=t/i*Math.PI*2;n.push(Math.cos(s),Math.sin(s),1,Math.cos(o),Math.sin(o),1)}i.setAttribute("position",new bs(n,3));const s=new il({fog:!1,toneMapped:!1});this.cone=new dl(i,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),Dd.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Dd),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Id=new Vector3,Rd=new Matrix4,Ld=new Matrix4;class SkeletonHelper extends dl{constructor(e){const t=Nd(e),i=new Ds,n=[],s=[],o=new Color(0,0,1),r=new Color(0,1,0);for(let e=0;e<t.length;e++){const i=t[e];i.parent&&i.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),s.push(o.r,o.g,o.b),s.push(r.r,r.g,r.b))}i.setAttribute("position",new bs(n,3)),i.setAttribute("color",new bs(s,3));super(i,new il({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,i=this.geometry,n=i.getAttribute("position");Ld.copy(this.root.matrixWorld).invert();for(let e=0,i=0;e<t.length;e++){const s=t[e];s.parent&&s.parent.isBone&&(Rd.multiplyMatrices(Ld,s.matrixWorld),Id.setFromMatrixPosition(Rd),n.setXYZ(i,Id.x,Id.y,Id.z),Rd.multiplyMatrices(Ld,s.parent.matrixWorld),Id.setFromMatrixPosition(Rd),n.setXYZ(i+1,Id.x,Id.y,Id.z),i+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}function Nd(e){const t=[];e&&e.isBone&&t.push(e);for(let i=0;i<e.children.length;i++)t.push.apply(t,Nd(e.children[i]));return t}class PointLightHelper extends Ys{constructor(e,t,i){super(new SphereBufferGeometry(t,4,2),new as({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.light.updateMatrixWorld(),this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const kd=new Vector3,Bd=new Color,Fd=new Color;class HemisphereLightHelper extends Un{constructor(e,t,i){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i;const n=new OctahedronBufferGeometry(t);n.rotateY(.5*Math.PI),this.material=new as({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const s=n.getAttribute("position"),o=new Float32Array(3*s.count);n.setAttribute("color",new hs(o,3)),this.add(new Ys(n,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");Bd.copy(this.light.color),Fd.copy(this.light.groundColor);for(let e=0,i=t.count;e<i;e++){const n=e<i/2?Bd:Fd;t.setXYZ(e,n.r,n.g,n.b)}t.needsUpdate=!0}e.lookAt(kd.setFromMatrixPosition(this.light.matrixWorld).negate())}}class GridHelper extends dl{constructor(e=10,t=10,i=4473924,n=8947848){i=new Color(i),n=new Color(n);const s=t/2,o=e/t,r=e/2,a=[],l=[];for(let e=0,c=0,h=-r;e<=t;e++,h+=o){a.push(-r,0,h,r,0,h),a.push(h,0,-r,h,0,r);const t=e===s?i:n;t.toArray(l,c),c+=3,t.toArray(l,c),c+=3,t.toArray(l,c),c+=3,t.toArray(l,c),c+=3}const c=new Ds;c.setAttribute("position",new bs(a,3)),c.setAttribute("color",new bs(l,3));super(c,new il({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}class PolarGridHelper extends dl{constructor(e=10,t=16,i=8,n=64,s=4473924,o=8947848){s=new Color(s),o=new Color(o);const r=[],a=[];for(let i=0;i<=t;i++){const n=i/t*(2*Math.PI),l=Math.sin(n)*e,c=Math.cos(n)*e;r.push(0,0,0),r.push(l,0,c);const h=1&i?s:o;a.push(h.r,h.g,h.b),a.push(h.r,h.g,h.b)}for(let t=0;t<=i;t++){const l=1&t?s:o,c=e-e/i*t;for(let e=0;e<n;e++){let t=e/n*(2*Math.PI),i=Math.sin(t)*c,s=Math.cos(t)*c;r.push(i,0,s),a.push(l.r,l.g,l.b),t=(e+1)/n*(2*Math.PI),i=Math.sin(t)*c,s=Math.cos(t)*c,r.push(i,0,s),a.push(l.r,l.g,l.b)}}const l=new Ds;l.setAttribute("position",new bs(r,3)),l.setAttribute("color",new bs(a,3));super(l,new il({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}}const Ud=new Vector3,Vd=new Vector3,Hd=new Vector3;class DirectionalLightHelper extends Un{constructor(e,t,i){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,void 0===t&&(t=1);let n=new Ds;n.setAttribute("position",new bs([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const s=new il({fog:!1,toneMapped:!1});this.lightPlane=new ll(n,s),this.add(this.lightPlane),n=new Ds,n.setAttribute("position",new bs([0,0,0,0,0,1],3)),this.targetLine=new ll(n,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){Ud.setFromMatrixPosition(this.light.matrixWorld),Vd.setFromMatrixPosition(this.light.target.matrixWorld),Hd.subVectors(Vd,Ud),this.lightPlane.lookAt(Vd),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Vd),this.targetLine.scale.z=Hd.length()}}const Gd=new Vector3,zd=new io;class CameraHelper extends dl{constructor(e){const t=new Ds,i=new il({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],s=[],o={},r=new Color(16755200),a=new Color(16711680),l=new Color(43775),c=new Color(16777215),h=new Color(3355443);function d(e,t,i){u(e,i),u(t,i)}function u(e,t){n.push(0,0,0),s.push(t.r,t.g,t.b),void 0===o[e]&&(o[e]=[]),o[e].push(n.length/3-1)}d("n1","n2",r),d("n2","n4",r),d("n4","n3",r),d("n3","n1",r),d("f1","f2",r),d("f2","f4",r),d("f4","f3",r),d("f3","f1",r),d("n1","f1",r),d("n2","f2",r),d("n3","f3",r),d("n4","f4",r),d("p","n1",a),d("p","n2",a),d("p","n3",a),d("p","n4",a),d("u1","u2",l),d("u2","u3",l),d("u3","u1",l),d("c","t",c),d("p","c",h),d("cn1","cn2",h),d("cn3","cn4",h),d("cf1","cf2",h),d("cf3","cf4",h),t.setAttribute("position",new bs(n,3)),t.setAttribute("color",new bs(s,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}update(){const e=this.geometry,t=this.pointMap;zd.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),jd("c",t,e,zd,0,0,-1),jd("t",t,e,zd,0,0,1),jd("n1",t,e,zd,-1,-1,-1),jd("n2",t,e,zd,1,-1,-1),jd("n3",t,e,zd,-1,1,-1),jd("n4",t,e,zd,1,1,-1),jd("f1",t,e,zd,-1,-1,1),jd("f2",t,e,zd,1,-1,1),jd("f3",t,e,zd,-1,1,1),jd("f4",t,e,zd,1,1,1),jd("u1",t,e,zd,.7,1.1,-1),jd("u2",t,e,zd,-.7,1.1,-1),jd("u3",t,e,zd,0,2,-1),jd("cf1",t,e,zd,-1,0,1),jd("cf2",t,e,zd,1,0,1),jd("cf3",t,e,zd,0,-1,1),jd("cf4",t,e,zd,0,1,1),jd("cn1",t,e,zd,-1,0,-1),jd("cn2",t,e,zd,1,0,-1),jd("cn3",t,e,zd,0,-1,-1),jd("cn4",t,e,zd,0,1,-1),e.getAttribute("position").needsUpdate=!0}}function jd(e,t,i,n,s,o,r){Gd.set(s,o,r).unproject(n);const a=t[e];if(void 0!==a){const e=i.getAttribute("position");for(let t=0,i=a.length;t<i;t++)e.setXYZ(a[t],Gd.x,Gd.y,Gd.z)}}const Wd=new Box3;class BoxHelper extends dl{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),s=new Ds;s.setIndex(new hs(i,1)),s.setAttribute("position",new hs(n,3)),super(s,new il({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&Wd.setFromObject(this.object),Wd.isEmpty())return;const t=Wd.min,i=Wd.max,n=this.geometry.attributes.position,s=n.array;s[0]=i.x,s[1]=i.y,s[2]=i.z,s[3]=t.x,s[4]=i.y,s[5]=i.z,s[6]=t.x,s[7]=t.y,s[8]=i.z,s[9]=i.x,s[10]=t.y,s[11]=i.z,s[12]=i.x,s[13]=i.y,s[14]=t.z,s[15]=t.x,s[16]=i.y,s[17]=t.z,s[18]=t.x,s[19]=t.y,s[20]=t.z,s[21]=i.x,s[22]=t.y,s[23]=t.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e){return dl.prototype.copy.call(this,e),this.object=e.object,this}}class Box3Helper extends dl{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Ds;n.setIndex(new hs(i,1)),n.setAttribute("position",new bs([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(n,new il({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}}class PlaneHelper extends ll{constructor(e,t=1,i=16776960){const n=i,s=new Ds;s.setAttribute("position",new bs([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),s.computeBoundingSphere(),super(s,new il({color:n,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const o=new Ds;o.setAttribute("position",new bs([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),o.computeBoundingSphere(),this.add(new Ys(o,new as({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){let t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?g:m,this.lookAt(this.plane.normal),super.updateMatrixWorld(e)}}const Zd=new Vector3;let qd,Kd;class ArrowHelper extends Un{constructor(e,t,i,n,s,o){super(),this.type="ArrowHelper",void 0===e&&(e=new Vector3(0,0,1)),void 0===t&&(t=new Vector3(0,0,0)),void 0===i&&(i=1),void 0===n&&(n=16776960),void 0===s&&(s=.2*i),void 0===o&&(o=.2*s),void 0===qd&&(qd=new Ds,qd.setAttribute("position",new bs([0,0,0,0,1,0],3)),Kd=new CylinderBufferGeometry(0,.5,1,5,1),Kd.translate(0,-.5,0)),this.position.copy(t),this.line=new ll(qd,new il({color:n,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Ys(Kd,new as({color:n,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i,s,o)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{Zd.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(Zd,t)}}setLength(e,t,i){void 0===t&&(t=.2*e),void 0===i&&(i=.2*t),this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}}class AxesHelper extends dl{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=new Ds;i.setAttribute("position",new bs(t,3)),i.setAttribute("color",new bs([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));super(i,new il({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}}const Yd=new Float32Array(1),$d=new Int32Array(Yd.buffer),Xd={toHalfFloat:function(e){Yd[0]=e;const t=$d[0];let i=t>>16&32768,n=t>>12&2047;const s=t>>23&255;return s<103?i:s>142?(i|=31744,i|=(255==s?0:1)&&8388607&t,i):s<113?(n|=2048,i|=(n>>114-s)+(n>>113-s&1),i):(i|=s-112<<10|n>>1,i+=1&n,i)}},Qd=Math.pow(2,8),Jd=[.125,.215,.35,.446,.526,.582],eu=5+Jd.length,tu=20,iu={[$t]:0,[Xt]:1,[Jt]:2,[ti]:3,[ii]:4,[ni]:5,[Qt]:6},nu=new _h,{_lodPlanes:su,_sizeLods:ou,_sigmas:ru}=pu(),au=new Color;let lu=null;const cu=(1+Math.sqrt(5))/2,hu=1/cu,du=[new Vector3(1,1,1),new Vector3(-1,1,1),new Vector3(1,1,-1),new Vector3(-1,1,-1),new Vector3(0,cu,hu),new Vector3(0,cu,-hu),new Vector3(hu,0,cu),new Vector3(-hu,0,cu),new Vector3(cu,hu,0),new Vector3(-cu,hu,0)];class PMREMGenerator{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._blurMaterial=function(e){const t=new Float32Array(e),i=new Vector3(0,1,0);return new uc({name:"SphericalGaussianBlur",defines:{n:e},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:t},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i},inputEncoding:{value:iu[$t]},outputEncoding:{value:iu[$t]}},vertexShader:yu(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t${bu()}\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:b,depthTest:!1,depthWrite:!1})}(tu),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,n=100){lu=this._renderer.getRenderTarget();const s=this._allocateTargets();return this._sceneToCubeUV(e,i,n,s),t>0&&this._blur(s,0,0,t),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e){return this._fromTexture(e)}fromCubemap(e){return this._fromTexture(e)}compileCubemapShader(){null===this._cubemapShader&&(this._cubemapShader=vu(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){null===this._equirectShader&&(this._equirectShader=fu(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let e=0;e<su.length;e++)su[e].dispose()}_cleanup(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(lu),e.scissorTest=!1,gu(e,0,0,e.width,e.height)}_fromTexture(e){lu=this._renderer.getRenderTarget();const t=this._allocateTargets(e);return this._textureToCubeUV(e,t),this._applyPMREM(t),this._cleanup(t),t}_allocateTargets(e){const t={magFilter:me,minFilter:me,generateMipmaps:!1,type:Me,format:He,encoding:uu(e)?e.encoding:Jt,depthBuffer:!1},i=mu(t);return i.depthBuffer=!e,this._pingPongRenderTarget=mu(t),i}_compileMaterial(e){const t=new Ys(su[0],e);this._renderer.compile(t,nu)}_sceneToCubeUV(e,t,i,n){const s=new no(90,1,t,i),o=[1,-1,1,1,1,1],r=[1,1,1,-1,-1,-1],a=this._renderer,l=a.outputEncoding,c=a.toneMapping;a.getClearColor(au);const h=a.getClearAlpha();a.toneMapping=Q,a.outputEncoding=$t;let d=e.background;if(d&&d.isColor){d.convertSRGBToLinear();const t=Math.max(d.r,d.g,d.b),i=Math.min(Math.max(Math.ceil(Math.log2(t)),-128),127);d=d.multiplyScalar(Math.pow(2,-i));const n=(i+128)/255;a.setClearColor(d,n),e.background=null}for(let t=0;t<6;t++){const i=t%3;0==i?(s.up.set(0,o[t],0),s.lookAt(r[t],0,0)):1==i?(s.up.set(0,0,o[t]),s.lookAt(0,r[t],0)):(s.up.set(0,o[t],0),s.lookAt(0,0,r[t])),gu(n,i*Qd,t>2?Qd:0,Qd,Qd),a.setRenderTarget(n),a.render(e,s)}a.toneMapping=c,a.outputEncoding=l,a.setClearColor(au,h)}_textureToCubeUV(e,t){const i=this._renderer;e.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=vu()):null==this._equirectShader&&(this._equirectShader=fu());const n=e.isCubeTexture?this._cubemapShader:this._equirectShader,s=new Ys(su[0],n),o=n.uniforms;o.envMap.value=e,e.isCubeTexture||o.texelSize.value.set(1/e.image.width,1/e.image.height),o.inputEncoding.value=iu[e.encoding],o.outputEncoding.value=iu[t.texture.encoding],gu(t,0,0,3*Qd,2*Qd),i.setRenderTarget(t),i.render(s,nu)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let t=1;t<eu;t++){const i=Math.sqrt(ru[t]*ru[t]-ru[t-1]*ru[t-1]),n=du[(t-1)%du.length];this._blur(e,t-1,t,i,n)}t.autoClear=i}_blur(e,t,i,n,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,i,n,"latitudinal",s),this._halfBlur(o,e,i,i,n,"longitudinal",s)}_halfBlur(e,t,i,n,s,o,r){const a=this._renderer,l=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new Ys(su[n],l),h=l.uniforms,d=ou[i]-1,u=isFinite(s)?Math.PI/(2*d):2*Math.PI/39,p=s/u,m=isFinite(s)?1+Math.floor(3*p):tu;m>tu&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${m} samples when the maximum is set to 20`);const g=[];let f=0;for(let e=0;e<tu;++e){const t=e/p,i=Math.exp(-t*t/2);g.push(i),0==e?f+=i:e<m&&(f+=2*i)}for(let e=0;e<g.length;e++)g[e]=g[e]/f;h.envMap.value=e.texture,h.samples.value=m,h.weights.value=g,h.latitudinal.value="latitudinal"===o,r&&(h.poleAxis.value=r),h.dTheta.value=u,h.mipInt.value=8-i,h.inputEncoding.value=iu[e.texture.encoding],h.outputEncoding.value=iu[e.texture.encoding];const v=ou[n];gu(t,3*Math.max(0,Qd-2*v),(0===n?0:2*Qd)+2*v*(n>4?n-8+4:0),3*v,2*v),a.setRenderTarget(t),a.render(c,nu)}}function uu(e){return void 0!==e&&e.type===Me&&(e.encoding===$t||e.encoding===Xt||e.encoding===Qt)}function pu(){const e=[],t=[],i=[];let n=8;for(let s=0;s<eu;s++){const o=Math.pow(2,n);t.push(o);let r=1/o;s>4?r=Jd[s-8+4-1]:0==s&&(r=0),i.push(r);const a=1/(o-1),l=-a/2,c=1+a/2,h=[l,l,c,l,c,c,l,l,c,c,l,c],d=6,u=6,p=3,m=2,g=1,f=new Float32Array(p*u*d),v=new Float32Array(m*u*d),y=new Float32Array(g*u*d);for(let e=0;e<d;e++){const t=e%3*2/3-1,i=e>2?0:-1,n=[t,i,0,t+2/3,i,0,t+2/3,i+1,0,t,i,0,t+2/3,i+1,0,t,i+1,0];f.set(n,p*u*e),v.set(h,m*u*e);const s=[e,e,e,e,e,e];y.set(s,g*u*e)}const b=new Ds;b.setAttribute("position",new hs(f,p)),b.setAttribute("uv",new hs(v,m)),b.setAttribute("faceIndex",new hs(y,g)),e.push(b),n>4&&n--}return{_lodPlanes:e,_sizeLods:t,_sigmas:i}}function mu(e){const t=new ji(3*Qd,3*Qd,e);return t.texture.mapping=ce,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function gu(e,t,i,n,s){e.viewport.set(t,i,n,s),e.scissor.set(t,i,n,s)}function fu(){return new uc({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:new Vector2(1,1)},inputEncoding:{value:iu[$t]},outputEncoding:{value:iu[$t]}},vertexShader:yu(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t${bu()}\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:b,depthTest:!1,depthWrite:!1})}function vu(){return new uc({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:iu[$t]},outputEncoding:{value:iu[$t]}},vertexShader:yu(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t${bu()}\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:b,depthTest:!1,depthWrite:!1})}function yu(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function bu(){return"\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t"}function wu(e,t,i,n,s,o,r){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new Face3(e,t,i,s,o,r)}const Su=0,Eu=1,Tu=0,Mu=1,_u=2;function xu(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e}function Au(e=[]){return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e}function Ou(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new yl(e,t)}function Pu(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new ka(e)}function Cu(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new yl(e,t)}function Du(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new pl(e)}function Iu(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new pl(e)}function Ru(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new pl(e)}function Lu(e,t,i){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new Vector3(e,t,i)}function Nu(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new hs(e,t).setUsage(_i)}function ku(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new ds(e,t)}function Bu(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new us(e,t)}function Fu(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new ps(e,t)}function Uu(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new ms(e,t)}function Vu(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new gs(e,t)}function Hu(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new fs(e,t)}function Gu(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new vs(e,t)}function zu(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new bs(e,t)}function ju(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new ws(e,t)}function Wu(e){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),nh.call(this,e),this.type="catmullrom",this.closed=!0}function Zu(e){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),nh.call(this,e),this.type="catmullrom"}function qu(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),nh.call(this,e),this.type="catmullrom"}function Ku(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new AxesHelper(e)}function Yu(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new BoxHelper(e,t)}function $u(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new dl(new EdgesGeometry(e.geometry),new il({color:void 0!==t?t:16777215}))}function Xu(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new dl(new WireframeGeometry(e.geometry),new il({color:void 0!==t?t:16777215}))}function Qu(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new Gc(e)}function Ju(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new qc(e)}function ep(e,t,i){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new ao(e,i)}Yc.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Yc.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Object.assign(gh.prototype,{createPointsGeometry:function(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const t=new Ol;for(let i=0,n=e.length;i<n;i++){const n=e[i];t.vertices.push(new Vector3(n.x,n.y,n.z||0))}return t}}),Object.assign(fh.prototype,{fromPoints:function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),Wu.prototype=Object.create(nh.prototype),Zu.prototype=Object.create(nh.prototype),qu.prototype=Object.create(nh.prototype),Object.assign(qu.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),GridHelper.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},SkeletonHelper.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(Vc.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Ih.extractUrlBase(e)}}),Vc.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(Box2.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(Box3.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(Sphere.prototype,{empty:function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()}}),Frustum.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},Line3.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(Fi,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),Fi.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),Fi.ceilPowerOfTwo(e)}}),Object.assign(Matrix3.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},getInverse:function(e){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()}}),Object.assign(Matrix4.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new Vector3).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,i,n,s,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,n,i,s,o)},getInverse:function(e){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()}}),Plane.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},Object.assign(Quaternion.prototype,{multiplyVector3:function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},inverse:function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()}}),Object.assign(Ray.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(Triangle.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign(Triangle,{barycoordFromPoint:function(e,t,i,n,s){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Triangle.getBarycoord(e,t,i,n,s)},normal:function(e,t,i,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Triangle.getNormal(e,t,i,n)}}),Object.assign(vh.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new ExtrudeGeometry(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new ShapeGeometry(this,e)}}),Object.assign(Vector2.prototype,{fromAttribute:function(e,t,i){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Vector3.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,i){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Vector4.prototype,{fromAttribute:function(e,t,i){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Ol.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")},applyMatrix:function(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.assign(Un.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.defineProperties(Un.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(Ys.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(Ys.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),qt},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(Va.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty($a.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),Za.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(Yc.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),no.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(yh.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(hs.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===_i},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(_i)}}}),Object.assign(hs.prototype,{setDynamic:function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?_i:Mi),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(Ds.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addAttribute:function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new hs(arguments[1],arguments[2])))},addDrawCall:function(e,t,i){void 0!==i&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},applyMatrix:function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.defineProperties(Ds.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(Rh.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(e){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=e}}}),Object.defineProperties(Md.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(e){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=e}}}),Object.defineProperties(ba.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===_i},set:function(e){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(e)}}}),Object.assign(ba.prototype,{setDynamic:function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?_i:Mi),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(ExtrudeBufferGeometry.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.assign(Scene.prototype,{dispose:function(){console.error("THREE.Scene: .dispose() has been removed.")}}),Object.defineProperties(Uniform.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(rs.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Color}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=e===v}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}}}),Object.defineProperties(gc.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(mc.prototype,{transparency:{get:function(){return console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission},set:function(e){console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission=e}}}),Object.defineProperties(to.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(va.prototype,{clearTarget:function(e,t,i,n){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,i,n)},animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(va.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?Xt:$t}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(la.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(ji.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.defineProperties(Audio.prototype,{load:{value:function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const t=this;return(new Zh).load(e,(function(e){t.setBuffer(e)})),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),AudioAnalyser.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},oo.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)},oo.prototype.clear=function(e,t,i,n){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(e,t,i,n)};const tp={merge:function(e,t,i){let n;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),t.isMesh&&(t.matrixAutoUpdate&&t.updateMatrix(),n=t.matrix,t=t.geometry),e.merge(t,n,i)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}};function ip(){console.error("THREE.CanvasRenderer has been removed")}function np(){console.error("THREE.JSONLoader has been removed.")}Vi.crossOrigin=void 0,Vi.loadTexture=function(e,t,i,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const s=new Kc;s.setCrossOrigin(this.crossOrigin);const o=s.load(e,i,void 0,n);return t&&(o.mapping=t),o},Vi.loadTextureCube=function(e,t,i,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const s=new Zc;s.setCrossOrigin(this.crossOrigin);const o=s.load(e,i,void 0,n);return t&&(o.mapping=t),o},Vi.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Vi.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const sp={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};function op(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:n}}))},92924:(e,t,i)=>{"use strict";i.d(t,{ej:()=>l,kG:()=>c,U6:()=>p});var n=i(70655);!function(e){function t(){var t=this||self;t.globalThis=t,delete e.prototype._T_}"object"!=typeof globalThis&&(this?t():(e.defineProperty(e.prototype,"_T_",{configurable:!0,get:t}),_T_))}(Object);const s=globalThis;var o="Invariant Violation",r=Object.setPrototypeOf,a=void 0===r?function(e,t){return e.__proto__=t,e}:r,l=function(e){function t(i){void 0===i&&(i=o);var n=e.call(this,"number"==typeof i?o+": "+i+" (see https://github.com/apollographql/invariant-packages)":i)||this;return n.framesToPop=1,n.name=o,a(n,t.prototype),n}return(0,n.ZT)(t,e),t}(Error);function c(e,t){if(!e)throw new l(t)}var h=["log","warn","error","silent"],d=h.indexOf("log");function u(e){return function(){if(h.indexOf(e)>=d)return console[e].apply(console,arguments)}}function p(e){var t=h[d];return d=Math.max(0,h.indexOf(e)),t}!function(e){e.log=u("log"),e.warn=u("warn"),e.error=u("error")}(c||(c={}));var m=s.process||{env:{}};if(!s.process)try{Object.defineProperty(s,"process",{value:m})}catch(e){}},28134:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ErrorType:()=>f,default:()=>ErrorGui});var n=i(54122),s=i(79994),o=i(29359),r=i(21265),a=i(87207),l=i(68472),c=i(75673),h=i(81826);const d=e=>({problem:"",solution:e.t(o.Z.ERROR_BROWSER_SOLUTION),explanation:e.t(o.Z.ERROR_BROWSER_EXPLANATION),actions:(0,r.tq)()?"":["<div id='browser-tiles'>","<a href='https://www.google.com/chrome/browser/' target='_blank'>","<div class='tile'>",`<img src=${a}>`,"</div>","</a>","<a href='https://www.mozilla.org/en-US/firefox/new/' target='_blank'>","<div class='tile'>",`<img src=${l}>`,"</div>","</a>","<a href='https://www.microsoft.com/en-us/edge' target='_blank'>","<div class='tile'>",`<img src=${c}>`,"</div>","</a>","<a href='https://support.apple.com/en-us/HT204416' target='_blank'>","<div class='tile'>",`<img src=${h}>`,"</div>","</a>","</div>"].join("")}),u=e=>Object.assign(Object.assign({},d(e)),{problem:`${e.t(o.Z.ERROR_WEBGL_UNSUPPORTED_PROBLEM)}`}),p="https://support.matterport.com/hc/articles/208220058",m=e=>({problem:e.t(o.Z.ERROR_GENERIC_PROBLEM),solution:e.t(o.Z.ERROR_GENERIC_SOLUTION),explanation:"",actions:[`${e.t(o.Z.ERROR_GENERIC_ACTIONS_1)}`].concat((0,r.tq)()?[]:[`<a id='install-browser' href='#'>${e.t(o.Z.ERROR_GENERIC_ACTIONS_2)}</a>`,`${e.t(o.Z.ERROR_GENERIC_ACTIONS_3)}`]).concat([`<a href=${p} target='_blank'>${e.t(o.Z.ERROR_GENERIC_ACTIONS_4)}</a>`]).join("")}),g=e=>({problem:e.t(o.Z.ERROR_LOADING_FAILED_PROBLEM),solution:"",explanation:"",actions:[`${e.t(o.Z.ERROR_LOADING_FAILED_ACTIONS_1)}`,`<a href=${p} target='_blank'>${e.t(o.Z.ERROR_LOADING_FAILED_ACTIONS_2)}</a>`].join("")});var f;!function(e){e[e.UNSUPPORTED=1]="UNSUPPORTED",e[e.WEBGL=2]="WEBGL",e[e.GENERIC=3]="GENERIC"}(f||(f={}));class ErrorGui extends n.Y{constructor(){super(...arguments),this.name="error-gui"}async init(e,t){this.container=document.querySelector("#error-container"),this.problem=document.querySelector("#error-problem"),this.solution=document.querySelector("#error-solution"),this.explanation=document.querySelector("#error-explanation"),this.actions=document.querySelector("#error-actions"),this.localeModule=await t.getModule(s.default)}showError(e){switch(e){case f.UNSUPPORTED:this.populateErrorScreen(u);break;case f.WEBGL:this.populateErrorScreen(m);const e=this.actions.querySelector("#install-browser");e&&e.addEventListener("click",(()=>this.populateErrorScreen(d)));break;case f.GENERIC:default:this.populateErrorScreen(g)}}populateErrorScreen(e){const t=e(this.localeModule);this.container.classList.remove("hidden"),this.problem.innerText=t.problem,this.solution.innerText=t.solution,this.explanation.innerText=t.explanation,this.actions.innerHTML=t.actions}}},73920:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ShowcaseGui});var n=i(26605),s=i(54122),o=i(3471),r=i(29675),a=i(90601),l=i(72215),c=i(90039),h=i(94184),d=i(29359),u=i(8336),p=i(14900),m=i(979),g=i(47173),f=i(2116),v=i(21265),y=i(12856),b=i(71583),w=i(26265),S=i(80429),E=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let T=class VrModalControls extends n.Component{constructor(e){super(e),this.handleClick=()=>{this.context.commandBinder.issueCommand(new b.Bz(y.P.VR_SELECT,!this.props.open))}}render(){return(0,n.h)(S.h,{appendClass:{"view-in-vr":!0},onClick:this.handleClick},(0,n.h)(w.oO,{content:this.context.locale.t(d.Z.VIEW_IN_VR),position:w.lZ.UP,tooltipTimeout:(0,v.Jm)()?1e3:void 0},(0,n.h)("span",{class:"icon icon-vr"})))}};T=E([f.Z],T);var M=i(30593),_=i(24391),x=i(15100),A=i(35543),O=i(25799),P=i(19417);const C=new O.Z("pause-button");class PauseButton extends n.Component{constructor(e){super(e),this.justEnded=!1,this.stopTour=async e=>{this.context.analytics.track("showcase_gui",{gui_action:"tour_stopped"}),e.preventDefault();try{this.context.commandBinder.issueCommand(new P.vy)}catch(e){C.debug(e)}},this.state={justPaused:!1}}componentDidUpdate(){this.state.justPaused&&this.setState({justPaused:!1}),this.justEnded=!1}componentWillReceiveProps(e){!this.props.tourPlaying||e.tourPlaying||this.justEnded||this.setState({justPaused:!0}),this.props.tourEnded&&(this.justEnded=!0)}render(){const{tourPlaying:e}=this.props,{justPaused:t}=this.state;return(0,n.h)("div",{id:"pause-button",onClick:this.stopTour,onTouchMove:this.stopTour,onTouchStart:this.stopTour},!e&&(0,n.h)("img",{src:i(31896),class:h({justPaused:t})}))}}var D,I=i(62431),R=i(72942),L=i(39990),N=i(78215),k=i(43711),B=i(75638),F=i(14600),U=i(86134),V=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let H=D=class MeasurementModeButton extends n.Component{constructor(e,t){super(e),this.nudgeTimeout=0,this.updateNudge=()=>{const e=this.context.settings.tryGetProperty(B.b,!1),t=this.context.settings.tryGetProperty(F.F.MeasurementUserNudgeSeen,!1);!e||t||this.nudgeTimeout||(this.nudgeTimeout=window.setTimeout((()=>{this.setState({showNudge:!0}),window.setTimeout((()=>{this.dismissNudge()}),D.DISMISS_NUDGE_TIMEOUT)}),D.SHOW_NUDGE_TIMEOUT))},this.dismissNudge=()=>{this.state.showNudge&&(this.context.analytics.track("showcase_gui",{gui_action:"mesasure_nudge"}),this.context.settings.setLocalStorageProperty(F.F.MeasurementUserNudgeSeen,!0),this.setState({showNudge:!1}))},this.openMeasurementsMode=()=>{this.context.analytics.track("showcase_gui",{gui_action:"measure_mode"}),this.context.commandBinder.issueCommand(new k.tT(a.w1.MEASUREMENTS,!0))},this.localized={measurement_mode:t.locale.t(d.Z.MEASUREMENT_MODE),nudgeTitleString:t.locale.t(d.Z.MEASUREMENT_NUDGE_TITLE),nudgeMessageString:t.locale.t(d.Z.MEASUREMENT_NUDGE_MESSAGE)},this.state={showNudge:!1}}componentDidMount(){this.updateNudge()}render(){const{tooltipTimeout:e}=this.props,{showNudge:t}=this.state,{nudgeTitleString:i,nudgeMessageString:s}=this.localized;return(0,n.h)("div",{class:"measure-mode-button"},(0,n.h)(S.h,{onClick:this.openMeasurementsMode},(0,n.h)(w.oO,{content:this.localized.measurement_mode,position:w.lZ.UP,tooltipTimeout:e},(0,n.h)("span",{class:"icon icon-tape-measure"}))),(0,n.h)(U.u,{appendClass:{"tooltip-title-large":!0,"nudge-tooltip":!0},open:t,closeButton:!0,onClose:this.dismissNudge,title:i,message:(0,n.h)("div",{class:"nudge-message"},(0,n.h)("span",{class:"message"},s)),arrowPos:U.x.BOTTOM_CENTER}))}};H.SHOW_NUDGE_TIMEOUT=6e4,H.DISMISS_NUDGE_TIMEOUT=1e4,H=D=V([f.Z],H);const G=H;var z=i(63985),j=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let W=class Footer extends n.Component{constructor(e){super(e),this.handleTermsClick=()=>{const e=this.props.openModal===y.P.TERMS;this.context.commandBinder.issueCommand(new b.Bz(y.P.TERMS,!e)),this.context.analytics.track("showcase_gui",{gui_action:"click_terms_button",interaction_source:"gui"})},this.handleHelpClick=()=>{const e=this.props.openModal===y.P.HELP;this.context.commandBinder.issueCommand(new b.Bz(y.P.HELP,!e)),this.context.analytics.track("showcase_gui",{gui_action:"click_help_button",interaction_source:"gui"})}}getFooterLogo(){const e="1"!==(0,v.hu)("mls"),t=i(89992),s=(0,n.h)("img",{class:"footer-logo",src:t});return e?(0,n.h)("a",{class:"link logo-link",href:"https://matterport.com",target:"_blank"},s):s}render(){return(0,n.h)("div",{id:"footer"},(0,n.h)("span",{onClick:this.handleHelpClick,class:"link"},this.context.locale.t(d.Z.HELP)),(0,n.h)("span",null," | "),(0,n.h)("span",{onClick:this.handleTermsClick,class:"link"},this.context.locale.t(d.Z.TERMS)),this.getFooterLogo())}};W=j([f.Z],W);const Z=W;class BottomUi extends n.Component{constructor(e){super(e),this.touchDevice=(0,v.Jm)(),this.viewmodeToClass={[R.BD.INSIDE]:"inside",[R.BD.OUTSIDE]:"outside",[R.BD.DOLLHOUSE]:"dollhouse",[R.BD.FLOORPLAN]:"floorplan",[R.BD.TRANSITIONING]:"transitioning"},this.onBriefHLR=()=>{this.setState((e=>({briefHlr:!e.briefHlr})))},this.updateViewportSize=()=>{const e=this.context&&this.context.mainDiv?this.context.mainDiv.offsetHeight:window.innerHeight;this.setState({viewportHeight:e})},this.isReelEnabled=()=>{const{settings:e}=this.context,{viewportHeight:t}=this.state,i=e.checkUrlParam("hr",1,1),n=e.tryGetProperty(I.gx.HighlightReel,!0);return t>=x.cR&&i&&n},this.isTourEnabled=()=>{const{settings:e}=this.context,t=!!e.tryGetProperty("gt",1),i=e.tryGetProperty(I.gx.TourButtons,!0);return t&&i},this.isFloorsEnabled=()=>{const{settings:e}=this.context,t=e.tryGetProperty(g.w,!0),i=e.tryGetProperty(I.gx.FloorSelect,!0);return t&&i},this.onToggleHLR=e=>{this.isReelEnabled()&&this.props.tourState.totalSteps>0&&this.setState({reelOpen:e})},this.toggleShareModal=()=>{const e=this.props.openModal===y.P.SHARE;this.context.analytics.track("showcase_gui",{gui_action:"click_share_button"}),this.context.commandBinder.issueCommand(new b.Bz(y.P.SHARE,!e))},this.renderHighlightReelControls=()=>{const{totalSteps:e,tourPlaying:t}=this.props.tourState,i=this.isReelEnabled()&&e>0,s=this.isTourEnabled()&&e>0;return(0,n.h)("div",{class:"highlight-tour-controls"},i&&(0,n.h)(_.Z,{reelOpen:this.state.reelOpen,onToggleHLR:this.onToggleHLR,reelEnabled:i}),s&&(0,n.h)(p.Z,{tourEmpty:!1,tourPlaying:t}))},this.renderModeControls=()=>(0,n.h)(u.Z,{unaligned:this.props.unaligned}),this.renderFloorPlanControls=()=>{const{viewmode:e}=this.props;return(0,n.h)(m.Z,{viewmode:e})},this.renderNotesModeButton=()=>(0,n.h)(N.Z,{tooltipTimeout:this.touchDevice?1e3:void 0}),this.renderMeasurementModeButton=()=>(0,n.h)(G,{tooltipTimeout:this.touchDevice?1e3:void 0}),this.renderHighlightReel=e=>{const{totalSteps:t,tourPlaying:i,highlights:s,activeStep:o,transition:r}=this.props.tourState,{reelOpen:a,briefHlr:l}=this.state;return(0,n.h)(x.ZP,{transition:r,activeStep:o,highlights:s,tourPlaying:i,totalSteps:t,reelOpen:a&&e,briefHlr:l,onBriefHLR:this.onBriefHLR,onToggleHLR:this.onToggleHLR})},this.renderFooter=()=>{const{reelOpen:e}=this.state,{openTool:t,openModal:i,tourState:s}=this.props,{totalSteps:o,tourPlaying:r,activeStep:l}=s,c=t===a.w1.NOTES||t===a.w1.TAGS;return(0,n.h)("div",{class:"footer-ui"},!t&&(0,n.h)(A.Z,{activeStep:l,tourPlaying:r,totalSteps:o,reelOpen:e,onToggleHLR:this.onToggleHLR}),!c&&(0,n.h)(Z,{openModal:i}))},this.renderLeftControls=()=>{const e=[],{unaligned:t,measurementsModeEnabled:i,notesEnabled:n,openTool:s}=this.props,{totalSteps:o}=this.props.tourState,r=this.isReelEnabled()&&o>0;return(this.isTourEnabled()&&o>0||r)&&!s&&e.push(this.renderHighlightReelControls()),e.push(this.renderModeControls()),this.isFloorsEnabled()&&e.push(this.renderFloorPlanControls()),!n||s||t||e.push(this.renderNotesModeButton()),!i||s||t||e.push(this.renderMeasurementModeButton()),e},this.renderRightControls=()=>{const e=[],{vrEnabled:t,openModal:i,shareEnabled:s}=this.props,o=(0,v.O6)();return e.push((0,n.h)("span",{class:"divider"})),s&&e.push((0,n.h)(S.h,{onClick:this.toggleShareModal},(0,n.h)(w.oO,{content:this.context.locale.t(d.Z.SOCIAL_SHARING),position:w.lZ.UP_LEFT,tooltipTimeout:this.touchDevice?1e3:void 0},(0,n.h)("span",{class:"icon icon-share"})))),t&&e.push((0,n.h)(T,{open:i===y.P.VR_SELECT})),o&&e.push((0,n.h)(M.Z,null)),e},this.state={reelOpen:!1,briefHlr:!1,viewportHeight:0},this.onResize=(0,L.D)(this.updateViewportSize,250),this.updateViewportSize()}componentDidMount(){this.updateViewportSize(),this.onBriefHLR(),window.addEventListener("resize",this.onResize)}componentWillUnmount(){window.removeEventListener("resize",this.onResize)}render(){const{tourState:e,viewmode:t,openModal:i,openTool:s}=this.props,{tourPlaying:o,tourEnded:r,totalSteps:a}=e,{reelOpen:l}=this.state,c=this.viewmodeToClass[t]||"",d=this.isReelEnabled()&&a>0,u=d&&!s&&!i,p=!s,m={"reel-open":u&&l,"modal-open":!!i,"tour-playing":o},g={"faded-out":!!i&&!s};return(0,n.h)("div",{id:"bottom-ui",class:h("bottom-ui",m,c)},(0,n.h)(PauseButton,{tourPlaying:o,tourEnded:r}),(0,n.h)("div",{class:h("bottom-controls",g)},(0,n.h)(z.i,{className:"controls"},this.renderLeftControls(),p&&this.renderRightControls())),d&&this.renderHighlightReel(u),this.renderFooter())}}var q=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let K=class Summary extends n.Component{constructor(e){super(e)}render(){let e=this.props.mode===ie.Expanded;const t=this.props.mode===ie.Collapsed,i=this.props.formattedAddress?(0,n.h)("div",{class:"address"},(0,n.h)("i",{class:"icon-pin"}," "),this.props.formattedAddress):null,s=this.props.summary?(0,n.h)("div",{class:"summary-description"},this.props.summary):null,o=this.props.contactName?(0,n.h)("span",{id:"summary-name"},this.props.contactName,(0,n.h)("br",null)):null,r=this.props.formattedContactPhone?this.props.formattedContactPhone:this.props.phone;let a;a=r&&(0,v.tq)()?(0,n.h)("div",null,(0,n.h)("a",{id:"phone",class:"link",href:"tel:"+this.props.phone},r)):r?(0,n.h)("span",{id:"summary-phone"},r,(0,n.h)("br",null)):null;const l=this.props.contactEmail?(0,n.h)("a",{id:"email",class:"link",href:"mailto:"+this.props.contactEmail},this.props.contactEmail,(0,n.h)("br",null)):null,c=!!(o||a||l),u=c?(0,n.h)("i",{class:"icon-user"}," "):null,p=c?(0,n.h)("span",{class:"contact-block"},u,(0,n.h)("div",{class:"contact-data"},o,a,l)):null,m=this.props.externalUrl&&(0,n.h)("div",{id:"external-link"},(0,n.h)("hr",null),(0,n.h)("i",{class:"icon-ext-link"}),(0,n.h)("div",null,(0,n.h)("span",null,this.context.locale.t(d.Z.LEARN_MORE)+": "),(0,n.h)("a",{class:"link",onClick:this.props.onExternalLinkClicked,href:this.props.externalUrl,target:"_blank"},this.props.externalUrl)));e=!(!e||!(c||i||s));const g=h({"main-title":!0,expanded:e,collapsed:t}),f=h({"summary-details":!0,expanded:e,collapsed:t,hasExternalLink:!!m});return(0,n.h)("div",{id:"summary-wrapper",class:g},(0,n.h)("div",{class:f},s,p,i,m))}};K=q([f.Z],K);const Y=K;var $=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let X=class TitleToggle extends n.Component{constructor(e){super(e)}render(){const e=this.props.mode===ie.Collapsed?"right":"left";return(0,n.h)("div",{id:"title-toggle",onClick:this.props.handleClick},(0,n.h)("span",{class:"icon icon-dpad-"+e}))}};X=$([f.Z],X);const Q=X;var J=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let ee=class MainTitle extends n.Component{constructor(e){super(e)}collapsed(){return this.props.mode===ie.Collapsed}expanded(){return this.props.mode===ie.Expanded}render(){const e=this.props.presentedBy,t=this.expanded()?this.context.locale.t(d.Z.LESS):this.context.locale.t(d.Z.MORE),i=this.expanded()?"up":"down",s=h({"main-title":!0,collapsed:this.collapsed()}),o=h({"co-brand":!0,hidden:!e}),r=h({titleText:!0,noCoBrand:!e});return(0,n.h)("div",{type:"button","data-balloon":this.props.name,"data-balloon-pos":"down",class:h("main-title-row",this.collapsed()||this.expanded()?"tooltip-hidden":""),style:"display: inline-block",onClick:this.props.handleClick},(0,n.h)("div",{id:"main-title-wrapper"},(0,n.h)("div",{class:s},(0,n.h)("div",{class:o},this.context.locale.t(d.Z.PRESENTED_BY),(0,n.h)("span",{class:"title",id:"cobrandTitle"}," ",e)),this.props.showHint&&(0,n.h)("div",{class:"hint"},(0,n.h)("span",{class:"link-btn"},t+" ",(0,n.h)("span",{class:"icon icon-dpad-"+i}))),(0,n.h)("div",{id:"gui-name",class:r},this.props.name))))}};ee=J([f.Z],ee);const te=ee;var ie,ne=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};!function(e){e[e.Collapsed=0]="Collapsed",e[e.Normal=1]="Normal",e[e.Expanded=2]="Expanded"}(ie||(ie={}));let se=class TitleBar extends n.Component{constructor(e){super(e),this.toggleTitleCollapse=()=>{this.setTitleBarMode(ie.Collapsed)},this.toggleTitleExpand=()=>{this.state.mode===ie.Expanded?this.setTitleBarMode(ie.Normal):this.setTitleBarMode(ie.Expanded)},this.onExternalLinkClicked=e=>{e.preventDefault(),this.context.analytics.track("showcase_share_origin_link_clicked"),window.open(this.props.modelDetails.externalUrl)},this.state={mode:ie.Normal,lastMode:ie.Normal,open:!0}}setTitleBarMode(e){this.setState((t=>({mode:t.mode===e?t.lastMode:e,lastMode:t.mode})))}getFilteredValue(e,t,i,n){return!this.context.settings.tryGetProperty(t,i)||n&&!this.props.brandingEnabled?"":e}render(){const{modelDetails:e,showExternalUrl:t}=this.props,{name:i,presentedBy:s,summary:o,formattedAddress:r,contact:a,externalUrl:l}=e,{mode:c}=this.state,d=t?l:"",u=this.getFilteredValue(i,I.gx.DetailsModelName,!0,!1),p=this.getFilteredValue(o,I.gx.DetailsSummary,!1,!1),m=this.getFilteredValue(r,I.gx.DetailsAddress,!1,!1),g=this.getFilteredValue(s,I.gx.PresentedBy,!1,!0),f=this.getFilteredValue(a.name,I.gx.DetailsName,!1,!0),v=this.getFilteredValue(a.email,I.gx.DetailsEmail,!1,!0),y=this.getFilteredValue(a.phone,I.gx.DetailsPhone,!1,!0),b=this.getFilteredValue(a.formattedPhone,I.gx.DetailsPhone,!1,!0),w=""!==p||""!==m||""!==v||""!==f||""!==b||""!==y;return(0,n.h)("div",{id:"model-title",className:h(ie[c])},(0,n.h)("div",{class:"title-row"},(0,n.h)(Q,{mode:c,handleClick:this.toggleTitleCollapse}),(0,n.h)(te,{name:u,mode:c,showHint:w,presentedBy:g,handleClick:this.toggleTitleExpand})),(0,n.h)("div",{class:"details-row"},(0,n.h)(Y,{mode:c,summary:p,formattedAddress:m,phone:y,formattedContactPhone:b,contactEmail:v,contactName:f,externalUrl:d,onExternalLinkClicked:this.onExternalLinkClicked})))}};se=ne([f.Z],se);const oe=se;var re=i(22729);class TopUi extends n.Component{constructor(e){super(e),this.bindings=[],this.updateState=()=>{this.setState({titleActive:!this.floorsViewData.showFloorSelection})},this.state={titleActive:!0}}componentDidMount(){Promise.all([this.context.market.waitForData(re.c)]).then((e=>{[this.floorsViewData]=e,this.bindings.push(this.floorsViewData.onShowFloorSelectionChanged(this.updateState)),this.updateState()}))}componentWillUnmount(){this.bindings.forEach((e=>e.cancel())),this.bindings.length=0}render(){const{showing:e,tourState:t,modelDetails:i,showExternalUrl:s,brandingEnabled:o,titleBarEnabled:r}=this.props,{titleActive:a}=this.state,l=h({"faded-out":!e||t.tourPlaying||!a});return(0,n.h)("div",{id:"top-ui",class:l},r&&i&&(0,n.h)(oe,{modelDetails:i,showExternalUrl:s,brandingEnabled:o}))}}var ae=i(57155),le=i(91172),ce=i(21685),he=i(83455),de=i(5767),ue=i(7342),pe=i(89155),me=i(24550),ge=i(2212),fe=i(39869),ve=i(48840),ye=i(7121),be=i(41479);class RoomLabel extends n.Component{constructor(e){super(e)}render(){const{sid:e,position:t,text:i,readOnlyText:s,rotation:o,visible:r}=this.props,a={left:t.x+"px",top:t.y+"px",transform:o?`translate(-50%, -50%) rotate(${o}deg) `:"translate(-50%, -50%)"},l=s?`${i} ${s}`:i;return r?(0,n.h)("div",{id:e,class:"label",style:a},(0,n.h)("span",null,l)):null}}const we=new O.Z("label-ui");class LabelLayer extends n.Component{constructor(e){super(e),this.subscriptions=[],this.reusableVector=new ge.Vector3,this.inFloorPlan=e=>e===R.BD.FLOORPLAN,this.onCameraUpdate=()=>{this.inFloorPlan(this.props.viewmode)&&this.updateLabelPositions()},this.onViewTransitionStart=()=>{this.setState({inModeTransition:!0})},this.onViewTransitionEnd=async e=>{this.inFloorPlan((0,R.ty)(e.toMode))&&(this.setState({inModeTransition:!1}),this.updateLabelPositions())},this.updateFloorState=()=>{this.setState({currentFloorId:this.floorsViewData.currentFloorId,topMostFloorId:this.floorsViewData.topFloorId})},this.updateLabelPositions=async()=>{const e={};for(const t of this.labelData.getCollection()){this.reusableVector.set(t.position.x,t.position.y,t.position.z);const i=await this.context.commandBinder.issueCommand(new me.b({worldPosition:this.reusableVector}));e[t.sid]=Object.assign({screenPosition:i},t)}this.setState({labelPositions:e})},this.clearVisibleFloor=()=>{this.setState({currentFloorId:null})},this.updateVisibleFloor=e=>{this.setState({currentFloorId:e.floorId})},this.setState({labelPositions:{},currentFloorId:null,topMostFloorId:null,inModeTransition:!1})}async componentDidMount(){const e=this.context.messageBus;try{this.floorsViewData=await this.context.market.waitForData(re.c);const e=this.floorsViewData.onChanged(this.updateFloorState);this.subscriptions.push(e),this.updateFloorState(),this.labelData=await this.context.market.waitForData(ue.D)}catch(e){we.debug(e)}this.updateLabelPositions();const t=await this.context.market.waitForData(pe.M_);this.subscriptions.push(t.onChanged(this.onCameraUpdate),e.subscribe(ye.S,this.clearVisibleFloor),e.subscribe(be.P,this.updateVisibleFloor),e.subscribe(ve.Z,this.onViewTransitionStart),e.subscribe(fe.Z,this.onViewTransitionEnd)),this.subscriptions.forEach((e=>e.renew()))}componentWillUnmount(){this.subscriptions.forEach((e=>e.cancel()))}renderLabel(e){const{currentFloorId:t,topMostFloorId:i,labelPositions:s}=this.state,{floorId:o,screenPosition:r,text:a,visible:l,sid:c,rotation:h}=s[e];return(0,n.h)(RoomLabel,{key:c,position:r,rotation:h,text:a,visible:(!t&&i===o||t===o)&&l,sid:c})}render(){const{inModeTransition:e,labelPositions:t}=this.state,{viewmode:i}=this.props;if(!this.inFloorPlan(i)||e)return null;const s=[];return Object.keys(t).forEach((e=>{s.push(this.renderLabel(e))})),(0,n.h)("div",{class:"overlay-layer labels-layer"},s)}}var Se=i(2082),Ee=i(82359),Te=i(43771),Me=i(82209),_e=i(86682),xe=i(42733);class DollhouseLayer extends n.Component{constructor(){super(),this.bindings=[],this.clearFloors=async()=>{await this.context.commandBinder.issueCommand(new _e.Vw(null,!1))},this.updateState=()=>{const{floorsViewData:e}=this;this.setState({active:e.showFloorSelection,floorName:e.currentFloorId?e.getFloorName(e.currentFloorId):this.state.floorName})},this.state={active:!1,floorName:void 0}}componentDidMount(){Promise.all([this.context.market.waitForData(re.c)]).then((e=>{[this.floorsViewData]=e,this.updateState(),this.bindings.push(this.floorsViewData.makeFloorChangeSubscription(this.updateState),this.floorsViewData.onShowFloorSelectionChanged(this.updateState))}))}componentWillUnmount(){this.bindings.forEach((e=>e.cancel())),this.bindings.length=0}render(){const{floorName:e,active:t}=this.state;if(!this.floorsViewData)return null;const i=h("floor-container",{"faded-out":!t});return(0,n.h)("div",{class:i},(0,n.h)("div",{class:"floor-title"},(0,n.h)("div",{class:"h4"},e||"")),(0,n.h)(S.h,{iconClass:"icon-close",buttonStyle:S.D.CLEAR,buttonSize:xe.qE.STANDARD,tooltipPosition:w.lZ.DOWN_RIGHT,onClick:this.clearFloors}))}}var Ae=i(53339);class OverlayUi extends n.Component{constructor(e){super(e),this.propertiesToRefreshUi=[le.re,he.Mp,ae.Nj,I.gx.Labels,g.Q,ae.Mr],this.bindings=[],this.inTransition=!1,this.newTagsEnabled=!1,this.notesEnabled=!1,this.onLoadSpinnerMessage=e=>{this.setState({loadSpinnerOn:e.isOpen})},this.onLoadSpinnerSuppressMessage=e=>{this.setState({loadSpinnerSuppress:e.suppress})},this.refreshVisibility=()=>{const e=this.context.settings;this.setState({labelsOn:e.tryGetProperty(ae.Nj,!1)&&e.tryGetProperty(I.gx.Labels,!1)&&!e.tryGetProperty(ae.Mr,!1)&&!this.inTransition,mattertagsOn:e.tryGetProperty(le.re,!1),notesOn:e.tryGetProperty(he.Mp,!1),roomBasedNav:e.tryGetProperty(g.Q,!1)})},this.state={mattertagsOn:!1,labelsOn:!1,notesOn:!1,loadSpinnerOn:!1,loadSpinnerSuppress:!1,roomBasedNav:!1}}componentDidMount(){for(const e of this.propertiesToRefreshUi)this.context.settings.onPropertyChanged(e,this.refreshVisibility);const e=()=>{this.inTransition=!0},t=()=>{this.inTransition=!1,this.refreshVisibility()};this.bindings.push(this.context.messageBus.subscribe(ve.Z,e),this.context.messageBus.subscribe(fe.Z,t),this.context.messageBus.subscribe(ye.S,e),this.context.messageBus.subscribe(be.P,t),this.context.messageBus.subscribe(Me.Z_,this.onLoadSpinnerMessage),this.context.messageBus.subscribe(Me.bN,this.onLoadSpinnerSuppressMessage),this.context.messageBus.subscribe(Ae.oR,(()=>this.setState({loadSpinnerSuppress:!0}))),this.context.messageBus.subscribe(Ae.NR,(()=>this.setState({loadSpinnerSuppress:!1})))),this.refreshVisibility(),this.newTagsEnabled=this.context.settings.tryGetProperty(ce.R,!1),this.notesEnabled=this.context.settings.tryGetProperty(he.IA,!1)}componentWillUnmount(){for(const e of this.propertiesToRefreshUi)this.context.settings.removeOnPropertyChanged(e,this.refreshVisibility);this.bindings.forEach((e=>e.cancel())),this.bindings.length=0}render(){const{labelsOn:e,mattertagsOn:t,notesOn:i,roomBasedNav:s,loadSpinnerOn:o,loadSpinnerSuppress:r}=this.state,{mobile:a,viewmode:l,openModal:c,activeTool:h,tourPlaying:d}=this.props,u=o&&!r,p=t&&this.newTagsEnabled,m=i&&this.notesEnabled,g=m||p;return(0,n.h)("div",{class:"overlay-ui"},(0,n.h)(Ee.I,null),g&&(0,n.h)(Se.E,{notesEnabled:m,newTagsEnabled:p,openModal:c,activeTool:h}),t&&!this.newTagsEnabled&&(0,n.h)(de.$,{tourPlaying:d,toolOpen:!1,mobile:a,allowTagOverlay:!0}),e&&(0,n.h)(LabelLayer,{viewmode:l}),s&&(0,n.h)(DollhouseLayer,null),(0,n.h)(Te.Z,{showing:u}))}}var Oe=i(58091),Pe=i(14071),Ce=i(95843),De=i(84952),Ie=i(20331),Re=i(55656);class Terms extends n.Component{constructor(){super(),this.onScrollPositionChange=()=>{this.scrollbars&&this.setState({scrollClass:this.scrollbars.scrollPosition.vertical})},this.onClose=()=>{this.setState({showing:!1}),this.context.commandBinder.issueCommand(new b.Bz(y.P.TERMS,!1))},this.stopPropagation=e=>{e.stopPropagation()},this.state={termsText:"",showing:!1,scrollClass:Ce.Ij.None}}async componentDidMount(){const e="./terms/terms-"+(this.context.locale?this.context.locale.languageCode:Re.a)+".html";let t="";try{t=await new Ie.gO({retries:0}).get(e)}catch(e){t=this.context.locale.t(d.Z.TERMS_FAIL)}window.requestAnimationFrame((()=>{this.setState({showing:!0,termsText:t})}))}componentDidUpdate(e){this.state.termsText!==e.termsText&&(this.termsTextDiv.innerHTML=this.state.termsText,[].slice.call(this.termsTextDiv.querySelectorAll("a")).forEach((e=>{e.setAttribute("target","_blank"),e.classList.add("link")})))}render(){const{showing:e,scrollClass:t}=this.state;return(0,n.h)("div",{class:h("modal","terms-modal",{"faded-in":e,[t]:!0}),onClick:this.stopPropagation},(0,n.h)("div",{id:"terms-wrapper"},(0,n.h)(Oe.Z,{name:"terms",ref:e=>this.scrollbars=e,onScrollPositionChange:this.onScrollPositionChange,forceHidden:(0,De.w)(window)},(0,n.h)("div",{ref:e=>this.termsTextDiv=e,id:"terms-text"}))),(0,n.h)(Pe.P,{buttonStyle:Pe.A.LIGHT,onClose:this.onClose}))}}var Le=i(38593),Ne=i(18317),ke=i(25903),Be=i(35539),Fe=i(61103);const Ue=new O.Z("webvr");class WebVRUtility{constructor(e,t,i){this.vrDisplay=e,this.commandBinder=t,this.onEvent=i,this.startWebVR=()=>{if(this.vrDisplay&&this.vrDisplay.capabilities.canPresent&&!this.vrDisplay.isPresenting){this.onEvent("vr_enter_app"),this.commandBinder.issueCommand(new Fe.w);const e=document.createElement("canvas");for(e.getContext("webgl"),e.className="webvr-canvas",document.bgColor="#000",document.body.style.backgroundColor="#000";document.body.firstChild;)document.body.removeChild(document.body.firstChild);document.body.appendChild(e),this.vrDisplay.requestPresent([{source:e}]).then((()=>{window.addEventListener("vrdisplaypresentchange",this.onExitWebVr)})).catch((e=>{Ue.error("requestPresent Failed:",e),this.onEvent("vr_present_error")})),window.dispatchEvent(new Event("vrapp-start"))}else Ue.error("vrDisplay not found, or already presenting"),this.onEvent("vr_present_error")},this.onExitWebVr=()=>{if(!this.vrDisplay.isPresenting){this.onEvent("vr_exit_app"),window.removeEventListener("vrdisplaypresentchange",this.onExitWebVr);let e=window.location.href;-1===window.location.search.indexOf("&qs=1")&&(e+="&qs=1"),Ue.info("redirecting to:",e),window.location.replace(e)}},t.issueCommand(new Fe.s)}}var Ve=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};const He=new O.Z("vr-select");let Ge=class VrModal extends n.Component{constructor(e){super(e),this.webVRUtility=null,this.stopPropagation=e=>{e.stopPropagation()},this.renderHeadsetHeader=()=>{const{locale:e}=this.context,{vrPlatform:t}=this.state;switch(t){case Le.bk.webvr:return(0,n.h)("div",{class:"headset-header"},(0,n.h)("img",{class:"align-center",src:i(7560)}));case Le.bk.unsupported:case Le.bk.webxr:return(0,n.h)("div",{class:"headset-header dark"},(0,n.h)("span",{class:"headset-titles"},(0,n.h)("h2",null,e.t(d.Z.VR_RECOMMENDED)),(0,n.h)("h1",null,e.t(d.Z.VR_QUEST))),(0,n.h)("img",{class:"headset-quest",src:i(63931)}));default:return null}},this.renderBodyText=()=>{const{locale:e}=this.context,{vrPlatform:t}=this.state;switch(t){case Le.bk.webvr:return(0,n.h)("div",null,(0,n.h)("p",null,e.t(d.Z.VR_APP_INSTRUCT)),(0,n.h)("p",null,e.t(d.Z.VR_APP_RECCOMMENDED)));case Le.bk.unsupported:case Le.bk.webxr:return(0,n.h)("div",null,(0,n.h)("p",null,e.t(d.Z.VR_SUPPORTS)));default:return null}},this.getFooterButtons=()=>{const{locale:e}=this.context,{vrPlatform:t}=this.state,i=[];i.push((0,n.h)(xe.zx,{buttonStyle:xe.ZJ.OUTLINE,appendClass:{"button-inline":!0,cancel:!0},onClick:this.onLearnMoreClicked},e.t(d.Z.VR_LEARN_MORE_CAPS)));return(t===Le.bk.webvr||t===Le.bk.webxr)&&i.push((0,n.h)(xe.zx,{buttonState:xe.BN.ENABLED,appendClass:{"button-inline":!0,confirm:!0},onClick:this.onActionClicked},e.t(d.Z.VR_ENTER))),i},this.closeModal=()=>{this.context.commandBinder.issueCommand(new b.Bz(y.P.VR_SELECT,!1))},this.onCloseClicked=()=>{this.trackEvent("vr_modal_close"),this.closeModal()},this.onActionClicked=()=>{switch(this.state.vrPlatform){case Le.bk.webvr:this.webVRUtility&&(this.webVRUtility.startWebVR(),this.closeModal());break;case Le.bk.webxr:this.startWebXR(),this.closeModal()}},this.onLearnMoreClicked=()=>{window.open("https://support.matterport.com/hc/en-us/articles/360050098973-Exploring-Matterport-Spaces-in-VR-","_blank"),this.trackEvent("vr_learn_more")},this.startWebXR=()=>{this.context.commandBinder.issueCommand(new Be.j({type:"immersive-vr",features:["local-floor"]})).then((e=>{if(e){this.trackEvent("vr_enter_app");const t=()=>{this.trackEvent("vr_exit_app"),e.removeEventListener("end",t)};e.addEventListener("end",t)}else He.error("requestPresent Failed"),this.trackEvent("vr_present_error"),this.updatePlatformState()})).catch((e=>{He.error("requestPresent Failed:",e);const t=e?{message:e.message||"",name:e.name||""}:void 0;this.trackEvent("vr_present_error",t)}))},this.state={vrPlatform:null}}async componentDidMount(){Ne.Z.apiExists()&&navigator.xr.addEventListener("ondevicechange",this.updatePlatformState),await this.updatePlatformState(),this.trackEvent("click_vr_button")}componentWillUnmount(){Ne.Z.apiExists()&&navigator.xr.removeEventListener("ondevicechange",this.updatePlatformState)}render(){const{isMobile:e}=this.props,{vrPlatform:t}=this.state,{locale:i}=this.context,s=h("vr-modal","modal","full-modal",{mobile:e,desktop:!e}),o=t===Le.bk.webvr,r=h("modal-footer",{cardboard:o});return(0,n.h)("dialog",{class:s,onClick:this.stopPropagation},(0,n.h)("header",{class:"modal-header"},(0,n.h)("div",{class:"modal-title"},i.t(d.Z.VR_VIEW_SPACE)),(0,n.h)(Pe.P,{onClose:this.onCloseClicked})),this.renderHeadsetHeader(),(0,n.h)("div",{class:"modal-body"},this.renderBodyText()),(0,n.h)("div",{class:r},this.getFooterButtons()))}async updatePlatformState(){const e=await(0,Le.pl)();switch(e){case Le.bk.webvr:const e=await ke.H();e&&!this.webVRUtility&&(this.webVRUtility=new WebVRUtility(e,this.context.commandBinder,this.trackEvent.bind(this)))}this.setState({vrPlatform:e}),He.debug(this.state)}trackEvent(e,t){let i={gui_action:e,orientation:(0,v.mI)()?"landscape":"portrait",vr_platform:this.state.vrPlatform};i=Object.assign(i,t),this.context.analytics.track("showcase_gui",i)}};Ge=Ve([f.Z],Ge);const ze=Ge;class CtaSmall extends n.Component{render(){const{isMobile:e}=this.props,{locale:t}=this.context;return(0,n.h)("div",{class:"cta"},(0,n.h)("h1",{class:h({mobile:e})},t.t(e?d.Z.MOBILE_SHORT_CTA:d.Z.DESKTOP_SHORT_CTA)))}}const je={mouse:{click:i(41891),clickInside:i(70626),dragLeft:i(73993),dragRight:i(26668),play:i(31891),positionLeft:i(82906),positionRight:i(64991),zoom:i(12136)},gesture:{drag:i(72145),dragTwoFinger:i(12742),pinch:i(5435),position:i(67649),positionTwoFinger:i(2433),tap:i(24367),tapInside:i(90619),play:i(94874)},keyboard:{all:i(76064),inside:i(64549),leftRight:i(81202),spaceBar:i(71002),upDown:i(42135),zoom:i(26407)},moreHelp:{view360:i(86533),mattertag:i(14653)}};class CtaDesktop extends n.Component{constructor(){super(...arguments),this.keys={header:d.Z.DESKTOP_SHORT_CTA,move:d.Z.MOVE,inside:d.Z.INSIDE,rotate:d.Z.ROTATE,play:d.Z.PLAY,zoom:d.Z.ZOOM},this.clickInside={Icon:je.mouse.clickInside,Label:this.keys.inside,FooterIcon:je.keyboard.inside},this.clickMove={Icon:je.mouse.positionRight,Label:this.keys.move,FooterIcon:""},this.moveUpDown={Icon:je.mouse.click,Label:this.keys.move,FooterIcon:je.keyboard.upDown},this.play={Icon:je.mouse.play,Label:this.keys.play,FooterIcon:null},this.zoom={Icon:je.mouse.zoom,Label:this.keys.zoom,FooterIcon:je.keyboard.zoom},this.dragMove={Icon:je.mouse.positionLeft,Label:this.keys.move,FooterIcon:null},this.dragRotateLeft={Icon:je.mouse.dragLeft,Label:this.keys.rotate,FooterIcon:je.keyboard.leftRight},this.dragRotateRight={Icon:je.mouse.dragRight,Label:this.keys.rotate,FooterIcon:je.keyboard.leftRight},this.left=this.clickInside,this.center=this.clickMove,this.right=this.play}render(){const{viewmode:e}=this.props,{locale:t}=this.context;return this.configureViewmodeSpecifics(e),(0,n.h)("div",{class:h({cta:!0})},(0,n.h)("h1",null,t.t(this.keys.header)),(0,n.h)("h2",null,t.t(this.left.Label)),(0,n.h)("img",{src:this.left.Icon}),this.left.FooterIcon?(0,n.h)("hr",null):(0,n.h)("span",null),this.left.FooterIcon?(0,n.h)("img",{class:"footer-icon",src:this.left.FooterIcon}):(0,n.h)("span",null),(0,n.h)("h2",null,t.t(this.center.Label)),(0,n.h)("img",{src:this.center.Icon}),this.center.FooterIcon?(0,n.h)("hr",null):(0,n.h)("span",null),this.center.FooterIcon?(0,n.h)("img",{class:"footer-icon",src:this.center.FooterIcon}):(0,n.h)("span",null),(0,n.h)("h2",null,t.t(this.right.Label)),(0,n.h)("img",{src:this.right.Icon}),this.right.FooterIcon?(0,n.h)("hr",null):(0,n.h)("span",null),this.right.FooterIcon?(0,n.h)("img",{class:"footer-icon",src:this.right.FooterIcon}):(0,n.h)("span",null))}configureViewmodeSpecifics(e){switch(e){case R.BD.INSIDE:this.left=this.dragRotateLeft,this.center=this.moveUpDown,this.right=this.props.isHelpCta?this.zoom:this.play;break;case R.BD.OUTSIDE:case R.BD.DOLLHOUSE:this.left=this.dragRotateLeft,this.center=this.clickMove,this.right=this.clickInside;break;case R.BD.FLOORPLAN:this.left=this.dragMove,this.center=this.dragRotateRight,this.right=this.clickInside}}}class CtaMobile extends n.Component{constructor(){super(...arguments),this.keys={shortCta:d.Z.MOBILE_SHORT_CTA,move:d.Z.MOVE,inside:d.Z.INSIDE,rotate:d.Z.ROTATE,play:d.Z.PLAY,zoom:d.Z.ZOOM},this.clickInside={Icon:je.gesture.tapInside,Label:this.keys.inside},this.clickMove={Icon:je.gesture.tap,Label:this.keys.move},this.dragRotate={Icon:je.gesture.drag,Label:this.keys.rotate},this.dragMove={Icon:je.gesture.position,Label:this.keys.move},this.play={Icon:je.gesture.play,Label:this.keys.play},this.zoom={Icon:je.gesture.pinch,Label:this.keys.zoom},this.left=this.dragRotate,this.center=this.clickInside,this.right=this.play}render(){const e=h({mobile:!0}),{viewmode:t}=this.props,{locale:i}=this.context;return this.configureViewmodeSpecifics(t),(0,n.h)("div",{class:h({cta:!0,mobile:!0})},(0,n.h)("h1",{class:e},i.t(this.keys.shortCta)),(0,n.h)("h2",{class:e},i.t(this.left.Label)),(0,n.h)("img",{src:this.left.Icon}),(0,n.h)("h2",{class:e},i.t(this.center.Label)),(0,n.h)("img",{src:this.center.Icon}),(0,n.h)("h2",{class:e},i.t(this.right.Label)),(0,n.h)("img",{src:this.right.Icon}))}configureViewmodeSpecifics(e){switch(e){case R.BD.INSIDE:this.left=this.dragRotate,this.center=this.clickMove,this.right=this.props.isHelpCta?this.zoom:this.play;break;case R.BD.DOLLHOUSE:case R.BD.OUTSIDE:this.left=this.dragRotate,this.center=this.clickInside,this.right=this.props.isHelpCta?this.zoom:this.play;break;case R.BD.FLOORPLAN:this.left=this.dragMove,this.center=this.clickInside,this.right=this.props.isHelpCta?this.zoom:this.play}}}var We=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};const Ze=new O.Z("cta");var qe,Ke;!function(e){e[e.NONE=0]="NONE",e[e.LARGE=1]="LARGE",e[e.SMALL=2]="SMALL"}(qe||(qe={})),function(e){e[e.HELP=0]="HELP",e[e.TOUR=1]="TOUR"}(Ke||(Ke={}));let Ye=class Cta extends n.Component{constructor(e){super(e),this.styles=[qe.NONE],this.bindings=[],this.handleInteraction=()=>{this.props.showCta&&(this.setState({seenCta:!0}),this.context.commandBinder.issueCommand(new b.Bz(y.P.CTA,!1)))},this.onTourStopped=()=>{this.state.ctaSource!==Ke.TOUR||this.state.seenCta||(this.setState({seenCta:!0}),this.context.commandBinder.issueCommand(new b.Bz(y.P.CTA,!0)))},this.onTourStarted=()=>{this.state.ctaSource===Ke.HELP&&2===this.styles.length&&this.setState({ctaSource:Ke.TOUR,seenCta:!1,style:this.styles[1]}),this.props.showCta&&this.context.commandBinder.issueCommand(new b.Bz(y.P.CTA,!1))},this.state={ctaSource:Ke.TOUR,seenCta:!1,style:this.styles[0]}}componentDidMount(){const{canvas:e}=this.props,{messageBus:t,settings:i}=this.context;try{e&&(e.addEventListener("mousedown",this.handleInteraction),e.addEventListener("pointerdown",this.handleInteraction),e.addEventListener("touchstart",this.handleInteraction)),this.bindings.push(t.subscribe(Ae.NR,this.onTourStopped),t.subscribe(Ae.Mt,this.onTourStopped),t.subscribe(Ae.oR,this.onTourStarted))}catch(e){Ze.debug(e)}let n=this.state.ctaSource;const s=parseInt(i.tryGetProperty("tourcta",1),10);!isNaN(s)&&s in qe&&(this.styles[0]=s,n=Ke.TOUR);const o=i.tryGetProperty("help",0);!isNaN(o)&&o in qe&&o!==qe.NONE&&(this.styles[0]===qe.NONE?this.styles[0]=o:this.styles.unshift(o),n=Ke.HELP),this.styles[0]!==qe.NONE&&this.setState({style:this.styles[0],ctaSource:n})}componentWillUnmount(){const{canvas:e}=this.props;e&&(e.removeEventListener("mousedown",this.handleInteraction),e.removeEventListener("pointerdown",this.handleInteraction),e.removeEventListener("touchstart",this.handleInteraction)),this.bindings.forEach((e=>e.cancel()))}renderCtaStyle(){const{isMobile:e,viewmode:t}=this.props,{style:i,ctaSource:s}=this.state;switch(i){case qe.NONE:return null;case qe.SMALL:return(0,n.h)(CtaSmall,{isMobile:e});case qe.LARGE:return e?(0,n.h)(CtaMobile,{isMobile:e,viewmode:t,isHelpCta:s===Ke.HELP}):(0,n.h)(CtaDesktop,{viewmode:t,isHelpCta:s===Ke.HELP})}}render(){const{showCta:e,isMobile:t}=this.props,{style:i,ctaSource:s}=this.state,o={ctaContainer:!0,mobile:t,showMessage:e,small:i===qe.SMALL,helpCta:s===Ke.HELP};return(0,n.h)("div",{id:"cta-container",class:h(o)},this.renderCtaStyle())}};Ye=We([f.Z],Ye);const $e=Ye;var Xe,Qe,Je,et,tt,it;!function(e){e[e.navigation=0]="navigation",e[e.moreHelp=1]="moreHelp"}(Xe||(Xe={})),function(e){e.left="left",e.middle="middle",e.right="right"}(Qe||(Qe={})),function(e){e.topInfo="topInfo",e.bigImage="bigImage",e.bottomInfo="bottomInfo",e.keyboard="keyboard"}(Je||(Je={})),function(e){e.desktop="desktop",e.mobile="mobile"}(et||(et={})),function(e){e.hlr="hlr",e.dollhouse="dollhouse",e.floors="floors",e.mattertag="mattertag",e.floorplan="floorplan",e.tour="tour",e.inside="inside",e.vr="vr",e.view360="view360",e.fullscreen="fullscreen"}(tt||(tt={})),function(e){e.landscape="landscape",e.portrait="portrait"}(it||(it={}));const nt={[et.desktop]:{[Qe.left]:{[Je.topInfo]:"HELP_DESKTOP_PANORAMA_1A",[Je.bottomInfo]:"HELP_DESKTOP_PANORAMA_1B",[Je.bigImage]:je.mouse.dragLeft,[Je.keyboard]:je.keyboard.leftRight},[Qe.middle]:{[Je.topInfo]:"HELP_DESKTOP_PANORAMA_2A",[Je.bottomInfo]:"HELP_DESKTOP_PANORAMA_2B",[Je.bigImage]:je.mouse.click,[Je.keyboard]:je.keyboard.upDown},[Qe.right]:{[Je.topInfo]:"HELP_DESKTOP_PANORAMA_3A",[Je.bottomInfo]:"HELP_DESKTOP_PANORAMA_3B",[Je.bigImage]:je.mouse.zoom,[Je.keyboard]:je.keyboard.zoom}},[et.mobile]:{[Qe.left]:{[Je.topInfo]:"HELP_MOBILE_PANORAMA_1",[Je.bigImage]:je.gesture.drag},[Qe.middle]:{[Je.topInfo]:"HELP_MOBILE_PANORAMA_2",[Je.bigImage]:je.gesture.tap},[Qe.right]:{[Je.topInfo]:"HELP_MOBILE_3",[Je.bigImage]:je.gesture.pinch}}},st={[et.desktop]:{[Qe.left]:{[Je.topInfo]:"HELP_DESKTOP_DOLLHOUSE_1A",[Je.bottomInfo]:"HELP_DESKTOP_DOLLHOUSE_1B",[Je.bigImage]:je.mouse.dragLeft,[Je.keyboard]:je.keyboard.all},[Qe.middle]:{[Je.topInfo]:"HELP_DESKTOP_DOLLHOUSE_2A",[Je.bigImage]:je.mouse.positionRight},[Qe.right]:{[Je.topInfo]:"HELP_DESKTOP_DOLLHOUSE_3A",[Je.bigImage]:je.mouse.zoom}},[et.mobile]:{[Qe.left]:{[Je.topInfo]:"HELP_MOBILE_DOLLHOUSE_1",[Je.bigImage]:je.gesture.drag},[Qe.middle]:{[Je.topInfo]:"HELP_MOBILE_DOLLHOUSE_2",[Je.bigImage]:je.gesture.positionTwoFinger},[Qe.right]:{[Je.topInfo]:"HELP_MOBILE_3",[Je.bigImage]:je.gesture.pinch}}},ot={[et.desktop]:{[Qe.left]:{[Je.topInfo]:"HELP_DESKTOP_FLOORPLAN_1A",[Je.bigImage]:je.mouse.positionLeft},[Qe.middle]:{[Je.topInfo]:"HELP_DESKTOP_FLOORPLAN_2A",[Je.bottomInfo]:"HELP_DESKTOP_FLOORPLAN_2B",[Je.bigImage]:je.mouse.dragRight,[Je.keyboard]:je.keyboard.leftRight},[Qe.right]:{[Je.topInfo]:"HELP_DESKTOP_FLOORPLAN_3A",[Je.bottomInfo]:"HELP_DESKTOP_FLOORPLAN_3B",[Je.bigImage]:je.mouse.zoom,[Je.keyboard]:je.keyboard.upDown}},[et.mobile]:{[Qe.left]:{[Je.topInfo]:"HELP_MOBILE_FLOORPLAN_1",[Je.bigImage]:je.gesture.position},[Qe.middle]:{[Je.topInfo]:"HELP_MOBILE_FLOORPLAN_2",[Je.bigImage]:je.gesture.dragTwoFinger},[Qe.right]:{[Je.topInfo]:"HELP_MOBILE_3",[Je.bigImage]:je.gesture.pinch}}},rt=JSON.parse(JSON.stringify(nt));rt.desktop.middle={[Je.topInfo]:"HELP_DESKTOP_360_2A",[Je.bottomInfo]:"HELP_DESKTOP_360_2B",[Je.bigImage]:je.mouse.clickInside,[Je.keyboard]:je.keyboard.inside},rt.mobile.middle={[Je.topInfo]:"HELP_MOBILE_360_2",[Je.bigImage]:je.gesture.tapInside};const at={INSIDE:nt,OUTSIDE:rt,FLOORPLAN:ot,DOLLHOUSE:st};var lt=i(10396),ct=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let ht=class NavigationTab extends n.Component{constructor(e){super(e),this.state={overflow:!1}}componentWillReceiveProps(e){(this.navigationDiv&&this.navigationDiv.clientHeight||0)/(this.navigationDiv.parentElement&&this.navigationDiv.parentElement.clientHeight||1)>.7&&this.setState({overflow:!0})}getAssetObj(e){switch(e){case this.props.Modes.DOLLHOUSE:return at.DOLLHOUSE[this.props.device];case this.props.Modes.FLOORPLAN:return at.FLOORPLAN[this.props.device];case this.props.Modes.OUTSIDE:return at.OUTSIDE[this.props.device];case this.props.Modes.INSIDE:default:return at.INSIDE[this.props.device]}}buildRows(){const e=this.getAssetObj(this.props.viewmode),t=[];for(const i in Je){const s=[],o=[];for(const t in Qe)if(s.push(this.wrapAsset(e,t,i,!1)),i===Je.bigImage){const i=!e[t][Je.bottomInfo];o.push((0,n.h)("div",{class:h(t,"column",{noDivider:i})},(0,n.h)("hr",null)))}t.push((0,n.h)("div",{class:h(i,"row")},s))}return t}buildMobilePortrait(){const e=this.getAssetObj(this.props.viewmode),t=[];for(const i in e)for(const n in e[i])t.push(this.wrapAsset(e,i,n,!0));return t}wrapAsset(e,t,i,s){const o=e[t][i],r=i===Je.bigImage||i===Je.keyboard;return(0,n.h)("div",{class:s?h(i,"row"):h(t,"column")},o&&r?(0,n.h)("img",{src:o}):o&&this.context.locale.t(o))}render(){const e=this.props.device===et.mobile&&this.props.orientation===lt.i5.PORTRAIT,t=h({navigation:!0,small:this.state.overflow,[this.props.viewmode]:!0});return(0,n.h)("div",{class:t,ref:e=>{this.navigationDiv=e}},e?(0,n.h)(Oe.Z,{name:"navigation",forceHidden:!1},(0,n.h)("div",{class:"nav-wrapper"},this.buildMobilePortrait())):this.buildRows())}};ht=ct([f.Z],ht);const dt=ht,ut={[tt.hlr]:{[Je.topInfo]:"HELP_MORE_HLR_A",[Je.bigImage]:"icon-hlr",[Je.bottomInfo]:"HELP_DESKTOP_MORE_HLR_B"},[tt.dollhouse]:{[Je.topInfo]:"HELP_MORE_DOLLHOUSE_A",[Je.bigImage]:"icon-dollhouse",[Je.bottomInfo]:"HELP_MOBILE_MORE_DOLLHOUSE_B"},[tt.floors]:{[Je.topInfo]:"HELP_MORE_FLOORS_A",[Je.bigImage]:"icon-floor-controls",[Je.bottomInfo]:"HELP_DESKTOP_MORE_FLOORS_B"},[tt.mattertag]:{[Je.topInfo]:"HELP_MORE_MATTERTAG_A",[Je.bigImage]:je.moreHelp.mattertag,[Je.bottomInfo]:"HELP_MOBILE_MORE_MATTERTAG_B"},[tt.tour]:{[Je.topInfo]:"HELP_MORE_TOUR_A",[Je.bigImage]:"icon-play",[Je.bottomInfo]:"HELP_DESKTOP_MORE_TOUR_B"},[tt.inside]:{[Je.topInfo]:"HELP_MORE_INSIDE_A",[Je.bigImage]:"icon-panorama",[Je.bottomInfo]:"HELP_MOBILE_MORE_INSIDE_B"},[tt.vr]:{[Je.topInfo]:"HELP_MORE_VR_A",[Je.bigImage]:"icon-vr",[Je.bottomInfo]:"HELP_MOBILE_MORE_VR_B"},[tt.view360]:{[Je.topInfo]:"HELP_MORE_360_A",[Je.bigImage]:je.moreHelp.view360,[Je.bottomInfo]:"HELP_MOBILE_MORE_360_B"},[tt.floorplan]:{[Je.topInfo]:"HELP_MORE_FLOORPLAN_A",[Je.bigImage]:"icon-floorplan",[Je.bottomInfo]:"HELP_MOBILE_FLOORPLAN_B"}},pt=JSON.parse(JSON.stringify(ut));pt[tt.fullscreen]={[Je.topInfo]:"HELP_MORE_FULLSCREEN_A",[Je.bigImage]:"icon-fullscreen",[Je.bottomInfo]:"HELP_DESKTOP_MORE_FULLSCREEN_B"},pt[tt.dollhouse][Je.bottomInfo]="HELP_DESKTOP_MORE_DOLLHOUSE_B",pt[tt.mattertag][Je.bottomInfo]="HELP_DESKTOP_MORE_MATTERTAG_B",pt[tt.inside][Je.bottomInfo]="HELP_DESKTOP_MORE_INSIDE_B",pt[tt.vr][Je.bottomInfo]="HELP_DESKTOP_MORE_VR_B",pt[tt.view360][Je.bottomInfo]="HELP_DESKTOP_MORE_360_B",pt[tt.floorplan][Je.bottomInfo]="HELP_DESKTOP_FLOORPLAN_B";const mt={[et.desktop]:pt,[et.mobile]:ut},gt=[Je.topInfo,Je.bigImage,Je.bottomInfo];class MoreHelpTab extends n.Component{constructor(e){super(e)}componentDidMount(){this.scrollbars.scrollTo({x:0,y:0})}buildInstructions(){const e=[],t=this.props.device===et.desktop?5:this.props.orientation===lt.i5.LANDSCAPE?3:2,i=Object.keys(mt[this.props.device]);for(let s=0;s<i.length;s+=t){for(const o of gt){const r=[];for(let e=0;e<t;e++){if(s+e>=i.length)continue;const t=mt[this.props.device][i[s+e]][o],a=h(o,i[s+e],{noAsset:!t});switch(o){case Je.topInfo:r.push((0,n.h)("div",{class:a},this.context.locale.t(t)));break;case Je.bigImage:r.push((0,n.h)("div",{class:a},t.indexOf(".png")>-1?(0,n.h)("img",{src:t}):(0,n.h)("span",{class:t},"floors"===i[s+e]?(0,n.h)("span",null,"2"):null)));break;case Je.bottomInfo:r.push((0,n.h)("div",{class:a},this.context.locale.t(t)))}}e.push((0,n.h)("div",{class:h("innerRow",o)},r))}e.push((0,n.h)("div",{class:"rowPadding"}))}return e.pop(),e}render(){return(0,n.h)("div",{class:h("more-help-wrapper",this.props.device)},(0,n.h)(Oe.Z,{name:"more-help-wrapper",ref:e=>this.scrollbars=e,forceHidden:!1},(0,n.h)("div",{class:h("more-help")},this.buildInstructions())))}}var ft=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let vt=class Help extends n.Component{constructor(e){super(e),this.setOrientation=e=>{const{orientation:t}=e;this.setState({orientation:t})},this.handleTabClick=e=>()=>{this.setState({tab:e})},this.closeHelp=()=>{this.setState({showing:!1}),this.context.commandBinder.issueCommand(new b.Bz(y.P.HELP,!1))},this.stopPropagation=e=>{e.stopPropagation()},this.device=this.props.isMobile?et.mobile:et.desktop,this.state={showing:!1,tab:Xe.navigation,orientation:(0,lt.T8)().orientation},this.orientationSubscription=(0,lt.kp)(lt.g_.ORIENTATION_CHANGED,this.setOrientation)}componentDidMount(){this.orientationSubscription.renew(),window.requestAnimationFrame((()=>{this.setState({showing:!0})}))}componentWillUnmount(){this.orientationSubscription.cancel()}render(){const{showing:e,tab:t,orientation:i}=this.state;return(0,n.h)("div",{id:"help-modal",class:h(this.device,{"faded-in":e}),onClick:this.stopPropagation},(0,n.h)("div",{class:h("tabs",t)},(0,n.h)("div",{class:h("navigation-tab",{active:t===Xe.navigation}),onClick:this.handleTabClick(Xe.navigation)},(0,n.h)("span",null,this.context.locale.t(d.Z.HELP_NAVIGATION_TAB))),(0,n.h)("div",{class:h("more-help-tab",{active:t===Xe.moreHelp}),onClick:this.handleTabClick(Xe.moreHelp)},(0,n.h)("span",null,this.context.locale.t(d.Z.HELP_MORE_HELP_TAB)))),t===Xe.navigation&&(0,n.h)(dt,{device:this.device,Modes:this.props.allModes,viewmode:this.props.viewmode,orientation:i}),t===Xe.moreHelp&&(0,n.h)(MoreHelpTab,{device:this.device,orientation:i}),(0,n.h)(Pe.P,{buttonStyle:Pe.A.LIGHT,onClose:this.closeHelp}))}};vt=ft([f.Z],vt);const yt=vt;var bt=i(4292);class MattertagEmbLink extends n.Component{constructor(){super(),this.closeIframe=()=>{this.context.commandBinder.issueCommand(new b.Bz(y.P.MATTERTAG_EMBED,!1)),this.setState({url:"",isIframeOpen:!1})},this.setIFrameOpen=e=>{e.embed&&(this.context.commandBinder.issueCommand(new b.Bz(y.P.MATTERTAG_EMBED,!0)),this.setState({isIframeOpen:!0,url:e.url}))}}componentDidMount(){this.context.messageBus.subscribe(bt.Ik,this.setIFrameOpen)}componentWillUnmount(){this.context.messageBus.unsubscribe(bt.Ik,this.setIFrameOpen)}render(){return this.state.url?(0,n.h)("div",{class:"mattertag-emb-link"},(0,n.h)("iframe",{id:"mattertag-emb-iframe",name:"mattertagEmb",sandbox:"allow-forms allow-scripts allow-same-origin allow-presentation"}),(0,n.h)(Pe.P,{buttonStyle:Pe.A.SHADOW,onClose:this.closeIframe})):null}}var wt,St=i(73621),Et=i(55580),Tt=i(87694),Mt=i(77956),_t=i(12775);!function(e){e.MAIL="mail",e.PINTEREST="pinterest",e.LINKEDIN="linkedin",e.TWITTER="twitter",e.FACEBOOK="facebook",e.COPYLINK="copylink",e.NATIVE="native"}(wt||(wt={}));const{FACEBOOK:xt,TWITTER:At,MAIL:Ot,PINTEREST:Pt,LINKEDIN:Ct,COPYLINK:Dt,NATIVE:It}=wt,Rt=`${window.location.origin}/show/`,Lt={[Ot]:"em",[Pt]:"pn",[Ct]:"ln",[At]:"tw",[xt]:"fb",[Dt]:"cp",[It]:"os"},Nt={[xt]:{width:626,height:436},[At]:{width:550,height:440},[Pt]:{width:750,height:749},[Ct]:{width:550,height:453},[Dt]:{},[Ot]:{},[It]:{}},kt=async(e,t=!0)=>{let i={};if(t){const[t,n,s,o]=await Promise.all([e.engine.market.waitForData(Mt.Z),e.engine.market.waitForData(_t.O),e.engine.market.waitForData(re.c),e.engine.market.waitForData(pe.M_)]);i=Tt.K.serialize({cameraData:o,viewmodeData:n,floorsViewData:s,sweepData:t})}else i=Tt.K.removeNavigationKeys(v.AO());const n=["ref","gclid","fbclid","cloudEdit"];Object.keys(i).forEach((e=>{(n.includes(e)||0===e.indexOf("utm_"))&&delete i[e]}));const s=Object.keys(i).map((e=>e+"="+i[e])).join("&");return`${Rt}?${s}`},Bt=e=>Object.keys(e).map((t=>t+"="+encodeURIComponent(e[t]))).join("&"),Ft=(e,t,i)=>{const n=e.replace("?",`?ref=${Lt[xt]}&`);return`http://www.facebook.com/sharer.php?${Bt({display:"popup",u:n})}`},Ut=(e,t,i)=>{const n=e.replace("?",`?ref=${Lt[At]}&`),s={text:i.t(d.Z.SHARED_MESSAGE_HASHTAG,{title:t,url:n,hashtag:"#Matterport"})};return`http://twitter.com/intent/tweet?${Bt(s)}`},Vt=(e,t,i)=>{const n=e.replace("?",`?ref=${Lt[Ot]}&`),s={subject:i.t(d.Z.SHARED_TITLE,{title:t}),body:i.t(d.Z.SHARED_MESSAGE,{title:t,url:n})};return`mailto:?${Bt(s)}`},Ht=(e,t,i,n)=>{const s={url:e.replace("?",`?ref=${Lt[Pt]}&`),media:i,description:n.t(d.Z.SHARED_TITLE,{title:t})};return`http://pinterest.com/pin/create/link/?${Bt(s)}`},Gt=(e,t,i)=>{const n=e.replace("?",`?ref=${Lt[Ct]}&`);return`https://www.linkedin.com/shareArticle?${Bt({mini:"true",url:n})}`},zt=(e,t,i,n)=>({[xt]:Ft(e),[At]:Ut(e,t,n),[Ot]:Vt(e,t,n),[Pt]:Ht(e,t,i,n),[Ct]:Gt(e),[Dt]:e,[It]:e}),jt=new O.Z("share-modal");class ShareModal extends n.Component{constructor(){super(),this.copyURL=()=>{const{deeplink:e}=this.state;this.urlInputRef.select(),document.execCommand("copy"),window.getSelection().removeAllRanges(),this.urlInputRef.blur(),this.setState({copied:!0}),this.context.analytics.track("showcase_share_action",{channel:wt.COPYLINK,pano_id:this.sweepData.currentSweep,deeplink:e}),window.setTimeout((()=>{this.setState({copied:!1})}),2500)},this.toggleDeeplinks=()=>{const{deeplink:e}=this.state;this.setState({deeplink:!e})},this.close=()=>{this.context.commandBinder.issueCommand(new b.Bz(y.P.SHARE,!1))},this.openShareWindow=e=>{const{urls:t,deeplink:i,deeplinkUrls:n}=this.state,{width:s,height:o}=Nt[e],r=i?n[e]:t[e];let a;if(s&&o){a="top="+(window.screenY+(window.innerHeight-o)/2)+",left="+(window.screenX+(window.innerWidth-s)/2)+",width="+s+",height="+o}this.context.analytics.track("showcase_share_action",{channel:e,pano_id:this.sweepData.currentSweep,deeplink:i}),window.open(r,"",a)},this.openWebShareApi=e=>{if(!navigator.share)return;const{excerpt:t,title:i,urls:n,deeplinkUrls:s}=this.state,o={url:e?s[wt.COPYLINK]:n[wt.COPYLINK],text:t,title:i};jt.debug("Launching Web Share API",o),navigator.share(o),this.context.analytics.track("showcase_share_action",{channel:wt.NATIVE,pano_id:this.sweepData.currentSweep,deeplink:e})},this.onWebShareClick=()=>{this.openWebShareApi(!1)},this.onWebShareDeeplinkClick=()=>{this.openWebShareApi(!0)},this.stopPropagation=e=>e.stopPropagation(),this.setUrlInputRef=e=>{this.urlInputRef=e},this.state={urls:{},deeplinkUrls:{},title:"",excerpt:"",image:"",copied:!1,deeplink:!1,webShareEnabled:(0,v.J1)()},this.openFacebook=this.openShareWindow.bind(this,wt.FACEBOOK),this.openTwitter=this.openShareWindow.bind(this,wt.TWITTER),this.openPinterest=this.openShareWindow.bind(this,wt.PINTEREST),this.openLinkedIn=this.openShareWindow.bind(this,wt.LINKEDIN),this.openEmail=this.openShareWindow.bind(this,wt.MAIL)}async componentDidMount(){const{market:e}=this.context,[t,i]=await Promise.all([e.waitForData(Et.T),e.waitForData(Mt.Z)]);this.sweepData=i;const n=t.model,s=`${window.location.origin}/api/v1/player/models/${n.sid}/thumb`,o=n.details.name;this.setState({title:o,image:s},this.updateUrls)}async updateUrls(){const{title:e,image:t}=this.state,[i,n]=await Promise.all([kt(this.context,!1),kt(this.context,!0)]),s=zt(i,e,t,this.context.locale),o=zt(n,e,t,this.context.locale);jt.debug("Social Share URLs:",s),jt.debug("Social Share URLs, with current location",o),this.setState({urls:s,deeplinkUrls:o})}renderWebShareDialog(){return(0,n.h)("div",{class:"share-controls"},(0,n.h)(xe.zx,{appendClass:{"share-modal-button":!0},buttonStyle:xe.ZJ.PRIMARY,onClick:this.onWebShareDeeplinkClick},this.context.locale.t(d.Z.SHARE_CURRENT_LOCATION)),(0,n.h)(xe.zx,{appendClass:{"share-modal-button":!0},buttonStyle:xe.ZJ.OUTLINE,onClick:this.onWebShareClick},this.context.locale.t(d.Z.SHARE_DEFAULT_LOCATION)))}renderShareDialog(){const{copied:e,deeplink:t,urls:i,deeplinkUrls:s}=this.state,o=t?s[wt.COPYLINK]:i[wt.COPYLINK],r=this.sweepData&&this.sweepData.isSweepDisabled(),a=r?this.context.locale.t(d.Z.SHARE_ERROR_SWEEP_DISABLED):void 0;return(0,n.h)("div",{class:"share-controls"},(0,n.h)("div",{class:"social-icons"},(0,n.h)(S.h,{onClick:this.openFacebook,iconClass:"icon-facebook",buttonStyle:S.D.SOCIAL,buttonSize:xe.qE.LARGE}),(0,n.h)(S.h,{onClick:this.openTwitter,iconClass:"icon-twitter",buttonStyle:S.D.SOCIAL,buttonSize:xe.qE.LARGE}),(0,n.h)(S.h,{onClick:this.openLinkedIn,iconClass:"icon-linkedin",buttonStyle:S.D.SOCIAL,buttonSize:xe.qE.LARGE}),(0,n.h)(S.h,{onClick:this.openPinterest,iconClass:"icon-pinterest",buttonStyle:S.D.SOCIAL,buttonSize:xe.qE.LARGE}),(0,n.h)(S.h,{onClick:this.openEmail,iconClass:"icon-email",buttonStyle:S.D.SOCIAL,buttonSize:xe.qE.LARGE})),(0,n.h)("div",{class:"input-group"},(0,n.h)("input",{class:"input",type:"text",value:o||"",ref:this.setUrlInputRef,onKeyDown:this.stopPropagation,onKeyPress:this.stopPropagation,onKeyUp:this.stopPropagation,readOnly:!0}),(0,n.h)(w.oO,{content:e?this.context.locale.t(d.Z.SHARE_COPIED):this.context.locale.t(d.Z.COPY_URL),position:w.lZ.UP,tooltipTimeout:2e3},(0,n.h)("button",{class:"input-addon",onClick:this.copyURL},this.context.locale.t(d.Z.COPY)))),(0,n.h)(St.X,{dataValue:"deeplink",key:"deeplink",checked:t,enabled:!r,error:r,helpText:a,label:this.context.locale.t(d.Z.SHARE_LINK_TO_LOCATION),onChange:this.toggleDeeplinks}))}render(){const{webShareEnabled:e}=this.state,t=h("modal","share-modal","modal-dialog",{"share-dialog":!e,"web-share-dialog":e}),i=e?this.renderWebShareDialog():this.renderShareDialog();return(0,n.h)("dialog",{open:!0,class:t,onClick:this.stopPropagation},(0,n.h)("header",{class:"modal-header"},(0,n.h)("div",{class:"modal-title"},this.context.locale.t(d.Z.SHARE_MODAL_TITLE)),(0,n.h)(Pe.P,{onClose:this.close})),(0,n.h)("div",{class:"modal-body"},i))}}var Wt=i(59984);class MeasurementModeHelp extends n.Component{constructor(e,t){super(e),this.closeModal=()=>{this.context.commandBinder.issueCommand(new b.Bz(y.P.MEASUREMENT_HELP,!1))},this.stopPropagation=e=>{e.stopPropagation()},this.locale={headerString:t.locale.t(d.Z.MEASUREMENT_MODE),subHeaderString:t.locale.t(d.Z.MEASUREMENT_HELP_MODAL_SUB_HEADER),body1String:t.locale.t(d.Z.MEASUREMENT_HELP_MODAL_BODY_1),body2String:t.locale.t(d.Z.MEASUREMENT_HELP_MODAL_BODY_2)}}render(){const{headerString:e,subHeaderString:t,body1String:i,body2String:s}=this.locale,{mobile:o}=this.props;return(0,n.h)("div",{class:h("modal","full-modal","measurement-mode-help-modal",{mobile:o}),onClick:this.stopPropagation},(0,n.h)("header",{class:"modal-header"},(0,n.h)("div",{class:"modal-title"},e),(0,n.h)(Pe.P,{onClose:this.closeModal})),(0,n.h)("div",{class:"modal-subheader"},t),(0,n.h)("div",{class:"modal-body"},(0,n.h)("p",{class:"modal-paragraph"},i),(0,n.h)("p",{class:"modal-paragraph"},s)))}}class Modals extends n.Component{constructor(e){super(e),this.closeModal=()=>{this.context.commandBinder.issueCommand(new b.rE)},this.mobile=(0,v.tq)()}componentDidMount(){this.context.market.waitForData(Et.T).then((e=>{this.setState({modelDetails:e.model.details})}))}render(){const{openModal:e,viewmode:t,glCanvas:i}=this.props,{modelDetails:s}=this.state,o=e===y.P.SHARE,r=e===y.P.TERMS,a=e===y.P.HELP,l=e===y.P.CTA,c=e===y.P.MEASUREMENT_HELP,h=e===y.P.VR_SELECT,d=r||a,u=o||d||c||h&&!!s;return(0,n.h)("div",{id:"showcase-modals"},(0,n.h)(Wt.N,{appendClass:{"modal-background":!0,"dark-modal-background":d,open:u},open:u,selectChild:!0,childKey:e||void 0,onClick:this.closeModal},(0,n.h)(ShareModal,{key:y.P.SHARE}),(0,n.h)(MeasurementModeHelp,{key:y.P.MEASUREMENT_HELP,mobile:this.mobile}),s&&(0,n.h)(ze,{key:y.P.VR_SELECT,isMobile:this.mobile,modelDetails:s}),r&&(0,n.h)(Terms,{key:y.P.TERMS}),a&&(0,n.h)(yt,{key:y.P.HELP,isMobile:this.mobile,viewmode:t,allModes:R.BD})),(0,n.h)($e,{canvas:i,isMobile:this.mobile,viewmode:t,showCta:l}),(0,n.h)(MattertagEmbLink,null))}}var Zt=i(98728),qt=i(71208),Kt=i(14738),Yt=i(22952),$t=i(10145),Xt=i(75843),Qt=i(90926),Jt=i(52595),ei=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let ti=class TagsOverlay extends n.Component{constructor(e){super(),this.bindings=[],this.updateTagData=()=>{this.setState({openTagView:this.props.manager.dataMap.tagsViewData.openTagView})},this.updatePinData=()=>{this.setState({pinState:this.props.manager.dataMap.pinsViewData.pinState})},this.state={pinState:Qt.tS.IDLE,openTagView:null}}componentDidMount(){const{tagsViewData:e,pinsViewData:t}=this.props.manager.dataMap;this.bindings.push(e.onOpenTagViewChanged(this.updateTagData),t.onPinStateChanged(this.updatePinData)),this.updateTagData(),this.updatePinData()}componentWillUnmount(){for(const e of this.bindings)e.cancel()}render(){const{toolPanelLayout:e,manager:t,openModal:i}=this.props;return i?null:(0,n.h)("div",{class:"overlay"},(0,n.h)(Jt.O,{toolPanelLayout:e,manager:t}))}};ti=ei([f.Z],ti);var ii=i(60930),ni=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let si=class VrEnterButtonControls extends n.Component{constructor(){super(),this.startWebXR=()=>{this.context.commandBinder.issueCommand(new Be.j({type:"immersive-vr",features:["local-floor"]})).then((e=>{if(e){this.trackEvent("vr_enter_app");const t=()=>{this.trackEvent("vr_exit_app"),e.removeEventListener("end",t)};e.addEventListener("end",t)}else this.trackEvent("vr_present_error"),this.updatePlatformState()})).catch((e=>{const t=e?{message:e.message||"",name:e.name||""}:void 0;this.trackEvent("vr_present_error",t)}))},this.state={vrPlatform:null}}async componentDidMount(){Ne.Z.apiExists()&&navigator.xr.addEventListener("ondevicechange",this.updatePlatformState),await this.updatePlatformState()}componentWillUnmount(){Ne.Z.apiExists()&&navigator.xr.removeEventListener("ondevicechange",this.updatePlatformState)}async updatePlatformState(){const e=await(0,Le.pl)();this.setState({vrPlatform:e})}render(){return this.state.vrPlatform===Le.bk.webxr?this.renderOverlayCta():null}renderOverlayCta(){const{locale:e}=this.context;return(0,n.h)("div",{id:"vr-overlay-layer",class:"overlay"},(0,n.h)("div",{class:"overlay-cta"},(0,n.h)(xe.zx,{buttonSize:xe.qE.LARGE,buttonState:xe.BN.ENABLED,buttonStyle:xe.ZJ.OVERLAY,appendClass:{"inline-block":!0,confirm:!0},onClick:this.startWebXR},e.t(d.Z.VR_ENTER))))}trackEvent(e,t){let i={gui_action:e,orientation:(0,v.mI)()?"landscape":"portrait",platform:this.state.vrPlatform};i=Object.assign(i,t),this.context.analytics.track("showcase_gui",i)}};si=ni([f.Z],si);const oi=new O.Z("showcase-ui");class ShowcaseUi extends n.Component{constructor(e){super(e),this.bindings=[],this.mobile=(0,v.tq)(),this.propertiesToRefreshUi=[I.gx.Measurements,I.gx.DetailsModelName,g.w,I.gx.FloorSelect],this.getModeChange=e=>({viewmode:(0,R.ty)(e.toMode)}),this.updateToolPanelLayout=()=>{this.setState({toolPanelLayout:this.props.toolsData.toolPanelLayout})},this.showHelpOnPlaying=e=>{e.phase===r.nh.PLAYING&&(this.props.commandBinder.issueCommand(new b.Bz(y.P.CTA,!0)),this.props.messageBus.unsubscribe(o.LZ,this.showHelpOnPlaying))},this.updateTools=()=>{const{toolsData:e,market:t,commandBinder:i}=this.props;e.toolsMap.length>0&&!this.state.toolsLoaded&&(this.setState({toolsLoaded:!0}),t.waitForData(l.X).then((()=>{i.issueCommand(new c.xy)})))},this.updatePerSettings=()=>{this.setState(Object.assign({measurementsModeEnabled:this.isMeasurementsEnabled(),notesEnabled:this.isNotesEnabled(),newTagsEnabled:this.isNewTagsEnabled()},this.getTitleBarEnablement()))},this.getTourState=()=>{if(!this.tourData)return{tourState:this.state.tourState};return{tourState:this.tourData.getCurrentTourState()}},this.getTitleBarEnablement=()=>{const e=this.props.settings.tryGetProperty("title",1),t=this.props.settings.tryGetProperty(I.gx.DetailsModelName,!0),i=this.props.settings.tryGetProperty("mls",0);return{titleBarEnabled:0!==e&&2!==i&&t}},this.isVrButtonEnabled=()=>(0,Le.hX)(this.props.settings),this.updateActiveTool=()=>{const{tourState:e}=this.state,t=this.props.toolsData.activeToolName;this.setState({activeTool:t}),t&&e.tourPlaying&&this.props.commandBinder.issueCommand(new P.vy,!1)},this.openModalChanged=()=>{const{toolsData:e,commandBinder:t}=this.props,{tourState:i}=this.state,n=e.openModal;n&&i.tourPlaying&&t.issueCommand(new P.vy,!1),this.setState({openModal:n})},this.glCanvas=document.getElementsByClassName("webgl-canvas")[0],this.state={viewmode:R.g,activeTool:null,openModal:null,toolsLoaded:!1,toolPanelLayout:e.toolsData.toolPanelLayout,tourState:{},modelDetails:null,measurementsModeEnabled:!1,notesEnabled:!1,newTagsEnabled:!1,vrEnabled:!1,brandingEnabled:!1,shareEnabled:!1,titleBarEnabled:!1,unaligned:!0,showExternalUrl:!1}}getChildContext(){const{editMode:e,locale:t,analytics:i,settings:n,toolsData:s,userData:o,mainDiv:r,engine:a,messageBus:l,market:c,commandBinder:h}=this.props;return{editMode:e,locale:t,analytics:i,settings:n,toolsData:s,userData:o,mainDiv:r,engine:a,messageBus:l,market:c,commandBinder:h}}async componentDidMount(){const{settings:e,messageBus:t,market:i,toolsData:n}=this.props;for(const t of this.propertiesToRefreshUi)e.onPropertyChanged(t,this.updatePerSettings);try{this.cancelBindings(),this.bindings=[n.onToolsLoadedChanged(this.updateTools),n.onToolChanged(this.updateActiveTool),n.onOpenModalChanged(this.openModalChanged),n.onToolPanelLayoutChanged(this.updateToolPanelLayout)],this.handleStartUpHelp();const[e,s,o,r]=await Promise.all([i.waitForData(Et.T),i.waitForData(_t.O),i.waitForData(Mt.Z),i.waitForData(Zt.k3)]);this.bindings.push(t.subscribe(fe.Z,(e=>this.setState(Object.assign(Object.assign({},this.getModeChange(e)),this.getUnalignedSweepState())))),t.subscribe(Ae.NR,(()=>this.setState(this.getTourState()))),t.subscribe(Ae.oR,(()=>this.setState(this.getTourState()))),t.subscribe(Ae.Vx,(()=>this.setState(this.getTourState()))),t.subscribe(Ae.Mt,(()=>this.setState(this.getTourState()))),t.subscribe(Ae.dW,(()=>this.setState(this.getTourState()))),r.getReel().onChanged((()=>this.setState(this.getTourState()))),o.makeSweepChangeSubscription((()=>this.setState(this.getUnalignedSweepState()))));const a=(0,R.ty)(s.currentMode||qt.Ey.Panorama);this.tourData=r,this.sweepData=o,this.viewmodeData=s,this.setState(Object.assign(Object.assign(Object.assign({viewmode:a,modelDetails:e.model.details,brandingEnabled:this.isBrandingEnabled()&&this.isMlsEnabled(),shareEnabled:this.isShareEnabled()&&this.isMlsEnabled(),showExternalUrl:this.isBrandingEnabled()&&this.isMlsEnabled(),vrEnabled:this.isVrButtonEnabled()},this.getTitleBarEnablement()),this.getTourState()),this.getUnalignedSweepState())),this.props.onAppReadyChanged(!0,!1)}catch(e){oi.debug(e)}this.updateActiveTool(),this.updateTools(),this.updatePerSettings()}async componentWillUnmount(){for(const e of this.propertiesToRefreshUi)this.props.settings.removeOnPropertyChanged(e,this.updatePerSettings);this.cancelBindings(),this.props.onAppReadyChanged(!1,!1)}handleStartUpHelp(){const{settings:e,messageBus:t,commandBinder:i}=this.props,n=e.tryGetProperty("help",0);if(1===n||2===n){const n=1===e.tryGetProperty("ts",0),s=1===e.tryGetProperty("qs",0);n||(s?i.issueCommand(new b.Bz(y.P.CTA,!0)):t.subscribe(o.LZ,this.showHelpOnPlaying))}}getUnalignedSweepState(){if(!this.sweepData||!this.viewmodeData)return{unaligned:this.state.unaligned};return{unaligned:this.viewmodeData.isPano()&&this.sweepData.isSweepUnaligned(this.sweepData.currentSweep)}}cancelBindings(){for(const e of this.bindings)e.cancel()}isNotesEnabled(){const{settings:e,toolsData:t}=this.props;return e.tryGetProperty(he.IA,!1)&&!!t.getTool(a.w1.NOTES)}isNewTagsEnabled(){const{settings:e,toolsData:t}=this.props;return e.tryGetProperty(ce.R,!1)&&!!t.getTool(a.w1.TAGS)}isMeasurementsEnabled(){const{settings:e,toolsData:t}=this.props;return e.tryGetProperty(I.gx.Measurements,!0)&&!!t.getTool(a.w1.MEASUREMENTS)}isShareEnabled(){return this.props.settings.tryGetProperty("enable_social_sharing",!1)&&this.props.settings.tryGetProperty("is_public",!1)}isMlsEnabled(){return 0===this.props.settings.tryGetProperty("mls",0)}isBrandingEnabled(){return 1===this.props.settings.tryGetProperty("brand",1)}renderToolPanels(){const{notesEnabled:e,newTagsEnabled:t,activeTool:i,openModal:s,toolPanelLayout:o}=this.state;if(!e&&!t)return null;const{toolsData:r}=this.props,l=r.getTool(a.w1.NOTES),c=r.getTool(a.w1.TAGS);return(0,n.h)(Kt.g,{activeTool:i,openModal:s,allowToggle:!1,toolPanelLayout:o},l&&(0,n.h)($t.s,{key:a.w1.NOTES,manager:l.manager,toolPanelLayout:o}),c&&(0,n.h)(Yt.g,{key:a.w1.TAGS,manager:c.manager,toolPanelLayout:o}))}renderToolOverlay(){const{toolsData:e}=this.props,{openModal:t,activeTool:i,unaligned:s,toolPanelLayout:o}=this.state,r=e.toolsMap.get(a.w1.MEASUREMENTS),l=e.toolsMap.get(a.w1.NOTES),c=e.toolsMap.get(a.w1.TAGS);return(0,n.h)("div",{class:"tool-overlay"},!i&&(0,n.h)(si,null),i===a.w1.MEASUREMENTS&&r&&(0,n.h)(ii.f,{mobile:this.mobile,openModal:t,unaligned:s,manager:r.manager}),i===a.w1.NOTES&&l&&(0,n.h)(Xt.R,{openModal:t,toolPanelLayout:o,manager:l.manager}),i===a.w1.TAGS&&c&&(0,n.h)(ti,{openModal:t,toolPanelLayout:o,manager:c.manager}))}render(){const{toolsData:e}=this.props,{viewmode:t,unaligned:i,tourState:s,modelDetails:o,measurementsModeEnabled:r,notesEnabled:a,shareEnabled:l,brandingEnabled:c,titleBarEnabled:h,vrEnabled:d,openModal:u,toolsLoaded:p,toolPanelLayout:m,activeTool:g,showExternalUrl:f}=this.state,v=u===y.P.MATTERTAG_EMBED,b=e.toolOpen?g:null;return(0,n.h)("div",{id:"gui"},!!o&&(0,n.h)(TopUi,{showing:!u&&!g,modelDetails:o,tourState:s,brandingEnabled:c,showExternalUrl:f,titleBarEnabled:h}),(0,n.h)(Modals,{viewmode:t,glCanvas:this.glCanvas,openModal:u}),!v&&(0,n.h)("div",{class:"showcase-ui-overlay"},(0,n.h)("div",{class:"scene-overlay"},!v&&(0,n.h)(OverlayUi,{viewmode:t,toolPanelLayout:m,activeTool:g,openModal:u,tourPlaying:s.tourPlaying,mobile:this.mobile}),p&&this.renderToolOverlay(),(0,n.h)(BottomUi,{openModal:u,openTool:b,unaligned:i,viewmode:t,tourState:s,measurementsModeEnabled:r,notesEnabled:a,shareEnabled:l,vrEnabled:d})),this.renderToolPanels()))}}var ri=i(39936),ai=i(48769),li=i(27691),ci=i(18403),hi=i(91307),di=i(6983);const{TOOLS:ui}=d.Z;class ShowcaseGui extends s.Y{constructor(){super(...arguments),this.name="showcase-gui-module",this.log=new O.Z(this.name),this.loadUi=async(e,t,i,s,o,r,a,l,c,h)=>{const d={editMode:!1,locale:e,analytics:t,settings:i,toolsData:this.toolsData,userData:s,mainDiv:o,engine:r,messageBus:a,market:l,commandBinder:c,onAppReadyChanged:h};this.container=o,this.ref=(0,n.render)((0,n.h)(ShowcaseUi,d),o),this.initializeTools()}}async init(e,t){this.engine=t,[this.settingsData,this.toolsData]=await Promise.all([t.market.waitForData(ri.e),t.market.waitForData(ai.t)])}async unloadUi(){if(this.ref&&this.container)return(0,n.render)(null,this.container,this.ref)}initializeTools(){const e=[new li.U({id:a.w1.NOTES,namePhraseKey:ui.NOTES,drawer:!1,panel:!0,icon:"icon-notes",analytic:"notes_mode",toolbar:!1,dimmed:!1,enabled:this.settingsData.tryGetProperty(he.IA,!1),manager:new hi.L(this.engine,this.settingsData)}),new li.U({id:a.w1.MEASUREMENTS,namePhraseKey:ui.MEASUREMENTS,drawer:!1,panel:!1,icon:"icon-tape-measure",analytic:"measure_mode",toolbar:!1,dimmed:!1,enabled:this.settingsData.tryGetProperty(I.gx.Measurements,!0),manager:new ci.u(this.engine,this.settingsData)})];this.settingsData.tryGetProperty(ce.R,!1)&&e.push(new li.U({id:a.w1.TAGS,namePhraseKey:ui.TAGS,drawer:!1,panel:!0,icon:"icon-toolbar-mattertags",analytic:"mattertag",toolbar:!1,dimmed:!1,enabled:!0,manager:new di.Q(this.engine,this.settingsData)})),this.engine.commandBinder.issueCommand(new k.MV(e))}}},72681:(e,t,i)=>{"use strict";i.d(t,{G:()=>StartApplicationCommand,M:()=>ExpandIframeCommand});var n=i(99681);class StartApplicationCommand extends n.m{constructor(e){super(),this.payload={startup:e}}}StartApplicationCommand.id="START_APPLICATION";class ExpandIframeCommand extends n.m{constructor(e){super(),this.payload={expand:e}}}ExpandIframeCommand.id="EXPAND_APP"},65976:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>LoadingGui});var n=i(54122),s=i(30853),o=i(3471),r=i(29675),a=i(55580),l=i(79994),c=i(29359),h=i(21265),d=i(62367),u=i(25799),p=i(44266),m=i(90831),g=i(76674),f=i(20640);class ProgressRadial{constructor(e){this.lastProgress=0,this.currentProgress=0,this.webpackChunks=[],this.meshAlloc={alloc:2e6,loaded:0},this.showingProgress=!1,this.progressElm=document.getElementById("bar"),window.addEventListener("WebpackChunkProgress",this.onWebpackChunkProgress.bind(this)),this.engine=e,this.meshProgressBinding=this.onMeshLoadProgress.bind(this),this.engine.subscribe(f.Z,this.meshProgressBinding)}showProgress(){this.showingProgress=!0,this.setProgress(this.currentProgress)}setDone(){this.currentProgress=100,this.setProgress(this.currentProgress),this.engine.unsubscribe(f.Z,this.meshProgressBinding)}setProgress(e){if(!this.progressElm||isNaN(e))return;this.lastProgress=Math.max(this.lastProgress,e),e=this.lastProgress;const t=Number.parseFloat(this.progressElm.getAttribute("r")||"0"),i=Math.PI*(2*t),n=(100-(e=Math.max(Math.min(e,100),0)))/100*i;this.progressElm.style.strokeDashoffset=n.toString(10)}calcProgress(){let e=0,t=0;this.webpackChunks.forEach((i=>{e+=i.loaded,t+=i.total})),e+=this.meshAlloc.loaded,t+=this.meshAlloc.alloc,this.currentProgress=75*Math.min(e/t,1),this.showingProgress&&this.setProgress(this.currentProgress)}onWebpackChunkProgress(e){this.webpackChunks[e.chunkID]?this.webpackChunks[e.chunkID].loaded=e.loaded:this.webpackChunks[e.chunkID]={loaded:e.loaded,total:e.total},this.calcProgress()}onMeshLoadProgress(e){this.meshAlloc.loaded=e.loaded/e.total*this.meshAlloc.alloc,this.calcProgress()}}var v=i(29963),y=i(72681);const b=new u.Z("loading-gui");class LoadingGui extends n.Y{constructor(){super(...arguments),this.name="loading-ui",this.playPromise=new p.Q,this.resolvePlayPromise=async(e,t)=>{if(this.config.allowPlayInIframe||!this.config.startNewTab){if((0,h.yL)())if(t&&(this.config.allowPlayInIframe||1===(0,h.hu)("expand",0)))this.toggleIframeExpansion(!0);else if(!this.config.allowPlayInIframe){const e=(0,h.AO)();t&&(e.edit="1"),e.back="1",delete e.cloudEdit;const i=Object.keys(e).map((t=>t+"="+e[t])).join("&"),n=`${window.location.origin}${window.location.pathname}?${i}`;try{return void(window.top.location.href=n)}catch(e){b.debug("Couldn't set top window location; was Showcase sandboxed?"),b.debug(e)}}t&&this.settings.updateSetting("quickstart",!0),e&&(this.playIcon.classList.add("hidden"),this.progressUI.showProgress(),this.playPromise.resolve())}else window.open(self.location.href,"_blank")},this.toggleIframeExpansion=e=>{const t=e?new v.n3:new v.mQ;this.engine.commandBinder.issueCommand(t),this.engine.broadcast(new g.G(e))},this.hideUI=async e=>{e.phase!==r.nh.STARTING&&e.phase!==r.nh.PLAYING&&e.phase!==r.nh.ERROR||(this.progressUI.setDone(),this.config.quickstart?this.showQuickstartUI():this.uiRoot.classList.add("faded-out"),this.engine.unsubscribe(o.LZ,this.hideUI))}}async init(e,t){this.engine=t,this.locale=await t.getModule(l.default),this.settings=await t.getModule(s.default);const i=await t.market.waitForData(a.T);this.config={inWorkshop:!!e.inWorkshop,quickstart:!!e.quickstart,autoplay:!!e.autoplay,allowPlayInIframe:!!e.allowPlayInIframe,startNewTab:!!e.startNewTab,hidePoweredBy:!!e.hidePoweredBy,hideTitle:!!e.hideTitle,hideBranding:!!e.hideBranding,modelId:e.modelId,baseUrl:e.baseUrl},this.progressUI=new ProgressRadial(t),t.subscribe(o.LZ,this.hideUI),this.bindings.push(t.commandBinder.addBinding(y.G,(async e=>{this.resolvePlayPromise(e.startup,!0)})),t.commandBinder.addBinding(y.M,(async e=>{this.toggleIframeExpansion(e.expand)}))),this.renderSplashScreen(i.model.details)}get waitForPlaying(){return this.playPromise.nativePromise()}getLoadingElements(){if(this.uiRoot=document.getElementById("loading-gui"),!this.uiRoot)throw Error("Loading GUI root not found");this.uiRoot.classList.remove("hidden"),this.config.quickstart&&(this.uiRoot.style.pointerEvents="none"),this.presentedBy=document.getElementById("loading-presented-by"),this.poweredBy=document.getElementById("loading-powered-by"),this.mpLogo=document.getElementById("loading-mp-logo"),this.mpLogo.src=m,this.nameHeader=document.getElementById("loading-header"),this.background=document.getElementById("loading-background"),this.tint=document.getElementById("tint"),this.playIcon=document.getElementById("showcase-play")}addCobrand(e){if(e&&e.presentedBy){const t=this.presentedBy.querySelector(".loading-label");t&&(t.textContent=this.locale.t(c.Z.PRESENTED_BY_CAPS));const i=this.presentedBy.querySelector(".subheader");i&&(i.textContent=e.presentedBy),this.presentedBy.classList.remove("hidden")}}hidePlayButtonUI(){this.background.style.backgroundImage="none",this.presentedBy.style.transition="none",this.presentedBy.classList.remove("faded-in"),this.poweredBy.style.transition="none",this.poweredBy.classList.remove("faded-in"),this.nameHeader.classList.add("hidden"),this.tint.classList.add("hidden");document.getElementById("circleLoader").classList.add("hidden"),this.uiRoot.classList.add("quickstart")}async showQuickstartUI(){this.background.classList.add("faded-out"),await(0,d.gw)(500),this.presentedBy.style.transition="",this.presentedBy.classList.add("faded-in"),this.poweredBy.style.transition="",this.poweredBy.classList.add("faded-in"),await(0,d.gw)(2500),this.presentedBy.classList.remove("faded-in"),this.poweredBy.classList.remove("faded-in"),this.uiRoot.classList.add("faded-out")}showLoadingUI(e){const t=document.createAttribute("data-status");t.value=this.locale.t(c.Z.LOADING);const i=document.getElementById("loader-cont");i.attributes.setNamedItem(t),i.classList.add(this.locale.languageCode),i.classList.add("loading"),e.classList.add("faded-out"),this.presentedBy.classList.add("faded-in")}renderSplashScreen(e){this.getLoadingElements();const t=document.getElementById("play-prompt");this.config.hideTitle&&this.nameHeader.classList.add("hidden"),this.config.hidePoweredBy&&this.poweredBy.classList.add("hidden"),this.config.hideBranding||this.addCobrand(e),this.nameHeader.textContent=e.name,this.poweredBy.classList.add("faded-in"),this.tint.classList.add("faded-in"),this.playPromise.then((()=>{this.config.quickstart?this.hidePlayButtonUI():this.showLoadingUI(t)})),this.config.autoplay?(this.progressUI.showProgress(),this.playPromise.resolve()):(t.classList.remove("hidden"),t.innerText=this.locale.t(c.Z.EXPLORE_3D_SPACE),this.playIcon.classList.remove("hidden"),this.uiRoot.addEventListener("click",(()=>this.resolvePlayPromise(!0,!1))));const i=window.devicePixelRatio||1,n=Math.max(window.innerWidth,400);this.background.style.backgroundImage=`url(${this.config.baseUrl}/api/v1/player/models/${this.config.modelId}/thumb?width=${n}&dpr=${i}&disable=upscale)`,this.config.allowPlayInIframe||window.scrollTo(0,0)}}},76674:(e,t,i)=>{"use strict";i.d(t,{G:()=>ShowcaseExpansionMessage});var n=i(93528);class ShowcaseExpansionMessage extends n.v{constructor(e){super(),this.expanded=e}}},29122:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>QuickMenus});var n=i(54122),s=i(30853),o=i(81303),r=i(89895),a=i(89155),l=i(77956),c=i(12775),h=i(73029),d=i(1707),u=i(55530),p=i(22729),m=i(98809),g=i(87694),f=i(27545),v=i(17694),y=i(39936),b=i(35825),w=i(42885),S=i(91172),E=i(34216);class QuickMenus extends n.Y{constructor(){super(...arguments),this.name="quick-menus"}async init(e,t){this.settingsModule=await t.getModuleSync(s.default),this.scanInfoDataModule=await t.getModule(o.Z),this.settingsGui=this.settingsModule.getSettingsGui();const i=await t.market.waitForData(l.Z),n=await t.market.waitForData(y.e),g=await t.market.waitForData(c.O),T=await t.market.waitForData(p.c),M=await t.market.waitForData(a.M_);this.uIndex=this.settingsGui.addPanel("Link to location",[b.R.U],{allowSubGroups:!1,width:400,ratio:90});const _=[38,38,40,40,37,39,37,39,66,65,b.R.O];this.oIndex=this.settingsGui.addPanel("Scan Info",_,{allowSubGroups:!1,width:400,ratio:75}),this.pIndex=this.settingsGui.addPanel("Quick settings",[b.R.P],{allowSubGroups:!1}),this.settingsGui.loadPromise.then((()=>{this.settingsGui.addControl(this.uIndex,"","Link",{}),this.settingsGui.addControl(this.uIndex,"","Shorten URL",!0),this.settingsGui.addButton(this.uIndex,"","Copy to clipboard",(()=>{const e=document.createElement("input");e.type="text",e.value=this.buildLink(M,g,T,i),document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)})),this.settingsGui.toggle(this.uIndex),this.settingsGui.addControl(this.oIndex,"","Scan ID",{}),this.settingsGui.addControl(this.oIndex,"","Anchor ID",{}),this.settingsGui.addControl(this.oIndex,"","Created",{}),this.settingsGui.addControl(this.oIndex,"","Time of Day",{}),this.settingsGui.addControl(this.oIndex,"","Alignment",{}),this.settingsGui.addControl(this.oIndex,"","Options",{}),this.settingsGui.addControl(this.oIndex,"","Camera",{}),this.settingsGui.addControl(this.oIndex,"","Camera Types",{}),this.settingsGui.addControl(this.oIndex,"","Sensor Serials",{}),this.settingsGui.addControl(this.oIndex,"","Serial Number",{}),this.settingsGui.addControl(this.oIndex,"","Mount Calibration",{}),this.settingsGui.addControl(this.oIndex,"","Software Version",{}),this.settingsGui.addButton(this.oIndex,"","Copy Scan ID",(async()=>{if(i.currentSweep){const e=await this.scanInfoDataModule.getScanInfo(i.currentSweep);if(e){const t=document.createElement("input");t.type="text",t.value=e.id,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}}})),this.settingsGui.addButton(this.oIndex,"","Download Scan",(async()=>{if(i.currentSweep){const e=await this.scanInfoDataModule.getScanDownloadURL(i.currentSweep);e&&window.open(e)}})),this.settingsGui.toggle(this.oIndex);const e=d.WI*(180/Math.PI)*60;this.settingsGui.addControl(this.pIndex,"",m.U,!0),this.settingsGui.addControl(this.pIndex,"",w.s,!0),this.settingsGui.addControl(this.pIndex,"",S.re,!0),this.settingsGui.addControl(this.pIndex,"",E.b,!0),this.settingsGui.addSlider(this.pIndex,"",u.lookAccelerationKey,e,.25,10,2),this.settingsGui.addSlider(this.pIndex,"",r.baseTransitionSpeedKey,h.Z.camera.baseTransitionTime,1,5e3,0);const t=n.tryGetProperty(f.EU,f.Im);this.settingsGui.addSlider(this.pIndex,"",f.WQ,(0,v.JG)(t),.5,10,2),this.settingsGui.toggle(this.pIndex),this.settingsModule.registerSetting("Quick settings",u.lookAccelerationKey,e,!1),this.settingsModule.registerSetting("Quick settings",r.baseTransitionSpeedKey,h.Z.camera.baseTransitionTime,!1),this.settingsGui.onToggle(this.uIndex,(e=>{e&&this.settingsGui.updateSetting(this.uIndex,"Link",this.buildLink(M,g,T,i))})),this.settingsGui.onToggle(this.oIndex,(e=>{e&&this.refreshScanInfo(i)})),M.pose.onChanged((()=>{this.settingsGui.isLoaded&&this.settingsGui.isVisible(this.uIndex)&&this.settingsGui.updateSetting(this.uIndex,"Link",this.buildLink(M,g,T,i)),this.settingsGui.isLoaded&&this.settingsGui.isVisible(this.oIndex)&&this.refreshScanInfo(i)})),n.onPropertyChanged(f.WQ,(e=>{n.setProperty(f.EU,(0,v.HG)(e))}))}))}refreshScanInfo(e){e.currentSweep?this.scanInfoDataModule.getScanInfo(e.currentSweep).then((e=>{this.updateScanInfo(e)})):this.updateScanInfo(void 0)}updateScanInfo(e){this.settingsGui.updateSetting(this.oIndex,"Scan ID",e?e.id:""),this.settingsGui.updateSetting(this.oIndex,"Anchor ID",e?e.anchorId:""),this.settingsGui.updateSetting(this.oIndex,"Created",e?e.created:""),this.settingsGui.updateSetting(this.oIndex,"Time of Day",e?e.timeOfDay:""),this.settingsGui.updateSetting(this.oIndex,"Alignment",e?e.alignment:""),this.settingsGui.updateSetting(this.oIndex,"Options",e?JSON.stringify(e.options):""),this.settingsGui.updateSetting(this.oIndex,"Camera",e?`${e.camera.vendor} ${e.camera.model}`:""),this.settingsGui.updateSetting(this.oIndex,"Camera Types",e?JSON.stringify(e.camera.cameraTypes):""),this.settingsGui.updateSetting(this.oIndex,"Sensor Serials",e?JSON.stringify(e.camera.sensorSerialNumbers):""),this.settingsGui.updateSetting(this.oIndex,"Serial Number",e?e.camera.serialNumber:""),this.settingsGui.updateSetting(this.oIndex,"Mount Calibration",e?e.camera.mountCalibrationVersion:""),this.settingsGui.updateSetting(this.oIndex,"Software Version",e?e.camera.softwareVersion:"")}buildLink(e,t,i,n){const s=this.settingsGui.getSetting(this.uIndex,"Shorten URL"),o=g.K.getQueryString({cameraData:e,viewmodeData:t,floorsViewData:i,sweepData:n},s);return`${location.origin}/show/?${o}`}}},23338:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ShowcaseAnalytics});var n=i(54122),s=i(25290),o=i(13931),r=i(58931),a=i(17423),l=i(42238),c=i(7839),h=i(26986),d=i(21265),u=i(62367);const p=e=>`${e}_3.0`,m=()=>{try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){return""}},g=()=>{const e=(new l.UAParser).getResult();let t=e.os.name,i=e.browser.name;const n=Object.assign({},e.device);return d._1()&&(t="iPadOS",n.vendor="Apple",n.model="iPad",n.type="tablet","Safari"===i&&(i="Mobile Safari")),{browser:{name:i,major:e.browser.major,version:e.browser.version,language:navigator.language||"",languages:navigator.languages?navigator.languages.join(", "):""},os:{name:t,version:e.os.version},device:{vendor:n.vendor,model:n.model,type:n.type}}};function f(e,t){return{app:{name:p(t),version:"3.1.44.22-0-g33607d0d2"},locale:e,screen:{width:window.screen.width,height:window.screen.height,density:window.devicePixelRatio},timezone:m(),location:{}}}const v=a.K.Logging;var y=i(51418),b=i(75711);class InteractionmodeAnalytics{constructor(){this.handlers=[{msgType:y.m,func:(e,t,i)=>{const n=i.tryGetData(b.Z);n&&e.track("interaction_mode_changed",{interaction_mode_prev:t.fromMode,interaction_mode:t.mode,interaction_source:n.source})}}]}}var w,S=i(47678),E=i(56022),T=i(98728),M=i(57369);function _(e,t){switch(e){case M.z9.ALIGNED:return 1;case M.z9.UNALIGNED:return 2}switch(t){case M.hU.MANUAL:return 3}return 0}!function(e){e.USER="self-guided",e.TOUR="tour"}(w||(w={}));class CameraDataAnalytics{constructor(){this.startLoadTime=Date.now(),this.endLoadTime=Date.now(),this.panosViewed=0,this.handlers=[{msgType:S.Z,func:(e,t,i)=>{this.onMoveToSweepBegin(t.timestamp)}},{msgType:E.Z,func:(e,t,i)=>{const n=i.tryGetData(b.Z),s=i.tryGetData(T.k3);this.endLoadTime=Date.now();const o=this.endLoadTime-this.startLoadTime;e.track("pano_viewed",{pano_id:t.toSweep,pano_view_count:++this.panosViewed,alignment_type:_(t.alignmentType,t.placementType),navigation_source:s&&s.tourPlaying?w.TOUR:w.USER,interaction_source:n?n.source:b.Z.defaultSource,interaction_mode:n?n.mode:b.Z.defaultMode,load_time:o/1e3})}}]}onMoveToSweepBegin(e){this.startLoadTime=e}}var x=i(39869);class ViewmodeAnalytics{constructor(){this.handlers=[{msgType:x.Z,func:(e,t,i)=>{const n=i.tryGetData(b.Z),s={view_mode:t.toMode};n&&(s.interaction_source=n.source,s.interaction_mode=n.mode),e.track("mode_changed",s)}}]}}var A=i(54733),O=i(41479),P=i(59340),C=i(25936);const D=(e,t)=>{const i=t.tryGetData(C.i);if(!e||!i)return-1;return i.getFloor(e).index};class FloorChangeAnalytics{constructor(){this.handlers=[{msgType:O.P,func:(e,t,i)=>{const n=i.tryGetData(b.Z);e.track("floor_changed",{floor_id:t.floorName,interaction_source:n?n.source:b.Z.defaultSource,interaction_mode:n?n.mode:b.Z.defaultMode})}},{msgType:P.M,func:(e,t,i)=>{const n=i.tryGetData(b.Z);e.track("sweep_floor_fixup",{sweep_index:t.index,sweep_floor_from:D(t.from,i),sweep_floor_to:D(t.to,i),interaction_source:n?n.source:b.Z.defaultSource,interaction_mode:n?n.mode:b.Z.defaultMode})}}]}}var I=i(85563),R=i(77956);class ZoomAnalytics{constructor(){this.firstZoom=!0,this.fromZoom=1,this.toZoom=1,this.handlers=[{msgType:I.Z,func:(e,t,i)=>{this.analytics||(this.analytics=e);const n=i.tryGetData(R.Z);n&&n.currentSweep!==this.currentPano&&(this.firstZoom=!0,this.currentPano=n.currentSweep,this.fromZoom=1),this.toZoom=t.zoomLevel,clearTimeout(this.sendTimeout),this.sendTimeout=window.setTimeout(this.trackZoomEvent.bind(this),150)}}]}trackZoomEvent(){const e=this.firstZoom?"initial":"followup";this.analytics.track("zoom_"+e,{from:this.fromZoom,to:this.toZoom,pano:this.currentPano}),this.firstZoom=!1,this.fromZoom=this.toZoom}}var L=i(3471),N=i(29675),k=i(19413);class TimingData extends k.V{constructor(){super(...arguments),this.name="timing",this.modelLoadingStartTime=0,this.waitingStartTime=0,this.appPlayingTime=0,this.appStartedTime=0}copy(e){this.modelLoadingStartTime=e.modelLoadingStartTime,this.waitingStartTime=e.waitingStartTime,this.appPlayingTime=e.appPlayingTime,this.appStartedTime=e.appStartedTime}get totalTimeToAppStarting(){let e=this.appStartedTime-performance.timing.navigationStart;return this.modelLoadingStartTime&&this.waitingStartTime&&(e-=this.modelLoadingStartTime-this.waitingStartTime),e}get totalTimeToAppPlaying(){let e=this.appPlayingTime-performance.timing.navigationStart;return this.modelLoadingStartTime&&this.waitingStartTime&&(e-=this.modelLoadingStartTime-this.waitingStartTime),e}}var B=i(25799),F=i(62431),U=i(50101);const V=new B.Z("showcase-session"),H=new TimingData;class ShowcaseSessionAnalytics{constructor(e,t){this.analytics=e,this.engine=t,this.handlers=[{msgType:L.LZ,func:async(e,t,i)=>{switch(t.phase){case N.nh.WAITING:H.waitingStartTime=Date.now(),H.commit(),e.track("impression",{url_params:d.UD(),visible:!0});break;case N.nh.LOADING:H.modelLoadingStartTime=Date.now(),H.commit();break;case N.nh.STARTING:{H.appStartedTime=Date.now(),H.commit(),V.info("First render, model loaded "+H.totalTimeToAppStarting/1e3);const t=this.engine.market.tryGetData(F.af),i=(await this.engine.getModule(U.default)).getCapabilities(),n={has_hlr:!t||t.options.highlight_reel,duration:Date.now()-H.modelLoadingStartTime,duration_from_navigation_start:Date.now()-performance.timing.navigationStart,gl_v2:i.gl_v2,gl_max_textures:i.gl_max_textures,gl_max_texture_size:i.gl_max_texture_size,gl_max_cubemap_size:i.gl_max_cubemap_size,gl_instancing:i.gl_instancing,gl_oes_texture_float:i.gl_oes_texture_float,gl_oes_texture_half_float:i.gl_oes_texture_half_float,gl_depth_texture:i.gl_depth_texture,gl_draw_buffers:i.gl_draw_buffers,gl_oes_fbo_render_mip_map:i.gl_oes_fbo_render_mip_map,gl_shader_texture_lod:i.gl_shader_texture_lod,gl_oes_vertex_array_obj:i.gl_oes_vertex_array_obj,gl_ovr_multi_view:i.gl_ovr_multi_view,gl_color_buffer_float:i.gl_color_buffer_float,gl_astc_supported:i.gl_astc_supported,gl_etc1_supported:i.gl_etc1_supported,gl_etc2_supported:i.gl_etc2_supported,gl_dxt_supported:i.gl_dxt_supported,gl_bptc_supported:i.gl_bptc_supported,gl_pvrtc_supported:i.gl_pvrtc_supported};e.track("model_loaded",n);break}case N.nh.PLAYING:H.appPlayingTime=Date.now(),H.commit(),V.info("Playing, session started "+H.totalTimeToAppPlaying/1e3),e.track("session_started"),window.addEventListener("unload",this.sessionEnded),e.track("load_times",{time_to_app_start:H.totalTimeToAppStarting,time_to_app_playing:H.totalTimeToAppPlaying});break;case N.nh.ERROR:{const t=await i.waitForData(N.pu),{error:n}=t,s=n&&n.name?n.name:n&&n.constructor?n.constructor.name:null,o=n?n.message:null,r=n&&n.stack?n.stack.split("\n"):[],a=r.length>=2?r[1].match(/\s+at\s+([^\s]+)/):null,l={exception:{message:`${s}: ${o}`,function:a?a[1]:null,stack:r.slice(1,5).join("\n")},duration:Date.now()-H.modelLoadingStartTime,duration_from_navigation_start:Date.now()-performance.timing.navigationStart};e.track("error_displayed",l);break}}}}],this.sessionEnded=()=>{this.analytics.trackAsync("session_ended",{duration:Date.now()-H.appPlayingTime})}}dispose(){window.removeEventListener("unload",this.sessionEnded)}}var G=i(48840),z=i(2124),j=i(71208),W=i(12775),Z=i(44106);const q=new B.Z("/index.js");let K=0,Y=1/0,$=null,X=null,Q=window.devicePixelRatio||1;const J={},ee=new z.P(1e3);class RenderingPerformanceAnalytics{constructor(){this.handlers=[{msgType:G.Z,func:(e,t,i)=>{X!==N.nh.STARTING&&X!==N.nh.PLAYING||te(e,j.Ey[t.toMode],1e4)}},{msgType:L.LZ,func:(e,t,i)=>{const n=i.tryGetData(W.O);t.phase===N.nh.LOADING?te(e,"Loading",6e4):t.phase===N.nh.STARTING?te(e,"Starting",6e4):t.phase===N.nh.PLAYING&&n&&n.currentMode&&te(e,j.Ey[n.currentMode],1e4),X=t.phase}},{msgType:Z.V,func:(e,t,i)=>{Q=t.pixelRatio}}]}}function te(e,t,i){t!==$&&($&&(ne(e),ie()),J[t]||($=t,Y=i,J[$]=!0))}const ie=()=>{$=null,ee.clear(),K=0},ne=e=>{const t=ee.getList();if(0!==t.length)try{const i=se(t);e.track("performance",i)}catch(e){q.warn("Could not send performance metrics",e)}},se=e=>{let t=0,i=0,n=0,s=0,o=0,r=0;for(const a of e)t+=a,a<0||(a<=16.7?i+=a:a<=33.3?n+=a:a<=100?s+=a:a<=1e3?o+=a:r+=a);if(t<=0)throw Error("No positive timings, cannot calculate performance data");const a=t/e.length;i/=t,n/=t,s/=t,o/=t,r/=t;const l=e.slice(),c=(0,u.Pe)(l,50),h=(0,u.Pe)(l,95,!1),d=l[l.length-1];return{phase:$,frame_delta:a,frame_delta_avg:a,frame_delta_median:c,frame_delta_95th:h,frame_delta_max:d,duration:t,time_60_fps:i,time_60_30_fps:n,time_30_10_fps:s,time_10_1_fps:o,time_1_0_fps:r,pixel_ratio:Q}};var oe=i(39936),re=i(62194),ae=i(22729);const le=(e,t)=>{const i=t.tryGetData(ae.c);if(!i)return-1;return(e?i.floors.getFloor(e):i.getHighestVisibleFloor()).index};class MeasurementAnalytics{constructor(){this.handlers=[{msgType:re.rf,func:(e,t,i)=>{const n={measure_sid:t.data.sid,start_position:t.data.startPosition,end_position:t.data.endPosition,length:t.data.totalLength,segments:t.data.segments,temporary:t.data.temporary,viewmode:t.data.viewmode,floor:le(t.data.floorId,i),feature_type:t.data.featureType,constraint_style:t.data.constraint,continuous:t.data.continuous};e.track("measure_segment_add",n)}},{msgType:re.u6,func:(e,t,i)=>{const n={measure_sid:t.data.sid,length:t.data.totalLength,segments:t.data.segments,temporary:t.data.temporary,viewmode:t.data.viewmode,floor:le(t.data.floorId,i),feature_type:t.data.featureType,measure_type:t.data.type,constraint_style:t.data.constraint,continuous:t.data.continuous};e.track("measure_add",n)}},{msgType:re.ty,func:(e,t)=>{const i={measure_sid:t.sid,measure_text:t.text};e.track("measure_add_title",i)}},{msgType:re.mM,func:(e,t)=>{const i={measure_sid:t.sid,measure_old_text:t.oldText,measure_new_text:t.newText};e.track("measure_update_title",i)}},{msgType:re.$Z,func:(e,t,i)=>{const n={measure_sid:t.data.sid,length:t.data.totalLength,segments:t.data.segments,temporary:t.data.temporary,viewmode:t.data.viewmode,floor:le(t.data.floorId,i),measure_count:t.data.count,continuous:t.data.continuous};e.track("measure_remove",n)}},{msgType:re.av,func:(e,t,i)=>{const n={measure_sid:t.data.sid,length:t.data.totalLength,segments:t.data.segments,temporary:t.data.temporary,viewmode:t.data.viewmode,floor:le(t.data.floorId,i),feature_type:t.data.featureType,constraint_style:t.data.constraint,continuous:t.data.continuous};e.track("measure_update",n)}},{msgType:re.$n,func:(e,t)=>{const i=t.opened?"measure_mode_enter":"measure_mode_exit",n={viewmode:t.viewmode,measure_count:t.count};e.track(i,n)}},{msgType:re.ff,func:(e,t)=>{e.track("measure_cancelled",{})}}]}}var ce=i(79994),he=i(93528);class ActivityPingMessage extends he.v{constructor(e,t,i,n,s,o){super(),this.durationDollhouse=e,this.durationFloorplan=t,this.durationInside=i,this.mainMode=n,this.totalBytesDownloaded=s,this.tilesDownloaded=o}}class ActivityAnalytics{constructor(){this.handlers=[{msgType:ActivityPingMessage,func:(e,t)=>{const i={duration_dollhouse:t.durationDollhouse,duration_floorplan:t.durationFloorplan,duration_inside:t.durationInside,duration:t.durationDollhouse+t.durationFloorplan+t.durationInside,main_mode:t.mainMode,bytes_downloaded:t.totalBytesDownloaded,tiles_downloaded:t.tilesDownloaded};e.track("activity_ping",i)}}]}}var de,ue=i(30963),pe=i(75158),me=i(21588),ge=i(78626),fe=i(36073),ve=i(93735),ye=i(72942),be=i(15253);!function(e){e.UNINITIALIZED="uninitialized",e.INACTIVE="inactive",e.ACTIVE="active"}(de||(de={}));class ShowcaseActivityTracking{constructor(){this.name="activity-analytics",this._state=de.UNINITIALIZED,this.activeModeMap=new Map,this.totalTilesDownloaded=0,this.onTileDownloaded=()=>{this.totalTilesDownloaded++}}async init(e,t,i){this.engine=e,this.requestQueue=i,[this.input,this.viewmodeData,this.applicationData]=await Promise.all([await e.getModule(ue.default),await e.market.waitForData(W.O),await e.market.waitForData(N.pu)]);const n=[],s=[pe.R,me._t,ge.e,fe.er,ve.G],o=()=>this.active=!0;this.applicationData.phase===N.nh.PLAYING?this._state=de.INACTIVE:n.push(e.subscribe(L.LZ,(()=>{this.applicationData.phase===N.nh.PLAYING&&(this._state=de.INACTIVE)}))),n.push(...(()=>{const e=[];return s.forEach((t=>{e.push(this.input.registerUnfilteredHandler(t,o))})),e})()),n.push(e.subscribe(x.Z,(e=>{const t=e.fromMode,i=e.toMode;t&&t!==j.Ey.Transition&&this.applicationData.phase===N.nh.PLAYING&&this.handleModeChange(t,i)}))),n.push(this.engine.subscribe(be.o,this.onTileDownloaded)),t(n)}get active(){return this._state===de.ACTIVE}set active(e){this._state!==de.UNINITIALIZED&&(e&&this._state===de.INACTIVE&&this.startActivityTimeout(),this._state=e?de.ACTIVE:de.INACTIVE)}handleModeChange(e,t){this.activeModeMap.has(t)?this.updateActivityTimeForMode(t,!0):this.activeModeMap.set(t,{previousTime:Date.now(),totalTimeinMS:0}),this.updateActivityTimeForMode(e)}updateActivityTimeForMode(e,t){const i=this.activeModeMap.get(e);if(void 0===i)return;const{previousTime:n,totalTimeinMS:s}=i;t?this.activeModeMap.set(e,{previousTime:Date.now(),totalTimeinMS:s}):this.activeModeMap.set(e,{previousTime:Date.now(),totalTimeinMS:s+(Date.now()-n)})}startActivityTimeout(){this.activeModeMap.set(j.Ey.Dollhouse,{previousTime:Date.now(),totalTimeinMS:0}),this.activeModeMap.set(j.Ey.Floorplan,{previousTime:Date.now(),totalTimeinMS:0}),this.activeModeMap.set(j.Ey.Panorama,{previousTime:Date.now(),totalTimeinMS:0}),window.setTimeout(this.notifyActivityAnalytic.bind(this),ShowcaseActivityTracking.ACTIVITY_INTERVAL)}notifyActivityAnalytic(){if(this.viewmodeData.currentMode&&this.viewmodeData.currentMode!==j.Ey.Transition&&this.updateActivityTimeForMode(this.viewmodeData.currentMode),this.active){let e=0,t=j.Ey.Panorama;this.activeModeMap.forEach(((i,n)=>{i.totalTimeinMS>e&&(t=n,e=i.totalTimeinMS)})),this.active=!1;const[i,n,s]=[this.activeModeMap.get(j.Ey.Dollhouse),this.activeModeMap.get(j.Ey.Floorplan),this.activeModeMap.get(j.Ey.Panorama)].map((e=>e?e.totalTimeinMS:0));this.engine.broadcast(new ActivityPingMessage(i,n,s,ye.KP[t],this.requestQueue.totalBytesDownloaded,this.totalTilesDownloaded))}}}ShowcaseActivityTracking.ACTIVITY_INTERVAL=15e3;var we,Se=i(32359);!function(e){e.USER="self-guided",e.TOUR="tour"}(we||(we={}));class RoomDataAnalytics{constructor(){this.handlers=[{msgType:Se.D,func:(e,t,i)=>{const n=i.tryGetData(b.Z),s=i.tryGetData(T.k3),o={room_id:t.roomId,room_index:t.meshSubgroup,room_type:t.roomType,viewmode:t.viewmode?ye.KP[t.viewmode]:t.viewmode,room_visit_count:t.visitCount,room_count:t.roomCount,navigation_source:s&&s.tourPlaying?we.TOUR:we.USER,interaction_source:n?n.source:b.Z.defaultSource,interaction_mode:n?n.mode:b.Z.defaultMode};e.track("room_visited",o)}}]}}var Ee=i(20331);var Te=i(9713),Me=i(57723);class ShowcaseLabelAnalytics{constructor(){this.handlers=[{msgType:Me.V,func:(e,t,i)=>{e.track("internal_warning",{warningType:"rtl_disabled_roomnav"})}}]}}const _e=new B.Z("showcase-analytics");class ShowcaseAnalytics extends n.Y{constructor(){super(...arguments),this.name="showcase-analytics",this.loaded=!1,this.handlers=[],this.track=(e,t)=>{this.analytics.track(e,t)}}async init(e,t){this.analytics=await t.getModule(o.default),this.apiClient=(await t.getModule(s.default)).getApi();const i=await t.market.waitForData(oe.e),n=await t.getModule(ce.default);this.addMessageHandlers(this.analytics,t),this.context=function(e,t,i){const n=f(t,i);return(0,c.Z)(e).then((e=>{n.location={city:e.city,country:e.country_name,region:e.region}})),n}(e.queue,n.languageCode,e.appName),this.options=Object.assign(Object.assign({mds_enabled:i.tryGetProperty(Te.$,!1)},{model_id:(0,h.uz)(),start_source:d.hu("play",!1)?"autoplay":d.yL()?"click":"fullpage",autoplay:d.hu("play",!1)||!d.yL(),quickstart:1===d.hu("qust",0)||1===d.hu("qs",0),language_tag:d.hu("lang",null),is_mobile:d.tq(),iframe:d.yL(),aspect_ratio:d.dy(),session_id:(0,u.DM)(),window:{height:window.innerHeight,width:window.innerWidth},platform:g()}),e.additionalValues),this.activityTracking=new ShowcaseActivityTracking,this.activityTracking.init(t,this.registerBindings.bind(this),e.queue);const r=await this.createAnalyticsConfigs(e,i),a=new Ee.gO({retries:0,concurrency:1});this.analytics.load(r,a,this.options,this.context,this.apiClient.user).then((()=>{this.loaded=!0}))}addMessageHandlers(e,t){this.addMessageHandler(new ShowcaseSessionAnalytics(e,t),t),this.addMessageHandler(new ViewmodeAnalytics,t),this.addMessageHandler(new CameraDataAnalytics,t),this.addMessageHandler(new InteractionmodeAnalytics,t),this.addMessageHandler(new FloorChangeAnalytics,t),this.addMessageHandler(new A.s,t),this.addMessageHandler(new ZoomAnalytics,t),this.addMessageHandler(new MeasurementAnalytics,t),this.addMessageHandler(new RenderingPerformanceAnalytics,t),this.addMessageHandler(new ActivityAnalytics,t),this.addMessageHandler(new RoomDataAnalytics,t),this.addMessageHandler(new ShowcaseLabelAnalytics,t)}addMessageHandler(e,t){this.handlers.push(e),e.handlers.forEach(((e,i)=>{this.bindings.push(t.subscribe(e.msgType,(i=>{e.func(this.analytics,i,t.market)})))}))}registerBindings(e){this.bindings.push(...e)}async createAnalyticsConfig(e,t){if(((e,t)=>{const i=Object.keys(e);for(const n of i)if(e[n]===t)return!0;return!1})(a.K,e)){const{apiClient:i}=this,n=r.H[e],s=null!==n.key?await i.getAppKey(t,n.key):null,o=null!==n.url?await i.getAppKey(t,n.url):null;if(null===n.key||null!==s&&null===n.url||null!==o)return{provider:e,token:s,url:o}}return null}async createAnalyticsConfigs(e,t){const i=e.appName,n=void 0!==e.provider?e.provider:await this.apiClient.getAppKey(i,"analytics_provider"),s=[];if(!n)return s;const o=n.split(",");for(const e of o){const t=await this.createAnalyticsConfig(e,i);null!==t?s.push(t):_e.warn(`Failed to set up ${e}, token/url required but not found in config`)}return s.length<1&&s.push({provider:v,token:null,url:null}),s}onUpdate(e){this.loaded&&((e,t)=>{$&&(ee.push(t),K+=t,K>=Y&&(ne(e),ie()))})(this.analytics,e)}dispose(e){super.dispose(e);for(const e of this.handlers)e.dispose&&e.dispose();this.handlers=[]}getSessionId(){return this.options.session_id}}},26451:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ShowcaseHotkeys});var n=i(30963),s=i(78626),o=i(35825),r=i(72942),a=i(97507),l=i(54122),c=i(22767),h=i(12775),d=i(71208),u=i(39936),p=i(15782);class ShowcaseHotkeys extends l.Y{constructor(){super(...arguments),this.name="showcase-hotkeys",this.inputCommandMap={[c.M.PRESSED]:{[o.R.ONE]:()=>(this.viewmodeData.currentMode===d.Ey.Panorama&&(this.issueCommand(new a.g(0)),this.settings.setProperty(p.Lp,!1),this.currentView=0),this.switchToMode(r.BD.INSIDE)),[o.R.TWO]:()=>this.switchToMode(r.BD.DOLLHOUSE),[o.R.THREE]:()=>this.switchToMode(r.BD.FLOORPLAN),[o.R.ZERO]:()=>{const e=this.currentView++%this.meshViews.length;return this.meshViews[e](),this.switchToMode(r.BD.INSIDE)}}},this.currentView=0,this.meshViews=[()=>{this.issueCommand(new a.g(1)),this.settings.setProperty(p.Lp,!1)},()=>{this.issueCommand(new a.g(1)),this.settings.setProperty(p.Lp,!0)},()=>{this.issueCommand(new a.g(0)),this.settings.setProperty(p.Lp,!0)},()=>{this.issueCommand(new a.g(0)),this.settings.setProperty(p.Lp,!1)}]}async init(e,t){const i=await t.getModule(n.default);[this.viewmodeData,this.settings]=await Promise.all([t.market.waitForData(h.O),t.market.waitForData(u.e)]),this.issueCommand=t.commandBinder.issueCommand.bind(t.commandBinder),i.registerHandler(s.e,(async e=>{this.inputCommandMap[e.state]&&this.inputCommandMap[e.state][e.key]&&await this.inputCommandMap[e.state][e.key]()}))}async switchToMode(e){this.viewmodeData.currentMode!==d.Ey.Transition&&await this.issueCommand(new r._i(e))}}},49415:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ShowcasePasswordModule});var n=i(26605),s=i(54122),o=i(33886),r=i(17882),a=i(79994),l=i(25799),c=i(94184),h=i(29359),d=i(90831);class PoweredBy extends n.Component{constructor(e){super(e)}render(){const{attributionLinkText:e,attributionLinkUrl:t}=this.props,{locale:i}=this.context;return(0,n.h)("div",{class:"powered-by"},(0,n.h)("p",{class:"powered-by-label"},i.t(h.Z.POWERED_BY)),(0,n.h)("img",{class:"powered-by-logo",alt:"Matterport",src:d,width:"150",height:"32"}),t&&(0,n.h)("a",{href:t,class:"powered-by-link"},e||t))}}var u=i(24877),p=i(17617);class InvalidPasswordException extends p.y{constructor(e="Invalid password"){super(e),this.name="InvalidPassword"}}class TooManyAttemptsException extends p.y{constructor(e="Too many attempts, please try again in a few minutes"){super(e),this.name="TooManyAttempts"}}const m=new l.Z("showcase-password");class ShowcasePasswordUi extends n.Component{constructor(e){super(e),this.onInputChange=e=>{const{name:t,value:i}=e.target;"password"===t&&this.setState({password:i,hasError:!1})},this.onSubmit=async e=>{e.preventDefault(),this.setState({formEnabled:!1}),await this.authenticate(),this.setState({formEnabled:!0})},this.state={formEnabled:!0,hasError:!1,tooManyAttempts:!1,password:""}}async authenticate(){const{authenticate:e}=this.props,{password:t}=this.state;m.debug("Validating password input...");const i=await e(t).catch((e=>(e instanceof TooManyAttemptsException&&this.setState({hasError:!0,tooManyAttempts:!0}),!1)));this.setState({hasError:!i})}getChildContext(){const{locale:e}=this.props;return{locale:e}}stopPropagation(e){e.stopPropagation()}renderLockout(){const{locale:e}=this.props;return(0,n.h)("div",{class:"sc-password-modal sc-password-lockout"},(0,n.h)("header",{class:"modal-header"},(0,n.h)("h1",{class:"modal-title"},e.t(h.Z.SC_LOCKOUT_TITLE))),(0,n.h)("p",{class:"modal-body"},e.t(h.Z.SC_LOCKOUT_MESSAGE)))}renderLoginForm(){const{hasError:e,password:t,formEnabled:i}=this.state,{locale:s}=this.props;return(0,n.h)("div",{class:"sc-password-modal sc-password-login"},(0,n.h)("header",{class:"modal-header"},(0,n.h)("h1",{class:"modal-title"},s.t(h.Z.SC_PASSWORD_TITLE))),(0,n.h)("div",{class:"modal-body"},(0,n.h)("form",{onSubmit:this.onSubmit,class:"sc-password-form"},(0,n.h)("input",{type:"password",name:"password",placeholder:s.t(h.Z.SC_PASSWORD_PLACEHOLDER),onInput:this.onInputChange,onKeyDown:this.stopPropagation,onKeyPress:this.stopPropagation,onKeyUp:this.stopPropagation,disabled:!i,value:t,class:c("sc-password-input",{error:e}),autocomplete:"on"}),(0,n.h)("button",{type:"submit",disabled:!i,class:"sc-password-submit"},s.t(h.Z.SC_PASSWORD_SUBMIT))),e&&(0,n.h)("p",{class:"help-text error"},(0,n.h)("span",{class:"icon icon-error"}),s.t(h.Z.SC_PASSWORD_INVALID)),!e&&(0,n.h)("p",{class:"help-text"})))}render(){const{hasError:e,tooManyAttempts:t}=this.state,i=e&&t?this.renderLockout():this.renderLoginForm();return(0,n.h)("div",{class:"sc-password-ui",style:`background-image: url(${u})`},(0,n.h)("div",{class:"sc-password-content"},i),(0,n.h)("footer",{class:"sc-password-footer"},(0,n.h)(PoweredBy,null)))}}var g=i(64506);const f=new l.Z("showcase-password");class ShowcasePasswordModule extends s.Y{constructor(){super(...arguments),this.name="showcase-password",this.authenticated=!1}async init(e,t){this.config=e,this.engine=t;const i=e.baseUrl||window.location.origin;this.auth=new o.L(i)}showPasswordScreen(){this.loadUi()}hidePasswordScreen(){this.unloadUi()}async loadUi(){const{container:e}=this.config,t=await this.engine.getModule(a.default),i=(0,n.h)(ShowcasePasswordUi,{locale:t,authenticate:e=>this.authenticate(e)});this.ref=(0,n.render)(i,e)}unloadUi(){if(!this.ref)return;const{container:e}=this.config;(0,n.render)(null,e,this.ref)}async authenticate(e){const{modelId:t}=this.config;if(!await this.auth.authenticate(t,e)){switch(this.engine.broadcast(new g.s(this.auth.errorType)),this.auth.errorType){case r.s.INVALID_CREDENTIALS:throw new InvalidPasswordException;case r.s.TOO_MANY_ATTEMPTS:throw new TooManyAttemptsException}return!1}return f.debug("Password authentication was successful"),this.engine.broadcast(new g.L),!0}}},64506:(e,t,i)=>{"use strict";i.d(t,{L:()=>PasswordAuthenticationSuccess,s:()=>PasswordAuthenticationFail});var n=i(93528);class PasswordAuthenticationSuccess extends n.v{}class PasswordAuthenticationFail extends n.v{constructor(e){super(),this.errorType=e}}},40562:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ShowcaseSettings});var n=i(83032),s=i(54122),o=i(30853),r=i(39936),a=i(62431),l=i(19334),c=i(47924),h=i(25799),d=i(80034),u=i(41263),p=i(7943),m=i(15119),g=i(20331);const f=e=>{if(!e||!e.player_options)return null;const t=e.player_options||{},i={address:t.address,background_color:t.background_color,contact_email:t.contact_email,contact_name:t.contact_name,contact_phone:t.contact_phone,dollhouse:t.dollhouse,dollhouse_pan_speed:t.dollhouse_pan_speed,external_url:t.external_url,fast_transitions:t.fast_transitions,floor_plan:t.floor_plan,floor_select:t.floor_select,highlight_reel:t.highlight_reel,labels:t.labels,labels_dh:t.labels_dh,measurements:t.measurements,measurements_saved:t.measurements_saved,model_name:t.model_name,model_summary:t.model_summary,pan_angle:t.pan_angle,pan_direction:t.pan_direction,pan_speed:t.pan_speed,presented_by:t.presented_by,tour_buttons:t.tour_buttons,transition_speed:t.transition_speed,transition_time:t.transition_time,unit_type:t.unit_type||e.unit_type,zoom_duration:t.zoom_duration};return new a.af(i)},v=(e,t)=>({player_options:{address:e.options.address,background_color:e.options.background_color,contact_email:e.options.contact_email,contact_name:e.options.contact_name,contact_phone:e.options.contact_phone,dollhouse:e.options.dollhouse,dollhouse_pan_speed:e.options.dollhouse_pan_speed,external_url:e.options.external_url,fast_transitions:e.options.fast_transitions,floor_plan:e.options.floor_plan,floor_select:e.options.floor_select,highlight_reel:e.options.highlight_reel,labels:e.options.labels,labels_dh:e.options.labels_dh,measurements:e.options.measurements,measurements_saved:e.options.measurements_saved,model_name:e.options.model_name,model_summary:e.options.model_summary,pan_angle:e.options.pan_angle,pan_direction:e.options.pan_direction,pan_speed:e.options.pan_speed,presented_by:e.options.presented_by,tour_buttons:e.options.tour_buttons,transition_speed:e.options.transition_speed,transition_time:e.options.transition_time,unit_type:e.options.unit_type,zoom_duration:e.options.zoom_duration}});var y,b=i(32400);!function(e){e.black="black",e.grey="grey",e.white="white",e.default="black"}(y||(y={}));var w,S,E,T=i(19673);!function(e){e.BLACK="black",e.GREY="grey",e.WHITE="white"}(w||(w={})),function(e){e.DISABLED="disabled",e.MEASURE="measure",e.MEASURE_AND_VIEW="measureAndView"}(S||(S={})),function(e){e.metric="metric",e.imperial="imperial"}(E||(E={}));var M=i(44228);const _=new h.Z("mds-player-options-deserializer"),x={[T.Y.LEFT]:M.kw.Left,[T.Y.RIGHT]:M.kw.Right,[T.Y.AUTO]:M.kw.Auto},A={[w.BLACK]:y.black,[w.GREY]:y.grey,[w.WHITE]:y.white};class MdsPlayerOptionsDeserializer{deserialize(e){if(!e||!this.validate(e))return _.debug("Deserialized invalid options data from MDS",e),null;const t=(e.publication||{}).options||{},i=e.options,n=x[i.tourPanDirection],s={address:t.address,contact_email:t.contactEmail,contact_name:t.contactName,contact_phone:t.contactPhone,dollhouse:i.dollhouseEnabled,external_url:t.externalUrl,floor_plan:i.floorplanEnabled,floor_select:i.floorSelectEnabled,highlight_reel:i.highlightReelEnabled,labels:i.labelsEnabled,labels_dh:i.dollhouseLabelsEnabled,model_name:t.modelName,model_summary:t.modelSummary,presented_by:t.presentedBy,measurements:i.measurements!==S.DISABLED,measurements_saved:i.measurements===S.MEASURE_AND_VIEW,unit_type:i.unitType===E.imperial?a.Mc.USFractional:a.Mc.Metric,background_color:A[i.backgroundColor],tour_buttons:i.tourButtonsEnabled,fast_transitions:i.tourFastTransitionsEnabled,transition_speed:i.tourTransitionSpeed,transition_time:i.tourTransitionTime,pan_speed:i.tourPanSpeed,dollhouse_pan_speed:i.tourDollhousePanSpeed,zoom_duration:i.tourZoomDuration,pan_angle:i.tourPanAngle,pan_direction:n};return new a.af(s)}validate(e){return["id","options","publication"].every((t=>t in e))}}var O;!function(e){e.ENABLED="enabled",e.DISABLED="disabled",e.DEFAULT="default"}(O||(O={}));var P=i(51770);const C=(0,P.Sc)(x),D=(0,P.Sc)(A);class MdsPlayerOptionsSerializer{serialize(e){const t={},i=e.options||{};if(void 0!==i.dollhouse&&(t.dollhouseOverride=i.dollhouse?O.ENABLED:O.DISABLED),void 0!==i.floor_plan&&(t.floorplanOverride=i.floor_plan?O.ENABLED:O.DISABLED),void 0!==i.floor_select&&(t.floorSelectOverride=i.floor_select?O.ENABLED:O.DISABLED),void 0!==i.labels&&(t.labelsOverride=i.labels?O.ENABLED:O.DISABLED),void 0!==i.labels_dh&&(t.dollhouseLabelsOverride=i.labels_dh?O.ENABLED:O.DISABLED),void 0!==i.highlight_reel&&(t.highlightReelOverride=i.highlight_reel?O.ENABLED:O.DISABLED),void 0!==i.background_color&&(t.backgroundColor={set:D[i.background_color]||w.BLACK}),void 0!==i.unit_type){const e=i.unit_type===a.Mc.Metric?E.metric:E.imperial;t.unitType={set:e}}if(void 0!==i.measurements||void 0!==i.measurements_saved){const e=i.measurements&&i.measurements_saved?S.MEASURE_AND_VIEW:i.measurements?S.MEASURE:S.DISABLED;t.measurements={set:e}}void 0!==i.tour_buttons&&(t.tourButtonsOverride=i.tour_buttons?O.ENABLED:O.DISABLED),void 0!==i.fast_transitions&&(t.tourFastTransitionsOverride=i.fast_transitions?O.ENABLED:O.DISABLED),void 0!==i.pan_angle&&(t.tourPanAngle={set:i.pan_angle}),void 0!==i.pan_direction&&(t.tourPanDirection={set:C[i.pan_direction]}),void 0!==i.pan_speed&&(t.tourPanSpeed={set:i.pan_speed}),void 0!==i.transition_speed&&(t.tourTransitionSpeed={set:i.transition_speed}),void 0!==i.transition_time&&(t.tourTransitionTime={set:i.transition_time}),void 0!==i.zoom_duration&&(t.tourZoomDuration={set:i.zoom_duration}),void 0!==i.dollhouse_pan_speed&&(t.tourDollhousePanSpeed={set:i.dollhouse_pan_speed});const n={};return void 0!==i.presented_by&&(n.presentedByOverride=i.presented_by?O.ENABLED:O.DISABLED),void 0!==i.contact_email&&(n.contactEmailOverride=i.contact_email?O.ENABLED:O.DISABLED),void 0!==i.contact_name&&(n.contactNameOverride=i.contact_name?O.ENABLED:O.DISABLED),void 0!==i.contact_phone&&(n.contactPhoneOverride=i.contact_phone?O.ENABLED:O.DISABLED),void 0!==i.external_url&&(n.externalUrlOverride=i.external_url?O.ENABLED:O.DISABLED),void 0!==i.model_name&&(n.modelNameOverride=i.model_name?O.ENABLED:O.DISABLED),void 0!==i.model_summary&&(n.modelSummaryOverride=i.model_summary?O.ENABLED:O.DISABLED),void 0!==i.address&&(n.addressOverride=i.address?O.ENABLED:O.DISABLED),{options:t,publication:{options:n}}}}var I=i(52227);const R=new h.Z("mds-player-options-store");class MdsPlayerOptionsStore extends b.u{constructor(){super(...arguments),this.serializer=new MdsPlayerOptionsSerializer,this.deserializer=new MdsPlayerOptionsDeserializer,this.prefetchKey="data.model.publication.options"}async read(e={}){const t={modelId:this.getViewId()};return this.query(I.GetModelOptions,t,e).then((e=>{var t;return this.deserializer.deserialize(null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.model)}))}async update(e){const t=this.getViewId(),i=this.serializer.serialize(e);if(0===Object.keys(i).length)throw new Error("No data to update?");return this.mutate(I.PatchModel,{modelId:t,patch:i}).then((e=>{R.debug(e)}))}}var L=i(74403),N=i(60841),k=i(43894),B=i(17256),F=i(44333);const U=new h.Z("showcase-settings");class ShowcaseSettings extends s.Y{constructor(){super(...arguments),this.name="showcase-settings",this.updateTransitionType=(e,t,i)=>{const n=e.options.fast_transitions?c.n.FadeToBlack:c.n.Interpolate;t.hasProperty(l.gj)?t.setProperty(l.gj,n):i.registerSetting("player_options",l.gj,n)}}async init(e,t){this.engine=t,this.store=this.configureStorage(e);const[i,n,s,l]=await Promise.all([t.getModule(o.default),t.market.waitForData(r.e),t.getModule(k.F),this.store.read()]);this.playerOptionsData=l||new a.af,t.market.register(this,a.af,this.playerOptionsData),this.configureMonitor(e);for(const e in a.gx){const t=a.gx[e],n=this.playerOptionsData.options[t];if(i.hasProperty(t)){const e=i.getProperty(t);i.updateSetting(t,n&&e),U.debug(`Updated player_options setting ${t} = ${n&&e}`)}else i.registerSetting("player_options",t,n),U.debug(`Registered player_options setting ${t} = ${n}`)}this.updateTransitionType(this.playerOptionsData,n,i),this.bindings.push(n.onPropertyChanged(a.gx.InstantTransitions,(()=>this.updateTransitionType(this.playerOptionsData,n,i))),s.onSave((()=>this.save()),{dataType:B.g.SETTINGS}),s.onRevert((()=>this.revert()),{dataType:B.g.SETTINGS}))}configureStorage(e){const{modelId:t,baseUrl:i,queue:s}=e,o=e.storageProvider||B.Xq.JSONSTORE,r=!("readonly"in e)||!!e.readonly;if(U.info(`Loading player options from ${o}`),o===B.Xq.MDS)return new MdsPlayerOptionsStore({readonly:r,baseUrl:i});const a=function(e){const{modelId:t,readonly:i}=e,n=e.baseUrl||"",s=e.queue||new g.gO,o={data:null},r=`${n}/api/v1/player/models/${t}`;if(i){const e=new d.gh({queue:s,path:r,deserialize:f,cachedData:o});return new u.nM({publishStores:[e]})}const a=new d.yh({queue:s,path:r,httpMethod:d.w$.PATCH,deserialize:f,serialize:v}),l=`${n}/api/v1/jsonstore/model/workshopSession/${t}`,c=new m.Z({queue:s,path:l,cachedData:{data:null},httpMethod:d.w$.PATCH,deserialize:p.S.sessionObjectExtract(m.j.Model,f),serialize:v},m.j.Model);return new u.nM({publishStores:[a],editStore:c,editStoreKey:u.aw.SETTINGS})}({modelId:t,baseUrl:i,readonly:r,queue:s});return new n.N(a,{dataType:B.g.SETTINGS,modelId:t,readonly:r,engine:this.engine})}configureMonitor(e){e.readonly||(this.monitor=new L.u(this.playerOptionsData,{aggregationType:N.E.NextFrame},this.engine),this.monitor.onChanged((()=>this.engine.commandBinder.issueCommand(new F.VQ({dataTypes:[B.g.SETTINGS]})))),this.store instanceof n.N&&this.store.addMonitor(this.monitor))}async save(){if(!this.store||!this.monitor)return void U.warn("Settings changes will NOT be saved");if(this.store instanceof n.N)return;const e=this.monitor.getDiffRecord(),t=e.options;return t&&(t&&void 0===t.measurements&&void 0!==t.measurements_saved&&(t.measurements=this.playerOptionsData.options.measurements),t&&void 0!==t.measurements&&void 0===t.measurements_saved&&(t.measurements_saved=this.playerOptionsData.options.measurements_saved),void 0!==(null==t?void 0:t.floor_select)&&(t.floor_select=this.playerOptionsData.options.floor_select),void 0!==(null==t?void 0:t.labels_dh)&&(t.labels_dh=this.playerOptionsData.options.labels_dh),void 0===t.presented_by&&void 0===t.contact_email&&void 0===t.contact_name&&void 0===t.contact_phone&&void 0===t.external_url&&void 0===t.model_name&&void 0===t.model_summary&&void 0===t.address||(t.presented_by=this.playerOptionsData.options.presented_by,t.contact_email=this.playerOptionsData.options.contact_email,t.contact_name=this.playerOptionsData.options.contact_name,t.contact_phone=this.playerOptionsData.options.contact_phone,t.external_url=this.playerOptionsData.options.external_url,t.model_name=this.playerOptionsData.options.model_name,t.model_summary=this.playerOptionsData.options.model_summary,t.address=this.playerOptionsData.options.address)),this.monitor.clearDiffRecord(),this.store.update(e)}async revert(){if(this.store instanceof n.N)return this.store.revert()}}},48024:(e,t,i)=>{"use strict";i.d(t,{b:()=>FlyInCommand});var n=i(99681);class FlyInCommand extends n.m{constructor(e){super(),this.payload={pose:e}}}},44100:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ShowcaseStart});var n=i(2212),s=i(54122),o=i(77956),r=i(71208),a=i(89997),l=i(47924),c=i(57369),h=i(62367),d=i(39936),u=i(89895),p=i(66997),m=i(50101),g=i(65976),f=i(48024),v=i(62431),y=i(97620),b=i(94210),w=i(44266),S=i(86682),E=i(85197),T=i(40562),M=i(82209),_=i(60982);class ShowcaseStart extends s.Y{constructor(){super(...arguments),this.name="showcase-start",this.firstRenderPromise=new w.Q,this.flyInPromise=new w.Q,this.handleFlyIn=(e,t,i)=>(this.renderer.startRender(!1),this.doStandardStart(e,t,i,!0).catch((()=>this.renderer.startRender(!0))))}async init(e,t){const[i,n]=await Promise.all([t.market.waitForData(d.e),t.getModule(p.default)]);[this.sweepData,this.sweepModule,this.cameraModule,this.renderer]=await Promise.all([t.market.waitForData(o.Z),t.getModule(b.default),t.getModule(u.default),t.getModule(m.default)]);const s=i.tryGetProperty("quickstart",!1);s||await t.getModule(T.default);const r=n.getStartingPose();return(s?this.doQuickStart(r,t):this.doStandardStart(r,t,i,!1)).then((()=>this.flyInPromise.resolve())),this.bindings.push(t.commandBinder.addBinding(f.b,(async e=>{this.handleFlyIn(e.pose||n.getStartingPose(),t,i)}))),this.waitForFirstRender}get waitForFirstRender(){return this.firstRenderPromise.nativePromise()}get waitForFlyin(){return this.flyInPromise.nativePromise()}async doQuickStart(e,t){const i=this.sweepData.getStartSweep(e),n=await t.getModule(a.default);return await n.switchToMode(e.mode,l.n.Instant,{sweepID:i.id,position:e.camera.position||i.position,rotation:e.camera.rotation,zoom:-1!==e.camera.zoom?e.camera.zoom:void 0}),t.broadcast(new M.bN(!1)),e.mode!==r.Ey.Dollhouse&&e.mode!==r.Ey.Floorplan||e.floorVisibility&&await t.commandBinder.issueCommandWhenBound(new S.h9(e.floorVisibility.lastIndexOf(1),!0,0)),this.renderBeforeStarting(t)}async doStandardStart(e,t,i,s){var o;const[c]=await Promise.all([t.getModule(a.default)]),d=i.checkUrlParam("dh",0,1)||!i.tryGetProperty(v.gx.Dollhouse,!0),u=i.checkUrlParam("fp",0,1)||!i.tryGetProperty(v.gx.FloorPlan,!0);e&&(e.mode===r.Ey.Dollhouse&&d||e.mode===r.Ey.Floorplan&&u||e.mode===r.Ey.Panorama&&!e.pano)&&(e=null);const p=!e||e&&(e.mode===r.Ey.Dollhouse||e.mode===r.Ey.Floorplan),m=!e||e&&!this.is360Pano(e)&&e.mode===r.Ey.Panorama&&!d,g=e?e.mode:r.Ey.Panorama,f=this.sweepData.getStartSweep(e).id;let b=this.sweepData.getFirstSweep().rotation;if((null===(o=null==e?void 0:e.camera)||void 0===o?void 0:o.rotation)&&!(0,_.mB)(e.camera.rotation)&&(b=e.camera.rotation),b&&g!==r.Ey.Floorplan&&(b=(0,y.Z)(b)),m){await t.getModule(E.default);const i=c.getFlyinEndPose({sweepID:f,position:e?e.camera.position:void 0,rotation:b}),o=c.getFlyinStartPose(i,s?new n.Vector3(0,0,0):void 0);t.broadcast(new M.bN(!0));const d=this.sweepModule.activateSweep({sweepId:f});return await c.switchToMode(r.Ey.Dollhouse,l.n.Instant,o),await this.renderBeforeStarting(t),await(0,h.gw)(750),await this.cameraModule.moveTo({transitionType:l.n.Interpolate,pose:i}).nativePromise(),await d,t.broadcast(new M.bN(!1)),c.switchToMode(r.Ey.Panorama,l.n.Interpolate,{sweepID:f,rotation:b},a.DEFAULT_TRANSITION_TIME)}await c.switchToMode(g,l.n.Instant,{sweepID:f,position:e?e.camera.position:void 0,rotation:b,zoom:e&&-1!==e.camera.zoom?e.camera.zoom:void 0}),p&&e&&(e.floorVisibility?await t.commandBinder.issueCommandWhenBound(new S.h9(e.floorVisibility.lastIndexOf(1),!0,0)):await t.commandBinder.issueCommandWhenBound(new S.Vw(null))),await this.renderBeforeStarting(t)}is360Pano(e){if(e.pano.uuid){const t=this.sweepData.getSweep(e.pano.uuid);if(t)return t.alignmentType!==c.z9.ALIGNED}else{const e=this.sweepData.getFirstSweep();if(e)return e.alignmentType!==c.z9.ALIGNED}return!1}async renderBeforeStarting(e){await this.renderer.renderOnce(),await e.getModule(g.default),this.renderer.startRender(!0),this.firstRenderPromise.resolve()}}},61103:(e,t,i)=>{"use strict";i.d(t,{s:()=>PreloadWebVr,w:()=>PresentWebVr});var n=i(99681);class PreloadWebVr extends n.m{constructor(){super(...arguments),this.id="WEBVR_PRELOAD"}}class PresentWebVr extends n.m{constructor(){super(...arguments),this.id="WEBVR_PRESENT"}}},91843:(e,t,i)=>{"use strict";i.d(t,{KW:()=>ToggleWorkshopBarCommand});var n=i(99681);class AppSwitchCommand extends n.m{constructor(e){super(),this.payload={application:e}}}AppSwitchCommand.id="APP_SWITCH";class ToggleWorkshopBarCommand extends n.m{constructor(e){super(),this.payload={visible:e}}}ToggleWorkshopBarCommand.id="TOGGLE_WORKSHOP_BAR";class EditFromParentCommand extends n.m{}EditFromParentCommand.id="EDIT_FROM_PARENT"},29963:(e,t,i)=>{"use strict";i.d(t,{n3:()=>ShowcaseStartCommand,mQ:()=>ShowcaseStopCommand});var n=i(99681);class ShowcaseStartCommand extends n.m{}ShowcaseStartCommand.id="SHOWCASE_START";class ShowcaseStopCommand extends n.m{}ShowcaseStopCommand.id="SHOWCASE_STOP";class ShowcaseReadyCommand extends n.m{}ShowcaseReadyCommand.id="SHOWCASE_READY"},48475:(e,t,i)=>{"use strict";i.d(t,{M:()=>RenameFloorCommand});var n=i(99681);class RenameFloorCommand extends n.m{constructor(e,t){super(),this.id="RENAME_FLOOR",this.payload={floorId:e,text:t}}}},94944:(e,t,i)=>{"use strict";i.d(t,{U:()=>u});var n=i(26605),s=i(2116),o=i(34431),r=i(9872),a=i(14071),l=i(59984),c=i(42733),h=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};const d=new(i(25799).Z)("workshop-modal");var u;!function(e){e[e.CONFIRM=0]="CONFIRM",e[e.CLOSE=1]="CLOSE"}(u||(u={}));const p={message:"",title:"",modalClass:"",cancellable:!0,closeButton:!0,confirmDisabled:!1};let m=class WorkshopModal extends n.Component{constructor(e){super(),this.handleModalCommand=async e=>{if(e.action===r.f.DISPLAY){if(this.state.open){if(!this.state.cancellable)return Promise.reject("Cannot close non-cancellable modal");await this.close(u.CLOSE)}return this.openModal(e.properties)}if(e.action===r.f.UPDATE)this.updateModal(e.properties);else{if(!this.state.open)return Promise.reject("Cannot cancel a closed modal");this.close(u.CLOSE)}return this.togglePromise},this.close=async e=>{await this.props.commandBinder.issueCommand(new o.n(400,0)),this.props.handleBlur(!1),this.promiseResolve(e),this.setState({open:!1})},this.stopPropagation=e=>{e.stopPropagation()},this.onCancel=e=>{e.stopPropagation(),this.close(u.CLOSE)},this.onConfirm=async e=>{e.stopPropagation(),this.close(u.CONFIRM)},this.state={open:!1}}async componentDidMount(){try{this.props.commandBinder.addBinding(r.Q,this.handleModalCommand)}catch(e){d.debug(e)}}async componentWillUnmount(){try{this.props.commandBinder.removeBinding(r.Q,this.handleModalCommand)}catch(e){d.debug(e)}}updateModal(e){this.state.open&&this.setState(Object.assign({},e))}openModal(e){this.props.commandBinder.issueCommand(new o.n(400,3)),this.props.handleBlur(!0);const t=Object.assign({},p,e);return this.setState(Object.assign({open:!0},t)),this.togglePromise=new Promise((e=>{this.promiseResolve=e})),this.togglePromise}render(){const{locale:e}=this.context,{open:t,title:i,titleLocalizationOptions:s,message:o,messageLocalizationOptions:r,confirmPhraseKey:h,cancelPhraseKey:d,closeButton:u,modalClass:p,confirmDisabled:m}=this.state,g=p||"";let f=i;if("string"==typeof i){const t=void 0===s?{}:s,o=e.t(i,t);f=(0,n.h)("span",null,o)}let v=o;if("string"==typeof o){const t=void 0===r?{}:r,i=e.t(o,t);v=(0,n.h)("p",{class:"modal-message"},i)}return(0,n.h)(l.N,{open:t,appendClass:{"modal-background":!0,"workshop-modal-background":!0,open:t},onClick:this.stopPropagation},(0,n.h)("dialog",{class:`modal workshop-modal ${g}`},(0,n.h)("header",{class:"modal-header"},(0,n.h)("div",{class:"modal-title"},f),u&&(0,n.h)(a.P,{onClose:this.onCancel})),(0,n.h)("div",{class:"modal-body"},v),(0,n.h)("div",{class:"modal-footer"},d&&(0,n.h)(c.zx,{buttonStyle:c.ZJ.OUTLINE,appendClass:{"button-inline":!0,cancel:!0},onClick:this.onCancel},e.t(d)),h&&(0,n.h)(c.zx,{buttonState:m?c.BN.DISABLED:c.BN.ENABLED,appendClass:{"button-inline":!0,confirm:!0},onClick:this.onConfirm},e.t(h)))))}};m=h([s.Z],m)},9872:(e,t,i)=>{"use strict";i.d(t,{f:()=>n,Q:()=>WorkshopModalCommand});var n,s=i(99681);!function(e){e[e.CLOSE=0]="CLOSE",e[e.DISPLAY=1]="DISPLAY",e[e.UPDATE=2]="UPDATE"}(n||(n={}));class WorkshopModalCommand extends s.m{constructor(e,t){if(super(),e&&!t)throw new Error("Cannot open empty modal");this.payload={action:e,properties:t}}}WorkshopModalCommand.id="WORKSHOP_MODAL"},91542:(e,t,i)=>{"use strict";i.d(t,{om:()=>SweepPlacedMessage});var n=i(93528);class SweepPlacedMessage extends n.v{constructor(e,t){super(),this.sweepId=e,this.position=t}}},53944:(e,t,i)=>{"use strict";i.d(t,{WY:()=>SweepStartedRotatingMessage,_G:()=>SweepFinishedRotatingMessage});var n=i(93528);class SweepStartedRotatingMessage extends n.v{constructor(e){super(),this.sweepId=e}}class SweepFinishedRotatingMessage extends n.v{constructor(e){super(),this.sweepId=e}}},56040:(e,t,i)=>{"use strict";i.d(t,{M:()=>Matrix});var n=i(2212);class ROMatrix{constructor(e){this.elements=[],e?(e=>void 0!==e.elements)(e)?this.elements=e.elements.slice():n.Matrix4.prototype.set.apply(this,e):n.Matrix4.prototype.set.apply(this,ROMatrix.identity)}equals(e){return n.Matrix4.prototype.equals.call(this,e)}clone(){return new ROMatrix(this)}}ROMatrix.identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];class Matrix extends ROMatrix{constructor(e){e instanceof Array||e?super(e):super(),this.threeMatrix=new n.Matrix4}set(e,t,i,s,o,r,a,l,c,h,d,u,p,m,g,f){return n.Matrix4.prototype.set.call(this,e,t,i,s,o,r,a,l,c,h,d,u,p,m,g,f),this}makeScale(e,t,i){return n.Matrix4.prototype.makeScale.call(this,e,t,i),this}copy(e){for(let t=0;t<this.elements.length;t++)this.elements[t]=e.elements[t];return this}clone(){return(new Matrix).copy(this)}transpose(){return n.Matrix4.prototype.transpose.call(this)}lookAt(e,t,i){return n.Matrix4.prototype.lookAt.call(this,e,t,i),this}setPosition(e){return n.Matrix4.prototype.setPosition.call(this,e.x,e.y,e.z),this}extractRotation(e){return n.Matrix4.prototype.extractRotation.call(this,e),this}makePerspective(e,t,i,s,o,r){return n.Matrix4.prototype.makePerspective.call(this,e,t,i,s,o,r),this}makePerspectiveFov(e,t,i=.1,s=1e3){const o=i*Math.tan(e*(Math.PI/180)/2),r=-o,a=o*t,l=-a;return n.Matrix4.prototype.makePerspective.call(this,l,a,o,r,i,s),this}makeOrthographic(e,t,i,s,o,r){return n.Matrix4.prototype.makeOrthographic.call(this,e,t,i,s,o,r),this}identity(){return this.set.apply(this,ROMatrix.identity)}makeRotationFromQuaternion(e){return n.Matrix4.prototype.makeRotationFromQuaternion.call(this,e),this}makeRotationFromEuler(e){return n.Matrix4.prototype.makeRotationFromEuler.call(this,e),this}getInverse(e){return n.Matrix4.prototype.copy.call(this,e),n.Matrix4.prototype.invert.call(this),this}premultiply(e){return n.Matrix4.prototype.premultiply.call(this,e),this}multiplyMatrices(e,t){return n.Matrix4.prototype.multiplyMatrices.call(this,e,t),this}scale(e){return n.Matrix4.prototype.scale.call(this,e),this}compose(e,t,i){return n.Matrix4.prototype.compose.call(this,e,t,i),this}asThreeMatrix4(){return this.threeMatrix.set(this.elements[0],this.elements[4],this.elements[8],this.elements[12],this.elements[1],this.elements[5],this.elements[9],this.elements[13],this.elements[2],this.elements[6],this.elements[10],this.elements[14],this.elements[3],this.elements[7],this.elements[11],this.elements[15])}}},45805:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});const n=Object.freeze({signedUrlDefaultExpireTime:24e4,signedUrlCheckInterval:1e4,signedUrlRefreshBuffer:15e3,visionTilingStartDate:new Date("8/26/2016"),visionTilingStartVersion:"1.1.407.13667",epsilon:1e-5,skyboxMeshGroup:"_group_skybox_",skysphereMeshGroup:"_group_skysphere_"})},99681:(e,t,i)=>{"use strict";i.d(t,{m:()=>Command});class Command{}},19413:(e,t,i)=>{"use strict";i.d(t,{V:()=>Data});var n=i(78909);class Data extends n.T{}},83032:(e,t,i)=>{"use strict";i.d(t,{N:()=>DataSyncStore});var n=i(14567),s=i(61111),o=i(83852);class DataSyncStore{constructor(e,t){this.sync=e,this.config=t}async read(){const{engine:e,dataType:t}=this.config,i=await this.sync.load();return this.sync.isDirty()&&e.market.waitForData(n.Q).then((e=>{e.setUnpublished(t)})),i}addMonitor(e){if(this.config.readonly)throw new s.d7;this.sync.addMonitor(e)}async revert(){return this.sync.reset()}async create(){throw new o.n}async update(){throw new o.n}async delete(){throw new o.n}}},41263:(e,t,i)=>{"use strict";i.d(t,{aw:()=>h,b3:()=>DataSync,nM:()=>ObjectSync,iY:()=>CollectionSync});var n=i(46162),s=i(64614),o=i(25799),r=i(78909),a=i(34170);const l=new o.Z("datasync");var c,h,d;!function(e){e[e.NONE=0]="NONE",e[e.LEGACY_SYNC=1]="LEGACY_SYNC",e[e.IGNORE_LEGACY_SAVE=2]="IGNORE_LEGACY_SAVE"}(c||(c={})),function(e){e.FLOOR_NAMES="FLOOR_NAMES",e.HIGHLIGHTS="HIGHLIGHTS",e.LABELS="LABELS",e.MATTERTAGS="MATTERTAGS",e.MEASUREMENTS="MEASUREMENTS",e.SETTINGS="SETTINGS",e.START_LOCATION="START_LOCATION",e.SWEEPS="SWEEPS"}(h||(h={}));class GlobalState extends r.T{constructor(){super(...arguments),this.dirty=!1,this.dirtyWS2=!1,this.sessionsSaving=0}}!function(e){e[e.IDLE=0]="IDLE",e[e.LOADING=1]="LOADING",e[e.CLEAN=2]="CLEAN",e[e.DIRTY=3]="DIRTY"}(d||(d={}));class DataSync{constructor(e,t){this.state=d.IDLE,this.diff={},this.deletedKeys=[],this.config=e,this.collectionData=t,this.config.extras||(this.config.extras=0),this.config.extras&c.LEGACY_SYNC||DataSync.configuredSyncs.push(this)}static setGlobalStore(e){if(this.sharedStore)throw Error("Attempting to overwrite sync's internal store");this.sharedStore=e,this.sharedStore.read().then((e=>{this.sharedState.lastPublished=e.lastPublished,this.sharedState.commit()}))}static setMessageBus(e){this.msgBus=e}static setAfterPublish(e){DataSync.afterPublishCallback=e}static async publishAll(){const e=this.configuredSyncs.map((e=>e.publish()));return await Promise.all(e),l.debug("sharedState.dirty = false"),this.sharedState.dirty=!1,this.sharedState.lastPublished=new Date,this.sharedState.commit(),this.sharedStore&&this.sharedStore.update(this.sharedState),this.afterPublishCallback&&await this.afterPublishCallback(),this.sharedState.lastPublished}static async resetEditStore(e){const t=this.configuredSyncs.find((t=>t.config.editStoreKey===e));t&&await t.reset()}static getStateOfEditStores(){const e=[];return this.configuredSyncs.forEach((t=>{void 0!==t.config.editStoreKey&&e.push({key:t.config.editStoreKey,dirty:t.isDirty()})})),e}static get globalSession(){return this.sharedState}isDirty(){return this.state===d.DIRTY}async load(){if(this.state!==d.IDLE)throw Error("Data already loaded");this.setState(d.LOADING);const e=this.config.publishStores&&this.config.publishStores.length>0?this.config.publishStores.map((e=>this.loadStore(e))):[];this.config.editStore&&e.push(this.loadStore(this.config.editStore)),this.config.legacyEditStore&&e.push(this.loadStore(this.config.legacyEditStore,!0));const t=await Promise.all(e),i=(e,t,i)=>t&&t.modified&&i.modified&&t.modified>i.modified?t:(e&&this.setState(d.DIRTY),i),s=(e,t,i,n,s)=>{if(!t)return e&&this.setState(d.DIRTY),i;if(n&&s&&s<n)return t;for(const n in i)i.hasOwnProperty(n)&&(e&&this.setState(d.DIRTY),t[n]=i[n]);return t};if(this.data=t[0].data||{},this.setState(d.CLEAN),this.publishedData=(0,n.p$)(this.data),this.collectionData)for(let e=1;e<t.length;e++){const n=e>=this.config.publishStores.length,o=t[e];if(o.data){for(const e in o.data)o.data.hasOwnProperty(e)&&(this.data[e]?this.config.partialData?this.data[e]=s(n,this.data[e],o.data[e]):this.data[e]=i(n,this.data[e],o.data[e]):(n&&this.setState(d.DIRTY),this.data[e]=o.data[e]));if(o.isLegacy)for(const e in this.data)o.data[e]||(n&&this.setState(d.DIRTY),this.data[e]=null,this.diff[e]=null);o.isLegacy||(this.diff=o.data)}}else for(let e=1;e<t.length;e++){const n=e>=this.config.publishStores.length,o=t[e].data;if(!o)continue;const r=o;if(this.config.partialData){const e=this.data.modified instanceof Date?this.data.modified:void 0,t=r.modified instanceof Date?r.modified:void 0;this.data=s(n,this.data,r,e,t)}else this.data=i(n,this.data,r)}for(const e in this.data)this.data[e]||(this.deletedKeys.push(e),delete this.data[e]);return this.data}loadStore(e,t=!1){return e.read().then((e=>({data:e,isLegacy:t})))}get monitorNeeded(){return void 0!==this.config.editStore||void 0!==this.config.legacyEditStore||this.config.publishStores.length>0}addMonitor(e){if(!this.monitorNeeded)throw Error("Adding a monitor unnecessarily!");this._monitor=e;this._monitor.onChanged((async()=>{if(this.onDataChanged(),this.config.safeKeys){let e=!1;if(this.collectionData)for(const t in this.diff)for(const i in this.diff[t])-1!==this.config.safeKeys.indexOf(i)&&(e=!0);else for(const t in this.diff)-1!==this.config.safeKeys.indexOf(t)&&(e=!0);if(!e)return}this.setState(d.DIRTY),await this.saveSession()}))}get monitor(){return this._monitor}setState(e){this.config.extras&c.LEGACY_SYNC?e!==d.DIRTY||DataSync.sharedState.dirtyWS2||(l.debug("sharedState.dirtyWS2 = true"),DataSync.sharedState.dirtyWS2=!0,DataSync.sharedState.commit()):(this.state=e,this.state!==d.DIRTY||DataSync.sharedState.dirty||(l.debug("sharedState.dirty = true"),DataSync.sharedState.dirty=!0,DataSync.sharedState.commit()))}async saveSession(){l.info("Saving session..."),DataSync.sharedState.sessionsSaving++,DataSync.sharedState.commit();try{this.config.editStore&&await this.config.editStore.update(this.data,this.diff),!this.config.legacyEditStore||this.config.extras&c.IGNORE_LEGACY_SAVE||await this.config.legacyEditStore.update(this.data,this.diff)}catch(e){l.error(e),DataSync.msgBus.broadcast(new a.dz(e))}DataSync.sharedState.sessionsSaving--,DataSync.sharedState.commit()}async publish(){if(this.state===d.DIRTY){for(const e of this.config.publishStores){if(!this.isWritable(e))throw Error("Trying to publish with readonly store");try{await e.update(this.data,this.diff),this.publishedData=(0,n.p$)(this.data)}catch(t){throw l.error("Failed to publish data: ",e.config,this.data,this.diff),t}}try{this.config.editStore&&await this.config.editStore.delete(),!this.config.legacyEditStore||this.config.extras&c.IGNORE_LEGACY_SAVE||await this.config.legacyEditStore.delete(),this.setState(d.CLEAN)}catch(e){throw Error("Failed to clear session data after publishing: "+e)}}}async reset(){switch(this.state){case d.CLEAN:return this.data;case d.IDLE:throw Error("Attempting to reset a Sync that was not loaded.");case d.LOADING:throw Error("Attempting to reset a Sync that is still loading.");case d.DIRTY:l.info("Clearing session..."),DataSync.sharedState.sessionsSaving++,DataSync.sharedState.commit();try{this.config.editStore&&await this.config.editStore.delete(),!this.config.legacyEditStore||this.config.extras&c.IGNORE_LEGACY_SAVE||await this.config.legacyEditStore.delete(),this.data=(0,n.p$)(this.publishedData),this.setState(d.CLEAN)}catch(e){l.error(e),DataSync.msgBus.broadcast(new a.dz(e))}return DataSync.sharedState.sessionsSaving--,DataSync.sharedState.commit(),this.data}}isWritable(e){return void 0!==e.update}}DataSync.sharedState=new GlobalState,DataSync.configuredSyncs=[];class ObjectSync extends DataSync{constructor(e){super(e,!1)}onDataChanged(){const e=this.monitor.getDiffRecord();this.diff=e,this.diff.modified=new Date}}class CollectionSync extends DataSync{constructor(e){super(e,!0)}onDataChanged(){const e=this.monitor.getDiffRecord();for(const t of e)switch(t.action){case s.KI.added:this.diff[t.index]=t.diff;break;case s.KI.updated:this.diff[t.index]||(this.diff[t.index]={}),(0,n.TS)(this.diff[t.index],t.diff);break;case s.KI.removed:delete this.diff[t.index],this.data[t.index]=null}this.monitor.clearDiffRecord()}}},28247:(e,t,i)=>{"use strict";var n,s;i.d(t,{p3:()=>n,Jj:()=>NullGeneratorResult,M8:()=>WaitForPromiseGeneratorResult,ZP:()=>EngineGenerators}),function(e){e[e.None=0]="None",e[e.Duration=1]="Duration",e[e.Phase=2]="Phase",e[e.Promise=3]="Promise"}(n||(n={}));class EngineGeneratorResult{constructor(e){this.type=e}}class NullGeneratorResult extends EngineGeneratorResult{constructor(){super(n.None)}}class WaitDurationGeneratorResult extends EngineGeneratorResult{constructor(e){super(n.Duration),this.duration=e,this.startTime=Date.now()}}class WaitForPhaseGeneratorResult extends EngineGeneratorResult{constructor(e){super(n.Phase),this.phase=e}}!function(e){e[e.Pending=0]="Pending",e[e.Fulfilled=1]="Fulfilled",e[e.Rejected=2]="Rejected"}(s||(s={}));class WaitForPromiseGeneratorResult extends EngineGeneratorResult{constructor(e){super(n.Promise),this.promise=e,this.promiseState=s.Pending,e.then((()=>{this.promiseState=s.Fulfilled})).catch((()=>{this.promiseState=s.Rejected}))}}class EngineGenerator{constructor(e,t=!0){this.generator=e,t&&this.start()}start(){this.started||(this.iterator=this.generator()),this.started=!0}iterate(){const e=this.iterator.next();this.currentResult=e.value,e.done&&(this.started=!1)}}class EngineGenerators{constructor(){this.generators=[]}startGenerator(e){let t=this.generators.length;for(let i=0;i<this.generators.length;i++){this.generators[i].generator===e&&(t=i)}this.generators[t]=new EngineGenerator(e)}stopGenerator(e){for(const t of this.generators)t.generator===e&&(t.started=!1)}processGenerators(e,t){for(const i of this.generators)if(i.started)switch(e){case n.None:(!i.currentResult||i.currentResult instanceof NullGeneratorResult)&&i.iterate();break;case n.Phase:if(i.currentResult instanceof WaitForPhaseGeneratorResult){const e=i.currentResult;void 0!==t&&e.phase===t&&i.iterate()}break;case n.Promise:if(i.currentResult instanceof WaitForPromiseGeneratorResult){i.currentResult.promiseState===s.Fulfilled&&i.iterate()}break;case n.Duration:if(i.currentResult instanceof WaitDurationGeneratorResult){const e=i.currentResult;Date.now()-e.startTime>=e.duration&&i.iterate()}}}}},93528:(e,t,i)=>{"use strict";i.d(t,{v:()=>Message});class Message{constructor(){this.msgId=-1}setID(e){if(-1!==this.msgId)throw Error("Message.msgId can only be set once.");this.msgId=e}}},59309:(e,t,i)=>{"use strict";i.d(t,{Q:()=>a,Y:()=>MessageBus});var n=i(41307),s=i(25799),o=i(57501);const r=new s.Z("message-bus");var a;!function(e){e[e.PERMANENT=0]="PERMANENT",e[e.ONCE=1]="ONCE"}(a||(a={}));class MessageBus{constructor(){this.typeLookup=new n.cj,this.callbacks={},this.messageQueue=[],this.messageCount=0}subscribe(e,t,i=a.PERMANENT){return(0,o.k1)((()=>this._subscribe(e,t,i)),(()=>this.unsubscribe(e,t)),!0,(0,n.HS)(e))}_subscribe(e,t,i=a.PERMANENT){const n=this.typeLookup.getKeyByType(e,!0);this.callbacks[n]||(this.callbacks[n]=[]),this.callbacks[n].push({type:i,callback:t})}unsubscribe(e,t){const i=this.typeLookup.getKeyByType(e);i?this.unsubscribeByIndex(i,t):r.debug(`Message callback not bound for Type: ${e.name}`)}unsubscribeByIndex(e,t){const i=this.callbacks[e].findIndex((e=>e.callback===t));-1!==i?this.callbacks[e].splice(i,1):r.debug(`Message callback not bound for TypeIndex: ${e}`)}broadcast(e){if(e.setID(this.messageCount++),this.messageQueue.push(e),1===this.messageQueue.length){for(const e of this.messageQueue){const t=this.typeLookup.getKeyByInstance(e);if(!t)continue;const i=this.callbacks[t].slice();for(const n of i)n.callback(e),n.type===a.ONCE&&this.unsubscribeByIndex(t,n.callback)}this.messageQueue=[]}}}},54122:(e,t,i)=>{"use strict";i.d(t,{Y:()=>Module});var n=i(25799);class Module{constructor(){this.bindings=[],this.log=new n.Z("module")}init(e,t){return Promise.resolve()}onUpdate(e){}dispose(e){for(const e of this.bindings)e.cancel();this.bindings=[]}}},32545:()=>{Math.sign||(Math.sign=e=>e>0?1:0===e?0:-1),Math.log2||(Math.log2=function(e){return Math.log(e)*Math.LOG2E})},3058:()=>{Number.parseInt||(Number.parseInt=window.parseInt),Number.parseFloat||(Number.parseFloat=window.parseFloat)},72864:()=>{String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{value:function(e,t=0){const i=t>0?0|t:0;return this.substring(i,i+e.length)===e}}),String.prototype.includes||(String.prototype.includes=function(e,t){"use strict";return"number"!=typeof t&&(t=0),!(t+e.length>this.length)&&-1!==this.indexOf(e,t)})},8848:()=>{if(!window.location.origin){const e=`${window.location.protocol}//${window.location.hostname}${window.location.port?`:${window.location.port}`:""}`;window.location.origin=e}},2779:(e,t,i)=>{"use strict";i.d(t,{o:()=>RenderLayers});class RenderLayer{constructor(e){this._mask=e}get mask(){return this._mask}addLayers(e){this._mask|=e.mask}removeLayers(e){return this._mask&=~e.mask}clone(){return new RenderLayer(this._mask)}}class RenderLayers{constructor(){this.layerRegistry=[],this.unusedLayers=[];for(let e=1;e<32;e++)this.unusedLayers.push(e)}static get ALL(){return new RenderLayer(-1)}static get NONE(){return new RenderLayer(0)}static get DEFAULT(){return new RenderLayer(1)}claimLayer(e){const t=this.getLayer(e);if(t.mask)return t;if(0===this.unusedLayers.length)throw Error("All render layers have already been claimed");const i=this.unusedLayers[0];return this.layerRegistry[i]=e,this.unusedLayers.shift(),new RenderLayer(1<<i)}getLayer(e){const t=this.layerRegistry.indexOf(e);return-1!==t?new RenderLayer(1<<t):RenderLayers.NONE}disposeLayer(e){const t=this.layerRegistry.indexOf(e);-1!==t&&this.unusedLayers.push(t)}}},41307:(e,t,i)=>{"use strict";i.d(t,{z$:()=>n,oL:()=>s,HS:()=>o,cj:()=>TypeLookup});const n=e=>e.prototype.constructor.name,s=e=>e.constructor,o=e=>{if("string"==typeof e)return e;if(e&&e.name)return e.name;const t=e.toString();return t.substring(0,t.indexOf("\n")).split(" ")[1]};class TypeLookup{constructor(){this.typeLookupMap={}}getKey(e){return"string"==typeof e?e:e.name}addType(e){if(!e)throw Error("Cannot index undefined type");const t=this.getKey(e);if(this.typeLookupMap[t])throw Error(`Type ${t} already registered`);return this.typeLookupMap[t]=e,t}getKeyByType(e,t){if(!e)throw Error("Cannot index undefined type");const i=this.getKey(e);let n=this.typeLookupMap[i];return!n&&t&&(n=e,this.addType(n)),n?i:""}getKeyByInstance(e,t){if(!e)throw Error("Cannot index undefined data");const i=e.constructor.name;let n=this.typeLookupMap[i];return!n&&t&&(n=e.constructor,this.addType(n)),n?i:""}getTypeByKey(e){const t=this.typeLookupMap[e];if(!t)throw Error("Key not found");if("string"==typeof t)throw Error("non type keyed result not supported");return t}getKnownTypes(){return Object.values(this.typeLookupMap)}}},70785:(e,t,i)=>{"use strict";var n;i.d(t,{A:()=>n}),function(e){e[e.Begin=0]="Begin",e[e.Logic=1]="Logic",e[e.Render=2]="Render",e[e.End=3]="End"}(n||(n={}))},84637:(e,t,i)=>{"use strict";i.d(t,{k:()=>PlayerMovedMessage});var n=i(93528);class PlayerMovedMessage extends n.v{constructor(e,t){super(),this.x=e,this.y=t}}},80384:(e,t,i)=>{"use strict";i.d(t,{a:()=>PlayerResizedMessage});var n=i(93528);class PlayerResizedMessage extends n.v{constructor(e,t){super(),this.width=e,this.height=t}}},29675:(e,t,i)=>{"use strict";i.d(t,{nh:()=>h,Mx:()=>d,pu:()=>ApplicationData,RU:()=>u});var n=i(19413),s=i(51874),o=i(5442),r=i(46162);function a(e,t){const i=Object.getOwnPropertyNames(t);for(const n of i)void 0===e[n]&&("function"==typeof t[n]?Object.defineProperty(e,n,{value:t[n].bind(e)}):Object.defineProperty(e,n,{value:t[n],writable:!0}));null!==Object.getPrototypeOf(Object.getPrototypeOf(t))&&a(e,Object.getPrototypeOf(t))}var l=i(78909);const c=e=>{if(!e||0===Object.keys(e).length)throw new Error("createObservableProxy() only works on objects that has predefined keys. Did you mean createObservableMap or createObservableArray?");if(e instanceof l.T)throw new Error("Using ObservableProxy on an ObservableObject is a BUG!");if(e.isObservableProxy)return e;const t={},i=new s.y,n=Object.create(e);Object.defineProperties(n,{isObservableProxy:{value:!0},onPropertyChanged:{value:(e,i)=>t[e].onChanged(i)},removeOnPropertyChanged:{value:(e,i)=>t[e].removeOnChanged(i)},deepCopy:{value:()=>(0,r.p$)(e)}}),a(n,i);for(const i in e)if(e.hasOwnProperty(i)){const s=(0,o.Y)(e[i]);t[i]=s,n.addChildObservable(s),Object.defineProperty(n,i,{get:()=>e[i],set:n=>{e[i]=n,t[i].value=n},enumerable:!0})}return Object.seal(n),n};var h,d;!function(e){e[e.UNINITIALIZED=0]="UNINITIALIZED",e[e.WAITING=1]="WAITING",e[e.LOADING=2]="LOADING",e[e.STARTING=3]="STARTING",e[e.PLAYING=4]="PLAYING",e[e.ERROR=5]="ERROR"}(h||(h={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.WEBVR=1]="WEBVR",e[e.SHOWCASE=2]="SHOWCASE",e[e.WORKSHOP=3]="WORKSHOP"}(d||(d={}));class ApplicationData extends n.V{constructor(e,t=d.UNKNOWN){super(),this.name="app",this.phase=e,this.application=t,this.phaseTimes=c({[h.UNINITIALIZED]:0,[h.WAITING]:0,[h.LOADING]:0,[h.STARTING]:0,[h.PLAYING]:0,[h.ERROR]:0}),this.error=null}copy(e){this.phase=e.phase,this.phaseTimes[h.UNINITIALIZED]=e.phaseTimes[h.UNINITIALIZED],this.phaseTimes[h.WAITING]=e.phaseTimes[h.WAITING],this.phaseTimes[h.LOADING]=e.phaseTimes[h.LOADING],this.phaseTimes[h.STARTING]=e.phaseTimes[h.STARTING],this.phaseTimes[h.PLAYING]=e.phaseTimes[h.PLAYING],this.phaseTimes[h.ERROR]=e.phaseTimes[h.ERROR],this.application=e.application,this.error=e.error}}const u=()=>new ApplicationData(h.UNINITIALIZED)},16925:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>AppPhaseModule});var n=i(54122),s=i(29675),o=i(3471);const r=new(i(25799).Z)("app-phase");class AppPhaseModule extends n.Y{constructor(){super(...arguments),this.name="app-phase"}async init(e,t){this.market=t.market,this.broadcast=t.broadcast.bind(t),this.tasks=e.tasks,this.appState=(0,s.RU)(),this.appState.phase=s.nh.UNINITIALIZED,this.appState.phaseTimes[s.nh.UNINITIALIZED]=Date.now(),this.appState.application=s.Mx.SHOWCASE,this.market.register(this,s.pu,this.appState),this.watchTasks(this.appState.phase),this.watchErrors()}async watchTasks(e){if(e>=s.nh.PLAYING)return;const t=e+1;try{await Promise.all(this.tasks[t])}catch(e){this.error(e)}t===s.nh.PLAYING&&this.broadcast(new o.pB(this.appState.application)),this.appState.phase!==s.nh.ERROR&&e!==s.nh.ERROR&&(this.updateCurrentPhase(t),this.watchTasks(t))}async watchErrors(){try{await Promise.all(this.tasks[s.nh.ERROR])}catch(e){this.error(e)}}updateCurrentPhase(e){this.appState.phase=e,this.appState.phaseTimes[e]=Date.now(),r.info(`${JSON.stringify(this.appState)}`),this.appState.commit(),this.broadcast(new o.LZ(e))}error(e){this.appState.error=e,this.updateCurrentPhase(s.nh.ERROR)}updateActiveApp(e){this.appState.application=e,this.appState.commit(),this.broadcast(new o.bS(e))}getData(){return this.appState}}},3471:(e,t,i)=>{"use strict";i.d(t,{LZ:()=>AppPhaseChangeMessage,bS:()=>ApplicationChangeMessage,pB:()=>ApplicationLoadedMessage});var n=i(93528);class AppPhaseChangeMessage extends n.v{constructor(e){super(),this.phase=e}}class ApplicationChangeMessage extends n.v{constructor(e){super(),this.application=e}}class ApplicationLoadedMessage extends n.v{constructor(e){super(),this.application=e}}},51431:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>Sdk});var n,s,o,r=i(54122),a=i(17187);!function(e){e.POSTMESSAGE="postmesesage",e.DIRECT="direct"}(n||(n={}));!function(e){e.EVENT="postmessage.event",e.RESPONSE="postmessage.response",e.OBSERVATION="postmessage.observation",e.COLLECTION_UPDATE="collection.updated"}(s||(s={})),function(e){e.ITEM_ADDED="collection.item.added",e.ITEM_REMOVED="collection.item.removed",e.ITEM_UPDATED="collection.item.updated",e.COLL_UPDATED="collection.coll.updated"}(o||(o={}));const l=[];for(let e=0;e<256;e++)l[e]=(e<16?"0":"")+e.toString(16);let c=1234567;const h={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(l[255&e]+l[e>>8&255]+l[e>>16&255]+l[e>>24&255]+"-"+l[255&t]+l[t>>8&255]+"-"+l[t>>16&15|64]+l[t>>24&255]+"-"+l[63&i|128]+l[i>>8&255]+"-"+l[i>>16&255]+l[i>>24&255]+l[255&n]+l[n>>8&255]+l[n>>16&255]+l[n>>24&255]).toUpperCase()},clamp:function(e,t,i){return Math.max(t,Math.min(i,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,i,n,s){return n+(e-t)*(s-n)/(i-t)},lerp:function(e,t,i){return(1-i)*e+i*t},smoothstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)},smootherstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){return void 0!==e&&(c=e%2147483647),c=16807*c%2147483647,(c-1)/2147483646},degToRad:function(e){return e*h.DEG2RAD},radToDeg:function(e){return e*h.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,i,n,s){const o=Math.cos,r=Math.sin,a=o(i/2),l=r(i/2),c=o((t+n)/2),h=r((t+n)/2),d=o((t-n)/2),u=r((t-n)/2),p=o((n-t)/2),m=r((n-t)/2);switch(s){case"XYX":e.set(a*h,l*d,l*u,a*c);break;case"YZY":e.set(l*u,a*h,l*d,a*c);break;case"ZXZ":e.set(l*d,l*u,a*h,a*c);break;case"XZX":e.set(a*h,l*m,l*p,a*c);break;case"YXY":e.set(l*p,a*h,l*m,a*c);break;case"ZYZ":e.set(l*m,l*p,a*h,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}};class Quaternion{constructor(e=0,t=0,i=0,n=1){Object.defineProperty(this,"isQuaternion",{value:!0}),this._x=e,this._y=t,this._z=i,this._w=n}static slerp(e,t,i,n){return i.copy(e).slerp(t,n)}static slerpFlat(e,t,i,n,s,o,r){let a=i[n+0],l=i[n+1],c=i[n+2],h=i[n+3];const d=s[o+0],u=s[o+1],p=s[o+2],m=s[o+3];if(h!==m||a!==d||l!==u||c!==p){let e=1-r;const t=a*d+l*u+c*p+h*m,i=t>=0?1:-1,n=1-t*t;if(n>Number.EPSILON){const s=Math.sqrt(n),o=Math.atan2(s,t*i);e=Math.sin(e*o)/s,r=Math.sin(r*o)/s}const s=r*i;if(a=a*e+d*s,l=l*e+u*s,c=c*e+p*s,h=h*e+m*s,e===1-r){const e=1/Math.sqrt(a*a+l*l+c*c+h*h);a*=e,l*=e,c*=e,h*=e}}e[t]=a,e[t+1]=l,e[t+2]=c,e[t+3]=h}static multiplyQuaternionsFlat(e,t,i,n,s,o){const r=i[n],a=i[n+1],l=i[n+2],c=i[n+3],h=s[o],d=s[o+1],u=s[o+2],p=s[o+3];return e[t]=r*p+c*h+a*u-l*d,e[t+1]=a*p+c*d+l*h-r*u,e[t+2]=l*p+c*u+r*d-a*h,e[t+3]=c*p-r*h-a*d-l*u,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=e._x,n=e._y,s=e._z,o=e._order,r=Math.cos,a=Math.sin,l=r(i/2),c=r(n/2),h=r(s/2),d=a(i/2),u=a(n/2),p=a(s/2);switch(o){case"XYZ":this._x=d*c*h+l*u*p,this._y=l*u*h-d*c*p,this._z=l*c*p+d*u*h,this._w=l*c*h-d*u*p;break;case"YXZ":this._x=d*c*h+l*u*p,this._y=l*u*h-d*c*p,this._z=l*c*p-d*u*h,this._w=l*c*h+d*u*p;break;case"ZXY":this._x=d*c*h-l*u*p,this._y=l*u*h+d*c*p,this._z=l*c*p+d*u*h,this._w=l*c*h-d*u*p;break;case"ZYX":this._x=d*c*h-l*u*p,this._y=l*u*h+d*c*p,this._z=l*c*p-d*u*h,this._w=l*c*h+d*u*p;break;case"YZX":this._x=d*c*h+l*u*p,this._y=l*u*h+d*c*p,this._z=l*c*p-d*u*h,this._w=l*c*h-d*u*p;break;case"XZY":this._x=d*c*h-l*u*p,this._y=l*u*h-d*c*p,this._z=l*c*p+d*u*h,this._w=l*c*h+d*u*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,n=Math.sin(i);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],n=t[4],s=t[8],o=t[1],r=t[5],a=t[9],l=t[2],c=t[6],h=t[10],d=i+r+h;if(d>0){const e=.5/Math.sqrt(d+1);this._w=.25/e,this._x=(c-a)*e,this._y=(s-l)*e,this._z=(o-n)*e}else if(i>r&&i>h){const e=2*Math.sqrt(1+i-r-h);this._w=(c-a)/e,this._x=.25*e,this._y=(n+o)/e,this._z=(s+l)/e}else if(r>h){const e=2*Math.sqrt(1+r-i-h);this._w=(s-l)/e,this._x=(n+o)/e,this._y=.25*e,this._z=(a+c)/e}else{const e=2*Math.sqrt(1+h-i-r);this._w=(o-n)/e,this._x=(s+l)/e,this._y=(a+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<1e-6?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(h.clamp(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(0===i)return this;const n=Math.min(1,t/i);return this.slerp(e,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,n=e._y,s=e._z,o=e._w,r=t._x,a=t._y,l=t._z,c=t._w;return this._x=i*c+o*r+n*l-s*a,this._y=n*c+o*a+s*r-i*l,this._z=s*c+o*l+i*a-n*r,this._w=o*c-i*r-n*a-s*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const i=this._x,n=this._y,s=this._z,o=this._w;let r=o*e._w+i*e._x+n*e._y+s*e._z;if(r<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,r=-r):this.copy(e),r>=1)return this._w=o,this._x=i,this._y=n,this._z=s,this;const a=1-r*r;if(a<=Number.EPSILON){const e=1-t;return this._w=e*o+t*this._w,this._x=e*i+t*this._x,this._y=e*n+t*this._y,this._z=e*s+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(a),c=Math.atan2(l,r),h=Math.sin((1-t)*c)/l,d=Math.sin(t*c)/l;return this._w=o*h+this._w*d,this._x=i*h+this._x*d,this._y=n*h+this._y*d,this._z=s*h+this._z*d,this._onChangeCallback(),this}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}class Vector3_Vector3{constructor(e=0,t=0,i=0){Object.defineProperty(this,"isVector3",{value:!0}),this.x=e,this.y=t,this.z=i}set(e,t,i){return void 0===i&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(u.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(u.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,n=this.z,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6]*n,this.y=s[1]*t+s[4]*i+s[7]*n,this.z=s[2]*t+s[5]*i+s[8]*n,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,n=this.z,s=e.elements,o=1/(s[3]*t+s[7]*i+s[11]*n+s[15]);return this.x=(s[0]*t+s[4]*i+s[8]*n+s[12])*o,this.y=(s[1]*t+s[5]*i+s[9]*n+s[13])*o,this.z=(s[2]*t+s[6]*i+s[10]*n+s[14])*o,this}applyQuaternion(e){const t=this.x,i=this.y,n=this.z,s=e.x,o=e.y,r=e.z,a=e.w,l=a*t+o*n-r*i,c=a*i+r*t-s*n,h=a*n+s*i-o*t,d=-s*t-o*i-r*n;return this.x=l*a+d*-s+c*-r-h*-o,this.y=c*a+d*-o+h*-s-l*-r,this.z=h*a+d*-r+l*-o-c*-s,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,n=this.z,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*n,this.y=s[1]*t+s[5]*i+s[9]*n,this.z=s[2]*t+s[6]*i+s[10]*n,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,n=e.y,s=e.z,o=t.x,r=t.y,a=t.z;return this.x=n*a-s*r,this.y=s*o-i*a,this.z=i*r-n*o,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return d.copy(this).projectOnVector(e),this.sub(d)}reflect(e){return this.sub(d.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(h.clamp(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,n=this.z-e.z;return t*t+i*i+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const n=Math.sin(t)*e;return this.x=n*Math.sin(i),this.y=Math.cos(t)*e,this.z=n*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=n,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}const d=new Vector3_Vector3,u=new Quaternion;class Matrix4{constructor(){Object.defineProperty(this,"isMatrix4",{value:!0}),this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,i,n,s,o,r,a,l,c,h,d,u,p,m,g){const f=this.elements;return f[0]=e,f[4]=t,f[8]=i,f[12]=n,f[1]=s,f[5]=o,f[9]=r,f[13]=a,f[2]=l,f[6]=c,f[10]=h,f[14]=d,f[3]=u,f[7]=p,f[11]=m,f[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Matrix4).fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,n=1/p.setFromMatrixColumn(e,0).length(),s=1/p.setFromMatrixColumn(e,1).length(),o=1/p.setFromMatrixColumn(e,2).length();return t[0]=i[0]*n,t[1]=i[1]*n,t[2]=i[2]*n,t[3]=0,t[4]=i[4]*s,t[5]=i[5]*s,t[6]=i[6]*s,t[7]=0,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,i=e.x,n=e.y,s=e.z,o=Math.cos(i),r=Math.sin(i),a=Math.cos(n),l=Math.sin(n),c=Math.cos(s),h=Math.sin(s);if("XYZ"===e.order){const e=o*c,i=o*h,n=r*c,s=r*h;t[0]=a*c,t[4]=-a*h,t[8]=l,t[1]=i+n*l,t[5]=e-s*l,t[9]=-r*a,t[2]=s-e*l,t[6]=n+i*l,t[10]=o*a}else if("YXZ"===e.order){const e=a*c,i=a*h,n=l*c,s=l*h;t[0]=e+s*r,t[4]=n*r-i,t[8]=o*l,t[1]=o*h,t[5]=o*c,t[9]=-r,t[2]=i*r-n,t[6]=s+e*r,t[10]=o*a}else if("ZXY"===e.order){const e=a*c,i=a*h,n=l*c,s=l*h;t[0]=e-s*r,t[4]=-o*h,t[8]=n+i*r,t[1]=i+n*r,t[5]=o*c,t[9]=s-e*r,t[2]=-o*l,t[6]=r,t[10]=o*a}else if("ZYX"===e.order){const e=o*c,i=o*h,n=r*c,s=r*h;t[0]=a*c,t[4]=n*l-i,t[8]=e*l+s,t[1]=a*h,t[5]=s*l+e,t[9]=i*l-n,t[2]=-l,t[6]=r*a,t[10]=o*a}else if("YZX"===e.order){const e=o*a,i=o*l,n=r*a,s=r*l;t[0]=a*c,t[4]=s-e*h,t[8]=n*h+i,t[1]=h,t[5]=o*c,t[9]=-r*c,t[2]=-l*c,t[6]=i*h+n,t[10]=e-s*h}else if("XZY"===e.order){const e=o*a,i=o*l,n=r*a,s=r*l;t[0]=a*c,t[4]=-h,t[8]=l*c,t[1]=e*h+s,t[5]=o*c,t[9]=i*h-n,t[2]=n*h-i,t[6]=r*c,t[10]=s*h+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(g,e,f)}lookAt(e,t,i){const n=this.elements;return b.subVectors(e,t),0===b.lengthSq()&&(b.z=1),b.normalize(),v.crossVectors(i,b),0===v.lengthSq()&&(1===Math.abs(i.z)?b.x+=1e-4:b.z+=1e-4,b.normalize(),v.crossVectors(i,b)),v.normalize(),y.crossVectors(b,v),n[0]=v.x,n[4]=y.x,n[8]=b.x,n[1]=v.y,n[5]=y.y,n[9]=b.y,n[2]=v.z,n[6]=y.z,n[10]=b.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,n=t.elements,s=this.elements,o=i[0],r=i[4],a=i[8],l=i[12],c=i[1],h=i[5],d=i[9],u=i[13],p=i[2],m=i[6],g=i[10],f=i[14],v=i[3],y=i[7],b=i[11],w=i[15],S=n[0],E=n[4],T=n[8],M=n[12],_=n[1],x=n[5],A=n[9],O=n[13],P=n[2],C=n[6],D=n[10],I=n[14],R=n[3],L=n[7],N=n[11],k=n[15];return s[0]=o*S+r*_+a*P+l*R,s[4]=o*E+r*x+a*C+l*L,s[8]=o*T+r*A+a*D+l*N,s[12]=o*M+r*O+a*I+l*k,s[1]=c*S+h*_+d*P+u*R,s[5]=c*E+h*x+d*C+u*L,s[9]=c*T+h*A+d*D+u*N,s[13]=c*M+h*O+d*I+u*k,s[2]=p*S+m*_+g*P+f*R,s[6]=p*E+m*x+g*C+f*L,s[10]=p*T+m*A+g*D+f*N,s[14]=p*M+m*O+g*I+f*k,s[3]=v*S+y*_+b*P+w*R,s[7]=v*E+y*x+b*C+w*L,s[11]=v*T+y*A+b*D+w*N,s[15]=v*M+y*O+b*I+w*k,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],n=e[8],s=e[12],o=e[1],r=e[5],a=e[9],l=e[13],c=e[2],h=e[6],d=e[10],u=e[14];return e[3]*(+s*a*h-n*l*h-s*r*d+i*l*d+n*r*u-i*a*u)+e[7]*(+t*a*u-t*l*d+s*o*d-n*o*u+n*l*c-s*a*c)+e[11]*(+t*l*h-t*r*u-s*o*h+i*o*u+s*r*c-i*l*c)+e[15]*(-n*r*c-t*a*h+t*r*d+n*o*h-i*o*d+i*a*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=t,n[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],n=e[2],s=e[3],o=e[4],r=e[5],a=e[6],l=e[7],c=e[8],h=e[9],d=e[10],u=e[11],p=e[12],m=e[13],g=e[14],f=e[15],v=h*g*l-m*d*l+m*a*u-r*g*u-h*a*f+r*d*f,y=p*d*l-c*g*l-p*a*u+o*g*u+c*a*f-o*d*f,b=c*m*l-p*h*l+p*r*u-o*m*u-c*r*f+o*h*f,w=p*h*a-c*m*a-p*r*d+o*m*d+c*r*g-o*h*g,S=t*v+i*y+n*b+s*w;if(0===S)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const E=1/S;return e[0]=v*E,e[1]=(m*d*s-h*g*s-m*n*u+i*g*u+h*n*f-i*d*f)*E,e[2]=(r*g*s-m*a*s+m*n*l-i*g*l-r*n*f+i*a*f)*E,e[3]=(h*a*s-r*d*s-h*n*l+i*d*l+r*n*u-i*a*u)*E,e[4]=y*E,e[5]=(c*g*s-p*d*s+p*n*u-t*g*u-c*n*f+t*d*f)*E,e[6]=(p*a*s-o*g*s-p*n*l+t*g*l+o*n*f-t*a*f)*E,e[7]=(o*d*s-c*a*s+c*n*l-t*d*l-o*n*u+t*a*u)*E,e[8]=b*E,e[9]=(p*h*s-c*m*s-p*i*u+t*m*u+c*i*f-t*h*f)*E,e[10]=(o*m*s-p*r*s+p*i*l-t*m*l-o*i*f+t*r*f)*E,e[11]=(c*r*s-o*h*s-c*i*l+t*h*l+o*i*u-t*r*u)*E,e[12]=w*E,e[13]=(c*m*n-p*h*n+p*i*d-t*m*d-c*i*g+t*h*g)*E,e[14]=(p*r*n-o*m*n-p*i*a+t*m*a+o*i*g-t*r*g)*E,e[15]=(o*h*n-c*r*n+c*i*a-t*h*a-o*i*d+t*r*d)*E,this}scale(e){const t=this.elements,i=e.x,n=e.y,s=e.z;return t[0]*=i,t[4]*=n,t[8]*=s,t[1]*=i,t[5]*=n,t[9]*=s,t[2]*=i,t[6]*=n,t[10]*=s,t[3]*=i,t[7]*=n,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,n))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),n=Math.sin(t),s=1-i,o=e.x,r=e.y,a=e.z,l=s*o,c=s*r;return this.set(l*o+i,l*r-n*a,l*a+n*r,0,l*r+n*a,c*r+i,c*a-n*o,0,l*a-n*r,c*a+n*o,s*a*a+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i){return this.set(1,t,i,0,e,1,i,0,e,t,1,0,0,0,0,1),this}compose(e,t,i){const n=this.elements,s=t._x,o=t._y,r=t._z,a=t._w,l=s+s,c=o+o,h=r+r,d=s*l,u=s*c,p=s*h,m=o*c,g=o*h,f=r*h,v=a*l,y=a*c,b=a*h,w=i.x,S=i.y,E=i.z;return n[0]=(1-(m+f))*w,n[1]=(u+b)*w,n[2]=(p-y)*w,n[3]=0,n[4]=(u-b)*S,n[5]=(1-(d+f))*S,n[6]=(g+v)*S,n[7]=0,n[8]=(p+y)*E,n[9]=(g-v)*E,n[10]=(1-(d+m))*E,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}decompose(e,t,i){const n=this.elements;let s=p.set(n[0],n[1],n[2]).length();const o=p.set(n[4],n[5],n[6]).length(),r=p.set(n[8],n[9],n[10]).length();this.determinant()<0&&(s=-s),e.x=n[12],e.y=n[13],e.z=n[14],m.copy(this);const a=1/s,l=1/o,c=1/r;return m.elements[0]*=a,m.elements[1]*=a,m.elements[2]*=a,m.elements[4]*=l,m.elements[5]*=l,m.elements[6]*=l,m.elements[8]*=c,m.elements[9]*=c,m.elements[10]*=c,t.setFromRotationMatrix(m),i.x=s,i.y=o,i.z=r,this}makePerspective(e,t,i,n,s,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const r=this.elements,a=2*s/(t-e),l=2*s/(i-n),c=(t+e)/(t-e),h=(i+n)/(i-n),d=-(o+s)/(o-s),u=-2*o*s/(o-s);return r[0]=a,r[4]=0,r[8]=c,r[12]=0,r[1]=0,r[5]=l,r[9]=h,r[13]=0,r[2]=0,r[6]=0,r[10]=d,r[14]=u,r[3]=0,r[7]=0,r[11]=-1,r[15]=0,this}makeOrthographic(e,t,i,n,s,o){const r=this.elements,a=1/(t-e),l=1/(i-n),c=1/(o-s),h=(t+e)*a,d=(i+n)*l,u=(o+s)*c;return r[0]=2*a,r[4]=0,r[8]=0,r[12]=-h,r[1]=0,r[5]=2*l,r[9]=0,r[13]=-d,r[2]=0,r[6]=0,r[10]=-2*c,r[14]=-u,r[3]=0,r[7]=0,r[11]=0,r[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let e=0;e<16;e++)if(t[e]!==i[e])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const p=new Vector3_Vector3,m=new Matrix4,g=new Vector3_Vector3(0,0,0),f=new Vector3_Vector3(1,1,1),v=new Vector3_Vector3,y=new Vector3_Vector3,b=new Vector3_Vector3;class Euler_Euler{constructor(e=0,t=0,i=0,n=Euler_Euler.DefaultOrder){Object.defineProperty(this,"isEuler",{value:!0}),this._x=e,this._y=t,this._z=i,this._order=n}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._order=n||this._order,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t,i){const n=h.clamp,s=e.elements,o=s[0],r=s[4],a=s[8],l=s[1],c=s[5],d=s[9],u=s[2],p=s[6],m=s[10];switch(t=t||this._order){case"XYZ":this._y=Math.asin(n(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-d,m),this._z=Math.atan2(-r,o)):(this._x=Math.atan2(p,c),this._z=0);break;case"YXZ":this._x=Math.asin(-n(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(a,m),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-u,o),this._z=0);break;case"ZXY":this._x=Math.asin(n(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(-u,m),this._z=Math.atan2(-r,c)):(this._y=0,this._z=Math.atan2(l,o));break;case"ZYX":this._y=Math.asin(-n(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(p,m),this._z=Math.atan2(l,o)):(this._x=0,this._z=Math.atan2(-r,c));break;case"YZX":this._z=Math.asin(n(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-d,c),this._y=Math.atan2(-u,o)):(this._x=0,this._y=Math.atan2(a,m));break;case"XZY":this._z=Math.asin(-n(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(p,c),this._y=Math.atan2(a,o)):(this._x=Math.atan2(-d,m),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!1!==i&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return w.makeRotationFromQuaternion(e),this.setFromRotationMatrix(w,t,i)}setFromVector3(e,t){return this.set(e.x,e.y,e.z,t||this._order)}reorder(e){return S.setFromEuler(this),this.setFromQuaternion(S,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new Vector3_Vector3(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Euler_Euler.DefaultOrder="XYZ",Euler_Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];const w=new Matrix4,S=new Quaternion;function E(){}Object.assign(E.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)},removeEventListener:function(e,t){if(void 0===this._listeners)return;const i=this._listeners[e];if(void 0!==i){const e=i.indexOf(t);-1!==e&&i.splice(e,1)}},dispatchEvent:function(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const i=t.slice(0);for(let t=0,n=i.length;t<n;t++)i[t].call(this,e)}}});class Layers{constructor(){this.mask=1}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}}class Matrix3{constructor(){Object.defineProperty(this,"isMatrix3",{value:!0}),this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,i,n,s,o,r,a,l){const c=this.elements;return c[0]=e,c[1]=n,c[2]=r,c[3]=t,c[4]=s,c[5]=a,c[6]=i,c[7]=o,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}clone(){return(new this.constructor).fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,n=t.elements,s=this.elements,o=i[0],r=i[3],a=i[6],l=i[1],c=i[4],h=i[7],d=i[2],u=i[5],p=i[8],m=n[0],g=n[3],f=n[6],v=n[1],y=n[4],b=n[7],w=n[2],S=n[5],E=n[8];return s[0]=o*m+r*v+a*w,s[3]=o*g+r*y+a*S,s[6]=o*f+r*b+a*E,s[1]=l*m+c*v+h*w,s[4]=l*g+c*y+h*S,s[7]=l*f+c*b+h*E,s[2]=d*m+u*v+p*w,s[5]=d*g+u*y+p*S,s[8]=d*f+u*b+p*E,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],n=e[2],s=e[3],o=e[4],r=e[5],a=e[6],l=e[7],c=e[8];return t*o*c-t*r*l-i*s*c+i*r*a+n*s*l-n*o*a}invert(){const e=this.elements,t=e[0],i=e[1],n=e[2],s=e[3],o=e[4],r=e[5],a=e[6],l=e[7],c=e[8],h=c*o-r*l,d=r*a-c*s,u=l*s-o*a,p=t*h+i*d+n*u;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return e[0]=h*m,e[1]=(n*l-c*i)*m,e[2]=(r*i-n*o)*m,e[3]=d*m,e[4]=(c*t-n*a)*m,e[5]=(n*s-r*t)*m,e[6]=u*m,e[7]=(i*a-l*t)*m,e[8]=(o*t-i*s)*m,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).copy(this).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,n,s,o,r){const a=Math.cos(s),l=Math.sin(s);return this.set(i*a,i*l,-i*(a*o+l*r)+o+e,-n*l,n*a,-n*(-l*o+a*r)+r+t,0,0,1),this}scale(e,t){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=t,i[4]*=t,i[7]*=t,this}rotate(e){const t=Math.cos(e),i=Math.sin(e),n=this.elements,s=n[0],o=n[3],r=n[6],a=n[1],l=n[4],c=n[7];return n[0]=t*s+i*a,n[3]=t*o+i*l,n[6]=t*r+i*c,n[1]=-i*s+t*a,n[4]=-i*o+t*l,n[7]=-i*r+t*c,this}translate(e,t){const i=this.elements;return i[0]+=e*i[2],i[3]+=e*i[5],i[6]+=e*i[8],i[1]+=t*i[2],i[4]+=t*i[5],i[7]+=t*i[8],this}equals(e){const t=this.elements,i=e.elements;for(let e=0;e<9;e++)if(t[e]!==i[e])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}}let T=0;const M=new Vector3_Vector3,_=new Quaternion,x=new Matrix4,A=new Vector3_Vector3,O=new Vector3_Vector3,P=new Vector3_Vector3,C=new Quaternion,D=new Vector3_Vector3(1,0,0),I=new Vector3_Vector3(0,1,0),R=new Vector3_Vector3(0,0,1),L={type:"added"},N={type:"removed"};function k(){Object.defineProperty(this,"id",{value:T++}),this.uuid=h.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=k.DefaultUp.clone();const e=new Vector3_Vector3,t=new Euler_Euler,i=new Quaternion,n=new Vector3_Vector3(1,1,1);t._onChange((function(){i.setFromEuler(t,!1)})),i._onChange((function(){t.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}}),this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=k.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}function B(){k.call(this),this.type="Camera",this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4,this.projectionMatrixInverse=new Matrix4}var F;k.DefaultUp=new Vector3_Vector3(0,1,0),k.DefaultMatrixAutoUpdate=!0,k.prototype=Object.assign(Object.create(E.prototype),{constructor:k,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(e,t){return _.setFromAxisAngle(e,t),this.quaternion.multiply(_),this},rotateOnWorldAxis:function(e,t){return _.setFromAxisAngle(e,t),this.quaternion.premultiply(_),this},rotateX:function(e){return this.rotateOnAxis(D,e)},rotateY:function(e){return this.rotateOnAxis(I,e)},rotateZ:function(e){return this.rotateOnAxis(R,e)},translateOnAxis:function(e,t){return M.copy(e).applyQuaternion(this.quaternion),this.position.add(M.multiplyScalar(t)),this},translateX:function(e){return this.translateOnAxis(D,e)},translateY:function(e){return this.translateOnAxis(I,e)},translateZ:function(e){return this.translateOnAxis(R,e)},localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(e){return e.applyMatrix4(x.copy(this.matrixWorld).invert())},lookAt:function(e,t,i){e.isVector3?A.copy(e):A.set(e,t,i);const n=this.parent;this.updateWorldMatrix(!0,!1),O.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?x.lookAt(O,A,this.up):x.lookAt(A,O,this.up),this.quaternion.setFromRotationMatrix(x),n&&(x.extractRotation(n.matrixWorld),_.setFromRotationMatrix(x),this.quaternion.premultiply(_.invert()))},add:function(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(L)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(N)),this},clear:function(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(N)}return this.children.length=0,this},attach:function(e){return this.updateWorldMatrix(!0,!1),x.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),x.multiply(e.parent.matrixWorld)),e.applyMatrix4(x),e.updateWorldMatrix(!1,!1),this.add(e),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(let i=0,n=this.children.length;i<n;i++){const n=this.children[i].getObjectByProperty(e,t);if(void 0!==n)return n}},getWorldPosition:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new Vector3_Vector3),this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new Quaternion),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(O,e,P),e},getWorldScale:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new Vector3_Vector3),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(O,C,e),e},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new Vector3_Vector3),this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverse(e)},traverseVisible:function(e){if(!1===this.visible)return;e(this);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverseVisible(e)},traverseAncestors:function(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){const i=this.parent;if(!0===e&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,i=e.length;t<i;t++)e[t].updateWorldMatrix(!1,!0)}},toJSON:function(e){const t=void 0===e||"string"==typeof e,i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const n={};function s(t,i){return void 0===t[i.uuid]&&(t[i.uuid]=i.toJSON(e)),i.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){n.geometry=s(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const i=t.shapes;if(Array.isArray(i))for(let t=0,n=i.length;t<n;t++){const n=i[t];s(e.shapes,n)}else s(e.shapes,i)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(s(e.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let i=0,n=this.material.length;i<n;i++)t.push(s(e.materials,this.material[i]));n.material=t}else n.material=s(e.materials,this.material);if(this.children.length>0){n.children=[];for(let t=0;t<this.children.length;t++)n.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){n.animations=[];for(let t=0;t<this.animations.length;t++){const i=this.animations[t];n.animations.push(s(e.animations,i))}}if(t){const t=o(e.geometries),n=o(e.materials),s=o(e.textures),r=o(e.images),a=o(e.shapes),l=o(e.skeletons),c=o(e.animations);t.length>0&&(i.geometries=t),n.length>0&&(i.materials=n),s.length>0&&(i.textures=s),r.length>0&&(i.images=r),a.length>0&&(i.shapes=a),l.length>0&&(i.skeletons=l),c.length>0&&(i.animations=c)}return i.object=n,i;function o(e){const t=[];for(const i in e){const n=e[i];delete n.metadata,t.push(n)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const i=e.children[t];this.add(i.clone())}return this}}),B.prototype=Object.assign(Object.create(k.prototype),{constructor:B,isCamera:!0,copy:function(e,t){return k.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new Vector3_Vector3),this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){k.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()},updateWorldMatrix:function(e,t){k.prototype.updateWorldMatrix.call(this,e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()},clone:function(){return(new this.constructor).copy(this)}}),function(e){e.INSIDE="mode.inside",e.OUTSIDE="mode.outside",e.DOLLHOUSE="mode.dollhouse",e.FLOORPLAN="mode.floorplan",e.TRANSITIONING="mode.transitioning"}(F||(F={}));F.DOLLHOUSE,new Float32Array(16);var U,V,H;!function(e){e.LOADED="inject.loaded",e.SETUP="inject.setup",e.RESOLVE="inject.resolve"}(U||(U={})),function(e){e[e.POSTMESSAGE=1]="POSTMESSAGE"}(V||(V={}));!function(e){e.CAMERA="sensor.sensortype.camera"}(H||(H={}));var G;!function(e){e.map=new Map}(G||(G={}));var z,j,W;!function(e){e.SPHERE="sensor.sourcetype.sphere",e.BOX="sensor.sourcetype.box",e.CYLINDER="sensor.sourcetype.cylinder"}(z||(z={}));!function(e){e.ACTION="postmessage.action",e.EVENT_SUB="postmessage.subscribe",e.EVENT_UNSUB="postmessage.unsubscribe",e.OBSERVABLE_SUB="postmessage.observe",e.OBSERVABLE_UNSUB="postmessage.unobserve",e.COLLECTION_SUB="collection.sub",e.COLLECTION_UNSUB="collection.unsub"}(j||(j={})),function(e){e.CONNECT="postmessage.connect",e.HANDSHAKE="postmessage.handshake",e.ACCEPT="postmessage.accept",e.REJECT="postmessage.reject",e.ACTION="postmessage.action",e.RESPONSE="postmessage.response",e.EVENT="postmessage.event",e.EVENT_SUB="postmessage.subscribe",e.EVENT_UNSUB="postmessage.unsubscribe",e.OBSERVABLE_SUB="postmessage.observe",e.OBSERVABLE_UNSUB="postmessage.unobserve",e.OBSERVABLE_UPDATE="postmessage.observation"}(W||(W={}));class PostMessage extends a.EventEmitter{constructor(e,t,i){super(),this.id=t,this.clientId=i,this.clientWindow=null,this.clientOrigin=null,this.hostWindow=e,this.messageHandler=e=>{this.onPostmessageReceived(e)},this.bindEvents()}send(e){this.clientWindow&&this.clientOrigin&&this.clientWindow.postMessage(Object.assign(Object.assign({payload:e},e),{fromId:this.id}),this.clientOrigin)}setTarget(e,t){this.clientWindow=e,this.clientOrigin=t}clearTarget(){this.clientWindow=null,this.clientOrigin=null}bindEvents(){this.hostWindow.addEventListener("message",this.messageHandler)}dispose(){this.hostWindow.removeEventListener("message",this.messageHandler)}onPostmessageReceived(e){const t=e.origin,i=e.source;if(i){switch(e.data.type){case W.CONNECT:break;case W.ACTION:case W.EVENT_SUB:case W.EVENT_UNSUB:case W.OBSERVABLE_SUB:case W.OBSERVABLE_UNSUB:case j.COLLECTION_SUB:case j.COLLECTION_UNSUB:if(!this.validateMessageOrigin(e.data.fromId,t,i))return;break;default:return}if(e.data.payload)this.emit(e.data.type,Object.assign(Object.assign({},e.data.payload),{type:e.data.type,fromId:e.data.fromId,source:i,origin:t,method:n.POSTMESSAGE}));else{const s=Object.assign(Object.assign({},e.data),{source:i,origin:t,timestamp:Date.now(),method:n.POSTMESSAGE});this.emit(e.data.type,s)}}}validateMessageOrigin(e,t,i){return-1===this.clientId&&"*"===this.clientOrigin||this.clientId===e&&this.clientWindow===i&&this.clientOrigin===t}}var Z;!function(e){e.CONNECTION="sdk.connection",e.MESSAGED="sdk.messaged",e.SUBSCRIBED="sdk.subscribed",e.UNSUBSCRIBED="sdk.unsubscribed",e.OBSERVABLE_SUB="sdk.obs.subscribe",e.OBSERVABLE_UNSUB="sdk.obs.unsubscribe",e.COLLECTION_SUB="sdk.coll.subscribe",e.COLLECTION_UNSUB="sdk.coll.unsubscribe"}(Z||(Z={}));var q=i(25799);const K=new q.Z("SdkHost");class PostMessageHost extends a.EventEmitter{constructor(e){super(),this.hostWindow=e,this.id=Math.floor(1e5*Math.random()),this.clients={},this.connectionHandler=new PostMessage(e,this.id,-1),this.bindEvents(e)}broadcastEventToClient(e,t,i){const n=this.clients[e];if(!n)return;const s={type:W.EVENT,eventType:t,eventData:i,toId:e};n.messenger.send(s)}broadcastObservationToClient(e,t,i){const n=this.clients[e];if(!n)return;const s={type:W.OBSERVABLE_UPDATE,observableKey:t,observableData:i,toId:e};n.messenger.send(s)}broadcastCollectionItemAdded(e,t,i,n){const r=this.clients[e];if(!r)return;const a={type:s.COLLECTION_UPDATE,operation:o.ITEM_ADDED,collectionKey:t,collectionIndex:i,item:n,toId:e};r.messenger.send(a)}broadcastCollectionItemRemoved(e,t,i){const n=this.clients[e];if(!n)return;const r={type:s.COLLECTION_UPDATE,operation:o.ITEM_REMOVED,collectionKey:t,collectionIndex:i,toId:e};n.messenger.send(r)}broadcastCollectionItemUpdated(e,t,i,n){const r=this.clients[e];if(!r)return;const a={type:s.COLLECTION_UPDATE,operation:o.ITEM_UPDATED,collectionKey:t,collectionIndex:i,item:n,toId:e};r.messenger.send(a)}broadcastCollectionUpdated(e,t){const i=this.clients[e];if(!i)return;const n={type:s.COLLECTION_UPDATE,operation:o.COLL_UPDATED,collectionKey:t,toId:e};i.messenger.send(n)}broadcastEvent(e,t,i=!0){for(const n of Object.keys(this.clients))(i||this.clients[parseInt(n,10)].subscriptions[e])&&this.broadcastEventToClient(parseInt(n,10),e,t)}bindEvents(e){this.connectionHandler.on(W.CONNECT,(t=>{const i=new PostMessage(e,this.id,t.fromId);this.onConnectionReceived(i,t)}))}onConnectionReceived(e,t){const i=Object.assign(Object.assign({},t),{handshake:()=>{const n=this.clients[i.fromId];if(n&&n.connected)return void K.info(`client already connected: ${i.fromId}`);this.clients[i.fromId]={key:t.applicationKey,origin:t.origin,messenger:e,subscriptions:{},connected:!1};const s={type:W.HANDSHAKE,toId:i.fromId};K.info(`handshake ${i.fromId}`),e.send(s)},accept:(t,n,s)=>{const o=this.clients[i.fromId];if(o&&o.connected)return void K.info(`client already connected: ${i.fromId}`);const r={type:W.ACCEPT,toId:i.fromId,targetId:this.id,targetOrigin:`${this.hostWindow.location.protocol}//${this.hostWindow.location.host}`,warning:s,scriptUrl:t,interface:n};K.info(`accept ${i.fromId}`),e.send(r),o.connected=!0,e.on(W.ACTION,(e=>this.onMessageReceived(o,e))),e.on(W.EVENT_SUB,(e=>this.onEventSubscribe(o,e))),e.on(W.EVENT_UNSUB,(e=>this.onEventUnsubscribe(o,e))),e.on(W.OBSERVABLE_SUB,(e=>this.onObservableSubscribe(o,e))),e.on(W.OBSERVABLE_UNSUB,(e=>this.onObservableUnsubscribe(o,e))),e.on(j.COLLECTION_SUB,(e=>this.onCollectionSubscribe(o,e))),e.on(j.COLLECTION_UNSUB,(e=>this.onCollectionUnsubscribe(o,e)))},reject:t=>{const n={type:W.REJECT,toId:i.fromId,reason:t};e.send(n),e.clearTarget(),e.dispose(),delete this.clients[i.fromId]},method:n.POSTMESSAGE});e.setTarget(i.source,i.origin),this.emit(Z.CONNECTION,i)}onMessageReceived(e,t){const i={toId:t.fromId,uid:t.uid,message:null,success:!0,type:W.RESPONSE,timestamp:Date.now()};function n(t){i.message=t,e.messenger.send(i)}const s=Object.assign(Object.assign({},t),{applicationKey:e.key,origin:e.origin,onSuccess:e=>{n(e)},onFail:e=>{i.success=!1,i.error=e,n(e)}});this.emit(Z.MESSAGED,s)}onEventSubscribe(e,t){e.subscriptions[t.subscription]=!0,this.emitSdkEvent(Z.SUBSCRIBED,e,t)}onEventUnsubscribe(e,t){e.subscriptions[t.subscription]=!1,this.emitSdkEvent(Z.UNSUBSCRIBED,e,t)}onObservableSubscribe(e,t){this.emitSdkEvent(Z.OBSERVABLE_SUB,e,t)}onObservableUnsubscribe(e,t){this.emitSdkEvent(Z.OBSERVABLE_UNSUB,e,t)}onCollectionSubscribe(e,t){this.emitSdkEvent(Z.COLLECTION_SUB,e,t)}onCollectionUnsubscribe(e,t){this.emitSdkEvent(Z.COLLECTION_UNSUB,e,t)}emitSdkEvent(e,t,i){this.emit(e,Object.assign(Object.assign({},i),{applicationKey:t.key,origin:t.origin}))}}class BridgeObserver{constructor(e){this.messageReceiver=e}notify(e){this.messageReceiver.onMessageReceived(e)}}class DictArray_DictArray{constructor(){this.values={}}add(e,t){this.getValuesAtKey(e).push(t)}remove(e,t){const i=this.values[e];if(i){const e=i.indexOf(t);e>-1&&i.splice(e,1)}}getValuesAtKey(e){const t=this.values[e]||[];return this.values[e]=t,t}valuesPerKey(e){return this.getValuesAtKey(e).length}get keys(){return Object.keys(this.values)}}class Messenger{constructor(e,t,i){this.sourceId=e,this.targetId=t,this.messageBridge=i,this.observers=new DictArray_DictArray}init(){const e=new class MessengerFacade{constructor(e){this.messenger=e}onMessageReceived(e){this.messenger.onMessageReceived(e)}}(this),t=new BridgeObserver(e);this.messageBridge.listen(t)}dispose(){this.messageBridge.stopListening()}addObserver(e){this.observers.add(e.messageType,e)}removeObserver(e){this.observers.remove(e.messageType,e)}send(e){const t=this.sourceId,i=this.targetId;this.messageBridge.send(Object.assign(Object.assign({},e),{fromId:t,toId:i,timestamp:Date.now()}))}onMessageReceived(e){if(!this.filterMessageId(e))return;const t=e.type,i=this.observers.getValuesAtKey(t);if(i)for(const t of i)t.notify(e.payload,e.timestamp)}filterMessageId(e){const t=e.toId,i=e.fromId;return t instanceof Array?t.indexOf(this.sourceId)>-1:t===this.sourceId&&i===this.targetId}}class DirectMessageBridge{constructor(e,t){this.source=e,this.target=t,this.messageObserver=null}listen(e){this.messageObserver||(this.messageObserver=e,this.source.addObserver(e))}stopListening(){this.messageObserver&&this.source.removeObserver(this.messageObserver)}send(e){const t=this.target;t&&t.post(Object.assign({},e))}}class DirectMessageNode{constructor(){this.observers=[]}addObserver(e){this.observers.push(e)}removeObserver(e){const t=this.observers.indexOf(e);t>-1&&this.observers.splice(t,1)}post(e){for(const t of this.observers)t.notify(e)}}const Y=new Set;Y.add(0);class DirectMessageFactory{constructor(e,t,i){this.hostId=e,this.host=t,this.onCreationObserver=i}createMessenger(){const e=function(){let e;do{e=Math.floor(1e6*Math.random())}while(Y.has(e));return Y.add(e),e}(),t=new DirectMessageNode,i=new DirectMessageBridge(t,this.host),n=new Messenger(e,this.hostId,i);return this.onCreationObserver.notify(e,t,n),n}}class ConnectionObserverAdaptor{constructor(e,t,i){this.observer=e,this.applicationKey=t,this.origin=i}notify(e,t,i){this.observer.onConnectionReceived(this.applicationKey,this.origin,{id:e,node:t,messenger:i})}}class FunctionCallMessageObserver{constructor(e,t){this.receiver=e,this.clientId=t,this.messageType=j.ACTION}notify(e){this.receiver.receiveAction(e,this.clientId)}}class EventSubscribeMessageObserver{constructor(e,t){this.observer=e,this.clientId=t,this.messageType=j.EVENT_SUB}notify(e){this.observer.receiveEventSub(e,this.clientId)}}class EventUnsubscribeMessageObserver{constructor(e,t){this.observer=e,this.clientId=t,this.messageType=j.EVENT_UNSUB}notify(e){this.observer.receiveEventUnsub(e,this.clientId)}}class ObservableSubMessageObserver{constructor(e,t){this.observer=e,this.clientId=t,this.messageType=j.OBSERVABLE_SUB}notify(e){this.observer.receiveObservableSub(e,this.clientId)}}class ObservableUnsubMessageObserver{constructor(e,t){this.observer=e,this.clientId=t,this.messageType=j.OBSERVABLE_UNSUB}notify(e){this.observer.receiveObservableUnsub(e,this.clientId)}}class CollectionSubMessageObserver{constructor(e,t){this.observer=e,this.clientId=t,this.messageType=j.COLLECTION_SUB}notify(e){this.observer.receiveCollectionSub(e,this.clientId)}}class CollectionUnsubMessageObserver{constructor(e,t){this.observer=e,this.clientId=t,this.messageType=j.COLLECTION_UNSUB}notify(e){this.observer.receiveCollectionUnsub(e,this.clientId)}}class ResponseMessage{constructor(e,t,i,n){this.type=s.RESPONSE,this.payload={uid:e,message:t,success:i,error:n}}}class EventMessage{constructor(e,t){this.type=s.EVENT,this.payload={eventType:e,eventData:t}}}class ObservationMessage{constructor(e,t){this.type=s.OBSERVATION,this.payload={observableKey:e,observableData:t}}}class CollectionItemAddedMessage{constructor(e,t,i,n){this.type=s.COLLECTION_UPDATE,this.payload={operation:e,collectionKey:t,collectionIndex:i,item:n}}}class CollectionItemRemovedMessage{constructor(e,t,i){this.type=s.COLLECTION_UPDATE,this.payload={operation:e,collectionKey:t,collectionIndex:i}}}class CollectionItemUpdatedMessage{constructor(e,t,i,n){this.type=s.COLLECTION_UPDATE,this.payload={operation:e,collectionKey:t,collectionIndex:i,item:n}}}class CollectionUpdatedMessage{constructor(e,t){this.type=s.COLLECTION_UPDATE,this.payload={operation:e,collectionKey:t}}}class DirectMessageHost{constructor(){this.hostId=Math.floor(1e6*Math.random()),this.host=new DirectMessageNode,this.clientConnections={},this.clientEventSubscriptions=new DictArray_DictArray,this.clientObservableSubscriptions=new DictArray_DictArray,this.clientCollectionSubscriptions=new DictArray_DictArray,this.facade=new DirectMessageHost.DirectMessageHostFacade(this)}createFactory(e,t){const i=new ConnectionObserverAdaptor(this.facade,e,t);return new DirectMessageFactory(this.hostId,this.host,i)}broadcastEvent(e,t,i=!0){const n=this.clientEventSubscriptions.getValuesAtKey(e);if(n||i)for(const i of n)this.clientConnections[i].hostToClient.send(new EventMessage(e,t||[]))}broadcastObservationToClient(e,t){const i=this.clientObservableSubscriptions.getValuesAtKey(e);if(i)for(const n of i)this.clientConnections[n].hostToClient.send(new ObservationMessage(e,t))}broadcastCollectionItemAdded(e,t,i){const n=this.clientCollectionSubscriptions.getValuesAtKey(e);if(n)for(const s of n)this.clientConnections[s].hostToClient.send(new CollectionItemAddedMessage(o.ITEM_ADDED,e,t,i))}broadcastCollectionItemRemoved(e,t){const i=this.clientCollectionSubscriptions.getValuesAtKey(e);if(i)for(const n of i)this.clientConnections[n].hostToClient.send(new CollectionItemRemovedMessage(o.ITEM_REMOVED,e,t))}broadcastCollectionItemUpdated(e,t,i){const n=this.clientCollectionSubscriptions.getValuesAtKey(e);if(n)for(const s of n)this.clientConnections[s].hostToClient.send(new CollectionItemUpdatedMessage(o.ITEM_UPDATED,e,t,i))}broadcastCollectionUpdated(e){const t=this.clientCollectionSubscriptions.getValuesAtKey(e);if(t)for(const i of t)this.clientConnections[i].hostToClient.send(new CollectionUpdatedMessage(o.COLL_UPDATED,e))}onCallReceived(e){this.functionCallcallback=e}onSubscribeReceived(e){this.eventSubCallback=e}onUnsubscribeReceived(e){this.eventUnsubCallback=e}onObservableSubReceived(e){this.observableSubCallback=e}onObservableUnsubReceived(e){this.observableUnsubCallback=e}onCollectionSubReceived(e){this.collectionSubCallback=e}onCollectionUnsubReceived(e){this.collectionUnsubCallback=e}createHostToClientConnection(e,t){const i=new Messenger(this.hostId,e,new DirectMessageBridge(this.host,t)),n=new DirectMessageHost.DirectMessageHostFacade(this);return i.addObserver(new FunctionCallMessageObserver(n,e)),i.addObserver(new EventSubscribeMessageObserver(n,e)),i.addObserver(new EventUnsubscribeMessageObserver(n,e)),i.addObserver(new ObservableSubMessageObserver(n,e)),i.addObserver(new ObservableUnsubMessageObserver(n,e)),i.addObserver(new CollectionSubMessageObserver(n,e)),i.addObserver(new CollectionUnsubMessageObserver(n,e)),i.init(),i}onConnectionReceived(e,t,i){const n=i.id,s=this.createHostToClientConnection(n,i.node);this.clientConnections[n]={id:n,clientToHost:i.messenger,hostToClient:s,applicationKey:e,origin:t}}receiveAction(e,t){const i=this.clientConnections[t];if(!i)return;const s=t=>{i.hostToClient.send(new ResponseMessage(e.uid,t,!0,""))},o=t=>{i.hostToClient.send(new ResponseMessage(e.uid,{},!1,t))};this.functionCallcallback&&this.functionCallcallback(Object.assign(Object.assign({},e),{type:W.ACTION,onSuccess:s,onFail:o,fromId:t,applicationKey:i.applicationKey,origin:i.origin,method:n.DIRECT,source:void 0}))}receiveEventSub(e,t){const i=this.clientConnections[t];i&&this.eventSubCallback&&(this.clientEventSubscriptions.add(e.subscription,t),this.eventSubCallback(this.createBridgedMessage(W.EVENT_SUB,e,i)))}receiveEventUnsub(e,t){const i=this.clientConnections[t];i&&this.eventUnsubCallback&&(this.clientEventSubscriptions.remove(e.subscription,t),this.eventUnsubCallback(this.createBridgedMessage(W.EVENT_UNSUB,e,i)))}receiveObservableSub(e,t){const i=this.clientConnections[t];i&&this.observableSubCallback&&(this.clientObservableSubscriptions.add(e.observableKey,t),this.observableSubCallback(this.createBridgedMessage(W.OBSERVABLE_SUB,e,i)))}receiveObservableUnsub(e,t){const i=this.clientConnections[t];i&&this.observableUnsubCallback&&(this.clientObservableSubscriptions.remove(e.observableKey,t),this.observableUnsubCallback(this.createBridgedMessage(W.OBSERVABLE_UNSUB,e,i)))}receiveCollectionSub(e,t){const i=this.clientConnections[t];i&&this.collectionSubCallback&&(this.clientCollectionSubscriptions.add(e.collectionKey,t),this.collectionSubCallback(this.createBridgedMessage(j.COLLECTION_SUB,e,i)))}receiveCollectionUnsub(e,t){const i=this.clientConnections[t];i&&this.collectionUnsubCallback&&(this.clientCollectionSubscriptions.remove(e.collectionKey,t),this.collectionUnsubCallback(this.createBridgedMessage(j.COLLECTION_UNSUB,e,i)))}createBridgedMessage(e,t,i){return Object.assign(Object.assign({},t),{fromId:i.id,uid:-1,type:e,applicationKey:i.applicationKey,origin:i.origin,method:n.DIRECT,source:void 0})}}DirectMessageHost.DirectMessageHostFacade=class{constructor(e){this.directMessageHost=e}onConnectionReceived(e,t,i){this.directMessageHost.onConnectionReceived(e,t,i)}receiveAction(e,t){this.directMessageHost.receiveAction(e,t)}receiveEventSub(e,t){this.directMessageHost.receiveEventSub(e,t)}receiveEventUnsub(e,t){this.directMessageHost.receiveEventUnsub(e,t)}receiveObservableSub(e,t){this.directMessageHost.receiveObservableSub(e,t)}receiveObservableUnsub(e,t){this.directMessageHost.receiveObservableUnsub(e,t)}receiveCollectionSub(e,t){this.directMessageHost.receiveCollectionSub(e,t)}receiveCollectionUnsub(e,t){this.directMessageHost.receiveCollectionUnsub(e,t)}};class SdkObserver{constructor(){this.dirty=!1}}var $=i(19413);class SdkData extends $.V{constructor(){super(...arguments),this.name="sdk",this.applicationKey=null}copy(e){this.applicationKey=e.applicationKey}}var X=i(13931),Q=i(44266);const J=new q.Z("sdk");class AnalyticsProxy{constructor(e){this.analytics=e,this.trackedEvents={}}track(e,t,i){this.trackedEvents[e]&&this.trackedEvents[e][t]||(this.trackedEvents[e]=this.trackedEvents[e]||{},this.trackedEvents[e][t]=!0,this.analytics.track(e,i))}}class Sdk extends r.Y{constructor(){super(...arguments),this.name="sdk",this.triedLoadingInterface=!1,this.clientInterface={functions:{},commands:{},enums:{},observables:{},collections:{}},this.valueToClientInterface={},this.commandCreators={},this.registeredEventUsers={},this.commands={},this.observables={},this.registeredObservers={},this.collections={},this.registeredCollectionObservers={},this.observerMap=new Map}async init(e,t){this.config=e,this.validationUrl=e.validationUrl,this.postMessageHost=new PostMessageHost(window),this.directMessageHost=new DirectMessageHost,this.analytics=new AnalyticsProxy(await t.getModule(X.default)),this.clientFilter=e.clientFilter||(()=>!0),this.issueCommand=t.commandBinder.issueCommand.bind(t.commandBinder),this.interfacePromise=new Q.Q,this.clientScriptUrl=e.clientScriptUrl,this.requestQueue=e.queue,this.data=new SdkData,t.market.register(this,SdkData,this.data),this.enableHandshaking()}async connect(e,t){return new Promise(((i,s)=>{this.setupInterface(),this.onConnectionReceived({accept:(n,s,o)=>{i({scriptUrl:n,serializedInterface:s,messengerFactory:this.directMessageHost.createFactory(e,t),warning:o}),this.data.atomic((()=>{this.data.applicationKey=e}))},reject:s,handshake:()=>{},applicationKey:e,origin:t,method:n.DIRECT})}))}enableHandshaking(){this.postMessageHost.once(Z.CONNECTION,(()=>this.setupInterface())),this.postMessageHost.on(Z.CONNECTION,(e=>this.onConnectionReceived(e)))}async setupInterface(){if(!this.triedLoadingInterface)try{this.triedLoadingInterface=!0,await this.config.setupExternalSdk(this),this.acceptConnections()}catch(e){this.interfacePromise.reject(e.message)}}acceptConnections(){this.postMessageHost.on(Z.MESSAGED,(e=>this.onActionReceived(e))),this.postMessageHost.on(Z.SUBSCRIBED,(e=>this.onSubscribeReceived(e))),this.postMessageHost.on(Z.UNSUBSCRIBED,(e=>this.onUnsubscribeReceived(e))),this.postMessageHost.on(Z.OBSERVABLE_SUB,(e=>this.onObservableSubReceived(e))),this.postMessageHost.on(Z.OBSERVABLE_UNSUB,(e=>this.onObservableUnsubReceived(e))),this.postMessageHost.on(Z.COLLECTION_SUB,(e=>this.onCollectionSubReceived(e))),this.postMessageHost.on(Z.COLLECTION_UNSUB,(e=>this.onCollectionUnsubReceived(e))),this.directMessageHost.onCallReceived((e=>this.onActionReceived(e))),this.directMessageHost.onSubscribeReceived((e=>this.onSubscribeReceived(e))),this.directMessageHost.onUnsubscribeReceived((e=>this.onUnsubscribeReceived(e))),this.directMessageHost.onObservableSubReceived((e=>this.onObservableSubReceived(e))),this.directMessageHost.onObservableUnsubReceived((e=>this.onObservableUnsubReceived(e))),this.directMessageHost.onCollectionSubReceived((e=>this.onCollectionSubReceived(e))),this.directMessageHost.onCollectionUnsubReceived((e=>this.onCollectionUnsubReceived(e))),this.interfacePromise.resolve()}clearInterface(){this.clientInterface.functions={},this.clientInterface.commands={},this.clientInterface.enums={},this.clientInterface.observables={},this.clientInterface.collections={},this.commandCreators={}}onUpdate(){if(this.observerMap.size)for(const[e,[t,i,n]]of this.observerMap)e.dirty&&(this.notifyObservableUpdate(t,i,n.getData()),e.dirty=!1)}addCommandCreator(e,t){const i=this.getInterfaceIndex(e);this.clientInterface.functions.hasOwnProperty(i)&&J.debug(`Overwriting ${i} function in sdk interface`),this.clientInterface.functions[i]=e,this.commandCreators[i]=t}addEnumToInterface(e){const t=this.getInterfaceIndex(e);if(this.clientInterface.functions.hasOwnProperty(t)&&J.debug(`Overwriting ${t} enum in sdk interface`),this.clientInterface.enums[t]=Object.assign(Object.assign({},e),{values:Object.assign({},e.values)}),"Event"===e.name){const t=Object.keys(e.values);for(const i in t){this.valueToClientInterface;const n=e.values[t[i]];this.valueToClientInterface.hasOwnProperty(n)?J.warn(`Duplicate event detected for ${JSON.stringify(e)}`):this.valueToClientInterface[n]=e}}}async addCommandToInterface(e,t){const i=this.getInterfaceIndex(e);this.addCommand(i,t),this.clientInterface.commands[i]=e}async addCommand(e,t){this.clientInterface.commands.hasOwnProperty(e),this.commands[e]=await t;const i=this;return{dispose(){i.removeCommand(e)}}}removeCommand(e){delete this.commands[e]}addObservableToInterface(e,t){const i=this.getInterfaceIndex(e);this.addObservable(i,t),this.clientInterface.observables[i]=Object.assign({},e)}addObservable(e,t){this.clientInterface.observables.hasOwnProperty(e),this.observables[e]=t;const i=this;return{dispose(){i.removeObservable(e)}}}removeObservable(e){delete this.observables[e];for(const t in this.registeredObservers){const i=this.registeredObservers[t],n=i[e];n&&n.cancel(),delete i[e]}}addCollectionToInterface(e,t){const i=this.getInterfaceIndex(e);this.addCollection(i,t),this.clientInterface.collections[i]=Object.assign({},e)}addCollection(e,t){this.clientInterface.collections.hasOwnProperty(e),this.collections[e]=t;const i=this;return{dispose(){i.removeCollection(e)}}}removeCollection(e){delete this.collections[e];for(const t in this.registeredCollectionObservers){const i=this.registeredCollectionObservers[t],n=i[e];n&&n.cancel(),delete i[e]}}getInterfaceIndex(e){let t=`${e.name}`;return e.namespace&&(t=`${e.namespace}.${t}`),t}broadcast(e,t,i,n=!0){const s=this.registeredEventUsers[e]>0;if(n||s)if(t)if(void 0!==i){const s=t(i);this.postMessageHost.broadcastEvent(e,s,n),this.directMessageHost.broadcastEvent(e,s,n)}else{const i=t();this.postMessageHost.broadcastEvent(e,i,n),this.directMessageHost.broadcastEvent(e,i,n)}else this.postMessageHost.broadcastEvent(e,void 0,n),this.directMessageHost.broadcastEvent(e,void 0,n)}notifyObservableUpdate(e,t,i){this.postMessageHost.broadcastObservationToClient(e,t,i),this.directMessageHost.broadcastObservationToClient(t,i)}async onConnectionReceived(e){if(!this.clientFilter(e))return e.reject("Connection refused");try{await this.verifyConnection(e)}catch(t){return e.reject("key/referrer mismatch")}const t=t=>{const i={enums:this.clientInterface.enums,functions:Object.assign(Object.assign({},this.clientInterface.functions),this.clientInterface.commands),observables:this.clientInterface.observables,collections:this.clientInterface.collections};this.trackSdkConnect(e),e.accept(this.clientScriptUrl,i,t)};e.handshake();try{await this.interfacePromise,t()}catch(t){e.reject(t)}}verifyConnection(e){const t={cache:!1,headers:{"X-Matterport-Application-Key":e.applicationKey,"X-Matterport-Referrer":e.origin}};return this.requestQueue.get(this.validationUrl,t)}onActionReceived(e){if(this.tryActionThroughCommand(e))return;const t=this.commandCreators[e.targetFunction];if(!t)return e.onFail(`${e.targetFunction} is not a valid command`);this.trackSdkCall(e);try{this.issueCommand(t(e.params)).then(e.onSuccess,(t=>e.onFail(t.message)))}catch(t){J.debug(t),e.onFail(t.message)}}tryActionThroughCommand(e){const t=this.commands[e.targetFunction];if(!t)return!!this.clientInterface.commands.hasOwnProperty(e.targetFunction)&&(e.onFail(`${e.targetFunction} is not ready to be called`),!0);this.trackSdkCall(e);try{t.exec(e.params,new ReturnObserver(e))}catch(t){J.debug(t),e.onFail(t.message)}return!0}onSubscribeReceived(e){this.registeredEventUsers.hasOwnProperty(e.subscription)||(this.registeredEventUsers[e.subscription]=0),this.registeredEventUsers[e.subscription]++,this.trackSdkEvent(Z.SUBSCRIBED,e)}onUnsubscribeReceived(e){this.registeredEventUsers.hasOwnProperty(e.subscription)&&(this.trackSdkEvent(Z.UNSUBSCRIBED,e),this.registeredEventUsers[e.subscription]--)}async onObservableSubReceived(e){const t=e.fromId,i=e.observableKey,n=this.observables[i];if(n){const s=await n;if(!this.observables[i])return;if(this.registeredObservers[t]=this.registeredObservers[t]||{},void 0===this.registeredObservers[t][i]){const n=new SdkObserver;this.registeredObservers[t][i]=s.subscribe(n),this.observerMap.set(n,[t,i,s]),this.trackClientSubscribe(Z.OBSERVABLE_SUB,e)}}else J.error(i,"is not a valid, registered observable")}onObservableUnsubReceived(e){const t=e.fromId,i=e.observableKey;this.registeredObservers[t]&&this.registeredObservers[t][i]&&(this.registeredObservers[t][i].cancel(),delete this.registeredObservers[t][i],this.trackClientSubscribe(Z.OBSERVABLE_UNSUB,e))}async onCollectionSubReceived(e){const t=e.fromId,i=e.collectionKey,n=this.collections[i];if(n){const s=await n;if(!this.collections[i])return;this.registeredCollectionObservers[t]=this.registeredCollectionObservers[t]||{},void 0===this.registeredCollectionObservers[t][i]&&(this.registeredCollectionObservers[t][i]=s.observe({onAdded:(e,n)=>{this.postMessageHost.broadcastCollectionItemAdded(t,i,e,n),this.directMessageHost.broadcastCollectionItemAdded(i,e,n)},onRemoved:e=>{this.postMessageHost.broadcastCollectionItemRemoved(t,i,e),this.directMessageHost.broadcastCollectionItemRemoved(i,e)},onUpdated:(e,n)=>{this.postMessageHost.broadcastCollectionItemUpdated(t,i,e,n),this.directMessageHost.broadcastCollectionItemUpdated(i,e,n)},onCollectionUpdated:()=>{this.postMessageHost.broadcastCollectionUpdated(t,i),this.directMessageHost.broadcastCollectionUpdated(i)}}),this.trackClientSubCollection(Z.COLLECTION_SUB,e))}else J.error(i,"is not a valid, registered collection")}onCollectionUnsubReceived(e){const{fromId:t,collectionKey:i}=e;this.registeredCollectionObservers[t]&&this.registeredCollectionObservers[t][i]&&(this.registeredCollectionObservers[t][i].cancel(),delete this.registeredCollectionObservers[t][i],this.trackClientSubCollection(Z.COLLECTION_UNSUB,e))}trackSdkEvent(e,t){if(!this.analytics)return;const i=e===Z.SUBSCRIBED?"on":"off",n=this.valueToClientInterface[t.subscription];if(!n)return;const s=Object.keys(n.values),o=s.find(((e,i)=>{const o=s[i];return n.values[o]===t.subscription}));if(!o)return;const r={origin:t.origin,applicationKey:t.applicationKey,name:i,namespace:n.namespace,eventType:o,count:this.registeredEventUsers[t.subscription],method:t.method};this.analytics.track("sdk_event",t.subscription,r)}trackSdkConnect(e){if(!this.analytics)return;const t={origin:e.origin,applicationKey:e.applicationKey,method:e.method};this.analytics.track("sdk_connect","connect",t)}trackSdkCall(e){if(!this.analytics)return;const t=this.clientInterface.functions[e.targetFunction]||this.clientInterface.commands[e.targetFunction],i=Object.assign(Object.assign({origin:e.origin,applicationKey:e.applicationKey},t),{method:e.method});this.analytics.track("sdk_call",e.targetFunction,i)}trackClientSubscribe(e,t){const i=e===Z.OBSERVABLE_SUB,n=this.clientInterface.observables[t.observableKey],s=Object.assign(Object.assign({origin:t.origin,applicationKey:t.applicationKey},n),{is_collection:!1,action:i?"subscribe":"cancel",method:t.method});this.analytics.track("sdk_subscribe",t.observableKey,s)}trackClientSubCollection(e,t){const i=e===Z.COLLECTION_SUB,n=this.clientInterface.collections[t.collectionKey],s=Object.assign(Object.assign({origin:t.origin,applicationKey:t.applicationKey},n),{is_collection:!0,action:i?"subscribe":"cancel",method:t.method});this.analytics.track("sdk_subscribe",t.collectionKey,s)}}class ReturnObserver{constructor(e){this.action=e}return(e){this.action.onSuccess(e)}throw(e){this.action.onFail(e)}}},14600:(e,t,i)=>{"use strict";var n;i.d(t,{F:()=>n}),function(e){e.UnitType="user_preference/unit_type",e.MeasurementSnapping="user_preference/measurement_snapping",e.MeasurementContinuousLines="user_preference/measurement_continuous",e.MeasurementUserNudgeSeen="user_preference/measurement_nudge",e.HighlightReelSettingsTab="user_preference/highlight_reel_settings_tab",e.NotesModeNudgeSeen="user_preference/notes_mode_nudge",e.NotesAddNudgeSeen="user_preference/notes_add_nudge"}(n||(n={}))},9608:(e,t,i)=>{"use strict";i.d(t,{u:()=>SettingsToggler});class SettingsToggler{constructor(e,t){this.settingsData=e,this.settings=t,this.cache={}}apply(){this.cache={};for(const e of Object.keys(this.settings)){const t=this.settingsData.tryGetProperty(e,void 0);t!==this.settings[e]&&(this.cache[e]=t,this.settingsData.setProperty(e,this.settings[e]))}}reset(){for(const e of Object.keys(this.cache)){const t=this.cache[e];this.settingsData.setProperty(e,void 0!==t&&t)}this.cache={}}toggle(e){e?this.apply():this.reset()}}},39936:(e,t,i)=>{"use strict";i.d(t,{e:()=>SettingsData});var n=i(19413),s=i(71229),o=i(21265);class SettingsData extends n.V{constructor(){super(...arguments),this.name="settings",this.properties=(0,s.q)()}clone(){const e=new SettingsData;return e.copy(this),e}copy(e){const t=e.properties;for(const e of t.keys){const i=t.get(e);i&&"function"==typeof i.clone?this.setProperty(e,i.clone()):this.setProperty(e,i)}}setProperty(e,t){const i=this.properties.get(e);null!=t&&i===t||(this.properties.set(e,t),this.commit([e]))}notifyPropertyObserver(e,t){e(this.properties.get(t))}setLocalStorageProperty(e,t){(0,o.m8)(e,t),this.setProperty(e,t)}hasProperty(e){return this.properties.has(e)}tryGetProperty(e,t){return this.hasProperty(e)?this.properties.get(e):t}getProperty(e){if(this.hasProperty(e))return this.properties.get(e);throw new Error("SettingsData: "+e+" not found")}checkUrlParam(e,t,i=0){const n=this.tryGetProperty(e,i);return"number"==typeof n?n===t:parseInt(n,10)===t}iterate(e){for(const t of this.properties.keys)e(t,this.getProperty(t))}}},30853:(e,t,i)=>{"use strict";i.r(t),i.d(t,{SettingPersistence:()=>u,default:()=>SettingsModule});var n,s=i(25799),o=i(2212),r=i(62367),a=i(44266);!function(e){e[e.Init=0]="Init",e[e.Loading=1]="Loading",e[e.Loaded=2]="Loaded"}(n||(n={}));class SettingsGUI{constructor(e){this.onChange=e,this.settings={},this.helperObject={colors:{},vectors:{},quaternions:{}},this.initPromise=new a.Q,this.loadState=n.Init,this.uninitError="ControlKit not yet initialized",this.lastKeys=[],this.lastKeysBufferLength=0,this.controlKit=void 0,this.updateRequired=!1,this.panels=[],this.onToggleCallbacks={},this.onKeyDown=e=>{this.lastKeys.unshift(e.keyCode),this.lastKeys.length>this.lastKeysBufferLength&&this.lastKeys.pop();for(let e=0;e<this.panels.length;e++){const t=this.panels[e].activationSequence;(0,r.Jq)(this.lastKeys,t)&&this.toggle(e)}},this.getPanelId=e=>{for(const t of this.panels)if(e===t.header)return t.index;return-1},this.getSubGroup=(e,t)=>{const i=this.panels[e];if(i.guiPanel||(i.guiPanel=i.makeGuiPanel()),!i.allowSubGroups)return i.guiPanel;let n=i.subGroups[t];return n||(n=i.guiPanel.addSubGroup({label:t,enable:!1}),i.subGroups[t]=n),n},this.addColor=(e,t,i,n)=>{this.updateHelperObject(t+i,n),e.addColor(this.helperObject.colors,t+i,{label:i,colorMode:"hex",onChange:e=>{this.settings[t+i].setHex(parseInt(e.substring(1),16));const n={};n[i]=this.settings[t+i],this.onChange(n)}})},this.addVector3=(e,t,i,n)=>{this.updateHelperObject(i,n);const s=e.addSubGroup({label:i}),r=["x","y","z"];for(const e in r)s.addNumberInput(this.helperObject.vectors[t+i],r[e],{label:r[e],onChange:()=>{this.settings[t+i]=new o.Vector3(this.helperObject.vectors[i].x,this.helperObject.vectors[i].y,this.helperObject.vectors[i].z);const e={};e[i]=this.settings[t+i],this.onChange(e)}})},this.addQuaternion=(e,t,i,n)=>{this.updateHelperObject(i,n);const s=e.addSubGroup({label:i}),r=["x","y","z","w"];for(const e in r){const n=i+r[e];s.addNumberInput(this.helperObject.quaternions[t+i],n,{label:r[e],onChange:()=>{this.settings[t+i]=new o.Quaternion(this.helperObject.quaternions[t+i].x,this.helperObject.quaternions[t+i].y,this.helperObject.quaternions[t+i].z,this.helperObject.quaternions[t+i].w);const e={};e[i]=this.settings[t+i],this.onChange(e)}})}}}init(){}async loadGuiPackage(){return this.loadState===n.Init&&(i.e(66).then(i.t.bind(i,94810,23)).then((e=>{const t=document.createElement("div");t.id="controlKitElement",(document.getElementById("control-kit-wrapper")||document.body).appendChild(t);const i=e=>e.stopPropagation();t.addEventListener("keydown",i),t.addEventListener("keyup",i),t.addEventListener("keypress",i),this.controlKit=new e.default({opacity:.9,enable:!1,parentDomElementId:"controlKitElement"}),this.controlKit.setShortcutEnable(""),this.controlKit.enable(),this.initPromise.resolve(),this.loadState=n.Loaded})),this.loadState=n.Loading),this.loadPromise}get loadPromise(){return this.initPromise.nativePromise()}get isLoaded(){return void 0!==this.controlKit}addPanel(e,t,i={}){for(void 0===i.width&&(i.width=250),void 0===i.allowSubGroups&&(i.allowSubGroups=!0),void 0===i.ratio&&(i.ratio=60),this.lastKeysBufferLength=Math.max(this.lastKeysBufferLength,t.length);this.lastKeysBufferLength>this.lastKeys.length;)this.lastKeys.unshift(-1);return this.panels.push({index:this.panels.length,header:e,guiPanel:null,makeGuiPanel:()=>this.controlKit.addPanel({label:e,align:"right",ratio:i.ratio,width:i.width}),subGroups:[],allowSubGroups:i.allowSubGroups,activationSequence:t.reverse()}),this.panels.length-1}isVisible(e){if(!this.controlKit)throw new Error(this.uninitError);return this.panels[e].guiPanel._enabled}toggle(e){this.controlKit?this.toggleVisibility(e):this.loadGuiPackage().then((()=>{this.toggleVisibility(e)}))}onToggle(e,t){this.onToggleCallbacks[e]||(this.onToggleCallbacks[e]=[]),this.onToggleCallbacks[e].push(t)}toggleVisibility(e){if(!this.controlKit)throw new Error(this.uninitError);const t=this.panels[e].guiPanel._enabled;if(t?this.panels[e].guiPanel.disable():this.panels[e].guiPanel.enable(),this.onToggleCallbacks[e])for(const i of this.onToggleCallbacks[e])i(!t)}dispose(){const e=document.getElementById("controlKit");e&&e.remove(),this.controlKit=void 0}activate(e){window.addEventListener("keydown",this.onKeyDown)}deactivate(e){this.controlKit&&this.controlKit.disable(),window.removeEventListener("keydown",this.onKeyDown)}render(){this.controlKit&&this.updateRequired&&(this.updateRequired=!1,this.controlKit.update())}updateSetting(e,t,i){if(!this.controlKit)throw new Error(this.uninitError);const n=e+t,s=this.settings[n];i&&"function"==typeof i.equals&&"function"==typeof i.copy&&s&&"function"==typeof s.equals&&"function"==typeof s.copy?i.equals(this.settings[n])||(this.settings[n].copy(i),this.updateHelperObject(n,i),this.updateRequired=!0):i!==this.settings[e+t]&&(this.settings[n]=i,this.updateRequired=!0)}getSetting(e,t){return this.settings[e+t]}isRegistered(e,t){return void 0!==this.settings[e+t]}addControl(e,t,i,n,s,r=2,a){if(!this.controlKit)throw new Error(this.uninitError);const l=this.getSubGroup(e,t),c=`${e}${i}`;this.settings[c]=n;let h=typeof n;if(("string"===h&&"true"===n||"false"===n)&&(h="boolean"),n instanceof o.Color)this.addColor(l,e,i,n);else if(n instanceof o.Vector3)this.addVector3(l,e,i,n);else if(n instanceof o.Quaternion)this.addQuaternion(l,e,i,n);else switch(h){case"string":Array.isArray(a)?(this.settings[c]={options:a,selected:n},l.addSelect(this.settings[c],"options",{target:"selected",label:i,onChange:e=>{const t={[i]:a[e]};this.onChange(t)}})):l.addStringInput(this.settings,e+i,{label:i,onChange:t=>{const n={};this.settings[e+i]=t,n[i]=this.settings[e+i],this.onChange(n)}});break;case"number":this.settings[`${e+i}_range`]=s||[0,10],l.addSlider(this.settings,e+i,`${e+i}_range`,{label:i,onChange:()=>{const t={};t[i]=this.settings[e+i],this.onChange(t)},dp:r});break;case"boolean":l.addCheckbox(this.settings,e+i,{label:i,ratio:10,onChange:()=>{const t={};t[i]=this.settings[e+i],this.onChange(t)}});break;default:l.addStringOutput(this.settings,e+i,{label:i})}}addButton(e,t,i,n){if(!this.controlKit)throw new Error(this.uninitError);this.getSubGroup(e,t).addButton(i,n,{label:"none",ratio:100})}addSlider(e,t,i,n,s,o,r){if(!this.controlKit)throw new Error(this.uninitError);const a=this.getSubGroup(e,t);this.settings[e+i]=n,this.settings[e+i+"_range"]=[s,o],a.addSlider(this.settings,e+i,e+i+"_range",{label:i,dp:r,onChange:()=>{const t={};t[i]=this.settings[e+i],this.onChange(t)}})}updateHelperObject(e,t){t instanceof o.Color?this.helperObject.colors[e]="#"+t.getHexString():t instanceof o.Vector3?(this.helperObject.vectors[e]={},this.helperObject.vectors[e].x=t.x,this.helperObject.vectors[e].y=t.y,this.helperObject.vectors[e].z=t.z):t instanceof o.Quaternion&&(this.helperObject.quaternions[e]={},this.helperObject.quaternions[e].x=t.x,this.helperObject.quaternions[e].y=t.y,this.helperObject.quaternions[e].z=t.z,this.helperObject.quaternions[e].w=t.w)}}var l=i(54122),c=i(39936),h=i(21265);const d=new s.Z("settings");var u;!function(e){e[e.NONE=0]="NONE",e[e.LOCAL_STORAGE=1]="LOCAL_STORAGE"}(u||(u={}));class SettingsModule extends l.Y{constructor(){super(...arguments),this.name="settings",this.queuedControls=[],this.queuedButtons=[],this.secretWord=[38,38,40,40,37,39,37,39,66,65,72],this.panelID=-1,this.addPanel=(e,t,i)=>{const n=this.getPanelId(e);return-1===n?this.settingsGUI.addPanel(e,t,i):n},this.getPanelId=e=>this.settingsGUI.getPanelId(e)}async init(e,t){this.engine=t,this.settings=new c.e,this.engine.market.register(this,c.e,this.settings),e.useGUI&&(this.settingsGUI=new SettingsGUI((e=>{this.updateSettings(e)})),t.addComponent(this,this.settingsGUI),this.panelID=this.settingsGUI.addPanel("3.1.44.22-0-g33607d0d2",this.secretWord));const i=(0,h.AO)();for(const t in i){let n=i[t];if("string"==typeof n){const e=Number.parseFloat(n);isNaN(e)||(n=e)}this.settings.setProperty(t,n),e.useGUI&&this.queuedControls.push({panelId:this.panelID,group:"Engine Config",settingName:t,value:n})}e.useGUI&&this.settingsGUI.loadPromise.then((()=>{for(const e of this.queuedControls)this.settingsGUI.addControl(e.panelId,e.group,e.settingName,e.value,e.range,e.rangePrecision,e.options);for(const e of this.queuedButtons)this.settingsGUI.addButton(e.panelId,e.group,e.buttonName,e.callback);this.settingsGUI.toggle(this.panelID)}))}get loadPromise(){return this.settingsGUI.loadPromise}getSettingsGui(){return this.settingsGUI}getMainPanelId(){return this.panelID}updateSetting(e,t,i=this.panelID){t&&t.clone&&"function"==typeof t.clone?this.settings.setProperty(e,t.clone()):this.settings.setProperty(e,t),this.settingsGUI&&this.settingsGUI.isLoaded&&this.settingsGUI.updateSetting(i,e,t)}updateSettings(e){for(const t in e)this.updateSetting(t,e[t])}registerSetting(e,t,i,n=!0,s=u.NONE,o,r=this.panelID,a=2,l){if(this.settingsGUI&&this.settingsGUI.isRegistered(r,t))return void d.warn(`Duplicate setting ${t} registered. Is a module being used twice?`);let c;c=i&&i.clone&&"function"==typeof i.clone?i.clone():i,this.settingsGUI&&n&&(this.settingsGUI.isLoaded?this.settingsGUI.addControl(r,e,t,c,o,a,l):this.queuedControls.push({panelId:r,group:e,settingName:t,value:i,range:o,rangePrecision:a,options:l}));const p=s===u.LOCAL_STORAGE?(0,h.fp)(t,i):i;this.updateSetting(t,p)}registerMenuEntry(e){const{header:t,setting:i,initialValue:n,persist:s,displayInUi:o,range:r,panel:a,onChange:l,rangePrecision:c,options:d,urlParam:u}=e;let p=n();const m=encodeURIComponent(i);if(u){let e=(0,h.AO)()[m];void 0!==e&&(Number.isNaN(Number.parseFloat(e))?"true"===e?e=!0:"false"===e&&(e=!1):e=Number.parseFloat(e),p=e)}if(this.registerSetting(t,i,p,o,s,r,a,c,d),!l&&!u)return null;if(l&&l(p),u){const e=e=>{const t=(0,h.AO)();t[m]=e,(0,h.Vf)(t,!0),l&&l(e)};return this.settings.onPropertyChanged(i,e)}return l?this.settings.onPropertyChanged(i,l):null}registerMenuButton(e){const{header:t,buttonName:i,panel:n,callback:s}=e;this.registerButton(t,i,s,n)}registerButton(e,t,i,n=this.panelID){this.settingsGUI&&(this.settingsGUI.isLoaded?this.settingsGUI.addButton(n,e,t,i):this.queuedButtons.push({panelId:n,group:e,buttonName:t,callback:i}))}hasProperty(e){return this.settings.hasProperty(e)}getProperty(e){return this.settings.getProperty(e)}tryGetProperty(e,t){return this.settings.tryGetProperty(e,t)}toggleMenu(){this.settingsGUI&&this.settingsGUI.toggle(0)}disposeGui(){this.settingsGUI.dispose()}}},60841:(e,t,i)=>{"use strict";var n;i.d(t,{E:()=>n}),function(e){e[e.Immediate=0]="Immediate",e[e.NextFrame=1]="NextFrame",e[e.Duration=2]="Duration",e[e.Manual=3]="Manual"}(n||(n={}))},64614:(e,t,i)=>{"use strict";i.d(t,{KI:()=>n,AQ:()=>ChangeRecord,Z8:()=>CollectionMonitor});var n,s=i(21307),o=i(60841),r=i(70785);!function(e){e.added="added",e.removed="removed",e.updated="updated"}(n||(n={}));class ChangeRecord{constructor(e,t,i){this.index=e,this.action=t,this.diff=i}}class CollectionMonitor{constructor(e,t){if(this.changedHandlers=[],this.awaitingInvoke=!1,this.diffRecord=[],this.targetMonitors={},this.triggerChangeHandlers=this.invokeChangeHandlers.bind(this),this.config=e,this.updatePhaseSync=t,this.config.aggregationType===o.E.NextFrame){if(!t)throw Error("UpdatePhaseSync required for NextFrame aggregation")}else if(this.config.aggregationType===o.E.Duration)throw Error("Aggregation Type not implemented")}hasDiffRecord(){return this.diffRecord.length>0}clearDiffRecord(){this.diffRecord=[];for(const e in this.targetMonitors){const t=this.targetMonitors[e];t.hasDiffRecord()&&t.clearDiffRecord()}}onChanged(e){this.changedHandlers.push(e)}removeOnChanged(e){(0,s.b)(this.changedHandlers,e)}invokeCallbacks(e){if(this.changedHandlers.length>0)for(const t of this.changedHandlers)t(e)}invokeChangeHandlers(e){switch(this.config.aggregationType){case o.E.Immediate:this.invokeCallbacks(e);break;case o.E.NextFrame:this.awaitingInvoke||(this.awaitingInvoke=!0,this.updatePhaseSync.after(r.A.End).then((()=>{this.awaitingInvoke=!1,this.invokeCallbacks(e)})));break;case o.E.Manual:}}}},83083:(e,t,i)=>{"use strict";i.d(t,{c:()=>MapMonitor});var n=i(64614),s=i(74403),o=i(46162);class MapMonitor extends n.Z8{constructor(e,t,i){super(t,i),this.target=e;for(const n of e.keys){const o=e.get(n),r=new s.u(o,t,i);r.onChanged(this.triggerChangeHandlers),this.targetMonitors[n]=r}const r={onAdded:(e,r)=>{const a=new s.u(e,t,i);a.onChanged(this.triggerChangeHandlers),this.targetMonitors[r]=a;const l=this.diffRecord.findIndex((e=>e.index===r));-1!==l&&this.diffRecord.splice(l,1);const c=new n.AQ(r,n.KI.added,(0,o.p$)(e));-1===l&&this.diffRecord.push(c),this.triggerChangeHandlers(c)},onRemoved:(e,t)=>{delete this.targetMonitors[t];const i=this.diffRecord.findIndex((e=>e.index===t));-1!==i&&this.diffRecord.splice(i,1);const s=new n.AQ(t,n.KI.removed,(0,o.p$)(e));this.triggerChangeHandlers(s),-1===i&&this.diffRecord.push(s)}};this.target.onElementChanged(r)}commitChanges(){this.invokeCallbacks(this.getDiffRecord())}getDiffRecord(){const e=[];for(const t in this.targetMonitors){const i=this.targetMonitors[t];if(i.hasDiffRecord()){const s=i.getDiffRecord(),r=this.diffRecord.findIndex((e=>e.index===t));-1!==r?(0,o.TS)(this.diffRecord[r].diff,s):e.push(new n.AQ(t,n.KI.updated,s))}}return this.diffRecord.concat(e)}}},74403:(e,t,i)=>{"use strict";i.d(t,{u:()=>Monitor});var n=i(60841),s=i(46162),o=i(70785),r=i(21307);class Monitor{constructor(e,t,i){this.updatePhaseSync=i,this.target=e,this.clearDiffRecord(),this.target.onChanged((()=>{this.diffRecord=(0,s.br)(this.originalData,(0,s.p$)(this.target),t.shallow),this.handleAggregation()})),this.aggregationType=t.aggregationType,this.changedHandlers=[]}hasDiffRecord(){return Object.keys(this.diffRecord).length>0}getDiffRecord(){return this.diffRecord}clearDiffRecord(){this.originalData=(0,s.p$)(this.target),this.diffRecord={}}onChanged(e){this.changedHandlers.push(e)}removeOnChanged(e){(0,r.b)(this.changedHandlers,e)}commitChanges(){this.triggerChangeHandlers(this.diffRecord)}handleAggregation(){switch(this.aggregationType){case n.E.Immediate:this.triggerChangeHandlers(this.diffRecord);break;case n.E.NextFrame:if(!this.updatePhaseSync)throw new Error("handleAggregation() -> Next frame aggregation requested, but updatePhaseSync is null");this.nextFramePromise||(this.nextFramePromise=this.updatePhaseSync.after(o.A.Begin).then((()=>{this.triggerChangeHandlers(this.diffRecord)})).finally((()=>{this.nextFramePromise=void 0})));break;case n.E.Duration:throw new Error("AggregationType.Duration: Please implement me :)");case n.E.Manual:}}triggerChangeHandlers(e){if(this.changedHandlers.length>0)for(const t of this.changedHandlers)t(e)}}},51874:(e,t,i)=>{"use strict";i.d(t,{y:()=>Observable});var n=i(57501);class Observable{constructor(){this.isObservable=!0,this._dirtyObservable=!1,this._activeObservable=!0,this._observerNotifying=!1,this._changeObservers=new Set,this._parentObservables=new Set,this._childObservables=new Set,Object.defineProperties(this,{isObservable:{value:this.isObservable,writable:!1,enumerable:!1},_dirtyObservable:{value:this._dirtyObservable,enumerable:!1},_activeObservable:{value:this._activeObservable,enumerable:!1},_observerNotifying:{value:this._observerNotifying,enumerable:!1},_changeObservers:{value:this._changeObservers,writable:!1,enumerable:!1},_childObservables:{value:this._childObservables,writable:!1,enumerable:!1},_parentObservables:{value:this._parentObservables,writable:!1,enumerable:!1}})}onChanged(e){if(this._changeObservers.has(e))throw new Error("This observer function is already observing this Observable, and double subscriptions are not supported.");return(0,n.k1)((()=>this._changeObservers.add(e)),(()=>this.removeOnChanged(e)),!0)}removeOnChanged(e){this._changeObservers.delete(e)}notifyObservers(){if(this._dirtyObservable&&!this._observerNotifying&&this._activeObservable){this._observerNotifying=!0;for(const e of this._changeObservers)this.notifyObserver(e);this._dirtyObservable=!1,this._observerNotifying=!1}}notifyObserver(e){e(void 0)}notifyDown(){for(const e of this._childObservables)e.notifyDown();this.notifyObservers()}notifyUp(){for(const e of this._parentObservables)e.notifyUp();this.notifyObservers()}setDirty(e=!0){this.setDirtyUp(),e&&this.notifyUp()}setDirtyUp(){if(!this._dirtyObservable){this._dirtyObservable=!0;for(const e of this._parentObservables)e.setDirtyUp()}}addChildObservable(e){Observable.isObservable(e)&&(this._childObservables.add(e),e._parentObservables.add(this))}removeChildObservables(e){Observable.isObservable(e)&&(this._childObservables.delete(e),e._parentObservables.delete(this))}atomic(e){if(!this._activeObservable)return e();try{this.setActive(!1),e()}finally{this.setActive(!0)}}setActive(e){const t=this._activeObservable;this._activeObservable=e,!t&&e&&this.notifyObservers();for(const t of this._childObservables)t.setActive(e)}deepCopy(){throw Error("deepCopy is only implemented in subclasses of Observable")}static isObservable(e){return e&&e.isObservable}}},90134:(e,t,i)=>{"use strict";i.d(t,{d:()=>ObservableArray,C:()=>o});var n=i(51874),s=i(46162);class ObservableArray extends n.y{constructor(){super(),this.isObservableArray=!0,this.elements=[]}push(e){return this.elements.push(e),this.addChildObservable(e),this.setDirty(),this.length}concat(e){const t=this.elements.length;this.elements=this.elements.concat(e);for(let e=t;e<this.elements.length;e++)this.addChildObservable(this.elements[e]);return this.setDirty(),this.length}replace(e){for(const e of this.elements)this.removeChildObservables(e);return this.elements=[],this.concat(e)}remove(e){if(e<0||e>=this.length)throw new Error(`Index ${e} not in range of ObservableArray`);const[t]=this.elements.splice(e,1);this.removeChildObservables(t),this.setDirty()}update(e,t){const i=this.elements[e];i!==t&&(this.elements[e]=t,this.removeChildObservables(i),this.addChildObservable(t),this.setDirty())}get length(){return this.elements.length}set length(e){if(e<this.elements.length){for(let t=this.elements.length-1;t>=e;t--){const e=this.elements[t];this.removeChildObservables(e)}this.elements.length=e,this.setDirty()}}values(){return[...this.elements]}filter(e){return this.elements.filter(e)}find(e){return this.elements.find(e)}*[Symbol.iterator](){for(const e of this.elements)yield e}map(e){return this.elements.map(e)}forEach(e){this.elements.forEach(e)}get(e){return this.elements[e]}findIndex(e){return this.elements.findIndex(e)}indexOf(e){return this.elements.indexOf(e)}splice(e,t,...i){let n;if(i.length){n=this.elements.splice(e,t,...i);for(const e of i)this.addChildObservable(e)}else n=this.elements.splice(e,t);for(const e of n)this.removeChildObservables(e);return this.setDirty(),n}insert(e,t){if(e>this.elements.length)throw new Error(`Tried to insert at index ${e} in an array that's only ${this.elements.length} long`);e!==this.elements.length?(this.elements.splice(e,0,t),this.addChildObservable(t),this.setDirty()):this.push(t)}shift(){const e=this.elements.shift();return e&&(this.removeChildObservables(e),this.setDirty()),e}move(e,t){if(t>this.elements.length-1)throw Error("Index to move to is out of bounds");const i=this.elements[e];this.elements.splice(e,1),this.elements.splice(t,0,i),this.setDirty()}onElementChanged(e){let t=this.elements.slice();return this.onChanged((()=>{for(const i in t){const n=parseInt(i,10);e.onRemoved&&void 0===this.get(n)&&e.onRemoved(t[n],n)}for(const i in this.elements){const s=parseInt(i,10),o=this.get(s);void 0===t[s]?e.onAdded&&e.onAdded(o,s):(n.y.isObservable(o)&&o._dirtyObservable||o!==t[s])&&(e.onUpdated?e.onUpdated(o,s):e.onRemoved&&null===o&&e.onRemoved(t[s],s))}t=this.elements.slice()}))}deepCopy(){return this.map((e=>(0,s.p$)(e)))}}const o=e=>{const t=new ObservableArray;return e&&t.concat(e),t}},71229:(e,t,i)=>{"use strict";i.d(t,{v:()=>ObservableMap,q:()=>r});var n=i(51874),s=i(46162);function o(e){return(0,s.hj)(e)?""+e:e}class ObservableMap extends n.y{constructor(){super(),this.map={},this._keysSet=new Set,this._keysList=[]}get keys(){return this._keysList.slice()}get values(){return this._keysList.map((e=>this.get(e)))}entries(){const e=[];for(const t in this.map)e.push([t,this.map[t]]);return e}get length(){return this._keysList.length}*[Symbol.iterator](){for(const e of this._keysList)yield this.get(e)}get(e){return this.map[e]}has(e){return void 0!==this.map[e]}set(e,t){e=o(e);this.map[e]!==t&&(this.removeChildObservables(this.map[e]),this.addChildObservable(t),this.map[e]=t,this._keysSet.has(e)||(this._keysList.push(e),this._keysSet.add(e)),this.setDirty())}delete(e){e=o(e),this.removeChildObservables(this.map[e]);const t=this.map.hasOwnProperty(e);return delete this.map[e],t&&(this._keysSet.delete(e),this._keysList.splice(this._keysList.indexOf(e),1),this.setDirty()),t}onElementChanged(e){let t=Object.assign({},this.map);return this.onChanged((()=>{for(const i in t)e.onRemoved&&!this.has(i)&&e.onRemoved(t[i],i);for(const i of this._keysList){const s=this.get(i);void 0===t[i]?e.onAdded&&e.onAdded(s,i):(n.y.isObservable(s)&&s._dirtyObservable||s!==t[i])&&(e.onUpdated&&null!==s?e.onUpdated(s,i):e.onRemoved&&null===s&&e.onRemoved(t[i],i))}t=Object.assign({},this.map)}))}deepCopy(){const e={};for(const t of this._keysList)e[t]=(0,s.p$)(this.map[t]);return e}}const r=(e={})=>{const t=new ObservableMap;for(const i in e)t.set(i,e[i]);return t}},78909:(e,t,i)=>{"use strict";i.d(t,{T:()=>ObservableObject});var n=i(51874),s=i(46162),o=i(21265),r=i(25799),a=i(57501);const l=new r.Z("ObservableObject"),c=1===(0,o.hu)("debug",0);class ObservableObject extends n.y{constructor(){super(),this._propertyObservables={},this._valueCache={},this._dirtyKeys=new Set,Object.defineProperties(this,{_propertyObservables:{value:this._propertyObservables,writable:!1,enumerable:!1},_valueCache:{value:this._valueCache,writable:!1,enumerable:!1},_dirtyKeys:{value:this._dirtyKeys,writable:!1,enumerable:!1}}),c&&setTimeout((()=>{!function(e){const t={};for(const i in e)e.hasOwnProperty(i)&&(t[i]=e[i],e._valueCache[i]=e[i],Object.defineProperty(e,i,{get:()=>t[i],set:s=>{const o=e._valueCache[i];(o!==s||n.y.isObservable(o)&&o._dirtyObservable)&&d(e,i),t[i]=s},enumerable:!0}))}(this)}),1)}onPropertyChanged(e,t){if(this._propertyObservables[e]||(this._propertyObservables[e]=[]),-1!==this._propertyObservables[e].indexOf(t))throw new Error("This observer function is already observing this Observable, and double subscriptions are not supported.");return(0,a.k1)((()=>this._propertyObservables[e].push(t)),(()=>this.removeOnPropertyChanged(e,t)),!0,e)}removeOnPropertyChanged(e,t){const i=this._propertyObservables[e].indexOf(t);i>=0&&this._propertyObservables[e].splice(i,1)}commit(e=[]){for(const t of e)this._dirtyKeys.add(t);this.setDirtyUp(),this.notifyUp()}setDirtyUp(){for(const e in this){if(!this.hasOwnProperty(e))continue;const t=this._valueCache[e],i=this[e],s=typeof i,o="undefined"===s||"string"===s||"number"===s||"boolean"===s||null===i;if(this._propertyObservables[e]&&!o&&!n.y.isObservable(i))throw new Error(`Property ${e} has property listeners, but has a value that is not observable or a primitive!`);t!==i?(this.removeChildObservables(t),this.addChildObservable(i),this._valueCache[e]=i,this._dirtyKeys.add(e)):n.y.isObservable(t)&&t._dirtyObservable&&this._dirtyKeys.add(e)}super.setDirtyUp()}notifyObservers(){if(this._dirtyObservable&&!this._observerNotifying&&this._activeObservable){this._observerNotifying=!0;for(const e of this._dirtyKeys){for(const t of this._propertyObservables[e]||[])this.notifyPropertyObserver(t,e);c&&u(this,e)}this._observerNotifying=!1,this._dirtyKeys.clear()}super.notifyObservers()}notifyPropertyObserver(e,t){e(this._valueCache[t])}notifyObserver(e){e(this)}deepCopy(){const e={};for(const t in this)this.hasOwnProperty(t)&&(e[t]=(0,s.p$)(this[t]));return e}}const h=new Map;function d(e,t){h.has(e)||h.set(e,{});h.get(e)[t]=Error()}function u(e,t){if(h.has(e)){const i=h.get(e);i[t]&&delete i[t]}}if(c){const e=setInterval((()=>{(function(){for(const e of h.values())for(const t in e)return l.error(`ObservableObject property "${t}" was still dirty after one tick! Did you forget a .commit()?`),l.error("See stack trace of the property write below:"),l.error(e[t].stack),!0;return!1})()&&void 0!==e&&clearInterval(e)}),16)}},5442:(e,t,i)=>{"use strict";i.d(t,{f:()=>ObservableValue,Y:()=>o});var n=i(51874),s=i(46162);class ObservableValue extends n.y{constructor(e){super(),this.value=e}notifyObserver(e){e(this.value)}get value(){return this._value}set value(e){this._value!==e&&(this.removeChildObservables(this._value),this.addChildObservable(e),this._value=e,this.setDirty())}deepCopy(){return(0,s.p$)(this._value)}}const o=e=>new ObservableValue(e)},23812:(e,t,i)=>{"use strict";i.d(t,{$:()=>PureObservable});class PureObservable{constructor(){this.observers=new Set}observe(e){this.observers.add(e);const t=this;return{renew(){t.observers.add(e)},cancel(){t.removeObserver(e)}}}removeObserver(e){this.observers.delete(e)}notify(){for(const e of this.observers)e.notify()}}},80994:(e,t,i)=>{"use strict";i.d(t,{A:()=>CollectionSerializer});class CollectionSerializer{constructor(e){this.config=e}serialize(e){const{serializer:t}=this.config;if(!e||!t)return null;const i={};for(const n in e){const s=t.serialize(e[n]);s&&(i[n]=s)}return i}deserialize(e){const{deserializer:t}=this.config;if(!e||!t)return{};const i={};for(const n in e){const s=t.deserialize(e[n]);s&&(i[n]=s)}return i}}},53999:(e,t,i)=>{"use strict";i.d(t,{V:()=>AggregateSubscription});class AggregateSubscription{constructor(...e){this.subs=e}renew(){for(const e of this.subs)e.renew()}cancel(){for(const e of this.subs)e.cancel()}}},57501:(e,t,i)=>{"use strict";i.d(t,{gm:()=>Catalog,ne:()=>DataCatalog,k1:()=>s});const n=new(i(25799).Z)("Subscription");class Catalog{constructor(e,t,i){this.watchedData=e,this.registerSubscription=t,this.unregisterSubscription=i}createSubscription(e,t){return new Subscription((()=>this.registerSubscription(e)),(()=>this.unregisterSubscription(e)),t)}getData(){return this.watchedData()}}class DataCatalog{constructor(e,t,i){this.watchedData=e,this.registerSubscription=t,this.unregisterSubscription=i}createSubscription(e,t){const i=()=>e(this.watchedData());return new Subscription((()=>this.registerSubscription(i)),(()=>this.unregisterSubscription(i)),t)}getData(){return this.watchedData()}}class Subscription{constructor(e,t,i=!1,n=""){this.startSubscription=e,this.endSubscription=t,this.id=n,this.isSubbed=!1,i&&this.renew()}renew(){this.isSubbed?n.debugWarn(`Duplicate subscription renew ${this.id}`):(this.startSubscription(),this.isSubbed=!0)}cancel(){this.isSubbed&&(this.endSubscription(),this.isSubbed=!1)}get active(){return this.isSubbed}}function s(e,t,i=!0,n=""){return new Subscription(e,t,i,n)}},46162:(e,t,i)=>{"use strict";i.d(t,{p$:()=>s,TS:()=>o,br:()=>r,NK:()=>a,hj:()=>l});const n=e=>"propertyObservers"===e||"changeObservers"===e||"isObservable"===e||"childChangeFunctions"===e||"isObservableProxy"===e||"diffRoot"===e||"elementChangedHandlers"===e||"knownKeysMap"===e||"knownKeysList"===e||"isVector2"===e||"isVector3"===e||"isQuaternion"===e||"onPropertyChanged"===e||"removeOnPropertyChanged"===e||"onChanged"===e||"target"===e,s=(e,t=[])=>{if(void 0!==e){if(e in t)return{};if(e instanceof Date)return new Date(e);if(null===e)return null;if(e.deepCopy)return e.deepCopy();if(e.isQuaternion)return{x:e.x,y:e.y,z:e.z,w:e.w};if("object"==typeof e){const i=Array.isArray(e)||ArrayBuffer.isView(e)?[]:{};for(const o in e){if(n(o))continue;const r=e[o];r instanceof Date?i[o]=new Date(r):"function"!=typeof r&&(i[o]="object"==typeof r?s(r,t.concat(e)):r)}return i}return e}},o=(e,t)=>{for(const i in t){if("function"==typeof t[i])continue;if(n(i)&&!e.hasOwnProperty(i))continue;const r=t[i];if(e.hasOwnProperty(i)){const t=e[i];(null===t?null:typeof t)!==(null===r?null:typeof r)?e[i]=s(r):"object"==typeof t?t instanceof Date?e[i]=new Date(r):o(t,r):e[i]=r}else e[i]=s(r)}},r=(e,t,i=!1)=>{const n={};for(const s in e){const o=e[s],l=t[s];a(o,l)&&(void 0===o||void 0===l||typeof o!=typeof l||"object"!=typeof o?n[s]=l:Array.isArray(l)?a(o,l)&&(n[s]=l):n[s]=i?l:r(o,l))}for(const i in t)i in e||(n[i]=t[i]);return n},a=(e,t)=>{if(null===e||"object"!=typeof e)return e!==t;if(!t)return!0;for(const i in t)if(!(i in e))return!0;for(const i in e)if(a(e[i],t[i]))return!0;return!1};function l(e){return"number"==typeof e}},51090:(e,t,i)=>{"use strict";var n;i.d(t,{h:()=>n}),function(e){e.NOTE="note",e.COMMENT="comment",e.MATTERTAG="mattertag"}(n||(n={}))},61956:(e,t,i)=>{"use strict";i.d(t,{I:()=>Color});var n=i(2212);class Color{}Color.MP_BRAND=new n.Color("rgb(255, 49, 88)"),Color.MATTERTAG_BLUE=new n.Color("rgb(3, 104, 125)"),Color.WHITE=new n.Color("rgb(255, 255, 255)"),Color.BLACK=new n.Color("rgb(0, 0, 0)")},64630:(e,t,i)=>{"use strict";var n;i.d(t,{Z:()=>s}),function(e){e[e.GL_TEXTURE_CUBE_MAP_POSITIVE_X=0]="GL_TEXTURE_CUBE_MAP_POSITIVE_X",e[e.GL_TEXTURE_CUBE_MAP_NEGATIVE_X=1]="GL_TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.GL_TEXTURE_CUBE_MAP_POSITIVE_Y=2]="GL_TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.GL_TEXTURE_CUBE_MAP_NEGATIVE_Y=3]="GL_TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.GL_TEXTURE_CUBE_MAP_POSITIVE_Z=4]="GL_TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.GL_TEXTURE_CUBE_MAP_NEGATIVE_Z=5]="GL_TEXTURE_CUBE_MAP_NEGATIVE_Z"}(n||(n={}));const s=n},20599:(e,t,i)=>{"use strict";var n;i.d(t,{z:()=>n}),function(e){e[e.boundingSkybox=-100]="boundingSkybox",e[e.default=0]="default",e[e.ghostFloor=3]="ghostFloor",e[e.panoMarker=4]="panoMarker",e[e.reticule=5]="reticule",e[e.grid=5]="grid",e[e.pins360=6]="pins360",e[e.portals=9]="portals",e[e.rotators=10]="rotators",e[e.pins=14]="pins",e[e.pinSelectedHalo=15]="pinSelectedHalo",e[e.lines=20]="lines",e[e.endpoints=21]="endpoints",e[e.labels=22]="labels",e[e.colorOverlay=1e3]="colorOverlay"}(n||(n={}))},74674:(e,t,i)=>{"use strict";var n;i.d(t,{C:()=>n}),function(e){e.TEXT="text",e.LINK="link",e.HASH="hash",e.USER="user"}(n||(n={}))},27829:(e,t,i)=>{"use strict";i.d(t,{f:()=>Vectors,e:()=>n});var n,s=i(2212);class Vectors{}Vectors.UP=new s.Vector3(0,1,0),Vectors.DOWN=new s.Vector3(0,-1,0),Vectors.LEFT=new s.Vector3(-1,0,0),Vectors.RIGHT=new s.Vector3(1,0,0),Vectors.FORWARD=new s.Vector3(0,0,-1),Vectors.BACK=new s.Vector3(0,0,1),Vectors.ZERO=new s.Vector3(0,0,0),Vectors.UNIT=new s.Vector3(1,1,1),Vectors.HORIZONTAL_PLANE=new s.Vector3(1,0,1),function(e){e.NONE="NONE",e.UP="UP",e.DOWN="DOWN",e.LEFT="LEFT",e.RIGHT="RIGHT",e.FORWARD="FORWARD",e.BACK="BACK",e.ZERO="ZERO",e.UNIT="UNIT",e.HORIZONTAL_PLANE="HORIZONTAL_PLANE"}(n||(n={}))},17617:(e,t,i)=>{"use strict";i.d(t,{y:()=>BaseException});class BaseException extends Error{constructor(e){super(e),this.name="BaseException",Object.setPrototypeOf(this,new.target.prototype)}}},83852:(e,t,i)=>{"use strict";i.d(t,{n:()=>NotImplementedError});var n=i(17617);class NotImplementedError extends n.y{constructor(e="Not implemented"){super(e),this.name="NotImplemented"}}},31260:(e,t,i)=>{"use strict";i.d(t,{Z:()=>OutOfRangeException});var n=i(17617);class OutOfRangeException extends n.y{constructor(e="Out of range"){super(e),this.name="OutOfRangeException"}}},7943:(e,t,i)=>{"use strict";i.d(t,{S:()=>n});var n,s,o=i(67125);!function(e){e.sessionObjectExtract=function(e,t){return i=>t(i?i[e]:null)},e.sessionObjectMap=function(e,t,i){return n=>i(n?{[t]:n[e]}:null)},e.sessionCollectionMap=function(e,t){return i=>{if(i){const n={},s=i[e];if(!(s&&s instanceof Array))return t(null);for(const e of s){if(!e.sid){let t;do{t=(0,o.f)(11)}while(s.find((e=>e.sid===t)));e.sid=t}n[e.sid]=e}return t(n)}return t(null)}}}(n||(n={})),function(e){e.sessionObjectMap=function(e,t,i){return(n,s)=>{const o=i(n,s);return o?{[t]:o[e]}:null}}}(s||(s={}))},15119:(e,t,i)=>{"use strict";i.d(t,{j:()=>o,Z:()=>WorkshopSessionStore});var n=i(80034);const s=new(i(25799).Z)("session");var o;!function(e){e.WS3_Config="WS3_Config",e.WS3_Sweeps="WS3_Sweeps",e.WS3_Measurements="WS3_Measurements",e.Blurs="Blurs",e.Model="Model",e.FloorNames="FloorNames",e.Sweeps="Sweeps",e.Highlights="Highlights",e.Labels="Labels",e.Mattertags="Mattertags"}(o||(o={}));class WorkshopSessionStore extends n.yh{constructor(e,t){super(e),this.config=e,this.sessionKey=t}async create(e){throw Error("Not implemented")}async update(e,t){const{serialize:i}=this.config,o=i(e,t);if(!o)return void s.info("not updating",{data:e,diff:t,newData:o});this.config.cachedData||(this.config.cachedData={data:{}}),this.config.cachedData.data||(this.config.cachedData.data={}),this.config.cachedData.data[this.sessionKey]||(this.config.cachedData.data[this.sessionKey]={}),this.config.cachedData.data[this.sessionKey]=o;const r=Object.assign(Object.assign({},this.options),{body:this.config.cachedData.data[this.sessionKey]});return this.config.queue.request(this.config.httpMethod||n.w$.POST,`${this.config.path}/${this.sessionKey}`,r)}async delete(e){this.config.cachedData&&this.config.cachedData.data&&(this.config.cachedData.data[this.sessionKey]={});const t=Object.assign(Object.assign({},this.options),{responseType:""});return this.config.queue.delete(`${this.config.path}/${this.sessionKey}`,t)}}},86785:(e,t,i)=>{"use strict";i.d(t,{w:()=>ModelApiClient});var n=i(71439),s=i(70655),o=i(81707),r=i(80496);var a=i(51770),l=i(26149),c=i(25799),h=i(90778),d=i(17617);class MdsException extends d.y{constructor(e="MDS Exception"){super(e),this.name="MdsException"}}var u=i(50301);const p=new c.Z("model-api-client");class ModelApiClient{constructor(e={}){const t=e.baseUrl||window.location.origin;this.graphUrl=e.url||`${t}${u.f}`,p.debug(`Initialized Model API client for ${this.graphUrl}`);const i=(0,n.createHttpLink)({uri:this.graphUrl}),a=(c=(e,{headers:t})=>{const i=(0,l.PW)(this.graphUrl);return{headers:Object.assign(Object.assign({},t),{authorization:i})}},new o.i0((function(e,t){var i=(0,s._T)(e,[]);return new r.y$((function(n){var s;return Promise.resolve(i).then((function(t){return c(t,e.getContext())})).then(e.setContext).then((function(){s=t(e).subscribe({next:n.next.bind(n),error:n.error.bind(n),complete:n.complete.bind(n)})})).catch(n.error.bind(n)),function(){s&&s.unsubscribe()}}))})));var c;this.client=new n.fe({link:a.concat(i),cache:new n.h4})}async query(e,t,i={}){const n=Object.assign(Object.assign({errorPolicy:"all"},i),{query:e,variables:t,fetchPolicy:"no-cache"});return this.client.query(n).then((e=>{const{data:t,errors:i}=e;return{data:t,errors:i}})).catch((e=>{throw p.error(e),new MdsException}))}async mutate(e,t,i={}){const n=Object.assign(Object.assign({errorPolicy:"all"},i),{mutation:e,variables:t});return this.client.mutate(n).then((e=>{const{data:t,errors:i}=e;return{data:t,errors:i}})).catch((e=>{throw p.error(e),new MdsException}))}async upload(e,t,i){const n={};let s=0;(0,a.yW)(i,((e,t,i)=>{if(e&&((o=e).filename&&o.blob&&o.blob instanceof Blob)){const o="file"+s++;n[o]=e,i[t]=`multipart:${o}`}var o}));const o=new FormData;o.append("query",(0,h.S)(e)),o.append("operation",t),o.append("variables",JSON.stringify(i));for(const[e,t]of Object.entries(n))o.append(e,t.blob,t.filename);const r=await fetch(this.graphUrl,{method:"POST",body:o});try{return r.json()}catch(e){throw p.error(e),new MdsException("Could not upload to MDS")}}}ModelApiClient.version="2020.05.28"},32143:(e,t,i)=>{"use strict";var n;i.d(t,{G:()=>n}),function(e){e.UPLOAD="upload",e.EXTERNAL="external"}(n||(n={}))},48520:(e,t,i)=>{"use strict";var n;i.d(t,{E:()=>n}),function(e){e.IMAGE="image",e.PDF="pdf",e.VIDEO="video",e.RICH="rich",e.ZIP="zip"}(n||(n={}))},41964:(e,t,i)=>{"use strict";var n;i.d(t,{L:()=>n}),function(e){e.PHOTO="photo",e.VIDEO="video",e.RICH="rich"}(n||(n={}))},19673:(e,t,i)=>{"use strict";var n;i.d(t,{Y:()=>n}),function(e){e.LEFT="left",e.RIGHT="right",e.AUTO="auto"}(n||(n={}))},99555:(e,t,i)=>{"use strict";var n;i.d(t,{b:()=>n}),function(e){e.UNPLACED="unplaced",e.AUTO="auto",e.MANUAL="manual"}(n||(n={}))},60268:(e,t,i)=>{"use strict";var n;i.d(t,{B:()=>n}),function(e){e.PHOTO2D="photo2D",e.EQUIRECTANGULAR="equirectangular"}(n||(n={}))},62749:(e,t,i)=>{"use strict";var n;i.d(t,{w:()=>n}),function(e){e.PANORAMA="panorama",e.FLOORPLAN="floorplan",e.DOLLHOUSE="dollhouse",e.MESH="mesh"}(n||(n={}))},50301:(e,t,i)=>{"use strict";i.d(t,{f:()=>n,A:()=>s});const n="/api/mp/models/graph",s="features/mds_prefetch"},17423:(e,t,i)=>{"use strict";var n;i.d(t,{K:()=>n}),function(e){e.Segment="segment",e.Logging="logging",e.Matterport="mp"}(n||(n={}))},58931:(e,t,i)=>{"use strict";i.d(t,{H:()=>p});var n=i(17423),s=i(25799);const o=new s.Z("segment");const r=new s.Z("log-analytics");var a=i(62367),l=i(32020),c=i(21265);const h=new s.Z("mp-analytics"),d="ajs_anonymous_id",u="sc_anonymous_id";const p={[n.K.Segment]:{class:class SegmentAnalyticsProvider{constructor(e){this.token=e,this.endpointType=n.K.Segment}init(e,t){return this.options=e,this.context=t,this.token?(window.analytics&&window.analytics.initialize&&(window.analytics=null),window.analytics||function(){var e=window.analytics=window.analytics||[];if(!e.initialize)if(e.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{e.invoked=!0,e.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on"],e.factory=function(t){return function(){var i=Array.prototype.slice.call(arguments);return i.unshift(t),e.push(i),e}};for(var t=0;t<e.methods.length;t++){var i=e.methods[t];e[i]=e.factory(i)}e.load=function(t,i){var n=document.createElement("script");n.type="text/javascript",n.async=!0,n.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(n,s),e._loadOptions=i},e.SNIPPET_VERSION="4.1.0"}}(),window.analytics.load(this.token),new Promise(((e,t)=>{window.analytics.ready(e)}))):Promise.resolve()}identify(e){window.analytics.identify(e.id,{first_name:e.firstName,last_name:e.lastName,email:e.email})}track(e,t){s.Z.level>=3&&o.debug(e,t?JSON.stringify(t).replace('\\"','"'):t),t=Object.assign(t||{},this.options);try{window.analytics.track(e,t,this.context)}catch(t){o.error(`Failed to send data to segment for ${e}`)}}trackAsync(e,t){if(t=t||{},navigator.sendBeacon)try{navigator.sendBeacon("https://api.segment.io/v1/t",JSON.stringify({event:e,anonymousId:window.analytics.user().anonymousId(),properties:Object.assign({data:t},this.options),writeKey:this.token,sentAt:Date.now(),type:"track",context:this.context}))}catch(e){o.error("Failed to send async segment request")}}},key:"segment_key",url:null},[n.K.Logging]:{class:class LoggingAnalyticsProvider{init(e,t){return r.debug("logging analytics to console",{options:e,context:t}),Promise.resolve()}identify(e){r.debug("identify as",e)}track(e,t){r.debug({eventName:e,data:t})}trackAsync(e,t){r.debug({eventName:e,data:t})}},key:null,url:null},[n.K.Matterport]:{class:class MatterportAnalyticsProvider{constructor(e,t,i){this.token=e,this.url=t,this.queue=i,this.segmentStylePayload=(e,t,i)=>({timestamp:(0,l.U)(new Date),integrations:{},context:this.segmentStyleContext(i),properties:t,event:e,messageId:(0,a.DM)(),anonymousId:this.anonymousId,type:"track",userId:this.user?this.user.id:null,sentAt:(0,l.U)(new Date)}),this.segmentStyleContext=e=>{const t={page:{path:window.location.pathname,referrer:window.document.referrer,search:window.location.search,title:window.document.title,url:window.location.href},userAgent:navigator.userAgent,library:{name:"showcase",version:"1"},campaign:{}};return Object.assign(Object.assign({},e),t)};const n=(0,c.fp)(u);if(n)this.anonymousId=n;else{const e=(0,c.$K)(d);this.anonymousId=e?e.replace(/%22/g,""):(0,a.DM)(),(0,c.m8)(u,this.anonymousId)}this.headers={"X-API-Key":this.token,"Content-Type":"application/json",Accept:"application/json"}}init(e,t){return this.options=e,this.context=t,h.debug("init",{options:this.options,context:this.segmentStyleContext(this.context)}),Promise.resolve()}identify(e){h.debug("identify as",e),this.user=e}track(e,t){s.Z.level>=3&&h.debug(e,t?JSON.stringify(t).replace('\\"','"'):t),t=Object.assign(t||{},this.options);const i=this.segmentStylePayload(e,t,this.context);this.queue.post(this.url,{body:i,headers:this.headers})}trackAsync(e,t){if(t=Object.assign(t||{},this.options),navigator.sendBeacon)try{const i=this.segmentStylePayload(e,t,this.context);navigator.sendBeacon(`${this.url}?api_key=${this.token}`,JSON.stringify(i))}catch(e){h.error("Failed to sendBeacon analytics request")}}},key:"analytics_mp_key",url:"analytics_mp_url"}}},13931:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Analytics:()=>AnalyticsModule,default:()=>r});var n=i(58931),s=i(54122),o=i(62367);class AnalyticsModule extends s.Y{constructor(){super(...arguments),this.name="analytics",this.endpoints=[],this.loaded=!1,this.bufferedData=[],this.track=(e,t)=>this.loaded?(0,o.gw)(0).then((()=>{this.endpoints.forEach((i=>{i.track(e,t)}))})):(this.bufferedData.push({event:e,data:t}),Promise.resolve()),this.trackAsync=(e,t)=>{this.loaded?this.endpoints.forEach((i=>{i.trackAsync(e,t)})):this.bufferedData.push({event:e,data:t})}}async load(e,t,i,s,o){this.loaded=!1;for(const r of e){const{provider:e,token:a,url:l}=r;if(void 0===n.H[e])continue;const c=new(0,n.H[e].class)(a,l,t);await c.init(i,s),o&&o.loggedIn&&c.identify(o),this.endpoints.push(c),this.loaded=!0}return this.loaded&&this.flushBufferedData(),this.loaded}flushBufferedData(){for(const e of this.bufferedData)this.endpoints.forEach((t=>{t.track(e.event,e.data)}));this.bufferedData.length=0}}const r=AnalyticsModule},90991:(e,t,i)=>{"use strict";i.d(t,{A:()=>AnnotationsViewData});var n=i(19413),s=i(5442);class AnnotationsViewData extends n.V{constructor(){super(),this.name="annotations-view-data",this.listIndexObservable=(0,s.Y)(-1),this.searchBlockObservable=(0,s.Y)(null)}setListIndex(e){this.listIndexObservable.value=e}get listIndex(){return this.listIndexObservable.value}onListIndexChanged(e){return this.listIndexObservable.onChanged(e)}setSearchBlock(e){this.searchBlockObservable.value=e}get searchBlock(){return this.searchBlockObservable.value}onSearchBlockChanged(e){return this.searchBlockObservable.onChanged(e)}}},43098:(e,t,i)=>{"use strict";i.d(t,{R:()=>AnnotationSearchCommand,B:()=>CancelAnnotationSearchCommand});var n=i(99681);class AnnotationSearchCommand extends n.m{constructor(e){super(),this.payload={searchBlock:e}}}class CancelAnnotationSearchCommand extends n.m{constructor(){super()}}},32052:(e,t,i)=>{"use strict";i.r(t),i.d(t,{AnnotationSearchCommand:()=>r.R,AnnotationSearchToggledMessage:()=>AnnotationSearchToggledMessage,AnnotationsViewData:()=>o.A,CancelAnnotationSearchCommand:()=>r.B,default:()=>a});var n=i(54122),s=i(93528);class AnnotationSearchToggledMessage extends s.v{constructor(e){super(),this.searching=e}}var o=i(90991),r=i(43098);class AnnotationsModule extends n.Y{constructor(){super(...arguments),this.name="annotations",this.cancelSearch=async()=>{this.viewData.searchBlock&&(this.viewData.setSearchBlock(null),this.engine.broadcast(new AnnotationSearchToggledMessage(!1)))},this.searchAnnotations=async e=>{const t=e.searchBlock;this.viewData.setSearchBlock(t),this.engine.broadcast(new AnnotationSearchToggledMessage(!0))}}async init(e,t){this.viewData=new o.A,this.engine=t,t.market.register(this,o.A,this.viewData),this.bindings.push(t.commandBinder.addBinding(r.R,this.searchAnnotations),t.commandBinder.addBinding(r.B,this.cancelSearch))}dispose(e){this.bindings.forEach((e=>{e.cancel()})),this.bindings=[],this.cancelSearch(),super.dispose(e)}onUpdate(){}}const a=AnnotationsModule},68399:(e,t,i)=>{"use strict";var n;i.d(t,{X:()=>n}),function(e){e.ACCESS_TOKEN_REQUIRED="object.access.token.required",e.FORBIDDEN="spaces.public.access.password.forbidden",e.INVALID_PASSWORD="spaces.public.access.invalid_password",e.TOO_MANY_ATTEMPTS="spaces.public.access.too_many_attempts",e.UNAUTHORIZED="user.unauthorized"}(n||(n={}))},1143:(e,t,i)=>{"use strict";i.d(t,{Ad:()=>s,iF:()=>o,O7:()=>r});let n=null;const s=e=>{n=e.applicationKey},o=e=>{n&&(e.headers||(e.headers={}),r(e.headers))},r=e=>{n&&(e["x-matterport-application-key"]=n)}},17882:(e,t,i)=>{"use strict";var n;i.d(t,{s:()=>n}),function(e){e.INVALID_CREDENTIALS="invalidcredentials",e.TOO_MANY_ATTEMPTS="toomanyattempts",e.UNKNOWN="unknown"}(n||(n={}))},33886:(e,t,i)=>{"use strict";i.d(t,{L:()=>MpPasswordAuthentication});var n=i(25799),s=i(17882),o=i(68399),r=i(22135),a=i(1143);const l=new n.Z("mp-password-authentication");class MpPasswordAuthentication{constructor(e=window.location.origin){this.baseUrl=e,this.errorType=s.s.UNKNOWN}async authenticate(e,t){if(!e.match(/[a-zA-Z0-9]+/))return l.error(`Invalid Model ID ${e}`),!1;const i=`${this.baseUrl}/api/v2/models/${e}/public-access/`;return this.fetchToken(i,t).then((async e=>{let t={};return e&&(t=await e.json(),e.ok&&t.token)?(this.login(t.token),!0):(this.errorType=MpPasswordAuthentication.getErrorType(t.code),this.logout(),!1)}))}isAuthenticated(){return void 0!==MpPasswordAuthentication.token}login(e){MpPasswordAuthentication.token=e}logout(){MpPasswordAuthentication.token=void 0}getAuthorizationHeader(e){return e&&r.b.some((t=>t.test(e)))&&MpPasswordAuthentication.token?`Matterport-Object-Access ${MpPasswordAuthentication.token}`:""}async fetchToken(e,t){const i=JSON.stringify({password:t}),n={"Content-Type":"application/json"};return(0,a.O7)(n),fetch(e,{method:"POST",cache:"no-cache",headers:n,body:i})}static getErrorType(e){switch(e){case o.X.TOO_MANY_ATTEMPTS:return s.s.TOO_MANY_ATTEMPTS;case o.X.INVALID_PASSWORD:return s.s.INVALID_CREDENTIALS}return s.s.UNKNOWN}}},26149:(e,t,i)=>{"use strict";i.d(t,{PW:()=>s});var n=i(22135);const s=(e,t=n.F)=>t.map((t=>t.getAuthorizationHeader(e))).find(Boolean)||""},22135:(e,t,i)=>{"use strict";i.d(t,{F:()=>o,b:()=>r});var n=i(33886),s=i(21265);class MpModelTokenAuthentication{constructor(){const e=(0,s.hu)("auth","");this.authenticate(e)}isAuthenticated(){return!!MpModelTokenAuthentication.token}authenticate(e){return!(!e||"string"!=typeof e)&&(MpModelTokenAuthentication.token=e.replace(","," "),!0)}getAuthorizationHeader(e){return MpModelTokenAuthentication.token?MpModelTokenAuthentication.token:""}}const o=[new MpModelTokenAuthentication,new n.L],r=[/^https?:\/\/localhost(:[0-9]+)?\/api/,/^https?:\/\/[^\/]*\.matterport.com\/api/]},87131:(e,t,i)=>{"use strict";var n,s;i.d(t,{SL:()=>n,AB:()=>s,eE:()=>o,Qf:()=>r}),function(e){e.BASE="base",e.STANDARD="standard",e.HIGH="high",e.ULTRAHIGH="ultrahigh"}(n||(n={})),function(e){e[e.BASE=512]="BASE",e[e.STANDARD=1024]="STANDARD",e[e.HIGH=2048]="HIGH",e[e.ULTRAHIGH=4096]="ULTRAHIGH"}(s||(s={}));const o={[n.BASE]:s.BASE,[n.STANDARD]:s.STANDARD,[n.HIGH]:s.HIGH,[n.ULTRAHIGH]:s.ULTRAHIGH},r={[s.BASE]:n.BASE,[s.STANDARD]:n.STANDARD,[s.HIGH]:n.HIGH,[s.ULTRAHIGH]:n.ULTRAHIGH}},41446:(e,t,i)=>{"use strict";i.d(t,{m:()=>r});var n=i(64630),s=i(31260);const o={0:n.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_Y,1:n.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_Z,2:n.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_X,3:n.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_Z,4:n.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_X,5:n.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_Y},r=e=>{if(e<0||e>5)throw new s.Z("mapFaceToCubemapFace() -> face must be in the range [0, 5]");return o[e]}},62431:(e,t,i)=>{"use strict";i.d(t,{af:()=>PlayerOptionsData,Mc:()=>n,gx:()=>s});var n,s,o=i(19413),r=i(78909),a=i(78383),l=i(19334);class PlayerOptionsData extends o.V{constructor(e={}){super(),this.name="player-options",this.options=new PlayerOptions(e)}resetDefaultTourOptions(){this.options.fast_transitions=l.LI,this.options.transition_speed=l.p$,this.options.transition_time=l.rd,this.options.pan_speed=l.tu,this.options.dollhouse_pan_speed=l.nr,this.options.zoom_duration=l.we,this.options.pan_angle=l.Cj,this.options.pan_direction=l.y6,this.options.commit()}}class PlayerOptions extends r.T{constructor(e){super(),this.presented_by=!1,this.highlight_reel=!0,this.floor_plan=!0,this.tour_buttons=!0,this.labels=!0,this.labels_dh=!0,this.floor_select=!0,this.measurements=!0,this.measurements_saved=!0,this.dollhouse=!0,this.contact_email=!1,this.address=!1,this.contact_name=!1,this.model_summary=!1,this.contact_phone=!1,this.model_name=!1,this.external_url=!1,this.unit_type=n.USFractional,this.background_color=a.z.default,this.fast_transitions=l.LI,this.transition_speed=l.p$,this.transition_time=l.rd,this.pan_speed=l.tu,this.dollhouse_pan_speed=l.nr,this.zoom_duration=l.we,this.pan_angle=l.Cj,this.pan_direction=l.y6,e&&this.copy(e)}copy(e){this.presented_by=!!e.presented_by,this.highlight_reel=!!e.highlight_reel,this.floor_plan=!!e.floor_plan,this.tour_buttons=!!e.tour_buttons,this.labels=!!e.labels,this.dollhouse=!!e.dollhouse,this.fast_transitions=!!e.fast_transitions,this.contact_email=!!e.contact_email,this.address=!!e.address,this.contact_name=!!e.contact_name,this.model_summary=!!e.model_summary,this.contact_phone=!!e.contact_phone,this.model_name=!!e.model_name,this.external_url=!!e.external_url,void 0!==e.measurements&&(this.measurements=e.measurements),void 0!==e.labels_dh&&(this.labels_dh=e.labels_dh),void 0!==e.floor_select&&(this.floor_select=e.floor_select),void 0!==e.measurements_saved&&(this.measurements_saved=e.measurements_saved),void 0!==e.unit_type&&(this.unit_type=e.unit_type),void 0!==e.background_color&&void 0!==a.z[e.background_color]&&(this.background_color=e.background_color),void 0!==e.transition_speed&&(this.transition_speed=e.transition_speed),void 0!==e.transition_time&&(this.transition_time=e.transition_time),void 0!==e.pan_speed&&(this.pan_speed=e.pan_speed),void 0!==e.dollhouse_pan_speed&&(this.dollhouse_pan_speed=e.dollhouse_pan_speed),void 0!==e.zoom_duration&&(this.zoom_duration=e.zoom_duration),void 0!==e.pan_angle&&(this.pan_angle=e.pan_angle),void 0!==e.pan_direction&&(this.pan_direction=e.pan_direction)}}!function(e){e.USFractional="imperial",e.Metric="metric"}(n||(n={})),function(e){e.PresentedBy="presented_by",e.HighlightReel="highlight_reel",e.FloorPlan="floor_plan",e.TourButtons="tour_buttons",e.Labels="labels",e.LabelsDollhouse="labels_dh",e.Measurements="measurements",e.FloorSelect="floor_select",e.SavedMeasurements="measurements_saved",e.Dollhouse="dollhouse",e.InstantTransitions="fast_transitions",e.TransitionSpeed="transition_speed",e.TransitionTime="transition_time",e.PanSpeed="pan_speed",e.DollhousePanSpeed="dollhouse_pan_speed",e.ZoomDuration="zoom_duration",e.PanAngle="pan_angle",e.PanDirection="pan_direction",e.Units="unit_type",e.DetailsEmail="contact_email",e.DetailsAddress="address",e.DetailsName="contact_name",e.DetailsSummary="model_summary",e.DetailsPhone="contact_phone",e.DetailsModelName="model_name",e.DetailsExternalUrl="external_url",e.BackgroundColor="background_color"}(s||(s={}))},5587:(e,t,i)=>{"use strict";i.d(t,{Z:()=>SweepTextureLoader});var n=i(2212),s=i(25799),o=i(87131),r=i(62367);const a=new s.Z("api"),l={[o.SL.BASE]:256,[o.SL.STANDARD]:1024,[o.SL.HIGH]:2048,[o.SL.ULTRAHIGH]:4096};class SweepTextureLoader{constructor(e){this.urls=e,this.sweepCubeTextures={}}useTexture(e){const t=this.getTexture(e);if(!t)throw Error(`Texture for sweep ${e} not loaded before using`);return t}loadFace(e,t,i,s){return this.loadFaceImage(e,t,i,s).then((e=>{const t=new n.Texture(e);return t.needsUpdate=!0,t}))}load(e,t=o.SL.STANDARD){const i=this.sweepCubeTextures[e.id];if(i)return a.debug("Skipping load of pano, already loaded"),new Promise((function(e,t){e(i)}));const s=[2,4,0,5,1,3].map((i=>this.loadFaceImage(e,t,i))),r=Promise.all(s).then((t=>{const i=new n.CubeTexture(t);return i.flipY=!1,i.needsUpdate=!0,this.sweepCubeTextures[e.id]=i,i}));return r.catch((()=>{a.error(`Downloading cubemap for pano ${e.id} failed`)})),r}unload(e){const t=this.sweepCubeTextures[e];if(!t)throw Error(`Texture for sweep ${e} not loaded before unloading`);t.dispose(),this.sweepCubeTextures[e]=null}unloadAll(e){const t=(0,r.ow)(e);for(const e of Object.keys(this.sweepCubeTextures))this.sweepCubeTextures[e]&&!t[e]&&this.unload(e)}async loadFaceImage(e,t,i,n){const s=l[t],o=await e.getFaceUrl(t,i);return this.urls.getImageBitmap(o,s,s,n)}getTexture(e){return this.sweepCubeTextures[e]}}},78383:(e,t,i)=>{"use strict";i.d(t,{K:()=>s,z:()=>o});const n={bgPrimary:"#0F1011",bgSecondary:"#1e2023",gridPrimary:"#2d3035",gridSecondary:"#171a1c"},s={black:n,grey:{bgPrimary:"#c9cbcc",bgSecondary:"#9d9d9e",gridPrimary:"#c9cbcc",gridSecondary:"#b0b1b1"},white:{bgPrimary:"#fcfdff",bgSecondary:"#ced0d3",gridPrimary:"#fcfdff",gridSecondary:"#e2e3e5"},default:n};var o;!function(e){e.black="black",e.grey="grey",e.white="white",e.default="black"}(o||(o={}))},76598:(e,t,i)=>{"use strict";i.d(t,{GT:()=>UnauthorizedException,V2:()=>ForbiddenException,TR:()=>NotFoundException});var n=i(17617);class ApiException extends n.y{constructor(e="Api Exception"){super(e),this.name="ApiException"}}class UnauthorizedException extends ApiException{constructor(e="Unauthorized"){super(e),this.name="Unauthorized"}}class ForbiddenException extends ApiException{constructor(e="Forbidden"){super(e),this.name="Forbidden"}}class NotFoundException extends ApiException{constructor(e="Not Found"){super(e),this.name="NotFound"}}},7839:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var n=i(20331);async function s(e){return e.get("https://static.matterport.com/geoip/",{responseType:"json",priority:n.ru.LOW})}},25290:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ApiClient});var n=i(25799),s=i(44266),o=i(20331),r=i(68399),a=i(1143),l=i(26149),c=i(76598);class Organization{constructor(e){this.blurEnabled=!1,e&&Object.assign(this,e)}}var h,d=i(7839),u=i(21265);class User{constructor(e){this.loggedIn=!1,this.flags=new Set,this.memberships=[],e&&Object.assign(this,e)}getFlags(e=""){if(this.memberships){const e=(0,u.hu)("organization","");for(const t of this.memberships)if(""===e||t.organizationId===e)for(const e of t.flags)this.flags.add(e)}const t=new Set;return this.flags.forEach((i=>{if(0===i.indexOf(e)){const n=i.replace(e,"");t.add(n)}})),t}getMembershipFlags(e){const t=this.getMembership(e);return t?t.flags:[]}getMembership(e){return this.memberships.find((t=>t.organizationId===e))}hasMembershipFlag(e,t){return this.getMembershipFlags(e).includes(t)}hasMembership(e){return this.memberships.some((t=>t.organizationId===e))}}class Membership{constructor(e){e&&Object.assign(this,e)}}!function(e){function t(e){return e.split(".").reduce(((e,t)=>{const i=parseInt(t,10);return isNaN(i)||e.push(i),e}),[])}function i(e,i){const n=t(e),s=t(i);for(let e=0;e<n.length;e++){if(e>=s.length)return 1;if(n[e]!==s[e])return n[e]>s[e]?1:-1}return s.length>n.length?-1:0}e.parse=t,e.gt=function(e,t){return 1===i(e,t)},e.lt=function(e,t){return-1===i(e,t)},e.eq=function(e,t){return 0===i(e,t)},e.compare=i}(h||(h={}));const p=new n.Z("user.serializers");function m(e,t="3.1.44.22-0-g33607d0d2"){const i=[];for(let n of e){const e=n.match(/^.*\-(\d+(?:\.\d+)*)$/);if(e&&e[1]){if(n=n.replace(/-(\d+(?:\.\d+)*)$/,""),h.lt(t,e[1])){p.debug(`Dropping feature flag ${n}, version >= ${e[1]} required`);continue}p.debug(`Enabled versioned feature flag ${n}`)}i.push(n)}return i}const g=new n.Z("api"),f=Object.freeze({cacheClearTimeout:6e4,retryTimeout:1e3});class Api{constructor(e,t={},i=window.location.origin){this.prefetchedData=t,this.baseUrl=i,this._configCache={},this._userCache={},this._organizationCache={},e||(e=new o.gO({retries:0})),this.queue=e,setTimeout((()=>{this.prefetchedData={}}),f.cacheClearTimeout)}async init(e){const t=[this.getUser().then((e=>this.user=e))];e&&t.push(this.getConfigs(e)),await Promise.all(t)}get(e,t){if(t&&t.prefetchFrom&&this.prefetchedData[t.prefetchFrom])return Promise.resolve(this.prefetchedData[t.prefetchFrom]);const i=this.addAuthToOptions(t,e);return(0,a.iF)(i),this.queue.get(e,i).then((e=>{if(null===e)throw Error("Data from get was null, possibly unparsable JSON");return e}))}addAuthToOptions(e,t){return this.authToken||(this.authToken=(0,l.PW)(t)),Object.assign(Object.assign({},e),{auth:this.authToken})}getImage(e,t){return this.get(e,Object.assign(Object.assign({},t),{responseType:"image"}))}async getImageBitmap(e,t,i,n={}){if("createImageBitmap"in window){const s=-1!==e.indexOf("?"),o=e+(s?"&":"?")+"imgopt=1",r=await this.get(o,Object.assign(Object.assign({},n),{responseType:"blob"}));return createImageBitmap(r,0,0,t,i,{imageOrientation:n.flipY?"flipY":"none"})}return this.getImage(e,n)}getImageViaBrowser(e,t=3){const i=new s.Q,n=new Image,o=this,r=()=>{o.getImageViaBrowser(e,t-1).then(i.resolve.bind(i)).progress(i.notify.bind(i)).catch(i.reject.bind(i))};return n.onerror=function(){t>0?setTimeout(r,1e3):i.reject()},n.onload=function(){i.resolve(n)},n.crossOrigin="anonymous",n.src=e,i.promise()}async getConfigs(e,t){if(e=e.toLowerCase(),!t&&this._configCache[e])return this._configCache[e];const i=t?{responseType:"json"}:{responseType:"json",prefetchFrom:"config"};let n={};const s=this.baseUrl+`/api/v1/config/${e}`;try{n=await this.get(s,i)}catch(e){g.warn(`Failed to load config from ${s}, ignoring`)}return t||(this._configCache[e]=n),n||{}}async getAppKey(e,t,i){if(""===e||""===t)return null;const n=await this.getConfigs(e,i);return n.hasOwnProperty(t)?n[t]:null}async getGeoIpLocation(){return(0,d.Z)(this.queue)}async modelExists(e,t={ignorePrefetch:!1}){if(e.length>20)return Promise.resolve(!0);const{ignorePrefetch:i}=t;if(!i&&this.prefetchedData&&this.prefetchedData.model){const{model:t}=this.prefetchedData;if(!t.sid&&t.has_public_access_password)throw new c.GT("Model requires a password");return t.sid===e}const n=`${this.baseUrl}/api/v2/models/${e}/`,s={"Content-Type":"application/json"},o=(0,l.PW)();o&&(s.Authorization=o),(0,a.O7)(s);return fetch(n,{method:"GET",headers:s}).then((async e=>{if(e.ok)return!0;const t=await e.json().catch((e=>({})));if(t&&t.code===r.X.ACCESS_TOKEN_REQUIRED)throw new c.GT("Access token required (401)");if(403===e.status)throw new c.V2("Access denied (403)");throw new c.TR("Model not found (404)")}))}getQueue(){return this.queue}async getOrganization(e){if(e in this._organizationCache)return this._organizationCache[e];const t=`${this.baseUrl}/api/v2/organizations/${e}`,i=await this.get(t,{responseType:"json"}).catch((e=>{g.error(e)}));let n=null;return i&&(n=new Organization({id:i.sid,name:i.company_name||"",blurEnabled:!!i.manual_blur})),this._organizationCache[e]=n,n}async getUser(e){if(e&&e in this._userCache)return this._userCache[e];const t=`${this.baseUrl}/api/v2/users/${e||"current"}`,i=function(e){if(!e)return new User;const t=(e.memberships||[]).map((t=>new Membership({userId:e.user_sid,organizationId:t.organization_sid,name:t.name,flags:m(t.flags||[])})));return new User({id:e.user_sid,firstName:e.first_name,lastName:e.last_name,email:e.email,loggedIn:e.is_authenticated,flags:new Set(m(e.flags)),memberships:t})}(await this.get(t,{responseType:"json"}).catch((e=>{g.error(e)})));return i.id&&(this._userCache[i.id]=i),i}}var v=i(54122);class ApiClient extends v.Y{constructor(){super(...arguments),this.name="api-client"}async init(e,t){this.api=new Api(e.queue,e.prefetchedData,e.baseUrl),await this.api.init(e.preloadConfig)}getApi(){return this.api}}},19334:(e,t,i)=>{"use strict";i.d(t,{gj:()=>o,LI:()=>r,p$:()=>a,rd:()=>l,tu:()=>c,nr:()=>h,we:()=>d,Cj:()=>u,y6:()=>p});var n=i(44228),s=i(27545);const o="TransitionType",r=!0,a=s.Mk,l=s.mL,c=s.pn,h=s.su,d=s._c,u=s.BA,p=n.kw.Auto},21636:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>AppContainerResizer});var n=i(54122),s=i(10396),o=i(21265),r=i(17617),a=i(93273),l=i(6201);class AppContainerResizeError extends r.y{}class AppContainerResizer extends n.Y{constructor(){super(...arguments),this.name="container-resizer",this.touchDevice=(0,o.Jm)(),this.timeout=0,this.keyboardFocused=!1,this.handleResize=e=>{this.keyboardFocused||(document.body.style.height=e.h+"px")},this.handleToolChange=e=>{!e.open&&this.keyboardFocused&&this.setKeyboardFocus(!1)},this.handleTextBoxFocus=e=>{this.setKeyboardFocus(e.focused)}}async init(e,t){if(!e.container)throw new AppContainerResizeError;this.appContainer=e.container,this.touchDevice&&(this.bindings.push((0,s.kp)(s.g_.RESIZE,this.handleResize),t.subscribe(a.S,this.handleTextBoxFocus),t.subscribe(l.Oj,this.handleToolChange)),this.handleResize((0,s.iv)()));for(const e of this.bindings)e.renew()}setKeyboardFocus(e){this.keyboardFocused=e,window.clearTimeout(this.timeout),this.keyboardFocused?(document.body.style.height="",this.timeout=window.setTimeout((()=>{document.documentElement.classList.add("keyboard-layout")}),300)):(document.documentElement.classList.remove("keyboard-layout"),this.appContainer.scrollTop=0)}}},93273:(e,t,i)=>{"use strict";i.d(t,{S:()=>TextBoxFocusMessage});var n=i(93528);class TextBoxFocusMessage extends n.v{constructor(e,t){super(),this.textElement=e,this.focused=t}}},98507:(e,t,i)=>{"use strict";i.d(t,{P:()=>Attachment});var n=i(78909),s=i(32143),o=i(48520);class Attachment extends n.T{constructor(e){super(),this.category=s.G.EXTERNAL,this.mediaType=o.E.IMAGE,this.height=0,this.width=0,e&&Object.assign(this,e)}copy(e){return this.id=e.id,this.src=e.src,this.url=e.url,this.thumbnailUrl=e.thumbnailUrl,this.name=e.name,this.height=e.height,this.width=e.width,this.size=e.size,this.created=e.created,this.modified=e.modified,this.category=e.category,this.mediaType=e.mediaType,this.mediaId=e.mediaId,this.assetId=e.assetId||"",this.assetType=e.assetType,this}}},36520:(e,t,i)=>{"use strict";i.d(t,{b:()=>AttachmentsData});var n=i(19413),s=i(71229),o=i(98507),r=i(51090);class AttachmentsData extends n.V{constructor(){super(),this.name="media-attachments-data",this.attachments=(0,s.q)(),this.tempAttachments=(0,s.q)(),this.pendingAttachments=(0,s.q)(),this.removedAttachments=(0,s.q)()}async load(e,t){if(!e)throw new Error("Attachment storage is not configured");const i=await e.read()||{};for(const e in i){const n=new o.P(i[e]);if(n.mediaId){const e=t[n.mediaId];e&&(n.thumbnailUrl=await e.thumbnailUrl.get(),n.url=await e.imageUrl.get(),n.width=e.width,n.height=e.height)}this.attachments.set(e,n)}return this.attachments}iterate(e){for(const t of this.attachments)e(t)}iteratePending(e){for(const t of this.pendingAttachments)e(t)}iterateTemp(e){for(const t of this.tempAttachments)e(t)}getAttachmentsForAsset(e,t){const i=[];return this.iterate((n=>{n.assetType===t&&n.assetId===e&&i.push(n)})),t===r.h.MATTERTAG&&this.iterateTemp((n=>{n.assetType===t&&n.assetId===e&&i.push(n)})),i}getAttachmentsForAssetTypes(e){const t=[];return this.iterate((i=>{e.includes(i.assetType)&&t.push(i)})),e.includes(r.h.MATTERTAG)&&this.iterateTemp((i=>{e.includes(i.assetType)&&t.push(i)})),t}getAttachmentsForAssets(e){const t=[];return this.iterate((i=>{i.assetId&&e.includes(i.assetId)&&t.push(i)})),t}get collection(){return this.attachments}get removals(){return this.removedAttachments}get pendings(){return this.pendingAttachments}getAttachment(e){return this.attachments.get(e)}getTempAttachment(e){return this.tempAttachments.get(e)}hasPendingChanges(){return this.removedAttachments.length>0||this.pendingAttachments.length>0}getPendingAttachment(e){return this.pendingAttachments.get(e)}addPendingAttachments(e){0!==e.length&&(e.forEach((e=>{e&&this.pendingAttachments.set(e.id,e)})),this.commit())}getPendingAttachmentsForAsset(e,t){const i=[];return this.iteratePending((n=>{n.assetType===t&&n.assetId===e&&i.push(n)})),i}deletePendingAttachment(e){this.pendingAttachments.has(e)&&(this.pendingAttachments.delete(e),this.commit())}clearPendingAttachments(){0!==this.pendingAttachments.keys.length&&(this.pendingAttachments=(0,s.q)(),this.commit())}clearRemovedAttachments(){0!==this.removedAttachments.keys.length&&(this.removedAttachments=(0,s.q)(),this.commit())}createTempAttachment(e){this.tempAttachments.set(e.id,e),this.deletePendingAttachment(e.id)}markAttachmentForDelete(e){const t=this.attachments.get(e);if(t){const i=new o.P(t);this.removedAttachments.set(i.id,i),this.attachments.delete(e),this.commit()}}reattachRemovedAttachments(){const e=this.removedAttachments.keys;if(e.length){for(const t of e){const e=this.removedAttachments.get(t),i=new o.P(e);this.addAttachment(i)}this.removedAttachments=(0,s.q)(),this.commit()}}addAttachment(e){this.attachments.has(e.id)?this.attachments.get(e.id).copy(e):this.attachments.set(e.id,e)}}},73305:(e,t,i)=>{"use strict";i.d(t,{wu:()=>EmbedMediaCommand,st:()=>LoadEmbeddedMediaCommand,It:()=>UploadAttachmentsCommand,iF:()=>AddMattertagEmbedTempAttachmentCommand,GW:()=>SavePendingAttachmentsCommand,rh:()=>ClearPendingAttachmentsCommand,u:()=>ReattachRemovedAttachmentsCommand,N0:()=>DeleteRemovedAttachmentsCommand,SI:()=>ViewAttachmentsCommand,ms:()=>ViewAssetAttachmentsCommand,VO:()=>ViewAttachmentsForAssetsCommand,$T:()=>RemoveAttachmentCommand,Qm:()=>DeleteAssetMediaCommand,HC:()=>DeleteAssetListMediaCommand});var n=i(99681);class EmbedMediaCommand extends n.m{constructor(e,t,i){super(),this.id="EMBED_MEDIA",this.payload={assetId:e,assetType:t,src:i}}}class LoadEmbeddedMediaCommand extends n.m{constructor(e){super(),this.id="LOAD_ATTACHMENT_EMBED",this.payload={attachmentId:e}}}class UploadAttachmentsCommand extends n.m{constructor(e,t,i){super(),this.id="UPLOAD_ATTACHMENTS",this.payload={assetId:e,assetType:t,files:i}}}class AddMattertagEmbedTempAttachmentCommand extends n.m{constructor(e,t,i){super(),this.id="ADD_TEMP_EMBED_ATTACHMENT",this.payload={assetId:e,mediaType:t,src:i}}}class SavePendingAttachmentsCommand extends n.m{constructor(e,t,i,n){super(),this.id="SAVE_PENDING_ATTACHMENTS",this.payload={assetId:e,assetType:t,prevAssetId:i,prevAssetType:n}}}class ClearPendingAttachmentsCommand extends n.m{constructor(){super(...arguments),this.id="CLEAR_PENDING_ATTACHMENTS"}}class ReattachRemovedAttachmentsCommand extends n.m{constructor(){super(...arguments),this.id="REATTACH_REMOVED_ATTACHMENTS"}}class DeleteRemovedAttachmentsCommand extends n.m{constructor(){super(...arguments),this.id="DELETE_REMOVED_ATTACHMENTS"}}class ViewAttachmentsCommand extends n.m{constructor(e,t){super(),this.payload={attachments:e,index:t}}}class ViewAssetAttachmentsCommand extends n.m{constructor(e,t,i){super(),this.payload={assetId:e,assetType:t,attachmentId:i}}}class ViewAttachmentsForAssetsCommand extends n.m{constructor(e,t){super(),this.payload={attachmentId:e,assetIds:t}}}class RemoveAttachmentCommand extends n.m{constructor(e){super(),this.id="MARK_ATTACHMENT_DELETED",this.payload={id:e}}}class DeleteAssetMediaCommand extends n.m{constructor(e,t){super(),this.id="DELETE_ASSET_MEDIA",this.payload={assetId:e,assetType:t}}}class DeleteAssetListMediaCommand extends n.m{constructor(e,t){super(),this.id="DELETE_ASSET_LIST_MEDIA",this.payload={assetIds:e,assetType:t}}}},78305:(e,t,i)=>{"use strict";var n,s;i.d(t,{k:()=>n,_:()=>s}),function(e){e.UNSUPPORTED_FILE_TYPE="unsupported",e.SUPPORT_COMING_SOON="coming",e.UPLOAD_FAILED="failed"}(n||(n={})),function(e){e.EMBED_FAIL="embedFail",e.EMBED_SUCCESS="success"}(s||(s={}))},72316:(e,t,i)=>{"use strict";i.r(t),i.d(t,{AddMattertagEmbedTempAttachmentCommand:()=>g.iF,Attachment:()=>f.P,AttachmentCategory:()=>v.G,AttachmentDeserializer:()=>AttachmentDeserializer,AttachmentEmbedStatus:()=>y._,AttachmentSerializer:()=>AttachmentSerializer,AttachmentUploadDoneMessage:()=>b.RE,AttachmentUploadError:()=>y.k,AttachmentUploadProgressMessage:()=>b.Vj,AttachmentsData:()=>T.b,AttachmentsUploadApi:()=>AttachmentsUploadApi,ClearPendingAttachmentsCommand:()=>g.rh,DeleteAssetListMediaCommand:()=>g.HC,DeleteAssetMediaCommand:()=>g.Qm,DeleteRemovedAttachmentsCommand:()=>g.N0,EmbedMediaCommand:()=>g.wu,EmbeddingDoneMessage:()=>b.v8,EmbedsData:()=>EmbedsData,LoadEmbeddedMediaCommand:()=>g.st,MdsAttachmentDeserializer:()=>D.E,MdsAttachmentSerializer:()=>MdsAttachmentSerializer,MediaEmbedder:()=>MediaEmbedder,MediaType:()=>w.E,ReattachRemovedAttachmentsCommand:()=>g.u,RemoveAttachmentCommand:()=>g.$T,SavePendingAttachmentsCommand:()=>g.GW,UploadAttachmentsCommand:()=>g.It,ViewAssetAttachmentsCommand:()=>g.ms,ViewAttachmentsCommand:()=>g.SI,ViewAttachmentsForAssetsCommand:()=>g.VO,default:()=>I,imageDeserializer:()=>_});var n=i(54122),s=i(25799),o=i(62367),r=i(51090),a=i(39936),l=i(17513),c=i(68519);const h=new s.Z("media-serializer"),d=e=>{const t={};if(!e||!e.images||e.images.length<1)return t;const i=e.images;for(const e of Object.keys(i)){const n=u(i[e]);n&&(t[n.sid]=n)}return t},u=e=>{if(!e||!e.metadata)return null;let t=e.metadata;if("string"==typeof e.metadata)try{t=JSON.parse(e.metadata)}catch(e){return h.warn("Attachment metadata parse failed"),null}if(0===Object.keys(t).length)return null;if(e.category===l.i.USER){if(void 0!==t.assetType)return{sid:e.sid,thumbnailUrl:new c.n(e.thumbnail_signed_src,null),imageUrl:new c.n(e.src,null),height:e.height,width:e.width}}return null};var p=i(80994),m=i(80034),g=i(73305),f=i(98507),v=i(32143),y=i(78305),b=i(55994),w=i(48520),S=i(19413),E=i(71229);class EmbedsData extends S.V{constructor(){super(),this.name="embeds-data",this.embeds=(0,E.q)()}iterate(e){for(const t of this.embeds)e(t)}getEmbed(e){return this.embeds.get(e)}addEmbed(e){this.embeds.set(e.src,e)}clearCache(){this.embeds=(0,E.q)(),this.commit()}}var T=i(36520);const M=new s.Z("media-serializer"),_=e=>{if(!e||!e.metadata)return null;let t=e.metadata;if("string"==typeof e.metadata)try{t=JSON.parse(e.metadata)}catch(e){return M.warn("Attachment metadata parse failed"),null}if(0===Object.keys(t).length)return null;if(e.category===l.i.USER){const i=t;if(void 0!==i.assetType){const t=e.name&&(!e.name.match(/^[0-9.]+_[0-9.]+$/)||"")&&e.name||"";return{id:e.name,assetType:i.assetType,thumbnailUrl:e.thumbnail_signed_src,url:e.src,src:e.src,name:t,height:e.height,width:e.width,size:e.size,created:new Date(Date.parse(e.created)),modified:new Date(Date.parse(e.modified)),category:v.G.UPLOAD,mediaType:w.E.IMAGE,mediaId:e.sid}}}return null},x=new s.Z("attachment-uploader");class AttachmentsUploadApi{constructor(e,t){this.queue=e,this.imageEndpoint=t}uploadImageFile(e,t,i){const n=new FormData;return n.append("src",e.file,e.file.name),n.append("name",e.file.name),n.append("category",l.i.USER),n.append("metadata",JSON.stringify(t)),this.upload(n,i).then((t=>{if(x.info("upload successful!"),t){const i=_(t);if(i){const t=new f.P(i);return e.progress=100,e.attachment=t,e}}return e.error=y.k.UPLOAD_FAILED,e.progress=100,e})).catch((t=>(x.error(`upload failed ${t}`),e.error=y.k.UPLOAD_FAILED,e.progress=100,e)))}async upload(e,t){const i=`${this.imageEndpoint}?format=json`,n=new XMLHttpRequest;return n.open("POST",i,!0),n.responseType="json",n.setRequestHeader("Accept","application/json"),n.upload.onprogress=t,new Promise(((t,i)=>{n.onreadystatechange=e=>{4===n.readyState&&(200===n.status||201===n.status||204===n.status?t(n.response):0!==n.status&&i({status_code:n.status}))},n.onerror=function(e){i(e)},n.send(e)}))}deleteImageFile(e){return this.queue.delete(`${this.imageEndpoint}${e}?format=json`).then((e=>{x.info("delete successful!")})).catch((e=>{x.error(e)}))}}var A=i(20331),O=i(99898);const P=new s.Z("media-embedder");class MediaEmbedder{constructor(e,t){this.key=e,this.embedsData=t,this.embedEndpoint="https://api.embed.ly/1/oembed",this.imageEndpoint="https://i.embed.ly/1/display/resize",this.safeProvidersForScripts=[O.T_,O.Er],MediaEmbedder.queue||(MediaEmbedder.queue=new A.gO({retries:0})),this.embedsData=t}clearCache(){this.embedsData.clearCache()}async getEmbeddedMedia(e){const t=this.embedsData.getEmbed(e);if(t)return t;try{const t=await this.getEmbedDetails(e);if(t)return this.embedsData.addEmbed(t),t}catch(t){P.error(`Embed failed: ${e}`),P.error(t)}return null}async getEmbedDetails(e){const t=this.getEmbedUrl(e);return this.loadEmbed(t,e)}getEmbedUrl(e){const t=Math.max(window.screen.height,window.screen.width),i=`&maxwidth=${t}&maxheight=${t}`;return`${this.embedEndpoint}?key=${this.key}&url=${encodeURIComponent(e)}${i}`}loadEmbed(e,t){return MediaEmbedder.queue.get(e,{responseType:"json"}).then((i=>this.validateEmbed(e,t,i)))}validateEmbed(e,t,i){if(!(!!(!i.html||!i.html.match(/<script/i))||this.safeProvidersForScripts.includes(i.provider_name)))return P.debug("html contains Javascript"),Promise.resolve(null);let n=i.type;if(n===w.E.RICH&&!i.html)return P.debug("missing html for embed"),Promise.resolve(null);"photo"===n&&(n="image");let s=n;switch(s){case w.E.IMAGE:case w.E.RICH:case w.E.VIDEO:break;default:{const e=`Did the OEmbed format extend?! Unknown type: ${i.type}`;return P.debug(e),Promise.resolve(null)}}const o=(void 0===i.height||void 0===i.width)&&i.thumbnail_width&&i.thumbnail_height,r=o?i.thumbnail_width:i.width,a=o?i.thumbnail_height:i.height,l=i.provider_name,c=i.thumbnail_url;l===O.Er&&o&&s===w.E.RICH&&c?s=w.E.IMAGE:l===O.T_&&!o&&s===w.E.IMAGE&&i.url||s===w.E.IMAGE&&i.html&&(s=w.E.RICH);const h={width:r,height:a,mediaType:s,name:i.title||"",thumbnailUrl:c,mediaUrl:i.url||c||"",html:i.html||"",provider:l,src:t};return s!==w.E.IMAGE||i.html?Promise.resolve(h):this.getImageDetails(t,h)}async getImageDetails(e,t){const i=this.getDisplayUrl(e);return this.loadImage(e,i,t)}getDisplayUrl(e){const t=Math.max(window.screen.height,window.screen.width),i=`&url=${encodeURIComponent(e)}&width=${t}&height=${t}`;return`${this.imageEndpoint}?key=${this.key}${i}`}loadImage(e,t,i){return MediaEmbedder.queue.get(t,{responseType:"arraybuffer"}).then((n=>n?this.validateImage(e,t,i,n):(P.debug("Embedly: got an empty response when requesting image"),Promise.resolve(null)))).catch((e=>(P.debug(`Embedly error: ${e}`),Promise.resolve(null))))}validateImage(e,t,i,n){return new Promise(((e,s)=>{const o=new Uint8Array(n),r=new Blob([o]),a=new Image;a.addEventListener("load",(n=>function(n){const s=n.target;i.width=s.naturalWidth,i.height=s.naturalHeight,i.mediaUrl=t,i.thumbnailUrl=l,e(i)}(n)));const l=URL.createObjectURL(r);a.src=l}))}}var C=i(32020);class AttachmentSerializer{serialize(e){if(!e)return null;return{id:e.id,src:e.src,name:e.name,height:e.height,width:e.width,size:e.size||0,category:e.category,mediaType:e.mediaType,mediaId:e.mediaId,assetId:e.assetId,assetType:e.assetType,created:(0,C.U)(e.created),modified:(0,C.U)(e.modified)}}}class AttachmentDeserializer{deserialize(e){if(!this.validate(e))return null;const t=new f.P({});let i=e.mediaType;const n=e.category;return n===v.G.EXTERNAL&&"photo"===i&&(i="image"),t.id=e.id,t.src=e.src,t.url=e.src,t.thumbnailUrl=e.src,t.name=e.name,t.height=e.height,t.width=e.width,t.size=e.size,t.category=n,t.mediaId=e.mediaId,t.mediaType=i,t.assetId=e.assetId,t.assetType=e.assetType,t.created=(0,C.p)(e.created),t.modified=(0,C.p)(e.modified),t}validate(e){if(!e||"object"!=typeof e)return!1;return["created","modified","category","mediaType","assetType","assetId","src"].every((t=>t in e))}}class AttachmentsModule extends n.Y{constructor(){super(...arguments),this.name="attachments-module",this.log=new s.Z(this.name),this.viewAssetAttachments=async e=>{const t=this.attachmentsData.getAttachmentsForAsset(e.assetId,e.assetType),i=t.findIndex((t=>t.id===e.attachmentId));t.length>0&&-1!==i?this.engine.commandBinder.issueCommand(new g.SI(t,i)):this.log.warn("No attachments to view")},this.viewAttachmentsForAssets=async e=>{const t=this.attachmentsData.getAttachmentsForAssets(e.assetIds),i=t.findIndex((t=>t.id===e.attachmentId));t.length>0&&-1!==i?this.engine.commandBinder.issueCommand(new g.SI(t,i)):this.log.warn("Cannot view empty attachment list")},this.loadEmbeddedAttachment=async e=>{let t=this.attachmentsData.getAttachment(e.attachmentId);return t||(t=this.attachmentsData.getPendingAttachment(e.attachmentId)||this.attachmentsData.getTempAttachment(e.attachmentId)),t?this.getUpdatedEmbed(t):null},this.embedMedia=async e=>{let t,i=null;const{src:n,assetId:s,assetType:o}=e,r=await this.mediaEmbedder.getEmbeddedMedia(n);return r?(i=new f.P,i.id=this.getNewattachmentId(),i.src=n,i.assetId=s,i.assetType=o,i.name=r.name,i.thumbnailUrl=r.thumbnailUrl,i.url=r.mediaUrl,i.category=v.G.EXTERNAL,i.mediaType=r.mediaType,i.height=r.height,i.width=r.width,this.attachmentsData.addPendingAttachments([i]),t=y._.EMBED_SUCCESS):t=y._.EMBED_FAIL,this.engine.broadcast(new b.v8(i,t,e.assetId,e.assetType)),i},this.addTempTagEmbedAttachment=async e=>{const t=new f.P({id:this.getNewattachmentId(),assetId:e.assetId,mediaType:e.mediaType,src:e.src,assetType:r.h.MATTERTAG,category:v.G.EXTERNAL});this.attachmentsData.createTempAttachment(t)},this.uploadAttachments=async e=>{const t=e.assetType,i=e.assetId,n=e.files,s=n.length,o=[];for(let e=0;e<s;e++){const s=n[e];let r=null;s.type.match(O.Y1[w.E.IMAGE].fileTypeMatch)?r=w.E.IMAGE:s.type.match(O.Y1[w.E.PDF].fileTypeMatch)&&(r=w.E.PDF),o.push(this.uploadAttachment(s,r,e,i,t))}const r=await Promise.all(o),a=[];r.forEach((e=>{e.attachment&&(e.attachment.id=this.getNewattachmentId(),e.attachment.assetId=e.assetId,a.push(e.attachment))})),a&&this.attachmentsData.addPendingAttachments(a),this.engine.broadcast(new b.RE(r,i,t))},this.onProgress=(e,t)=>{if(!e.lengthComputable)return;const i=Math.floor(e.loaded/e.total*100);this.engine.broadcast(new b.Vj(Object.assign(Object.assign({},t),{progress:i}),t.assetId,t.assetType))},this.removeAttachment=async e=>{const t=e.id;if(this.attachmentsData.getAttachment(t))this.attachmentsData.markAttachmentForDelete(t);else{const e=this.attachmentsData.getPendingAttachment(t);e&&(await this.deleteUploadedMedia([e]),this.attachmentsData.deletePendingAttachment(t))}},this.savePendingAttachments=async e=>{const{assetId:t,assetType:i,prevAssetId:n,prevAssetType:s}=e,{pendings:o}=this.attachmentsData;if(o.length>0){if(n||s){const e=n||t,o=s||i;this.attachmentsData.iteratePending((n=>{n.assetId===e&&n.assetType===o&&(n.assetId=t,n.assetType=i)}))}this.attachmentsData.iteratePending((e=>{this.attachmentsData.addAttachment(new f.P(e))})),this.attachmentsData.clearPendingAttachments(),await this.jsonStore.update(this.attachmentsData.collection.deepCopy()),this.attachmentsData.commit()}},this.clearPendingAttachments=async()=>{const e=this.attachmentsData.pendings.values;await this.deleteUploadedMedia(e),this.attachmentsData.clearPendingAttachments()},this.reattachRemovedAttachments=async()=>{this.attachmentsData.reattachRemovedAttachments()},this.deleteAttachments=async e=>{if(0===e.length)return;const t={};await this.deleteUploadedMedia(e);const{collection:i}=this.attachmentsData;this.attachmentsData.atomic((()=>{e.forEach((e=>{t[e.id]=null,i.delete(e.id)})),Object.keys(t).length&&this.jsonStore.update(t)}))},this.deleteRemovedAttachments=async()=>{this.deleteAttachments(this.attachmentsData.removals.values),this.attachmentsData.clearRemovedAttachments()},this.handleDeleteAssetMedia=async e=>this.deleteAttachmentsForAsset(e.assetId,e.assetType),this.deleteAssetListAttachments=async e=>{const t=[];return e.assetIds.forEach((i=>{t.push(this.deleteAttachmentsForAsset(i,e.assetType))})),Promise.all(t)}}async init(e,t){this.engine=t,this.config=e,this.embedsData=new EmbedsData,this.attachmentsData=new T.b,this.jsonStore=this.getDataStore();const i=new m.gh({queue:e.queue,path:e.modelUrl,deserialize:d}),n=await i.read().catch((e=>(this.log.debug(e),{})));await this.attachmentsData.load(this.jsonStore,n||{});const s=e.modelUrl+"/images/";this.mediaUploader=new AttachmentsUploadApi(e.queue,s),this.settingsData=await t.market.waitForData(a.e),this.mediaEmbedder=new MediaEmbedder(this.settingsData.getProperty(O.lc),this.embedsData),this.bindings.push(t.commandBinder.addBinding(g.It,this.uploadAttachments),t.commandBinder.addBinding(g.wu,this.embedMedia),t.commandBinder.addBinding(g.st,this.loadEmbeddedAttachment),t.commandBinder.addBinding(g.iF,this.addTempTagEmbedAttachment),t.commandBinder.addBinding(g.GW,this.savePendingAttachments),t.commandBinder.addBinding(g.$T,this.removeAttachment),t.commandBinder.addBinding(g.Qm,this.handleDeleteAssetMedia),t.commandBinder.addBinding(g.HC,this.deleteAssetListAttachments),t.commandBinder.addBinding(g.rh,this.clearPendingAttachments),t.commandBinder.addBinding(g.u,this.reattachRemovedAttachments),t.commandBinder.addBinding(g.N0,this.deleteRemovedAttachments),t.commandBinder.addBinding(g.VO,this.viewAttachmentsForAssets),t.commandBinder.addBinding(g.ms,this.viewAssetAttachments)),t.market.register(this,EmbedsData,this.embedsData),t.market.register(this,T.b,this.attachmentsData)}getDataStore(){const{baseUrl:e,modelId:t,queue:i}=this.config,n=new p.A({serializer:new AttachmentSerializer,deserializer:new AttachmentDeserializer});return new m.MU({queue:i,path:`${e}/api/v1/jsonstore/model/attachments/${t}`,batchUpdate:!0,httpMethod:m.w$.PATCH,deserialize:e=>n.deserialize(e),serialize:e=>n.serialize(e)})}getNewattachmentId(){let e=(0,o.O1)(11);for(;this.attachmentsData.getAttachment(e);)e=(0,o.O1)(11);return e}async getUpdatedEmbed(e){if(e.category===v.G.EXTERNAL){const t=await this.mediaEmbedder.getEmbeddedMedia(e.src);if(t)return e.thumbnailUrl=t.thumbnailUrl,e.url=t.mediaUrl,e.mediaType=t.mediaType,e.height=t.height,e.width=t.width,e.name=t.name,e.commit(),t;this.log.warn("Get embedded media failed")}return null}async uploadAttachment(e,t,i,n,s){const o={assetType:s},r={file:e,attachment:null,progress:0,index:i,error:null,assetId:n,assetType:s};if(t!==w.E.IMAGE){const e=t===w.E.PDF?y.k.SUPPORT_COMING_SOON:y.k.UNSUPPORTED_FILE_TYPE;return this.log.warn("Cannot upload file type"),r.error=e,Promise.resolve(r)}return this.mediaUploader.uploadImageFile(r,o,(e=>this.onProgress(e,r)))}async deleteAttachmentsForAsset(e,t){const i=this.attachmentsData.getAttachmentsForAsset(e,t);this.deleteAttachments(i)}async deleteUploadedMedia(e){const t=[];return e.forEach((e=>{e.category===v.G.UPLOAD&&e.mediaId&&e.mediaType===w.E.IMAGE&&t.push(this.mediaUploader.deleteImageFile(e.mediaId))})),Promise.all(t)}}var D=i(67420);class MdsAttachmentSerializer{constructor(){this.getAttachmentDetails=e=>e.mediaType?{mediaType:e.mediaType,srcUrl:e.src,thumbnailUrl:e.thumbnailUrl,width:e.width,height:e.height}:null,this.validate=e=>!!e&&void 0!==e.mediaType}serialize(e){const t=this.getAttachmentDetails(e);return t&&this.validate(t)?t:null}}const I=AttachmentsModule},55994:(e,t,i)=>{"use strict";i.d(t,{Vj:()=>AttachmentUploadProgressMessage,RE:()=>AttachmentUploadDoneMessage,v8:()=>EmbeddingDoneMessage});var n=i(93528);class AttachmentUploadProgressMessage extends n.v{constructor(e,t,i){super(),this.status=e,this.assetId=t,this.assetType=i}}class AttachmentUploadDoneMessage extends n.v{constructor(e,t,i){super(),this.uploads=e,this.assetId=t,this.assetType=i}}class EmbeddingDoneMessage extends n.v{constructor(e,t,i,n){super(),this.attachment=e,this.status=t,this.assetId=i,this.assetType=n}}},99898:(e,t,i)=>{"use strict";i.d(t,{lc:()=>n,Er:()=>s,T_:()=>o,yk:()=>r,Y1:()=>c});const n="embedlyKey",s="Instagram",o="Flickr",r=25,a=[".jpg",".jpeg",".png",".gif"],l=[".pdf"],c=Object.freeze({extensions:a.concat(l),image:{extensions:a,fileTypeMatch:"image/.+"},pdf:{extensions:l,fileTypeMatch:"application/pdf"}})},67420:(e,t,i)=>{"use strict";i.d(t,{E:()=>MdsAttachmentDeserializer});var n,s=i(25799),o=i(32020);!function(e){e.COMMENT="comment",e.MATTERTAG="mattertag"}(n||(n={}));var r=i(51090);var a=i(98507),l=i(32143);const c=new s.Z("mds-attachment-deserializer");class MdsAttachmentDeserializer{constructor(){}deserialize(e){if(!e||!this.validate(e))return c.debug("Deserialized invalid external attachment data from MDS",e),null;const t=new a.P;return t.id=e.id,t.created=(0,o.p)(e.created),t.modified=(0,o.p)(e.modified),e.thumbnailUrl&&(t.thumbnailUrl=e.thumbnailUrl),e.url&&(t.url=e.url,t.src=e.url),e.mediaType&&(t.mediaType=e.mediaType),e.category?t.category=e.category:t.category=l.G.EXTERNAL,e.width&&(t.width=e.width),e.height&&(t.height=e.height),t.assetType=function(e){switch(e){case n.COMMENT:return r.h.COMMENT;case n.MATTERTAG:return r.h.MATTERTAG;default:throw Error(`Unknown parent type ${e}`)}}(e.parentDetails.type),t.assetId=e.parentDetails.parent.id,t}validate(e){if(!e)return!1;const t=["id","created","modified","mediaType","parentDetails","category"].filter((t=>!(t in e))),i=0===t.length;return i||c.debug("Attachment invalid:",{missingFields:t}),i}}},44857:(e,t,i)=>{"use strict";i.d(t,{L:()=>ResetPitchCommand});var n=i(99681);class ResetPitchCommand extends n.m{}},89155:(e,t,i)=>{"use strict";i.d(t,{M_:()=>CameraData,rw:()=>u});var n=i(64279),s=i(19413),o=i(290),r=i(2212);const a=(e,t)=>e&&t?e.equals(t):e===t;var l=i(91055),c=i(56040),h=i(78909),d=i(97620);class CameraPoseData extends h.T{constructor(e){super(),this.position=new r.Vector3,this.rotation=new r.Quaternion,this.focalDistance=-1,this.projection=(0,n.AN)(e)}aspect(){return this.projection.elements[5]/this.projection.elements[0]}clone(e=new CameraPoseData(this.aspect())){return e.position.copy(this.position),e.rotation.copy(this.rotation),e.focalDistance=this.focalDistance,e.projection.copy(this.projection),e}isOrtho(){return(0,l.Pp)(this.projection)}fovX(){return 2*Math.atan(1*this.aspect()/this.projection.elements[5])}fovY(){return 2*Math.atan(1/this.projection.elements[5])}}class CameraTransition extends h.T{constructor(){super(...arguments),this.startTime=0,this.duration=0,this.active=!1,this.type=null,this.progress=new o.z(0),this.blackoutProgress=new o.z(0),this.from={position:new r.Vector3,rotation:new r.Quaternion,projection:new c.M},this.to={position:new r.Vector3,rotation:new r.Quaternion,projection:new c.M},this.rotationDelay=0,this.rotationDuration=1,this.matrixDelay=0,this.matrixDuration=1,this.activeInternal=!1,this.promise=null}}const u=(e,t,i=!0)=>{t.position=p(e.position,t.position,i),t.rotation=p(e.rotation,t.rotation,i),t.projection=p(e.projection,t.projection,i),t.focalDistance=e.focalDistance},p=(e,t,i=!0)=>(e&&!t?t=e.clone():e&&t?t.copy(e):i&&(t=void 0),t);class CameraData extends s.V{constructor(e,t){super(),this._width=e,this._height=t,this.name="camera",this._baseProjection=new c.M,this._orthoMatrix=new c.M,this._lastOrthoZoom=1,this._perspectiveMatrix=new c.M,this.pose=new CameraPoseData(e/t),this.transition=new CameraTransition,this.setCameraDimensions(e,t),this._baseFovY=r.MathUtils.DEG2RAD*n.oR.fov}setCameraDimensions(e,t){if(void 0===e||void 0===t)return;this._width=e,this._height=t;const i=e/t,s=this.isOrtho()?(0,n.aH)(e,t,t/(2*this.orthoZoom()),this._orthoMatrix):this._perspectiveMatrix.makePerspectiveFov(d.MN*this.fovY(),i,n.oR.near,n.oR.far);if(this.pose.projection.copy(s),this.transition.active&&this.transition.to.projection)if((0,l.Pp)(this.transition.to.projection)){const i=(0,l.S3)(this.transition.to.projection);this.transition.to.projection.copy((0,n.aH)(e,t,t/(2*i)))}else{const e=2*d.MN*Math.atan(1/this.transition.to.projection.elements[5]);this.transition.to.projection.makePerspectiveFov(e,i,n.oR.near,n.oR.far)}this.pose.commit()}setBaseProjection(e){this._baseProjection=e}get width(){return this._width}get height(){return this._height}get baseFovY(){return this._baseFovY}aspect(){return this.pose.aspect()}fovY(){return this.pose.fovY()}fovX(){return this.pose.fovX()}isOrtho(){return this.pose.isOrtho()}baseZoom(){return this.pose.projection.elements[0]/2}defaultZoom(){return(0,l.Pp)(this._baseProjection)?(0,l.S3)(this._baseProjection):this.perspectiveZoom()}zoom(){return this.isOrtho()?this.orthoZoom():this.perspectiveZoom()}orthoZoom(){const e=(0,l.S3)(this.pose.projection);return isNaN(e)?this._lastOrthoZoom:(this._lastOrthoZoom=e,e)}perspectiveZoom(){return this.baseFovY/this.fovY()}copyTransition(e){this.transition.active=e.active,this.transition.activeInternal=e.activeInternal,this.transition.type=e.type,this.transition.startTime=e.startTime,this.transition.duration=e.duration,this.transition.rotationDelay=e.rotationDelay,this.transition.rotationDuration=e.rotationDuration,this.transition.matrixDelay=e.matrixDelay,this.transition.matrixDuration=e.matrixDuration,e.progress&&this.transition.progress.copy(e.progress),e.blackoutProgress&&this.transition.blackoutProgress.copy(e.blackoutProgress),e.from&&u(e.from,this.transition.from),e.to&&u(e.to,this.transition.to),this.transition.promise=e.promise}canTransition(){return!this.transition.active}clone(){const e=new CameraData(this.width,this.height);return e.copy(this),e}copy(e){this.pose.position.copy(e.pose.position),this.pose.rotation.copy(e.pose.rotation),this.pose.focalDistance=e.pose.focalDistance,this.pose.projection.copy(e.pose.projection),this.pose.commit(),this._baseFovY=e.baseFovY,this.copyTransition(e.transition),this.transition.commit(),this._width=e.width,this._height=e.height}shallowIsEqual(e){return this.pose.position.equals(e.pose.position)&&this.pose.rotation.equals(e.pose.rotation)&&this.pose.projection.equals(e.pose.projection)&&this.pose.focalDistance===e.pose.focalDistance&&this.baseFovY===e.baseFovY}isEqual(e){return this.shallowIsEqual(e)&&this.transitionIsEqual(e.transition)}transitionIsEqual(e){return this.transition.active===e.active&&this.transition.type===e.type&&this.transition.progress.equals(e.progress)&&this.transition.blackoutProgress.equals(e.blackoutProgress)&&this.transition.rotationDelay===e.rotationDelay&&this.transition.rotationDuration===e.rotationDuration&&this.transition.matrixDelay===e.matrixDelay&&this.transition.matrixDuration===e.matrixDuration&&this.transition.activeInternal===e.activeInternal&&a(this.transition.from.position,e.from.position)&&a(this.transition.from.rotation,e.from.rotation)&&a(this.transition.from.projection,e.from.projection)&&a(this.transition.to.position,e.to.position)&&a(this.transition.to.rotation,e.to.rotation)&&a(this.transition.to.projection,e.to.projection)&&this.transition.startTime===e.startTime&&this.transition.duration===e.duration}}},64279:(e,t,i)=>{"use strict";i.d(t,{oR:()=>s,AN:()=>o,aH:()=>r});var n=i(56040);const s={fov:75,near:.1,far:3e3},o=(e,t)=>(t||(t=new n.M),t.makePerspectiveFov(s.fov,e,s.near,s.far)),r=(e,t,i=1,o)=>{o||(o=new n.M);const r=e/2,a=t/2,l=o.makeOrthographic(-r,r,a,-a,s.near,s.far);return l.elements[0]*=i,l.elements[5]*=i,l}},89895:(e,t,i)=>{"use strict";i.r(t),i.d(t,{baseTransitionSpeedKey:()=>b,default:()=>CameraModule});var n=i(2212);var s=i(91055),o=i(80384),r=i(54122),a=i(89155),l=i(93528);class CameraMoveMessage extends l.v{constructor(e,t){super(),this.from=t,this.to=e,this.timestamp=Date.now()}}class BeginCameraMoveMessage extends CameraMoveMessage{}class EndCameraMoveMessage extends CameraMoveMessage{}var c=i(44266),h=i(1799),d=i(73029),u=i(39936),p=i(99169),m=i(67126),g=i(28247),f=i(47924),v=i(44857);const y={[f.n.Instant]:{blackoutTime:0,transitionTime:0},[f.n.FadeToBlack]:{blackoutTime:d.Z.camera.transitionBlackoutTime,transitionTime:2*d.Z.camera.transitionBlackoutTime},[f.n.Interpolate]:{blackoutTime:0,transitionTime:d.Z.camera.transitionFadeTime}},b="Transition time";class CameraModule extends r.Y{constructor(){super(...arguments),this.name="camera-data",this.eulerCache=new n.Euler,this.quaternionCache=new n.Quaternion}async init(e,t){this.engine=t,this.market=t.market,this.canvas=await t.market.waitForData(p.W),this.cameraData=new a.M_(this.canvas.width,this.canvas.height),this.market.register(this,a.M_,this.cameraData),this.baseTransitionTime=e.baseTransitionTime||d.Z.camera.baseTransitionTime,t.market.waitForData(u.e).then((e=>{e.onPropertyChanged(b,(e=>{this.baseTransitionTime=e}))})),t.commandBinder.addBinding(v.L,(async()=>this.resetPitch())),this.bindings.push(t.subscribe(o.a,(e=>this.cameraData.setCameraDimensions(e.width,e.height)))),this.transitionSpeed=e.transitionSpeed||d.Z.camera.transitionSpeed}getData(e=!0){return e?Object.freeze(this.cameraData.clone()):this.cameraData}onUpdate(e){}fromPose(){return{position:this.cameraData.pose.position.clone(),rotation:this.cameraData.pose.rotation.clone(),projection:this.cameraData.pose.projection.clone(),focalDistance:this.cameraData.pose.focalDistance}}updateCameraProjection(e){e&&(this.cameraData.pose.projection.copy(e),this.cameraData.pose.commit(),this.broadcastCameraMoved({projection:e}))}updateCameraFocus(e){this.cameraData.pose.focalDistance=e,this.cameraData.pose.commit()}updateCameraRotation(e){e&&(this.cameraData.pose.rotation.copy(e),this.cameraData.pose.commit(),this.broadcastCameraMoved({rotation:e}))}resetPitch(){this.eulerCache.setFromQuaternion(this.cameraData.pose.rotation,"YXZ"),this.eulerCache.x=0,this.eulerCache.z=0,this.quaternionCache.setFromEuler(this.eulerCache),this.updateCameraRotation(this.quaternionCache)}updateCameraPosition(e){e&&(this.cameraData.pose.position.copy(e),this.cameraData.pose.commit(),this.broadcastCameraMoved({position:e}))}broadcastCameraMoved(e){const t=this.fromPose(),i=Object.assign(Object.assign({},t),e);this.engine.broadcast(new CameraMoveMessage(i,t))}updateCameraPose(e){e.position&&this.updateCameraPosition(e.position),e.rotation&&this.updateCameraRotation(e.rotation)}canTransition(){return this.cameraData.canTransition()}moveTo(e){if(!this.canTransition())return c.Q.reject("Cannot move while the camera is already moving");const t=y[e.transitionType],i=e.pose.rotation,n=e.pose.position;let o=e.projection;e.pose.zoom&&(o&&(0,s.Pp)(o)||this.cameraData.isOrtho())&&(o=this.adjustProjectionZoom(o||this.cameraData.pose.projection.clone(),e.pose.zoom));const r=void 0!==e.blackoutTime?e.blackoutTime:t.blackoutTime,a=e.transitionType,l=e.transitionSpeedMultiplier?1/e.transitionSpeedMultiplier:1;let h=a===f.n.Instant?0:e.transitionTime;if(void 0===h)if(e.transitionType===f.n.Interpolate&&n){const e=n.distanceTo(this.cameraData.pose.position);h=this.baseTransitionTime+166*Math.log2(1+e)*this.transitionSpeed*l}else h=t.transitionTime;const d=this.fromPose();this.beginInternalTransition({transitionType:a,transitionTime:h,blackoutTime:r,pose:{position:n,rotation:i},projection:o,easing:e.easing,rotationDelay:e.rotationDelay||0,rotationDuration:e.rotationDuration||1,matrixDelay:e.matrixDelay||0,matrixDuration:e.matrixDuration||1,focalDistance:e.focalDistance||d.focalDistance});const u={position:e.pose.position?e.pose.position.clone():void 0,rotation:e.pose.rotation?e.pose.rotation.clone():void 0,projection:e.projection?e.projection.clone():void 0,focalDistance:e.focalDistance?e.focalDistance:void 0};this.engine.broadcast(new BeginCameraMoveMessage(u,d));const p=this.cameraData.transition.promise;if(!p)throw new Error("Expected promise to have been created.");const v=this.progressInternalTransition.bind(this),b=this.endInternalTransition.bind(this),w=this;return p.notify(0),this.engine.startGenerator((function*(){let t=16;for(t>=w.cameraData.transition.duration&&(p.notify(.5),yield new g.Jj);t<w.cameraData.transition.duration;){v(t,r);const e=(0,m.uZ)(t/w.cameraData.transition.duration,0,1);p.notify(e),yield new g.Jj,t=16+Date.now()-w.cameraData.transition.startTime}b(e.transitionType),w.cameraData.commit(),p.notify(1),p.resolve(),w.engine.broadcast(new EndCameraMoveMessage(u,d))})),p.promise()}async cancelTransition(){return this.cameraData.transition.active?new Promise((e=>{(0,a.rw)(this.cameraData.pose,this.cameraData.transition.to,!1);const t=Date.now()-this.cameraData.transition.startTime;this.cameraData.transition.duration=t,this.cameraData.transition.progress.stop(1),this.cameraData.pose.commit(),this.cameraData.transition.commit();const i=this.cameraData.transition.onPropertyChanged("active",(t=>{t||(i&&i.cancel(),e())}))})):Promise.resolve()}updateTransitionSpeed(e){if(this.cameraData.transition.active){const t=Date.now(),i=t-this.cameraData.transition.startTime,n=i/e,s=this.cameraData.transition.progress,o=(s.duration-i)/e+n;this.cameraData.transition.duration=o,this.cameraData.transition.startTime=t-n,s.modifyAnimation(s.value,s.endValue,o,s.easing,n),this.cameraData.transition.commit()}}beginExternalTransition(){this.cameraData.transition.activeInternal||(this.cameraData.transition.startTime=Date.now(),this.cameraData.transition.active=!0,this.cameraData.transition.promise=new c.Q,this.cameraData.transition.commit())}endExternalTransition(){var e;this.cameraData.transition.activeInternal||(this.cameraData.transition.active=!1,null===(e=this.cameraData.transition.promise)||void 0===e||e.resolve(),this.cameraData.transition.commit())}beginInternalTransition(e){const t=e.transitionTime||0;this.cameraData.transition.startTime=Date.now(),this.cameraData.transition.duration=t,this.cameraData.transition.active=!0,this.cameraData.transition.promise=new c.Q,this.cameraData.transition.activeInternal=!0,this.cameraData.transition.type=e.transitionType,this.cameraData.transition.progress.modifyAnimation(0,1,t,e.easing||h.to),this.cameraData.transition.rotationDelay=e.rotationDelay||0,this.cameraData.transition.rotationDuration=e.rotationDuration||1,this.cameraData.transition.matrixDelay=e.matrixDelay||0,this.cameraData.transition.matrixDuration=e.matrixDuration||1,e.transitionType===f.n.FadeToBlack&&this.cameraData.transition.blackoutProgress.modifyAnimation(0,1,e.blackoutTime),this.cameraData.transition.from.position=this.cameraData.pose.position.clone(),this.cameraData.transition.from.rotation=this.cameraData.pose.rotation.clone(),this.cameraData.transition.from.projection=this.cameraData.pose.projection.clone(),this.cameraData.transition.from.focalDistance=this.cameraData.pose.focalDistance,this.cameraData.transition.to.position=e.pose.position?e.pose.position.clone():void 0,this.cameraData.transition.to.rotation=e.pose.rotation?e.pose.rotation.clone():void 0,this.cameraData.transition.to.projection=e.projection?e.projection.clone():void 0,this.cameraData.transition.to.focalDistance=e.focalDistance?e.focalDistance:void 0,this.cameraData.transition.commit()}progressInternalTransition(e,t){if(this.cameraData.transition.active){if(this.cameraData.transition.progress.updateAbsolute(e),this.cameraData.transition.type===f.n.Interpolate){const e=this.cameraData.transition.from,t=this.cameraData.transition.to;if(t.position&&e.position&&this.cameraData.pose.position.copy(e.position).lerp(t.position,this.cameraData.transition.progress.value),t.focalDistance&&e.focalDistance&&(this.cameraData.pose.focalDistance=n.MathUtils.lerp(e.focalDistance,t.focalDistance,this.cameraData.transition.progress.value)),t.rotation&&e.rotation){const i=(0,h.e3)(this.cameraData.transition.progress.easing,this.cameraData.transition.progress.value,this.cameraData.transition.progress.elapsed,this.cameraData.transition.progress.duration*this.cameraData.transition.rotationDuration,this.cameraData.transition.rotationDelay);this.cameraData.pose.rotation.copy(e.rotation).slerp(t.rotation,i)}if(t.projection&&e.projection){const i=(0,h.e3)(h.w2,this.cameraData.transition.progress.value,this.cameraData.transition.progress.elapsed,this.cameraData.transition.progress.duration*this.cameraData.transition.matrixDuration,this.cameraData.transition.matrixDelay);!function(e,t,i,n){const s=n.elements,o=e.elements,r=t.elements;for(let e=0;e<16;e++)s[e]=o[e]*(1-i)+r[e]*i}(e.projection,t.projection,i,this.cameraData.pose.projection)}}else if(this.cameraData.transition.type===f.n.FadeToBlack){let i=0;const n=this.cameraData.transition.duration;e<=t?i=e:((0,a.rw)(this.cameraData.transition.to,this.cameraData.pose,!1),i=e>=n-t?n-e:t),this.cameraData.transition.blackoutProgress.updateAbsolute(i),this.cameraData.transition.progress.updateAbsolute(e<=t?0:n)}this.cameraData.pose.commit(),this.cameraData.transition.commit()}}endInternalTransition(e){(0,a.rw)(this.cameraData.transition.to,this.cameraData.pose,!1),this.cameraData.transition.type=null,this.cameraData.transition.active=!1,this.cameraData.transition.activeInternal=!1,this.cameraData.transition.progress.stop(1),e===f.n.FadeToBlack&&this.cameraData.transition.blackoutProgress.stop(0),this.cameraData.pose.commit(),this.cameraData.transition.commit()}adjustProjectionZoom(e,t){const i=1/t;return e.elements[0]=i/this.canvas.aspectRatio,e.elements[5]=i,e}setBaseProjection(e){this.cameraData.setBaseProjection(e)}}},47924:(e,t,i)=>{"use strict";var n;i.d(t,{n:()=>n}),function(e){e[e.Instant=0]="Instant",e[e.FadeToBlack=1]="FadeToBlack",e[e.Interpolate=2]="Interpolate"}(n||(n={}))},73029:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r,y:()=>a});var n=i(27468),s=i(47924),o=i(21265);const r=Object.freeze({camera:{transitionBlackoutTime:300,transitionFadeTime:800,baseTransitionTime:o.hu("btt",200),transitionSpeed:o.hu("tsp",3)}}),a={[n.s.Desktop]:s.n.Interpolate,[n.s.Mobile]:s.n.Interpolate,[n.s.VrOrientOnly]:s.n.FadeToBlack,[n.s.VrWithController]:s.n.FadeToBlack,[n.s.VrWithTrackedController]:s.n.FadeToBlack}},75195:(e,t,i)=>{"use strict";i.d(t,{q9:()=>o,bD:()=>r,D_:()=>a,z5:()=>c,st:()=>h,Kh:()=>d,fi:()=>u});var n=i(2212),s=i(27829);const o=(()=>{const e=new n.Matrix4,t=new n.Matrix4;return(i,s,o,r)=>(o=o||new n.Vector2,r=r||new n.Vector3,l(i.pose,t),e.copy(t),e.invert(),r.set(s.x,s.y,s.z).applyMatrix4(e).applyMatrix4(i.pose.projection.asThreeMatrix4()),u(i.width,i.height,r,o),{screenPosition:o,ndcPosition:r})})(),r=(()=>{const e=new n.Vector3,t=new n.Vector2;return(i,n,s,o,r,l)=>(e.copy(a(i,n,s,l)),u(o,r,e,t),t)})(),a=(()=>{const e=new n.Matrix4,t=new n.Matrix4,i=new n.Vector3;return(n,o,r,a)=>(e.compose(o,r,s.f.UNIT),t.copy(e),t.invert(),i.copy(n).applyMatrix4(t).applyMatrix4(a),i)})(),l=(e,t)=>(t=t||new n.Matrix4).compose(e.position,e.rotation,s.f.UNIT),c=(e,t,i,s,o)=>((o=o||new n.Vector2).x=e/i*2-1,o.y=-t/s*2+1,o),h=(e,t,i=.5,s)=>((s=s||new n.Vector3).x=t.x,s.y=t.y,s.z=i,d(e.pose,s)),d=(()=>{const e=new n.Matrix4,t=new n.Matrix4;return(i,s,o)=>((o=o||new n.Vector3).copy(s),t.copy(i.projection.asThreeMatrix4()),t.invert(),l(i,e),o.applyMatrix4(t).applyMatrix4(e))})(),u=(e,t,i,s)=>((s=s||new n.Vector2).set((i.x+1)*e/2,(1-i.y)*t/2),s)},37018:(e,t,i)=>{"use strict";i.d(t,{O:()=>CameraStartData,B:()=>CameraStartPose});var n=i(71208),s=i(19413);class CameraStartData extends s.V{constructor(e,t,i){super(),this.name="cam-start",this.icon=e,this.thumb=t,this.modified=new Date(0),this.pose=new CameraStartPose,i&&this.pose.copy(i)}copy(e){return this.icon=e.icon,this.thumb=e.thumb,this.modified=e.modified||new Date,this.pose.copy(e.pose),this}get hasCameraPose(){return this.pose&&this.pose.camera&&void 0!==this.pose.camera.position}}class CameraStartPose{constructor(e=n.Ey.Panorama,t,i,s,o,r){this.mode=e,this.camera={position:t||void 0,rotation:i||void 0,zoom:s||void 0},this.pano=o||{uuid:void 0},this.floorVisibility=r||void 0}copy(e){return this.camera.position=o(e.camera.position,this.camera.position),this.camera.rotation=o(e.camera.rotation,this.camera.rotation),this.camera.zoom=e.camera.zoom,this.pano.uuid=e.pano.uuid?e.pano.uuid.slice():void 0,this.mode=e.mode,this.floorVisibility=e.floorVisibility?e.floorVisibility.slice():void 0,this}}const o=(e,t)=>e&&t?t.copy(e):e&&!t?e.clone():void 0},87694:(e,t,i)=>{"use strict";i.d(t,{K:()=>NavigationUrl});var n=i(2212),s=i(71208),o=i(21265),r=i(25799),a=i(97620),l=i(60982);const c=new r.Z("navurl");class InvalidViewmodeError extends Error{constructor(e,t){super(`view mode ${e} is invalid${t?` when ${t}`:""}`)}}class NavigationUrl{static encodeVector3(e,t=2){const{x:i,y:n,z:s}=e;return NavigationUrl.packFloats([i,n,s],t)}static decodeVector3(e){const t=NavigationUrl.unpackFloats(e,3);return t?new n.Vector3(...t):null}static encodeQuaternion(e,t=2){return NavigationUrl.packFloats([e.x,e.y,e.z,e.w],t)}static decodeQuaternion(e){const t=NavigationUrl.unpackFloats(e,4);return t&&!(0,l.mB)(t)?new n.Quaternion(...t):null}static encodeEuler(e,t=2){return NavigationUrl.packFloats([e.x,e.y,e.z],t)}static decodeEuler(e){const t=NavigationUrl.unpackFloats(e,3);return t?new n.Euler(t[0],t[1],t[2],"XYZ"):void 0}static packFloats(e,t=2){let i=e.map((e=>{const i=parseFloat(e.toFixed(t)).toString().replace(/^(\-)?0+.(\d+)/,"$1.$2");return"0"===i?"":i})).join(",");return i=i.replace(/,+$/,""),i}static unpackFloats(e,t=0){const i=e.split(",").map((e=>""===e?0:parseFloat(e)));if(!i||i.includes(NaN))return[];for(;i.length<t;)i.push(0);return i}static getQueryString(e,t=!0){const i=NavigationUrl.serialize(e,t);return Object.keys(i).map((e=>e+"="+i[e])).join("&")}static serialize(e,t=!0){const i=NavigationUrl.removeNavigationKeys(o.AO());try{if(t){const t=NavigationUrl.getShortPose(e);Object.assign(i,t)}else{const t=NavigationUrl.getStartPose(e),n=encodeURIComponent(JSON.stringify(t));Object.assign(i,{start:n})}}catch(e){c.debug(e)}return i}static deserialize(e){const t=o.AO(e);try{return"start"in t?NavigationUrl.parseStartObject(t.start):NavigationUrl.parseShortUrl(t)}catch(e){c.debug(e)}return null}static removeNavigationKeys(e){const t=Object.assign({},e);for(const e of["start","sm","sp","sq","sr","ss","sf","sz"])delete t[e];return t}static parseShortUrl(e){const{sm:t,sp:i,sq:o,sr:r,ss:l,sf:h,sz:d}=e,u=NavigationUrl.parseViewmode(t),p=NavigationUrl.decodeEuler(r||"")||new n.Euler(0,0,0),m=NavigationUrl.decodeQuaternion(o||"")||new n.Quaternion(0,0,0,1),g=i?NavigationUrl.decodeVector3(i):void 0,f=l?parseInt(l,10)-1:void 0,v=h?NavigationUrl.unpackFloats(h,4):void 0,y=d?parseFloat(d):void 0;if(u===s.Ey.Panorama&&void 0===f)throw new InvalidViewmodeError(u,"sweep index not defined");if(u!==s.Ey.Panorama&&!g)throw new InvalidViewmodeError(u,"position is falsy");let b=o?m:(new n.Quaternion).setFromEuler(p);u===s.Ey.Panorama&&(b=(0,a.Z)(b));const w={mode:u,quaternion:b,position:g||void 0,sweepIndex:f,floorVisibility:v,zoom:y};return c.debug("Parsed short URL pose data:",w),w}static parseStartObject(e){const t=JSON.parse(decodeURIComponent(e));if(!t.camera_quaternion)throw Error("Start override is missing camera_quaternion");if(!t.camera_position)throw Error("Start override is missing camera_position");const i=NavigationUrl.parseViewmode(t.camera_mode),s=(new n.Quaternion).copy(t.camera_quaternion),o={mode:i,panoId:t.scan_id,position:(new n.Vector3).copy(t.camera_position),quaternion:s,zoom:t.ortho_zoom,floorVisibility:t.floor_visibility};return c.debug("Parsed &start URL pose data:",o),o}static getShortPose({cameraData:e,viewmodeData:t,floorsViewData:i,sweepData:o}){const r=(new n.Euler).setFromQuaternion(e.pose.rotation,"XYZ"),a=o.currentSweepIndex,l={};if(t.currentMode===s.Ey.Panorama)r.z=0,l.sr=NavigationUrl.encodeEuler(r),void 0!==a&&(l.ss=a+1);else{l.sm=NavigationUrl.validateViewmode(t.currentMode),l.sr=NavigationUrl.encodeEuler(r),l.sp=NavigationUrl.encodeVector3(e.pose.position);const n=i.getFloorsVisibility();n.length&&i.totalFloors>1&&(l.sf=n)}return t.currentMode===s.Ey.Floorplan&&(l.sz=parseFloat(e.zoom().toFixed(2))),l.sq=NavigationUrl.encodeQuaternion(e.pose.rotation),c.debug(`Short URL params for current location ${JSON.stringify(l)}`),delete l.sq,l}static getStartPose({cameraData:e,viewmodeData:t,floorsViewData:i,sweepData:n}){const o={x:0,y:0,z:0,w:1};o.x=e.pose.rotation.x,o.y=e.pose.rotation.y,o.z=e.pose.rotation.z,o.w=e.pose.rotation.w;const r={x:0,y:0,z:0};r.x=e.pose.position.x,r.y=e.pose.position.y,r.z=e.pose.position.z;const a={camera_mode:NavigationUrl.validateViewmode(t.currentMode),camera_position:r,camera_quaternion:o};return t.currentMode===s.Ey.Panorama?a.scan_id=n.currentSweep:a.floor_visibility=i.getFloorsVisibility(),t.currentMode===s.Ey.Floorplan&&(a.ortho_zoom=e.zoom()),a}static parseViewmode(e){let t=NavigationUrl.DEFAULT_VIEW_MODE;return void 0!==e&&(t=parseInt(e,10)),NavigationUrl.validateViewmode(t)}static validateViewmode(e){if(null===e||!NavigationUrl.VALID_URL_VIEW_MODES.includes(e))throw new InvalidViewmodeError(e);return e}}NavigationUrl.DEFAULT_VIEW_MODE=s.Ey.Panorama,NavigationUrl.VALID_URL_VIEW_MODES=[s.Ey.Panorama,s.Ey.Dollhouse,s.Ey.Floorplan,s.Ey.Outdoor]},17338:(e,t,i)=>{"use strict";i.d(t,{n:()=>SetCameraStartCommand});var n=i(99681);class SetCameraStartCommand extends n.m{constructor(e){super(),this.payload={snapshotSid:e}}}SetCameraStartCommand.id="SET_CAMERA_START"},66997:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>CameraStartModule});var n=i(26247),s=i(37018),o=i(54122),r=i(87694),a=i(71208),l=i(18446),c=i(25799),h=i(77956),d=i(97620),u=i(43894),p=i(17256),m=i(44333),g=i(32400),f=i(70096);class MdsCameraStartPatchSerializer{serialize(e){return{image:e.sid}}}var v=i(52227);const y=new c.Z("mds-camera-start-store");class MdsCameraStartStore extends g.u{constructor(){super(...arguments),this.deserializer=new f.f,this.serializer=new MdsCameraStartPatchSerializer}async update(e){const t=this.getViewId(),i=this.serializer.serialize(e);if(0===Object.keys(i).length)throw new Error("No data to update?");return this.mutate(v.PatchModel,{modelId:t,patch:i}).then((e=>{y.debug(e)}))}}var b=i(17338),w=i(20331),S=i(41263),E=i(80034),T=i(32020),M=i(68519);const _=e=>{if(!e)return null;const t=new s.O;if(!e.icon)return null;t.modified=(0,T.p)(e&&e.modified),t.icon=e.icon||void 0,t.pose={};const i=250,n=Math.ceil(140.625),o=e.image?`${e.image}&width=${i}&height=${n}&fit=crop&imgopt=1`:void 0;return t.thumb=o?new M.n(o,null):void 0,t},x=(e,t)=>{const i=t&&"icon"in t?t:e;return{modified:(0,T.U)(i.modified),icon:i.icon}};var A=i(15119),O=i(7943);var P=i(83032),C=i(21307);class MarketMonitor{constructor(e,t){this.hasChanges=!1,this.changedHandlers=[],e.waitForData(t).then((e=>{this.target=e,e.onChanged((()=>{this.hasChanges=!0,this.triggerChangeHandlers(this.target)}))}))}hasDiffRecord(){return this.hasChanges}getDiffRecord(){return this.target}clearDiffRecord(){this.hasChanges=!1}commitChanges(){this.triggerChangeHandlers(this.getDiffRecord())}onChanged(e){this.changedHandlers.push(e)}removeOnChanged(e){(0,C.b)(this.changedHandlers,e)}triggerChangeHandlers(e){if(this.changedHandlers.length>0)for(const t of this.changedHandlers)t(e)}}var D=i(55580);const I=new c.Z("camera-start");class CameraStartModule extends o.Y{constructor(){super(...arguments),this.name="camera-start",this.store=null}async init(e,t){var i;this.engine=t,[this.storage,this.sweepData,this.modelData,this.snapshotsData]=await Promise.all([t.getModule(u.F),t.market.waitForData(h.Z),t.market.waitForData(D.T),t.market.waitForData(n.P)]),this.store=this.getStore(e);let o=this.modelData.model.image;if(!e.readonly&&this.store instanceof P.N){const e=await this.store.read();e&&e.icon&&(o=e.icon)}const a=r.K.deserialize();if(a){const e=this.parseNavigationPose(a);this.validStartPano(e)?(this.startingPose=new s.B,this.startingPose.copy(e),I.debug("Starting Camera Pose",this.startingPose)):I.error("Invalid start pose",e)}this.bindings.push(this.engine.commandBinder.addBinding(b.n,(async e=>this.updateStartLocationFromSnapshot(e.snapshotSid))),this.storage.onSave((()=>this.save()),{dataType:p.g.START_LOCATION}),this.storage.onRevert((()=>this.revert()),{dataType:p.g.START_LOCATION}));const l=o||void 0,c=this.getIconThumbnail(l),d=this.getIconStartPose(l)||this.getStartFallback();if(null===(i=null==d?void 0:d.pano)||void 0===i?void 0:i.uuid){const e=this.sweepData.getSweep(d.pano.uuid);e&&!e.enabled&&(I.warn(`Enabled hidden start sweep ${d.pano.uuid}`),e.enabled=!0,e.commit())}this.data=new s.O(l,c,d),t.market.register(this,s.O,this.data)}getStore(e){const{modelId:t,baseUrl:i,readonly:n,storageProvider:o,queue:r}=e;if(I.info(`Loading camera start from ${o}`),o===p.Xq.MDS)return new MdsCameraStartStore({readonly:n});const a=function(e){const{modelId:t,readonly:i}=e,n=e.baseUrl||"",s=e.queue||new w.gO,o={data:null},r=`${n}/api/v1/player/models/${t}`;if(i){const e=new E.gh({queue:s,path:r,deserialize:_,cachedData:o});return new S.nM({publishStores:[e]})}const a=new E.yh({queue:s,path:r,httpMethod:E.w$.PATCH,deserialize:_,serialize:x}),l=`${n}/api/v1/jsonstore/model/workshopSession/${t}`,c=new A.Z({queue:s,path:l,cachedData:{data:null},httpMethod:E.w$.PATCH,deserialize:O.S.sessionObjectExtract(A.j.Model,_),serialize:x},A.j.Model);return new S.nM({publishStores:[a],editStore:c,editStoreKey:S.aw.START_LOCATION})}({modelId:t,baseUrl:i,readonly:n,queue:r});if(!n){const e=new MarketMonitor(this.engine.market,s.O);a.addMonitor(e)}return new P.N(a,{dataType:p.g.START_LOCATION,modelId:t,readonly:n,engine:this.engine})}getStartingPose(){return this.startingPose||this.data.pose}parseNavigationPose(e){const{mode:t,quaternion:i,position:n,floorVisibility:s,sweepIndex:o,zoom:r}=e;let{panoId:a}=e;if(!a&&void 0!==o){const e=this.sweepData.getSweepByIndex(o);e?a=e.id:I.debug(`Failed to load sweep index ${o}`)}return{mode:t,camera:{position:n,rotation:i,zoom:r},pano:{uuid:a},floorVisibility:s}}async updateStartLocationFromSnapshot(e){const t=this.snapshotsData.get(e),i=this.buildCameraStart(t),n=new s.O(t.sid,t.thumbnailUrl,i);this.data.copy(n),this.data.commit(),this.engine.broadcast(new l.O(t.is360)),await this.engine.commandBinder.issueCommand(new m.VQ({dataTypes:[p.g.START_LOCATION]}))}async save(){const e=this.data.icon;if(!e||!this.store)return void I.warn("Unable to save start location");if(this.store instanceof P.N)return;const t=this.snapshotsData.get(e);return this.store.update(t)}async revert(){if(this.store instanceof P.N)return this.store.revert()}buildCameraStart(e){const t={mode:e.metadata.cameraMode,camera:{position:e.metadata.cameraPosition,rotation:e.metadata.cameraQuaternion,zoom:e.metadata.orthoZoom},pano:{}};return t.mode===a.Ey.Panorama&&(t.pano={uuid:e.metadata.scanId}),t.floorVisibility=e.metadata.floorVisibility,t}defaultCameraStart(e){return{mode:a.Ey.Panorama,camera:{position:e.position,rotation:(0,d.Z)(e.rotation),zoom:0},pano:{uuid:e.id}}}validStartPano(e){return!!e&&(e.mode!==a.Ey.Panorama||!!e.pano.uuid&&this.sweepData.containsSweep(e.pano.uuid))}getStartFallback(){const e=this.sweepData.getFirstAlignedSweep();return this.defaultCameraStart(e||this.sweepData.getFirstSweep())}getIconStartPose(e){let t=null;return e&&e in this.snapshotsData.collection&&(t=(new s.B).copy(this.buildCameraStart(this.snapshotsData.get(e)))),this.validStartPano(t)||(t=null),t}getIconThumbnail(e){if(e&&e in this.snapshotsData.collection)return this.snapshotsData.get(e).thumbnailUrl}}},18446:(e,t,i)=>{"use strict";i.d(t,{O:()=>StartLocationSetMessage});var n=i(93528);class StartLocationSetMessage extends n.v{constructor(e){super(),this.is360=e}}},88069:(e,t,i)=>{"use strict";i.d(t,{lb:()=>s,hf:()=>o});var n=i(24779);const s=(e=200)=>({resizeDimensions:[{property:n.P.width,setDimension:e=>e.width,duration:e},{property:n.P.height,setDimension:e=>e.height,duration:e},{property:n.P.top,setDimension:()=>0,duration:e},{property:n.P.left,setDimension:()=>0,duration:e}]}),o=(e,t,i=200)=>{const s=[];return-1!==e&&s.push({property:n.P.width,setDimension:t=>t.width+e,duration:i}),-1!==t&&s.push({property:n.P.height,setDimension:e=>e.height+t,duration:i}),{resizeDimensions:s}}},34431:(e,t,i)=>{"use strict";i.d(t,{n:()=>BlurCanvasCommand});var n=i(99681);class BlurCanvasCommand extends n.m{constructor(e,t){super(),this.name="blur-canvas",this.payload={duration:e,pixelBlur:t}}}},24779:(e,t,i)=>{"use strict";i.d(t,{P:()=>n,M:()=>ResizeCanvasCommand});var n,s=i(99681);!function(e){e.left="left",e.top="top",e.width="width",e.height="height"}(n||(n={}));class ResizeCanvasCommand extends s.m{constructor(e){super(),this.name="resize-canvas",this.payload=Object.assign({},e)}}},69711:(e,t,i)=>{"use strict";i.d(t,{L:()=>ScreenToCanvasPointCommand});var n=i(99681);class ScreenToCanvasPointCommand extends n.m{constructor(e){super(),this.name="screen-to-canvas-point",this.payload=Object.assign({},e)}}},99169:(e,t,i)=>{"use strict";i.d(t,{W:()=>CanvasData});var n=i(19413);class CanvasData extends n.V{constructor(e,t){super(),this.name="canvas",this.x=0,this.y=0,this.width=e||0,this.height=t||0;const i=this.width/this.height;this.aspectRatio=isFinite(i)?i:1}copy(e){this.width=e.width,this.height=e.height,this.aspectRatio=e.width/e.height,this.x=e.x,this.y=e.y}}},32818:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>CanvasModule});var n=i(54122),s=i(99169),o=i(80384),r=i(84637),a=i(24779),l=i(44266),c=i(69711),h=i(62367),d=i(34431),u=i(10396),p=i(17617);class CanvasMountError extends p.y{}class CanvasModule extends n.Y{constructor(){super(...arguments),this.name="canvas",this.getNewX=()=>0,this.getNewY=()=>0,this.getNewWidth=e=>e.width,this.getNewHeight=e=>e.height,this.activeTransitions=[],this.activeTransitionMap={left:null,top:null,width:null,height:null},this.onResize=e=>{e.propertyName in a.P&&(this.resolveActiveTransition(e.propertyName),this._canvas.style.transitionDuration=this.stringifyTransitionDurations())},this.onWindowResize=()=>{this.transitionDurations.left=this.transitionDurations.top=this.transitionDurations.width=this.transitionDurations.height="0s",this._canvas.style.transitionDuration=this.stringifyTransitionDurations(),this.applySize(),this.applyPosition(),this.activeTransitions.forEach(this.resolveActiveTransition.bind(this)),this._canvas.style.transitionDuration=this.stringifyTransitionDurations()},this.resizeCanvas=async e=>{if(!e.resizeDimensions)return;this.activeTransitions.forEach(this.resolveActiveTransition.bind(this));const t=e.resizeDimensions.map((e=>{const{property:t,setDimension:i,duration:n}=e;switch(t){case a.P.height:this.setHeight(i,n);break;case a.P.width:this.setWidth(i,n);break;case a.P.top:this.setY(i,n);break;case a.P.left:this.setX(i,n)}const s=new l.Q;return this.activeTransitionMap[t]=s,this.activeTransitions.push(t),s}));return this.resolveNoopTransitions(),this.hasActiveTransitions()||(this.canvasBounds=this._canvas.getBoundingClientRect()),Promise.all(t)}}async init(e,t){if(this.engine=t,!e.container)throw new CanvasMountError;this.container=e.container,this.container.appendChild(e.canvas),this.containerBounds=this.container.getBoundingClientRect(),this._canvas=e.canvas,this._canvas.setAttribute("tabindex","-1"),this._canvas.style.position="absolute",this._canvas.style.left="0",this._canvas.style.top="0",this.transitionDurations={left:"0s",top:"0s",width:"0s",height:"0s",filter:"0.4s"},this._canvas.style.transitionProperty=Object.keys(this.transitionDurations).join(","),this._canvas.style.transitionDuration=this.stringifyTransitionDurations(),this.updateTransitions(),this.bindings.push((0,u.kp)(u.g_.RESIZE,this.onWindowResize),t.commandBinder.addBinding(a.M,this.resizeCanvas),this.makeTransitionEndSubscription(),t.commandBinder.addBinding(c.L,(async e=>this.screenToCanvasPoint(e.x,e.y))),t.commandBinder.addBinding(d.n,this.blur.bind(this)));for(const e of this.bindings)e.renew();this.canvasBounds=this._canvas.getBoundingClientRect(),this.containerBounds=this.container.getBoundingClientRect(),this.data=new s.W(this.canvasBounds.width,this.canvasBounds.height),t.market.register(this,s.W,this.data)}resolveNoopTransitions(){const e=this.containerBounds;this.getNewHeight(e)!==this.data.height&&parseInt(this.transitionDurations[a.P.height],10)||this.resolveActiveTransition(a.P.height),this.getNewWidth(e)!==this.data.width&&parseInt(this.transitionDurations[a.P.width],10)||this.resolveActiveTransition(a.P.width),this.getNewY(e)+this.containerBounds.top!==this.data.y&&parseInt(this.transitionDurations[a.P.top],10)||this.resolveActiveTransition(a.P.top),this.getNewX(e)+this.containerBounds.left!==this.data.x&&parseInt(this.transitionDurations[a.P.left],10)||this.resolveActiveTransition(a.P.left),this._canvas.style.transitionDuration=this.stringifyTransitionDurations()}makeTransitionEndSubscription(){let e=!1;return{renew:()=>{e||(this.element.addEventListener("transitionend",this.onResize),e=!0)},cancel:()=>{e&&(this.element.removeEventListener("transitionend",this.onResize),e=!1)}}}dispose(e){super.dispose(e)}get element(){return this._canvas}get width(){return this.canvasBounds.width}get height(){return this.canvasBounds.height}get x(){return this.canvasBounds.left}get y(){return this.canvasBounds.top}onUpdate(){const e=this.container.getBoundingClientRect(),t=this.containerHasChanged(e);t&&(this.containerBounds=e,this.updateTransitions()),(t||this.hasActiveTransitions())&&(this.canvasBounds=this._canvas.getBoundingClientRect());const i=this.data.width!==this.width||this.data.height!==this.height,n=this.data.x!==this.x||this.data.y!==this.y;i&&(this.data.width=this.width,this.data.height=this.height,this.data.commit(),this.engine.broadcast(new o.a(this.width,this.height))),n&&(this.data.x=this.x,this.data.y=this.y,this.data.commit(),this.engine.broadcast(new r.k(this.x-this.containerBounds.left,this.y-this.containerBounds.top)))}containerHasChanged(e){return e.left!==this.containerBounds.left||e.top!==this.containerBounds.top||e.width!==this.containerBounds.width||e.height!==this.containerBounds.height}setX(e,t=0){this.getNewX="number"==typeof e?()=>e:e,this.transitionDurations.left=`${t}ms`,this.updateTransitions()}setY(e,t=0){this.getNewY="number"==typeof e?()=>e:e,this.transitionDurations.top=`${t}ms`,this.updateTransitions()}setWidth(e,t=0){this.getNewWidth="number"==typeof e?()=>e:e,this.transitionDurations.width=`${t}ms`,this.updateTransitions()}setHeight(e,t=0){this.getNewHeight="number"==typeof e?()=>e:e,this.transitionDurations.height=`${t}ms`,this.updateTransitions()}screenToCanvasPoint(e,t){return{x:e-this.x,y:t-this.y}}async blur(e){this.transitionDurations.filter=`${e.duration}ms`,this._canvas.style.transitionDuration=this.stringifyTransitionDurations(),this._canvas.style.filter=`blur(${e.pixelBlur}px)`,await(0,h.gw)(e.duration),0===e.pixelBlur&&(this._canvas.style.filter="")}getTransitionPromise(){return Promise.all(this.activeTransitions.map((e=>this.activeTransitionMap[e])).filter((e=>!!e)))}updateTransitions(){this._canvas.style.transitionDuration=this.stringifyTransitionDurations(),this.applySize(),this.applyPosition()}applySize(){this._canvas.style.width=`${this.getNewWidth(this.containerBounds)}px`,this._canvas.style.height=`${this.getNewHeight(this.containerBounds)}px`}applyPosition(){this._canvas.style.left=`${this.getNewX(this.containerBounds)}px`,this._canvas.style.top=`${this.getNewY(this.containerBounds)}px`}stringifyTransitionDurations(){return Object.keys(this.transitionDurations).map((e=>this.transitionDurations[e])).join(",")}resolveActiveTransition(e){const t=this.activeTransitions.indexOf(e);-1!==t&&this.activeTransitions.splice(t,1);const i=this.activeTransitionMap[e];i&&i.resolve(),this.activeTransitionMap[e]=null,this.transitionDurations[e]="0s"}hasActiveTransitions(){return this.activeTransitions.length>0}}},22888:(e,t,i)=>{"use strict";i.d(t,{Z:()=>CommonControls});class CommonControls{}},60959:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>CommonControlsModule});var n=i(54122),s=i(12775);class CommonControlsModule extends n.Y{constructor(){super(...arguments),this.name="common-controls"}async init(e,t){this.modeControls={},t.market.waitForData(s.O).then((e=>this.viewmodeData=e))}startRotateTransition(e,t,i=!0){return this.checkControlsForAction((n=>n.startRotateTransition(e,t,i)))}startZoomTransition(e,t,i=!0){return this.checkControlsForAction((n=>n.startZoomTransition(e,t,i)))}startTranslateTransition(e,t,i=!0){return this.checkControlsForAction((n=>n.startTranslateTransition(e,t,i)))}stop(){return this.checkControlsForAction((e=>(e.stop(),Promise.resolve())))}checkControlsForAction(e){if(this.viewmodeData&&null!==this.viewmodeData.currentMode){if(this.modeControls[this.viewmodeData.currentMode]){return e(this.modeControls[this.viewmodeData.currentMode].controls)}}return Promise.reject("checkControlsForAction() -> Current view mode is null")}addControls(e,t,i=!1){this.modeControls[e]&&!i||(this.modeControls[e]={mode:e,controls:t})}}},63771:(e,t,i)=>{"use strict";i.d(t,{$:()=>TogglePanoMarkerCommand});var n=i(99681);class TogglePanoMarkerCommand extends n.m{constructor(e){super(),this.id="TOGGLE_PANO_MARKER",this.payload={enabled:e}}}},72075:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>CurrentPanoMarker});var n=i(54122),s=i(71208),o=i(2212),r=i(20599);class MarkerRenderer{constructor(e,t,i,n,s){this.scene=e,this.viewmodeData=i,this.sweepData=n,this.panoMarkerEnabled=!0,this.material=new o.MeshBasicMaterial({transparent:!0,map:t,depthWrite:!1}),this.mesh=new o.Mesh(MarkerRenderer.planeGeometry,this.material),this.mesh.name="CurrentPanoMarker",this.mesh.renderOrder=r.z.panoMarker,this.mesh.layers.mask=s.mask,this.mesh.lookAt(this.mesh.position.clone().setY(1))}init(){}dispose(){this.material.map&&this.material.map.dispose(),this.mesh.geometry.dispose()}render(){const e=this.sweepData.currentAlignedSweepObject;!this.panoMarkerEnabled||this.viewmodeData.currentMode===s.Ey.Panorama||this.viewmodeData.currentMode===s.Ey.Transition||!e?this.resetMesh():(this.move(e.floorPosition),this.material.opacity=1)}activate(){this.scene.add(this.mesh)}deactivate(){this.scene.remove(this.mesh)}togglePanoMarker(e){this.panoMarkerEnabled=e}move(e){this.mesh.position.copy(e).setY(e.y+MarkerRenderer.floorOffset)}resetMesh(){this.material.opacity=0}}MarkerRenderer.floorOffset=.01,MarkerRenderer.planeGeometry=new o.PlaneGeometry(.5,.5);var a=i(60778),l=i(50101),c=i(12775),h=i(77956),d=i(99612),u=i(63771);class CurrentPanoMarker extends n.Y{constructor(){super(...arguments),this.name="current-pano-marker"}async init(e,t){const i=(0,a.p)(d),n=(await t.getModule(l.default)).getScene(),s=await t.market.waitForData(h.Z),o=await t.market.waitForData(c.O),r=t.claimRenderLayer(this.name),p=new MarkerRenderer(n,i,o,s,r);t.addComponent(this,p),this.bindings.push(t.commandBinder.addBinding(u.$,(async e=>{p.togglePanoMarker(e.enabled)})))}}},90014:(e,t,i)=>{"use strict";i.d(t,{y:()=>DisableCursorMeshCommand});var n=i(99681);class DisableCursorMeshCommand extends n.m{constructor(e){super(),this.payload={disable:e}}}},5002:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>CursorController});var n=i(54122),s=i(77518),o=i(71208),r=i(12775),a=i(98728),l=i(75711),c=i(77956),h=i(90014),d=i(39936),u=i(34216);class CursorController extends n.Y{constructor(){super(...arguments),this.name="cursor-controller",this.visibilityRules=[],this.disabled=!1}async init(e,t){this.cursorMesh=await t.getModule(s.default),this.visibilityRules.push((()=>{const e=t.market.tryGetData(r.O);return!!e&&e.closestMode===o.Ey.Panorama}),(()=>{const e=t.market.tryGetData(c.Z);return!!e&&!e.isSweepUnaligned(e.currentSweep)}),(()=>{const e=t.market.tryGetData(a.k3);return!!e&&!e.isTourActive()}),(()=>{const e=t.market.tryGetData(l.Z);return!!e&&!e.isMobile()}),(()=>{const e=t.market.tryGetData(d.e);return!!e&&e.tryGetProperty(u.b,!0)})),this.bindings.push(t.commandBinder.addBinding(h.y,(async e=>{this.disabled=e.disable})))}onUpdate(){this.updateCursorVisibility()}addVisibilityRule(e){this.visibilityRules.push(e)}removeVisibilityRule(e){const t=this.visibilityRules.indexOf(e);-1!==t&&this.visibilityRules.splice(t,1)}updateCursorVisibility(){const e=!this.disabled&&this.visibilityRules.reduce(((e,t)=>e&&t()),!0);this.cursorMesh.setVisible(e)}}},34216:(e,t,i)=>{"use strict";i.d(t,{b:()=>n});const n="features/cursor"},60484:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>CursorDataModule});var n=i(54122),s=i(2212),o=i(3834),r=i(36073),a=i(30963),l=i(25799),c=i(24135);const h=new l.Z("cursor-data");class CursorDataModule extends n.Y{constructor(){super(...arguments),this.name="cursor-data",this.cursorState=new o.Y,this.position=new s.Vector2,this.timeToFade=0,this.onPointerMove=()=>{if(null!==this.raycasterData.hit&&this.raycasterData.pointerNdcPosition.distanceToSquared(this.position)>CursorDataModule.movementThreshold){this.position.copy(this.raycasterData.pointerNdcPosition),this.timeToFade=CursorDataModule.fadeOutDelay;const e=s.MathUtils.lerp(0,CursorDataModule.fadeInDuration,1-this.cursorState.opacity.value);this.cursorState.opacity.modifyAnimation(this.cursorState.opacity.value,1,e),this.cursorState.commit()}}}async init(e,t){this.input=await t.getModule(a.default),this.raycasterData=await t.market.waitForData(c.P),t.market.register(this,o.Y,this.cursorState),this.bindings.push(this.input.registerHandler(r.mE,this.onPointerMove)),CursorDataModule.fadeInDuration>CursorDataModule.fadeOutDelay&&h.warn("fadeInDuration should be less than fadeOutDelay!")}onUpdate(e){let t=!1;this.timeToFade>0&&(this.timeToFade-=e,this.timeToFade<=0&&(t=!0)),this.cursorState.opacity.tick(e),this.cursorState.commit(),t&&this.cursorState.opacity.modifyAnimation(1,0,CursorDataModule.fadeOutDuration)}dispose(e){super.dispose(e)}}CursorDataModule.fadeOutDelay=700,CursorDataModule.fadeOutDuration=700,CursorDataModule.fadeInDuration=300,CursorDataModule.movementThreshold=.003},3834:(e,t,i)=>{"use strict";i.d(t,{Y:()=>CursorData});var n=i(290),s=i(19413);class CursorData extends s.V{constructor(){super(),this.name="cursor",this.opacity=new n.z(0)}}},16002:(e,t,i)=>{"use strict";var n;i.d(t,{L:()=>n}),function(e){e[e.Reticle=0]="Reticle",e[e.GridPlane=1]="GridPlane"}(n||(n={}))},77518:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>CursorMesh});var n=i(54122),s=i(2212),o=i(3834),r=i(24135),a=i(2779),l=i(27829),c=i(60778),h=i(16002),d=i(408),u=i(20599);class Cursor{constructor(e,t=a.o.ALL){this.scene=e,this.layer=t,this.supportsMobile=!1,this.style=h.L.Reticle,this.defaultTexture=(0,c.p)(d),this.bindings=[],this.onOpacityUpdate=e=>{this.material.opacity=e.opacity.value},this.onPositionUpdate=e=>{if(e.hit&&e.hit.face){const t=e.hit.point.clone(),i=e.hit.face.normal;this.container.position.copy(t).addScaledVector(i,.01),this.container.quaternion.setFromUnitVectors(l.f.FORWARD,i)}},this.container=new s.Group,this.container.name="cursor";const i=new s.PlaneGeometry(.4,.4);this.material=new s.MeshBasicMaterial({side:s.DoubleSide,transparent:!0,depthTest:!0,depthWrite:!1,map:this.defaultTexture});const n=new s.Mesh(i,this.material);this.container.add(n),n.renderOrder=u.z.reticule,n.layers.mask=this.layer.mask}init(){}render(){}dispose(){this.material.map&&this.material.map.dispose(),this.container.children.forEach((e=>{if(e.isMesh){e.geometry.dispose();const t=e.material;t.dispose(),t.map&&t.map.dispose()}}))}async activate(e){const t=await e.market.waitForData(o.Y),i=await e.market.waitForData(r.P);this.bindings.push(t.onChanged(this.onOpacityUpdate),i.onChanged(this.onPositionUpdate)),this.scene.add(this.container)}deactivate(){for(const e of this.bindings)e.cancel();this.bindings.length=0,this.scene.remove(this.container)}setVisible(e){this.container.visible=e}}var p=i(50101);class CursorMesh extends n.Y{constructor(){super(...arguments),this.name="cursor-mesh",this.setVisible=e=>{this.cursor&&this.cursor.setVisible(e)}}async init(e,t){const i=(await t.getModule(p.default)).getScene(),n=t.claimRenderLayer(this.name);this.cursor=new Cursor(i,n),t.addComponent(this,this.cursor)}get container(){return this.cursor.container}}},33474:(e,t,i)=>{"use strict";i.d(t,{C:()=>SetDollhouseVerticalLimits});var n=i(99681);class SetDollhouseVerticalLimits extends n.m{constructor(e){super(),this.payload=e,this.id="DOLLHOUSE_VERTICAL_LIMITS"}}},23113:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>DollhouseControls});var n=i(54122),s=i(27829),o=i(60959),r=i(30963),a=i(30604),l=i(21588),c=i(78626),h=i(35825),d=i(22767),u=i(40582),p=i(48840),m=i(12775),g=i(71208),f=i(21265),v=i(67126),y=i(97620),b=i(2212),w=i(64279),S=i(25259),E=i(27871),T=i(62513),M=i(45805),_=i(22888),x=i(44266),A=i(47924);const O=1e3/60,P=80*y.Ue,C=0*y.Ue,D=Math.PI/1e3,I=M.Z.epsilon;class CameraControls extends _.Z{constructor(e,t,i,n=!1){super(),this.cameraPoseProxy=e,this.cameraCheck=t,this.tempOrientation=new b.Quaternion,this.tempAxis=new b.Vector3,this.nextPosition=new b.Vector3,this.nextOrientation=new b.Quaternion,this.currentOrientation=new b.Quaternion,this.currentPosition=new b.Vector3,this.positionDelta=new b.Vector3,this.angularAccel=new b.Vector2,this.angularVelocity=new b.Vector2,this.linearAccel=new b.Vector2,this.linearVelocity=new b.Vector2,this.zoomAccel=0,this.zoomVelocity=0,this.cameraOrientation=new b.Euler,this.aimTarget=new b.Vector3,this.poseController=null,this.currentPhiLowerLimit=C,this.currentPhiUpperLimit=P,this.checkBounds=n,this._maxZoomDistance=Math.max(30,1.5*i.getSize(new b.Vector3).length()),this.transition={active:!1,startTime:0,elapsed:0,duration:0,angularVelocity:new b.Vector2,linearVelocity:new b.Vector2,zoomVelocity:0,easeOut:!1}}onAccessGranted(e){this.poseController=e}onAccessRevoked(e){this.stop()}get maxZoomDistance(){return this._maxZoomDistance}setOrbitalAcceleration(e,t=!1){this.transition.active||(t&&this.haltVelocity(e,this.angularVelocity),this.angularAccel.x=void 0!==e.x?e.x:this.angularAccel.x,this.angularAccel.y=void 0!==e.y?e.y:this.angularAccel.y)}setPanAcceleration(e,t=!1){this.transition.active||(t&&this.haltVelocity(e,this.linearVelocity),this.linearAccel.x=void 0!==e.x?e.x:this.linearAccel.x,this.linearAccel.y=void 0!==e.y?e.y:this.linearAccel.y)}setZoomAcceleration(e){this.transition.active||(this.zoomAccel=e)}async setPhiLimits(e,t,i){this.currentPhiLowerLimit=e,this.currentPhiUpperLimit=t;const n=this.cameraPoseProxy.pose;this.cameraOrientation.setFromQuaternion(n.rotation,"YXZ");const s=-this.cameraOrientation.x;0!==(0,v.uZ)(0,this.currentPhiLowerLimit-s,this.currentPhiUpperLimit-s)&&i&&await this.orbit(new b.Vector2,!0)}haltVelocity(e,t){e.x&&t.x&&Math.sign(e.x)!==Math.sign(t.x)&&(t.x=0),e.y&&t.y&&Math.sign(e.y)!==Math.sign(t.y)&&(t.y=0)}startTransition(e,t,i,n,s){if(null===this.poseController)return x.Q.reject("Unable to start transition, since controller is unavailable.");const o=new x.Q;return this.transition.active=!0,this.transition.duration=e,this.transition.elapsed=0,this.transition.startTime=Date.now(),this.transition.deferred=o,this.transition.angularVelocity.copy(t),this.transition.linearVelocity.copy(i),this.transition.zoomVelocity=n,this.transition.easeOut=s,this.angularAccel.set(0,0),this.linearAccel.set(0,0),this.zoomAccel=0,this.angularVelocity.copy(t),this.linearVelocity.copy(i),this.zoomVelocity=n,this.poseController.beginExternalTransition(),o.promise()}stopTransition(){this.transition.active&&(this.poseController&&this.poseController.endExternalTransition(),this.transition.active=!1),this.transition.deferred&&(this.transition.deferred.resolve(),this.transition.deferred=void 0)}updateTransition(e,t,i,n){let s=1,o=e/O;if(this.transition.elapsed+=e,this.transition.elapsed>=this.transition.duration){s=(this.transition.duration-(this.transition.elapsed-e))/e,o=1}t&&(this.angularVelocity.copy(this.transition.angularVelocity).multiplyScalar(s*o),this.orbit(this.angularVelocity)),i&&(this.linearVelocity.copy(this.transition.linearVelocity).multiplyScalar(s*o),this.pan(this.linearVelocity)),n&&(this.zoomVelocity=this.transition.zoomVelocity*s*o,this.zoom(this.zoomVelocity)),this.transition.elapsed>=this.transition.duration&&(this.stop(this.transition.easeOut),this.transition.active=!1)}updateDefault(e,t,i,n){const s=e/O;t&&(this.angularVelocity.addScaledVector(this.angularAccel,s),this.orbit(this.angularVelocity),this.angularVelocity.multiplyScalar(Math.pow(.92,s))),i&&(this.linearVelocity.addScaledVector(this.linearAccel,s),this.pan(this.linearVelocity),this.linearVelocity.multiplyScalar(Math.pow(.92,s))),n&&(this.zoomVelocity+=this.zoomAccel*s,this.zoom(this.zoomVelocity),this.zoomVelocity*=Math.pow(.84,s))}startRotateTransition(e,t,i){return t.x*=-1,this.startTransition(e,t.clone().multiplyScalar(O),new b.Vector2,0,i).nativePromise()}startTranslateTransition(e,t,i=!0){return this.startTransition(e,new b.Vector2,t.clone().multiplyScalar(O),0,i).nativePromise()}startZoomTransition(e,t,i){return this.startTransition(e,new b.Vector2(0,0),new b.Vector2(0,0),t,i).nativePromise()}update(e){const t=this.angularAccel.length()>I||this.angularVelocity.length()>I,i=this.linearAccel.length()>I||this.linearVelocity.length()>I,n=Math.abs(this.zoomAccel)>I||Math.abs(this.zoomVelocity)>I;this.transition.active?this.updateTransition(e,t,i,n):this.updateDefault(e,t,i,n)}stopMomentum(){this.transition.active||(this.angularVelocity.set(0,0),this.linearVelocity.set(0,0),this.zoomVelocity=0)}stopAcceleration(){this.transition.active||(this.setOrbitalAcceleration({x:0,y:0}),this.setPanAcceleration({x:0,y:0}),this.setZoomAcceleration(0))}stop(e=!1){this.stopTransition(),this.stopAcceleration(),e||this.stopMomentum()}pan(e){if(!this.poseController)return;const t=this.cameraPoseProxy.pose;this.positionDelta.x=e.x,this.positionDelta.z=e.y,this.nextPosition.copy(t.position).add(this.positionDelta),this.checkBounds&&!this.cameraCheck(this.nextPosition,t.rotation,t.focalDistance)||(this.currentPosition.copy(this.nextPosition),this.poseController.updateCameraPosition(this.currentPosition))}orbit(e,t=!1){if(!this.poseController)return;const i=this.cameraPoseProxy.pose;this.cameraOrientation.setFromQuaternion(i.rotation,"YXZ");const n=-this.cameraOrientation.x,o=(0,v.uZ)(e.y,this.currentPhiLowerLimit-n,this.currentPhiUpperLimit-n);if(this.aimTarget.copy(s.f.FORWARD).applyQuaternion(i.rotation),this.aimTarget.setLength(i.focalDistance),this.aimTarget.addVectors(i.position,this.aimTarget),this.tempAxis.copy(s.f.RIGHT),this.tempOrientation.setFromAxisAngle(this.tempAxis.applyQuaternion(i.rotation),-o),this.nextPosition.copy(i.position).sub(this.aimTarget).applyQuaternion(this.tempOrientation),this.nextOrientation.copy(i.rotation).premultiply(this.tempOrientation),this.tempOrientation.setFromAxisAngle(s.f.UP,e.x),this.nextPosition.applyQuaternion(this.tempOrientation),this.nextOrientation.premultiply(this.tempOrientation),this.nextPosition=this.nextPosition.add(this.aimTarget),this.nextOrientation.normalize(),!this.checkBounds||this.cameraCheck(i.position,this.nextOrientation,i.focalDistance)){if(this.currentPosition.copy(this.nextPosition),this.currentOrientation.copy(this.nextOrientation),t)return this.poseController.moveTo({transitionType:A.n.Interpolate,pose:{position:this.currentPosition.clone(),rotation:this.currentOrientation.clone()},transitionTime:500});i.rotation.equals(this.currentOrientation)||(this.poseController.updateCameraPosition(this.currentPosition),this.poseController.updateCameraRotation(this.currentOrientation))}}zoom(e){if(!this.poseController)return;const t=this.cameraPoseProxy.pose,i=this.maxZoomDistance-2,n=t.focalDistance,o=(0,v.uZ)(e*i+n,2,this.maxZoomDistance)-n,r=t.focalDistance+o;this.nextPosition.copy(t.position).add(s.f.FORWARD.clone().applyQuaternion(t.rotation).setLength(-o)),this.checkBounds&&!this.cameraCheck(this.nextPosition,t.rotation,r)||(this.currentPosition.copy(this.nextPosition),this.poseController.updateCameraPosition(this.currentPosition),this.poseController.updateCameraFocus(r))}}var R=i(75195);class CameraTouchControls{constructor(e,t,i){this.poseProxy=e,this.cameraCheck=t,this.raycaster=i,this.movingCamera=!1,this.smoothedTouch0=new b.Vector2,this.smoothedTouch1=new b.Vector2,this.origTouchAxis=new b.Vector2,this.origCenterPt=new b.Vector2,this.plane=new b.Plane(s.f.UP.clone(),0),this.originalPinchLength=0,this.pointersMoved=(()=>{const e=new b.Vector2,t=new b.Vector3,i=new b.Vector3,n=new b.Vector2,o=new b.Vector3;return r=>{if(!this.poseController)return;this.smoothedTouch0.lerp(r[0].position,.2),this.smoothedTouch1.lerp(r[1].position,.2),n.copy(this.smoothedTouch1).sub(this.smoothedTouch0).normalize();const a=this.origTouchAxis.angle()-n.angle();t.copy(this.initialPose.position);const l=new b.Vector3(-this.intersectionPt.x,0,-this.intersectionPt.z);t.add(l),t.applyAxisAngle(s.f.UP,a),l.negate(),t.add(l);const c=(new b.Quaternion).copy(this.initialPose.rotation),h=(new b.Quaternion).setFromAxisAngle(s.f.UP,a);c.premultiply(h);const d=this.smoothedTouch0.clone().lerp(this.smoothedTouch1,.5),u=new b.Vector3;if(i.copy(s.f.FORWARD).applyQuaternion(c),this.castFrom(d.x,i.y<-.01?d.y:this.origCenterPt.y,u),isNaN(u.x))return void(this.movingCamera=!1);u.x-=this.intersectionPt.x,u.z-=this.intersectionPt.z,u.negate(),u.applyAxisAngle(s.f.UP,a);const p=1-1/(e.subVectors(this.smoothedTouch0,this.smoothedTouch1).length()/this.originalPinchLength),m=t.add(u).lerp(this.intersectionPt,p).clone(),g=o.subVectors(m,this.intersectionPt).length();this.cameraCheck(m,c,g)&&this.poseController&&(this.poseController.updateCameraPosition(m),this.poseController.updateCameraRotation(c),this.poseController.updateCameraFocus(g))}})(),this.initMove=(()=>{const e=new b.Vector2,t=new b.Ray,i=new b.Vector3;return n=>{const o=n[0].position,r=n[1].position;this.smoothedTouch0.copy(o),this.smoothedTouch1.copy(r),this.originalPinchLength=e.subVectors(o,r).length(),this.origTouchAxis.copy(r).sub(o).normalize(),this.origCenterPt.copy(o).lerp(r,.5);const{pose:a}=this.poseProxy;this.initialPose=a.clone();const l=new b.Vector3,c=new b.Vector3;(0,R.Kh)(this.initialPose,l.set(this.origCenterPt.x,this.origCenterPt.y,-1),l),(0,R.Kh)(this.initialPose,c.set(this.origCenterPt.x,this.origCenterPt.y,1),c),c.sub(l).normalize();const h=this.raycaster.picking.pick(l,c);h||(t.set(l,c),t.at(a.focalDistance,i)),this.intersectionPt=h?h.point:i,this.plane.set(s.f.UP.clone(),0),this.plane.translate(new b.Vector3(0,this.intersectionPt.y,0))}})(),this.castFrom=(()=>{const e=new b.Ray,t=new b.Vector3,i=new b.Vector3;return(n,s,o)=>{(0,R.Kh)(this.initialPose,t.set(n,s,-1),t),(0,R.Kh)(this.initialPose,i.set(n,s,1),i),i.sub(t).normalize(),e.set(t,i),e.intersectPlane(this.plane,o)&&!o.equals(t)||(o.x=NaN),o.y=0}})()}rawPointerUpdate(e){const t=this.movingCamera;this.movingCamera=2===e.pointers.length&&!!this.poseController,this.movingCamera&&(t?this.pointersMoved(e.pointers):this.initMove(e.pointers))}onAccessGranted(e){this.poseController=e}onAccessRevoked(e){this.poseController=void 0,this.movingCamera=!1}}var L,N=i(33474);!function(e){e[e.NONE=u.r3.NONE]="NONE",e[e.ROTATE=u.r3.PRIMARY]="ROTATE",e[e.PAN=u.r3.SECONDARY]="PAN",e[e.ZOOM=u.r3.MIDDLE]="ZOOM"}(L||(L={}));class DollhouseControls extends n.Y{constructor(){super(...arguments),this.name="dollhouse-controls",this.controlState=L.NONE,this.movementKeys=new b.Vector2,this.adjustedBounds=new b.Box3,this.resetControlState=()=>{this.controlState=L.NONE},this.convertDeltaToLocal=(()=>{const e=new b.Vector3,t=new b.Vector3;return i=>{const n=i.x||0,o=i.y||0,r=2*n*this.cameraPoseProxy.pose.focalDistance,a=2*o*this.cameraPoseProxy.pose.focalDistance/this.cameraPoseProxy.pose.aspect();return e.copy(s.f.RIGHT).applyQuaternion(this.cameraPoseProxy.pose.rotation).setY(0).setLength(r),t.copy(s.f.FORWARD).applyQuaternion(this.cameraPoseProxy.pose.rotation),e.add(t.setY(0).setLength(a)),e}})(),this.cameraCheck=(()=>{function e(e){return e.x>=1||e.x<=-1||e.y>=1||e.y<=-1||e.z<=-1||e.z>=1}const t=[];for(let e=0;e<8;e++)t.push(new b.Vector3);const i=new b.Matrix4,n=new b.Matrix4,o=new b.Box3;return(r,a,l)=>{if(l<2)return!1;if(!(0,y.cb)(r,a,this.cameraPoseProxy.pose.projection,this.adjustedBounds))return!1;(0,y.jB)(this.meshData.bounds,t),i.compose(r,a,s.f.UNIT),i.invert(),n.copy(this.cameraPoseProxy.pose.projection.asThreeMatrix4()),o.makeEmpty();let c=!1;for(let e=0;e<8;e++)t[e].applyMatrix4(i),t[e].z=(0,v.uZ)(t[e].z,-w.oR.far,-w.oR.near),t[e].applyMatrix4(n),o.expandByPoint(t[e]);c=e(o.min)||e(o.max),o.min.clampScalar(-1,1),o.max.clampScalar(-1,1);return(o.max.x-o.min.x)*(o.max.y-o.min.y)>(c?.5:.1)}})()}async init(e,t){this.cameraPoseProxy=e.cameraPoseProxy,[this.viewmodeData,this.meshData,this.commonControlsModule]=await Promise.all([t.market.waitForData(m.O),t.market.waitForData(E._),t.getModule(o.default)]),this.bindings.push(t.subscribe(p.Z,(e=>{this.controls.stop(),this.resetControlState()}))),t.commandBinder.addBinding(N.C,(async e=>this.controls.setPhiLimits(void 0!==e.phiLowerLimitDegrees?e.phiLowerLimitDegrees*y.Ue:C,void 0!==e.phiUpperLimitDegrees?e.phiUpperLimitDegrees*y.Ue:P,this.validateViewmode())));const i=await t.getModule(r.default);this.modelSize=Math.max(this.meshData.size.length(),1),this.setupBounds(),this.controls=new CameraControls(this.cameraPoseProxy,this.cameraCheck,this.meshData.bounds,!0),this.commonControlsModule.addControls(g.Ey.Dollhouse,this.controls);const n=await t.getModule(T.default);this.cameraTouchControls=new CameraTouchControls(this.cameraPoseProxy,this.cameraCheck,n),this.bindings.push(i.registerHandler(a.a,(e=>{this.validateViewmode()&&this.onScrollWheel(e)}))),this.bindings.push(i.registerHandler(l.E0,(e=>{this.validateViewmode()&&this.onDragBegin(e.buttons)}))),this.bindings.push(i.registerHandler(l._R,(e=>{this.validateViewmode()&&(e.timeSinceLastMove<100&&(this.onDrag(e.delta),this.controls.update(O),this.controls.stopAcceleration()),this.onDragEnd(e.delta,e.buttons))}))),this.bindings.push(i.registerHandler(l._t,(e=>{this.validateViewmode()&&(this.onDrag(e.delta),this.controls.update(O),this.controls.stop())}))),this.bindings.push(i.registerHandler(S.h,(e=>{this.validateViewmode()&&this.cameraTouchControls.rawPointerUpdate(e)}))),this.bindings.push(i.registerHandler(c.e,(e=>{this.validateViewmode()&&e.state!==d.M.PRESSED&&this.onKey(e.key,e.state)}))),this.cameraPoseProxy.newSession(this)}onUpdate(e){this.validateViewmode()&&this.controls.update(e)}onAccessGranted(e){this.controls.onAccessGranted(e),this.cameraTouchControls.onAccessGranted(e)}onAccessRevoked(e){this.controls.onAccessRevoked(e),this.cameraTouchControls.onAccessRevoked(e)}onScrollWheel(e){if(0!==e.delta.y){const t=1/this.cameraPoseProxy.pose.focalDistance*2,i=this.modelSize;this.controls.setZoomAcceleration(.1*e.delta.y/(t*i*500)),this.controls.update(O),this.controls.setZoomAcceleration(0)}}onDragBegin(e){if(this.controlState===L.NONE){const t=e;this.controlState=t}this.controls.stop()}onDrag(e){switch(this.controlState){case L.ROTATE:this.controls.setOrbitalAcceleration({x:-Math.PI*e.x,y:-Math.PI*e.y});break;case L.PAN:const t=this.convertDeltaToLocal(e);this.controls.setPanAcceleration({x:-t.x,y:-t.z});break;case L.ZOOM:0!==e.y&&this.controls.setZoomAcceleration(-e.y)}}onDragEnd(e,t){t&this.controlState||(this.controlState=L.NONE,(0,f.tq)()&&this.controls.stop())}onKey(e,t){const i=t===d.M.DOWN;let n=!1;switch(e){case h.R.LEFTARROW:case h.R.J:this.controls.setOrbitalAcceleration({x:i?D:0},!0);break;case h.R.RIGHTARROW:case h.R.L:this.controls.setOrbitalAcceleration({x:i?-D:0},!0);break;case h.R.UPARROW:case h.R.I:this.controls.setOrbitalAcceleration({y:i?-D:0},!0);break;case h.R.DOWNARROW:case h.R.K:this.controls.setOrbitalAcceleration({y:i?D:0},!0);break;case h.R.W:this.movementKeys.y=i?1:0,n=!0;break;case h.R.S:this.movementKeys.y=i?-1:0,n=!0;break;case h.R.D:this.movementKeys.x=i?1:0,n=!0;break;case h.R.A:this.movementKeys.x=i?-1:0,n=!0}if(n){const e=this.convertDeltaToLocal(this.movementKeys).setLength(.02);this.controls.setPanAcceleration({x:e.x,y:e.z})}}validateViewmode(){return this.viewmodeData.currentMode===g.Ey.Dollhouse}setupBounds(){function e(e,t){return Math.sign(e+t)===Math.sign(e)?e+t:0}this.adjustedBounds.copy(this.meshData.bounds);this.adjustedBounds.min.x=e(this.adjustedBounds.min.x,4),this.adjustedBounds.min.y=e(this.adjustedBounds.min.y,4),this.adjustedBounds.min.z=e(this.adjustedBounds.min.z,4),this.adjustedBounds.max.x=e(this.adjustedBounds.max.x,-4),this.adjustedBounds.max.y=e(this.adjustedBounds.max.y,-4),this.adjustedBounds.max.z=e(this.adjustedBounds.max.z,-4);const t=new b.Vector3;this.adjustedBounds.getSize(t),this.adjustedBounds.setFromCenterAndSize(this.meshData.center,t)}}},26956:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>Fatcaster});var n=i(54122),s=i(50266),o=i(62513),r=i(50101),a=i(2212),l=i(27829);class Fatcaster extends n.Y{constructor(){super(...arguments),this.name="fat-caster",this.rayAssembly=new Array(Fatcaster.rayCount),this.rayPlaneOrientation=new a.Quaternion,this.rayVisuals=[]}async init(e,t){this.config={debug:!!e.debug},this.raycaster=await t.getModule(o.default);for(let e=0;e<Fatcaster.rayCount;++e)this.rayAssembly[e]=new a.Ray;if(e.debug){const e=(await t.getModule(r.default)).getScene();for(let t=0;t<Fatcaster.rayCount;++t){this.rayVisuals[t]=new a.ArrowHelper(new a.Vector3,new a.Vector3);const i=this.rayVisuals[t];i.remove(i.cone),i.setLength(1e3),e.add(this.rayVisuals[t])}}}async dispose(e){const t=(await e.getModule(r.default)).getScene();for(const e of this.rayVisuals)t.remove(e)}get ray(){return this.raycaster.pointer.pointerRay.clone()}cast(e,t,i=s.a.Filter.AVERAGE){const n=this.ray;return this.updateRayAssembly(n.origin,n.direction,e),this.castRays(t,i)}castRays(e,t){const i=[];let n=null;for(const t of this.rayAssembly){const s=this.raycaster.picking.pick(t.origin,t.direction,e);s&&(t===this.rayAssembly[0]&&(n=s),s.point.add(this.rayAssembly[0].origin).sub(t.origin),i.push(s))}return t(i,n,this.rayAssembly)}updateRayAssembly(e,t,i){for(const e of this.rayAssembly)e.direction.copy(t);if(this.rayPlaneOrientation.setFromUnitVectors(l.f.FORWARD,t),this.rayAssembly[0].origin.copy(e),this.rayAssembly[1].origin.copy(l.f.RIGHT).multiplyScalar(i).applyQuaternion(this.rayPlaneOrientation).add(e),this.rayAssembly[2].origin.copy(l.f.UP).multiplyScalar(i).applyQuaternion(this.rayPlaneOrientation).add(e),this.rayAssembly[3].origin.copy(l.f.LEFT).multiplyScalar(i).applyQuaternion(this.rayPlaneOrientation).add(e),this.rayAssembly[4].origin.copy(l.f.DOWN).multiplyScalar(i).applyQuaternion(this.rayPlaneOrientation).add(e),this.rayAssembly[5].origin.copy(l.f.UP).add(l.f.RIGHT).setLength(i).applyQuaternion(this.rayPlaneOrientation).add(e),this.rayAssembly[6].origin.copy(l.f.UP).add(l.f.LEFT).setLength(i).applyQuaternion(this.rayPlaneOrientation).add(e),this.rayAssembly[7].origin.copy(l.f.DOWN).add(l.f.RIGHT).setLength(i).applyQuaternion(this.rayPlaneOrientation).add(e),this.rayAssembly[8].origin.copy(l.f.DOWN).add(l.f.LEFT).setLength(i).applyQuaternion(this.rayPlaneOrientation).add(e),this.config.debug)for(let e=0;e<this.rayVisuals.length;++e){const i=this.rayVisuals[e];i.setDirection(t),i.position.copy(this.rayAssembly[e].origin)}}}Fatcaster.rayCount=9},50266:(e,t,i)=>{"use strict";i.d(t,{a:()=>n});var n,s=i(2212);!function(e){let t;!function(e){const t=e=>{for(const t of e)if(t.face)return{point:t.point,object:t.object,distance:t.distance,face:t.face};return null},i=(e,t)=>e.distance-t.distance;e.CENTER_FIRST=(e,i)=>i&&i.face?{point:i.point,normal:i.face.normal,object:i.object,distance:i.distance,face:i.face}:t(e),e.CLOSEST=e=>t(e.sort(i)),e.AVERAGE=e=>{if(0===e.length)return null;const t={point:new s.Vector3,face:new s.Face3(0,1,2),distance:0,object:e[0].object};for(const i of e)t.face&&i.face&&(t.point.add(i.point),t.face.normal.add(i.face.normal));return t.point.divideScalar(e.length),t.face&&t.face.normal.divideScalar(e.length).normalize(),t};e.CENTER_GROUP=t=>(i,s,o)=>{if(s){const n=[s];for(let e=1;e<i.length&&e<3;++e){const r=i[e];if(r.face){const i=Math.abs(o[e].direction.dot(r.face.normal));s.point.distanceTo(r.point)*i<=t&&n.push(r)}}if(n.length>=3){const t=e.AVERAGE(n,null,o);if(t&&t.face&&s.face)return t.face.normal=s.face.normal,t}}const r=n(i,o,t);return r?e.AVERAGE(r,null,o):e.CENTER_FIRST(i,s,o)};const n=(e,t,n)=>{const s=e.slice().sort(i),o=[s[0]];let r;for(r=1;r<s.length&&o.length<3;++r){const e=s[r];if(e.face){const i=Math.abs(t[r].direction.dot(e.face.normal));o[0].point.distanceTo(e.point)*i>n&&(o.length=0),o.push(e)}}return o.length<3?null:o}}(t=e.Filter||(e.Filter={}))}(n||(n={}))},88225:(e,t,i)=>{"use strict";i.d(t,{Z:()=>GetFloorIntersectCommand});var n=i(99681);class GetFloorIntersectCommand extends n.m{constructor(e){super(),this.payload=Object.assign({},e)}}},43232:(e,t,i)=>{"use strict";i.r(t),i.d(t,{GetFloorIntersectCommand:()=>n.Z,default:()=>b});var n=i(88225),s=i(70785),o=i(54122),r=i(50101),a=i(89155),l=i(75195),c=i(25936),h=i(12775),d=i(71208),u=i(62513),p=i(67399),m=i(61718),g=i(24975),f=i(91055),v=i(2212),y=i(27829);class FloorCaster extends o.Y{constructor(){super(...arguments),this.name="floor-caster",this.cameraPosition=new v.Vector3,this.forwardPosition=new v.Vector3,this.targetPlane=new v.Plane}async init(e,t){this.engine=t,[this.renderer,this.cameraData,this.viewmodeData,this.raycaster,this.floorsData]=await Promise.all([t.getModule(r.default),t.market.waitForData(a.M_),t.market.waitForData(h.O),t.getModule(u.default),t.market.waitForData(c.i)]),t.commandBinder.addBinding(n.Z,(e=>this.castToFloor(e.screenPosition,e.height,e.includeHiddenFloors)))}async castToFloor(e,t,i=!0){await this.engine.after(s.A.End);const n=this.renderer.getScene().camera,o=(0,l.z5)(e.x,e.y,this.cameraData.width,this.cameraData.height);let r,a=null;this.cameraPosition.set(o.x,o.y,-1).unproject(n),this.forwardPosition.set(o.x,o.y,1).unproject(n);const c=this.raycaster.picking.cast(this.cameraPosition,this.forwardPosition.clone().sub(this.cameraPosition).normalize(),i?g.T0:g.Pv)[0];if(c&&c.object instanceof m.S&&(a=c&&c.point||null,p.$4.hasFloorId(c.object)?r=this.floorsData.getFloor(c.object.floorId):a&&(r=this.floorsData.getClosestFloorAtHeight(a.y))),void 0!==t){this.cameraPosition.copy(this.cameraData.pose.position);const e=(0,l.st)(this.cameraData,o);if(this.viewmodeData.currentMode!==d.Ey.Floorplan){const i=(0,f.n0)(this.cameraPosition,e);this.targetPlane.set(y.f.DOWN,t),a=(0,f.Fe)(this.cameraPosition,i,this.targetPlane)||null}else e.y=t,a=e}const h=r?r.index:-1;return{position:a,floor:h,floorIndex:h}}}const b=FloorCaster},41397:(e,t,i)=>{"use strict";i.d(t,{SI:()=>s,O8:()=>o,YW:()=>r,Gu:()=>a,bC:()=>l,JU:()=>c,Ct:()=>h,Tm:()=>d,TD:()=>u,mP:()=>p,jX:()=>m,N4:()=>g});var n=i(21265);const s=1e3/60,o=.05,r=Math.PI/2/1e3,a=.1/60,l=.02,c=25,h=3,d=3,u=.16,p=(0,n.V5)()?45:(0,n.Kr)()?20:35,m=.01,g=2},43344:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>FloorplanControls});var n=i(54122),s=i(2212),o=i(30963),r=i(56040),a=i(27829),l=i(41397),c=i(45805),h=i(97620),d=i(91055),u=i(22888),p=i(44266);class CameraControls extends u.Z{constructor(e,t,i,n=!1){super(),this.cameraModule=e,this.targetProjection=new r.M,this.currentOrientation=new s.Quaternion,this.currentPosition=new s.Vector3,this.positionDelta=new s.Vector3,this.angularAccel=0,this.angularVelocity=0,this.linearAccel=new s.Vector2,this.linearVelocity=new s.Vector2,this.zoomAccel=0,this.zoomVelocity=0,this.scale=1,this.maxZoom=0,this.minZoom=l.Tm,this.checkBounds=n,this.bounds=t.clone(),this.boundsCenter=i.clone(),this.setupBounds(),this.transition={active:!1,startTime:0,elapsed:0,duration:0,angularVelocity:0,linearVelocity:new s.Vector2,zoomVelocity:0,easeOut:!1}}start(){this.scale=1,this.maxZoom=this.cameraModule.getData(!1).defaultZoom()*l.Ct}setRollAcceleration(e,t=!1){this.transition.active||(t&&e&&this.angularVelocity&&Math.sign(e)!==Math.sign(this.angularVelocity)&&(this.angularVelocity=0),this.angularAccel=e)}setPanAcceleration(e,t=!1){this.transition.active||(t&&this.haltVelocity(e,this.linearVelocity),this.linearAccel.x=void 0!==e.x?e.x:this.linearAccel.x,this.linearAccel.y=void 0!==e.y?e.y:this.linearAccel.y)}setZoomAcceleration(e){this.transition.active||(this.zoomAccel=e)}haltVelocity(e,t){e.x&&t.x&&Math.sign(e.x)!==Math.sign(t.x)&&(t.x=0),e.y&&t.y&&Math.sign(e.y)!==Math.sign(t.y)&&(t.y=0)}startRotateTransition(e,t,i){return this.startTransition(e,t.x*l.SI,new s.Vector2,0,i).nativePromise()}startTranslateTransition(e,t,i=!0){return this.startTransition(e,0,t.clone().multiplyScalar(l.SI),0,i).nativePromise()}startZoomTransition(e,t,i){return this.startTransition(e,0,new s.Vector2(0,0),t,i).nativePromise()}startTransition(e,t,i,n,s){const o=new p.Q;return this.transition.active=!0,this.transition.duration=e,this.transition.elapsed=0,this.transition.startTime=Date.now(),this.transition.deferred=o,this.transition.angularVelocity=t,this.transition.linearVelocity.copy(i),this.transition.zoomVelocity=n,this.transition.easeOut=s,this.angularAccel=0,this.linearAccel.set(0,0),this.zoomAccel=0,this.angularVelocity=t,this.linearVelocity.copy(i),this.zoomVelocity=n,this.cameraModule.beginExternalTransition(),o.promise()}stopTransition(){this.transition.active&&(this.cameraModule.endExternalTransition(),this.transition.active=!1),this.transition.deferred&&(this.transition.deferred.resolve(),this.transition.deferred=void 0)}updateTransition(e,t,i,n){let s=1,o=e/l.SI;if(this.transition.elapsed+=e,this.transition.elapsed>=this.transition.duration){s=(this.transition.duration-(this.transition.elapsed-e))/e,o=1}t&&(this.angularVelocity=this.transition.angularVelocity*o*s,this.roll(this.angularVelocity)),i&&(this.linearVelocity.copy(this.transition.linearVelocity).multiplyScalar(s*o),this.pan(this.linearVelocity)),n&&(this.zoomVelocity=this.transition.zoomVelocity*s*o,this.zoom(this.zoomVelocity)),this.transition.elapsed>=this.transition.duration&&(this.stop(this.transition.easeOut),this.transition.active=!1)}updateDefault(e,t,i,n){const s=e/l.SI;t&&(this.angularVelocity=this.angularVelocity+this.angularAccel*s,this.roll(this.angularVelocity),this.angularVelocity*=Math.pow(1-l.O8,s)),i&&(this.linearVelocity.addScaledVector(this.linearAccel,s),this.pan(this.linearVelocity),this.linearVelocity.multiplyScalar(Math.pow(1-l.O8,s))),n&&(this.zoomVelocity=this.zoomVelocity+this.zoomAccel*s,this.zoom(this.zoomVelocity),this.zoomVelocity*=Math.pow(1-l.TD,s))}update(e){const t=Math.abs(this.angularAccel)>c.Z.epsilon||Math.abs(this.angularVelocity)>c.Z.epsilon,i=this.linearAccel.length()>c.Z.epsilon||this.linearVelocity.length()>c.Z.epsilon,n=Math.abs(this.zoomAccel)>c.Z.epsilon||Math.abs(this.zoomVelocity)>c.Z.epsilon;this.transition.active?this.updateTransition(e,t,i,n):this.updateDefault(e,t,i,n)}stopMomentum(){this.transition.active||(this.angularVelocity=0,this.linearVelocity.set(0,0),this.zoomVelocity=0)}stopAcceleration(){this.transition.active||(this.setPanAcceleration({x:0,y:0}),this.setRollAcceleration(0),this.setZoomAcceleration(0))}stop(e=!1){this.stopTransition(),this.stopAcceleration(),e||this.stopMomentum()}pan(e){const t=this.cameraModule.getData(!1);this.positionDelta.x=e.x,this.positionDelta.z=e.y,this.currentPosition.copy(t.pose.position).add(this.positionDelta),this.checkBounds&&!this.insideBounds(this.currentPosition,t.pose.rotation,t.pose.projection)||this.cameraModule.updateCameraPosition(this.currentPosition)}roll(e){const t=this.cameraModule.getData(!1);this.currentOrientation.setFromAxisAngle(a.f.FORWARD,e),this.currentOrientation.multiplyQuaternions(t.pose.rotation,this.currentOrientation),this.currentOrientation.normalize(),this.checkBounds&&!this.insideBounds(t.pose.position,this.currentOrientation,t.pose.projection)||t.pose.rotation.equals(this.currentOrientation)||this.cameraModule.updateCameraRotation(this.currentOrientation)}zoom(e){const t=this.cameraModule.getData(!1);this.targetProjection.copy(t.pose.projection);const i=this.scale*(1-e);if(Math.abs(i-this.scale)>c.Z.epsilon){this.targetProjection.elements[0]*=i/this.scale,this.targetProjection.elements[5]*=i/this.scale;const n=(0,d.S3)(this.targetProjection);if(e<0&&n<=this.minZoom||e>0&&n>=this.maxZoom)return;if(this.checkBounds&&!this.insideBounds(t.pose.position,t.pose.rotation,this.targetProjection))return;this.scale=i,this.cameraModule.updateCameraProjection(this.targetProjection.clone())}}setupBounds(){this.bounds.min.x=this.adjustBound(this.bounds.min.x,2),this.bounds.min.y=this.adjustBound(this.bounds.min.y,2),this.bounds.min.z=this.adjustBound(this.bounds.min.z,2),this.bounds.max.x=this.adjustBound(this.bounds.max.x,-2),this.bounds.max.y=this.adjustBound(this.bounds.max.y,-2),this.bounds.max.z=this.adjustBound(this.bounds.max.z,-2),this.worldBounds=(new s.Box3).setFromCenterAndSize(this.boundsCenter,new s.Vector3(this.bounds.max.x-this.bounds.min.x,this.bounds.max.y-this.bounds.min.y,this.bounds.max.z-this.bounds.min.z))}insideBounds(e,t,i){return!!(0,h.cb)(e,t,i,this.worldBounds)}adjustBound(e,t){return Math.sign(e+t)===Math.sign(e)?e+t:0}}var m,g=i(89895),f=i(12775),v=i(40582),y=i(35825),b=i(22767),w=i(71208),S=i(48840),E=i(39869),T=i(30604),M=i(21588),_=i(93735),x=i(22079),A=i(78626),O=i(60959),P=i(27871),C=i(89155);!function(e){e[e.NONE=v.r3.NONE]="NONE",e[e.PAN=v.r3.PRIMARY]="PAN",e[e.ROTATE=v.r3.SECONDARY]="ROTATE",e[e.ZOOM=v.r3.MIDDLE]="ZOOM"}(m||(m={}));class FloorplanControls extends n.Y{constructor(){super(...arguments),this.name="floorplan-controls",this.controlState=m.NONE,this.controlsEngaged=!1,this.movementKeys=new s.Vector2,this.resetControlState=()=>{this.controlState=m.NONE}}async init(e,t){const[i,n,s,r,a]=await Promise.all([t.market.waitForData(P._),t.getModule(g.default),t.getModule(O.default),t.market.waitForData(C.M_),t.market.waitForData(f.O)]);this.cameraModule=n,this.cameraData=r,this.viewmodeData=a,this.modelSize=Math.max(i.size.length(),1),this.commonControlsModule=s,this.controls=new CameraControls(this.cameraModule,i.bounds,i.center,!0),this.commonControlsModule.addControls(w.Ey.Floorplan,this.controls),t.getModule(o.default).then((e=>{this.bindings.push(e.registerHandler(T.a,(e=>{this.validateViewmode()&&this.onScrollWheel(e)}))),this.bindings.push(e.registerHandler(M.E0,(e=>{this.validateViewmode()&&this.onDragBegin(e.buttons)}))),this.bindings.push(e.registerHandler(M._t,(e=>{this.validateViewmode()&&(this.controlsEngaged=!0,this.onDrag(e.delta),this.controls.update(l.SI),this.controls.stop())}))),this.bindings.push(e.registerHandler(M._R,(e=>{this.validateViewmode()&&this.controlsEngaged&&(e.timeSinceLastMove<100&&(this.onDrag(e.delta),this.controls.update(l.SI),this.controls.stopAcceleration()),this.onDragEnd(e.delta,e.buttons),this.controlsEngaged=!1)}))),this.bindings.push(e.registerHandler(_.G,(e=>{this.validateViewmode()&&(this.controls.setZoomAcceleration(-e.pinchDelta*l.N4),this.controls.update(l.SI),this.controls.stop())}))),this.bindings.push(e.registerHandler(_.i,this.resetControlState)),this.bindings.push(e.registerHandler(x.D,(e=>{this.validateViewmode()&&(this.controls.setRollAcceleration(e.rotateDelta),this.controls.update(l.SI),this.controls.stop())}))),this.bindings.push(e.registerHandler(x.u,this.resetControlState)),this.bindings.push(e.registerHandler(A.e,(e=>{this.validateViewmode()&&e.state!==b.M.PRESSED&&this.onKey(e.key,e.state)})))})),this.bindings.push(t.subscribe(S.Z,(e=>{this.controls.stop(),this.resetControlState()}))),this.bindings.push(t.subscribe(E.Z,(e=>{e.toMode===w.Ey.Floorplan&&this.controls.start()})))}onUpdate(e){this.validateViewmode()&&this.controls.update(e)}onScrollWheel(e){if(0!==e.delta.y){const t=(0,h.et)(this.modelSize,1,1500,2,.125);this.controls.setZoomAcceleration(e.delta.y*l.jX/(t*l.mP)),this.controls.update(l.SI),this.controls.setZoomAcceleration(0)}}onDragBegin(e){if(this.controlState===m.NONE){const t=e;this.controlState=t}this.controls.stop()}onDrag(e){switch(this.controlState){case m.ROTATE:this.controls.setRollAcceleration(e.x*Math.PI);break;case m.PAN:const t=this.convertDeltaToLocal(e);this.controls.setPanAcceleration({x:-t.x,y:-t.z});break;case m.ZOOM:0!==e.y&&this.controls.setZoomAcceleration(-e.y)}}onDragEnd(e,t){t&this.controlState||(this.controlState=m.NONE)}onKey(e,t){const i=t===b.M.DOWN;let n=!1;switch(e){case y.R.LEFTARROW:case y.R.J:this.controls.setRollAcceleration(i?l.YW:0,!0);break;case y.R.RIGHTARROW:case y.R.L:this.controls.setRollAcceleration(i?-l.YW:0,!0);break;case y.R.A:this.movementKeys.x=i?-1:0,n=!0;break;case y.R.D:this.movementKeys.x=i?1:0,n=!0;break;case y.R.W:this.movementKeys.y=i?1:0,n=!0;break;case y.R.S:this.movementKeys.y=i?-1:0,n=!0;break;case y.R.K:case y.R.DOWNARROW:this.controls.setZoomAcceleration(i?l.Gu:0);break;case y.R.I:case y.R.UPARROW:this.controls.setZoomAcceleration(i?-l.Gu:0)}if(n){const e=this.convertDeltaToLocal(this.movementKeys).setLength(l.bC);this.controls.setPanAcceleration({x:e.x,y:e.z})}}validateViewmode(){return this.viewmodeData.currentMode===w.Ey.Floorplan}convertDeltaToLocal(e){const t=e.x||0,i=e.y||0,n=t/this.cameraData.pose.projection.elements[0],o=i/this.cameraData.pose.projection.elements[5],r=new s.Vector3;return r.set(n,o,0),r.applyQuaternion(this.cameraData.pose.rotation),r}}},41479:(e,t,i)=>{"use strict";i.d(t,{P:()=>EndMoveToFloorMessage});var n=i(93528);class EndMoveToFloorMessage extends n.v{constructor(e,t){super(),this.floorId=e,this.floorName=t}}},12527:(e,t,i)=>{"use strict";i.d(t,{O:()=>Floor});var n=i(2212);class OrderList{constructor(){this.list=[]}insort(e){const t=this.binarySearch(e);let i=t.index;if(!t.success)for(;this.compare(e,this.list[i])>=0&&i<this.list.length;)i++;for(let e=this.list.length;e>i;e--)this.list[e]=this.list[e-1];this.list[i]=e}removeIndex(e){if(e>this.list.length)throw Error("OrderList.removeIndex() -> Invalid index: "+e);this.list.splice(e,1)}getElement(e){if(e>=0&&e<this.list.length)return this.list[e];throw new Error("OrderList.getElement() -> Invalid index: "+e)}get length(){return this.list.length}find(e){const t=this.binarySearch(e);return t.success?t.index:-1}compare(e,t){return void 0===t?1:"number"==typeof e?e===t?0:e<t?-1:1:e.compare(t)}binarySearch(e){let t=0,i=this.list.length-1,n=-1,s=null,o=0;for(;t<=i;){if(n=Math.floor((t+i)/2),s=this.list[n],o=this.compare(e,s),0===o)return{success:!0,index:n};o<0?i=n-1:t=n+1}return{success:!1,index:n}}}var s=i(46162),o=i(78909);class Floor extends o.T{constructor(e={}){super(),this.name="",this.center=new n.Vector3,this.boundingBox=new n.Box3,this.size=new n.Vector3,this.sweepHeights=new OrderList,this.sweepFloorHeights=new OrderList,this.medianSweepHeight=()=>this.sweepHeights.length>0?this.sweepHeights.getElement(Math.floor(this.sweepHeights.length/2)):this.center.y,this.minSweepFloorHeight=()=>this.sweepFloorHeights.length>0?this.sweepFloorHeights.getElement(0):this.boundingBox.min.y,Object.assign(this,e)}setBounds(e){this.boundingBox.copy(e),this.boundingBox.getSize(this.size),this.boundingBox.getCenter(this.center)}addSweep(e){this.sweepHeights.insort(e.position.y),this.sweepFloorHeights.insort(e.floorPosition.y)}get bottom(){return this.minSweepFloorHeight()}deepCopy(){return(0,s.p$)({id:this.id,meshGroup:this.meshGroup,index:this.index,name:this.name,center:this.center,boundingBox:this.boundingBox,size:this.size,medianSweepHeight:this.medianSweepHeight(),bottom:this.bottom})}}},7121:(e,t,i)=>{"use strict";i.d(t,{S:()=>StartMoveToFloorMessage});var n=i(93528);class StartMoveToFloorMessage extends n.v{constructor(e,t){super(),this.from=e,this.to=t}}},59340:(e,t,i)=>{"use strict";i.d(t,{M:()=>SweepFloorOverrideMessage});var n=i(93528);class SweepFloorOverrideMessage extends n.v{constructor(e,t,i){super(),this.index=e,this.from=t,this.to=i}}},25936:(e,t,i)=>{"use strict";i.d(t,{i:()=>FloorsData});var n=i(19413),s=i(12527),o=i(57501),r=i(71229),a=i(25799),l=i(63986);const c=new a.Z("floor-data");class FloorsData extends n.V{constructor(e){super(),this.name="floors",this.floors=(0,r.q)(e)}onNameChange(e){let t=[];return(0,o.k1)((()=>{this.getOrderedValues().forEach(((i,n)=>{t.push(i.onPropertyChanged("name",e))}))}),(()=>{t.forEach((e=>e.cancel())),t=[]}),!0)}getFloor(e){if(!this.floors.has(e))throw new l.H;return this.floors.get(e)}hasFloor(e){return this.floors.has(e)}getFloorAtIndex(e){return this.floors.values.find((t=>t.index===e))}getFloorByMeshGroup(e){return this.floors.values.find((t=>t.meshGroup===e))}mapMeshesToFloors(e){for(const t of e){if(!("meshGroup"in t))return void c.warn("No DAM mesh group found on mesh",t);let e=this.getFloorByMeshGroup(t.meshGroup);e||(e=new s.O({id:String(t.meshGroup),meshGroup:t.meshGroup,index:t.meshGroup}),this.floors.set(e.id,e)),e.setBounds(t.boundingBox),t.floorId=e.id;for(const i of t.roomMeshes)i.floorId=e.id}this.getOrderedValues().forEach(((e,t)=>{e.index=t}))}getFloorCount(){return this.floors.length}getCollection(){return this.floors}iterate(e){return this.getOrderedValues().forEach(e)}getTopFloor(){const e=this.getOrderedValues();if(!e.length)throw new l.H("Cannot get top floor, model has no floors");return e[e.length-1]}getBottomFloor(){const e=this.getOrderedValues();if(!e.length)throw new l.H("Cannot get bottom floor, model has no floors");return e[0]}getFloorContainingPoint(e,t=!1){const i=t?this.floors.keys.reverse():this.floors.keys;for(const t of i){const i=this.floors.get(t);if(i.boundingBox.containsPoint(e))return i}return null}getFloorAtHeight(e,t=!1){const i=this.getOrderedValues();t&&i.reverse();for(const t of i){const i=t.boundingBox;if(i.min.y<=e&&e<=i.max.y)return t}const n=this.getBottomFloor();return e<n.boundingBox.min.y?n:this.getTopFloor()}getClosestFloorAtHeight(e){let t,i=1/0;for(const n of this.floors){const s=Math.abs(n.medianSweepHeight()-e);i>s&&(i=s,t=n)}return t}rename(e,t){if(!this.floors.has(e))return;const i=this.floors.get(e);i.name=t,i.commit()}getOrderedValues(){return this.floors.values.sort(((e,t)=>e.index-t.index))}}},63986:(e,t,i)=>{"use strict";i.d(t,{H:()=>InvalidFloorException});var n=i(17617);class InvalidFloorException extends n.y{constructor(e="Invalid Floor"){super(e),this.name="InvalidFloorException"}}},77787:(e,t,i)=>{"use strict";i.d(t,{c:()=>s});var n=i(67399);const s=(e,t)=>n.$4.hasFloorId(t.object)?t.object.floorId:e.getClosestFloorAtHeight(t.point.y).id},67940:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>FloorDataModule});var n=i(2212),s=i(83032),o=i(54122),r=i(60841),a=i(64614),l=i(83083),c=i(25936),h=i(85197),d=i(43894),u=i(44333),p=i(17256),m=i(77956),g=i(57369),f=i(25799),v=i(6875),y=i(32400),b=i(12527);const w=new f.Z("mds-floor-deserializer");class MdsFloorDeserializer{deserialize(e){if(!e||!this.validate(e))return w.debug("Deserialized invalid floor data from MDS",e),null;const t=e.label||"",i=e.dimensions||{},{areaFloor:n}=i;return new b.O({id:e.id,index:e.sequence,meshGroup:e.meshId,name:t,areaFloor:n||-1})}validate(e){return["id","sequence","meshId"].every((t=>t in e))}}class MdsFloorPatchSerializer{serialize(e){return{label:e.name}}}class MdsFloorStore extends y.u{constructor(){super(...arguments),this.deserializer=new MdsFloorDeserializer,this.prefetchKey="data.model.floors"}async read(e={}){const t={modelId:this.getViewId()};return this.query(v.GetFloors,t,e).then((e=>{var t,i;const n=null===(i=null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.model)||void 0===i?void 0:i.floors;if(!n||!Array.isArray(n))return null;return n.reduce(((e,t)=>{const i=this.deserializer.deserialize(t);return i&&(e[t.id]=i),e}),{})}))}async update(e,t){const i=this.getViewId(),n=(new MdsFloorPatchSerializer).serialize(t);if(!n)throw new Error("Could not update Floor");return this.mutate(v.PatchFloor,{modelId:i,floorId:e,data:n})}}var S=i(80034),E=i(41263),T=i(7943),M=i(15119),_=i(20331),x=i(63986),A=i(46162);const O=e=>e.replace(/,/gi," ").trim(),P=e=>{if(!e||!e.floors)return null;const t={};return e.floors.split(",").forEach(((e,i)=>{const n=e.trim();(n||""===n)&&(t[i]=new b.O({id:String(i),name:n,meshGroup:i,index:i}))})),t},C=(e,t)=>{const i=(0,A.p$)(e);(0,A.TS)(i,t);const n=[];for(const e in i){const t=i[e];if(!t)continue;const s=O(t.name||""),o=parseInt(e,10);if(isNaN(o))throw new x.H(`Can't save non-numeric floor ID ${o}`);n[o]=s}return{floors:n.join(",")}};var D=i(59340);const I=new f.Z("floors-data");class FloorDataModule extends o.Y{constructor(){super(...arguments),this.name="floors"}async init(e,t){const{readonly:i}=e;this.engine=t,this.store=this.configureStorage(e);const[n,o,a,g]=await Promise.all([this.store.read(),t.getModule(h.default),t.market.waitForData(m.Z),t.getModule(d.F)]),f=a.getSweepList();if(this.data=new c.i(n||{}),this.data.mapMeshesToFloors([...o.mesh.floorMeshes]),this.mapSweepsToFloors(f),t.market.register(this,c.i,this.data),this.fixupManuallyPlacedSweepsWithoutFloorData(f),!1===i){const e=this.data.getCollection();this.monitor=new l.c(e,{aggregationType:r.E.NextFrame},t),this.monitor.onChanged((()=>this.engine.commandBinder.issueCommand(new u.VQ({dataTypes:[p.g.FLOORS]})))),this.store instanceof s.N&&this.store.addMonitor(this.monitor),this.bindings.push(g.onSave((()=>this.save()),{dataType:p.g.FLOORS}),g.onRevert((()=>this.revert()),{dataType:p.g.FLOORS}))}}configureStorage(e){const{modelId:t,baseUrl:i,queue:n}=e,o=e.storageProvider||p.Xq.JSONSTORE,r=!("readonly"in e)||!!e.readonly;if(I.info(`Loading floors from ${o}`),o===p.Xq.MDS)return new MdsFloorStore({readonly:r,baseUrl:i});const a=function(e){const{modelId:t,readonly:i}=e,n=e.baseUrl||"",s=e.queue||new _.gO,o={data:null},r=`${n}/api/v1/player/models/${t}`;if(i){const e=new S.gh({queue:s,path:r,deserialize:P,cachedData:o});return new E.iY({publishStores:[e]})}const a=new S.yh({queue:s,path:r,httpMethod:S.w$.PATCH,deserialize:P,serialize:C}),l=`${n}/api/v1/jsonstore/model/workshopSession/${t}`,c=new M.Z({queue:s,path:l,cachedData:{data:null},deserialize:T.S.sessionObjectExtract(M.j.FloorNames,P),serialize:C},M.j.FloorNames);return new E.iY({publishStores:[a],editStore:c,editStoreKey:E.aw.FLOOR_NAMES})}({modelId:t,baseUrl:i,readonly:r,queue:n});return new s.N(a,{dataType:p.g.FLOORS,modelId:t,readonly:r,engine:this.engine})}onUpdate(){}mapSweepsToFloors(e){e.forEach((e=>{if(e.alignmentType===g.z9.ALIGNED){let t;t=e.floorId&&this.data.hasFloor(e.floorId)?this.data.getFloor(e.floorId):this.data.getClosestFloorAtHeight(e.position.y),t&&t.addSweep(e)}}))}fixupManuallyPlacedSweepsWithoutFloorData(e){const t=new n.Vector3;for(const i of e)if(i.placementType===g.hU.MANUAL&&!i.floorId){t.setY(i.position.y);const e=this.data.getFloorAtHeight(i.position.y),n=e?e.id:i.floorId;n!==i.floorId&&(I.debug(`Setting sweep ${i.id} from floor ${i.floorId} to ${n}`),this.engine.broadcast(new D.M(i.index,i.floorId,n))),i.floorId=n}}getFloorMins(){const e=[];return this.data.iterate((t=>{e.push(t.bottom)})),e}async save(){const e=this.monitor.getDiffRecord();this.monitor.clearDiffRecord();const t=[];for(const i of e){const e=i.index;if(!e)throw new x.H(`Invalid floor '${i.index}'`);i.action===a.KI.updated&&t.push(this.store.update(e,i.diff))}return Promise.all(t)}async revert(){if(this.store instanceof s.N)return this.store.revert()}}},22729:(e,t,i)=>{"use strict";i.d(t,{c:()=>FloorsViewData});var n=i(290),s=i(19413),o=i(29359),r=i(5442);function a(e,t){return e}class FloorsViewData extends s.V{constructor(e,t,i){super(),this.floors=e,this.name="floors-view",this.currentFloorObservable=new r.f(null),this._observableFloorsSelectMode=new r.f(!1),this._observableRoomSelectMode=new r.f(!1),this._showFloorSelection=new r.f(!1),this.floorSelectable=!1,this.getFloorMin=e=>{const t=e||(this.currentFloorId||this.bottomFloorId);return this.floors.getFloor(t).bottom},this.isHidden=e=>{const t=!this.currentFloorId,i=!(!e||e!==this.currentFloorId),n=this.config.viewingAlignedPano();return!(t||i||n)},this.getHighestVisibleFloor=()=>this.currentFloor?this.currentFloor:this.floors.getTopFloor(),this.getHighestVisibleFloorId=()=>this.getHighestVisibleFloor().id,this.updateViewData=()=>{this.floors.iterate((e=>{this.derivedData[e.id]={id:e.id,index:e.index,name:this.getFloorName(e.id)}})),this.commit()},this.getViewData=e=>{const t=this.floors.getFloor(e);return this.derivedData[e]||(this.derivedData[e]={id:t.id,index:t.index,name:this.getFloorName(t.id)}),this.derivedData[e]},this.getFloor=e=>this.floors.getFloor(e),this.config=null!=i?i:{floorChangesEnabled:()=>!0,roomNavFeatureEnabled:()=>!0,viewingAlignedPano:()=>!0},this.localize=null!=t?t:a,this.derivedData={},this._transition={from:null,to:null,progress:new n.z(0),promise:Promise.resolve()},this.updateViewData()}isCurrentOrAllFloors(e){return!e||!this.currentFloorId||e===this.currentFloorId}makeFloorChangeSubscription(e){return this.currentFloorObservable.onChanged(e)}get currentFloor(){return this.currentFloorObservable.value}get currentFloorId(){return!!this.currentFloorObservable.value&&this.currentFloorObservable.value.id||null}get bottomFloorId(){return this.floors.getBottomFloor().id}get topFloorId(){return this.floors.getTopFloor().id}get nearestFloor(){let e;return e=this.transitionActive?this.transition.progress.value>.5?this.transition.to:this.transition.from:this.currentFloorId,e?this.floors.getFloor(e):void 0}get transitionActive(){return this.transition.progress.active}get transition(){return this._transition}transitionToFloorInstant(e){this.currentFloorObservable.value=e?this.floors.getFloor(e):null,this.commit()}transitionToFloor(e,t,i,n){const s=this._transition.progress;s.modifyAnimation(0,1,i),this._transition={from:e,to:t,progress:s,promise:n},this.commit(),n.then((()=>{this.transitionToFloorInstant(t)}))}get totalFloors(){return this.floorsEnabled?this.floors.getFloorCount():1}iterate(e){this.floors.iterate((t=>{const i=this.getViewData(t.id);i&&e(i)}))}getFloorNames(){const e=[];return this.floorsEnabled?(this.floors.iterate((t=>{e[t.index]=this.getFloorName(t.id)})),e):e}getFloorName(e){if(!e)return this.localize(o.Z.FLOOR_ALL);const t=this.floors.getFloor(e);return void 0!==t.name&&""!==t.name?t.name:this.getDefaultFloorName(e)}getDefaultFloorName(e){const t=this.floors.getFloor(e);return this.localize(o.Z.SHOWCASE.FLOORS.DEFAULT_NAME,t.index+1)}getFloorsVisibility(){if(this.currentFloorId){const e=[];return this.floors.iterate((t=>{e[t.index]=t.id===this.currentFloorId?1:0})),e}return[]}get floorsEnabled(){return this.config.floorChangesEnabled()}get floorSelectModeEnabled(){return this.config.roomNavFeatureEnabled()}get floorSelectModeActive(){return this._observableFloorsSelectMode.value}set floorSelectModeActive(e){this._observableFloorsSelectMode.value=e&&this.floorsEnabled&&this.floorSelectModeEnabled,this.commit()}onFloorSelectModeChange(e){return this._observableFloorsSelectMode.onChanged(e)}get showFloorSelection(){return this._showFloorSelection.value}set showFloorSelection(e){this._showFloorSelection.value=e&&this.floorSelectModeEnabled,this.commit()}onShowFloorSelectionChanged(e){return this._showFloorSelection.onChanged(e)}get roomSelectModeActive(){return this._observableRoomSelectMode.value}set roomSelectModeActive(e){this._observableRoomSelectMode.value=e&&this.floorSelectModeEnabled||!this.floorSelectModeEnabled,this.commit()}onRoomSelectModeChange(e){return this._observableRoomSelectMode.onChanged(e)}}},86682:(e,t,i)=>{"use strict";i.d(t,{Vw:()=>MoveToFloorCommand,h9:()=>MoveToFloorIndexCommand,EU:()=>ShowAllFloorsCommand});var n=i(99681);class MoveToFloorCommand extends n.m{constructor(e,t=!1,i,n){super(),this.id="MOVETO_FLOOR",this.payload={floorId:e,suppressCameraMovement:t,transitionTime:i,focusPoint:n}}}class MoveToFloorIndexCommand extends n.m{constructor(e,t=!1,i,n){super(),this.id="MOVETO_FLOOR_NUMBER",this.payload={floorIndex:e,suppressCameraMovement:t,transitionTime:i,focusPoint:n}}}class ShowAllFloorsCommand extends n.m{constructor(e){super(),this.id="SHOW_ALL_FLOORS",this.payload=e}}},92576:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>FloorsViewDataModule});var n=i(54122),s=i(25799),o=i(89895),r=i(85197),a=i(30963),l=i(79994),c=i(78626),h=i(73706),d=i(35825),u=i(22767),p=i(77956),m=i(12775),g=i(89155),f=i(27871),v=i(41479),y=i(56022),b=i(48840),w=i(24135),S=i(71208),E=i(98728),T=i(29675),M=i(25936),_=i(2212),x=i(67126),A=i(15782),O=i(67399);class FloorsRenderer{constructor(e,t,i,n,s,o,r,a,l){this.getAngleModifier=e,this.pose=t,this.floorsViewData=i,this.viewmodeData=n,this.sweepData=s,this.raycasterData=o,this.floorMeshes=r,this.meshData=a,this.touchDevice=l,this.floorTargetOpacity={},this.getDiscardDistance=e=>{if(e){return 4+(this.pose.focalDistance*A.xx.DISCARD_FOCAL_MULTI||0)}return 0}}activate(){}init(){}dispose(){}deactivate(){for(const e of this.floorMeshes)for(const t of e.roomMeshes)t.opacity=1}beforeRender(){const e=this.floorsViewData.nearestFloor,t=this.floorsViewData.transition.progress.active,i=!(!e||this.viewmodeData.isPano());let n=A.xx.FADE_OPAQUE,s=n,o=n;const r=this.getAngleModifier();i&&(this.floorsViewData.floorSelectModeEnabled&&this.viewmodeData.isDollhouse()?(s=n*r*A.xx.FADE_IN_VALUE,o=s*A.xx.FADE_BELOW_MULT+A.xx.FADE_BELOW_START):(s=A.xx.FADE_ABOVE,o=A.xx.FADE_BELOW)),this.sweepData.isSweepUnaligned(this.sweepData.currentSweep)&&this.viewmodeData.isPano()&&(n=0,s=0,o=0);for(const e of this.floorMeshes){const i=this.floorsViewData.floors.getFloorByMeshGroup(e.meshGroup);let r=n;const a=this.isBelowSelectedFloor(i)?o:s;let l=(0,x.uZ)(a+A.xx.FADE_IN_HOVER_BOOST_VALUE,0,1);this.floorsViewData.roomSelectModeActive&&(l=a),r=this.isHoveredFloor(null==i?void 0:i.id)&&!t&&a>0?l:a,r=this.isFloorTransitioningOut(i)?a:r,r=this.isSelectedFloor(null==i?void 0:i.id)||this.isFloorTransitioningIn(i)?n:r,r=this.clampForViewmodeTransitions(r),this.floorTargetOpacity[e.meshGroup]=r}}render(){const e=!(!this.floorsViewData.nearestFloor||!this.viewmodeData.isDollhouse());for(const t of this.floorMeshes)for(const i of t.roomMeshes){const n=i.opacity,s=this.floorTargetOpacity[i.meshGroup];i.opacity=_.MathUtils.lerp(n,s,.2),i.transparentFadeDist=this.getDiscardDistance(e&&i.meshGroup>t.meshGroup)}}clampForViewmodeTransitions(e){if(this.viewmodeData.currentMode===S.Ey.Transition){const{to:t}=this.viewmodeData.transition;if(t===S.Ey.Panorama)return Math.max(1-this.meshData.opacity.value,e)}return e}isHoveredFloor(e){if(void 0!==e&&this.raycasterData.hit&&this.viewmodeData.isDollhouse()&&!this.touchDevice){const t=this.raycasterData.hit.object;if(O.$4.hasFloorId(t))return e===t.floorId}return!1}isSelectedFloor(e){const t=this.floorsViewData.nearestFloor;return!t||!(!e||t.id!==e)}isBelowSelectedFloor(e){const t=this.floorsViewData.nearestFloor;return!!(e&&t&&t.index>e.index)}isFloorTransitioningIn(e){return!(!e||!this.floorsViewData.transition.progress.active||this.floorsViewData.transition.to&&this.floorsViewData.transition.to!==e.id)}isFloorTransitioningOut(e){return!(!e||!this.floorsViewData.transition.progress.active||this.floorsViewData.transition.from&&this.floorsViewData.transition.from!==e.id&&this.floorsViewData.transition.to===e.id)}}var P=i(44266),C=i(7121),D=i(28247),I=i(47924),R=i(55525),L=i(27829),N=i(91055),k=i(17321),B=i(81733),F=i(63986),U=i(85995);class FloorsNavigation{constructor(e,t,i,n,s,o,r,a,l){this.engine=e,this.floorsData=t,this.floorsViewData=i,this.sweepData=n,this.cameraData=s,this.cameraModule=o,this.viewmodeData=r,this.updateCurrentFloor=a,this.meshData=l,this.FLOOR_TRANSITION_TIME=500,this.moveFloorUp=(e=!1,t)=>{const i=this.floorsViewData.currentFloor,n=Math.min(this.floorsViewData.totalFloors,i?i.index+1:0);return this.moveToFloorIndex(n,e,t)},this.moveFloorDown=(e=!1,t)=>{const i=this.floorsViewData.currentFloor,n=Math.max(0,i?i.index-1:0);return this.moveToFloorIndex(n,e,t)},this.moveToFloor=(e,t=!1,i,n)=>{const s=this.floorsViewData.currentFloorId,o=s===e,r=this.floorsViewData.totalFloors<2&&!e,a=e?this.floorsViewData.floors.getFloor(e):null;if(o||r||!this.floorsViewData.floorsEnabled)return this.updateCurrentFloor(e),P.Q.resolve();if(a&&!this.canMoveToFloor(a,t))return P.Q.reject(new F.H("Invalid floor ID"));this.engine.broadcast(new C.S(s,e)),void 0===i&&(i=this.FLOOR_TRANSITION_TIME);const l=new P.Q;let c;this.floorsViewData.transitionToFloor(s,e,i,l.nativePromise()),this.floorsViewData.commit();let h,d=n;if(this.viewmodeData.isPano()){const t=e=>e=>this.floorsViewData.isCurrentOrAllFloors(e.floorId),i=!!e?k.nK:t,s=[(0,k._T)(),(0,k._k)(),i(e)],o=[(0,B.l0)(n||this.cameraData.pose.position)],r=this.sweepData.sortByScore(s,o).shift();r&&(d=r.sweep.position,c=r.sweep.id)}else null!==e&&this.engine.commandBinder.issueCommand(new U.aK);h=t?Promise.resolve():this.getCameraTransition(e,i,c,d);const u=this,p=P.Q.all([l,h]);return this.engine.startGenerator((function*(){let e=Date.now();for(;u.floorsViewData.transition.progress.active;){yield new D.Jj;const t=Date.now(),i=t-e;u.floorsViewData.transition.progress.tick(i),u.floorsViewData.commit(),e=t}u.updateCurrentFloor(u.floorsViewData.transition.to),l.resolve()})),p}}moveToFloorIndex(e,t=!1,i,n){let s=null;if(-1!==e){const t=this.floorsViewData.floors.getFloorAtIndex(e);if(!t)return P.Q.reject(new F.H(`Invalid floor index ${e}`));s=t.id}return this.moveToFloor(s,t,i,n)}canMoveToFloor(e,t=!1){if(!e)return!1;const i=this.floorsViewData.transition.progress.active,n=this.cameraData.canTransition()||t,s=e.index<=this.floorsViewData.totalFloors-1,o=e.index>=-1;return!i&&n&&s&&o}getCameraTransition(e,t,i,n){if(this.viewmodeData.currentMode===S.Ey.Dollhouse||this.viewmodeData.currentMode===S.Ey.Floorplan){const i=this.getPoseForFloor(e,n);return this.cameraModule.moveTo({transitionType:I.n.Interpolate,pose:i.pose,focalDistance:i.focalDistance,transitionTime:t}).nativePromise()}return this.viewmodeData.currentMode===S.Ey.Panorama&&i?this.engine.commandBinder.issueCommand(new R.ju({transition:I.n.Interpolate,sweep:i})):Promise.resolve()}getPoseForFloor(e,t){const{position:i,rotation:n}=this.cameraData.pose,s=e?this.floorsData.getFloor(e):null,o=s?s.medianSweepHeight():this.meshData.center.y,r=s?s.center:this.meshData.center;r.setY(o);const a=L.f.FORWARD.clone().applyQuaternion(n),l=i.clone();let c,h;if(t){const e=i.clone().addScaledVector(a,this.cameraData.pose.focalDistance),n=(new _.Vector3).set(0,i.y,0),s=(new _.Vector3).set(0,e.y,0),r=n.distanceTo(s);l.setY(o+r);const d=e.clone().setY(t.y);h=d.distanceTo(l),this.viewmodeData.isDollhouse()&&(c=(0,N.n0)(l,d))}else{const e=(s?s.size.y:V)/2+V*-a.y;l.setY(o+e),h=l.distanceTo(r)}return{focalDistance:h,pose:{position:l,rotation:c}}}}const V=8;var H=i(22729),G=i(86682),z=i(1799),j=i(97620);class FloorsSelectModeHelper{constructor(e,t,i){this.floorsViewData=e,this.viewmodeData=t,this.pose=i,this.vectors={lookDir:new _.Vector3,flattenedLookDir:new _.Vector3},this.getAngleModifier=this.getAngleModifier.bind(this)}update(){const e=this.getAngleModifier(),t=1===this.floorsViewData.totalFloors,i=!!this.floorsViewData.nearestFloor,n=!this.viewmodeData.isPano()&&!this.viewmodeData.transitionActive();this.floorsViewData.roomSelectModeActive=n&&(t||i&&e<1||this.viewmodeData.isFloorplan()),this.floorsViewData.floorSelectModeActive=n&&1===e&&!t,this.floorsViewData.showFloorSelection=!this.viewmodeData.transitionActive()&&this.viewmodeData.currentMode===S.Ey.Dollhouse&&i&&!t,this.floorsViewData.floorSelectable=this.floorsViewData.floorSelectModeEnabled&&this.viewmodeData.currentMode===S.Ey.Dollhouse}getAngleModifier(){const e=this.vectors.lookDir.copy(L.f.FORWARD).applyQuaternion(this.pose.rotation),t=this.vectors.flattenedLookDir.copy(e).setY(0),i=e.angleTo(t)*j.MN,n=A.xx.FADE_IN_START_ANGLE,s=A.xx.FADE_IN_END_ANGLE,o=1-(0,j.dS)(i,n,s,0,1);return(0,z.FG)(o,0,1,1)}}var W=i(21265),Z=i(53999),q=i(75712),K=i(93781),Y=i(76258),$=i(7065),X=i(39936),Q=i(47173),J=i(39869),ee=i(62431);const te=new s.Z("floors-view-data");class FloorsViewDataModule extends n.Y{constructor(){super(...arguments),this.name="floors-viewdata",this.updateCurrentFloor=e=>{this.config.allowFloorChanges&&this.floorsViewData.currentFloorId!==e&&(this.floorsViewData.transitionToFloorInstant(e),this.engine.broadcast(new v.P(e,this.floorsViewData.getFloorName(e))))}}async init(e,t){this.engine=t,this.config=e;const[i,n,s,c]=await Promise.all([t.market.waitForData(M.i),t.market.waitForData(X.e),t.getModule(l.default),t.market.waitForData(T.pu)]);this.applicationData=c,this.floorsData=i,this.settingsData=n;const h={floorChangesEnabled:()=>this.config.allowFloorChanges,roomNavFeatureEnabled:()=>this.settingsData.tryGetProperty(Q.Q,!1),viewingAlignedPano:()=>void 0!==this.sweepData.currentAlignedSweepObject&&this.viewmodeData.isPano()};if(this.floorsViewData=new H.c(this.floorsData,s.t.bind(s),h),this.floorSelectFeatureEnabledCheck(),t.market.register(this,H.c,this.floorsViewData),[this.viewmodeData,this.sweepData,this.cameraData,this.input,this.raycasterData]=await Promise.all([t.market.waitForData(m.O),t.market.waitForData(p.Z),t.market.waitForData(g.M_),t.getModule(a.default),t.market.waitForData(w.P)]),this.config.allowFloorChanges&&this.viewmodeData.currentMode===S.Ey.Panorama&&this.sweepData.currentSweepObject){const e=this.sweepData.currentSweepObject.floorId;e&&(te.debug(`Set initial floor to ${e} from current sweep`),this.updateCurrentFloor(e))}const[d,u,v]=await Promise.all([t.getModule(o.default),t.market.waitForData(f._),t.getModule(r.default)]);this.floorNavigation=new FloorsNavigation(t,this.floorsData,this.floorsViewData,this.sweepData,this.cameraData,d,this.viewmodeData,this.updateCurrentFloor,u),this.floorsSelectModeHelper=new FloorsSelectModeHelper(this.floorsViewData,this.viewmodeData,this.cameraData.pose);const _=new FloorsRenderer(this.floorsSelectModeHelper.getAngleModifier,this.cameraData.pose,this.floorsViewData,this.viewmodeData,this.sweepData,this.raycasterData,v.mesh.floorMeshes.copyToList([]),u,(0,W.Jm)());t.addComponent(this,_),this.settingsData.tryGetProperty(Q.Q,!1)&&this.config.allowFloorChanges&&this.registerFloorHoverCursorEffect(),this.bindings.push(this.registerKeys(),this.floorsData.onChanged(this.floorsViewData.updateViewData),t.subscribe(y.Z,(e=>{const t=this.sweepData.getSweep(e.toSweep);t&&this.updateCurrentFloor(t.floorId)})),t.subscribe(b.Z,function(e,t,i){let n=!1;return s=>{const o=e.tryGetData(E.k3);if(!o||o&&o.isTourActive())return;s.toMode===S.Ey.Panorama&&(n=null!==i.currentFloorId);const r=s.fromMode===S.Ey.Panorama,a=s.toMode===S.Ey.Floorplan,l=s.toMode===S.Ey.Dollhouse;if(!r||!l&&!a)return;const c=n||a?i.currentFloorId:null;t(new G.Vw(c,!0,0))}}(t.market,t.commandBinder.issueCommand,this.floorsViewData)),t.commandBinder.addBinding(G.Vw,(async e=>this.floorNavigation.moveToFloor(e.floorId,e.suppressCameraMovement,e.transitionTime,e.focusPoint))),t.commandBinder.addBinding(G.h9,(async e=>this.floorNavigation.moveToFloorIndex(e.floorIndex,e.suppressCameraMovement,e.transitionTime,e.focusPoint))),t.commandBinder.addBinding(G.EU,(async e=>{const i="boolean"==typeof e.moveCamera&&!e.moveCamera;await t.commandBinder.issueCommand(new G.Vw(null,i))})),t.subscribe(J.Z,(()=>this.updateFloorSelectMode())),this.cameraData.pose.onChanged((()=>this.updateFloorSelectMode())),this.floorsViewData.onChanged((()=>this.updateFloorSelectMode())),n.onPropertyChanged(Q.w,(()=>this.floorSelectFeatureEnabledCheck())),n.onPropertyChanged(ee.gx.FloorSelect,(()=>this.floorSelectFeatureEnabledCheck())),this.applicationData.onPropertyChanged("application",(()=>this.floorSelectFeatureEnabledCheck()))),this.updateFloorSelectMode()}onUpdate(){}updateFloorSelectMode(){var e;null===(e=this.floorsSelectModeHelper)||void 0===e||e.update()}floorSelectFeatureEnabledCheck(){const e=this.settingsData.tryGetProperty(Q.w,!0),t=this.settingsData.tryGetProperty(ee.gx.FloorSelect,!0),i=this.applicationData.application===T.Mx.WORKSHOP;this.toggleFloors(i||e&&t)}toggleFloors(e){e||null===this.floorsViewData.currentFloorId||this.updateCurrentFloor(null),this.config.allowFloorChanges=e,this.updateFloorSelectMode()}registerKeys(){return this.input.registerHandler(c.e,(async e=>{if(!this.cameraData.canTransition())return;const t=e.modifiers.shiftKey,i=this.floorsViewData.getHighestVisibleFloor(),n=i?(i.index+1)%this.floorsViewData.totalFloors:0,s=i?(i.index-1)%this.floorsViewData.totalFloors:0;if(e.state===u.M.PRESSED)switch(e.key){case d.R.UPARROW:t&&this.floorNavigation.moveToFloorIndex(n);break;case d.R.DOWNARROW:t&&this.floorNavigation.moveToFloorIndex(s);break;case d.R.R:this.floorNavigation.moveFloorUp();break;case d.R.F:this.floorNavigation.moveFloorDown();break;case d.R.Y:this.floorNavigation.moveToFloor(null)}}))}registerFloorHoverCursorEffect(){const e=q.s.is((e=>e instanceof K.g&&e.raycastEnabled&&this.floorsViewData.floorSelectable)),t=new Z.V(this.input.registerMeshHandler(h.z,e,((e,t)=>{this.engine.commandBinder.issueCommand(new Y.u($.C.FINGER))})),this.input.registerMeshHandler(h.A,e,((e,t)=>{this.engine.commandBinder.issueCommand(new Y.u($.C.DEFAULT))})));t.cancel();const i=(()=>{let e=!1;return()=>{const i=this.floorsViewData.floorSelectModeEnabled;i!==e&&(e=i,e?t.renew():(t.cancel(),this.engine.commandBinder.issueCommand(new Y.u($.C.DEFAULT))))}})();i(),this.bindings.push(this.viewmodeData.onChanged(i),this.floorsViewData.onFloorSelectModeChange(i),this.floorsViewData.makeFloorChangeSubscription(i),t)}}},47173:(e,t,i)=>{"use strict";i.d(t,{Q:()=>n,w:()=>s});const n="features/roomnav",s="features/floorselect"},71583:(e,t,i)=>{"use strict";i.d(t,{Bz:()=>ToggleModalCommand,rE:()=>CloseModalCommand,Mn:()=>ToggleIconToolbarCommand});var n=i(99681);class ToggleModalCommand extends n.m{constructor(e,t){super(),this.payload={modal:e,open:t}}}ToggleModalCommand.id="TOGGLE_MODAL";class CloseModalCommand extends n.m{constructor(){super()}}CloseModalCommand.id="CLOSE_MODAL";class ToggleIconToolbarCommand extends n.m{constructor(e){super(),this.payload={open:e}}}ToggleIconToolbarCommand.id="TOGGLE_ICON_TOOLBAR"},96240:(e,t,i)=>{"use strict";i.d(t,{J:()=>j,Z:()=>Z});var n=i(26605),s=i(94184),o=i(2116),r=i(21265),a=i(74674),l=i(90601),c=i(43098),h=i(73305),d=i(55994),u=i(36520),p=i(99898),m=i(88686),g=i(78305),f=i(18120),v=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let y=class PendingUpload extends n.Component{constructor(e){super(e)}render(){const{appendClass:e,progress:t,error:i}=this.props,o={"upload-error":!!i};e&&Object.keys(e).length>0&&Object.assign(o,e);const r=i===g.k.SUPPORT_COMING_SOON;return(0,n.h)("div",{class:s("attachment","attachment-upload",o)},(0,n.h)("div",{class:"upload-status"},i&&!r&&(0,n.h)("span",{class:"icon icon-error"}),i&&r&&(0,n.h)("span",{class:"upload-msg"},"Support coming soon"),!i&&(0,n.h)(f.$,{progress:t,innerRadius:20,barWidth:4})))}};y=v([o.Z],y);var b=i(42733),w=i(35825),S=i(98867),E=i(72386),T=i(71313),M=i(53189),_=i(59064),x=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let A=class SmartTextEditor extends n.Component{constructor(e){super(e),this.wordToken=null,this.endTokens={"@":[","," ","!","?","/",";",":"],"#":[","," ",".","!","?","/",";",":"]},this.linkElement=null,this.wordElement=null,this.onClickAnchor=e=>{const t=e.target,i=t.dataset.blocktype;this.props.active?(e.preventDefault(),i===a.C.LINK&&this.prepareLinkForEdit(t)):i!==a.C.HASH&&i!==a.C.USER||this.props.onClickBlock({blockType:i,text:t.innerText,value:t.dataset.value,id:t.dataset.id})},this.addFauxHighlight=()=>{this.execCommand("backColor","#ff315840")},this.removeFauxHighlight=()=>{this.execCommand("backColor","transparent")},this.onSelectionChange=()=>{const e=this.getCurrentRange();e&&(this.range=e.cloneRange(),this.wordElement&&null===this.wordElement.parentElement&&this.endWordMatching())},this.onInput=e=>{const t=this.getMarkdown();this.props.onInput(t),"@"===this.wordToken?this.fetchUserMatches(e):this.filterSuggestions(e)},this.onClickMatch=e=>{const t=e.currentTarget;if(t){const i=t.dataset.value,n=t.dataset.id,s=t.dataset.text||t.innerText;e.stopPropagation(),this.chooseMatch(s,i,n)}},this.onHoverMatch=e=>{const t=e.currentTarget;if(t){const e=parseInt(t.dataset.index||"0",10);this.setState({activeMatch:e})}},this.onClick=e=>{const{active:t,onClickToEdit:i}=this.props;t?(this.removeFauxHighlight(),this.range=null):i&&i(e)},this.onKeyPress=e=>{const{hashtags:t,userMentions:i}=this.props,{matches:n,activeMatch:s}=this.state;e.stopPropagation();const o=e.key,r=e.which||e.keyCode;if((e.ctrlKey||e.metaKey)&&["b","i","u"].includes(o))return e.preventDefault(),!1;if(r===w.R.ESCAPE)return this.props.onCancelEditing&&this.props.onCancelEditing(),!1;const a=[w.R.TAB,w.R.RETURN,w.R.DOWNARROW,w.R.UPARROW,w.R.SPACE];if("keydown"===e.type&&!a.includes(r))return!1;const l=e.target;this.props.maxLength&&l.innerText.length>this.props.maxLength&&e.preventDefault();let c=this.range;c||(c=this.range=this.getCurrentRange());const h=[];if(i&&h.push("@"),t&&h.push("#"),h.length){if(!this.wordToken&&h.includes(o))return e.preventDefault(),this.wordToken=o,this.createWordElement(o),this.updateSuggestions(""),!0;this.wordToken&&this.wordElement&&this.endTokens[this.wordToken].includes(o)&&(e.preventDefault(),this.finishWordElement(o))}switch(r){case w.R.TAB:case w.R.RETURN:if(n.length&&this.state.activeMatch>-1)return e.preventDefault(),this.chooseMatch(n[s].text,n[s].value),!0;this.wordToken&&this.finishWordElement(""),e.shiftKey||(e.preventDefault(),this.props.onDoneEditing&&this.props.onDoneEditing());break;case w.R.DOWNARROW:n.length&&(e.preventDefault(),this.setState((e=>({activeMatch:Math.min(e.activeMatch+1,n.length-1)}))));break;case w.R.UPARROW:n.length&&(e.preventDefault(),this.setState((e=>({activeMatch:Math.max(e.activeMatch-1,-1)}))))}return!1},this.saveRef=e=>{this.textBox=e},this.state={activeMatch:-1,matches:[],sortedSuggestions:[]}}componentDidMount(){this.props.active&&(this.textBox,document.addEventListener("selectionchange",this.onSelectionChange))}componentWillUnmount(){this.props.active&&document.removeEventListener("selectionchange",this.onSelectionChange)}componentWillReceiveProps(e){const{text:t,active:i}=this.props;t===e.text&&i===e.active||(this.endWordMatching(),this.setState({sortedSuggestions:[]}),i!==e.active&&(this.toggleEditing(!!e.active),e.active||this.textBox.replaceTextContent(e.text)))}componentDidUpdate(e){const{text:t,active:i}=this.props;t===e.text&&i===e.active||(i?document.addEventListener("selectionchange",this.onSelectionChange):document.removeEventListener("selectionchange",this.onSelectionChange))}getTextElement(){return this.textBox.getTextElement()}toggleEditing(e){this.textBox&&this.textBox.toggleEditing(e)}focus(){this.textBox&&this.textBox.focus()}getMarkdown(){return T.v.serialize(this.getTextElement(),!!this.props.hashtags,this.context.userData)}hasTextSelected(){return!(!this.range||this.range.startOffset===this.range.endOffset)}prepareLinkForEdit(e){const t=e||this.getAnchorFromSelection();let i="";const n=window.getSelection();n&&(t||this.range?(this.addFauxHighlight(),t||(i=this.range?this.range.toString():n.toString())):(this.textBox.focus(),n.selectAllChildren(this.getTextElement()),n.collapseToEnd(),this.range=n.getRangeAt(0),i=this.range.toString())),this.linkElement=t;const s=t?t.innerText:i,o=t?t.href:"";this.props.onClickBlock({blockType:a.C.LINK,text:s,value:o})}saveLink(e,t){this.linkElement?""!==t?(this.linkElement.text=e,this.linkElement.href=t):this.unlink(this.linkElement):this.linkify(e,t)}linkify(e,t){this.execCommand("backColor","transparent"),this.execCommand("createLink",t);const i=this.getAnchorFromSelection();i&&(i.text=e,i.className=`link-annotation ${T.o.LINK}`,i.setAttribute("data-blocktype",a.C.LINK),i.onclick=this.onClickAnchor)}unlink(e){const t=e.parentNode,i=e.textContent;t&&(t.removeChild(e),i&&!(0,S.j)(i)&&this.execCommand("insertText",i))}execCommand(e,t){this.range&&(this.applyRange(),document.execCommand(e,!1,t),this.onSelectionChange())}applyRange(){if(this.range){const e=window.getSelection();e&&(e.removeAllRanges(),e.addRange(this.range))}}getAnchorFromSelection(){const e=this.getCurrentSelection();if(!e)return null;let t=e.commonAncestorContainer;for(;t&&"A"!==t.nodeName;){if(t===this.getTextElement())return null;t=t.parentNode}return t||null}getCurrentSelection(){const e=window.getSelection();if(e&&e.rangeCount>0){const t=this.getTextElement(),i=e.getRangeAt(0);if(t===i.commonAncestorContainer||t.compareDocumentPosition(i.commonAncestorContainer)&Node.DOCUMENT_POSITION_CONTAINED_BY)return i}return null}getCurrentRange(){const e=window.getSelection();if(e&&e.rangeCount>0){const t=e.getRangeAt(0);if(this.getTextElement()===t.commonAncestorContainer||this.getTextElement().compareDocumentPosition(t.commonAncestorContainer)&Node.DOCUMENT_POSITION_CONTAINED_BY)return t}return null}sortWords(e){return e.sort(((e,t)=>e.text.toLowerCase()<t.text.toLowerCase()?-1:1))}fetchUserMatches(e){const t=this.wordElement?this.wordElement.textContent:null;if(this.wordToken&&t){const i=t.toLowerCase().substr(1);this.context.commandBinder.issueCommand(new E.P(i,null,null)).then((()=>{this.updateSuggestions(e)}))}}filterSuggestions(e){const{sortedSuggestions:t}=this.state,{wordToken:i,wordElement:n}=this;if(t.length&&i&&n&&n.textContent){const e=n.textContent.toLowerCase(),s=e.length>1?t.filter((t=>{const n=e.substr(1);let s=0===t.text.toLowerCase().indexOf(n);return!s&&"@"===i&&t.value&&(s=0===t.value.toLowerCase().indexOf(n)),s})):t,o=s.length>0?0:-1;this.setState({matches:s,activeMatch:o})}}chooseMatch(e,t,i){if(this.wordElement){const n=e.replace(/ /g,"&nbsp;");this.wordElement.innerHTML=`${this.wordToken}${n}`,t&&this.wordElement.setAttribute("data-value",t),i&&this.wordElement.setAttribute("data-id",i),this.finishWordElement("")}}updateSuggestions(e){const{wordToken:t}=this,{hashtags:i,userMentions:n}=this.props;let s=[];if("#"===t&&i)s=this.sortWords(i.map((e=>({text:e,blockType:a.C.HASH}))));else if("@"===t&&n){const e=this.context.userData.collection.values;s=this.sortWords(e.map((e=>({text:e.name,id:e.id,value:e.email,blockType:a.C.USER}))))}this.setState({sortedSuggestions:s}),this.filterSuggestions(e)}endWordMatching(){this.setState({matches:[],activeMatch:-1}),this.wordToken=null,this.wordElement=null}createWordElement(e){const t=window.getSelection(),i=this.range;if(!i||!t||!this.wordToken)return;const n=document.createElement("a");n.removeAttribute("href"),n.innerText=e,"#"===this.wordToken?(n.className=`link-annotation ${T.o.HASH}`,n.setAttribute("data-blocktype",a.C.HASH)):"@"===this.wordToken&&(n.className=`link-annotation ${T.o.USER}`,n.setAttribute("data-blocktype",a.C.USER)),i.insertNode(n),i.selectNodeContents(n),i.collapse(!1),this.applyRange(),this.wordElement=n}finishWordElement(e){const t=this.range,i=window.getSelection();if(t&&i&&this.wordElement&&this.wordToken){if(this.wordElement.contentEditable="false",this.textBox.focus(),t.setStartAfter(this.wordElement),e){const i=document.createTextNode(e);t.insertNode(i),t.selectNodeContents(i),t.collapse(!1)}this.applyRange(),this.endWordMatching()}}renderSuggestion(e,t){const{activeMatch:i}=this.state,o=t===i,r=e.blockType===a.C.USER,l=r&&e.id?this.context.userData.getUserInfoDisplay(e.id):null;return(0,n.h)("div",{class:s("suggestion",{selected:o}),onMouseDown:this.onClickMatch,onMouseEnter:this.onHoverMatch,"data-value":e.value,"data-id":e.id,"data-text":e.text,"data-index":t},r&&(0,n.h)(_.C,{badgeStyle:{color:l.color,"border-color":l.color,"background-color":"transparent"},label:l.initials}),(0,n.h)("span",{class:"suggestion-text"},e.text))}renderSuggestions(){const{active:e}=this.props;if(!e)return null;const{matches:t}=this.state,i=t.length>0;return(0,n.h)("div",{class:s("suggestion-menu",{open:i})},i&&t.map(((e,t)=>this.renderSuggestion(e,t))))}render(){const{text:e,onClickToEdit:t,active:i,placeholder:o,tabIndex:r,maxLength:a,className:l,onBlur:c,onFocus:h}=this.props,d=!!t&&!i,u=l||"";return(0,n.h)("div",{class:s("smart-text-box",`${u}`)},(0,n.h)(M.Z,{ref:this.saveRef,text:e,activeLinks:!0,hashtags:!0,userMentions:!0,placeholder:o,tabIndex:r,clickToEdit:d,maxLength:a,onClick:this.onClick,onInput:this.onInput,onKeyPress:this.onKeyPress,onBlur:c,onFocus:h,onClickAnchor:this.onClickAnchor}),this.renderSuggestions())}};A=x([o.A],A);var O=i(80429),P=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let C=class FileUpload extends n.Component{constructor(e){super(e),this.handleUpload=e=>{const t=e.target;if(!t)return;const i=t.files;i&&this.props.onUpload(i),t.value=""},this.onClick=e=>{const{onClick:t,buttonState:i,tooltip:n}=this.props;i===b.BN.DIMMED&&n?(this.setState({showingTooltip:!0}),window.setTimeout((()=>{this.setState({showingTooltip:!1})}),2500)):t(e)},this.state={showingTooltip:!1}}render(){const{accept:e,id:t,multi:i,buttonState:s,tooltip:o,dataValue:r,onMouseDown:a}=this.props,{showingTooltip:l}=this.state,c=s===b.BN.ENABLED,h=`file-upload-${t}`;return(0,n.h)("div",{class:"file-upload-button"},(0,n.h)("label",{for:h},(0,n.h)(O.h,{dataValue:r,iconClass:"icon-attach",buttonStyle:O.D.PLAIN,buttonState:s,onClick:this.onClick,onMouseDown:a,tooltipMsg:l?o:void 0})),c&&(0,n.h)("input",{type:"file",class:"file-input",id:h,accept:e,multiple:!!i,onChange:this.handleUpload}))}};C=P([o.Z],C);var D=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let I=class FileDropZone extends n.Component{constructor(e){super(e),this.active=!1,this.dropZone=null,this.onDragOver=e=>{e.dataTransfer&&e.dataTransfer.types&&e.dataTransfer.types.includes("Files")&&(e.preventDefault(),e.stopPropagation(),this.activate())},this.onDrop=e=>{e.preventDefault(),e.stopPropagation(),e.dataTransfer&&e.dataTransfer.files&&this.props.onDropped(e.dataTransfer.files),this.deactivate()},this.onDragEnd=e=>{e.preventDefault(),e.stopPropagation(),this.deactivate()},this.onDragLeave=e=>{e.preventDefault(),e.stopPropagation(),this.deactivate()},this.setDropZoneRef=e=>{this.dropZone=e}}activate(){!this.active&&this.dropZone&&(this.props.onActivate(!0),this.active=!0,this.dropZone.classList.add("active"))}deactivate(){this.active&&this.dropZone&&(this.active=!1,this.dropZone.classList.remove("active"),this.props.onDone&&this.props.onDone())}render(){const{appendClass:e,children:t,disabled:i}=this.props;return(0,n.h)("div",{class:s(e),onDragEnter:i?void 0:this.onDragOver,onDragLeave:i?void 0:this.onDragLeave,onDragOver:i?void 0:this.onDragOver,onDragEnd:i?void 0:this.onDragEnd,onDrop:i?void 0:this.onDrop},(0,n.h)("div",{class:"file-drop-zone",ref:this.setDropZoneRef},(0,n.h)("span",{class:"icon icon-attach"}),(0,n.h)("label",null,"Upload file")),t)}};I=D([o.Z],I);var R=i(42190),L=i(2752),N=i(93528);class OpenMediaEmbedEditorMessage extends N.v{}class CloseMediaEmbedEditorMessage extends N.v{}var k,B,F=i(14071),U=i(47133),V=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};!function(e){e.NONE="none",e.INVALID_URL_SYNTAX="invalid",e.LOADING="loading",e.LOADED="loaded",e.ERROR="error"}(B||(B={}));let H=k=class MediaEmbedEditor extends n.Component{constructor(e){super(e),this.open=()=>{this.el.classList.add("open"),this.focus()},this.close=()=>{this.el.classList.remove("open")},this.onInput=e=>{const t=(0,S.j)(e)?B.NONE:B.INVALID_URL_SYNTAX;this.setState({validationPhase:t,currentUrl:e})},this.onApply=e=>{this.isDisabled()||this.onDoneEditing(this.state.currentUrl)},this.stopPropagation=e=>{e.stopPropagation()},this.onDoneEditing=async e=>{const{onEmbed:t}=this.props;if(e){null!==await this.loadMedia(e)?(this.setState({validationPhase:B.LOADED}),t(e)):this.setState({validationPhase:B.ERROR,currentUrl:e})}},this.loadMedia=async e=>{const{assetId:t,assetType:i}=this.props;return this.setState({validationPhase:B.NONE}),e?(this.setState({validationPhase:B.LOADING}),this.context.commandBinder.issueCommand(new h.wu(t,i,e))):null},this.setRef=e=>this.el=e,this.setUrlRef=e=>this.urlInput=e,this.state={currentUrl:"",validationPhase:B.NONE}}componentDidMount(){this.context.messageBus.subscribe(OpenMediaEmbedEditorMessage,this.open),this.context.messageBus.subscribe(CloseMediaEmbedEditorMessage,this.close)}componentWillUnmount(){this.context.messageBus.unsubscribe(OpenMediaEmbedEditorMessage,this.open),this.context.messageBus.unsubscribe(CloseMediaEmbedEditorMessage,this.close)}focus(){this.urlInput&&this.urlInput.focus()}isDisabled(){const{validationPhase:e,currentUrl:t}=this.state;return e===B.ERROR||e===B.LOADING||e===B.INVALID_URL_SYNTAX&&""!==t||""===t}renderHelpMessage(){const{currentUrl:e,validationPhase:t}=this.state;switch(t){case B.ERROR:return(0,n.h)("div",{class:"popover-message popover-message-error"},"Can't find media. Please check URL.",(0,n.h)("a",{class:"link",target:"_blank",rel:"noreferrer",href:k.supportPage},"Help"));case B.LOADING:return(0,n.h)("div",{class:"popover-message"},"Looking up media...");case B.INVALID_URL_SYNTAX:if(""!==e)return(0,n.h)("div",{class:"popover-message popover-message-error"},"Invalid URL")}return(0,n.h)("div",{class:"popover-message"},(0,n.h)("a",{class:"link",target:"_blank",href:k.supportPage},"See supported formats"))}render(){const{onCancel:e}=this.props,t=this.isDisabled()?b.BN.DISABLED:b.BN.ENABLED;return(0,n.h)("div",{ref:this.setRef,class:"annotation-popup media-embed-editor",onClick:this.stopPropagation},(0,n.h)("div",{class:"popover-header"},(0,n.h)("div",{class:"popover-label"},"Media Link"),(0,n.h)(F.P,{buttonStyle:F.A.LIGHT,onClose:e})),(0,n.h)(U.Z,{ref:this.setUrlRef,text:"",type:"url",placeholder:"https://",onDone:this.onDoneEditing,onInput:this.onInput}),(0,n.h)("div",{class:"popover-footer"},this.renderHelpMessage(),(0,n.h)(b.zx,{appendClass:{"button-inline":!0},buttonStyle:b.ZJ.CLEAR,buttonSize:b.qE.SMALL,buttonState:t,onClick:this.onApply},"Apply")))}};H.supportPage="https://support.matterport.com/hc/en-us/articles/115006363868-Add-Multimedia-to-a-Mattertag-Post",H=k=V([o.Z],H);var G=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};var z,j;!function(e){e.EMBED="embed",e.LINK="link"}(z||(z={})),function(e){e.COLLABORATION="collaboration",e.PRESENTATION="presentation"}(j||(j={}));let W=class Annotation extends n.Component{constructor(e){super(e),this.bindings=[],this.iMobile=(0,r.s)()||(0,r._1)(),this.updatePendingAttachments=()=>{if(!this.attachmentsData)return;const{active:e,assetType:t,assetId:i}=this.props;if(!e)return;const n=this.attachmentsData.getPendingAttachmentsForAsset(i,t);this.setState({pendingAttachments:n})},this.handleFocus=e=>{const t=this.props.toolPanelLayout===l.wS.BOTTOM_PANEL;this.textEditor&&this.iMobile&&t&&window.setTimeout((()=>{this.textEditor.getTextElement().scrollIntoView()}),200)},this.cancelEdits=()=>{this.props.onCancelEditing&&this.props.onCancelEditing()},this.saveEdits=()=>{this.onDoneEditing()},this.onDoneEditing=()=>{const{attachments:e,onDoneEditing:t}=this.props;if(t){const{pendingAttachments:i,currentUploads:n}=this.state,s=this.getMarkdown(),o=e.length+i.length+n.length===0;t(s,""===s&&o)}},this.onClickTextBox=()=>{this.props.active||this.startEditingAnnotation()},this.onInput=e=>{this.setState({textChanged:e!==this.props.text})},this.startEditingAnnotation=()=>{const{onClickToEdit:e}=this.props;e&&e()},this.setPopupEditor=(e,t)=>{t?this.setState({popup:e}):e===this.state.popup&&this.setState({popup:null})},this.openLinkEditor=()=>{!(this.state.popup===z.LINK)&&this.textEditor&&(this.trackEvent("notes_open_link_editor"),this.textEditor.prepareLinkForEdit())},this.onClickBlock=e=>{const{active:t}=this.props,i=e.blockType;if(i===a.C.LINK&&t){this.setState({selectedBlock:e}),this.setPopupEditor(z.LINK,!0);const t=""!==e.text;this.context.messageBus.broadcast(new L.g(t))}else t||i!==a.C.USER&&i!==a.C.HASH||this.context.commandBinder.issueCommand(new c.R(e))},this.closeLinkEditor=()=>{this.context.messageBus.broadcast(new L.Z),this.setPopupEditor(z.LINK,!1),this.setState({selectedBlock:null})},this.toggleEmbedEditor=()=>{this.state.popup!==z.EMBED?(this.trackEvent("notes_open_embed_editor"),this.setPopupEditor(z.EMBED,!0),this.context.messageBus.broadcast(new OpenMediaEmbedEditorMessage)):this.closeEmbedEditor()},this.closeEmbedEditor=()=>{this.setPopupEditor(z.EMBED,!1),this.context.messageBus.broadcast(new CloseMediaEmbedEditorMessage)},this.onRemoveLink=()=>{this.onSaveLink("","")},this.onSaveLink=(e,t)=>{const{popup:i}=this.state;i===z.LINK&&this.textEditor&&(this.setState({textChanged:!0}),this.textEditor.saveLink(e,t),this.closeLinkEditor())},this.onViewAttachment=(e,t)=>{this.props.onViewAttachment&&this.props.onViewAttachment(e,t)},this.onRemoveAttachment=e=>{this.trackEvent("notes_click_remove_attachment"),this.context.commandBinder.issueCommand(new h.$T(e))},this.onClickFileInput=()=>{this.startEditingAnnotation()},this.onFileUpload=e=>{const{attachments:t,editable:i,assetId:n,assetType:s}=this.props;if(!i)return;const o=Array.from(e),{pendingAttachments:r}=this.state,a=t.length+r.length;e.length+a>p.yk&&o.splice(p.yk-a),this.setState((e=>{const t=o.map(((e,t)=>({progress:0,index:t,error:null,file:e})));return{currentUploads:e.currentUploads.concat(t),uploading:!0}})),this.context.commandBinder.issueCommand(new h.It(n,s,o)),this.context.messageBus.subscribe(d.Vj,this.updateProgress),this.context.messageBus.subscribe(d.RE,this.uploadingDone),this.edit()},this.onDrop=e=>{this.trackEvent("notes_drag_and_dropped"),this.onFileUpload(e)},this.onFilesChosen=e=>{this.trackEvent("notes_files_chosen"),this.onFileUpload(e)},this.dropActivated=()=>{const{active:e,creating:t}=this.props;t&&!e&&this.startEditingAnnotation()},this.updateProgress=e=>{if(e.assetType!==this.props.assetType||e.assetId!==this.props.assetId)return;const t=e.status;this.setState((e=>({currentUploads:e.currentUploads.map((e=>e.file===t.file?Object.assign(Object.assign({},e),t):e))})))},this.uploadingDone=e=>{e.assetType===this.props.assetType&&e.assetId===this.props.assetId&&(this.updatePendingAttachments(),this.setState({currentUploads:e.uploads,uploading:!1}),this.context.messageBus.unsubscribe(d.Vj,this.updateProgress),this.context.messageBus.unsubscribe(d.RE,this.uploadingDone))},this.setTextEditorRef=e=>this.textEditor=e,this.state={textChanged:!1,attachmentsChanged:!1,uploading:!1,selectedBlock:null,pendingAttachments:[],currentUploads:[],popup:null}}componentDidMount(){this.context.market.waitForData(u.b).then((e=>{this.attachmentsData=e,this.bindings.push(this.attachmentsData.onChanged(this.updatePendingAttachments)),this.updatePendingAttachments()}))}componentWillUnmount(){for(const e of this.bindings)e.cancel()}componentDidUpdate(e,t){e.active&&!this.props.active&&this.setState({attachmentsChanged:!1,textChanged:!1,pendingAttachments:[],currentUploads:[]}),e.attachments!==this.props.attachments&&this.setState({attachmentsChanged:!0}),this.props.assetId===e.assetId&&this.props.assetType===e.assetType||this.updatePendingAttachments()}edit(){this.textEditor&&this.textEditor.toggleEditing(!0)}focus(){this.textEditor&&this.textEditor.focus()}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}getMarkdown(){return this.textEditor?this.textEditor.getMarkdown():this.props.text}inEmptyState(){const{attachments:e,active:t,text:i}=this.props,{pendingAttachments:n,currentUploads:s}=this.state,o=e.length+n.length+s.length===0;return""===i&&o&&!t}renderButtonBar(){const{attachments:e,active:t,creating:i,assetId:s}=this.props;if(!t)return null;const{pendingAttachments:o,textChanged:r,attachmentsChanged:a,uploading:l}=this.state,c=e.length+o.length>=p.yk,h=r||a,d=i?"Add":"Save",u=h&&t&&!l?b.BN.ENABLED:b.BN.DISABLED,m=p.Y1.extensions.join(","),g=c?b.BN.DIMMED:l?b.BN.DISABLED:b.BN.ENABLED,f=c?`${p.yk} attachments max`:void 0;return(0,n.h)("div",{class:"annotation-button-bar"},(0,n.h)("div",{class:"annotation-editors"},(0,n.h)(C,{id:`${s}-annotation`,accept:m,multi:!0,buttonState:g,tooltip:f,onUpload:this.onFilesChosen,onClick:this.onClickFileInput}),(0,n.h)(O.h,{iconClass:"icon-media-mix",buttonStyle:O.D.PLAIN,onClick:this.toggleEmbedEditor}),(0,n.h)(O.h,{iconClass:"icon-link",buttonStyle:O.D.PLAIN,onClick:this.openLinkEditor})),(0,n.h)("div",{class:"annotation-cta-buttons"},(0,n.h)(b.zx,{buttonStyle:b.ZJ.SECONDARY,buttonSize:b.qE.SMALL,appendClass:{"button-inline":!0},buttonState:b.BN.ENABLED,onClick:this.cancelEdits},"Cancel"),(i||h)&&(0,n.h)(b.zx,{appendClass:{"button-inline":!0},buttonStyle:b.ZJ.SECONDARY,buttonSize:b.qE.SMALL,buttonState:u,onClick:this.saveEdits},d)))}renderAttachment(e,t,i){const{active:s}=this.props,o=!s&&(1===i||0===t&&i>2),r=s?80:o?300:140,a=s?80:o?250:140,l=s||!o;return(0,n.h)(m.P,{attachment:e,sizeMedia:!0,width:r,height:a,hero:o,cover:!0,thumbnail:l,appendClass:{inline:s},onClick:s?void 0:this.onViewAttachment,onRemove:s?this.onRemoveAttachment:void 0})}renderPendingUpload(e){return 100===e.progress&&null===e.error?null:(0,n.h)(y,{appendClass:{inline:!0},progress:e.progress,error:e.error})}renderAttachments(){const{attachments:e,active:t}=this.props,{pendingAttachments:i,currentUploads:o}=this.state,r=e.length;return(0,n.h)("div",{class:s("annotation-attachments",{"annotation-attachments-inline":t})},e.map(((e,t)=>this.renderAttachment(e,t,r))),i.map(((e,t)=>this.renderAttachment(e,t,r))),o.map(((e,t)=>this.renderPendingUpload(e))))}renderTextBox(){const{placeholder:e,hashtags:t,text:i,creating:s,clickToEdit:o,active:r,editable:a,maxLength:l,tabIndex:c,annotationType:h}=this.props,d=h===j.COLLABORATION,u=this.inEmptyState()&&d,p=u&&!s?"Original content was deleted":e,m=u&&p?"placeholder":void 0,g=o&&a?this.onClickTextBox:void 0;return(0,n.h)(A,{ref:this.setTextEditorRef,className:m,text:i,active:!!r,placeholder:p,onClickBlock:this.onClickBlock,onClickToEdit:g,onDoneEditing:this.onDoneEditing,onCancelEditing:this.cancelEdits,onFocus:this.handleFocus,onInput:this.onInput,tabIndex:c,maxLength:l,hashtags:t||[],userMentions:d})}renderReadonlyAnnotation(){const{appendClass:e,creating:t,annotationType:i,title:o}=this.props,r=i===j.COLLABORATION,a={"annotation-emptied":this.inEmptyState()&&!t&&r};return e&&Object.keys(e).length>0&&Object.assign(a,e),(0,n.h)("div",{class:"annotation-box"},!r&&this.renderAttachments(),o&&(0,n.h)("div",{class:"annotation-title"},o),(0,n.h)("div",{class:s("annotation-text-box",a)},this.renderTextBox()),r&&this.renderAttachments())}renderEditableAnnotation(){const{attachments:e,appendClass:t,creating:i,active:o,assetId:r,assetType:l,editable:c,clickToEdit:h,edited:d,annotationType:u}=this.props,{pendingAttachments:m,uploading:g,selectedBlock:f}=this.state,v=e.length+m.length<p.yk,y=c&&!g&&(o||i)&&v,b=u===j.COLLABORATION,w=this.inEmptyState()&&!i&&b,S=!o&&d&&!w,E={annotating:o,"editor-box":o||h,"annotation-emptied":w};t&&Object.keys(t).length>0&&Object.assign(E,t);let T="",M="";return f&&f.blockType===a.C.LINK&&(T=f.text,M=f.value||""),(0,n.h)(I,{appendClass:{"annotation-box":!0},onDropped:this.onDrop,disabled:!y,onActivate:this.dropActivated},(0,n.h)("div",{class:s("annotation-text-box",E)},this.renderTextBox(),o&&this.renderAttachments(),o&&this.renderButtonBar()),S&&(0,n.h)("div",{class:"annotation-edited"},"(edited)"),!o&&!i&&this.renderAttachments(),o&&!!r&&(0,n.h)(H,{assetId:r,assetType:l,onEmbed:this.closeEmbedEditor,onCancel:this.closeEmbedEditor}),o&&!!r&&(0,n.h)(R.s,{linkText:T,linkUrl:M,onCancel:this.closeLinkEditor,onSaveLink:this.onSaveLink,onRemoveLink:this.onRemoveLink}))}render(){return this.props.editable?this.renderEditableAnnotation():this.renderReadonlyAnnotation()}};W=G([o.Z],W);const Z=W},2082:(e,t,i)=>{"use strict";i.d(t,{E:()=>x});var n,s=i(26605),o=i(91033),r=i(2116),a=i(94184),l=i(47924),c=i(90601),h=i(43711),d=i(90926),u=i(68611),p=i(70008),m=i(87493),g=i(16945),f=i(59064),v=i(53189),y=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let b=n=class NotePreviewer extends s.Component{constructor(e){super(),this.openAttachment=(e,t)=>{this.trackEvent("notes_preview_click_attachment"),e.stopPropagation(),this.props.onClick(t)},this.onClickNote=e=>{e.stopPropagation(),this.props.onClick()},this.state={noteView:null}}componentDidMount(){this.updateNoteView()}componentDidUpdate(e){e.previewId!==this.props.previewId&&this.updateNoteView()}updateNoteView(){const{previewId:e}=this.props,{toolsData:t}=this.context,i=t.getTool(c.w1.NOTES);if(i){const t=i.manager.dataMap.notesViewData.getNoteView(e);this.setState({noteView:t})}}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}renderNoteImages(e){return(0,s.h)(g.T,{attachments:e,startIndex:0,width:318,height:130,onClick:this.openAttachment})}renderNoteHeader(e,t){const i=e.created,n=this.context.userData.getUserInfoDisplay(e.user.id),o=n.color,r=e.comments.length-1,a=1===r?`${r} reply`:`${r} replies`,l=""===e.text&&!t?"Original content was deleted":i.toLocaleString();return(0,s.h)("header",{class:"note-header"},(0,s.h)(f.C,{label:n.initials,badgeStyle:{color:o,"border-color":o}}),(0,s.h)("div",{class:"note-details"},(0,s.h)("span",{class:"note-user"},n.name),r>0&&(0,s.h)("span",{class:"note-summary-info note-replies"},a),(0,s.h)("div",{class:"note-subheader"},l)))}renderNotePost(e){const t=e.text.length>n.MAX_NOTE_LENGTH,i=t||e.comments.length>0,o=t?`${e.text.substring(0,n.MAX_NOTE_LENGTH)}...`:e.text;return(0,s.h)("div",{class:a("note-post",{"note-summary-info":!o})},o&&(0,s.h)(v.Z,{text:o,activeLinks:!0,hashtags:!0,userMentions:!0}),i&&(0,s.h)("div",{class:"link link-more"},"Read more >"))}render(){const{noteView:e}=this.state;if(!e)return null;const t=e.attachments,i=t.length>0;return(0,s.h)("div",{class:a("annotation-preview-contents","note-preview-contents",{"has-image":i}),onClick:this.onClickNote},i&&this.renderNoteImages(t),this.renderNoteHeader(e,i),this.renderNotePost(e))}};b.MAX_NOTE_LENGTH=150,b=n=y([r.Z],b);var w,S=i(7920),E=i(252),T=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let M=w=class TagPreviewer extends s.Component{constructor(e){super(),this.openAttachment=(e,t)=>{this.trackEvent("tags_preview_click_attachment"),this.props.onClick(t)},this.onClickTag=e=>{e.stopPropagation(),this.props.onClick()},this.state={tagView:null}}componentDidMount(){this.updateTagView()}componentDidUpdate(e){e.previewId!==this.props.previewId&&this.updateTagView()}updateTagView(){const{previewId:e}=this.props,{toolsData:t}=this.context,i=t.getTool(c.w1.TAGS);if(i){const t=i.manager.dataMap.tagsViewData.getTagView(e);this.setState({tagView:t})}}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}renderWidgetFrame(e){const{widgetFrame:t}=e;return t?(0,s.h)(E.l,{widget:t}):null}renderTitle(e){const{label:t}=e;return t?(0,s.h)("header",{class:"tag-header"},t):null}renderDescription(e){const{description:t}=e;if(!t)return null;const i=t.length>w.MAX_TAG_LENGTH,n=i?`${t.substring(0,w.MAX_TAG_LENGTH)}...`:t;return(0,s.h)("div",{class:"tag-description"},n&&(0,s.h)(v.Z,{text:n,activeLinks:!0,hashtags:!1,userMentions:!1}),i&&(0,s.h)("div",{class:"link link-more"},"Read more >"))}render(){const{tagView:e}=this.state;if(!e)return null;const{layerWidth:t,layerHeight:i}=this.props,n=e.attachments,o=n.length>0;return(0,s.h)("div",{class:a("annotation-preview-contents","tag-preview-contents",{"has-image":o}),onClick:this.onClickTag},(0,s.h)(S.v,{attachments:n,sizeMedia:!0,layerWidth:t,layerHeight:i,onClick:this.openAttachment}),this.renderTitle(e),this.renderDescription(e),this.renderWidgetFrame(e))}};M.MAX_TAG_LENGTH=100,M=w=T([r.Z],M);var _=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let x=class AnnotationsLayer extends s.Component{constructor(e){super(),this.bindings=[],this.clickOuterAnnotation=()=>{const{currentPin:e,pinState:t}=this.state;e&&(e.pinType===d.Er.MATTERTAG?t===d.tS.SELECTED?this.context.commandBinder.issueCommand(new m.xb):(this.trackEvent("select_tag"),this.context.commandBinder.issueCommand(new u.Ar(e.id,d.Er.MATTERTAG))):e.pinType===d.Er.NOTE&&this.onClickNote())},this.onClickNote=async e=>{const{currentPin:t}=this.state;t&&(this.trackEvent("open_note_preview"),this.clickInnerAnnotationToOpen(t,c.w1.NOTES,e))},this.onClickTag=e=>{const{currentPin:t}=this.state;t&&(this.trackEvent("open_tag_preview"),this.clickInnerAnnotationToOpen(t,c.w1.TAGS,e))},this.onResize=()=>{this.updatePositioning()},this.onScreenPositionChanged=()=>{this.updatePositioning()},this.updateOpenPin=()=>{const{openPin:e,pinState:t}=this.viewData,{currentPin:i}=this.state;if(e&&t===d.tS.SELECTED){const t=e.id!==(null==i?void 0:i.id);this.setState({currentPin:e}),t&&this.trackEvent("switch_pin_annotation"),this.updatePositioning(t)}else this.setState({currentPin:null})},this.updatePreviewPin=()=>{const{previewPin:e}=this.viewData,{currentPin:t}=this.state;if(e){const i=e.id!==(null==t?void 0:t.id);i&&this.trackEvent("preview_pin_annotation"),this.updatePositioning(i)}this.setState({currentPin:e})},this.updatePinState=()=>{this.setState({pinState:this.viewData.pinState})},this.updatePositioning=e=>{if(!this.viewData||!this.layer||!this.state.currentPin)return;const t=this.viewData.screenPosition;if(t){const i=t.x,n=t.y;e&&this.updatePreviewDirection(i,n),this.setState({screenPosition:t,layerWidth:this.layer.offsetWidth,layerHeight:this.layer.offsetHeight})}},this.updatePreviewDirection=(e,t)=>{const i=this.layer.offsetWidth,n=.5,s=1-(e+1)/i*2,o=1-(t+1)/this.layer.offsetHeight*2,r=o<-.5?0:o>n?2:1,a=s<-.5?2:s>n?0:1;let l;if(0===a)l=1===r?d.Od.RIGHT:0===r?d.Od.UP_RIGHT:d.Od.DOWN_RIGHT;else if(2===a)l=1===r?d.Od.LEFT:0===r?d.Od.UP_LEFT:d.Od.DOWN_LEFT;else{const t=Math.max(e,i-e);l=1===r&&t>378?s<0?d.Od.RIGHT:d.Od.LEFT:2===r?d.Od.DOWN:d.Od.UP}this.setState({previewDirection:l})},this.setLayerRef=e=>{e&&(this.layer=e,this.resizeObserver.observe(this.layer),this.updatePositioning())},this.state={currentPin:null,screenPosition:null,previewDirection:d.Od.DOWN,pinState:d.tS.IDLE,layerWidth:0,layerHeight:0},this.resizeObserver=new o.Z(this.onResize)}componentDidMount(){const{market:e}=this.context;e.waitForData(p.B).then((e=>{this.viewData=e,this.bindings.push(e.onOpenPinChanged(this.updateOpenPin),e.onPreviewPinChanged(this.updatePreviewPin),e.onScreenPositionChanged(this.onScreenPositionChanged),e.onPinStateChanged(this.updatePinState)),this.updatePinState()}))}componentWillUnmount(){for(const e of this.bindings)e.cancel();this.resizeObserver&&this.resizeObserver.disconnect()}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}async clickInnerAnnotationToOpen(e,t,i){const{activeTool:n}=this.props,{commandBinder:s}=this.context,o=n===t;n&&!o&&await s.issueCommand(new h.tT(n,!1)),o||await s.issueCommand(new h.tT(t,!0)),await s.issueCommand(new u.$b(e.id,e.pinType,l.n.Interpolate,i))}getPreviewPositioning(){const{screenPosition:e,previewDirection:t}=this.state;if(e){let i="",n=e.x;switch(t){case d.Od.UP:i="translate(-50%, -100%)";break;case d.Od.DOWN:i="translateX(-50%)";break;case d.Od.LEFT:i="translate(-100%, -50%)";break;case d.Od.RIGHT:i="translateY(-50%)";break;case d.Od.UP_LEFT:n+=50,i="translate(-100%, -100%)";break;case d.Od.UP_RIGHT:i="translate(-50px, -100%)";break;case d.Od.DOWN_LEFT:n+=50,i="translate(-100%, 5px)";break;case d.Od.DOWN_RIGHT:i="translate(-50px, 5px)"}return{top:`${e.y}px`,left:`${n}px`,transform:i}}return{}}render(){const{openModal:e,newTagsEnabled:t,notesEnabled:i}=this.props;if(e)return null;const{currentPin:n,pinState:o,previewDirection:r,layerWidth:l,layerHeight:c}=this.state,h=o===d.tS.PREVIEWING||o===d.tS.SELECTED,u=h&&t&&n&&n.pinType===d.Er.MATTERTAG,p=h&&i&&n&&n.pinType===d.Er.NOTE;return(0,s.h)("div",{ref:this.setLayerRef,class:"annotations-preview-layer"},n&&(u||p)&&(0,s.h)("div",{class:a("annotation-preview",`annotation-preview-${r}`,{"tag-preview":!!u,"note-preview":!!p}),style:this.getPreviewPositioning(),onClick:this.clickOuterAnnotation},u&&(0,s.h)(M,{previewId:n.id,onClick:this.onClickTag,layerWidth:l,layerHeight:c}),p&&(0,s.h)(b,{previewId:n.id,onClick:this.onClickNote})))}};x=_([r.Z],x)},88686:(e,t,i)=>{"use strict";i.d(t,{P:()=>M});var n=i(26605),s=i(94184),o=i(2116),r=i(32143),a=i(48520),l=i(17141),c=i(73305),h=i(25799),d=i(21265),u=i(21746),p=i(99898),m=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let g=class Image extends n.Component{constructor(e){super(e),this.clickImage=e=>{this.props.onClick&&this.props.onClick(e,this.props.id)}}getSmartCropUrl(e,t,i){const n=-1!==e.indexOf("?");return`${e}${n?"&":"?"}height=${i}&crop=${t}:${i},smart`}render(){const{appendClass:e,onClick:t,url:i,width:o,height:r,cover:a,smartCrop:l}=this.props,c={"image-cover":!!(a&&o&&r)};if(e&&Object.keys(e).length>0&&Object.assign(c,e),a&&o&&r){const e={backgroundImage:(l?this.getSmartCropUrl(i,o,r):i)?`url('${i}')`:"none"};return(0,n.h)("div",{class:s("image",c),style:e,onClick:t?this.clickImage:void 0})}{const e={};return o&&(e.width=`${o}px`),r&&(e.height=`${r}px`),(0,n.h)("img",{class:s("image",c),src:i,style:e,onClick:t?this.clickImage:void 0})}}};g=m([o.Z],g);var f=i(80429),v=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};const y=new h.Z("mattertag-media");var b;!function(e){e[e.NOT_READY=1]="NOT_READY",e[e.CUED=2]="CUED",e[e.PLAYING=3]="PLAYING",e[e.PAUSED=4]="PAUSED"}(b||(b={}));let w=class EmbeddedMedia extends n.Component{constructor(e){super(e),this.playerControls=null,this.handleClick=e=>{this.state.embed&&this.props.onClick&&this.props.onClick(e,this.props.attachment.id)},this.onPlayerLoaded=e=>{this.playerControls=e,e.play()},this.setupPlayerControls=e=>{let t=b.NOT_READY;const i=()=>{t=b.CUED,this.onPlayerLoaded(a)},n=()=>{t=b.PLAYING},s=()=>{t=b.PAUSED},o=()=>{};try{e.on("ready",i),e.on("play",n),e.on("pause",s),e.on("ended",o)}catch(e){y.debug(e)}const r=(0,d.tq)(),a={play:()=>{if(e&&t!==b.NOT_READY&&!r)try{e.play()}catch(e){y.error(e)}},pause:()=>{if(e&&t!==b.NOT_READY)try{e.pause()}catch(e){y.debug(e)}}}},this.updateMaxDims=()=>{const{width:e,height:t,getContainer:i}=this.props,{embed:n}=this.state,s=i();if(!s||e&&t||!n)return;const o=s.getBoundingClientRect();this.setState({maxWidth:o.width,maxHeight:o.height})},this.getMediaStyles=()=>{const{maxWidth:e,maxHeight:t,embed:i}=this.state;if(!i)return{};const{mediaType:n,mediaUrl:s,provider:o,width:r,height:l}=i,c=this.getMediaAspectRatio(),h={};switch(n){case a.E.IMAGE:h.backgroundImage=s?`url("${s}")`:"none";case a.E.RICH:void 0!==r&&(h.width=`${r}px`),void 0!==l&&(h.height=`${l}px`,o===p.Er?h.height=`${l+54}px`:h.height=`${l}px`);break;case a.E.VIDEO:if(e&&t)if(r<=e&&l<=t)h.width=`${r}px`,h.height=`${l}px`;else{const i=Math.min(t,(0,u.yB)(e,e/c)),n=i*c;h.width=`${n}px`,h.height=`${i}px`}}return h},this.setEmbedRef=e=>{!e||this.iframe||this.props.width||this.props.height||this.createEmbedIframe(e)},this.state={maxWidth:0,maxHeight:0,embed:null}}componentDidMount(){this.getEmbeddedMedia(this.props.attachment.id)}componentWillUnmount(){window.removeEventListener("resize",this.updateMaxDims),this.playerControls&&this.playerControls.pause()}componentWillReceiveProps(e){e.attachment.src!==this.props.attachment.src&&(this.iframe&&this.iframe.parentNode&&(this.iframe.parentNode.removeChild(this.iframe),this.iframe=null),this.getEmbeddedMedia(e.attachment.id))}componentDidUpdate(e,t){this.props.width||this.props.height||t.embed||!this.state.embed||this.state.embed.mediaType!==a.E.VIDEO||(window.addEventListener("resize",this.updateMaxDims),this.updateMaxDims())}getEmbeddedMedia(e){this.context.commandBinder.issueCommand(new c.st(e)).then((e=>{this.setState({embed:e}),this.updateMaxDims()}))}getMediaAspectRatio(){if(!this.state.embed)return 1;const{width:e,height:t}=this.state.embed;return t>0?e/t:1}createEmbedIframe(e){const{embed:t}=this.state;if(!t)return;const{html:i,provider:n,src:s,mediaUrl:o,mediaType:r,width:c,height:h}=t,d=document.createElement("div");d.innerHTML=i;let u=d.firstChild;if("iframe"!==u.tagName.toLowerCase()){if(u=document.createElement("iframe"),!("srcdoc"in u))return y.warn(`Browser does not support srcdoc, refusing to embed ${i}`),void(this.iframe=null);let e,t;void 0!==c&&(u.width=c.toString()),void 0!==h&&(u.height=h.toString()),u.setAttribute("allow","encrypted-media; autoplay; fullscreen"),u.classList.add("embedded-iframe-sandbox","loading"),u.onload=()=>u.classList.remove("loading"),e=n===p.T_&&void 0!==s?`<img src=${o} />`:i,t=n===p.Er?"\n          <style>\n            html, body { padding: 0; margin: 0; border: 0; }\n            img { display: block; max-width: 100%; height: auto; border: 0; }\n            iframe { display: block; max-width: 100%; border: 0; }\n          </style>\n        ":"\n          <style>\n            html, body { padding: 0; margin: 0; border: 0; }\n            img, iframe { display: block; max-width: 100%; height: auto; border: 0; }\n          </style>\n        ";const r=t.replace(/\s+/g," ");u.srcdoc=`<!doctype html>${r}${e}`}else{const e=u.style;e.maxWidth="100%",e.maxHeight="100%",e.minWidth="",e.minHeight=""}if(r===a.E.VIDEO&&u.src)try{const e=new l.Player(u);u.addEventListener("load",(()=>this.setupPlayerControls(e)))}catch(e){y.error(e)}this.iframe=u,e.appendChild(u)}renderMediaImage(e){const{width:t,height:i,thumbnail:s,attachment:o,cover:r}=this.props,{thumbnailUrl:l,mediaUrl:c,mediaType:h}=e,d=h===a.E.VIDEO;if(r){const e=s||!c||d?l:c,t={backgroundImage:e?`url('${e}')`:"none"};return(0,n.h)("div",{class:"attachment-view image-cover",style:t,onClick:this.handleClick},d&&(0,n.h)(f.h,{appendClass:{"attachment-play":!0},iconClass:"icon-play-unicode"}))}{let r;if(t&&i){const n=this.getMediaAspectRatio();r=n>1?Math.max(Math.min(e.width,400,t),310):Math.max(Math.min(e.width,300),200);r/n>i&&(r=i*n)}return(0,n.h)(g,{id:o.id,url:s?l:c,cover:!1,width:r,smartCrop:!1,appendClass:{"attachment-view":!0},onClick:this.handleClick})}}render(){const{embed:e}=this.state;if(!e)return null;const{cover:t,width:i,height:s,sizeMedia:o}=this.props,{mediaType:r,thumbnailUrl:l}=e,c=r===a.E.IMAGE,h=r===a.E.VIDEO;if(c||h&&t&&i&&s&&l){const t=this.renderMediaImage(e);if(t)return t}const d=o?this.getMediaStyles():{};return(0,n.h)("div",{class:"embedded-content",onClick:this.handleClick,ref:this.setEmbedRef,style:d})}};w=v([o.Z],w);var S=i(42733),E=i(26265),T=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let M=class Attachment extends n.Component{constructor(e){super(e),this.attachmentDiv=null,this.removeAttachment=()=>{this.props.onRemove&&this.props.onRemove(this.props.attachment.id)},this.getAttachmentDiv=()=>this.attachmentDiv,this.setAttachmentRef=e=>{this.attachmentDiv=e}}getAttachmentStyle(){const{attachment:e,width:t,height:i,cover:n}=this.props;return n&&void 0===t&&void 0===i&&e.width&&e.height?{maxHeight:e.height,maxWidth:e.width}:{}}renderAttachment(){const{attachment:e,width:t,height:i,thumbnail:s,onClick:o,cover:l,sizeMedia:c}=this.props,{category:h,id:d,url:u,thumbnailUrl:p}=e;if(e.category===r.G.UPLOAD&&e.mediaType===a.E.IMAGE)return(0,n.h)(g,{id:d,url:s?p:u,cover:l,width:t,height:i,smartCrop:h===r.G.UPLOAD,appendClass:{"attachment-view":!0},onClick:o});if(e.category===r.G.EXTERNAL)switch(e.mediaType){case a.E.IMAGE:case a.E.VIDEO:case a.E.RICH:return(0,n.h)(w,{attachment:e,sizeMedia:c,width:t,height:i,thumbnail:s,cover:l,getContainer:this.getAttachmentDiv,onClick:o})}return null}render(){const{attachment:e,hero:t,appendClass:i,onClick:o,onRemove:r}=this.props,{id:l}=e,c=!!r,h=e.mediaType===a.E.IMAGE,d=this.getAttachmentStyle(),u={clickable:!!o,"hero-image":!!t,photo:h};return i&&Object.keys(i).length>0&&Object.assign(u,i),(0,n.h)("div",{class:s("attachment",u),style:d,ref:this.setAttachmentRef},this.renderAttachment(),c&&(0,n.h)(f.h,{iconClass:"icon-close",appendClass:{"attachment-delete":!0},buttonStyle:f.D.SOCIAL,buttonSize:S.qE.SMALL,tooltipMsg:"Delete Attachment",tooltipPosition:E.lZ.DOWN_LEFT,onClick:this.removeAttachment,dataValue:l}))}};M=T([o.Z],M)},16945:(e,t,i)=>{"use strict";i.d(t,{T:()=>l});var n=i(26605),s=i(2116),o=i(88686),r=i(80429),a=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let l=class AttachmentCarousel extends n.Component{constructor(e){super(),this.onNext=e=>{const{attachments:t}=this.props,{index:i}=this.state;e.stopPropagation();const n=i+1<t.length?i+1:0;this.trackEvent("notes_viewer_next"),this.setState({index:n})},this.onPrev=e=>{const{attachments:t}=this.props,{index:i}=this.state;e.stopPropagation();const n=i>0?i-1:t.length-1;this.trackEvent("notes_viewer_prev"),this.setState({index:n})},this.state={index:e.startIndex}}componentWillReceiveProps(e){this.setState({index:e.startIndex})}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}render(){const{attachments:e,width:t,height:i,onClick:s}=this.props,{index:a}=this.state,l=e[a];if(!l)return null;const c=void 0!==t&&void 0!==i,h=e.length>1;return(0,n.h)("div",{class:"attachment-carousel"},(0,n.h)("div",{class:"attachment-carousel-view"},(0,n.h)(o.P,{attachment:l,sizeMedia:!0,width:t,height:i,cover:c,thumbnail:!1,onClick:s})),h&&(0,n.h)(r.h,{appendClass:{"modal-nav":!0,"modal-prev":!0},iconClass:"icon-dpad-left",onClick:this.onPrev}),h&&(0,n.h)(r.h,{appendClass:{"modal-nav":!0,"modal-next":!0},iconClass:"icon-dpad-right",onClick:this.onNext}))}};l=a([s.Z],l)},82359:(e,t,i)=>{"use strict";i.d(t,{I:()=>g});var n=i(26605),s=i(2116),o=i(94184),r=i(12856),a=i(71583),l=i(82209),c=i(73305),h=i(43770),d=i(16945),u=i(80429),p=i(26265),m=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let g=class AttachmentViewer extends n.Component{constructor(){super(),this.closeAttachmentViewer=()=>{this.state.open&&this.context.commandBinder.issueCommand(new a.Bz(r.P.ATTACHMENT,!1))},this.modalToggled=e=>{e.modal===r.P.ATTACHMENT&&this.setState({open:e.open})},this.viewAttachment=e=>{this.context.commandBinder.issueCommand(new a.Bz(r.P.ATTACHMENT,!0)),this.setState({open:!0,attachments:e.attachments,attachmentIndex:e.index})},this.state={open:!1,attachmentIndex:-1,attachments:[]}}componentDidMount(){this.context.commandBinder.addBinding(c.SI,this.viewAttachment),this.context.messageBus.subscribe(l.nV,this.modalToggled),this.context.messageBus.subscribe(h.A,this.closeAttachmentViewer)}componentWillUnmount(){this.context.commandBinder.removeBinding(c.SI,this.viewAttachment),this.context.messageBus.unsubscribe(l.nV,this.modalToggled),this.context.messageBus.unsubscribe(h.A,this.closeAttachmentViewer)}render(){const{open:e,attachments:t,attachmentIndex:i}=this.state;return(0,n.h)("div",{class:o("overlay attachment-overlay",{open:e})},e&&(0,n.h)("div",{class:"overlay-close"},(0,n.h)(u.h,{iconClass:"icon-close",buttonStyle:u.D.OVERLAY,tooltipMsg:"Close",tooltipPosition:p.lZ.DOWN,onClick:this.closeAttachmentViewer})),e&&(0,n.h)(d.T,{attachments:t,startIndex:i}))}};g=m([s.Z],g)},78215:(e,t,i)=>{"use strict";i.d(t,{Z:()=>f});var n,s=i(26605),o=i(2116),r=i(83455),a=i(14600),l=i(43711),c=i(90601),h=i(5261),d=i(26265),u=i(80429),p=i(86134),m=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let g=n=class NotesModeButton extends s.Component{constructor(e,t){super(e),this.nudgeTimeout=0,this.updateNudge=()=>{const e=this.context.settings.tryGetProperty(r.pE,!1),t=this.context.settings.tryGetProperty(a.F.NotesModeNudgeSeen,!1);!e||t||this.nudgeTimeout||(this.nudgeTimeout=window.setTimeout((()=>{this.setState({showNudge:!0}),window.setTimeout((()=>{this.dismissNudge()}),n.DISMISS_NUDGE_TIMEOUT)}),n.SHOW_NUDGE_TIMEOUT))},this.dismissNudge=()=>{if(this.state.showNudge){const e=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(e,{gui_action:"notes_nudge_dismissed"}),this.context.settings.setLocalStorageProperty(a.F.NotesModeNudgeSeen,!0),this.setState({showNudge:!1})}},this.openNotesMode=()=>{const e=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(e,{gui_action:"notes_mode_click_open"}),this.context.messageBus.broadcast(new h.E),this.context.commandBinder.issueCommand(new l.tT(c.w1.NOTES,!0))},this.localized={notesModeString:"Notes",nudgeTitleString:"Add a note",nudgeMessageString:"Tap here to add your first note to this space."},this.state={showNudge:!1}}componentDidMount(){this.updateNudge()}render(){const{tooltipTimeout:e}=this.props,{showNudge:t}=this.state,{nudgeTitleString:i,nudgeMessageString:n}=this.localized;return(0,s.h)("div",{class:"notes-mode-button"},(0,s.h)(u.h,{onClick:this.openNotesMode},(0,s.h)(d.oO,{content:this.localized.notesModeString,position:d.lZ.UP,tooltipTimeout:e},(0,s.h)("span",{class:"icon icon-comment-outline"}))),(0,s.h)(p.u,{appendClass:{"tooltip-title-large":!0,"nudge-tooltip":!0},open:t,closeButton:!0,onClose:this.dismissNudge,title:i,message:(0,s.h)("div",{class:"nudge-message"},(0,s.h)("span",{class:"message"},n)),arrowPos:p.x.BOTTOM_CENTER}))}};g.SHOW_NUDGE_TIMEOUT=15e3,g.DISMISS_NUDGE_TIMEOUT=1e4,g=n=m([o.Z],g);const f=g},979:(e,t,i)=>{"use strict";i.d(t,{Z:()=>FloorControls});var n=i(26605),s=i(72942),o=i(22729),r=i(19417),a=i(71208),l=i(12775),c=i(94184),h=i(58091),d=i(21265),u=i(95843),p=i(29359),m=i(26265),g=i(80429),f=i(42733);class FloorControlsPresentation extends n.Component{constructor(e){super(e),this.floors=[],this.scrollbars=null,this.canClick=!1,this.newFloorIndex=null,this.mobile=(0,d.tq)(),this.updateScrollCenter=e=>{void 0===e&&(e=this.props.currentFloor),this.floors.length<=5||this.scrollbars&&(this.newFloorIndex=null,this.scrollbars.setScrollCenter(this.floors[e]))},this.onScrollbarClick=()=>{this.canClick=!0},this.onOutsideClick=e=>{this.toggleMenu(!1)},this.onIconClick=e=>{e.stopPropagation(),this.toggleMenu(),this.context.analytics.track("showcase_gui",{gui_action:"floor_controls"})},this.toggleMenu=e=>{const{showMenu:t}=this.state,i=void 0!==e?e:!t;t!==i&&(i?window.addEventListener("click",this.onOutsideClick):window.removeEventListener("click",this.onOutsideClick),this.setState({showMenu:i}))},this.onFloorClick=e=>{this.scrollbars&&!this.canClick||(e.stopPropagation(),this.toggleMenu(),this.props.handleClickFloor(e),this.context.analytics.track("showcase_gui",{gui_action:"floor_clicked"}))},this.setScrollbarRef=e=>this.scrollbars=e,this.state={showMenu:!1}}componentWillReceiveProps(e){this.props.currentFloor!==e.currentFloor&&(this.newFloorIndex=e.currentFloor)}componentDidUpdate(){null!==this.newFloorIndex&&this.updateScrollCenter(this.newFloorIndex)}getFloorMenu(){const e=this.props.floorNames.map(((e,t)=>(0,n.h)("div",{class:c("floor-button",{current:this.props.currentFloor===t}),key:String(t),ref:e=>{this.floors[t]=e},onClick:this.onFloorClick,"data-value":t},e))).reverse(),t=e.length>5,i=c("floor-menu-wrapper",{"faded-in":this.state.showMenu,scrollable:t});return t?(0,n.h)("div",{class:i},(0,n.h)(h.Z,{name:"floor-menu-wrapper",forceHidden:this.mobile,ref:this.setScrollbarRef,singleScrollDirection:u.Nm.vertical,onScrollbarVisibilityChange:this.updateScrollCenter,handleClick:this.onScrollbarClick},e)):(this.scrollbars=null,(0,n.h)("div",{class:i},e))}render(){const{visible:e,currentFloor:t}=this.props;if(e){const{showMenu:e}=this.state,i=this.props.isAllFloors(t),s=!i&&String(t+1).length>1,o=i?"icon-floor-controls-all":"icon-floor-controls",r=this.context.locale.t(p.Z.HELP_MORE_FLOORS_A),a=e?f.BN.ACTIVE:f.BN.ENABLED;return(0,n.h)(g.h,{buttonState:a,onClick:this.onIconClick,appendClass:{"floor-controls":!0}},this.getFloorMenu(),(0,n.h)(m.oO,{content:r,position:m.lZ.UP,className:c("select-floor",{"tooltip-hidden":e,isAllFloors:i})},(0,n.h)("div",{class:c("floor-number",{twoDigit:s})},(0,n.h)("span",null,!i&&t+1)),(0,n.h)("span",{class:c("icon",o)})))}return(0,n.h)("div",{class:"floor-controls"})}}var v=i(25799),y=i(86682);const b=new v.Z("floor-controls");class FloorControls extends n.Component{constructor(e){super(e),this.originalFloors=[],this.handleClickFloor=async e=>{try{const t=e.target.getAttribute("data-value"),i="string"==typeof t?parseInt(t,10):-1;await this.context.commandBinder.issueCommand(new r.vy),this.isAllFloors(i)?(this.context.analytics.track("showcase_gui",{gui_action:"click_toggle_all_floors_button"}),await this.context.commandBinder.issueCommand(new y.Vw(null,!1))):i!==this.state.currentFloor&&(this.context.analytics.track("showcase_gui",{gui_action:"click_floor_select_button"}),await this.context.commandBinder.issueCommand(new y.h9(i,!1)))}catch(e){b.debug(e)}},this.isAllFloors=e=>!this.originalFloors[e],this.setFloorNamesForMode=()=>{const e=this.viewmodeData.currentMode!==a.Ey.Panorama?[...this.originalFloors,this.viewData.getFloorName(null)]:this.originalFloors;if(this.viewmodeData.currentMode!==this.state.currentMode)this.setState({floorNames:e,currentMode:this.viewmodeData.currentMode});else{const t=this.getFloorIndex(e.length);this.setState({floorNames:e,currentFloor:t})}},this.updateData=()=>{const e=this.viewData.getHighestVisibleFloor(),t=e?e.index:-1,i=this.viewData.getFloorNames();this.state.floorNames===i&&this.state.currentFloor===t||(this.originalFloors=i,this.setFloorNamesForMode())},this.onNameChange=()=>{this.updateData()},this.getFloorIndex=e=>{const{currentFloor:t}=this.viewData;return t||this.props.viewmode===s.BD.INSIDE?t?t.index:-1:e-1},this.modeChanged=()=>{this.setFloorNamesForMode()},this.state={visible:e.viewmode!==s.BD.OUTSIDE,currentFloor:-2,floorNames:[],currentMode:null}}componentWillReceiveProps(e){e.viewmode!==this.props.viewmode&&this.setState({visible:e.viewmode!==s.BD.OUTSIDE})}async componentDidMount(){try{this.viewmodeData=await this.context.market.waitForData(l.O),this.viewData=await this.context.market.waitForData(o.c),this.changeSubscription=this.viewData.makeFloorChangeSubscription(this.updateData),this.floorsSubscription=this.viewData.floors.onNameChange(this.onNameChange),this.modeChangeSub=this.viewmodeData.makeModeChangeSubscription(this.modeChanged),this.updateData(),this.modeChanged()}catch(e){b.debug(e)}}componentWillUnmount(){this.changeSubscription&&this.changeSubscription.cancel(),this.floorsSubscription&&this.floorsSubscription.cancel(),this.modeChangeSub&&this.modeChangeSub.cancel()}render(){return(0,n.h)(FloorControlsPresentation,{visible:this.originalFloors.length>1&&this.state.visible,floorNames:this.state.floorNames,currentFloor:this.state.currentFloor,handleClickFloor:this.handleClickFloor,isAllFloors:this.isAllFloors})}}},30593:(e,t,i)=>{"use strict";i.d(t,{Z:()=>FullscreenControls});var n=i(26605),s=i(94184),o=i(21265),r=i(29359),a=i(26265),l=i(80429);class FullscreenControls extends n.Component{constructor(e){super(e),this.handleButtonClick=()=>{o.rm()?(this.context.analytics.track("showcase_gui",{gui_action:"click_exit_fullscreen",interaction_source:"gui"}),o.Qg()):(this.context.analytics.track("showcase_gui",{gui_action:"click_enter_fullscreen",interaction_source:"gui"}),o.Zx(document.body))},this.onFullScreenChange=()=>{this.setState({fullscreen:o.rm()})},this.state={fullscreen:o.rm()},document.addEventListener("fullscreenchange",this.onFullScreenChange),document.addEventListener("webkitfullscreenchange",this.onFullScreenChange),document.addEventListener("MSFullscreenChange",this.onFullScreenChange),document.addEventListener("mozfullscreenchange",this.onFullScreenChange)}render(){const e=o.Jm(),{fullscreen:t}=this.state;return(0,n.h)("div",{class:"fullscreen-mode"},(0,n.h)(l.h,{onClick:this.handleButtonClick},(0,n.h)(a.oO,{content:t?this.context.locale.t(r.Z.EXIT_FULLSCREEN):this.context.locale.t(r.Z.VIEW_FULLSCREEN),position:a.lZ.UP_LEFT,tooltipTimeout:e?1e3:void 0},(0,n.h)("span",{class:s("icon",t?"icon-fullscreen-exit":"icon-fullscreen")}))))}}},24391:(e,t,i)=>{"use strict";i.d(t,{Z:()=>d});var n=i(26605),s=i(2116),o=i(29359),r=i(80429),a=i(26265),l=i(21265),c=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let h=class HighlightButton extends n.Component{constructor(e){super(e),this.handleButtonClick=()=>{const e=this.props.reelOpen?"hide_":"show_";this.context.analytics.track("showcase_gui",{gui_action:e+"highlight_reel"}),this.props.onToggleHLR(!this.props.reelOpen)}}render(){const{reelEnabled:e,reelOpen:t}=this.props;return e?(0,n.h)(r.h,{appendClass:{"highlight-button":!0},onClick:this.handleButtonClick},(0,n.h)(a.oO,{content:t?this.context.locale.t(o.Z.CLOSE_HIGHLIGHTS):this.context.locale.t(o.Z.OPEN_HIGHLIGHTS),position:a.lZ.UP_RIGHT,tooltipTimeout:(0,l.Jm)()?1e3:void 0},(0,n.h)("span",{class:"icon "+(t?"icon-dpad-down":"icon-dpad-up")}))):null}};h=c([s.Z],h);const d=h},18676:(e,t,i)=>{"use strict";i.d(t,{Z:()=>EmptyReel});var n=i(26605);class EmptyReel extends n.Component{constructor(){super()}render(){return(0,n.h)("div",{class:"no-highlights-message"},(0,n.h)("p",null,"Your space does not have any highlights yet."),(0,n.h)("p",null,"A Highlight Reel lets your visitors get a taste of what the Space is like.",(0,n.h)("a",{class:"link",target:"_blank",href:"https://support.matterport.com/hc/en-us/articles/360019401733"},"Learn More")))}}},15100:(e,t,i)=>{"use strict";i.d(t,{cR:()=>v,ZP:()=>S});var n=i(26605),s=(i(6225),i(2116)),o=i(72609),r=i(18676),a=i(59984),l=i(21265),c=i(19417),h=i(62367),d=i(14109);class ReelContents extends n.Component{constructor(e){super(e),this.highlights=[],this.highlightList=e=>{const{currentStep:t,onHighlightClicked:i}=this.props;return(0,n.h)("div",{class:"hlr-container"},(0,n.h)("div",{class:"highlights"},e.items.map(((e,s)=>(0,n.h)(d.Z,{key:`${e.sid}_${s}`,highlight:e,index:s,active:s===t,editable:!1,onClickHighlight:i,getRef:this.addHighlightRef})))))},this.addHighlightRef=(e,t)=>{this.highlights[e]=t,e===this.props.currentStep&&this.props.setActiveElement&&this.props.setActiveElement(t)}}render(){const{highlights:e}=this.props;return e&&e.length?(0,n.h)(this.highlightList,{items:e}):null}}var u=i(25799),p=i(62431),m=i(23549),g=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};const f=new u.Z("highlight-reel"),v=400;var y;!function(e){e[e.flash=0]="flash",e[e.expanded=1]="expanded",e[e.collapsed=2]="collapsed"}(y||(y={}));const b=[y.flash,y.expanded,y.collapsed];let w=class ReelReadOnly extends n.Component{constructor(e){super(e),this.bindings=[],this.mobile=(0,l.tq)(),this.showReel=()=>{if(this.props.onToggleHLR&&this.props.highlights.length>0)switch(this.hlStartupStyle){case y.expanded:case y.flash:this.props.onToggleHLR(!0)}},this.setActiveElement=e=>{this.setState({activeElement:e})},this.setHighlightClickable=(e=>this.highlightClickable=e).bind(this),this.onHighlightClicked=async e=>{const{commandBinder:t,analytics:i}=this.context;if(this.highlightClickable)try{this.props.tourPlaying&&await t.issueCommand(new c.vy),this.props.transition.active||(i.track("showcase_gui",{gui_action:"click_highlight"}),await t.issueCommand(new c.rU(e)).catch((e=>{if(!(e instanceof m.z))throw e;f.warn(e.message)})),this.setHighlightClickable(!1))}catch(e){f.debug(e)}},this.state={activeElement:null}}componentDidMount(){if(this.props.briefHlr){const e=this.context.settings.tryGetProperty(p.gx.HighlightReel,!0);!this.context.editMode&&this.props.totalSteps>0&&e&&(this.hlStartupStyle=this.getHlStartupValue(),(0,h.gw)(100).then((()=>{this.showReel(),(0,h.gw)(3e3).then((()=>{this.dismissReel(),this.props.onBriefHLR&&this.props.onBriefHLR()}))})))}}componentWillUnmount(){this.bindings.forEach((e=>{e.cancel()}))}render(){const{reelOpen:e,activeStep:t,highlights:i,totalSteps:s}=this.props,l=s>0,c=l?(0,n.h)(ReelContents,{highlights:i,currentStep:t,onHighlightClicked:this.onHighlightClicked,setActiveElement:this.setActiveElement}):(0,n.h)(r.Z,null);return(0,n.h)(a.N,{appendClass:{"highlight-reel":!0,"reel-viewing":l,"reel-empty":!l},open:e},(0,n.h)("div",{id:"reel-container"},(0,n.h)(o.Z,{totalSteps:s,activeElement:this.state.activeElement,mobile:this.mobile,highlightClickable:this.setHighlightClickable,thumbScrollingOnly:!1},c)))}getHlStartupValue(){const e=this.props.highlights.some((e=>e.snapshot.is360))?y.expanded:y.flash,t=(0,l.hu)("hl",e);return b.includes(t)?t:e}dismissReel(){this.props.onToggleHLR&&this.hlStartupStyle===y.flash&&this.props.onToggleHLR(!1)}};w=g([s.Z],w);const S=w},72609:(e,t,i)=>{"use strict";i.d(t,{Z:()=>ReelScrollContainer});var n=i(26605),s=i(94184),o=i(84952),r=i(10396),a=i(65277),l=i(95843);class ReelScrollContainer extends n.Component{constructor(e){super(e),this.onWindowResize=()=>{const e=(0,o.w)(window);this.state.hideScrollbar!==e&&this.setState({hideScrollbar:e})},this.onScrollableChanged=e=>{this.setState({scrollable:e})},this.onScrollPositionChange=e=>{this.setState({scrollPosition:e})},this.getScrollableContainer=()=>this.scrollbar?this.scrollbar.getScrollableContainer():void 0,this.handleHighlightClickable=()=>{this.props.highlightClickable(!0)},this.state={scrollLeft:0,hideScrollbar:(0,o.w)(window),scrollPosition:l.Ij.None,scrollable:!1},this.resizeSubscription=(0,r.kp)(r.g_.RESIZE,this.onWindowResize)}componentDidMount(){this.resizeSubscription.renew(),this.onScrollableChanged(!0),this.onScrollPositionChange(l.Ij.Beginning)}componentWillUnmount(){this.resizeSubscription.cancel()}componentDidUpdate(e){const{activeElement:t}=this.props;null!==t&&e.activeElement!==t&&this.scrollbar.scrollToElement(t)}setSorting(e){e?(this.el.classList.add("sorting"),this.props.mobile&&this.scrollbar.pauseScrollHandling()):this.el.classList.remove("sorting")}render(){const{thumbScrollingOnly:e,children:t,totalSteps:i}=this.props,{hideScrollbar:o,scrollPosition:r,scrollable:c}=this.state,h=s({scrollable:c,[r]:!0});return(0,n.h)("div",{id:"reel",class:h,ref:e=>{this.el=e}},(0,n.h)(a.Z,{direction:l.Nm.horizontal,ref:e=>this.scrollbar=e,hideScrollbar:o,thumbScrollingOnly:e,waitToUpdate:0===i,handleClick:this.handleHighlightClickable,onScrollableChanged:this.onScrollableChanged,onScrollPositionChange:this.onScrollPositionChange},t))}}},14109:(e,t,i)=>{"use strict";i.d(t,{Z:()=>Highlight});var n=i(26605),s=i(94184),o=i(47924),r=i(44228),a=i(71208),l=i(26265),c=i(29359);const{HLR:h}=c.Z.WORKSHOP;class Highlight extends n.Component{constructor(e){super(e),this.editHighlight=e=>{e.stopPropagation(),this.props.onClickHighlight(this.props.index,!0)},this.removeHighlight=e=>{e.stopPropagation(),this.props.onRemoveHighlight&&this.props.onRemoveHighlight(this.props.highlight.snapshot.sid)},this.onClickHighlight=e=>{e.preventDefault(),this.props.onClickHighlight(this.props.index,!1)},this.setContainerRef=e=>{const{index:t,getRef:i}=this.props;this.element=e,i(t,this.element)},this.setState({thumbnailUrl:""})}componentDidMount(){this.loadThumbnail()}async loadThumbnail(){const{snapshot:e}=this.props.highlight,t=await e.thumbnailUrl.get();this.setState({thumbnailUrl:t})}renderTransitionSettings(){const{locale:e}=this.context,{transitionType:t,panDirection:i,transitionCondition:s}=this.props;let a="pan-auto";i===r.kw.Left?a="icon icon-rotate-left":i===r.kw.Right&&(a="icon icon-rotate-right");let l="";return t===o.n.FadeToBlack?l=e.t(h.TRANSITION_SETTING_SLIDESHOW):t===o.n.Interpolate&&(l=e.t(h.TRANSITION_SETTING_WALKTHROUGH)),(0,n.h)("div",{class:"transition-settings"},(0,n.h)("span",{class:"transition-type"},l,s&&(0,n.h)("span",null,"*")),(0,n.h)("span",{class:`pan-icon ${a}`}))}renderImageBar(){const{locale:e}=this.context,{highlight:t,editable:i}=this.props,o=t.snapshot.is360,r=t.snapshot.metadata.cameraMode,a=this.getMarker(r,o),c=e.t(h.REMOVE_HIGHLIGHT_TOOLTIP_MESSAGE),d=e.t(h.EDIT_HIGHLIGHT_TOOLTIP_MESSAGE);return(0,n.h)("div",{class:"image-bar"},(0,n.h)("span",{class:s("highlight-marker",a)}),i&&(0,n.h)(l.oO,{className:"highlight-remove",content:c,position:l.lZ.DOWN_RIGHT},(0,n.h)("span",{class:s("icon-delete"),onClick:this.removeHighlight})),i&&(0,n.h)(l.oO,{className:"highlight-edit",content:d,position:l.lZ.DOWN_LEFT},(0,n.h)("span",{class:s("icon-toggle-pencil"),onClick:this.editHighlight})))}getMarker(e,t){return e===a.Ey.Dollhouse||e===a.Ey.Floorplan?null:t?"icon-360":"icon-panorama"}render(){const{thumbnailUrl:e}=this.state,{highlight:t,active:i,editable:o}=this.props,{name:r}=t.snapshot,a=!!r||o,l=e?{backgroundImage:`url('${e}')`}:{};return(0,n.h)("div",{class:s("highlight-box",{active:i,editable:o}),onClick:this.onClickHighlight,ref:this.setContainerRef},(0,n.h)("div",{class:"highlight-image",style:l}),this.renderImageBar(),o&&this.renderTransitionSettings(),(0,n.h)("div",{class:s("image-name",{shadowed:a})},(0,n.h)("span",{class:"static-text"},r)))}}},8336:(e,t,i)=>{"use strict";i.d(t,{Z:()=>ModeControls});var n,s,o=i(26605),r=i(27871),a=i(39936),l=i(12775),c=i(72942),h=i(97507),d=i(19417),u=i(29359),p=i(25799);!function(e){e.Inside="panorama",e.InsideMesh="mesh",e.Dollhouse="dollhouse",e.Floorplan="floorplan",e.None="none"}(n||(n={})),function(e){e.Inside="click_inside_mode_button",e.InsideMesh="click_mesh_mode_button",e.Dollhouse="click_dollhouse_mode_button",e.Floorplan="click_dollhouse_mode_button"}(s||(s={}));var m=i(80429),g=i(42733),f=i(26265);class ModeButton extends o.Component{constructor(e){super(e),this.onClick=this.onClick.bind(this)}get tooltip(){return this.context.locale.t(this.props.tooltipPhraseKey)}onClick(){const{buttonId:e,analyticsName:t}=this.props;this.props.onClick(e,t)}render(){const{disabled:e,hidden:t,activeButtonId:i,buttonId:n}=this.props;return t||i===n?null:(0,o.h)(m.h,{onClick:this.onClick,appendClass:{[`mode-${n}`]:!0},buttonState:e?g.BN.DECORATIVE:g.BN.ENABLED},(0,o.h)(f.oO,{content:this.tooltip,position:f.lZ.UP},(0,o.h)("span",{class:`icon icon-${n}`})))}}const v=new p.Z("mode-buttons");class ModeButtons extends o.Component{constructor(e){super(e),this.onClick=this.onClick.bind(this)}async onClick(e,t){const{analytics:i,commandBinder:s}=this.context;if(e!==this.props.activeButtonId&&!this.props.transitioning){i.track("showcase_gui",{gui_action:t});try{const t=function(e){switch(e){case n.Dollhouse:return c.BD.DOLLHOUSE;case n.Floorplan:return c.BD.FLOORPLAN;case n.Inside:case n.InsideMesh:return c.BD.INSIDE;default:throw new Error(`cannot get viewmode for mode buttonId ${e}`)}}(e);if(await s.issueCommand(new d.vy),await s.issueCommand(new c._i(t)),[n.Inside,n.InsideMesh].includes(e)){const t=e===n.InsideMesh?1:0;s.issueCommand(new h.g(t))}}catch(e){v.warn(e)}}}render(){const{activeButtonId:e,transitioning:t,dollhouseHidden:i,floorplanHidden:r,meshHidden:a}=this.props;return(0,o.h)("div",{class:"mode-buttons"},(0,o.h)(ModeButton,{tooltipPhraseKey:u.Z.VIEW_INSIDE_MESH,analyticsName:s.InsideMesh,buttonId:n.InsideMesh,activeButtonId:e,onClick:this.onClick,disabled:t,hidden:a}),(0,o.h)(ModeButton,{tooltipPhraseKey:u.Z.VIEW_INSIDE,analyticsName:s.Inside,buttonId:n.Inside,activeButtonId:e,onClick:this.onClick,disabled:t}),(0,o.h)(ModeButton,{tooltipPhraseKey:u.Z.VIEW_DOLLHOUSE,analyticsName:s.Dollhouse,buttonId:n.Dollhouse,activeButtonId:e,onClick:this.onClick,disabled:t,hidden:i}),(0,o.h)(ModeButton,{tooltipPhraseKey:u.Z.VIEW_FLOORPLAN,analyticsName:s.Floorplan,buttonId:n.Floorplan,activeButtonId:e,onClick:this.onClick,disabled:t,hidden:r}))}}var y=i(62431);const b=["dh",y.gx.Dollhouse],w=["fp",y.gx.FloorPlan];const S={showingMesh:!1,commandViewmode:c.g,dollhouseHidden:!1,floorplanHidden:!1};class ModeControls extends o.Component{constructor(e){super(e),this.bindings=[],this.onMeshDataUpdate=e=>{const t=0!==e.value;this.setState({showingMesh:t})},this.onDollhouseDataUpdate=()=>{const{editMode:e,market:t}=this.context,i=t.tryGetData(a.e);if(!i)return;const n=function(e,t){if(t)return!1;const i=e.checkUrlParam("dh",0,1),n=!e.tryGetProperty(y.gx.Dollhouse,!1);return i||n}(i,e);this.setState({dollhouseHidden:n})},this.onFloorplanDataUpdate=()=>{const{editMode:e,market:t}=this.context,i=t.tryGetData(a.e);if(!i)return;const n=function(e,t){if(t)return!1;const i=e.checkUrlParam("fp",0,1),n=!e.tryGetProperty(y.gx.FloorPlan,!1);return i||n}(i,e);this.setState({floorplanHidden:n})},this.onViewmodeUpdate=e=>{const t=e.value;if(!t)return;const i=(0,c.ty)(t);this.setState({commandViewmode:i})},this.state=S}async componentDidMount(){const{market:e}=this.context;e.waitForData(r._).then((e=>{this.bindings.push(e.onPropertyChanged("opacity",this.onMeshDataUpdate)),this.onMeshDataUpdate(e.opacity)})),e.waitForData(a.e).then((e=>{b.forEach((t=>{this.bindings.push(e.onPropertyChanged(t,this.onDollhouseDataUpdate))})),w.forEach((t=>{this.bindings.push(e.onPropertyChanged(t,this.onFloorplanDataUpdate))})),this.onDollhouseDataUpdate(),this.onFloorplanDataUpdate()})),this.context.market.waitForData(l.O).then((e=>{this.bindings.push(e.onPropertyChanged("currentModeObservable",this.onViewmodeUpdate)),this.onViewmodeUpdate(e.currentModeObservable)}))}componentWillUnmount(){for(const e of this.bindings)e.cancel();this.bindings=[]}render(){const{editMode:e}=this.context,{unaligned:t}=this.props,{commandViewmode:i,showingMesh:s,dollhouseHidden:r,floorplanHidden:a}=this.state,l=i===c.BD.TRANSITIONING;l||(this.activeButtonId=function(e,t,i){return e?n.None:t===c.BD.DOLLHOUSE?n.Dollhouse:t===c.BD.FLOORPLAN?n.Floorplan:t===c.BD.INSIDE?i?n.InsideMesh:n.Inside:n.None}(t,i,s));const h=function(e,t){return!t||e!==n.Inside}(this.activeButtonId,e);return(0,o.h)(ModeButtons,{activeButtonId:this.activeButtonId,transitioning:l,dollhouseHidden:r,floorplanHidden:a,meshHidden:h})}}},14900:(e,t,i)=>{"use strict";i.d(t,{Z:()=>m});var n=i(26605),s=i(94184),o=i(2116),r=i(29359),a=i(19417),l=i(26265),c=i(80429),h=i(42733),d=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};const u=new(i(25799).Z)("tour-controls");let p=class TourControls extends n.Component{constructor(e){super(e),this.handlePlayPause=async()=>{if(!this.props.tourEmpty)try{this.props.tourPlaying?await this.stopTour():(this.context.analytics.track("showcase_gui",{gui_action:"play_highlights"}),await this.startTour())}catch(e){u.debug(e)}}}async startTour(){try{await this.context.commandBinder.issueCommand(new a.TH)}catch(e){u.debug(e)}}async stopTour(){try{this.context.analytics.track("showcase_gui",{gui_action:"pause_highlights"}),await this.context.commandBinder.issueCommand(new a.vy)}catch(e){u.debug(e)}}render(){const{tourEmpty:e,tourPlaying:t}=this.props,i="ontouchstart"in window,o=e?h.BN.DISABLED:t?h.BN.ACTIVE:h.BN.ENABLED;return(0,n.h)(c.h,{buttonState:o,onClick:this.handlePlayPause,appendClass:{"tour-controls":!0}},e?(0,n.h)("span",{class:"icon icon-play"}):(0,n.h)(l.oO,{content:t?this.context.locale.t(r.Z.PAUSE):this.context.locale.t(r.Z.PLAY),position:l.lZ.UP,tooltipTimeout:i?1e3:void 0},(0,n.h)("span",{class:s({icon:!0,"icon-pause":t,"icon-play":!t})})))}};p=d([o.Z],p);const m=p},35543:(e,t,i)=>{"use strict";i.d(t,{Z:()=>l});var n=i(26605),s=i(94184),o=i(2116),r=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let a=class TourProgress extends n.Component{constructor(e){super(e),this.handleClick=()=>{this.context.analytics.track("showcase_gui",{gui_action:"tour_progress"}),this.props.reelOpen||this.props.onToggleHLR(!0)}}getTourSteps(){const{totalSteps:e,activeStep:t}=this.props,i=[];for(let o=0;o<e;o++)i.push((0,n.h)("div",{class:s({active:o===t}),key:o.toString()}));return i}render(){const{reelOpen:e,tourPlaying:t,activeStep:i,totalSteps:o}=this.props,r=i+1+"/"+o,a=-1!==i&&!e&&r,l=-1!==i&&e&&t;return o>0?(0,n.h)("div",{id:"tour-progress",class:s({"faded-in":t}),onClick:this.handleClick,"data-balloon":a,"data-balloon-pos":"right","data-balloon-size":"xs"},l&&(0,n.h)("div",{class:"progress-number"},r),-1!==i&&(0,n.h)("div",{class:"progress-bar"},this.getTourSteps())):null}};a=r([o.Z],a);const l=a},59059:(e,t,i)=>{"use strict";i.d(t,{B:()=>v});var n=i(26605),s=i(2116),o=i(86134),r=i(42733),a=i(80429),l=i(62431),c=i(14600),h=i(7351),d=i(75328),u=i(72822),p=i(76104),m=i(26265),g=i(29359),f=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let v=class MeasurementSettings extends n.Component{constructor(e,t){super(),this.propertiesToRefreshUi=[c.F.UnitType,c.F.MeasurementSnapping,c.F.MeasurementContinuousLines],this.close=()=>{this.setState({settingsOpen:!1})},this.updatePerSettings=()=>{this.setState({units:this.context.settings.tryGetProperty(c.F.UnitType,l.Mc.Metric),snapping:this.context.settings.tryGetProperty(c.F.MeasurementSnapping,!1),continuousLines:this.context.settings.tryGetProperty(c.F.MeasurementContinuousLines,!1)})},this.toggleUnits=()=>{const e=this.state.units!==l.Mc.Metric?l.Mc.Metric:l.Mc.USFractional;this.context.settings.setLocalStorageProperty(c.F.UnitType,e)},this.toggleSnapping=()=>{const e=this.state.snapping;this.context.settings.setLocalStorageProperty(c.F.MeasurementSnapping,!e)},this.toggleOpen=e=>{const{onToggle:t}=this.props;t&&t(e,!this.state.settingsOpen),this.setState((e=>({settingsOpen:!e.settingsOpen})))},this.toggleContinuousLines=()=>{const e=this.state.continuousLines;this.context.settings.setLocalStorageProperty(c.F.MeasurementContinuousLines,!e)},this.locale={continuousLinesString:t.locale.t(g.Z.MEASUREMENT_CONTINUOUS_LINES),snappingString:t.locale.t(g.Z.MEASUREMENT_SNAPPING),unitsString:t.locale.t(g.Z.MEASUREMENT_UNITS),imperialString:t.locale.t(g.Z.MEASUREMENT_IMPERIAL),metricString:t.locale.t(g.Z.MEASUREMENT_METRIC),settingsString:t.locale.t(g.Z.MEASUREMENT_SETTINGS),closeString:t.locale.t(g.Z.CLOSE)},this.state={settingsOpen:!1,units:l.Mc.Metric,snapping:!1,continuousLines:!1}}async componentDidMount(){for(const e of this.propertiesToRefreshUi)this.context.settings.onPropertyChanged(e,this.updatePerSettings);this.updatePerSettings()}componentWillUnmount(){for(const e of this.propertiesToRefreshUi)this.context.settings.removeOnPropertyChanged(e,this.updatePerSettings)}render(){const{iconButtonStyle:e}=this.props,{settingsOpen:t}=this.state,{settingsString:i}=this.locale,s=e||a.D.OVERLAY;return(0,n.h)(a.h,{appendClass:{"measurement-settings-btn":!0},buttonStyle:s,iconClass:"icon-settings",buttonState:t?r.BN.ACTIVE:r.BN.ENABLED,onClick:this.toggleOpen,tooltipMsg:!t&&i||void 0,tooltipPosition:m.lZ.DOWN},this.renderSettingsPopup())}renderSettingsPopup(){const{settingsOpen:e,units:t,snapping:i,continuousLines:s}=this.state,{continuousLinesString:r,snappingString:a,unitsString:c,imperialString:m,metricString:g}=this.locale,f=t===l.Mc.Metric;return(0,n.h)(h.J,{appendClass:{"measurement-settings-popup":!0},arrowPosition:o.x.TOP_RIGHT,open:e,close:this.close},(0,n.h)(d.w,{label:a},(0,n.h)(u.Z,{onToggle:this.toggleSnapping,enabled:!0,onOffLabel:!0,toggled:i})),(0,n.h)(d.w,{label:r},(0,n.h)(u.Z,{onToggle:this.toggleContinuousLines,enabled:!0,onOffLabel:!0,toggled:s})),(0,n.h)(d.w,{label:c,appendClass:"units-setting"},(0,n.h)("div",{class:"radio-group radio-buttons"},(0,n.h)(p.E,{name:"unit",value:l.Mc.USFractional,id:"unit-imperial",enabled:!0,checked:!f,onChange:this.toggleUnits},m),(0,n.h)(p.E,{name:"unit",value:l.Mc.Metric,id:"unit-metric",enabled:!0,checked:f,onChange:this.toggleUnits},g))))}};v=f([s.Z],v)},18403:(e,t,i)=>{"use strict";i.d(t,{u:()=>MeasurementsManager});var n=i(9608),s=i(83455),o=i(42885),r=i(57155),a=i(91172),l=i(98809),c=i(54590),h=i(42060),d=i(86034),u=i(60579),p=i(35887),m=i(22729),g=i(26983),f=i(77956),v=i(12775),y=i(94944),b=i(9872),w=i(22936),S=i(29359);const{MEASUREMENTS:E}=S.Z.WORKSHOP;class MeasurementsManager{constructor(e,t){this.engine=e,this.initialized=!1,this.disabledAssets={[l.U]:!1,[o.s]:!1,[r.Nj]:!1,[a.re]:!1,[s.Mp]:!1},this.settingsToggler=new n.u(t,this.disabledAssets)}async activate(){if(!this.initialized){this.initialized=!0;const e=this.engine,[t,i,n,s]=await Promise.all([e.market.waitForData(g.X),e.market.waitForData(m.c),e.market.waitForData(f.Z),e.market.waitForData(v.O)]);this.dataMap={measurementModeData:t,floorsViewData:i,sweepData:n,viewmodeData:s}}this.settingsToggler.toggle(!0),await this.engine.commandBinder.issueCommandWhenBound(new c.O(!0,!0))}async deactivate(){this.settingsToggler.toggle(!1),this.dataMap.measurementModeData.setSelectedGroupIndex(-1),await this.engine.commandBinder.issueCommand(new c.O(!1))}in360view(){const e=this.dataMap.sweepData.currentSweep?this.dataMap.sweepData.currentSweep:"";return this.dataMap.viewmodeData.isPano()&&this.dataMap.sweepData.isSweepUnaligned(e)}getSelectedMeasurement(){return this.dataMap.measurementModeData.selectedGroupSid}renameMeasurement(e,t){return this.engine.commandBinder.issueCommand(new h.R(e,t))}setMeasurementVisibility(e,...t){return this.engine.commandBinder.issueCommand(new d.W(e,...t))}async batchDeleteMeasurement(e){const t=e.length,i=(0,w.P)(t,E.TYPE);return await this.engine.commandBinder.issueCommand(new b.Q(b.f.DISPLAY,i))!==y.U.CLOSE&&(this.engine.commandBinder.issueCommand(new u.JM(...e)),!0)}async deleteMeasurement(e){await this.engine.commandBinder.issueCommand(new u.JM(e))}async toggleSelected(e){await this.engine.commandBinder.issueCommand(new p.t(e))}}},60930:(e,t,i)=>{"use strict";i.d(t,{f:()=>I});var n=i(26605),s=i(94184),o=i(2116),r=i(45982),a=i(60579),l=i(77399),c=i(1437),h=i(62431),d=i(90709);var u=i(18120),p=i(86134),m=i(42733),g=i(80429),f=i(26265),v=i(14600),y=i(59059);const b={[r.au.CREATING]:!0,[r.au.CONFIRMING_POINT]:!0},w={[r.au.IDLE]:!0,[r.au.CREATING]:!0,[r.au.CREATING_NEXT_POINT]:!0},S=(r.au.CREATING,r.au.CONFIRMING_POINT,{[r.au.IDLE]:!0,[r.au.CREATING]:!0,[r.au.CREATING_NEXT_POINT]:!0});var E=i(43711),T=i(90601),M=i(12856),_=i(71583),x=i(29359);const A="measurement-mode-add-tooltip",O="measurement-mode-desktop-help",P="measurement-mode-mobile-help";var C,D=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let I=C=class MeasurementsOverlay extends n.Component{constructor(e,t){super(),this.bindings=[],this.propertiesToRefreshUi=[v.F.UnitType,v.F.MeasurementSnapping,v.F.MeasurementContinuousLines,A,O,P],this.onMeasurementModeDataChanged=()=>{const{measurementModeData:e}=this.props.manager.dataMap,t=e.selectedGroupInfo,i=e.phase,n=e.pressProgress>=.95?1:e.pressProgress;i===r.au.CLOSED?(this.closeMeasurementHelpModal(),this.dismissAddTooltip()):i===r.au.IDLE&&this.updateAddTooltipVisibility(),this.setState({phase:i,pressProgress:n,selectedGroup:t,pointPosition:e.pointPosition})},this.updatePerSettings=()=>{const e=this.context.settings;this.setState({units:e.tryGetProperty(v.F.UnitType,h.Mc.Metric),snapping:e.tryGetProperty(v.F.MeasurementSnapping,!1),continuousLines:e.tryGetProperty(v.F.MeasurementContinuousLines,!1),addTooltipShown:e.tryGetProperty(A,!1),desktopHelpShown:e.tryGetProperty(O,!1),mobileHelpShown:e.tryGetProperty(P,!1)})},this.updateAddTooltipVisibility=()=>{this.state.addTooltipShown||this.context.editMode||(this.setState({showAddTooltip:!0}),window.clearTimeout(this.startAddingTooltip),this.startAddingTooltip=window.setTimeout((()=>{this.dismissAddTooltip()}),C.START_ADDING_TOOLTIP_TIMEOUT))},this.dismissAddTooltip=()=>{this.setState({showAddTooltip:!1}),this.context.settings.setProperty(A,!0)},this.getOverlayComponents=()=>{const{mobile:e,openModal:t}=this.props,{mobileHelpShown:i,desktopHelpShown:s}=this.state,{editMode:o}=this.context,r=t===M.P.MEASUREMENT_HELP,{closeString:a,helpString:l}=this.locale,c=o?"overlay-top-center":"overlay-bar",h=[(0,n.h)("div",{class:c},!o&&(0,n.h)("div",{class:"overlay-bar-filler"}),(0,n.h)("div",{class:"overlay-bar-center"},this.renderOverlayInfo()),!o&&(0,n.h)("div",{class:"overlay-bar-right"},(0,n.h)(g.h,{appendClass:{"measurement-help-btn":!0},buttonStyle:g.D.OVERLAY,iconClass:"icon-help",buttonState:r?m.BN.ACTIVE:m.BN.ENABLED,onClick:this.toggleHelpOpen,tooltipMsg:!r&&l||void 0,tooltipPosition:f.lZ.DOWN}),(0,n.h)(y.B,{ref:e=>this.measurementSettings=e,onToggle:this.settingsToggled}),(0,n.h)(g.h,{iconClass:"icon-close",buttonStyle:g.D.OVERLAY,tooltipMsg:a,tooltipPosition:f.lZ.DOWN,onClick:this.onCloseMeasurementTool})))];if(!s||!i){const t=e?this.getMobileHelp():this.getDesktopHelp();h.push(t)}return h},this.getMobileHelp=()=>{const{phase:e}=this.state,{pressHoldStart:t,pressHoldEnd:i,dragEdit:s}=this.locale.mobileHelp;let o,a;switch(e){case r.au.CREATING_NEXT_POINT:o=(0,n.h)("div",{class:"icon icon-drag-edit"}),a=(0,n.h)("span",{class:"message"},i);break;case r.au.EDITING:case r.au.POINT_PLACED:o=(0,n.h)("div",{class:"icon icon-finger-drag"}),a=(0,n.h)("span",{class:"message"},s);break;case r.au.CREATING:o=(0,n.h)("div",{class:"icon icon-press-hold"}),a=(0,n.h)("span",{class:"message"},t)}return(0,n.h)("div",{class:"overlay-message"},o,a)},this.getDesktopHelp=()=>{const{phase:e,selectedGroup:t}=this.state,{clickAnywhereString:s,escapeString:o}=this.locale.desktopHelp;let a,l;switch(e){case r.au.CREATING:a=(0,n.h)("div",{class:"icon icon-draw-lines"}),l=(0,n.h)("span",{class:"message"},s);break;case r.au.CREATING_NEXT_POINT:t&&t.count>=3&&(a=(0,n.h)("div",{class:"escape-key"},(0,n.h)("img",{src:i(78899)})),l=(0,n.h)("span",{class:"message escape-message"},o))}return(0,n.h)("div",{class:"overlay-message"},a,l)},this.clickCTAButton=e=>{const{phase:t}=this.state;t===r.au.IDLE?this.onStartPointPlacement(e):this.onStopPointPlacement(e)},this.onDeleteMeasurement=e=>{e&&e.stopPropagation(),this.context.commandBinder.issueCommand(new a.Ev)},this.onStartPointPlacement=e=>{e&&e.stopPropagation(),this.context.commandBinder.issueCommand(new l.c),this.dismissAddTooltip()},this.onStopPointPlacement=e=>{e&&e.stopPropagation(),this.context.commandBinder.issueCommand(new c.B)},this.onCloseMeasurementTool=async e=>{e&&e.stopPropagation(),this.closeMeasurementHelpModal(),await this.context.commandBinder.issueCommand(new E.tT(T.w1.MEASUREMENTS,!1)),this.measurementSettings&&this.measurementSettings.close(),this.dismissAddTooltip()},this.settingsToggled=(e,t)=>{e.stopPropagation(),t&&this.closeMeasurementHelpModal()},this.toggleHelpOpen=e=>{const{openModal:t}=this.props,i=t===M.P.MEASUREMENT_HELP;e.stopPropagation(),this.measurementSettings&&this.measurementSettings.close(),i||this.context.analytics.track("showcase_gui",{gui_action:"measure_mode_help_clicked"}),this.context.commandBinder.issueCommand(new _.Bz(M.P.MEASUREMENT_HELP,!i))},this.locale={startAddingString:t.locale.t(x.Z.MEASUREMENT_START_ADDING),continuousLinesString:t.locale.t(x.Z.MEASUREMENT_CONTINUOUS_LINES),snappingString:t.locale.t(x.Z.MEASUREMENT_SNAPPING),unitsString:t.locale.t(x.Z.MEASUREMENT_UNITS),imperialString:t.locale.t(x.Z.MEASUREMENT_IMPERIAL),metricString:t.locale.t(x.Z.MEASUREMENT_METRIC),desktopHelp:{clickAnywhereString:t.locale.t(x.Z.MEASUREMENT_HELP_CLICK_ANYWHERE),escapeString:t.locale.t(x.Z.MEASUREMENT_HELP_ESCAPE)},mobileHelp:{pressHoldStart:t.locale.t(x.Z.MEASUREMENT_HELP_PRESS_START),dragEdit:t.locale.t(x.Z.MEASUREMENT_HELP_DRAG_EDIT),pressHoldEnd:t.locale.t(x.Z.MEASUREMENT_HELP_PRESS_END)},helpString:t.locale.t(x.Z.HELP),closeString:t.locale.t(x.Z.CLOSE)},this.state={units:h.Mc.Metric,snapping:!1,continuousLines:!1,phase:r.au.CLOSED,selectedGroup:null,pressProgress:0,pointPosition:null,showAddTooltip:!1,desktopHelpShown:!1,mobileHelpShown:!1,addTooltipShown:!1}}async componentDidMount(){const{measurementModeData:e}=this.props.manager.dataMap;this.bindings.push(e.onChanged(this.onMeasurementModeDataChanged),e.onDataChanged(this.onMeasurementModeDataChanged));for(const e of this.propertiesToRefreshUi)this.bindings.push(this.context.settings.onPropertyChanged(e,this.updatePerSettings));this.onMeasurementModeDataChanged(),this.updatePerSettings()}componentWillUnmount(){for(const e of this.bindings)e.cancel()}componentDidUpdate(){const{mobile:e}=this.props,{continuousLines:t,selectedGroup:i}=this.state;if(e)this.isCheckVisible()&&this.context.settings.setProperty(P,!0);else if(null!==i){const e=i.count;(t?e>3:2===e)&&this.context.settings.setProperty(O,!0)}}renderProgressCircle(){const{mobile:e}=this.props,{pressProgress:t,pointPosition:i,phase:o}=this.state;if(!e||null===i||t<=0||!b[o])return null;const r={left:i.x-C.pointButtonRadius/2+"px",top:i.y-C.pointButtonRadius/2+"px"};return(0,n.h)("div",{class:"measurement-overlay"},(0,n.h)("div",{class:"point-button-wrapper",style:r},(0,n.h)(u.$,{appendClass:s({complete:1===t,reset:0===t}),progress:100*t,innerRadius:C.pointButtonRadius,barWidth:C.pressProgressBarThickness},(0,n.h)("circle",{class:"point",cx:"0",cy:"0",r:"22",transform:"rotate(-90)",fill:"#fff"}))))}renderOverlayInfo(){const{selectedGroup:e,units:t}=this.state;if(null===e)return null;const i=e.info.text?` ${e.info.text}`:"",s=`${((e,t)=>{if(t===h.Mc.Metric)return`${e.toFixed(2)}m`;const{feet:i,inches:n}=(0,d.XJ)(e);return i>0?`${i}' ${n}"`:`${n}"`})(e.length,t)} ${i}`;return(0,n.h)("div",{class:"overlay-info"},s)}render(){return(0,n.h)("div",{id:"measurement-mode-layer",class:"overlay"},this.getOverlayComponents(),this.renderProgressCircle(),this.renderOverlayCta())}hasCancelCta(){if(this.isCheckVisible())return!1;const{phase:e,selectedGroup:t}=this.state,i=e===r.au.CREATING&&(!t||0===t.count),n=e===r.au.CREATING_NEXT_POINT&&!!t&&2===t.count;return i||n}isCheckVisible(){const{phase:e,continuousLines:t}=this.state;return this.isCompleteMeasurement()&&(t?e===r.au.CREATING_NEXT_POINT:e===r.au.CREATING)}isCompleteMeasurement(){const{continuousLines:e,selectedGroup:t}=this.state;if(null===t)return!1;const i=t.count;return e?i>2:2===i}renderOverlayCta(){const{startAddingString:e}=this.locale,{mobile:t,unaligned:i}=this.props,{phase:s,showAddTooltip:o,selectedGroup:a}=this.state,l=s===r.au.EDITING,c=a&&a.count>0&&(t?!!w[s]:!!S[s])?m.BN.ENABLED:m.BN.DISABLED,h=this.isCheckVisible()?"icon-checkmark":"icon-plus",d=i||l?m.BN.DISABLED:m.BN.ENABLED,u={"overlay-cta-btn":!0,"overlay-cta-cancel":this.hasCancelCta()};return(0,n.h)("div",{class:"overlay-cta"},(0,n.h)(p.u,{appendClass:{"tooltip-simple-medium":!0},open:o,message:(0,n.h)("span",null,e),arrowPos:p.x.BOTTOM_CENTER}),(0,n.h)(g.h,{appendClass:u,iconClass:h,buttonStyle:g.D.PRIMARY,buttonState:d,onClick:this.clickCTAButton}),(0,n.h)(g.h,{appendClass:{"overlay-cta-button-outer":!0},buttonStyle:g.D.OVERLAY,iconClass:"icon-delete",buttonState:c,onClick:this.onDeleteMeasurement}))}closeMeasurementHelpModal(){const{openModal:e}=this.props;e===M.P.MEASUREMENT_HELP&&this.context.commandBinder.issueCommand(new _.Bz(e,!1))}};I.pointButtonRadius=132,I.pressProgressBarThickness=8,I.START_ADDING_TOOLTIP_TIMEOUT=5e3,I=C=D([o.Z],I)},43771:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var n=i(26605),s=i(2116),o=i(18120),r=i(59984),a=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let l=class LoadIndicator extends n.Component{constructor(e){super(e)}render(){const{showing:e}=this.props;return(0,n.h)(r.N,{open:e,appendClass:{"load-indicator":!0,"fade-in":e,"fade-out":!e}},(0,n.h)("div",{class:"center-container"},(0,n.h)(o.$,{progress:33,barWidth:4,progressColor:"#ffffff"})))}};l=a([s.Z],l);const c=l},12856:(e,t,i)=>{"use strict";var n;i.d(t,{P:()=>n}),function(e){e.TERMS="terms",e.VR_SELECT="vrSelect",e.MATTERTAG="mattertag",e.MATTERTAG_EMBED="mattertagEmbLink",e.HELP="help",e.CTA="cta",e.MEASUREMENT_HELP="measurementModeHelp",e.SHARE="share",e.ATTACHMENT="attachmentViewer",e.ADD_FROM_PHOTOS="add_from_photos",e.HIGHLIGHT_EDITOR="highlight_editor",e.REVERT_CHANGES="revert_unpublished_modal",e.HLR_SETTINGS="hlr_settings"}(n||(n={}))},91307:(e,t,i)=>{"use strict";i.d(t,{L:()=>NotesManager});var n=i(9608),s=i(42885),o=i(57155),r=i(98809),a=i(91172),l=i(51090),c=i(90991),h=i(36520),d=i(70008),u=i(72215),p=i(13545),m=i(90039);class NotesManager{constructor(e,t){this.engine=e,this.initialized=!1,this.disabledAssets={[r.U]:!1,[o.Nj]:!1,[s.s]:!1,[a.re]:!1},this.settingsToggler=new n.u(t,this.disabledAssets),this.initPromise=this.init()}async init(){const e=this.engine.market;return Promise.all([e.waitForData(u.X),e.waitForData(p.c),e.waitForData(h.b),e.waitForData(d.B),e.waitForData(c.A)]).then((([e,t,i,n,s])=>(this.dataMap={notesViewData:e,hashtagData:t,attachmentsData:i,pinsViewData:n,annotationsViewData:s},!0)))}async activate(){this.initialized||(this.initialized=!0,await this.initPromise),this.settingsToggler.toggle(!0),await this.engine.commandBinder.issueCommand(new m.yK(!0))}async deactivate(){await this.engine.commandBinder.issueCommand(new m.yK(!1)),this.settingsToggler.toggle(!1)}getReplyId(e){return e?`${e.id}-reply`:""}getNoteAttachments(e){const t=e.comments.map((e=>e.id));return this.dataMap.attachmentsData.collection.values.filter((i=>i.assetId&&(i.assetType===l.h.NOTE&&i.assetId===e.id||i.assetType===l.h.COMMENT&&t.includes(i.assetId))))}}},75843:(e,t,i)=>{"use strict";i.d(t,{R:()=>y});var n,s=i(26605),o=i(2116),r=i(21265),a=i(90601),l=i(90926),c=i(90039),h=i(77113),d=i(83455),u=i(99363),p=i(86134),m=i(42733),g=i(80429),f=i(18120),v=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let y=n=class NotesOverlay extends s.Component{constructor(e){super(),this.bindings=[],this.touchDevice=(0,r.Jm)(),this.timeout=0,this.updateNotesPhase=()=>{this.setState({notesPhase:this.props.manager.dataMap.notesViewData.notesPhase})},this.updateOpenNoteView=()=>{this.setState({openNoteView:this.props.manager.dataMap.notesViewData.openNoteView})},this.updateForPinChanges=()=>{const e=this.props.manager.dataMap.pinsViewData;this.setState({pinState:e.pinState,creationProgress:e.progress,screenPosition:e.screenPosition,canPlace:e.canPlace,canAdd:e.canAdd})},this.clickCTAButton=e=>{this.setState({showAddTooltip:!1}),this.hasCancelCta()?(e.stopPropagation(),this.props.manager.dataMap.notesViewData.creatingNote&&this.context.commandBinder.issueCommand(new c.gc)):this.onStartAddingNote(e)},this.savePinAppearance=e=>{const{openNoteView:t}=this.state;t&&this.context.commandBinder.issueCommand(new c.oE(t.id,e))},this.onStartAddingNote=e=>{e.stopPropagation(),this.trackEvent("notes_overlay_click_add"),this.context.commandBinder.issueCommand(new c.VI)},this.deleteNote=()=>{const{openNoteView:e}=this.state;e&&(this.trackEvent("notes_overlay_click_delete"),this.context.commandBinder.issueCommand(new c.sG(e.id)))},this.closeEditor=()=>{this.context.commandBinder.issueCommand(new c.df(!1))},this.toggleColorPicker=e=>{e.stopPropagation();const{notesPhase:t}=this.state,i=t===h.U.EDITING;this.context.commandBinder.issueCommand(new c.df(!i)),this.setState({showAddTooltip:!1})},this.state={showAddTooltip:!0,notesPhase:h.U.CLOSED,pinState:l.tS.IDLE,openNoteView:null,screenPosition:null,creationProgress:0,canPlace:!0,canAdd:!0}}componentDidMount(){const{notesViewData:e,pinsViewData:t}=this.props.manager.dataMap;this.bindings.push(e.onNotesPhaseChanged(this.updateNotesPhase),e.onOpenNoteViewChanged(this.updateOpenNoteView),t.onChanged(this.updateForPinChanges)),this.updateNotesPhase(),this.updateForPinChanges(),this.updateOpenNoteView()}componentWillUnmount(){window.clearTimeout(this.timeout);for(const e of this.bindings)e.cancel()}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}hasCancelCta(){const{pinState:e}=this.state;return e===l.tS.CREATING||e===l.tS.PLACING}renderOverlayMessage(){const{pinState:e,canPlace:t}=this.state;if(e===l.tS.CREATING||!this.touchDevice&&e===l.tS.PLACING||!t){const e=this.touchDevice?"Press and hold on the space to add a note":"Click on the space to add a note",i=this.touchDevice?"Unable to add note here, press and hold on the space to add a note":"Unable to add note here, click on the space to add a note.",n=t?e:i;return(0,s.h)("div",{class:"overlay-message"},(0,s.h)("div",{class:"icon icon-notes"}),(0,s.h)("span",{class:"message"},n))}return null}renderProgressCircle(){const{creationProgress:e,screenPosition:t,pinState:i}=this.state;if(!(i===l.tS.PRESSING&&e>0&&this.touchDevice)||!t)return null;const o={left:t.x-n.PROGRESS_RADIUS/2+"px",top:t.y-n.PROGRESS_RADIUS/2+"px"};return(0,s.h)("div",{class:"point-button-wrapper",style:o},(0,s.h)(f.$,{progress:100*e,innerRadius:n.PROGRESS_RADIUS,barWidth:n.PROGRESS_WIDTH},(0,s.h)("circle",{class:"point",cx:"0",cy:"0",r:"22",transform:"rotate(-90)",fill:"#fff"})))}renderTopBar(e){const{notesPhase:t,openNoteView:i}=this.state,{toolPanelLayout:n,manager:o}=this.props,{notesViewData:r}=o.dataMap,l=n===a.wS.SIDE_PANEL,c=r.creatingNote;if(l||c)return(0,s.h)("div",{class:"overlay-top-center"},this.renderOverlayMessage());if(i&&e){const e=t!==h.U.OPENING&&!!i,n=t===h.U.EDITING?m.BN.ACTIVE:e?m.BN.ENABLED:m.BN.DISABLED;return(0,s.h)("div",{class:"overlay-bar overlay-top-right"},(0,s.h)(g.h,{iconClass:"icon-stem-height",buttonStyle:g.D.OVERLAY,buttonState:n,onClick:this.toggleColorPicker}))}return null}renderActionBar(e){const{toolPanelLayout:t}=this.props,{showAddTooltip:i,notesPhase:n,pinState:o,canAdd:r,openNoteView:c}=this.state,d=o===l.tS.CREATING||o===l.tS.PLACING,u=n===h.U.IDLE,f=n===h.U.VIEWING,v=n===h.U.EDITING,y=n===h.U.OPENING,b=t===a.wS.SIDE_PANEL;if(!(u||d||f||v))return null;const w="icon-plus",S=r?m.BN.ENABLED:m.BN.DISABLED,E={"overlay-cta-btn":!0,"overlay-cta-cancel":this.hasCancelCta()};if(b){const t=!d&&!y&&!!c,n=v?m.BN.ACTIVE:t?m.BN.ENABLED:m.BN.DISABLED;return(0,s.h)("div",{class:"overlay-cta"},e&&(0,s.h)(g.h,{appendClass:{"overlay-cta-button-outer":!0,"overlay-cta-button-outer-left":!0},iconClass:"icon-stem-height",buttonStyle:g.D.OVERLAY,buttonState:n,onClick:this.toggleColorPicker}),(0,s.h)(p.u,{appendClass:{"tooltip-simple-medium":!0},open:i,message:(0,s.h)("span",null,"Click to add a note to your Space."),arrowPos:p.x.BOTTOM_CENTER,maxMsOpen:4e3}),(0,s.h)(g.h,{appendClass:E,iconClass:w,buttonStyle:g.D.PRIMARY,buttonState:S,onClick:this.clickCTAButton}),e&&(0,s.h)(g.h,{appendClass:{"overlay-cta-button-outer":!0},buttonStyle:g.D.OVERLAY,iconClass:"icon-delete",buttonState:t?m.BN.ENABLED:m.BN.DISABLED,onClick:this.deleteNote}))}return(0,s.h)("div",{class:"overlay-cta"},(0,s.h)(g.h,{appendClass:E,iconClass:w,buttonStyle:g.D.PRIMARY,buttonState:S,onClick:this.clickCTAButton}))}render(){const{toolPanelLayout:e,openModal:t}=this.props;if(t)return null;const{openNoteView:i,notesPhase:n}=this.state,{userData:o}=this.context,r=o.isCommenter(),c=r&&(null==i?void 0:i.id)===o.getCurrentUserId(),p=o.isEditor(),m=n===h.U.EDITING,g=e===a.wS.SIDE_PANEL;return(0,s.h)("div",{class:"overlay"},this.renderTopBar(c||p),r&&this.renderActionBar(c||p),i&&g&&p&&(0,s.h)(u.q,{pin:i,pinType:l.Er.NOTE,onSave:this.savePinAppearance,onClose:this.closeEditor,open:m,colors:d.ZP.colors,toolPanelLayout:e}),this.renderProgressCircle())}};y.PROGRESS_RADIUS=132,y.PROGRESS_WIDTH=8,y=n=v([o.Z],y)},10145:(e,t,i)=>{"use strict";i.d(t,{s:()=>ye});var n=i(26605),s=i(2116),o=i(47924),r=i(51090),a=i(90601),l=i(6201),c=i(29677),h=i(43098),d=i(90926),u=i(68611),p=i(43770),m=i(77113),g=i(90039),f=i(83455),v=i(94184),y=i(43711),b=i(73305),w=i(21517),S=i(71313),E=i(70110),T=i(96240),M=i(82209),_=i(42733),x=i(80429),A=i(86134),O=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let P=class OptionsMenu extends n.Component{constructor(e){super(e),this.popupOpened=e=>{const{assetId:t}=this.props;e.id!==t&&this.setState({open:!1})},this.toggleMenu=e=>{const t=e.clientY+this.popupMenu.offsetHeight+A.u.POPUP_OFFSET>window.innerHeight?A.x.BOTTOM_RIGHT:A.x.TOP_RIGHT;this.setState((e=>{const i=!e.open;return i&&this.context.messageBus.broadcast(new M.nZ(this.props.assetId)),{arrowPosition:t,open:i}}))},this.closeMenu=()=>{this.setState({open:!1})},this.clickMenu=e=>{e.stopPropagation(),this.setState({open:!1})},this.setPopupMenu=e=>{e&&(this.popupMenu=e)},this.state={open:!1,arrowPosition:A.x.TOP_RIGHT}}componentDidMount(){this.context.messageBus.subscribe(M.nZ,this.popupOpened)}componentWillUnmount(){this.context.messageBus.unsubscribe(M.nZ,this.popupOpened)}renderMenu(){const{children:e}=this.props,{open:t}=this.state;return(0,n.h)("div",{ref:this.setPopupMenu,class:"tooltip-menu",onClick:this.clickMenu},t&&e)}render(){const{assetId:e}=this.props,{open:t,arrowPosition:i}=this.state;return(0,n.h)(x.h,{buttonStyle:x.D.SOCIAL,buttonSize:_.qE.SMALL,iconClass:"icon-more-vert item-more-options",dataValue:e,onClick:this.toggleMenu},(0,n.h)(A.u,{open:t,onClose:this.closeMenu,message:this.renderMenu(),arrowPos:i,appendBodyClass:{"container--smallest--width":!0,"item-tooltip":!0}}))}};P=O([s.Z],P);var C=i(59064),D=i(72386),I=i(29359),R=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};const{INVITE_USER:L,INVITE_VIEWER_BUTTON:N,INVITE_EDITOR_BUTTON:k,INVITE_USERS:B,INVITE_VIEWERS_BUTTON:F,INVITE_EDITORS_BUTTON:U,INVITE_VISIBLE_MSG:V}=I.Z.USERS;let H=class UserInviteCard extends n.Component{constructor(e){super(e),this.inviteUsers=()=>{const{invitees:e,message:t,onInvited:i,noteId:n,commentId:s,modelAccess:o}=this.props;if(0===e.length)return;const r=e.map((e=>e.email));this.context.commandBinder.issueCommand(new D.J(r,t,o,n,s)).then((()=>{i()}))}}render(){const{userData:e,locale:t}=this.context;if(!e.isEditor())return null;const{invitees:i,expires:s,modelAccess:o}=this.props,r=o===w.x.FULL;if(0===i.length||(new Date).getTime()>s)return null;let a,l;const c=i.map((e=>e.email));1===c.length?(a=t.t(L,{email:c[0]}),l=t.t(r?k:N)):(a=t.t(B,{emails:c.join(", ")}),l=t.t(r?U:F));const h=t.t(V);return(0,n.h)("div",{class:"user-invite-card"},(0,n.h)("div",{class:"user-invite-info"},(0,n.h)("span",{class:"icon icon-eye-show"}),(0,n.h)("span",{class:""},h)),(0,n.h)("p",{class:"user-invite-msg"},a),(0,n.h)(_.zx,{onClick:this.inviteUsers,buttonStyle:_.ZJ.TERTIARY,appendClass:{"button-inline":!0,"user-invite-button":!0}},l))}};H=R([s.Z],H);var G=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let z=class Comment extends n.Component{constructor(e){super(e),this.editComment=()=>{this.trackEvent("notes_click_edit_comment"),this.props.onAnnotate(this.props.comment.id),this.annotation&&this.annotation.edit()},this.deleteComment=()=>{const{noteId:e,comment:t}=this.props;this.trackEvent("notes_click_delete_comment"),this.context.commandBinder.issueCommand(new g.mH(e,t.id))},this.saveChanges=(e,t)=>{const{comment:i,noteId:n,onCancel:s,onDone:o}=this.props;t?(this.trackEvent("notes_delete_empty_comment"),this.context.commandBinder.issueCommand(new g.mH(n,i.id)),s()):(this.context.commandBinder.issueCommand(new g.Uw(n,i.id,e)),o(),this.updateUserMentions())},this.onInvited=()=>{this.updateUserMentions()},this.setAnnotationRef=e=>{this.annotation=e},this.state={userMentions:[]}}componentDidMount(){this.updateUserMentions()}updateUserMentions(){let e=[];const{userData:t}=this.context,{user:i,text:n}=this.props.comment;i.id===t.getCurrentUserId()&&t.isCommenter()&&(e=(0,E.l)(n,t,w.x.PUBLIC)),this.setState({userMentions:e})}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}renderAnnotation(e){const{comment:t,attachments:i,hashtags:s,active:o,onViewAttachment:a,onCancel:l,toolPanelLayout:c}=this.props,{text:h,edited:d,id:u}=t;return(0,n.h)(T.Z,{key:u,ref:this.setAnnotationRef,annotationType:T.J.COLLABORATION,assetType:r.h.COMMENT,assetId:u,attachments:i,editable:e,clickToEdit:!1,active:o,edited:d,creating:!1,text:h,hashtags:s,toolPanelLayout:c,onViewAttachment:a,onDoneEditing:this.saveChanges,onCancelEditing:l,maxLength:f.Ko})}render(){const{userMentions:e}=this.state,{comment:t,active:i,noteId:s}=this.props,{user:o,created:r,id:a,text:l}=t,{userData:c}=this.context,h=o.id===c.getCurrentUserId()&&c.isCommenter(),d=h||c.isEditor(),u=t.modified.getTime()+60*f.E8*1e3,p=c.getUserInfoDisplay(o.id),m=p.color,g=S.v.getPlainText(l,!0,c);return(0,n.h)("div",{class:v("comment",{active:i}),"data-id":a},(0,n.h)("div",{class:"note-header comment-header"},(0,n.h)(C.C,{badgeStyle:{color:m,"border-color":m},label:p.initials}),(0,n.h)("div",{class:"note-details"},(0,n.h)("span",{class:"note-user"},p.name),(0,n.h)("div",{class:"note-subheader"},r.toLocaleString())),!i&&d&&(0,n.h)(P,{assetId:a},h&&(0,n.h)("div",{class:"tpMsg",onClick:this.editComment},"Edit"),(0,n.h)("div",{class:"tpMsg",onClick:this.deleteComment},"Delete"))),this.renderAnnotation(h),(0,n.h)(H,{expires:u,invitees:e,message:g,noteId:s,modelAccess:w.x.FULL,onInvited:this.onInvited}))}};z=G([s.Z],z);var j=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let W=class ReplyBox extends n.Component{constructor(e){super(e),this.startReply=()=>{const{replyId:e,onAnnotate:t}=this.props;this.trackEvent("notes_click_new_comment"),t(e)},this.saveChanges=(e,t)=>{const{replyId:i,noteId:n,onDone:s,onCancel:o}=this.props;t?o():(s(i),this.context.commandBinder.issueCommand(new g.Df(n,e,i)))}}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}render(){const{hashtags:e,replyId:t,active:i,onCancel:s,toolPanelLayout:o}=this.props;return(0,n.h)(T.Z,{appendClass:{"reply-box":!0},annotationType:T.J.COLLABORATION,assetType:r.h.COMMENT,assetId:t,attachments:[],editable:!0,clickToEdit:!0,active:i,edited:!1,creating:!0,text:"",hashtags:e,toolPanelLayout:o,placeholder:"Reply...",onClickToEdit:this.startReply,onDoneEditing:this.saveChanges,onCancelEditing:s,maxLength:f.Ko})}};W=j([s.Z],W);var Z=i(21265),q=i(87694),K=i(26265),Y=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let $=class NoteHeader extends n.Component{constructor(e){super(e),this.editNote=()=>{this.trackEvent("notes_click_edit_note"),this.props.onEditNote()},this.deleteNote=()=>{const{note:e}=this.props;this.trackEvent("notes_click_delete_note"),this.context.commandBinder.issueCommand(new g.sG(e.id))},this.resolveNote=()=>{const{note:e}=this.props;this.trackEvent("notes_click_resolve_note"),this.context.commandBinder.issueCommand(new g.yp(e.id,!0))},this.unresolveNote=()=>{const{note:e}=this.props;this.trackEvent("notes_click_unresolve_note"),this.context.commandBinder.issueCommand(new g.yp(e.id,!1))},this.onCopyLink=async()=>{if(this.state.linkCopied)return;const e=this.createLinkToNote(),t=document.createElement("input");t.type="text",t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),this.setState({linkCopied:!0}),window.setTimeout((()=>{this.setState({linkCopied:!1})}),2500)},this.state={linkCopied:!1}}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}createLinkToNote(){this.trackEvent("notes_click_copy_link");const e=q.K.removeNavigationKeys((0,Z.AO)());e.note=this.props.note.id;const t=Object.keys(e).map((t=>t+"="+e[t])).join("&");return`${window.location.origin}${window.location.pathname}?${t}`}render(){const{note:e,creatingNote:t}=this.props,{linkCopied:i}=this.state,{userData:s}=this.context,o=e.user.id===s.getCurrentUserId()&&s.isCommenter(),r=o||s.isEditor(),a=s.getUserInfoDisplay(e.user.id),l=a.color,c=!t&&!i;return(0,n.h)("header",{class:"note-header"},(0,n.h)(C.C,{badgeStyle:{color:l,"border-color":l},label:a.initials}),(0,n.h)("div",{class:"note-details"},(0,n.h)("span",{class:"note-user"},a.name),(0,n.h)("div",{class:"note-subheader"},e.created.toLocaleString())),c&&!e.resolved&&r&&(0,n.h)(x.h,{iconClass:"icon-checkmark",buttonStyle:x.D.SOCIAL,buttonSize:_.qE.SMALL,buttonState:_.BN.ENABLED,tooltipMsg:"Mark as resolved",tooltipPosition:K.lZ.DOWN,onClick:this.resolveNote}),c&&(0,n.h)(x.h,{iconClass:"icon-link",buttonStyle:x.D.SOCIAL,buttonSize:_.qE.SMALL,buttonState:_.BN.ENABLED,tooltipMsg:"Copy Link",tooltipPosition:K.lZ.DOWN,onClick:this.onCopyLink}),i&&(0,n.h)("div",{class:"link-copied"},"Link copied"),c&&r&&(0,n.h)(P,{assetId:e.id},o&&(0,n.h)("div",{class:"tpMsg",onClick:this.editNote},"Edit"),e.resolved&&(0,n.h)("div",{class:"tpMsg",onClick:this.unresolveNote},"Unresolve"),(0,n.h)("div",{class:"tpMsg",onClick:this.deleteNote},"Delete")))}};$=Y([s.Z],$);var X=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let Q=class NotePost extends n.Component{constructor(e){super(e),this.bindings=[],this.startEditingNote=()=>{const e=this.props.manager.dataMap.notesViewData.notesPhase;this.noteAnnotation&&e===m.U.ANNOTATING&&this.noteAnnotation.edit()},this.saveNoteChanges=async(e,t)=>{const{note:i,manager:n,onDone:s}=this.props;i&&(n.dataMap.notesViewData.creatingNote?await this.context.commandBinder.issueCommand(new g.FB(e)):await this.context.commandBinder.issueCommand(new g.kd(i.id,e)),s(),this.updateUserMentions())},this.cancelChanges=()=>{const{note:e,manager:t,onCancel:i}=this.props;t.dataMap.notesViewData.creatingNote?this.context.commandBinder.issueCommand(new g.gc):e&&this.context.commandBinder.issueCommand(new g.Wh(e.id)),i()},this.onEditNote=()=>{const{note:e,onAnnotate:t}=this.props;e&&t(e.id)},this.onFocusPin=()=>{this.props.manager.dataMap.notesViewData.creatingNote&&this.startEditingNote()},this.onInvited=()=>{this.updateUserMentions()},this.setNoteAnnotationRef=e=>{this.noteAnnotation=e},this.state={userMentions:[]}}componentDidMount(){const{messageBus:e}=this.context;this.bindings.push(e.subscribe(p.nY,this.onFocusPin)),this.updateUserMentions()}componentWillUnmount(){for(const e of this.bindings)e.cancel()}componentDidUpdate(e){var t,i;const n=null===(t=this.props.note)||void 0===t?void 0:t.id;(null===(i=e.note)||void 0===i?void 0:i.id)!==n&&(this.props.active&&e.active&&this.startEditingNote(),this.updateUserMentions())}updateUserMentions(){let e=[];const t=this.props.note;if(t){const{userData:i}=this.context,{user:n,text:s}=t;n.id===i.getCurrentUserId()&&i.isCommenter()&&(e=(0,E.l)(s,i,w.x.PUBLIC))}this.setState({userMentions:e})}getExpirationTime(e){const t=e.comments.get(0);return t?t.modified.getTime()+60*f.E8*1e3:e.modified.getTime()+60*f.E8*1e3}render(){const{note:e,creatingNote:t,toolPanelLayout:i,attachments:s,active:o,hashtags:a,onViewAttachment:l}=this.props,{userMentions:c}=this.state,{userData:h}=this.context,d=e?e.text:"",u=!!(!e||e.user.id===h.getCurrentUserId()),p=!!e&&e.edited,m=e?this.getExpirationTime(e):0,g=S.v.getPlainText(d,!0,h),v=e?e.comments.get(0):null,y=v?v.id:e?e.id:"",b=v?r.h.COMMENT:r.h.NOTE;return(0,n.h)("div",{class:"note-post"},e&&(0,n.h)($,{note:e,creatingNote:t,onEditNote:this.onEditNote}),(0,n.h)(T.Z,{ref:this.setNoteAnnotationRef,annotationType:T.J.COLLABORATION,assetId:y,assetType:b,attachments:s,clickToEdit:!1,editable:u,active:o,edited:p,creating:t,text:d,hashtags:a,placeholder:"Add your message",toolPanelLayout:i,onViewAttachment:l,onDoneEditing:this.saveNoteChanges,onCancelEditing:this.cancelChanges,maxLength:f.TM}),e&&(0,n.h)(H,{expires:m,invitees:c,message:g,noteId:e.id,modelAccess:w.x.FULL,onInvited:this.onInvited}))}};Q=X([s.Z],Q);var J=i(25255),ee=i(81323),te=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let ie=class NoteWidget extends n.Component{constructor(e){super(e),this.bindings=[],this.updateAttachments=()=>{const{note:e,manager:t}=this.props,i=e?t.getNoteAttachments(e):[];this.setState({attachments:i})},this.updateHashtags=()=>{const e=this.props.manager.dataMap.hashtagData;this.setState({hashtags:e.getHashtags()})},this.updateToolAssetAccess=()=>{this.setState({toolAccess:this.context.toolsData.toolAccess})},this.closeNotesMode=()=>{this.context.commandBinder.issueCommand(new y.tT(a.w1.NOTES,!1))},this.onAssetFocus=e=>{e.assetType===r.h.COMMENT&&this.props.onFocusScroll(`[data-id='${e.assetId}']`)},this.onEditAnnotation=e=>{this.props.manager.dataMap.notesViewData.setNotesPhase(m.U.ANNOTATING),this.setState({activeAnnotation:e})},this.onDone=()=>{this.setState({activeAnnotation:null})},this.cancelChanges=()=>{const{note:e,manager:t}=this.props;t.dataMap.notesViewData.creatingNote?this.closeNote():e&&this.context.commandBinder.issueCommand(new g.Wh(e.id)),this.setState({activeAnnotation:null})},this.closeNote=()=>{this.props.manager.dataMap.notesViewData.creatingNote?this.context.commandBinder.issueCommand(new g.gc):this.context.commandBinder.issueCommand(new g._N),this.setState({activeAnnotation:null})},this.onViewAttachment=(e,t)=>{const{attachments:i}=this.state,n=i.findIndex((e=>e.id===t));this.trackEvent("notes_click_view_attachment"),-1!==n&&this.context.commandBinder.issueCommand(new b.SI(i,n))},this.onNavigate=e=>{this.props.onSwitchAnnotation(e)};const t=e.creatingNote||e.notesPhase===m.U.ANNOTATING;this.state={activeAnnotation:e.note&&t?e.note.id:null,toolAccess:a.X$.SCENE,hashtags:[],attachments:[]}}componentDidMount(){const{hashtagData:e,attachmentsData:t}=this.props.manager.dataMap,{toolsData:i,messageBus:n}=this.context;this.bindings.push(i.onToolAssetAccessChanged(this.updateToolAssetAccess),e.onChanged(this.updateHashtags),t.onChanged(this.updateAttachments),n.subscribe(l.ZL,this.onAssetFocus)),this.updateToolAssetAccess(),this.updateHashtags(),this.updateAttachments()}componentWillUnmount(){for(const e of this.bindings)e.cancel()}componentDidUpdate(e,t){var i;const n=null===(i=this.props.note)||void 0===i?void 0:i.id;e.note!==this.props.note&&(this.updateAttachments(),this.props.notesPhase===m.U.ANNOTATING||(this.props.creatingNote&&n?this.setState({activeAnnotation:n}):this.setState({activeAnnotation:null})))}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}getCommentAttachments(e){return this.state.attachments.filter((t=>t.assetId===e))}getNotePostAttachments(){const{note:e}=this.props;if(!e)return[];const t=e.comments.get(0);return t?this.state.attachments.filter((i=>i.assetId===e.id||i.assetId===t.id)):[]}renderReplyBox(){const{note:e,toolPanelLayout:t,manager:i}=this.props;if(!e)return null;const{activeAnnotation:s,hashtags:o}=this.state,r=i.getReplyId(e),a=s===r;return a||null===s?(0,n.h)(W,{key:`reply-${e.comments.length}`,replyId:r,noteId:e.id,active:a,hashtags:o,toolPanelLayout:t,onAnnotate:this.onEditAnnotation,onDone:this.onDone,onCancel:this.cancelChanges}):null}renderComments(){const{note:e,toolPanelLayout:t}=this.props;if(!e)return null;const{activeAnnotation:i,hashtags:s}=this.state;return(0,n.h)("div",{class:"note-comments"},e.comments.map(((o,r)=>{if(0===r)return null;const a=this.getCommentAttachments(o.id);return(0,n.h)(z,{key:o.id,comment:o,noteId:e.id,attachments:a,active:i===o.id,hashtags:s,toolPanelLayout:t,onAnnotate:this.onEditAnnotation,onDone:this.onDone,onCancel:this.cancelChanges,onViewAttachment:this.onViewAttachment})})))}renderNoteNavHeader(){const{notesPhase:e,listIndex:t,numAnnotations:i,creatingNote:s,note:o,toolPanelLayout:r}=this.props;if(s||!o)return null;const{toolAccess:l}=this.state,c=e===m.U.ANNOTATING,h=!s&&!c&&i>1&&-1!==t,d=r===a.wS.SIDE_PANEL,u=l===a.X$.SCENE,p=l===a.X$.LIST||!u&&d,g=p?"Back":"Close",f=p?"icon-back":"icon-close",v=p||!u?this.closeNote:this.closeNotesMode;return(0,n.h)("div",{class:"detail-panel-header"},(0,n.h)(J.A,{label:g,className:"return-btn",icon:f,buttonSize:_.qE.SMALL,buttonStyle:_.ZJ.TOOLBAR,onClick:v}),h&&(0,n.h)(ee.$,{index:t,total:i,disabled:c,wrapAround:!0,onNavigate:this.onNavigate}))}render(){const{manager:e,note:t,toolPanelLayout:i,notesPhase:s,creatingNote:o}=this.props,{activeAnnotation:r,hashtags:a}=this.state,{userData:l}=this.context,c=l.isCommenter(),h=s===m.U.ANNOTATING,d=t?t.id:"new",u=h&&(r===d||o),p={annotating:h,creating:o},g=this.getNotePostAttachments();return(0,n.h)("div",{class:v("note-widget",p)},this.renderNoteNavHeader(),(0,n.h)(Q,{active:u,manager:e,note:t,attachments:g,toolPanelLayout:i,notesPhase:s,creatingNote:o,hashtags:a,onAnnotate:this.onEditAnnotation,onDone:this.onDone,onCancel:this.cancelChanges,onViewAttachment:this.onViewAttachment}),!o&&this.renderComments(),!o&&c&&this.renderReplyBox())}};ie=te([s.Z],ie);var ne=i(30300),se=i(99363),oe=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let re=class NoteDetailsPanel extends n.Component{constructor(e){super(e),this.bindings=[],this.onModalChange=()=>{const e=!!this.context.toolsData.openModal;e!==this.state.modalOpen&&(e||this.toolPanel&&this.props.toolPanelLayout===a.wS.BOTTOM_PANEL&&this.toolPanel.resetScrollTop(),this.setState({modalOpen:e}))},this.onFocusScroll=e=>{this.toolPanel.scrollToSelector(e)},this.closeEditor=()=>{this.context.commandBinder.issueCommand(new g.df(!1))},this.savePinAppearance=e=>{const{note:t}=this.props;t&&this.context.commandBinder.issueCommand(new g.oE(t.id,e))},this.setToolPanelRef=e=>{e&&(this.toolPanel=e)},this.state={modalOpen:!1}}componentDidMount(){const{toolsData:e}=this.context;this.bindings.push(e.onOpenModalChanged(this.onModalChange)),this.onModalChange()}componentWillUnmount(){for(const e of this.bindings)e.cancel()}componentDidUpdate(e,t){var i,n;this.toolPanel&&(e.notesPhase!==m.U.EDITING&&this.props.notesPhase===m.U.EDITING||(null===(i=e.note)||void 0===i?void 0:i.id)!==(null===(n=this.props.note)||void 0===n?void 0:n.id))&&this.toolPanel.resetScrollTop()}render(){const{note:e,numAnnotations:t,listIndex:i,notesPhase:s,closing:o,creatingNote:r,toolPanelLayout:l,onSwitchAnnotation:c,manager:h}=this.props,{modalOpen:u}=this.state,{userData:p}=this.context,g=(null==e?void 0:e.user.id)===p.getCurrentUserId()&&p.isCommenter(),v=p.isEditor(),y=s===m.U.EDITING,b=l===a.wS.BOTTOM_PANEL,w=!(!e||o||b&&u),S=y&&b;return(0,n.h)(ne.J,{ref:this.setToolPanelRef,open:w,toolPanelLayout:l,scrollingDisabled:S},(0,n.h)(ie,{manager:h,note:e,toolPanelLayout:l,notesPhase:s,creatingNote:r,numAnnotations:t,listIndex:i,onSwitchAnnotation:c,onFocusScroll:this.onFocusScroll}),e&&b&&(v||g)&&(0,n.h)(se.q,{key:e.id,pin:e,pinType:d.Er.NOTE,onSave:this.savePinAppearance,onClose:this.closeEditor,colors:f.ZP.colors,open:y,toolPanelLayout:l}))}};re=oe([s.Z],re);var ae,le=i(74674),ce=i(95892),he=i(96608),de=i(74121),ue=i(4633),pe=i(17666),me=i(20392),ge=i(53189);!function(e){e.TODAY="Today",e.YESTERDAY="Yesterday",e.THIS_WEEK="This week",e.ONE_WEEK_AGO="1 week ago",e.TWO_WEEKS_AGO="2 weeks ago",e.THREE_WEEKS_AGO="3 weeks ago",e.OLDER="Older"}(ae||(ae={}));const fe=35;class AnnotationsList extends n.Component{constructor(e){super(e),this.bindings=[],this.updateNoteFilter=()=>{const e=this.props.manager.dataMap.notesViewData;this.setState({filter:e.notesFilter})},this.updateNoteGroups=()=>{const e=this.getSortedNoteGroups();this.setState({listGroups:e})},this.onSelectAnnotation=e=>{this.trackEvent("notes_list_open_note");const[t,i]=e.split("-");this.openAnnotation(i,t,!1)},this.editNote=e=>{const{activeMenuId:t}=this.state;e.stopPropagation(),t&&(this.trackEvent("notes_list_edit_note"),this.openAnnotation(t,r.h.NOTE,!0),this.setState({activeMenuId:null}))},this.deleteNote=e=>{const{activeMenuId:t}=this.state;e.stopPropagation(),t&&(this.trackEvent("notes_list_delete_note"),this.context.commandBinder.issueCommand(new g.sG(t)),this.setState({activeMenuId:null}))},this.setPopupMenu=e=>{e&&(this.popupMenu=e)},this.closeMenu=e=>{const t=e.target;t&&t.classList.contains("item-more-options")||this.setState({activeMenuId:null})},this.toggleOptionsMenu=e=>{const t=e.clientY+this.popupMenu.offsetHeight+A.u.POPUP_OFFSET>window.innerHeight?A.x.BOTTOM_RIGHT:A.x.TOP_RIGHT,i=e.currentTarget,n=i&&i.getAttribute?i.getAttribute("data-value"):null;n&&this.state.activeMenuId!==n?this.setState({activeMenuId:n,arrowPosition:t,filterMenuOpen:!1}):this.setState({activeMenuId:null,arrowPosition:t})},this.changeFilter=(e,t)=>{if(t){const e=t;this.trackEvent("notes_list_change_filter"),this.props.manager.dataMap.notesViewData.setNotesFilter(e)}},this.toggleFilter=e=>{e.stopPropagation(),this.setState((e=>({filterMenuOpen:!e.filterMenuOpen,activeMenuId:null})))},this.closeFilter=()=>{this.setState({filterMenuOpen:!1})},this.onCloseLayer=async e=>{e&&e.stopPropagation(),await this.context.commandBinder.issueCommand(new y.tT(a.w1.NOTES,!1))},this.state={listGroups:{},activeMenuId:null,filter:ce.$.OPEN,filterMenuOpen:!1,arrowPosition:A.x.TOP_RIGHT}}componentDidMount(){const{notesViewData:e}=this.props.manager.dataMap;this.bindings.push(e.onNotesFilterChanged(this.updateNoteFilter)),this.updateNoteGroups(),this.updateNoteFilter()}componentWillUnmount(){for(const e of this.bindings)e.cancel()}componentDidUpdate(e,t){e.annotationViews===this.props.annotationViews&&t.filter===this.state.filter&&e.searchBlock===this.props.searchBlock||this.updateNoteGroups()}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}getSortedNoteGroups(){const e={};return this.props.annotationViews.forEach((t=>{const i=this.getDateBucket(t.createdTime);e[i]||(e[i]={dateBucket:i,items:[]}),e[i].items.push(t)})),e}getDateBucket(e){const t=new Date(e),i=new Date;i.setHours(0,0,0,0),t.setHours(0,0,0,0);const n=(i.getTime()-t.getTime())/864e5;if(0===n)return ae.TODAY;if(1===n)return ae.YESTERDAY;if(n<7)return ae.THIS_WEEK;const s=Math.floor(n/7);return 1===s?ae.ONE_WEEK_AGO:2===s?ae.TWO_WEEKS_AGO:3===s?ae.THREE_WEEKS_AGO:ae.OLDER}openAnnotation(e,t,i){this.context.commandBinder.issueCommand(new g.uT(e,t,i))}getEmptyMessage(){const{searchBlock:e}=this.props,{filter:t}=this.state;return e?"No matches":t===ce.$.OPEN?"You don't have any open notes.":t===ce.$.RESOLVED?"You don't have any resolved notes.":"You don't have any notes yet."}getAnnotationText(e){const{searchBlock:t}=this.props;let i=e.text;if(""===i){const t=e.numAttachments,n=e.numComments-1;1===t?i="1 attachment":t>1?i=`${t} attachments`:0===n&&(i="Original content was deleted")}else if(t&&e.textIndex>0&&i.length>fe){const n=i.length,s=t.text.length,o=Math.floor((fe-s)/2);let r=e.textIndex-o;if(r+fe>n&&(r-=r+fe-n),r>0){const e=`...${i.substr(r)}`;e.length<fe?(r-=fe-e.length,r>0&&(i=`...${i.substr(r)}`)):i=e}}return i}getListTitle(){const{annotationViews:e,searchBlock:t}=this.props;let i;const n=e.length;return i=t?1===n?"1 Result":`${n} Results`:1===n?"1 Note":`${n} Notes`,i}renderNoteMenu(e){return(0,n.h)("div",{class:"tooltip-menu",ref:e=>this.setPopupMenu(e)},e&&(0,n.h)("div",{class:"tpMsg",onClick:this.editNote},"Edit"),(0,n.h)("div",{class:"tpMsg",onClick:this.deleteNote},"Delete"))}renderAnnotationSummary(e){const t=this.getAnnotationText(e);return(0,n.h)("div",{class:v("note-text",{"note-summary-info":!e.text})},(0,n.h)(ge.Z,{text:t,activeLinks:!1,hashtags:!0,userMentions:!0}))}renderItem(e,t){const{searchBlock:i}=this.props,{activeMenuId:s,arrowPosition:o}=this.state,{id:r,user:a,color:l,assetType:c,numComments:h}=e,d=`${c}-${r}`,{userData:u}=this.context,p=a.id===u.getCurrentUserId()&&u.isCommenter(),m=p||u.isEditor(),g=u.getUserInfoDisplay(a.id),f=h-1,v=s===r,y=1===f?`${f} reply`:`${f} replies`,b={"accordion-item-with-options":m,"note-header":!0};return(0,n.h)(me.Q,{key:d,sid:d,appendClass:b,enabled:!0,selected:!1,onSelect:this.onSelectAnnotation},(0,n.h)(C.C,{badgeStyle:{"background-color":l,"border-color":l},iconClass:"icon-comment"}),(0,n.h)("div",{class:"note-details"},(0,n.h)("span",{class:"note-user"},g.name),f>0&&!i&&(0,n.h)("span",{class:"note-summary-info note-replies"},y),this.renderAnnotationSummary(e)),!i&&m&&(0,n.h)(x.h,{dataValue:r,appendClass:{"accordion-item-more-options":!0},buttonStyle:x.D.PLAIN,iconClass:"icon-more-vert item-more-options",onClick:this.toggleOptionsMenu},(0,n.h)(A.u,{open:v,onClose:this.closeMenu,message:this.renderNoteMenu(p),arrowPos:o,appendBodyClass:{"container--smallest--width":!0,"item-tooltip":!0}})))}renderGroups(){const{listGroups:e}=this.state,t=[];for(const i in e){const s=e[i];t.push((0,n.h)(pe.b,{key:i,id:i,header:s.dateBucket,open:!0,doubleLine:!0},s.items.map(((e,t)=>this.renderItem(e,t)))))}return t}renderFilter(){const{filter:e,filterMenuOpen:t}=this.state,i=[{text:"Unresolved",value:ce.$.OPEN,selected:e===ce.$.OPEN},{text:"Resolved",value:ce.$.RESOLVED,selected:e===ce.$.RESOLVED},{text:"All",value:ce.$.ALL,selected:e===ce.$.ALL}];return(0,n.h)("div",{class:"filter note-filter"},(0,n.h)(de.S,{className:"filter-note-select",menuStyle:de.K.DROPDOWN,open:t,onToggle:this.toggleFilter,onSelect:this.changeFilter,onClose:this.closeFilter,options:i}))}renderAnnotations(){const{annotationViews:e}=this.props;if(0===e.length){const e=this.getEmptyMessage();return(0,n.h)("div",{class:"empty-message"},e)}return(0,n.h)(ue.F,null,this.renderGroups())}renderSearchHeader(){const{searchBlock:e,onCancelSearch:t}=this.props;return e?(0,n.h)("div",{class:"search-header"},(0,n.h)("span",{class:"search-term"},e.text),(0,n.h)(_.zx,{buttonStyle:_.ZJ.PLAIN,onClick:t},"Clear")):null}renderSubheader(){return(0,n.h)("div",{class:"list-subheader"},this.renderSearchHeader(),this.renderFilter())}render(){const{active:e,toolPanelLayout:t,searchBlock:i}=this.props,s=!!i&&i.blockType===le.C.USER,o=!!i&&i.blockType===le.C.HASH;return(0,n.h)(he.L,{active:e,appendClass:{"annotations-list-panel":!0},title:this.getListTitle(),subheader:this.renderSubheader(),toolPanelLayout:t,onClose:this.onCloseLayer},(0,n.h)("div",{class:v("list-panel-list","annotations-list",{"search-results-user":s,"search-results-hash":o})},this.renderAnnotations()))}}var ve=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let ye=class NotesPanel extends n.Component{constructor(e){super(e),this.bindings=[],this.noteClosedTimeout=0,this.updateAnnotationViews=()=>{const e=this.props.manager.dataMap.notesViewData.getAnnotationViewList();this.setState({annotationViews:e.values()})},this.updateListIndex=()=>{const e=this.props.manager.dataMap.notesViewData.listIndex;this.setState({listIndex:e})},this.updateNotesPhase=()=>{this.setState({notesPhase:this.props.manager.dataMap.notesViewData.notesPhase})},this.pinPlaced=e=>{e.pinType===d.Er.NOTE&&this.startOpeningNoteWidget()},this.updateCurrentNote=async()=>{const{currentNote:e}=this.state,t=this.props.manager.dataMap.notesViewData,i=t.notesPhase,n=this.placingNewNote(i),s=t.openNoteView;n?e&&this.startClosingNoteWidget():!e&&s?this.startOpeningNoteWidget():e&&!s?this.startClosingNoteWidget():this.setState({currentNote:s})},this.updateSearchTerm=()=>{const e=this.props.manager.dataMap.annotationsViewData;this.setState({searchBlock:e.searchBlock})},this.onSwitchAnnotation=async e=>{const t=this.state.annotationViews[e];if(!t)return;const i=t.assetType===r.h.COMMENT,n=i&&t.assetId?t.assetId:t.id,s=this.props.toolPanelLayout===a.wS.SIDE_PANEL?o.n.FadeToBlack:o.n.Instant;await this.context.commandBinder.issueCommand(new u.$b(n,d.Er.NOTE,s,void 0,e)),i&&this.context.messageBus.broadcast(new l.ZL(r.h.COMMENT,t.id))},this.onCancelSearch=()=>{this.context.commandBinder.issueCommand(new h.B)},this.state={noteClosing:!1,annotationViews:[],notesPhase:m.U.CLOSED,currentNote:null,searchBlock:null,listIndex:-1}}componentDidMount(){const{notesViewData:e,annotationsViewData:t}=this.props.manager.dataMap,{messageBus:i}=this.context;this.bindings.push(e.onNotesPhaseChanged(this.updateNotesPhase),e.onOpenNoteViewChanged(this.updateCurrentNote),e.onListIndexChanged(this.updateListIndex),e.getAnnotationViewList().onChanged(this.updateAnnotationViews),t.onSearchBlockChanged(this.updateSearchTerm),i.subscribe(p.b0,this.pinPlaced)),this.updateAnnotationViews(),this.updateCurrentNote(),this.updateListIndex(),this.updateNotesPhase(),this.updateSearchTerm()}componentWillUnmount(){window.clearTimeout(this.noteClosedTimeout);for(const e of this.bindings)e.cancel()}placingNewNote(e){return e===m.U.CREATING}startOpeningNoteWidget(){const e=this.props.manager.dataMap.notesViewData;window.clearTimeout(this.noteClosedTimeout),this.setState({currentNote:e.openNoteView,noteClosing:!1})}startClosingNoteWidget(){this.state.noteClosing||(this.setState({noteClosing:!0}),this.noteClosedTimeout=window.setTimeout((()=>{this.setState({currentNote:null,noteClosing:!1})}),c.El))}render(){const{toolPanelLayout:e,manager:t}=this.props,{notesViewData:i}=t.dataMap,{noteClosing:s,searchBlock:o,annotationViews:r,listIndex:a,notesPhase:l,currentNote:c}=this.state,h=r.length,d=i.creatingNote;return(0,n.h)("div",{class:"tool-panel notes-panel"},(0,n.h)(re,{manager:t,closing:s,note:c,toolPanelLayout:e,notesPhase:l,creatingNote:d,numAnnotations:h,listIndex:a,onSwitchAnnotation:this.onSwitchAnnotation}),(0,n.h)(AnnotationsList,{manager:t,active:s||!c,toolPanelLayout:e,annotationViews:r,searchBlock:o,onCancelSearch:this.onCancelSearch}))}};ye=ve([s.Z],ye)},5767:(e,t,i)=>{"use strict";i.d(t,{$:()=>Tags});var n=i(26605),s=i(94184),o=i(12856),r=i(71583),a=i(43084),l=i(54733),c=i(4292),h=i(47924),d=i(2116),u=i(20331),p=i(28615),m=i(25799);const g=new m.Z("embedly");class InvalidImageEmbed{constructor(e){this.msg=e}}class InvalidHtmlError{constructor(e){this.msg=e}}class UnsupportedTypeError{constructor(e){this.msg=e}}const f="Instagram",v="Flickr";class Embedly{constructor(e){this.key=e,this.embedEndpoint="https://api.embed.ly/1/oembed",this.imageEndpoint="https://i.embed.ly/1/display/resize",this.saveProvidersForScripts=[v,f],Embedly.queue||(Embedly.queue=new u.gO({retries:0}))}static clearCache(){Embedly.embedCache={},Embedly.imageCache={}}async getType(e){const t=await this.fetchFromCache(e);if(t)return t.type;try{const t=await this.getEmbedDetails(e);if(t.type===p.z.rich||t.type===p.z.video)return t.type}catch(e){if(401!==e.status_code&&404!==e.status_code&&501!==e.status_code&&!(e instanceof InvalidImageEmbed))return p.z.error}try{return await this.getImageDetails(e),p.z.photo}catch(e){}return p.z.error}async fetchFromCache(e){const t=await this.getDisplayUrl(e),i=Embedly.imageCache[t];if(i)return i;const n=await this.getOEmbedUrl(e),s=Embedly.embedCache[n];return s||null}async getMediaDetails(e,t){switch(e){case p.z.photo:return this.getImageDetails(t);case p.z.rich:case p.z.video:return this.getEmbedDetails(t)}throw Error("unsupported media type")}async getOEmbedUrl(e){const t=Math.max(window.screen.height,window.screen.width),i=`&maxwidth=${t}&maxheight=${t}`;return`${this.embedEndpoint}?key=${this.key}&url=${encodeURIComponent(e)}${i}`}async getEmbedDetails(e){const t=await this.getOEmbedUrl(e);return Embedly.embedCache[t]?Promise.resolve(Embedly.embedCache[t]):this.loadEmbed(t)}async getDisplayUrl(e){const t=Math.max(window.screen.height,window.screen.width),i=`&url=${encodeURIComponent(e)}&width=${t}&height=${t}`;return`${this.imageEndpoint}?key=${this.key}${i}`}async getImageDetails(e){const t=await this.getDisplayUrl(e);return Embedly.imageCache[t]?Promise.resolve(Embedly.imageCache[t]):this.loadImage(t)}loadEmbed(e){return Embedly.queue.get(e,{responseType:"json"}).then((t=>this.validateAndCacheEmbed(e,t)))}loadImage(e){return new Promise(((t,i)=>Embedly.queue.get(e,{responseType:"arraybuffer"}).then((t=>this.validateAndCacheImage(e,t))).then(t).catch(i)))}validateAndCacheEmbed(e,t){const i=!!(!t.html||!t.html.match(/<script/i))||this.saveProvidersForScripts.includes(t.provider_name);if(!(t.type!==p.z.photo||t.html&&i))throw new InvalidImageEmbed('image can\'t be used as a "rich" type');if(!t||t.type===p.z.rich&&(!t.html||!i))throw new InvalidHtmlError("missing html or html contains Javascript");switch(t.type){case p.z.photo:t.html&&(t.type=p.z.rich);break;case p.z.rich:case p.z.video:break;case p.z.link:{const e="not supporting link types because of existing link functionality";throw g.debug(e),new UnsupportedTypeError(e)}default:{const e=`Did the OEmbed format extend?! Unknown type: ${t.type}`;throw g.debug(e),new UnsupportedTypeError(e)}}const n=(void 0===t.height||void 0===t.width)&&t.thumbnail_width&&t.thumbnail_height,s=n?t.thumbnail_width:t.width,o=n?t.thumbnail_height:t.height,r=t.provider_name,a={width:s,height:o,embedlyResponse:{html:t.html,src:t.url,provider:r},type:t.type};return Embedly.embedCache[e]=a,a}validateAndCacheImage(e,t){return new Promise(((i,n)=>{t||n("Embedly: got an empty response when requesting image");const s=new Uint8Array(t),o=new Blob([s]),r=new Image;r.addEventListener("load",(t=>function(t){const n=t.target,s={width:n.naturalWidth,height:n.naturalHeight,embedlyResponse:{url:a,src:e},type:p.z.photo};Embedly.imageCache[e]=s,i(s)}(t)));const a=URL.createObjectURL(o);r.src=a}))}}Embedly.embedCache={},Embedly.imageCache={};var y,b=i(6082),w=i(2752),S=i(35825),E=i(62367),T=i(74674),M=i(71313),_=i(17141),x=i(21265);!function(e){e[e.NOT_READY=1]="NOT_READY",e[e.CUED=2]="CUED",e[e.PLAYING=3]="PLAYING",e[e.PAUSED=4]="PAUSED"}(y||(y={}));var A=i(21746),O=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};const P=new m.Z("mattertag-media");let C=class MattertagMedia extends n.Component{constructor(e){super(e),this.playerControls=null,this.handleClick=()=>{this.props.mediaType===p.z.photo&&this.props.onClickImage&&this.props.onClickImage()},this.onPlayerLoaded=e=>{this.playerControls=e,e.play()},this.setupPlayerControls=e=>{let t=y.NOT_READY;const i=()=>{t=y.CUED,this.onPlayerLoaded(a)},n=()=>{t=y.PLAYING},s=()=>{t=y.PAUSED},o=()=>{};try{e.on("ready",i),e.on("play",n),e.on("pause",s),e.on("ended",o)}catch(e){P.debug(e)}const r=(0,x.tq)(),a={play:()=>{if(e&&t!==y.NOT_READY&&!r)try{e.play()}catch(e){P.error(e)}},pause:()=>{if(e&&t!==y.NOT_READY)try{e.pause()}catch(e){P.debug(e)}}}},this.setEmbedContentRef=e=>{e&&!this.iframe&&this.createEmbed(e)},this.setContainerRef=e=>{this.mediaContainer=e,this.updateMaxDims()},this.updateMaxDims=()=>{if(this.mediaContainer&&this.props.mediaAspectRatio&&this.props.mediaType===p.z.video){const e=this.mediaContainer.getBoundingClientRect();this.setState({maxWidth:e.width,maxHeight:e.height})}},this.mediaStyles=()=>{const{width:e,height:t,mediaPayload:i,mediaType:n,mediaAspectRatio:s}=this.props,{maxWidth:o,maxHeight:r}=this.state,a={};if(i)switch(n){case p.z.photo:a.backgroundImage=i.url?`url('${i.url}')`:"none";case p.z.rich:void 0!==e&&(a.width=`${e}px`),void 0!==t&&(a.height=`${t}px`,i.provider===f?a.height=`${t+54}px`:a.height=`${t}px`);break;case p.z.video:if(void 0!==e&&void 0!==t){const i=(0,A.yB)(e,t);a.width=`${e}px`,a.height=`${i}px`}else if(o&&r&&void 0!==s){const e=Math.min(r,(0,A.yB)(o,o/s)),t=e*s;a.width=`${t}px`,a.height=`${e}px`}}return a},this.state={maxWidth:0,maxHeight:0}}componentDidMount(){this.props.mediaAspectRatio&&this.props.mediaType===p.z.video&&(window.addEventListener("resize",this.updateMaxDims),this.updateMaxDims())}componentWillUnmount(){this.props.mediaAspectRatio&&this.props.mediaType===p.z.video&&window.removeEventListener("resize",this.updateMaxDims)}componentWillReceiveProps(e){e.mediaPayload!==this.props.mediaPayload&&this.iframe&&this.iframe.parentNode&&(this.iframe.parentNode.removeChild(this.iframe),this.iframe=null),this.playerControls&&this.props.closing!==e.closing&&(e.closing?this.playerControls.pause():this.playerControls.play())}createEmbed(e){const{mediaType:t,mediaPayload:i,width:n,height:s}=this.props,{html:o,provider:r,src:a}=i,l=document.createElement("div");l.innerHTML=o;let c=l.firstChild;if("iframe"!==c.tagName.toLowerCase()){if(c=document.createElement("iframe"),!("srcdoc"in c))return P.warn(`Browser does not support srcdoc, refusing to embed ${o}`),void(this.iframe=null);let e,t;void 0!==n&&(c.width=n.toString()),void 0!==s&&(c.height=s.toString()),c.setAttribute("allow","encrypted-media; autoplay; fullscreen"),c.classList.add("tag-iframe-sandbox","loading"),c.onload=()=>c.classList.remove("loading"),e=r===v&&void 0!==a?`<img src=${a} />`:o,t=r===f?"\n          <style>\n            html, body { padding: 0; margin: 0; border: 0; }\n            img { display: block; max-width: 100%; height: auto; border: 0; }\n            iframe { display: block; max-width: 100%; border: 0; }\n          </style>\n        ":"\n          <style>\n            html, body { padding: 0; margin: 0; border: 0; }\n            img, iframe { display: block; max-width: 100%; height: auto; border: 0; }\n          </style>\n        ";const i=t.replace(/\s+/g," ");c.srcdoc=`<!doctype html>${i}${e}`}else{const e=c.style;e.maxWidth="100%",e.maxHeight="100%",e.minWidth="",e.minHeight=""}if(t===p.z.video&&c.src)try{const e=new _.Player(c);c.addEventListener("load",(()=>this.setupPlayerControls(e)))}catch(e){P.error(e)}this.iframe=c,e.appendChild(c)}render(){const{mediaPayload:e,mediaType:t}=this.props;if(!e)return null;const i=s({"tag-image":t===p.z.photo,"tag-embed":t===p.z.rich,"tag-video":t===p.z.video}),o=e&&e.html?(0,n.h)("div",{class:"tag-embed-content",ref:this.setEmbedContentRef}):null;return(0,n.h)("div",{ref:this.setContainerRef,class:"tag-media-content",onClick:this.handleClick},(0,n.h)("div",{className:i,style:this.mediaStyles()},o))}};C=O([d.Z],C);const D=C;var I=i(31399),R=i(57501),L=i(98867),N=i(93273);class EditableDescription extends n.Component{constructor(e){super(e),this.getInputDiv=()=>this.inputDiv,this.hasTextSelected=()=>this.range&&this.range.startOffset!==this.range.endOffset,this.onSelectionChange=()=>{const e=this.getCurrentSelection();e&&(this.range=e.cloneRange())},this.addFauxHighlight=()=>{this.execCommand("backColor","#ff315840")},this.removeFauxHighlight=()=>{this.execCommand("backColor","transparent")},this.prepareLinkSelection=()=>{const e=this.getAnchorFromSelection();let t=null;const i=window.getSelection();return i&&(e||this.range?(this.addFauxHighlight(),e||(t=this.range?this.range.toString():i.toString())):(this.inputDiv.focus(),i.selectAllChildren(this.inputDiv),i.collapseToEnd(),this.range=i.getRangeAt(0),t=this.range.toString())),e||(t||"")},this.onMouseDown=e=>{e.stopPropagation(),this.removeFauxHighlight(),this.range=null},this.onKeyPress=e=>{const t=e.which||e.keyCode;if(e.stopPropagation(),t===S.R.ESCAPE)return this.props.onNavigationKey(e);if(t===S.R.RETURN||t===S.R.TAB)return e.shiftKey||(e.preventDefault(),this.finalizeInput()),this.props.onNavigationKey(e);if("keydown"===e.type)return;const i=this.inputDiv.innerText;this.props.maxLength&&i&&i.length>this.props.maxLength&&e.preventDefault()},this.onInput=()=>{this.props.onInput(this.inputDiv.innerText)},this.onPaste=e=>{const t=(e.clipboardData||window.clipboardData).getData("text/plain");let i=t.length;const n=this.inputDiv.innerText,s=window.getSelection();if(s&&this.props.maxLength&&n&&n.length+i>this.props.maxLength){const e=this.props.maxLength-this.inputDiv.innerText.length+s.toString().length;i=Math.min(e,i)}document.execCommand("insertText",!1,t.slice(0,i)),e.preventDefault()},this.onFocus=e=>{this.context.messageBus.broadcast(new N.S(this.inputDiv,!0)),this.props.onFocus&&this.props.onFocus()},this.onBlur=()=>{this.context.messageBus.broadcast(new N.S(this.inputDiv,!1)),this.props.onBlur&&this.props.onBlur(),this.finalizeInput()},this.setInput=e=>{this.inputDiv=e};const t=new R.gm((()=>({})),(e=>document.addEventListener("selectionchange",e)),(e=>document.removeEventListener("selectionchange",e)));this.selectionSubscription=t.createSubscription(this.onSelectionChange)}componentDidMount(){const{description:e,onLinkClick:t}=this.props,i=this.getInputDiv();M.v.deserialize(e,!1,!1,void 0,t).forEach((e=>{i.appendChild(e)})),this.selectionSubscription.renew()}componentWillUnmount(){this.selectionSubscription.cancel(),this.inputDiv&&this.inputDiv.blur()}shouldComponentUpdate(){return!1}getCurrentSelection(){const e=window.getSelection();if(e&&e.rangeCount>0){const t=e.getRangeAt(0);if(this.inputDiv===t.commonAncestorContainer||this.inputDiv.compareDocumentPosition(t.commonAncestorContainer)&Node.DOCUMENT_POSITION_CONTAINED_BY)return t}return null}linkify(e,t){this.execCommand("backColor","transparent"),this.execCommand("createLink",t);const i=this.getAnchorFromSelection();i&&(i.text=e,this.addLinkProperties(i))}unlink(e){const t=e.parentNode,i=e.textContent;t&&(t.removeChild(e),i&&!(0,L.j)(i)&&this.execCommand("insertText",i))}applyRange(){if(this.range){const e=window.getSelection();e&&(e.removeAllRanges(),e.addRange(this.range))}}execCommand(e,t){this.range&&(this.applyRange(),document.execCommand(e,!1,t),this.onSelectionChange())}addLinkProperties(e){e.classList.add(M.o.LINK),e.onclick=this.props.onLinkClick}getAnchorFromSelection(){const e=this.getCurrentSelection();if(!e)return null;let t=e.commonAncestorContainer;for(;t&&"A"!==t.nodeName;){if(t===this.inputDiv)return null;t=t.parentNode}return t||null}finalizeInput(){this.props.onFinalizeInput(),this.inputDiv.blur()}render(){return(0,n.h)("div",{ref:this.setInput,class:"inputDiv",placeholder:this.props.placeholder,onMouseDown:this.onMouseDown,onKeyDown:this.onKeyPress,onKeyPress:this.onKeyPress,onPaste:this.onPaste,contentEditable:!0,onInput:this.onInput,onFocus:this.onFocus,onBlur:this.onBlur})}}var k=i(42190),B=i(29359),F=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};const{MATTERTAGS:U}=B.Z.WORKSHOP;let V=class EditableBillboardText extends n.Component{constructor(e){super(e),this.linkElement=null,this.onLabelEdit=e=>{this.handleTextChange("label",e)},this.onLabelKeyPress=e=>{if(e.keyCode===S.R.ESCAPE)return this.props.onNavigationKey(e);if(e.stopPropagation(),e.keyCode===S.R.TAB){const e=this.editableDescription.getInputDiv();e&&e.focus()}return!1},this.onDescriptionInput=e=>{const t=e.length;this.props.onDescriptionInput(0===t),this.setState({descriptionLength:t})},this.onDescriptionEdited=()=>{const e=this.editableDescription.getInputDiv();if(e){const t=M.v.serialize(e);this.handleTextChange("description",t)}},this.onLabelFocus=()=>{this.closePopover()},this.onDescriptionFocus=()=>{this.setState({editingDescription:!0})},this.onDescriptionBlur=()=>{this.setState({editingDescription:!1})},this.closePopover=()=>{this.setState({linkUrl:"",linkText:""}),this.linkElement=null,this.props.onClosePopover()},this.linkClicked=e=>{if(e.preventDefault(),this.props.linkEditorOpen)this.closePopover();else{e.stopPropagation(),this.linkElement=e.target;const{href:t,text:i}=this.linkElement;this.setState({linkUrl:t,linkText:i}),this.props.onClickLink()}},this.onRemoveLink=()=>{this.onSaveLink("","")},this.onSaveLink=(e,t)=>{this.linkElement?""!==t?(this.linkElement.href=t,this.linkElement.text=e):this.editableDescription.unlink(this.linkElement):this.editableDescription.linkify(e,t),this.closePopover(),this.onDescriptionEdited()},this.state={editingDescription:!1,descriptionLength:0,linkUrl:"",linkText:""}}componentWillMount(){this.updateDescriptionLength(this.props.description)}componentWillReceiveProps(e){e.description!==this.props.description&&this.updateDescriptionLength(e.description)}prepareNewLinkSelection(){const e=this.editableDescription.prepareLinkSelection();let t,i;return"string"==typeof e?(this.linkElement=null,t="",i=e):(this.linkElement=e,t=e.href,i=e.text),this.setState({linkUrl:t,linkText:i}),""!==i&&""===t}updateDescriptionLength(e){let t=0;const i=M.v.parse(e,!1);for(const e of i)e.blockType!==T.C.LINK&&e.blockType!==T.C.TEXT||(t+=e.text.length);this.setState({descriptionLength:t})}handleTextChange(e,t){this.props.modifyMattertag(this.props.id,{[e]:t}).then(this.props.onEdited)}render(){const{locale:e}=this.context,{linkUrl:t,linkText:i,editingDescription:o,descriptionLength:r}=this.state,{label:a,linkEditorOpen:l,onNavigationKey:c,description:h}=this.props,d=`${r}/1000`,u=e.t(U.TITLE_PLACEHOLDER),p=e.t(U.DESCRIPTION_PLACEHOLDER);return(0,n.h)("div",{class:"editable-text-content"},(0,n.h)("div",{class:"mattertag-label-editor"},(0,n.h)(I.Z,{text:a,placeholder:u,onEdited:this.onLabelEdit,onInput:this.onLabelEdit,onKeyPress:this.onLabelKeyPress,maxLength:60,closeOnFocusOut:!0,textarea:!0,fractionalCounter:!0,onStartEditing:this.onLabelFocus})),(0,n.h)("div",{class:"editable-tag-description"},(0,n.h)("div",{class:s("modifiable-text fractional-counter",{editing:o||l,empty:0===r}),"data-fractional-counter":d},(0,n.h)(EditableDescription,{ref:e=>this.editableDescription=e,maxLength:1e3,placeholder:p,description:h,onInput:this.onDescriptionInput,onFinalizeInput:this.onDescriptionEdited,onNavigationKey:c,onLinkClick:this.linkClicked,onFocus:this.onDescriptionFocus,onBlur:this.onDescriptionBlur}))),(0,n.h)(k.s,{linkUrl:t,linkText:i,onCancel:this.closePopover,onSaveLink:this.onSaveLink,onRemoveLink:this.onRemoveLink}))}};V=F([d.A],V);var H=i(80429),G=i(42733),z=i(79830),j=i(84245),W=i(90709),Z=i(62431);const{MATTERTAGS:q}=B.Z.WORKSHOP;class StemSlider extends n.Component{constructor(e){super(e),this.setStemValue=(e,t=!0)=>{const i=t?(0,W._F)(e):e;i!==this.props.stemHeight&&this.props.modifyMattertag(this.props.sid,{stemHeight:i}).then((()=>{this.props.onEdited()}))},this.onClickReset=()=>{this.slider&&(this.setStemValue(this.state.originalStemHeight,!1),this.slider.setValue((0,W.zy)(this.state.originalStemHeight)))},this.onToggleStemVisibility=()=>{this.props.modifyMattertag(this.props.sid,{stemVisible:!this.props.stemVisible}).then(this.props.onEdited)},this.stopPropagation=e=>{e.stopPropagation()},this.updateUnits=()=>{this.setState({units:this.context.settings.tryGetProperty(Z.gx.Units,Z.Mc.USFractional)})},this.formatStemHeight=e=>{if(this.state.units===Z.Mc.USFractional)return(0,j.KQ)(e);return`${Math.round(100*(0,W._F)(e))/100}m`},this.state={originalStemHeight:e.stemHeight,units:Z.Mc.USFractional}}componentWillMount(){this.updateUnits()}componentDidMount(){this.slider.setValue((0,W.zy)(this.props.stemHeight)),this.context.settings.onPropertyChanged(Z.gx.Units,this.updateUnits)}componentWillUnmount(){this.context.settings.removeOnPropertyChanged(Z.gx.Units,this.updateUnits)}render(){const{locale:e}=this.context,{stemVisible:t,stemHeight:i}=this.props,{originalStemHeight:o}=this.state,r=o!==i,a=e.t(q.STEM_SLIDER_RESET_CTA),l=e.t(q.SHOW_STEM_LABEL);return(0,n.h)("div",{class:"editable-popover stem-popover",onClick:this.stopPropagation},(0,n.h)(z.S,{ref:e=>this.slider=e,discrete:!1,min:0,max:9,initialValue:(0,W.zy)(i),onInput:this.setStemValue,displayBounds:!0,width:150,formatNumbers:this.formatStemHeight,tooltipPosition:z.h.DOWN}),(0,n.h)("div",{class:s("link-btn","popover-btn","stem-slider-reset",{disabled:!r}),onClick:this.onClickReset},a),(0,n.h)("hr",null),(0,n.h)("div",{class:"stem-checkbox",onClick:this.onToggleStemVisibility},(0,n.h)("div",{class:s("checkbox icon-checkmark",{checked:t})}),(0,n.h)("div",{class:"checkbox-text"},l)))}}var K=i(1402);const Y=["#d44441","#f44336","#e91e63","#f78da7","#9c4b92","#673ab7","#03687d","#03a9f4","#00bcd4","#417505","#51a868","#37d67a","#cddc39","#fbcd00","#ffac17","#ff6900","#abb8c3","#607d8b"];class DiscColorPicker extends n.Component{constructor(e){super(e),this.handleColorPicked=e=>{this.props.modifyMattertag(this.props.sid,{color:e}).then(this.props.onEdited)},this.stopPropagation=e=>{e.stopPropagation()}}render(){const{color:e}=this.props;return(0,n.h)("div",{class:"editable-popover color-editor",onClick:this.stopPropagation},(0,n.h)(K.z,{colors:Y,defaultColor:e,onColorPicked:this.handleColorPicked}))}}var $=i(47133),X=i(14071);const{MATTERTAGS:Q}=B.Z.WORKSHOP;var J;!function(e){e[e.NONE=0]="NONE",e[e.INVALID_URL_SYNTAX=1]="INVALID_URL_SYNTAX",e[e.LOADING=2]="LOADING",e[e.LOADED=3]="LOADED",e[e.ERROR=4]="ERROR"}(J||(J={}));class MediaLinkInput extends n.Component{constructor(e){super(e),this.onInput=e=>{const t=(0,L.j)(e)?J.NONE:J.INVALID_URL_SYNTAX;this.setState({validationPhase:t,currentUrl:e})},this.onApply=e=>{e.target.classList.contains("disabled")||this.onChangeMedia(this.state.currentUrl)},this.stopPropagation=e=>{e.stopPropagation()},this.onChangeMedia=async e=>{const{sid:t,mediaSrc:i,onEdited:n}=this.props;if(e!==i){const i=await this.loadMedia(e);i!==p.z.error?(await this.props.modifyMattertag(t,{mediaSrc:e,mediaType:i}),this.setState({validationPhase:J.LOADED}),n()):this.setState({validationPhase:J.ERROR})}else this.props.onCancel()},this.loadMedia=async e=>{let t=p.z.none;return this.setState({validationPhase:J.NONE}),e&&(this.setState({validationPhase:J.LOADING}),t=await this.props.embedlyValidator.getType(e)),t},this.state={currentUrl:e.mediaSrc,validationPhase:this.getInitialValidationPhase()}}getInitialValidationPhase(){return this.props.mediaType===p.z.error?J.ERROR:this.props.mediaSrc?J.LOADED:J.NONE}componentWillReceiveProps(e){this.state.currentUrl!==e.mediaSrc&&this.setState({currentUrl:e.mediaSrc})}render(){const{locale:e}=this.context,{mediaSrc:t,onCancel:i}=this.props,s=e.t(Q.MEDIA_LINK_LABEL),o=e.t(Q.MEDIA_LINK_SUPPORTED_FORMATS_LINK);return(0,n.h)("div",{class:"annotation-popup open media-editor",onClick:this.stopPropagation},(0,n.h)("div",{class:"popover-header"},(0,n.h)("div",{class:"popover-label"},s,(0,n.h)("a",{class:"link",target:"_blank",href:MediaLinkInput.supportPage},o)),(0,n.h)(X.P,{buttonStyle:X.A.LIGHT,onClose:i})),(0,n.h)($.Z,{text:t,type:"url",placeholder:"https://",onDone:this.onChangeMedia,onInput:this.onInput}),this.renderPopoverFooter())}renderPopoverFooter(){const{locale:e}=this.context,{mediaSrc:t}=this.props,{validationPhase:i,currentUrl:s}=this.state,o=i===J.ERROR||i===J.LOADING||i===J.INVALID_URL_SYNTAX&&""!==s||s===t&&""===s?G.BN.DISABLED:G.BN.ENABLED,r=e.t(Q.MEDIA_LINK_APPLY_CTA);return(0,n.h)("div",{class:"popover-footer"},this.renderValidationMessage(),(0,n.h)(G.zx,{appendClass:{"button-inline":!0},buttonStyle:G.ZJ.CLEAR,buttonSize:G.qE.SMALL,buttonState:o,onClick:this.onApply},r))}renderValidationMessage(){const{locale:e}=this.context;switch(this.state.validationPhase){case J.ERROR:return(0,n.h)("div",{class:"popover-message popover-message-error"},e.t(Q.MEDIA_LINK_ERROR_MESSAGE),(0,n.h)("a",{class:"link",target:"_blank",href:MediaLinkInput.supportPage},e.t(Q.MEDIA_LINK_HELP_LINK)));case J.LOADING:return(0,n.h)("div",{class:"popover-message"},e.t(Q.MEDIA_LINK_LOADING_MESSAGE));case J.INVALID_URL_SYNTAX:if(""!==this.state.currentUrl)return(0,n.h)("div",{class:"popover-message popover-message-error"},e.t(Q.MEDIA_LINK_INVALID_URL_MESSAGE))}return(0,n.h)("div",{class:"popover-message"})}}MediaLinkInput.supportPage="https://support.matterport.com/hc/en-us/articles/115006363868-Add-Multimedia-to-a-Mattertag-Post";var ee=i(26265),te=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};const{MATTERTAGS:ie}=B.Z.WORKSHOP;var ne;!function(e){e.COLOR="color",e.STEM="stem",e.MEDIA="media",e.LINK="text-link"}(ne||(ne={}));let se=class EditableBillboardContent extends n.Component{constructor(e){super(e),this.getColorStyle=()=>{const e=this.props.getSavedData().color;if(e)return"background-color: "+e},this.toggleVisibility=()=>{const{id:e,manager:t}=this.props;this.closePopover();const i={visible:!this.state.currentValues.visible};t.modifyMattertag(e,i).then(this.onEdited)},this.onEdited=()=>{const e=this.props.getSavedData();e&&this.setState({currentValues:e,tagEmpty:this.props.manager.isTagEmpty(this.props.id)})},this.onMediaEdited=()=>{this.onEdited(),this.closePopover()},this.onMediaCancel=()=>{this.closePopover()},this.cancelEdits=()=>{this.props.manager.revertChanges()},this.doneEditing=()=>{const{manager:e,id:t}=this.props;e.saveMattertag(t)},this.onAddLinkClicked=e=>{if(e.stopPropagation(),this.state.popover===ne.LINK)this.closePopover();else if(this.state.linkCount<5){const e=this.billboardText.prepareNewLinkSelection();this.openLinkEditor(e)}},this.onClickLink=()=>{this.openLinkEditor(!1)},this.onDescriptionInput=e=>{const t=this.props.getSavedData(),i=(0,E.Yv)(t.label)&&(0,E.Yv)(t.mediaSrc)&&e;this.updateLinkCount(this.props.description),this.setState({tagEmpty:i})},this.onNavigationKey=e=>{e.keyCode===S.R.ESCAPE&&this.cancelEdits()},this.billboardClick=e=>{e.stopPropagation(),this.closePopover()},this.closePopover=()=>{const{popover:e}=this.state;null!==e&&this.setPopover(e,!1)},this.clickOnBackground=e=>{this.closePopover(),e.stopPropagation()},this.setBillboardTextRef=e=>{this.billboardText=e};const t=e.getSavedData();this.state={popover:null,linkCount:0,currentValues:Object.assign({},t),tagEmpty:e.manager.isTagEmpty(e.id)},this.clickColor=this.clickMenuIcon.bind(this,ne.COLOR),this.clickStem=this.clickMenuIcon.bind(this,ne.STEM),this.clickMedia=this.clickMenuIcon.bind(this,ne.MEDIA)}componentDidMount(){this.context.analytics.track("workshop_gui",{gui_action:"mattertag_editor_opened"}),this.updateLinkCount(this.props.description)}componentDidUpdate(e,t){const i=this.props.manager.dataMap.mattertagsViewData.toolState;t.tagEmpty&&!this.state.tagEmpty&&i===a.rI.PLACED&&this.props.manager.dataMap.mattertagsViewData.setToolState(a.rI.EDITING),this.updateLinkCount(this.props.description)}setPopover(e,t){const i=this.state.popover,n=t?e:null;i!==n&&i===ne.LINK&&this.context.messageBus.broadcast(new w.Z),this.setState({popover:n})}openLinkEditor(e){this.setPopover(ne.LINK,!0),this.context.messageBus.broadcast(new w.g(e))}updateLinkCount(e){let t=0;const i=M.v.parse(e,!1);for(const e of i)e.blockType===T.C.LINK&&t++;this.setState({linkCount:t})}clickMenuIcon(e,t){t.stopPropagation(),this.setPopover(e,this.state.popover!==e)}render(){const{locale:e}=this.context,{tagEmpty:t,popover:i}=this.state,{fullSized:o}=this.props,r=null!==i,a=i===ne.LINK||i===ne.MEDIA,l=e.t(ie.EDIT_BILLBOARD_CANCEL_CTA),c=e.t(ie.EDIT_BILLBOARD_DONE_CTA);return(0,n.h)("div",{class:s("editable-billboard-body",{"full-sized":o,"popover-open":r,"url-popover-open":a}),onClick:this.clickOnBackground},(0,n.h)("div",{class:"editable-billboard-content",onClick:this.billboardClick},this.renderTextContent(),this.renderMattertagMedia(),this.renderActivePopover()),(0,n.h)("div",{class:"billboard-footer",onClick:this.billboardClick},this.renderMenuItems(),(0,n.h)("div",{class:"billboard-cta"},(0,n.h)(G.zx,{buttonStyle:G.ZJ.CLEAR,buttonSize:G.qE.SMALL,appendClass:{"button-inline":!0},onClick:this.cancelEdits},l),(0,n.h)(G.zx,{appendClass:{"button-inline":!0},buttonStyle:G.ZJ.CLEAR,buttonSize:G.qE.SMALL,buttonState:t?G.BN.DISABLED:G.BN.ENABLED,onClick:this.doneEditing},c))))}renderActivePopover(){const{id:e,manager:t}=this.props,{popover:i,currentValues:s}=this.state,{stemVisible:o,stemHeight:r,color:a,mediaSrc:l,mediaType:c}=s;switch(i){case ne.STEM:return(0,n.h)(StemSlider,{sid:e,stemVisible:o,stemHeight:r,onEdited:this.onEdited,modifyMattertag:t.modifyMattertag});case ne.COLOR:return(0,n.h)(DiscColorPicker,{sid:e,color:a,onEdited:this.onEdited,modifyMattertag:t.modifyMattertag});case ne.MEDIA:return(0,n.h)(MediaLinkInput,{sid:e,mediaSrc:l,mediaType:c,embedlyValidator:this.props.embedlyValidator,onEdited:this.onMediaEdited,onCancel:this.onMediaCancel,modifyMattertag:t.modifyMattertag});default:return null}}renderMenuItems(){const{locale:e}=this.context,{manager:t,id:i,fullSized:s}=this.props,{popover:o,currentValues:r,linkCount:a}=this.state,{visible:l}=r,c=t.isNewTag(i),h=o===ne.COLOR,d=o===ne.STEM,u=o===ne.MEDIA,p=o===ne.LINK,m=a<5,g=e.t(m?ie.LINK_TOOLTIP_MESSAGE:ie.LINK_DISABLED_TOOLTIP_MESSAGE),f=s?ee.lZ.UP:ee.lZ.DOWN,v=p?G.BN.ACTIVE:m?G.BN.ENABLED:G.BN.DIMMED;return(0,n.h)("div",{class:"billboard-menu"},(0,n.h)(H.h,{iconClass:"icon-link",appendClass:{"billboard-menu-item":!0,"add-link":!0},buttonState:v,buttonStyle:H.D.CLEAR,onClick:this.onAddLinkClicked,tooltipMsg:p?void 0:g,tooltipPosition:f}),(0,n.h)(H.h,{appendClass:{"billboard-menu-item":!0,color:!0},buttonStyle:H.D.CLEAR,buttonState:h?G.BN.ACTIVE:G.BN.ENABLED,onClick:this.clickColor,tooltipMsg:h?void 0:e.t(ie.COLOR_TOOLTIP_MESSAGE),tooltipPosition:f},(0,n.h)("span",{class:"color-dot",style:this.getColorStyle()})),(0,n.h)(H.h,{iconClass:"icon-stem-height",appendClass:{"billboard-menu-item":!0,stem:!0},buttonStyle:H.D.CLEAR,buttonState:d?G.BN.ACTIVE:G.BN.ENABLED,onClick:this.clickStem,tooltipMsg:d?void 0:e.t(ie.STEM_TOOLTIP_MESSAGE),tooltipPosition:f}),(0,n.h)(H.h,{iconClass:"icon-media-mix",appendClass:{"billboard-menu-item":!0,media:!0},buttonStyle:H.D.CLEAR,buttonState:u?G.BN.ACTIVE:G.BN.ENABLED,onClick:this.clickMedia,tooltipMsg:u?void 0:e.t(ie.MEDIA_TOOLTIP_MESSAGE),tooltipPosition:f}),!c&&(0,n.h)(H.h,{iconClass:l?"icon-eye-hide":"icon-eye-show",appendClass:{"billboard-menu-item":!0},buttonStyle:H.D.CLEAR,onClick:this.toggleVisibility,tooltipMsg:e.t(l?ie.HIDE_TOOLTIP_MESSAGE:ie.SHOW_TOOLTIP_MESSAGE),tooltipPosition:f}))}renderTextContent(){const{popover:e}=this.state,{id:t,label:i,description:s,manager:o}=this.props,r=e===ne.LINK;return(0,n.h)(V,{id:t,ref:this.setBillboardTextRef,label:i,description:s,linkEditorOpen:r,onClickLink:this.onClickLink,onClosePopover:this.closePopover,onDescriptionInput:this.onDescriptionInput,onNavigationKey:this.onNavigationKey,onEdited:this.onEdited,modifyMattertag:o.modifyMattertag})}renderMattertagMedia(){const{id:e,mediaType:t,closing:i,media:{hasMedia:s,mediaPayload:o},mediaAspectRatio:r}=this.props;return s?o?(0,n.h)(D,{key:e,mediaPayload:o,mediaType:t,mediaAspectRatio:r,closing:i}):(0,n.h)("div",{class:"loadingSpinner"},(0,n.h)("div",{class:"gui-spinner-icon"})):null}};se=te([d.Z],se);var oe=i(46162);class MouseThrough extends n.Component{constructor(e){super(e),this.eventsToSend={[MouseThrough.SendEvent.HOVER]:!1,[MouseThrough.SendEvent.CLICK]:!1,[MouseThrough.SendEvent.BUTTON]:!1},this.setRef=e=>this.mouseThroughElement=e,this.onHoverEvent=e=>{switch(e.type){case"mousemove":this.props.onMouseMove&&this.props.onMouseMove(e);break;case"mouseenter":this.props.onMouseEnter&&this.props.onMouseEnter(e);break;case"mouseleave":this.props.onMouseLeave&&this.props.onMouseLeave(e);break;case"pointermove":this.props.onMouseMove&&this.props.onMouseMove(e);break;case"pointerenter":this.props.onMouseEnter&&this.props.onMouseEnter(e);break;case"pointerleave":this.props.onMouseLeave&&this.props.onMouseLeave(e)}this.eventsToSend[MouseThrough.SendEvent.HOVER]&&this.isValidTarget(e.target)&&this.sendEventThrough(e.type,e)},this.isValidTarget=e=>e===this.mouseThroughElement||this.props.includeChildrenEvents&&e.compareDocumentPosition(this.mouseThroughElement)&Node.DOCUMENT_POSITION_CONTAINS,this.onClick=e=>{this.props.onClick&&this.props.onClick(e),this.eventsToSend[MouseThrough.SendEvent.CLICK]&&this.isValidTarget(e.target)&&(this.sendEventThrough("mousedown",e),window.setTimeout((()=>this.sendEventThrough("mouseup",e)),0))},this.onButtonEvent=e=>{switch(e.type){case"pointerdown":this.props.onPointerDown&&this.props.onPointerDown(e);break;case"pointerup":this.props.onPointerUp&&this.props.onPointerUp(e)}this.eventsToSend[MouseThrough.SendEvent.BUTTON]&&this.isValidTarget(e.target)&&this.sendEventThrough(e.type,e)},this.onClick=this.onClick.bind(this),this.target=e.clickTarget||document.getElementsByTagName("canvas")[0],this.registerEvents()}componentWillReceiveProps(e){(0,oe.NK)(this.props.sendEvents,e.sendEvents)&&this.registerEvents()}render(){return(0,n.h)("div",{id:this.props.id,ref:this.setRef,class:this.props.className,style:this.props.style||{},onMouseEnter:this.onHoverEvent,onMouseLeave:this.onHoverEvent,onMouseMove:this.onHoverEvent,onPointerEnter:this.onHoverEvent,onPointerLeave:this.onHoverEvent,onPointerMove:this.onHoverEvent,onMouseDown:this.onButtonEvent,onMouseUp:this.onButtonEvent,onPointerDown:this.onButtonEvent,onPointerUp:this.onButtonEvent,onClick:this.onClick},this.props.children)}registerEvents(){this.props.sendEvents.length&&(this.eventsToSend[MouseThrough.SendEvent.CLICK]=this.props.sendEvents.indexOf(MouseThrough.SendEvent.CLICK)>-1,this.eventsToSend[MouseThrough.SendEvent.HOVER]=this.props.sendEvents.indexOf(MouseThrough.SendEvent.HOVER)>-1,this.eventsToSend[MouseThrough.SendEvent.BUTTON]=this.props.sendEvents.indexOf(MouseThrough.SendEvent.BUTTON)>-1)}sendEventThrough(e,t){let i;try{i=window.PointerEvent?new PointerEvent(e,t):new MouseEvent(e,t)}catch(n){i=document.createEvent("MouseEvents");const s=t.view;if(!s)return;i.initMouseEvent(e,t.bubbles,t.cancelable,s,t.detail,t.screenX,t.screenY,t.clientX,t.clientY,t.ctrlKey,t.altKey,t.shiftKey,t.metaKey,t.button,t.relatedTarget)}this.target.dispatchEvent(i)}}!function(e){let t;!function(e){e[e.HOVER=1]="HOVER",e[e.CLICK=2]="CLICK",e[e.BUTTON=3]="BUTTON"}(t=e.SendEvent||(e.SendEvent={}))}(MouseThrough||(MouseThrough={}));var re=i(45296),ae=i(39936),le=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};const ce=new m.Z("mattertag-description");let he=class MattertagDescription extends n.Component{constructor(e){super(e),this.formatLink=(e,t)=>de(e,t,!1),this.linkClicked=e=>t=>{if(t.preventDefault(),this.props.onLinkClick(e),void 0===e.link)return;switch(e.link.type){case re.U.NAVIGATION:this.props.navigationTagClicked(e);break;case re.U.MODEL:window.location.replace(e.link.url);break;case re.U.EXT_LINK:const t=1===this.embeddedlinks;t?window.requestAnimationFrame((()=>{try{const t=window.open(e.link.url,"mattertagEmb");t&&t.focus()}catch(t){ce.debug(`Could not load the link within an iFrame! Error: ${t}`),window.open(e.link.url)}})):window.open(e.link.url),this.context.messageBus.broadcast(new c.Ik(e.link.url,t))}}}async componentDidMount(){this.settings=await this.context.market.waitForData(ae.e),this.embeddedlinks=this.settings.tryGetProperty("emb",0)}render(){const{description:e,parsedDescription:t}=this.props;let i=e;return t&&t.length>0&&(i=ue(t,this.formatLink,this.linkClicked)),i?(0,n.h)("div",{className:"tag-description"},i):null}};he=le([d.Z],he);const de=(e,t,i)=>{if(!e.link)return null;const s=e.link,o=s.type===re.U.NAVIGATION?"Link to position within this model":"Link to external web site";return(0,n.h)("a",{className:"link-url",contentEditable:i,href:s.url,onClick:t(e)},s.label,(0,n.h)("i",{class:"icon-ext-link",title:o}))},ue=(e,t,i)=>e.map((e=>{switch(e.type){case p.z.link:if(e.link)return t(e,i);case p.z.text:return(e.text||"").replace("&zwnj;","")}return null}));var pe=i(58091),me=i(95843),ge=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};const fe=b.l7+3*b.qS,ve=6*b.XJ+fe,ye=3*b.XJ+b.qS;let be=class MattertagTextContent extends n.Component{constructor(e){super(e),this.state={height:null,descriptionHeight:0,scrollable:!1,determiningScrollability:!1,scrollClass:me.Ij.None},this.onScrollPositionChange=()=>{if(!this.scrollbars||this.state.determiningScrollability)return;const e=this.scrollbars.scrollPosition.vertical;this.setState({scrollClass:e})}}componentWillReceiveProps(e){e.tagWidth!==this.props.tagWidth&&this.setState({height:null,scrollable:!0,determiningScrollability:!0})}componentDidMount(){this.determineScrollability()}componentDidUpdate(){this.state.determiningScrollability&&this.determineScrollability()}determineScrollability(){const e=this.textContainer&&this.textContainer.querySelector(".tag-description");let t={determiningScrollability:!1};if(this.props.description&&e){const i=this.props.mediaTag?ye:ve;if(e.scrollHeight>i+b.J6){const e=this.textContainer&&this.textContainer.querySelector(".tag-label"),n=this.props.label?i+e.scrollHeight-b.qS:i;t=Object.assign(Object.assign({},t),{height:n,scrollable:!0,scrollClass:me.Ij.Beginning})}else t=Object.assign(Object.assign({},t),{height:null,scrollable:!1,scrollClass:me.Ij.None})}this.setState(t)}render(){const{label:e,description:t,parsedDescription:i,onLinkClick:o,navigationTagClicked:r}=this.props;if(e||t||i){const a=s({"tag-text-content":!0,noScroll:!this.state.height||!this.state.scrollable,[this.state.scrollClass]:!0});return(0,n.h)("div",{class:a,style:{height:this.state.scrollable&&this.state.height||"auto"},ref:e=>{this.textContainer=e}},(0,n.h)(pe.Z,{name:"mattertag-text-content",forceHidden:!1,waitToUpdate:this.state.determiningScrollability,singleScrollDirection:me.Nm.vertical,ref:e=>this.scrollbars=e,onScrollPositionChange:this.onScrollPositionChange},e&&(0,n.h)("div",{class:"tag-label",onClick:this.onBoundClick},(0,n.h)("span",null,e)),(0,n.h)(he,{description:t,parsedDescription:i,onLinkClick:o,navigationTagClicked:r})))}return null}};be=ge([d.Z],be);const we=be;var Se=i(252),Ee=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let Te=class ReadonlyBillboardContent extends n.Component{constructor(e){super(e),this.clickBillboard=()=>{this.props.onClickBillboard()},this.onClickImage=()=>{this.props.allowTagOverlay?this.props.onOpenOverlay():this.props.onClickBillboard()}}render(){const{media:e,style:t,selected:i,allowTagOverlay:o,label:r,description:a,parsedDescription:l}=this.props;return(0,n.h)("div",{class:s("billboard-body",{expandable:o}),onClick:this.clickBillboard},(0,n.h)("div",{className:"billboard-content",style:t.bodyStyle},(0,n.h)(we,{label:r,description:a,parsedDescription:l,tagWidth:t.width,imgHeight:t.height,mediaTag:e.hasMedia,onLinkClick:this.props.onLinkClick,navigationTagClicked:this.props.navigationTagClicked}),this.renderMattertagMedia(),this.renderCustomWidget()),!i&&(0,n.h)(MouseThrough,{sendEvents:[MouseThrough.SendEvent.BUTTON],className:"hover-arrow"}))}renderMattertagMedia(){const{id:e,allowTagOverlay:t,mediaType:i,style:{width:s,height:o,closing:r},media:{hasMedia:a,mediaPayload:l}}=this.props;return a?l?(0,n.h)(D,{key:e,mediaPayload:l,mediaType:i,width:s,height:o,onClickImage:t?this.onClickImage:void 0,closing:r}):(0,n.h)("div",{class:"loadingSpinner"},(0,n.h)("div",{class:"gui-spinner-icon"})):null}renderCustomWidget(){if(this.props.customWidget)return(0,n.h)(Se.l,{widget:this.props.customWidget})}};Te=Ee([d.A],Te);var Me=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};const _e=b.J6+b.l7+b.qS;let xe=class MattertagOverlay extends n.Component{constructor(e){super(e),this.toggleCollapseText=()=>{this.setState((e=>({collapsed:!e.collapsed})))},this.onScrollPositionChange=()=>{if(!this.scrollbars||this.state.determiningScrollability)return;const e=this.scrollbars.scrollPosition.vertical;this.setState({scrollClass:e})},this.updateScrollAndCollapse=()=>{const e=this.textContainer?this.textContainer.scrollHeight:0,t=this.textContainer&&this.textContainer.querySelector(".tag-description");let i={determiningScrollability:!1};if(e){const n=Math.max(e-_e-this.state.overlayHeight,0),s=n>0,o=e-n,r=t&&t.scrollHeight-n,a=s?me.Ij.Beginning:me.Ij.None,l=t&&e>_e;i=Object.assign(Object.assign({},i),{height:o,scrollable:s,descriptionHeight:r,scrollClass:a,collapsible:l})}this.setState(i)},this.updateOverlayDimensions=()=>{const{label:e,description:t,maxWidth:i,maxHeight:n,mediaAspectRatio:s}=this.props,o=e||t?_e:0,r=i-2*b.J6,a=n-2*b.J6-o,l=s<r/a;this.setState({overlayWidth:l?a*s:r,overlayHeight:l?a:r/s})},this.stopPropagation=e=>{e.stopPropagation()},this.state={overlayWidth:0,overlayHeight:0,collapsible:!!(e.description&&e.description.length>0),collapsed:!1,height:null,descriptionHeight:0,scrollable:!1,determiningScrollability:!1,scrollClass:me.Ij.None}}componentDidMount(){this.updateOverlayDimensions(),this.updateScrollAndCollapse()}componentDidUpdate(e,t){const i=e.mediaAspectRatio!==this.props.mediaAspectRatio,n=e.maxWidth!==this.props.maxWidth,s=e.maxHeight!==this.props.maxHeight;(i||n||s)&&(this.setState({determiningScrollability:!0,scrollable:!1,scrollClass:me.Ij.None,height:0}),window.requestAnimationFrame((()=>{this.updateOverlayDimensions(),this.updateScrollAndCollapse()})))}render(){const{mediaPayload:e,mediaType:t,closing:i}=this.props,{overlayWidth:o,overlayHeight:r,collapsible:a}=this.state;return(0,n.h)("div",{class:"billboard-body",onClick:this.stopPropagation},(0,n.h)("div",{className:s("billboard-content",{collapsible:a})},this.renderOverlayText(),(0,n.h)(D,{mediaPayload:e,mediaType:t,width:o,height:r,closing:i})))}renderOverlayText(){const{label:e,description:t,parsedDescription:i,onLinkClick:o,navigationTagClicked:r,closeImageOverlay:a}=this.props,{collapsible:l,collapsed:c,descriptionHeight:h,scrollable:d,height:u,determiningScrollability:p,scrollClass:m}=this.state,g=p||c?void 0:{maxHeight:u+"px"},f={};return t&&u&&d&&(f.height=h+"px",f.overflow="hidden"),(0,n.h)("div",{class:s("tag-text-content",{collapsed:c,noScroll:!u||!d}),style:g,ref:e=>{this.textContainer=e}},e&&(0,n.h)("div",{class:"tag-label",onClick:this.toggleCollapseText},(0,n.h)("div",{class:"labelText"},e)),t&&(0,n.h)("div",{style:f,class:s(m,"wrappedDesc")},(0,n.h)(pe.Z,{name:"mattertag-overlay-text",forceHidden:!1,waitToUpdate:p,singleScrollDirection:me.Nm.vertical,ref:e=>this.scrollbars=e,onScrollPositionChange:this.onScrollPositionChange},(0,n.h)("div",null,(0,n.h)(he,{description:t,parsedDescription:i,onLinkClick:o,navigationTagClicked:r})))),(0,n.h)("div",{class:"buttons"},l&&(0,n.h)(H.h,{appendClass:{"tag-button":!0,"tag-collapse-button":!0},iconClass:"icon-dpad-down",onClick:this.toggleCollapseText}),(0,n.h)(H.h,{appendClass:{"tag-button":!0},iconClass:"icon-close",onClick:a})))}};xe=Me([d.Z],xe);const Ae=xe;var Oe,Pe=i(91172),Ce=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};const De=new m.Z("billboard");var Ie;!function(e){e[e.NOT_LOADED=0]="NOT_LOADED",e[e.LOADING=1]="LOADING",e[e.LOADED=2]="LOADED",e[e.FAILED=3]="FAILED",e[e.ENABLED=4]="ENABLED"}(Ie||(Ie={}));let Re=Oe=class Billboard extends n.Component{constructor(e,t){super(e),this.linkCount=0,this.linksClicked=[],this.linkEditorOpened=()=>this.setState({expanded:!0}),this.linkEditorClosed=()=>this.setState({expanded:!1}),this.getSavedData=()=>{const{label:e,description:t,mediaSrc:i,mediaType:n,stemVisible:s,enabled:o}=this.props.tag,{stemHeight:r,color:a}=this.props.view;return{visible:o,color:a,label:e,description:t,stemHeight:r,mediaSrc:i,mediaType:n,stemVisible:s}},this.updateBillboardSize=()=>{const{mediaWidth:e,mediaHeight:t}=this.state,{tag:i}=this.props;if(this.adjustSizing(),i.mediaType===p.z.photo||i.mediaType===p.z.rich||i.mediaType===p.z.video){const n=this.getDimensionsForMedia(i.mediaType,e,t);this.setState(Object.assign({},n))}},this.closeImageOverlay=()=>{const{overlay:e,toggleImageOverlay:t,tag:i}=this.props;e&&t(i.sid,!1)},this.onOpenOverlay=()=>{const{toggleImageOverlay:e,allowTagOverlay:t,tag:i}=this.props;t&&e(i.sid,!0)},this.onBillboardClicked=()=>{const{manager:e,toolOpen:t,tag:i,selected:n}=this.props;t&&e&&!n&&e.selectMattertag(i.sid)},this.setBillboardRef=e=>{this.billboardRef=e},this.updateTagDirection=()=>{const{direction:e}=this.state,{getTagContainer:t,tag:i}=this.props,{navigating:n,navigatingPosition:s,position:o,onTagDirectionChanged:r}=this.props.view,a=t();if(!a)return;const[l,c]=[a.offsetWidth,a.offsetHeight];let h;h=n&&s?Oe.getTagDirection(s.x,s.y,l,c):o?Oe.getTagDirection(o.x,o.y,l,c):Oe.getTagDirection(0,0,l,c),h!==e&&(r(i.sid,h),this.setState({direction:h}))},this.onLinkClick=e=>{if(void 0===e.link)return;-1===this.linksClicked.indexOf(e.link)&&this.linksClicked.push(e.link);const t=e.link.type;this.linkCount++,this.context.analytics.track("click_mattertag_link",{link_type:t,link_count:this.linkCount,links_clicked:this.linksClicked.length})};const i=this.getDimensionsForMedia(e.tag.mediaType,1024,1024);this.embedly=new Embedly(t.settings.getProperty(Pe.lc)),this.state={width:i.width,height:190,fullSized:!1,expanded:!1,mediaWidth:0,mediaHeight:0,mediaPayload:null,landscape:!1,active:!1,mediaLoadingState:e.mediaEnabled?Ie.NOT_LOADED:Ie.ENABLED,savedData:this.getSavedData(),direction:void 0};const n=e.tag,s=new R.gm((()=>({})),(e=>{n.onPropertyChanged("mediaSrc",e),n.onPropertyChanged("mediaType",e)}),(e=>{n.removeOnPropertyChanged("mediaSrc",e),n.removeOnPropertyChanged("mediaType",e)}));this.tagOnChangedSub=s.createSubscription((()=>{this.loadMedia(!0)}),!1),this.updateTagDirection()}componentDidMount(){const{view:e,manager:t}=this.props;this.loadMedia(),!e.located||e.navigating&&!e.navigatingPosition||this.setState({active:!0}),window.addEventListener("resize",this.updateBillboardSize),t&&(this.context.messageBus.subscribe(w.g,this.linkEditorOpened),this.context.messageBus.subscribe(w.Z,this.linkEditorClosed)),this.adjustSizing(),this.tagOnChangedSub.renew()}componentWillUnmount(){this.tagOnChangedSub.cancel(),this.props.manager&&(this.context.messageBus.unsubscribe(w.g,this.linkEditorOpened),this.context.messageBus.unsubscribe(w.Z,this.linkEditorClosed)),this.state.fullSized&&this.context.messageBus.broadcast(new c.vE(!1)),window.removeEventListener("resize",this.updateBillboardSize)}componentDidUpdate(e,t){const{manager:i,editing:n,tag:s,view:o,overlay:r}=this.props,{active:a}=this.state;if(i===e.manager||e.manager||(this.context.messageBus.subscribe(w.g,this.linkEditorOpened),this.context.messageBus.subscribe(w.Z,this.linkEditorClosed)),n===e.editing&&r===e.overlay||this.updateBillboardSize(),o.closeTheTag||s&&s.mediaSrc!==e.tag.mediaSrc&&this.loadMedia(!0),a||e.view.navigatingPosition===o.navigatingPosition||this.updateTagDirection(),o.closeTheTag)a&&this.setState({active:!1});else if(a||!o.located||o.navigating&&!o.navigatingPosition||this.setState({active:!0}),n&&(!e.editing||null===this.state.savedData)){const e=this.getSavedData();e&&this.setState({savedData:e})}}loadMedia(e=!1){const{mediaType:t,mediaSrc:i}=this.props.tag,{mediaLoadingState:n}=this.state;if(Oe.isMediaTag(t)&&(e||![Ie.LOADING,Ie.FAILED,Ie.ENABLED].includes(n)))return this.setState({mediaLoadingState:Ie.LOADING}),this.embedly.getMediaDetails(t,i).then((e=>{if(e&&this.billboardRef){const i=this.getDimensionsForMedia(t,e.width,e.height);this.setState(Object.assign(Object.assign({},i),{mediaWidth:e.width,mediaHeight:e.height,mediaPayload:e.embedlyResponse,mediaLoadingState:Ie.LOADED}))}})).catch((e=>{if(De.debug(e),this.billboardRef){const e=this.getDimensionsForMedia(p.z.text,1024,1024);this.setState(Object.assign(Object.assign({},e),{mediaLoadingState:Ie.FAILED}))}}))}adjustSizing(){const e=this.props.editing&&(window.innerWidth<=b.NE||window.innerHeight<=b.vR);e!==this.state.fullSized&&(this.context.messageBus.broadcast(new c.vE(e)),this.setState({fullSized:e}))}getDimensionsForMedia(e,t,i){if(e===p.z.text||e===p.z.none||e===p.z.error)return{width:b.Z-b.J6,height:0,landscape:!1};const{getTagContainer:n,editing:s,overlay:o}=this.props;let r=t,a=i;const l=Math.max(t,1)/Math.max(i,1),c=n();if(c)if(o)r=c.offsetWidth,a=c.offsetHeight;else{const i=e===p.z.photo;let n;n=s?i?b.l$:b.Le:b.QH;const o=c.offsetWidth-b.kn,h=c.offsetHeight-n;r=i?l>1?Math.max(Math.min(t,b.Hj,o),b.Z):Math.max(Math.min(t,b.Cz),b.dI):Math.max(Math.min(t,b.QI,o),b.Z),a=r/l,a>h&&(a=h,r=a*l)}return{width:r,height:a,landscape:l>1}}render(){const{overlay:e,editing:t,view:i,tag:o}=this.props,{closeTheTag:r}=i,{sid:a,mediaType:l,label:c,description:h}=o,{landscape:d,mediaLoadingState:u,active:m,direction:g,fullSized:f,expanded:v}=this.state,y=Oe.isMediaTag(l)&&u!==Ie.FAILED&&u!==Ie.ENABLED,b=u===Ie.LOADING&&l===p.z.photo,w=t||e?void 0:this.getTagPositionStyle(),S=t||e||!g?void 0:"tag"+g.trim().replace(/([A-Z])/g,"-$1").replace(/[-_\s]+/g,"-").toLowerCase();const E=this.isImageTag(),T=y&&l===p.z.video,M=y&&(l===p.z.rich||b),_=T||M||E,x=c.length>0||h.length>0;return(0,n.h)("div",{className:s("tag-position",{"billboard-standard-view":!t&&!e,"billboard-overlay":e,"billboard-editing":t,"media-only-mattertag":!x&&_,"media-mattertag":_,"video-mattertag":T,"embed-mattertag":M,"image-mattertag":E,"full-sized":f,"link-popover-expanded":v}),key:a,style:w},(0,n.h)("div",{className:s("tag-wrapper",{active:!r&&m})},(0,n.h)("div",{ref:this.setBillboardRef,className:s("tag-container",[S],{"media-landscape":_&&d,"media-portrait":_&&!d}),onClick:this.closeImageOverlay},this.renderBillboard(y))))}renderBillboard(e){const{mediaPayload:t,width:i,height:s,savedData:o,fullSized:r,mediaWidth:a,mediaHeight:l}=this.state,{onNavigationLinkClicked:c,overlay:h,selected:d,view:u,tag:p,allowTagOverlay:m}=this.props,g=l>0?a/l:void 0;if(h&&g){const{label:e,description:o,parsedDescription:r,mediaType:a}=p;return(0,n.h)(Ae,{label:e,description:o,parsedDescription:r,mediaPayload:t,mediaType:a,maxWidth:i,maxHeight:s,mediaAspectRatio:g,closing:u.closeTheTag,closeImageOverlay:this.closeImageOverlay,onLinkClick:this.onLinkClick,navigationTagClicked:c})}{const{sid:a}=p,l={mediaPayload:t,hasMedia:e},h=e&&!t?{width:i+"px"}:{},{editing:f,manager:v}=this.props;if(f&&v)return(0,n.h)(se,{id:a,getSavedData:this.getSavedData,manager:v,fullSized:r,mediaAspectRatio:g,media:l,mediaType:p.mediaType,closing:u.closeTheTag,label:p.label,description:p.description,originalValues:o,embedlyValidator:this.embedly});{const e={width:i,height:s,bodyStyle:h,closing:u.closeTheTag};return(0,n.h)(Te,{id:a,allowTagOverlay:m,selected:d,style:e,onClickBillboard:this.onBillboardClicked,onOpenOverlay:this.onOpenOverlay,onLinkClick:this.onLinkClick,navigationTagClicked:c,media:l,mediaType:p.mediaType,mediaSrc:p.mediaSrc,label:p.label,parsedDescription:p.parsedDescription,description:p.description,customWidget:p.widgetFrame})}}}isImageTag(){const{tag:e}=this.props;return this.state.mediaLoadingState!==Ie.FAILED&&this.state.mediaLoadingState!==Ie.ENABLED&&e.mediaType===p.z.photo}getTagPositionStyle(){const{view:e}=this.props;if(e.located){const{position:t}=e;return{transform:`translate(${t?t.x:0}px, ${t?t.y:0}px)`}}return{pointerEvents:"none",visibility:"hidden"}}static isMediaTag(e){return e===p.z.photo||e===p.z.video||e===p.z.rich}};Re.getTagDirection=(e,t,i,n)=>{const s=.2,o=1-(e+1)/(i=i||window.innerWidth)*2,r=1-(t+1)/(n=n||window.innerHeight)*2,l=r<-.2?0:r<s?1:2,c=o<-.2?2:o<s?1:0,h=Math.max(e,i-e);let d;return d=0===c?1===l?a.Pg.RIGHT:0===l?a.Pg.RIGHT_UP:a.Pg.RIGHT_DOWN:2===c?1===l?a.Pg.LEFT:0===l?a.Pg.LEFT_UP:a.Pg.LEFT_DOWN:1===l&&h>b.Z?o<0?a.Pg.RIGHT:a.Pg.LEFT:2===l?a.Pg.DOWN:a.Pg.UP,De.debug(`Selected ${d} for [${e}, ${t}] in ${i}x${n} (${c}, ${l})`),d},Re=Oe=Ce([d.Z],Re);Re.getTagDirection;var Le=i(25145),Ne=i(20983),ke=i(18120);class Tags extends n.Component{constructor(e){super(e),this.bindings=[],this.onUpdateSelectedTag=()=>this.setState({selectedTag:this.mattertagsViewData.selectedTag}),this.onUpdateToolState=()=>this.setState({toolState:this.mattertagsViewData.toolState}),this.onUpdateScreenPosition=()=>this.setState({screenPosition:this.mattertagsViewData.screenPosition}),this.onUpdateProgress=()=>this.setState({creationProgress:this.mattertagsViewData.progress}),this.onUpdateBillboards=()=>this.setState({billboards:this.mattertagsViewData.activeBillboards.keys}),this.toggleImageOverlay=async(e,t)=>{if(this.props.allowTagOverlay||!t)if(this.setState({overlay:t}),this.context.commandBinder.issueCommand(new r.Bz(o.P.MATTERTAG,t)),t){this.context.messageBus.broadcast(new c.dJ(e,l.V.OVERLAY));const t=e!==this.state.selectedTag?h.n.Interpolate:h.n.Instant,i=this.mattertagsData.getTag(e);this.context.commandBinder.issueCommand(new Le.Y(i.sid,t))}else this.closeBillboard(e)},this.getTagContainer=()=>this.tagsRoot,this.onNavigationLinkClicked=e=>{this.context.commandBinder.issueCommand(new Le.c(e))},this.setState({billboards:[],selectedTag:null,overlay:!1,toolState:a.rI.CLOSED,creationProgress:0,screenPosition:null})}componentDidMount(){const e=this.context.market;Promise.all([e.waitForData(Ne.n),e.waitForData(a.P5),e.waitForData(ae.e)]).then((([e,t,i])=>{this.init(e,t,i)}))}init(e,t,i){this.mattertagsData=e,this.mattertagsViewData=t,this.settingsData=i,this.bindings.push(this.mattertagsViewData.onSelectedTagChanged(this.onUpdateSelectedTag),this.mattertagsViewData.onChanged(this.onUpdateBillboards),this.mattertagsViewData.onToolStateChanged(this.onUpdateToolState)),this.context.editMode&&this.bindings.push(this.mattertagsViewData.onScreenPositionChanged(this.onUpdateScreenPosition),this.mattertagsViewData.onProgressChanged(this.onUpdateProgress)),this.setState({selectedTag:this.mattertagsViewData.selectedTag,toolState:this.mattertagsViewData.toolState,screenPosition:this.mattertagsViewData.screenPosition,creationProgress:this.mattertagsViewData.progress,billboards:this.mattertagsViewData.activeBillboards.keys})}componentWillUnmount(){this.bindings.forEach((e=>{e.cancel()})),this.bindings.length=0}componentDidUpdate(e){const{allowTagOverlay:t,toolOpen:i}=this.props;if(this.context.editMode&&(t!==e.allowTagOverlay||i!==e.toolOpen)){const e=this.mattertagsViewData&&this.mattertagsViewData.openTag;e&&(this.state.overlay?t||this.toggleImageOverlay(e,!1):this.closeBillboard(e))}}closeBillboard(e){this.mattertagsViewData.closeBillboard(e)}renderBillboards(){const{overlay:e,selectedTag:t,toolState:i,billboards:s}=this.state,{toolOpen:o,manager:r,allowTagOverlay:l}=this.props,c=[],h=i===a.rI.CREATING||i===a.rI.PRESSING||i===a.rI.PLACING,d=!(!o||i!==a.rI.EDITING&&i!==a.rI.PLACED);return h||s.forEach((i=>{const s=t===i,a=d&&s,h=this.mattertagsViewData.getViewData(i),u=this.mattertagsData.getTag(i),p=a||0===this.settingsData.tryGetProperty("mls",0);!u||h.closeTheTag&&a||c.push((0,n.h)(Re,{key:`billboard-${i}`,editing:a,selected:s,overlay:e,allowTagOverlay:l,toolOpen:o,view:h,tag:u,manager:r,mediaEnabled:p,toggleImageOverlay:this.toggleImageOverlay,onNavigationLinkClicked:this.onNavigationLinkClicked,getTagContainer:this.getTagContainer}))})),c}renderProgressCircle(){const{mobile:e}=this.props,{creationProgress:t,screenPosition:i,toolState:o}=this.state;if(!(o===a.rI.PRESSING&&t>0&&e)||!i)return null;const r={left:i.x-Tags.creationButtonRadius/2+"px",top:i.y-Tags.creationButtonRadius/2+"px"};return(0,n.h)("div",{class:"point-button-wrapper",style:r},(0,n.h)(ke.$,{appendClass:s({complete:1===t,reset:0===t}),progress:100*t,innerRadius:Tags.creationButtonRadius,barWidth:Tags.progressBarThickness},(0,n.h)("circle",{class:"point",cx:"0",cy:"0",r:"22",transform:"rotate(-90)",fill:"#fff"})))}render(){if(!this.mattertagsData||!this.mattertagsViewData||!this.settingsData)return null;const{toolOpen:e}=this.props,{toolState:t}=this.state,i=!(!e||t!==a.rI.EDITING&&t!==a.rI.PLACED);return(0,n.h)("div",{className:s("overlay-layer","tags-layer",{"tag-editable":e,"tags-layer-editing":i}),ref:e=>{this.tagsRoot=e}},this.renderProgressCircle(),this.renderBillboards())}}Tags.creationButtonRadius=132,Tags.progressBarThickness=8},6082:(e,t,i)=>{"use strict";i.d(t,{J6:()=>n,l7:()=>s,XJ:()=>o,qS:()=>r,kn:()=>a,QH:()=>l,l$:()=>c,Le:()=>h,Z:()=>d,dI:()=>u,Cz:()=>p,QI:()=>m,Hj:()=>g,NE:()=>f,vR:()=>v});const n=12,s=24,o=20,r=5,a=100,l=80,c=150,h=340,d=310,u=200,p=300,m=350,g=400,f=700,v=600},252:(e,t,i)=>{"use strict";i.d(t,{l:()=>CustomWidgetFrame});var n=i(26605);class CustomWidgetFrame extends n.Component{shouldComponentUpdate(){return!1}componentDidMount(){this.base&&this.props.widget.frame.mount(this.base)}componentWillUnmount(){this.base&&this.props.widget.frame.unmount()}render(){const{width:e,height:t}=this.props.widget.size,i={};return e&&t&&(i.width=e+"px",i.height=t+"px"),(0,n.h)("div",{class:"custom-widget-container",style:i})}}},99363:(e,t,i)=>{"use strict";i.d(t,{q:()=>f});var n=i(26605),s=i(2116),o=i(94184),r=i(68611),a=i(90601),l=i(1402),c=i(62431),h=i(79830),d=i(84245),u=i(90709),p=i(73621);class StemEditor extends n.Component{constructor(e){super(e),this.stemLengthUpdating=(e,t=!0)=>{const i=t?(0,u._F)(e):e;i!==this.props.stemLength&&this.props.onLengthUpdate(i)},this.saveStemLength=(e,t=!0)=>{const i=t?(0,u._F)(e):e;this.props.onLengthChanged(i)},this.onChangeStemEnabled=()=>{this.props.onStemEnabledChanged(!this.props.stemEnabled)},this.stopPropagation=e=>e.stopPropagation(),this.updateUnits=()=>{this.setState({units:this.context.settings.tryGetProperty(c.gx.Units,c.Mc.USFractional)})},this.formatStemHeight=e=>{if(this.state.units===c.Mc.USFractional)return(0,d.KQ)(e);return`${Math.round(100*(0,u._F)(e))/100}m`},this.state={units:c.Mc.USFractional}}componentDidMount(){this.updateUnits(),this.slider.setValue((0,u.zy)(this.props.stemLength)),this.context.settings.onPropertyChanged(c.gx.Units,this.updateUnits)}componentWillUnmount(){this.context.settings.removeOnPropertyChanged(c.gx.Units,this.updateUnits)}componentWillReceiveProps(e){e.stemLength!==this.props.stemLength&&this.slider.setValue((0,u.zy)(e.stemLength))}render(){const{stemEnabled:e,stemLength:t}=this.props;return(0,n.h)("div",{class:"stem-editor",onClick:this.stopPropagation},(0,n.h)("div",{class:"stem-slider"},(0,n.h)(h.S,{ref:e=>this.slider=e,discrete:!1,min:.1,max:9,initialValue:(0,u.zy)(t),onChange:this.saveStemLength,onInput:this.stemLengthUpdating,displayBounds:!0,width:150,formatNumbers:this.formatStemHeight,tooltipPosition:h.h.DOWN})),(0,n.h)(p.X,{enabled:!0,checked:e,label:"Show Stem",onChange:this.onChangeStemEnabled}))}}var m=i(14071),g=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let f=class PinAssetEditor extends n.Component{constructor(e){super(),this.closePinAssetEditor=e=>{e&&e.stopPropagation(),this.props.onClose()},this.handleColorPicked=e=>{this.trackEvent("pin_change_color"),this.props.onSave({color:e})},this.saveStemEnabled=e=>{this.trackEvent(e?"pin_show_stem":"pin_hide_stem"),this.props.onSave({stemEnabled:e})},this.saveStemLength=e=>{this.trackEvent("pin_change_stem_height"),this.props.onSave({stemLength:e})},this.previewStemLength=e=>{const{pin:t,pinType:i}=this.props;this.context.commandBinder.issueCommand(new r.fe(t.id,i,e))},this.stopPropagation=e=>{e.stopPropagation()}}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}renderStemEditor(){const{pin:e}=this.props;return(0,n.h)(StemEditor,{stemLength:e.stemLength,stemEnabled:e.stemEnabled,onLengthUpdate:this.previewStemLength,onLengthChanged:this.saveStemLength,onStemEnabledChanged:this.saveStemEnabled})}render(){const{toolPanelLayout:e,open:t,pin:i,colors:s}=this.props,r=e===a.wS.BOTTOM_PANEL;return t||r?(0,n.h)("div",{class:o("pin-tool-editor",{"tool-popup":!r,open:r&&t}),onClick:this.stopPropagation},(0,n.h)("div",{class:"tool-editor-title"},(0,n.h)("span",null,"Color & Stem"),(0,n.h)(m.P,{buttonStyle:m.A.LIGHT,onClose:this.closePinAssetEditor,hideTooltip:!0})),(0,n.h)(l.z,{colors:s,defaultColor:i.color,onColorPicked:this.handleColorPicked}),this.renderStemEditor()):null}};f=g([s.Z],f)},7920:(e,t,i)=>{"use strict";i.d(t,{v:()=>h});var n=i(26605),s=i(2116),o=i(32143),r=i(48520),a=i(16945),l=i(88686),c=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let h=class TagMedia extends n.Component{constructor(e){super(),this.clickAttachment=(e,t)=>{const{attachments:i,onClick:n}=this.props;0!==i.length&&(e.stopPropagation(),n(e,t))},this.state={width:0,height:0}}getMediaDisplayDimension(e){const{layerWidth:t,layerHeight:i}=this.props;if(void 0===t||void 0===i)return{};const{mediaType:n,category:s,width:a,height:l}=e;if(s!==o.G.EXTERNAL)return{};const c=.4*i,h=.7*t;if(a&&l){const e=Math.max(a,1)/Math.max(l,1);let t,i;return t=n===r.E.IMAGE?e>1?Math.max(Math.min(a,400,h),310):Math.max(Math.min(a,300),200):Math.max(Math.min(a,350,h),310),i=t/e,i>c&&(i=c,t=i*e),{width:t,height:i}}return{width:Math.max(Math.min(350,h),310),height:c}}renderAttachment(e){const{sizeMedia:t}=this.props,{width:i,height:s}=this.getMediaDisplayDimension(e);return(0,n.h)(l.P,{attachment:e,sizeMedia:t,thumbnail:!1,cover:!1,width:i,height:s,onClick:this.clickAttachment})}render(){const{attachments:e}=this.props;return 0===e.length?null:(0,n.h)("div",{class:"tag-media"},1===e.length?this.renderAttachment(e[0]):(0,n.h)(a.T,{attachments:e,startIndex:0,width:318,height:130,onClick:this.clickAttachment}))}};h=c([s.Z],h)},6983:(e,t,i)=>{"use strict";i.d(t,{Q:()=>TagsManager});var n=i(47924),s=i(90601),o=i(9608),r=i(42885),a=i(57155),l=i(98809),c=i(83455),h=i(36520),d=i(22729),u=i(70008),p=i(68611),m=i(90926),g=i(85282),f=i(87493);class TagsManager{constructor(e,t){this.engine=e,this.initialized=!1,this.bindings=[],this.disabledEditorAssets={[l.U]:!1,[a.Nj]:!1,[r.s]:!1,[c.Mp]:!1},this.settingsToggler=new o.u(t,this.disabledEditorAssets),this.initPromise=this.init()}async init(){const e=this.engine.market;return Promise.all([e.waitForData(g.n),e.waitForData(h.b),e.waitForData(d.c),e.waitForData(u.B)]).then((([e,t,i,n])=>(this.dataMap={tagsViewData:e,attachmentsData:t,floorsViewData:i,pinsViewData:n},!0)))}async activate(e){const t=this.engine;if(this.initialized)for(const e of this.bindings)e.renew();else this.initialized=!0,await this.initPromise;e&&this.settingsToggler.toggle(!0),await t.commandBinder.issueCommand(new f.bF(!0))}async deactivate(){this.settingsToggler.toggle(!1),await this.engine.commandBinder.issueCommand(new f.bF(!1))}navigateInList(e,t,i){const{tagsViewData:o}=this.dataMap,r=o.getCurrentTagViewByIndex(e);if(r)if(t){const t=i===s.wS.SIDE_PANEL?n.n.FadeToBlack:n.n.Instant;this.engine.commandBinder.issueCommand(new p.$b(r.id,m.Er.MATTERTAG,t,void 0,e))}else this.engine.commandBinder.issueCommand(new p.Ar(r.id,m.Er.MATTERTAG))}setTagVisibility(e,t){}}},52595:(e,t,i)=>{"use strict";i.d(t,{O:()=>l});var n=i(26605),s=i(2116),o=i(90926),r=i(81323),a=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let l=class TagsNavigationBar extends n.Component{constructor(e){super(),this.bindings=[],this.updateTagData=()=>{const{tagsViewData:e}=this.props.manager.dataMap,{listIndex:t,openTagView:i}=e;this.setState({listIndex:t,numTags:e.getEnabledTagViews().length,openTagView:i})},this.updatePinData=()=>{const{pinsViewData:e}=this.props.manager.dataMap;this.setState({pinState:e.pinState})},this.onNavigateList=e=>{this.props.manager.navigateInList(e,!1,this.props.toolPanelLayout)},this.state={pinState:o.tS.IDLE,openTagView:null,listIndex:-1,numTags:0}}componentDidMount(){const{tagsViewData:e,pinsViewData:t}=this.props.manager.dataMap;this.bindings.push(e.onChanged(this.updateTagData),t.onChanged(this.updatePinData)),this.updateTagData(),this.updatePinData()}componentWillUnmount(){for(const e of this.bindings)e.cancel()}render(){const{pinState:e,openTagView:t,listIndex:i,numTags:s}=this.state;return t&&e===o.tS.SELECTED&&s>1?(0,n.h)("div",{class:"overlay-top-center tags-navigation-bar"},(0,n.h)("div",{class:"overlay-info"},(0,n.h)(r.$,{index:i,total:s,disabled:!1,wrapAround:!0,onNavigate:this.onNavigateList}))):null}};l=a([s.Z],l)},22952:(e,t,i)=>{"use strict";i.d(t,{g:()=>G});var n=i(26605),s=i(2116),o=i(47924),r=i(90601),a=i(29677),l=i(68611),c=i(90926),h=i(94184),d=i(51090),u=i(43711),p=i(73305),m=i(7920),g=i(30300),f=i(14071),v=i(25255),y=i(42733),b=i(81323),w=i(96240),S=i(53189),E=i(252),T=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let M=class TagWidget extends n.Component{constructor(e){super(e),this.bindings=[],this.onModalChange=()=>{const e=!!this.context.toolsData.openModal;e||this.toolPanel&&this.props.toolPanelLayout===r.wS.BOTTOM_PANEL&&this.toolPanel.resetScrollTop(),this.setState({modalOpen:e})},this.onViewAttachment=(e,t)=>{const{tag:i}=this.props;if(!i)return;const n=i.attachments,s=n.findIndex((e=>e.id===t));-1!==s&&this.closeTag().then((()=>{this.trackEvent("tags_click_view_attachment"),this.context.commandBinder.issueCommand(new p.SI(n,s))}))},this.onNavigate=e=>{this.props.manager.navigateInList(e,!0,this.props.toolPanelLayout)},this.closeTag=async()=>this.context.commandBinder.issueCommand(new u.tT(r.w1.TAGS,!1)),this.setToolPanelRef=e=>{e&&(this.toolPanel=e)},this.state={modalOpen:!1}}componentDidMount(){const{toolsData:e}=this.context;this.bindings.push(e.onOpenModalChanged(this.onModalChange)),this.onModalChange()}componentWillUnmount(){for(const e of this.bindings)e.cancel()}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}renderNavHeader(e){const{listIndex:t,numTags:i,tag:s}=this.props;if(!s)return null;const o=i>1&&-1!==t;return e?(0,n.h)("div",{class:"detail-panel-header"},o&&(0,n.h)(b.$,{index:t,total:i,disabled:!1,wrapAround:!0,onNavigate:this.onNavigate}),(0,n.h)(f.P,{onClose:this.closeTag})):(0,n.h)("div",{class:"detail-panel-header"},(0,n.h)(v.A,{label:"Close",className:"return-btn",icon:"icon-close",buttonSize:y.qE.SMALL,buttonStyle:y.ZJ.TOOLBAR,onClick:this.closeTag}),o&&(0,n.h)(b.$,{index:t,total:i,disabled:!1,wrapAround:!0,onNavigate:this.onNavigate}))}renderWidgetFrame(e){const t=e.widgetFrame;return t?(0,n.h)(E.l,{widget:t}):null}renderText(e){const{label:t,description:i}=e;return t||i?(0,n.h)("div",{class:"tag-text"},t&&(0,n.h)("header",{class:"tag-header"},t),i&&(0,n.h)("div",{class:"tag-description"},(0,n.h)(S.Z,{text:i,activeLinks:!0,hashtags:!1,userMentions:!1}))):null}renderTag(e,t){const{toolPanelLayout:i}=this.props,{label:s,description:o,id:r,attachments:a}=e;return t?(0,n.h)("div",{class:h("tag",{"has-media":a.length>0,"has-text":!(!s&&!o)})},(0,n.h)(m.v,{sizeMedia:!1,attachments:a,onClick:this.onViewAttachment}),this.renderText(e),this.renderWidgetFrame(e)):(0,n.h)("div",{class:"tag"},(0,n.h)(w.Z,{annotationType:w.J.PRESENTATION,assetId:r,assetType:d.h.MATTERTAG,attachments:[],clickToEdit:!1,editable:!1,active:!1,edited:!1,text:o,title:s,toolPanelLayout:i,onViewAttachment:this.onViewAttachment}))}renderTagWidget(e,t){return(0,n.h)("div",{class:h("tag-widget",{modal:t})},this.renderNavHeader(t),this.renderTag(e,t))}render(){const{tag:e,closing:t,toolPanelLayout:i}=this.props,{modalOpen:s}=this.state,o=i===r.wS.BOTTOM_PANEL,a=i===r.wS.SIDE_PANEL,l=o||a,c=l&&!!e&&!t&&(a||!s);return l?(0,n.h)(g.J,{ref:this.setToolPanelRef,open:c,toolPanelLayout:i,scrollingDisabled:!1},e&&this.renderTagWidget(e,!1)):null}};M=T([s.Z],M);var _=i(6999),x=i(96608),A=i(4633),O=i(17666),P=i(20392),C=i(90197),D=i(25382),I=i(65287),R=i(73621),L=i(18288),N=i(98784),k=i(80429),B=i(86134),F=i(29359);const{TAGS:U}=F.Z.SHOWCASE;class TagsList extends n.Component{constructor(e){super(e),this.bindings=[],this.onTagsToolStateChanged=()=>{const{selectMode:e,toggleSelectMode:t}=this.props,{tagsViewData:i}=this.props.manager.dataMap;i.tagsToolState!==_.p.IDLE&&e&&t&&t()},this.updateGroups=()=>{const{floorsViewData:e,tagsViewData:t}=this.props.manager.dataMap,i=t.getAllTagViews().values(),n={};e.iterate((e=>{n[e.id]={id:e.id,name:e.name,items:[]}})),i.forEach((e=>{var i;const s=e.floorId;if(!n[s])throw Error(`Mattertag on non-existent floor: ${s}`);n[s].items.push({sid:e.id,floorId:e.floorId,text:this.getTagText(e),visible:e.enabled,selected:(null===(i=t.openTagView)||void 0===i?void 0:i.id)===e.id,color:e.color})}));for(const e in n){n[e].items.sort(((e,t)=>e.text.toLowerCase()<t.text.toLowerCase()?-1:1))}this.setState({listGroups:n,numTags:i.length})},this.setPopupMenu=e=>{e&&(this.popupMenu=e)},this.toggleOptionsMenu=e=>{const t=e.clientY+this.popupMenu.offsetHeight+B.u.POPUP_OFFSET>window.innerHeight?B.x.BOTTOM_RIGHT:B.x.TOP_RIGHT,i=e.currentTarget,n=i&&i.getAttribute?i.getAttribute("data-value"):null;n&&this.state.activeMenuId!==n?this.setState({activeMenuId:n,arrowPosition:t}):this.setState({activeMenuId:null,arrowPosition:t})},this.closeOptionsMenu=e=>{const t=e.target;t&&t.classList.contains("item-more-options")||this.setState({activeMenuId:null})},this.batchToggleVisibility=async()=>!!this.props.selectedItems,this.batchDelete=async()=>{if(this.props.selectedItems){const{clearSelected:e}=this.props;if(!0&&e)return e(),!0}return!1},this.toggleAll=()=>{const{onSelectAll:e}=this.props,{listGroups:t}=this.state;e&&e(t)},this.selectTag=e=>{this.trackEvent("tags_list_open_tag"),this.props.onOpenTag(e)},this.deleteItem=e=>{const{activeMenuId:t}=this.state;e.stopPropagation(),t&&this.setState({activeMenuId:null})},this.editItem=e=>{const t=this.state.activeMenuId;e.stopPropagation(),t&&this.setState({activeMenuId:null})},this.toggleItemVisibility=e=>{const t=e.currentTarget,i=t&&t.getAttribute?t.getAttribute("data-value"):null;if(e.stopPropagation(),i){this.context.analytics.track("workshop_gui",{gui_action:"drawer_mattertag_visibility_modified"});const e=this.getListItem(i);e&&this.props.manager.setTagVisibility(i,!e.visible)}},this.renderFloorRenameHeader=(e,t)=>{const{selectedItems:i,selectMode:s,onSelectGroup:o}=this.props;return(0,n.h)(I.K,{group:e,multiFloor:t,selectMode:s,selectedItems:i,onSelectGroup:o})},this.state={numTags:0,listGroups:{},activeMenuId:null,arrowPosition:B.x.TOP_RIGHT}}componentDidMount(){const{tagsViewData:e}=this.props.manager.dataMap;this.bindings.push(e.onOpenTagViewChanged(this.updateGroups),e.getAllTagViews().onChanged(this.updateGroups),e.onTagsToolStateChanged(this.onTagsToolStateChanged)),this.updateGroups()}componentWillUnmount(){for(const e of this.bindings)e.cancel()}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}getTagText(e){let t=e.label;return""===t&&(t=e.description),t}getListItem(e){const{listGroups:t}=this.state;for(const i in t){const n=t[i].items.find((t=>t.sid===e));if(n)return n}return null}getEmptyMessage(){return"You don't have any tags yet."}renderItemOptions(e){const{locale:t}=this.context,i=t.t(U.EDIT_LIST_ITEM_OPTION_CTA),s=t.t(U.DELETE_LIST_ITEM_OPTION_CTA);return(0,n.h)("div",{class:"tooltip-menu",ref:e=>this.setPopupMenu(e)},(0,n.h)("div",{class:"tpMsg",onClick:this.editItem},i),(0,n.h)("div",{class:"tpMsg",onClick:this.deleteItem},s))}renderItem(e,t){const{selectedItems:i,onCheckboxClick:s,onSelectItem:o,selectMode:r}=this.props,{activeMenuId:a,arrowPosition:l}=this.state,{sid:c,text:h,visible:d,selected:u,color:p}=e,m={"background-color":p},g=a===c;return(0,n.h)(P.Q,{key:c,sid:c,appendClass:{"tag-header":!0,"accordion-item-with-options":!0,"accordion-item-with-toggle":!0},enabled:d,selected:u,onSelect:r?o:this.selectTag},r&&(0,n.h)("div",{class:"accordion-checkbox"},(0,n.h)(R.X,{enabled:!0,checked:i&&i.has(c),id:c,onChange:s,stopPropagation:!0,dataValue:c})),!r&&(0,n.h)(L.Z,{id:c,visible:d,showTooltip:U.SHOW_LIST_ITEM_TOOLTIP_MESSAGE,hideTooltip:U.HIDE_LIST_ITEM_TOOLTIP_MESSAGE,onClick:this.toggleItemVisibility}),(0,n.h)("span",{class:"accordion-item-text tag-text"},(0,n.h)(S.Z,{text:h,activeLinks:!1,hashtags:!1,userMentions:!1})),(0,n.h)("span",{class:"mattertag-color-dot",style:m}),!r&&(0,n.h)(k.h,{dataValue:c,appendClass:{"accordion-item-more-options":!0},buttonStyle:k.D.PLAIN,iconClass:"icon-more-vert item-more-options",onClick:this.toggleOptionsMenu},(0,n.h)(B.u,{open:g,onClose:this.closeOptionsMenu,message:this.renderItemOptions(d),arrowPos:l,appendBodyClass:{"container--smallest--width":!0,"item-tooltip":!0}})))}renderGroups(){const{locale:e}=this.context,{listGroups:t}=this.state,{onExpandChange:i,manager:s}=this.props,o=[],r=Object.keys(t).length>1,a=s.dataMap.floorsViewData.currentFloorId,l=e.t(r?U.MULTI_FLOOR_EMPTY_MESSAGE:U.SINGLE_FLOOR_EMPTY_MESSAGE);for(const e in t){const s=t[e],c=this.renderFloorRenameHeader(s,r);o.push((0,n.h)(O.b,{key:e,id:e,emptyMessage:l,header:c,open:a===s.id||!r,collapsible:r,onExpandChange:i},s.items.map(((e,t)=>this.renderItem(e,t)))))}return o}renderTagsList(){const{numTags:e}=this.state;if(0===e)return(0,n.h)("div",{class:"empty-message"},this.getEmptyMessage());const{locale:t}=this.context,{manager:i,selectedItems:s,selectMode:o,toggleSelectMode:r}=this.props,a=t.t(U.NUM_TYPE,e),l=!!s&&s.size>0,c=i.dataMap.tagsViewData.tagsToolState!==_.p.IDLE;return(0,n.h)("div",{class:h("list-panel-list","tags-list")},(0,n.h)(C.y,{selectMode:!!o,selectAllCallback:this.toggleAll,selectButtonCallback:r,disableToggle:c,title:a,hasSelectedItems:l}),(0,n.h)("div",{class:h("accordion-main-content",{"footer-active":o})},(0,n.h)(A.F,null,this.renderGroups())),(0,n.h)(D.n,{active:!!o,enabled:!!s&&s.size>0,leftButtonCallback:this.batchDelete,rightButtonCallback:this.batchToggleVisibility}))}render(){const{active:e,toolPanelLayout:t}=this.props;return(0,n.h)(x.L,{active:e,appendClass:{"tags-list-panel":!0},toolPanelLayout:t},this.renderTagsList())}}const V=(0,N.A)(TagsList);var H=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let G=class TagsToolPanel extends n.Component{constructor(e){super(e),this.bindings=[],this.tagClosedTimeout=0,this.updateTagViews=()=>{const e=this.props.manager.dataMap.tagsViewData.getEnabledTagViews();this.setState({tagViews:e.values()})},this.updateListIndex=()=>{const e=this.props.manager.dataMap.tagsViewData.listIndex;this.setState({listIndex:e})},this.updateCurrentTag=async()=>{const{manager:e,toolPanelLayout:t}=this.props,{currentTag:i}=this.state,n=e.dataMap.tagsViewData,{openTagView:s,selectedPreview:o}=n,a=t!==r.wS.NONE;!s||o||i&&a?i&&a&&(!s||o)?this.startClosingTagWidget():this.setState({currentTag:s}):this.startOpeningTagWidget()},this.openTagFromList=e=>{const t=this.props.toolPanelLayout===r.wS.SIDE_PANEL?o.n.FadeToBlack:o.n.Instant;this.context.commandBinder.issueCommand(new l.$b(e,c.Er.MATTERTAG,t))},this.state={tagClosing:!1,tagViews:[],currentTag:null,listIndex:-1}}componentDidMount(){const{manager:e}=this.props,{tagsViewData:t}=e.dataMap;this.bindings.push(t.onOpenTagViewChanged(this.updateCurrentTag),t.onListIndexChanged(this.updateListIndex),t.getEnabledTagViews().onChanged(this.updateTagViews)),this.updateTagViews(),this.updateCurrentTag(),this.updateListIndex()}componentWillUnmount(){window.clearTimeout(this.tagClosedTimeout);for(const e of this.bindings)e.cancel()}startOpeningTagWidget(){const{manager:e}=this.props,t=e.dataMap.tagsViewData;window.clearTimeout(this.tagClosedTimeout),this.setState({currentTag:t.openTagView,tagClosing:!1})}startClosingTagWidget(){this.state.tagClosing||(this.setState({tagClosing:!0}),this.tagClosedTimeout=window.setTimeout((()=>{this.setState({currentTag:null,tagClosing:!1})}),a.El))}render(){const{toolPanelLayout:e,manager:t}=this.props,{tagClosing:i,tagViews:s,listIndex:o,currentTag:a}=this.state,l=e!==r.wS.NONE;if(!i&&!l)return null;const{editMode:c}=this.context,h=s.length;return(0,n.h)("div",{class:"tool-panel tags-panel"},(0,n.h)(M,{manager:t,closing:i,tag:a,toolPanelLayout:e,numTags:h,listIndex:o}),c&&(0,n.h)(V,{manager:t,active:i||!a,toolPanelLayout:e,onOpenTag:this.openTagFromList}))}};G=H([s.Z],G)},30300:(e,t,i)=>{"use strict";i.d(t,{J:()=>DetailPanel});var n,s=i(26605),o=i(94184),r=i(84952),a=i(21265),l=i(93273),c=i(90601),h=i(2116),d=i(91033),u=i(35175),p=i(67538),m=i(10396),g=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};s.options.debounceRendering=requestAnimationFrame,function(e){e.CENTER="center",e.TOP="top"}(n||(n={}));let f=class Scroller extends s.Component{constructor(e){super(e),this.usePointerEvents=window.PointerEvent,this.focusedSelector=null,this.listening=!1,this.startY=0,this.onThumb=!1,this.scrollTop=0,this.handleResize=()=>{this.computeStateValues(),this.focusedSelector&&this.scrollToSelector(this.focusedSelector)},this.handleWheelEvent=e=>{this.props.disabled||(this.onThumb=!1,this.focusedSelector=null,this.scrollBy(e.deltaY))},this.handleEvent=e=>{if(this.scroller&&!this.props.disabled){this.scrollVelocityPixelsMS=0;if("mousedown"===e.type||"pointerdown"===e.type||"touchstart"===e.type){const t=e.target;this.onThumb=t&&t.classList.contains("scroller-thumb")}this.focusedSelector=null,this.inputFilter.handleEvent(e)}},this.handlePressStart=e=>{this.onThumb?this.startY=this.getThumbTop():this.startY=this.getScrollTop()},this.handlePressMove=e=>{const{trackHeight:t,contentsHeight:i}=this.state;let n;this.onThumb?(n=(this.startY-e.y)/t,this.scrollToPercent(n)):(n=(e.y+this.startY)/i,this.scrollToPercent(n))},this.handleDragStart=()=>{},this.handleDragEnd=(e,t)=>{this.scrollVelocityPixelsMS=e.y/t,this.lastScrollTimeMS=void 0,Math.abs(this.scrollVelocityPixelsMS)<1?this.scrollVelocityPixelsMS=0:this.animateScroll()},this.onTrackClick=e=>{if(e.target!==this.track)return;const t=this.getThumbHeight(),i=this.getThumbTop(),n=this.track.getBoundingClientRect().top,s=this.state.trackHeight;let o;o=e.clientY<n+i?Math.max(0,(i-t)/s):Math.min(s,(i+t)/s),this.scrollToPercent(o)},this.scrollToPercent=e=>{this.isOverflowing()&&this.scroller&&!isNaN(e)&&this.setScrollPosition(Math.max(Math.min(1,e)*this.state.contentsHeight,0))},this.scrollBy=e=>{this.isOverflowing()&&this.scroller&&!isNaN(e)&&this.setScrollPosition(Math.max(this.scroller.scrollTop+e,0))},this.computeStateValues=()=>{if(this.props.disabled)return;const e=Number(this.scroller&&this.scroller.clientHeight)||1,t=Number(this.track&&this.track.clientHeight)||e,i=Number(this.contents&&this.contents.clientHeight)||1,n=Number(this.contents&&this.contents.offsetTop)||0;this.setState({scrollerHeight:e,contentsHeight:i,trackHeight:t,offsetTop:n})},this.setContentsRef=e=>{e?(this.contents=e,this.resizeObserver.observe(this.contents)):this.contents&&this.resizeObserver.unobserve(this.contents)},this.setScrollerRef=e=>{e&&(this.scroller=e)},this.setTrackRef=e=>{e&&(this.track=e)},this.setThumbRef=e=>{e&&(this.thumb=e)},this.state={scrollerHeight:1,contentsHeight:1,trackHeight:1,offsetTop:0},this.resizeObserver=new d.Z(this.handleResize),this.resizeSubscription=(0,m.kp)(m.g_.RESIZE,this.handleResize),this.inputFilter=new p.Z({handlePressStart:this.handlePressStart,handlePressMove:this.handlePressMove,handleDragStart:this.handleDragStart,handleDragEnd:this.handleDragEnd})}componentDidMount(){this.toggleEventHandling(!0),this.computeStateValues()}componentWillUnmount(){this.toggleEventHandling(!1),this.resizeObserver&&this.resizeObserver.disconnect()}componentDidUpdate(e,t){this.scroller&&e.disabled!==this.props.disabled&&(this.props.disabled?this.toggleEventHandling(!1):this.toggleEventHandling(!0))}resetScrollTop(){this.focusedSelector=null,this.setScrollPosition(0)}scrollToElement(e,t=n.CENTER){if(!(e&&e.compareDocumentPosition(this.scroller)&Node.DOCUMENT_POSITION_CONTAINS))return;if(!this.isOverflowing()||!this.scroller)return;const{contentsHeight:i,scrollerHeight:s,offsetTop:o}=this.state;let r=e.offsetTop,a=e;for(;a.parentElement&&(a=a.parentElement,r+=a.offsetTop,a.offsetParent!==this.contents););let l=o+r;t===n.CENTER&&(l+=e.offsetHeight/2-s/2),l=Math.max(Math.min(i,l),0);const c=this.scroller.scrollTop,h=l-c;let d=0;const u=e=>{d||(d=e);const t=e-d,i=Math.min(t/500,1);this.scroller.scrollTo(0,c+h*i),t<500?window.requestAnimationFrame(u):this.setScrollPosition(l)};window.requestAnimationFrame(u)}scrollToSelector(e){const t=this.scroller.querySelector(e);t?(this.focusedSelector=e,this.scrollToElement(t)):this.focusedSelector=null}setScrollPosition(e){if(this.scroller){const t=this.scroller.scrollTop;this.scroller.scrollTop=e,this.scrollTop=this.getScrollTop(),this.props.onScrolled&&t!==this.scrollTop&&this.props.onScrolled(),this.thumb&&(this.thumb.style.height=`${this.getThumbHeight()}px`,this.thumb.style.top=`${this.getThumbTop()}px`)}}toggleEventHandling(e){const t=this.handleEvent,i=u.h?{passive:!0}:void 0;!this.listening&&e?(this.resizeSubscription.renew(),this.scroller.addEventListener("wheel",this.handleWheelEvent,i),this.usePointerEvents?(this.scroller.addEventListener("pointerdown",t,i),window.addEventListener("pointermove",t,i),window.addEventListener("pointerup",t,i)):(this.scroller.addEventListener("touchstart",t,i),this.scroller.addEventListener("mousedown",t,i),window.addEventListener("mousemove",t,i),window.addEventListener("mouseleave",t,i),window.addEventListener("mouseup",t,i),window.addEventListener("touchmove",t,i),window.addEventListener("touchend",t,i),window.addEventListener("touchcancel",t,i))):this.listening&&!e&&(this.resizeSubscription.cancel(),this.scroller.removeEventListener("wheel",this.handleWheelEvent),this.usePointerEvents?(this.scroller.removeEventListener("pointerdown",t),window.removeEventListener("pointermove",t),window.removeEventListener("pointerup",t)):(this.scroller.removeEventListener("touchstart",t),this.scroller.removeEventListener("mousedown",t),window.removeEventListener("mousemove",t),window.removeEventListener("mouseleave",t),window.removeEventListener("mouseup",t),window.removeEventListener("touchmove",t),window.removeEventListener("touchend",t),window.removeEventListener("touchcancel",t)))}animateScroll(){window.requestAnimationFrame((e=>{void 0===this.lastScrollTimeMS&&(this.lastScrollTimeMS=e);let t=e-this.lastScrollTimeMS;if(t>0){this.scrollBy(this.scrollVelocityPixelsMS*t);const e=this.scrollVelocityPixelsMS>0?-1:1;for(;t>0;)this.scrollVelocityPixelsMS+=this.scrollVelocityPixelsMS*this.scrollVelocityPixelsMS*.01*e,t-=1}Math.abs(this.scrollVelocityPixelsMS)>.001&&this.animateScroll()}))}getThumbTop(){const{contentsHeight:e,trackHeight:t}=this.state;return Math.min(this.scrollTop/e*t,t-this.getThumbHeight())}getThumbHeight(){const{scrollerHeight:e,contentsHeight:t,trackHeight:i}=this.state;return e/t*i}getScrollTop(){return this.scroller?this.scroller.scrollTop:0}isOverflowing(){const{contentsHeight:e,scrollerHeight:t,offsetTop:i}=this.state;return e+i>t}renderTrack(){const e={height:`${this.getThumbHeight()}px`,top:`${this.getThumbTop()}px`};return(0,s.h)("div",{ref:this.setTrackRef,class:"scroller-track",onClick:this.onTrackClick},(0,s.h)("div",{ref:this.setThumbRef,class:"scroller-thumb",style:e,onPointerDown:this.usePointerEvents?this.handleEvent:void 0,onMouseDown:this.usePointerEvents?void 0:this.handleEvent,onTouchStart:this.usePointerEvents?void 0:this.handleEvent}))}render(){const{children:e,appendClass:t,hideThumb:i,disabled:n}=this.props,r=!n&&this.isOverflowing(),a={};return t&&Object.keys(t).length>0&&Object.assign(a,t),(0,s.h)("div",{class:o("scroller-container",a)},(0,s.h)("div",{class:"scroller-scroller",ref:this.setScrollerRef},(0,s.h)("div",{class:"scroller-contents",ref:this.setContentsRef},e)),!i&&r&&this.renderTrack())}};f=g([h.Z],f);class DetailPanel extends s.Component{constructor(e){super(e),this.mobileSized=(0,r.w)(window),this.touchDevice=(0,a.Jm)(),this.handleTextBoxFocus=e=>{this.setState({textFocused:e.focused})},this.setScrollerRef=e=>{e&&(this.scroller=e)},this.state={textFocused:!1}}componentDidMount(){this.context.messageBus.subscribe(l.S,this.handleTextBoxFocus)}componentWillUnmount(){this.context.messageBus.unsubscribe(l.S,this.handleTextBoxFocus)}resetScrollTop(){this.scroller&&this.scroller.resetScrollTop()}scrollToSelector(e){this.scroller&&this.scroller.scrollToSelector(e)}render(){const{open:e,appendClass:t,children:i,onScrolled:n,toolPanelLayout:r,scrollingDisabled:a}=this.props,{textFocused:l}=this.state,h=r===c.wS.BOTTOM_PANEL,d=this.touchDevice&&l&&h,u=h||this.mobileSized,p={open:e,"sticky-header":!d};return t&&Object.keys(t).length>0&&Object.assign(p,t),(0,s.h)("div",{class:o("detail-panel",p)},(0,s.h)(f,{ref:this.setScrollerRef,hideThumb:u,disabled:a,onScrolled:n},i))}}},96608:(e,t,i)=>{"use strict";i.d(t,{L:()=>ListPanel});var n=i(26605),s=i(94184),o=i(90601),r=i(80429);class ListPanel extends n.Component{constructor(e){super(e),this.onToggleCollapsed=e=>{e.stopPropagation(),this.state.collapsing||(this.setState((e=>{const t=!e.collapsed;return{collapsed:t,collapsing:t}})),window.setTimeout((()=>{this.setState({collapsing:!1})}),500))},this.state={collapsed:e.toolPanelLayout===o.wS.BOTTOM_PANEL,collapsing:!1}}render(){const{active:e,toolPanelLayout:t,children:i,title:a,onClose:l,appendClass:c,subheader:h}=this.props,{collapsed:d,collapsing:u}=this.state,p=t===o.wS.BOTTOM_PANEL,m=p&&d&&!u,g={active:e,collapsed:d},f=m?"icon-dpad-up":"icon-dpad-down";return c&&Object.keys(c).length>0&&Object.assign(g,c),(0,n.h)("div",{class:s("list-panel",g)},(a||l)&&(0,n.h)("div",{class:"list-panel-header",onClick:this.onToggleCollapsed},a&&(0,n.h)("div",{class:"list-panel-title"},a),(0,n.h)("div",null,p&&(0,n.h)(r.h,{iconClass:f,buttonStyle:r.D.PLAIN,onClick:this.onToggleCollapsed}),(0,n.h)(r.h,{iconClass:"icon-close",buttonStyle:r.D.PLAIN,onClick:l}))),!m&&(h||null),!m&&i)}}},14738:(e,t,i)=>{"use strict";i.d(t,{g:()=>c});var n=i(26605),s=i(2116),o=i(94184),r=i(90601),a=i(43711),l=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let c=class Panels extends n.Component{constructor(e){super(e),this.togglePanel=()=>{const{activeTool:e,toolPanelLayout:t}=this.props;e&&t===r.wS.SIDE_PANEL&&this.setState((e=>{const t=!e.collapsed;return this.context.commandBinder.issueCommand(new a.zK(t)),{collapsed:t}}))},this.state={currentToolPanel:e.activeTool,closing:!1,collapsed:!1}}componentDidUpdate(e,t){const{activeTool:i,toolPanelLayout:n}=this.props;e.activeTool&&!i||e.toolPanelLayout!==r.wS.NONE&&n===r.wS.NONE?(window.clearTimeout(this.panelCloseTimeout),this.panelCloseTimeout=window.setTimeout((()=>{this.setState({currentToolPanel:null,closing:!1})}),600),this.setState({closing:!0})):!e.activeTool&&i?(window.clearTimeout(this.panelCloseTimeout),this.setState({currentToolPanel:i,closing:!1})):this.setState({currentToolPanel:i})}renderContent(){const{children:e}=this.props,{currentToolPanel:t}=this.state;if(e&&Array.isArray(e)&&e.length){const i=e.find((e=>e&&e.key===t));if(i)return i}return null}render(){const{allowToggle:e}=this.props,{closing:t,currentToolPanel:i,collapsed:s}=this.state,r={"panel-expanded":!!i&&!s},a=s?"Expand List":"Collapse List",l=s?"icon-dpad-left":"icon-dpad-right",c=this.renderContent();return(0,n.h)("div",{class:o("panels",r)},c&&e&&!t&&(0,n.h)("div",{class:"panel-track"},(0,n.h)("div",{class:"panel-track-thumb","data-balloon":a,"data-balloon-pos":"left",onClick:this.togglePanel},(0,n.h)("span",{class:`icon ${l}`}))),c)}};c=l([s.Z],c)},61597:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>Gui});var n=i(26605),s=i(54122),o=i(23338),r=i(79994),a=i(39936),l=i(63838);class Gui extends s.Y{constructor(){super(...arguments),this.name="gui",this.workshopApp=!1,this.onAppReadyChanged=(e,t)=>{this.workshopApp&&(t&&e?this.mainDiv.classList.add("edit-mode"):this.mainDiv.classList.remove("edit-mode"))}}async init(e,t){this.workshopApp=e.workshopApp,this.mainDiv=e.mainDiv,this.engine=t,this.messageBus=t,this.market=t.market,this.commandBinder=t.commandBinder;const i=t.getModule(r.default),n=t.getModule(o.default),s=t.market.waitForData(l.m),c=t.market.waitForData(a.e);this.mainArgs=await Promise.all([i,n,c,s]),this.preactRenderer=new PreactRenderer,t.addComponent(this,this.preactRenderer)}dispose(e){e.removeComponent(this,this.preactRenderer),this.bindings.forEach((e=>{e.cancel()})),this.bindings=[]}unloadUi(){}async loadUi(e){let t=[];return t=t.concat(this.mainArgs),t=t.concat([this.mainDiv,this.engine,this.messageBus,this.market,this.commandBinder,this.onAppReadyChanged]),e.apply(this,t)}}class PreactRenderer{render(){(0,n.rerender)()}init(){}dispose(){}activate(e){}deactivate(e){}}},82209:(e,t,i)=>{"use strict";i.d(t,{nV:()=>ModalToggledMessage,nZ:()=>PopupMenuOpenedMessage,Z_:()=>LoadIndicatorMessage,bN:()=>LoadIndicatorSuppressMessage});var n=i(93528);class ModalToggledMessage extends n.v{constructor(e,t){super(),this.modal=e,this.open=t}}class PopupMenuOpenedMessage extends n.v{constructor(e){super(),this.id=e}}class LoadIndicatorMessage extends n.v{constructor(e){super(),this.isOpen=e}}class LoadIndicatorSuppressMessage extends n.v{constructor(e){super(),this.suppress=e}}},17666:(e,t,i)=>{"use strict";i.d(t,{b:()=>c});var n=i(26605),s=i(2116),o=i(94184),r=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let a=class AccordionHeader extends n.Component{constructor(e){super(e)}render(){const{label:e,onToggle:t,children:i,appendClass:s}=this.props;return(0,n.h)("div",{class:o("accordion-header",s),onClick:t||void 0},i,(0,n.h)("span",{class:"accordion-header-label"},e),!!t&&(0,n.h)("button",{class:"icon accordion-icon accordion-toggle-icon"}))}};a=r([s.Z],a);var l=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let c=class AccordionGroup extends n.Component{constructor(e){super(e),this.toggleGroup=()=>{this.setState((e=>({expanded:!e.expanded})));const{id:e,onExpandChange:t}=this.props;t&&t(e,this.state.expanded)},this.state={expanded:!e.header||!!e.open};const{id:t,onExpandChange:i}=this.props;i&&i(t,this.state.expanded)}renderContents(){const{children:e,emptyMessage:t,doubleLine:i}=this.props,{expanded:s}=this.state,o=i?60:40,r=e&&Array.isArray(e)&&e.length||0,a=r>0;let l;return l=s?a?r*o+"px":"unset":"0",(0,n.h)("div",{class:"accordion-contents",style:`height: ${l}`},a?e:(0,n.h)("p",{class:"hint accordion-empty-message"},t||""))}renderHeader(){const{header:e,collapsible:t}=this.props,{expanded:i}=this.state,s="string"==typeof e?e:void 0;if(s)return(0,n.h)(a,{label:s,expanded:i,onToggle:t?this.toggleGroup:void 0});if(void 0!==e){const t=e;return(0,n.cloneElement)(t,{expanded:i,onToggle:this.toggleGroup})}return null}render(){const{doubleLine:e}=this.props,{expanded:t}=this.state;return(0,n.h)("div",{class:o("accordion-group",{expanded:t,collapsed:!t,"double-line":e})},this.renderHeader(),this.renderContents())}};c=l([s.Z],c)},20392:(e,t,i)=>{"use strict";i.d(t,{Q:()=>a});var n=i(26605),s=i(2116),o=i(94184),r=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let a=class AccordionItem extends n.Component{constructor(e){super(e),this.onClick=e=>{const t=e.target;this.props.onSelect&&!t.classList.contains("icon-more-vert")&&this.props.onSelect(this.props.sid)}}render(){const{enabled:e,selected:t,children:i,appendClass:s}=this.props,r={"accordion-item-disabled":!e,"accordion-item-selected":t};return s&&Object.keys(s).length>0&&Object.assign(r,s),(0,n.h)("div",{class:o("accordion-item",r),onClick:this.onClick},i)}};a=r([s.Z],a)},25382:(e,t,i)=>{"use strict";i.d(t,{n:()=>AccordionSelectorFooter});var n=i(94184),s=i(26605),o=i(42733),r=i(29359);const{TOGGLE_VISIBILITY_FOOTER_CTA:a,DELETE_FOOTER_CTA:l}=r.Z.WORKSHOP.ACCORDION;class AccordionSelectorFooter extends s.Component{constructor(e){super(e)}renderFooterButton(e,t,i){const{locale:n}=this.context,r=this.props.enabled&&!i,a=n.t(e);return(0,s.h)("span",{class:"footer-button-container"},(0,s.h)(o.zx,{buttonStyle:o.ZJ.CLEAR,buttonSize:o.qE.MINI,buttonState:r?o.BN.ENABLED:o.BN.DISABLED,onClick:t},a),";")}render(){const{active:e,leftButtonPhraseKey:t=l,leftButtonCallback:i,leftButtonDisabled:o=!1,rightButtonPhraseKey:r=a,rightButtonCallback:c,rightButtonDisabled:h=!1}=this.props,d={active:e},u=this.renderFooterButton(t,i,o),p=this.renderFooterButton(r,c,h);return(0,s.h)("div",{class:n("accordion-selector-footer",d)},(0,s.h)("div",{class:"footer-list"},u,p))}}},90197:(e,t,i)=>{"use strict";i.d(t,{y:()=>AccordionSelectorHeader});var n=i(94184),s=i(26605),o=i(42733),r=i(29359);const{DELETE_SELECTED_CTA:a,SELECT_ALL_CTA:l,ENTER_SELECT_MODE_CTA:c,EXIT_SELECT_MODE_CTA:h}=r.Z.WORKSHOP.ACCORDION;class AccordionSelectorHeader extends s.Component{constructor(e){super(e)}render(){const{locale:e}=this.context,{title:t,hasSelectedItems:i,selectMode:r,selectAllCallback:d,selectButtonCallback:u,hideToggle:p,disableToggle:m}=this.props,g={"select-mode":r},f=e.t(i?a:l),v=e.t(r?h:c);return(0,s.h)("div",{class:n("accordion-selector-header",g)},(0,s.h)("span",{class:"title"},r?(0,s.h)(o.zx,{buttonSize:o.qE.MINI,buttonStyle:o.ZJ.CLEAR,onClick:d},f):t),p||(0,s.h)(o.zx,{buttonSize:o.qE.MINI,buttonStyle:r?o.ZJ.CLEAR:o.ZJ.LIGHT,buttonState:m?o.BN.DISABLED:o.BN.ENABLED,onClick:u},v))}}},4633:(e,t,i)=>{"use strict";i.d(t,{F:()=>a});var n=i(26605),s=i(2116),o=i(94184),r=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let a=class Accordions extends n.Component{constructor(e){super(e)}render(){const{children:e,className:t}=this.props,i=t||"";return(0,n.h)("div",{class:o("accordion-list",[i])},e)}};a=r([s.Z],a)},22936:(e,t,i)=>{"use strict";i.d(t,{P:()=>c});var n=i(26605),s=i(29359);const{ACCORDION:o,MODAL:r}=s.Z.WORKSHOP;function a({itemTypePhraseKey:e,number:t}){const{locale:i}=this.context,n=i.t(e,t);return i.t(o.BATCH_DELETE_MODAL_TITLE,{itemType:n})}function l({itemTypePhraseKey:e,number:t}){const{locale:i}=this.context,n=i.t(e,t);return i.t(o.BATCH_DELETE_MODAL_MESSAGE,{number:t,itemType:n})}const c=(e,t)=>({title:(0,n.h)(a,{number:e,itemTypePhraseKey:t}),message:(0,n.h)(l,{number:e,itemTypePhraseKey:t}),cancellable:!0,cancelPhraseKey:r.NO,confirmPhraseKey:r.YES})},18288:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var n=i(26605),s=i(80429),o=i(42733),r=i(26265);function a(e){const{locale:t}=this.context,{id:i,visible:a,showTooltip:l,hideTooltip:c,forceDisable:h}=e,d=a?"icon-eye-show":"icon-eye-hide",u=a&&!h?o.BN.ENABLED:o.BN.DIMMED,p=h?void 0:t.t(a?c:l),m=h?()=>{}:this.props.onClick;return(0,n.h)(s.h,{appendClass:{"accordion-icon":!0,"accordion-item-toggle-icon":!0},iconClass:d,buttonStyle:s.D.PLAIN,buttonState:u,tooltipMsg:p,tooltipPosition:r.lZ.DOWN_RIGHT,dataValue:i,onClick:m})}},98784:(e,t,i)=>{"use strict";i.d(t,{A:()=>o});var n=i(26605),s=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(i[n[s]]=e[n[s]])}return i};const o=e=>class WithBatchSelect extends n.Component{constructor(e){super(e),this.toggleSelectMode=()=>{const{selectMode:e}=this.state;this.setState({checkedItems:new Set,selectMode:!e})},this.setGroupExpandState=(e,t)=>{const{expandedGroups:i}=this.state;i[e]=t,this.setState({expandedGroups:Object.assign({},i)})},this.onCheckboxClick=e=>{const t=e.dataset.value;t&&this.checkItem(t)},this.checkItem=e=>{e&&this.toggleId(e)},this.checkGroup=e=>{const t=e.items.every((e=>this.state.checkedItems.has(e.sid)||e.disableCheckbox));for(const i of e.items)i.disableCheckbox||this.setId(i.sid,!t,!1);this.setState({checkedItems:new Set(this.state.checkedItems)})},this.toggleId=e=>{const t=this.state.checkedItems.has(e);this.setId(e,!t)},this.clearSelected=()=>{this.setState({checkedItems:new Set})},this.setId=(e,t,i=!0)=>{t?this.state.checkedItems.add(e):this.state.checkedItems.delete(e),i&&this.setState({checkedItems:new Set(this.state.checkedItems)})},this.toggleAll=e=>{const{checkedItems:t}=this.state,i=0===t.size;for(const t in e){const n=e[t].items;for(const e of n)e.disableCheckbox||this.setId(e.sid,i,!1)}this.setState({checkedItems:new Set(this.state.checkedItems)})},this.setState({expandedGroups:{},checkedItems:new Set,selectMode:!1})}render(){const t=s(this.props,[]),{checkedItems:i,selectMode:o,expandedGroups:r}=this.state;return(0,n.h)(e,Object.assign({},t,{onCheckboxClick:this.onCheckboxClick,onSelectItem:this.checkItem,onSelectGroup:this.checkGroup,onSelectAll:this.toggleAll,clearSelected:this.clearSelected,toggleSelectMode:this.toggleSelectMode,selectMode:o,selectedItems:i,expandedGroups:r,onExpandChange:this.setGroupExpandState}))}}},59064:(e,t,i)=>{"use strict";i.d(t,{C:()=>a});var n=i(26605),s=i(2116),o=i(94184),r=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let a=class Badge extends n.Component{constructor(e){super(e)}render(){const{iconClass:e,label:t,badgeStyle:i,onClick:s}=this.props;return(0,n.h)("span",{class:o("badge",{clickable:!!s}),style:i,onClick:s},e&&(0,n.h)("span",{class:`icon badge-icon ${e}`}),t&&(0,n.h)("span",{class:"badge-label"},t))}};a=r([s.Z],a)},25255:(e,t,i)=>{"use strict";i.d(t,{A:()=>l});var n=i(26605),s=i(2116),o=i(94184),r=i(42733),a=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let l=class ButtonWithIcon extends n.Component{constructor(e){super(e)}render(){const{onClick:e,label:t,icon:i,buttonSize:s,buttonStyle:a,className:l}=this.props;return(0,n.h)(r.zx,{appendClass:{"button-with-icon":!0,[l]:!0},buttonSize:s,buttonStyle:a,onClick:e},(0,n.h)("span",{class:o("icon",i)}),t)}};l=a([s.Z],l)},73621:(e,t,i)=>{"use strict";i.d(t,{X:()=>a});var n=i(26605),s=i(94184),o=i(2116),r=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let a=class Checkbox extends n.Component{constructor(e){super(e),this.onChange=e=>{this.props.stopPropagation&&e.stopPropagation(),this.setState((e=>({checkedValue:!e.checkedValue})),(()=>{this.props.onChange&&this.props.onChange(this.checkboxElement)}))},this.setCheckboxRef=e=>{this.checkboxElement=e},this.state={checkedValue:e.checked}}componentWillReceiveProps(e){this.setState({checkedValue:e.checked})}render(){const{id:e,dataValue:t,enabled:i,error:o,key:r,helpText:a,label:l}=this.props,{checkedValue:c}=this.state,h=!i;return(0,n.h)("div",{ref:this.setCheckboxRef,id:e,"data-value":t,class:s("checkbox-element",{checked:c,disabled:h,error:o}),onClick:this.onChange,key:r},(0,n.h)("div",{class:"checkbox icon-checkmark"}),(0,n.h)("div",{class:"checkbox-text"},l),a&&(0,n.h)("span",{className:"help-text"},a))}};a.defaultProps={enabled:!0,error:!1},a=r([o.Z],a)},18120:(e,t,i)=>{"use strict";i.d(t,{$:()=>c});var n,s=i(26605),o=i(2116),r=i(67126),a=i(94184),l=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let c=n=class CircularProgressBar extends s.Component{constructor(e){super(e),this.strokePattern=[0,100],this.strokeOffset=0,this.innerRadius=15.92,this.strokeWidth=1,this.drawRadius=this.innerRadius+this.strokeWidth/2,this.updateSvgAttributes(e),this.elementId=this.props.id||"circle-progress-"+n.id++}componentWillReceiveProps(e){this.updateSvgAttributes(e)}updateSvgAttributes(e){this.strokeWidth=e.barWidth||this.strokeWidth,this.innerRadius=e.innerRadius||this.innerRadius,this.drawRadius=this.innerRadius+this.strokeWidth/2;const t=2*this.drawRadius*Math.PI;this.strokeOffset=t*(e.startPosition||this.strokeOffset),this.strokePattern[0]=t*(0,r.uZ)(e.progress,0,100)/100,this.strokePattern[1]=t-this.strokePattern[0]}render(){const{progressColor:e}=this.props,t=2*(this.innerRadius+this.strokeWidth),i=t/2;return(0,s.h)("svg",{id:this.elementId,class:a("circular-progress",this.props.appendClass),viewBox:`${-i} ${-i} ${t} ${t}`},(0,s.h)("circle",{class:"bar-bg",cx:"0",cy:"0",r:this.drawRadius,transform:"rotate(-90) "+(this.props.ccw?"scale(-1 1)":""),"stroke-dasharray":`${this.strokePattern[1]} ${this.strokePattern[0]}`,"stroke-dashoffset":this.strokeOffset-this.strokePattern[0],"stroke-width":this.strokeWidth,fill:"none"}),(0,s.h)("circle",{class:e?void 0:"progress",cx:"0",cy:"0",r:this.drawRadius,transform:"rotate(-90) "+(this.props.ccw?"scale(-1 1)":""),"stroke-dasharray":`${this.strokePattern[0]} ${this.strokePattern[1]}`,"stroke-width":this.strokeWidth,stroke:e,fill:"none"}),this.props.children)}};c.id=0,c=n=l([o.Z],c)},63985:(e,t,i)=>{"use strict";i.d(t,{i:()=>g});var n=i(91033),s=i(94184),o=i(26605),r=i(80429),a=i(2116),l=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r},c=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(i[n[s]]=e[n[s]])}return i};var h;!function(e){e.UP="up",e.DOWN="down"}(h||(h={}));let d=class Dropdown extends o.Component{constructor(e){super(e),this.onOutsideClick=e=>{this.toggleDropdown(!1)},this.onToggleClick=e=>{e.stopPropagation(),this.toggleDropdown()},this.onTransitionEnd=e=>{e&&e.target!==e.currentTarget||(window.clearTimeout(this.transitionTimeout),this.setState({transitioning:!1}))},this.toggleDropdown=e=>{const{open:t}=this.state,i=void 0!==e?e:!t;i?window.addEventListener("click",this.onOutsideClick):window.removeEventListener("click",this.onOutsideClick),this.transitionTimeout=window.setTimeout(this.onTransitionEnd,1e3),this.setState({open:i,transitioning:!0})},this.state={open:!1,transitioning:!1}}componentWillUnmount(){window.removeEventListener("click",this.onOutsideClick)}render(){const{open:e,transitioning:t}=this.state,i=this.props,{children:n,className:a,direction:l}=i,d=c(i,["children","className","direction"]),u={up:l===h.UP,open:e,transitioning:t};return(0,o.h)("div",Object.assign({className:s("dropdown",u,a)},d),(0,o.h)("div",{className:"dropdown-mask"},(0,o.h)("div",{className:"dropdown-menu",onTransitionEnd:this.onTransitionEnd},n)),(0,o.h)("div",{className:"dropdown-toggle"},(0,o.h)(r.h,{iconClass:"icon-toolbar-more-horiz",onClick:this.onToggleClick,appendClass:{"dropdown-toggle":!0}})))}};d.defaultProps={direction:h.DOWN},d=l([a.Z],d);var u=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r},p=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(i[n[s]]=e[n[s]])}return i};const m="collapsed";let g=class CollapsibleList extends o.Component{constructor(e){super(e),this.onResize=()=>{this.update()},this.setContentRef=e=>{this.contentRef=e},this.setCollapsedRef=e=>{this.collapsedRef=e},this.setToggleRef=e=>{this.toggleRef=e},this.state={collapsed:!1},this.observer=new n.Z(this.onResize)}componentDidMount(){this.connectObserver(),this.update()}componentDidUpdate(){this.update()}componentWillUnmount(){this.disconnectObserver(),this.reset()}connectObserver(){this.observer.observe(this.contentRef)}disconnectObserver(){this.observer&&this.observer.disconnect()}reset(){if(!this.contentRef)return;const e=this.contentRef.querySelectorAll(".collapsed");Array.from(e).forEach((e=>e.classList.remove(m)))}update(){if(!this.contentRef||!this.collapsedRef||!this.toggleRef)return;const e=this.contentRef.children,t=this.collapsedRef.children;if(!e||e.length!==t.length)return;const{collapsed:i}=this.state,n=this.contentRef.offsetWidth,s=this.toggleRef.base&&this.toggleRef.base.offsetWidth||0;let o=0,r=0;for(let i=0;i<e.length;i++){let a=e[i].offsetWidth||0;r||i!==e.length-1||(a-=s),o+=a,o<=n?(e[i].classList.remove(m),t[i].classList.add(m)):(r++,e[i].classList.add(m),t[i].classList.remove(m))}!!r!==i&&this.setState({collapsed:!i})}render(){const e=this.props,{children:t,className:i}=e,n=p(e,["children","className"]),{collapsed:r}=this.state,a=`collapsible-list ${i}`,l={hidden:!r};return t&&Array.isArray(t)?(0,o.h)("div",Object.assign({className:s(a)},n),(0,o.h)("div",{ref:this.setContentRef,class:"collapsible-list-items"},t),(0,o.h)(d,{ref:this.setToggleRef,direction:h.UP,className:s(l)},(0,o.h)("div",{ref:this.setCollapsedRef,class:"collapsible-list-menu"},t))):{children:t}}};g.defaultProps={},g=u([a.Z],g)},1402:(e,t,i)=>{"use strict";i.d(t,{z:()=>a});var n=i(26605),s=i(94184),o=i(2116),r=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let a=class ColorPicker extends n.Component{constructor(e){super(e),this.clickColor=e=>{const t=e.currentTarget;if(t&&t.getAttribute){const i=t.dataset.value;i&&(e.stopPropagation(),this.props.onColorPicked(i),this.setState({activeColor:i}))}},this.renderColorSwatch=e=>{const{activeColor:t}=this.state,i={backgroundColor:e},o=s({"color-swatch":!0,"icon-checkmark":!0,active:e===t});return(0,n.h)("div",{class:o,style:i,"data-value":e,onClick:this.clickColor})},this.state={activeColor:e.defaultColor||""}}componentWillReceiveProps(e){e.defaultColor&&!this.state.activeColor&&this.setState({activeColor:e.defaultColor})}render(){const{colors:e}=this.props;return(0,n.h)("div",{class:"color-picker"},e.map((e=>this.renderColorSwatch(e))))}};a=r([o.Z],a)},26265:(e,t,i)=>{"use strict";i.d(t,{lZ:()=>n,oO:()=>c});var n,s,o=i(26605),r=i(2116),a=i(94184),l=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};!function(e){e.UP="up",e.DOWN="down",e.LEFT="left",e.RIGHT="right",e.UP_LEFT="up-left",e.UP_RIGHT="up-right",e.DOWN_LEFT="down-left",e.DOWN_RIGHT="down-right"}(n||(n={})),function(e){e.SMALL="small",e.MEDIUM="medium",e.LARGE="large",e.XLARGE="xlarge",e.FIT="fit"}(s||(s={}));let c=class DataBalloon extends o.Component{constructor(){super(),this.onClick=e=>{this.props.onClick&&this.props.onClick(e),void 0!==this.props.tooltipTimeout&&window.setTimeout((()=>{this.setState({tooltipEnabled:!1})}),this.props.tooltipTimeout)},this.onMouseEnter=e=>{this.enableTooltip(),this.adjustBalloonPosIfNeeded(e)},this.enableTooltip=()=>{this.setState({tooltipEnabled:!0})},this.state={currentPosition:null,tooltipEnabled:!0}}render(){const{children:e,position:t,content:i,className:n,tooltipWidth:s}=this.props,{currentPosition:r,tooltipEnabled:l}=this.state;return(0,o.h)("div",{type:"button","data-balloon":i,"data-balloon-pos":r||t,"data-balloon-width":s,class:a("data-balloon",n,{disabled:!l}),onClick:this.onClick,onTouchStart:this.enableTooltip,onMouseEnter:this.onMouseEnter},e)}adjustBalloonPosIfNeeded(e){const{currentPosition:t}=this.state;if(null===t){const t=e.target,{position:i}=this.props;let s=i;if(i!==n.LEFT&&i!==n.RIGHT){const e=window.getComputedStyle(t,":after"),o=e.width?parseInt(e.width,10):0;if(o>0){const e=t.getBoundingClientRect(),r=(o-e.width)/2,a=i===n.UP||i===n.UP_RIGHT||i===n.UP_LEFT;e.left-r<=0?s=a?n.UP_RIGHT:n.DOWN_RIGHT:(i===n.UP_LEFT||i===n.DOWN_LEFT)&&e.left-o<=0?s=a?n.UP:n.DOWN:e.right+r>=window.innerWidth?s=a?n.UP_LEFT:n.DOWN_LEFT:(i===n.UP_RIGHT||i===n.DOWN_RIGHT)&&e.right+o>=window.innerWidth&&(s=a?n.UP:n.DOWN)}}this.setState({currentPosition:s})}}};c=l([r.Z],c)},65287:(e,t,i)=>{"use strict";i.d(t,{K:()=>f});var n,s=i(26605),o=i(2116),r=i(94184),a=i(48475),l=i(22729),c=i(86134),h=i(31399),d=i(80429),u=i(29359),p=i(73621),m=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};const{RENAME_HEADER_OPTION_CTA:g}=u.Z.WORKSHOP.ACCORDION;let f=n=class FloorRenameHeader extends s.Component{constructor(e){super(e),this.bindings=[],this.registerOnNameChanged=e=>{this.floorsViewData=e;const{group:t}=this.props;try{const i=e.getFloor(t.id),n=e.getDefaultFloorName(t.id);this.setState({renamable:!0,defaultName:n}),this.bindings.push(i.onPropertyChanged("name",this.onNameChanged)),this.onNameChanged(i.name)}catch(e){}},this.onNameChanged=e=>{if(this.floorsViewData){const t=this.floorsViewData.getFloorName(this.props.group.id),i=()=>this.setState({actualName:e,displayName:t});t===this.state.displayName?this.setState({actualName:e,displayName:e},i):i()}},this.onCheckboxClick=e=>{const{group:t,onSelectGroup:i}=this.props;i&&i(t)},this.startRename=e=>{e.stopPropagation(),this.setState({renaming:!0,menuOpen:!1})},this.renameFloor=e=>{this.context.commandBinder.issueCommand(new a.M(this.props.group.id,e)),this.setState({renaming:!1})},this.cancelRename=()=>{this.setState({renaming:!1})},this.setPopupMenu=e=>{e&&(this.popupMenu=e)},this.toggleOptionsMenu=e=>{const t=e.clientY+this.popupMenu.offsetHeight+c.u.POPUP_OFFSET>window.innerHeight?c.x.BOTTOM_RIGHT:c.x.TOP_RIGHT;this.setState((e=>({menuOpen:!e.menuOpen,arrowPosition:t})))},this.closeOptionsMenu=()=>{this.setState({menuOpen:!1})},this.toggleExpanded=e=>{const t=e.target;this.props.onToggle&&!t.classList.contains("icon-more-vert")&&this.props.onToggle()},this.state={renamable:!1,actualName:this.props.group.name,displayName:this.props.group.name,arrowPosition:c.x.TOP_RIGHT,renaming:!1,menuOpen:!1}}componentDidMount(){const{market:e}=this.context;e.waitForData(l.c).then(this.registerOnNameChanged)}componentWillUnmount(){for(const e of this.bindings)e.cancel()}renderOptionsMenu(){const{locale:e}=this.context,t=e.t(g);return(0,s.h)("div",{class:"tooltip-menu",ref:this.setPopupMenu},(0,s.h)("div",{class:"tpMsg",onClick:this.startRename},t))}isSelected(){const{group:e,selectedItems:t}=this.props;return!!t&&(e.items.length>0&&e.items.every((e=>t.has(e.sid))))}render(){const{group:e,multiFloor:t,selectMode:i}=this.props,{items:o,id:a}=e,{actualName:l,defaultName:u,displayName:m,renamable:g,renaming:f,menuOpen:v,arrowPosition:y}=this.state,b=this.isSelected(),w={"with-children":!!i,"accordion-header-editing":f,"accordion-collapsible":t,"accordion-header-select-mode":i};return(0,s.h)("div",{class:r("accordion-header","floor-rename-header",w),onClick:this.toggleExpanded},i&&(0,s.h)("div",{class:"accordion-checkbox"},(0,s.h)(p.X,{enabled:o.length>0,checked:b,id:a,onChange:this.onCheckboxClick,stopPropagation:!0,dataValue:a})),(0,s.h)(h.Z,{isDisabled:!1,editing:f,className:"accordion-header-label",text:f?l:m,placeholder:u,hint:`(${o.length})`,clickToEdit:!1,closeOnFocusOut:!0,onEdited:this.renameFloor,maxLength:n.maxFloorNameLength,showUnderline:f,readOnlyMode:!f,propagateMouseEvent:!f,onCancelEditing:this.cancelRename}),t&&(0,s.h)("button",{class:"icon accordion-icon accordion-toggle-icon"}),g&&(0,s.h)(d.h,{appendClass:{"accordion-more-options":!0},buttonStyle:d.D.PLAIN,iconClass:"icon-more-vert",onClick:this.toggleOptionsMenu},(0,s.h)(c.u,{open:v,onClose:this.closeOptionsMenu,message:this.renderOptionsMenu(),arrowPos:y,appendBodyClass:{"container--smallest--width":!0,"item-tooltip":!0}})))}};f.maxFloorNameLength=24,f.focusedFloor=-1,f=n=m([o.Z],f)},80429:(e,t,i)=>{"use strict";i.d(t,{D:()=>s,h:()=>u});var n,s,o=i(26605),r=i(2116),a=i(94184),l=i(21265),c=i(26265),h=i(42733),d=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};!function(e){e[e.CLEAR=0]="CLEAR",e[e.PLAIN=1]="PLAIN",e[e.OVERLAY=2]="OVERLAY",e[e.PRIMARY=3]="PRIMARY",e[e.SOCIAL=4]="SOCIAL",e[e.TOOLBAR=5]="TOOLBAR"}(s||(s={}));let u=n=class IconButton extends o.Component{constructor(e){super(e),this.onClick=e=>{const t=this.props.buttonState;t!==h.BN.BUSY&&t!==h.BN.DISABLED&&this.props.onClick&&this.props.onClick(e)},this.onMouseDown=e=>{const{onMouseDown:t,onClick:i,buttonState:s}=this.props;if(t)t(e);else if(n.iMobile&&i&&s!==h.BN.BUSY&&s!==h.BN.DISABLED){const t=document.activeElement;t&&e.cancelable&&(t.blur(),e.preventDefault())}}}render(){const{id:e,tooltipMsg:t,tooltipPosition:i,tooltipPreformatted:n,tooltipWidth:r,dataValue:l,buttonState:d,buttonStyle:u,buttonSize:p,appendClass:m,children:g,iconClass:f,onClick:v,onMouseUp:y}=this.props,b=d===h.BN.DISABLED,w=d===h.BN.BUSY,S=d===h.BN.DECORATIVE,E=!b&&!w&&!S,T=t?i||c.lZ.DOWN:void 0,M=t?!!n:void 0,_={"button-small":p===h.qE.SMALL,"button-large":p===h.qE.LARGE,"button-disabled":b,"button-dimmed":d===h.BN.DIMMED,"button-active":d===h.BN.ACTIVE,"button-busy":w,"button-interactive":E,"icon-button-primary":u===s.PRIMARY,"icon-button-overlay":u===s.OVERLAY,"icon-button-plain":u===s.PLAIN,"icon-button-social":u===s.SOCIAL,"icon-button-toolbar":u===s.TOOLBAR};return m&&Object.keys(m).length>0&&Object.assign(_,m),(0,o.h)("div",{id:e,role:"button","data-value":l,"data-balloon":t,"data-balloon-pos":T,"data-balloon-width":r,"data-balloon-pre":M,class:a("icon-button",_),onClick:v?this.onClick:void 0,onMouseUp:y,onMouseDown:this.onMouseDown},f&&(0,o.h)("span",{class:`icon ${f}`}),g)}};u.iMobile=(0,l.s)()||(0,l._1)(),u=n=d([r.Z],u)},42190:(e,t,i)=>{"use strict";i.d(t,{s:()=>LinkEditor});var n=i(26605),s=i(98867),o=i(2752),r=i(80429),a=i(26265),l=i(14071),c=i(47133),h=i(42733);class LinkEditor extends n.Component{constructor(e){super(e),this.open=e=>{this.el.classList.add("open"),this.focus(e.urlFocus)},this.close=()=>{this.urlInput&&this.urlInput.blur(),this.textInput&&this.textInput.blur(),this.el.classList.remove("open")},this.onEditedUrl=e=>{const{validUrl:t,currentText:i}=this.state;if(!t)return;const n=""!==i?i:e;this.props.onSaveLink(n,e)},this.onInputUrl=e=>{this.setState({validUrl:(0,s.j)(e),currentUrl:e})},this.onEditedText=e=>{this.focus(!0)},this.onInputText=e=>{this.setState({currentText:e})},this.onApply=e=>{this.state.currentUrl&&this.onEditedUrl(this.state.currentUrl)},this.onClose=e=>{this.close(),this.props.onCancel()},this.onPreviewUrl=()=>{this.state.validUrl&&window.open(this.state.currentUrl,"_blank")},this.stopPropagation=e=>{e.stopPropagation()},this.setRef=e=>this.el=e,this.setUrlRef=e=>this.urlInput=e,this.setTextRef=e=>this.textInput=e,this.state={currentUrl:e.linkUrl,currentText:e.linkText,validUrl:!0}}componentDidMount(){this.context.messageBus.subscribe(o.g,this.open),this.context.messageBus.subscribe(o.Z,this.close)}componentWillUnmount(){this.context.messageBus.unsubscribe(o.g,this.open),this.context.messageBus.unsubscribe(o.Z,this.close)}componentWillReceiveProps(e){this.state.currentUrl!==e.linkUrl&&this.setState({currentUrl:e.linkUrl}),this.state.currentText!==e.linkText&&this.setState({currentText:e.linkText})}focus(e=!1){e?this.urlInput&&this.urlInput.focus():this.textInput&&this.textInput.focus()}renderButtons(){const{validUrl:e,currentUrl:t}=this.state,{onRemoveLink:i,linkText:s,linkUrl:o}=this.props,l=""!==s&&""!==o,c=!t||!e?h.BN.DISABLED:h.BN.ENABLED;return(0,n.h)("div",{class:"popover-footer"},this.renderValidationMessage(),l&&(0,n.h)(r.h,{iconClass:"icon-delete",buttonStyle:r.D.CLEAR,tooltipMsg:"Remove Link",tooltipPosition:a.lZ.UP,onClick:i}),(0,n.h)(h.zx,{appendClass:{"button-inline":!0},buttonStyle:h.ZJ.CLEAR,buttonSize:h.qE.SMALL,buttonState:c,onClick:this.onApply},"Apply"))}renderValidationMessage(){const{linkText:e,linkUrl:t}=this.props,{validUrl:i,currentUrl:s}=this.state,o=""===e&&""===t&&""===s;return!i&&s?(0,n.h)("div",{class:"popover-message popover-message-error"},"Invalid URL"):(0,n.h)("div",{class:"popover-message"},o&&"Tip: Turn text into a link by selecting the text before clicking 'Add Link'")}render(){const{validUrl:e,currentText:t,currentUrl:i}=this.state;return(0,n.h)("div",{ref:this.setRef,class:"annotation-popup link-editor",onClick:this.stopPropagation},(0,n.h)("div",{class:"popover-header"},(0,n.h)("div",{class:"popover-label"},"Text"),(0,n.h)(l.P,{buttonStyle:l.A.LIGHT,onClose:this.onClose})),(0,n.h)(c.Z,{ref:this.setTextRef,text:t,onDone:this.onEditedText,onInput:this.onInputText}),(0,n.h)("div",{class:"url-field"},(0,n.h)("div",{class:"popover-label"},"Link to"),(0,n.h)(c.Z,{ref:this.setUrlRef,text:i,type:"url",placeholder:"https://",onDone:this.onEditedUrl,onInput:this.onInputUrl}),e&&i&&(0,n.h)(r.h,{appendClass:{"preview-link":!0},iconClass:"icon-ext-link",buttonStyle:r.D.PLAIN,tooltipMsg:"Preview Link",tooltipPosition:a.lZ.UP,onClick:this.onPreviewUrl})),this.renderButtons())}}},2752:(e,t,i)=>{"use strict";i.d(t,{g:()=>OpenLinkEditorMessage,Z:()=>CloseLinkEditorMessage});var n=i(93528);class OpenLinkEditorMessage extends n.v{constructor(e=!1){super(),this.urlFocus=e}}class CloseLinkEditorMessage extends n.v{}},81323:(e,t,i)=>{"use strict";i.d(t,{$:()=>r});var n=i(26605),s=i(2116),o=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let r=class ListNavigation extends n.Component{constructor(e){super(),this.onGotoNextNote=()=>{const e=this.getNextIndex();-1!==e&&this.props.onNavigate(e)},this.onGotoPrevNote=()=>{const e=this.getPrevIndex();-1!==e&&this.props.onNavigate(e)}}getNextIndex(){const{total:e,index:t,wrapAround:i}=this.props;return t+1<e?t+1:i?0:-1}getPrevIndex(){const{total:e,index:t,wrapAround:i}=this.props;return t>0?t-1:i?e-1:-1}render(){const{total:e,index:t,disabled:i}=this.props;if(e<2||-1===t)return null;const s=i||-1===this.getNextIndex()?"disabled":"",o=i||-1===this.getPrevIndex()?"disabled":"",r=`${t+1} of ${e}`;return(0,n.h)("div",{class:"list-nav"},(0,n.h)("span",{class:"list-nav-btn list-nav-btn-prev"},(0,n.h)("span",{class:`icon icon-dpad-left ${o}`,onClick:this.onGotoPrevNote})),(0,n.h)("span",{class:"list-nav-label"},r),(0,n.h)("span",{class:"list-nav-btn list-nav-btn-next"},(0,n.h)("span",{class:`icon icon-dpad-right ${s}`,onClick:this.onGotoNextNote})))}};r=o([s.Z],r)},76104:(e,t,i)=>{"use strict";i.d(t,{E:()=>a});var n=i(26605),s=i(94184),o=i(2116),r=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let a=class RadioButton extends n.Component{constructor(e){super(e),this.onChange=e=>{this.props.onChange(e)}}render(){const{id:e,name:t,value:i,checked:o,children:r,enabled:a}=this.props,l=!a;return(0,n.h)("div",{class:s("radio-element","radio-button",{disabled:l})},(0,n.h)("input",{type:"radio",id:e,name:t,value:i,checked:o,onChange:this.onChange}),(0,n.h)("label",{for:e},r))}};a=r([o.Z],a)},74121:(e,t,i)=>{"use strict";i.d(t,{S:()=>SelectMenu,K:()=>n});var n,s=i(26605),o=i(86134),r=i(94184);class SelectMenu extends s.Component{constructor(e){super(e),this.onSelectOption=e=>{const t=e.target,i=t.getAttribute("data-index"),n=t.getAttribute("data-value");i&&this.props.onSelect(parseInt(i,10),n)}}getSelectedOption(){return this.props.options.find((e=>e.selected))||null}renderPopupContents(){const e=[];return this.props.options.forEach(((t,i)=>{const n=t.className||"";e.push((0,s.h)("div",{"data-index":i,"data-value":t.value,class:r({tpMsg:!0,disabled:!!t.disabled,[n]:!!n}),onClick:this.onSelectOption},t.text))})),(0,s.h)("div",{class:"tooltip-menu"},e)}render(){const{id:e,onToggle:t,open:i,onClose:a,arrowPos:l,label:c,className:h,menuStyle:d}=this.props,u=this.getSelectedOption(),p=u?u.text:"",m=h||"",g={[m]:!!m,"select-button":d===n.BUTTON,"select-dropdown":d===n.DROPDOWN};return(0,s.h)("div",{class:r("select-popup",g),id:e},c&&(0,s.h)("label",{class:"select-label"},c),(0,s.h)("div",{class:"select-trigger",onClick:t},(0,s.h)("span",{class:"select-menu-text"},p),(0,s.h)("span",{class:"icon icon-dpad-down"}),(0,s.h)(o.u,{open:!!i,onClose:a,message:this.renderPopupContents(),arrowPos:l||o.x.NONE,appendBodyClass:{"item-tooltip":!0}})))}}!function(e){e[e.DROPDOWN=0]="DROPDOWN",e[e.BUTTON=1]="BUTTON"}(n||(n={}))},7351:(e,t,i)=>{"use strict";i.d(t,{J:()=>a});var n=i(26605),s=i(2116),o=i(86134),r=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let a=class SettingsBox extends n.Component{constructor(){super(...arguments),this.stopClickPropagation=e=>{e.stopPropagation()}}render(){const{children:e,open:t,appendClass:i,close:s,arrowPosition:r}=this.props,a=(0,n.h)("div",{class:"settings-container settings-box",onClick:this.stopClickPropagation},e);return(0,n.h)(o.u,{open:t,message:a,appendClass:i,arrowPos:r,onClose:s})}};a=r([s.Z],a)},75328:(e,t,i)=>{"use strict";i.d(t,{w:()=>r});var n=i(26605),s=i(2116),o=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let r=class SettingsToggle extends n.Component{render(){const{label:e,children:t,appendClass:i}=this.props,s=i||"";return(0,n.h)("div",{class:`settings-toggle ${s}`},e&&(0,n.h)("div",{class:"settings-label"},e),t)}};r=o([s.Z],r)},65277:(e,t,i)=>{"use strict";i.d(t,{Z:()=>SingleScrollbar});var n=i(26605),s=i(94184),o=i(67126),r=i(20072),a=i(95843),l=i(85768),c=i(1481),h=i(67538),d=i(1799),u=i(10396),p=i(80429),m=i(42733);n.options.debounceRendering=requestAnimationFrame;class SingleScrollbar extends n.Component{constructor(e){super(e),this.dragStartScroll=0,this.listening=!1,this.animation=null,this.handlingPaused=!1,this.handleEvent=e=>{"mousedown"!==e.type&&"pointerdown"!==e.type&&"touchstart"!==e.type||(this.handlingPaused=!1),this.props.suppressDrag||this.handlingPaused||this.inputFilter.handleEvent(e)},this.getScrolledOffset=()=>{if(!this.innerWrapper&&0===this.state.contentSize)return 0;const e=this.props.direction===a.Nm.vertical?"scrollTop":"scrollLeft";return this.innerWrapper[e]/this.state.contentSize},this.getScrollableContainer=()=>this.innerWrapper,this.pauseScrollHandling=()=>{this.handlingPaused=!0,this.toggleDownEventListening(!1)},this.scrollWithScrollBar=e=>{if(!this.props.suppressDrag){const t=this.getAxis();e.hasOwnProperty(t)&&this.scrollTo(e[t])}},this.scrollTo=e=>{void 0===e||isNaN(e)||(this.setScrollPosition(Math.max(Math.min(1,e)*this.state.contentSize,0)),this.setState({scrollOffset:this.getScrollPosition()}))},this.handleDragStart=()=>{this.setState({scrollCenter:null})},this.handlePressStart=()=>{this.dragStartScroll=this.getScrollPosition()},this.handlePressMove=e=>{if(!this.props.suppressDrag){const t=(e[this.getAxis()]+this.dragStartScroll)/this.state.contentSize;this.scrollTo(t)}},this.handleWheelEvent=e=>{if(this.props.suppressDrag)return void e.preventDefault();this.props.direction===a.Nm.horizontal&&0===e.deltaX&&0!==e.deltaY?(this.handlePressStart(),this.handlePressMove({x:e.deltaY,y:0})):(this.setState({scrollCenter:null}),this.handleExternalChange())},this.handleClick=e=>{this.props.handleClick&&this.props.handleClick(e)},this.handleDragEnd=(e,t)=>{const i=e[this.getAxis()]/t,n=Math.min(a.UI,Math.abs(a.UI*i)),s=this.getScrollPosition(),o=i*n/2;this.animation=new c.Z({duration:n,startValue:s/this.state.contentSize,endValue:Math.max(0,Math.min((s+o)/this.state.contentSize,1)),easingFunction:d.hl})},this.onManualScroll=()=>{this.props.onScrolled&&this.props.onScrolled()},this.onButtonScroll=e=>{if(this.contentContainer&&this.props.steps){const t=this.props.direction===a.Nm.vertical?"offsetHeight":"offsetWidth",i=this.contentContainer[t]/this.props.steps,n=this.getScrollPosition();let s;s=e?(n+i)/this.state.contentSize:(n-i)/this.state.contentSize,this.scrollTo((0,o.uZ)(s,0,1))}},this.onScrollBack=()=>{this.onButtonScroll(!1)},this.onScrollForward=()=>{this.onButtonScroll(!0)},this.onHoldScrollBack=()=>{this.mouseInterval=window.setInterval(this.onScrollBack,300)},this.onHoldScrollForward=()=>{this.mouseInterval=window.setInterval(this.onScrollForward,300)},this.onScrollButtonUp=()=>{window.clearInterval(this.mouseInterval)},this.renderScrollBackButton=()=>{const e=this.getScrollPosition(),t=this.props.direction===a.Nm.vertical?"icon-dpad-up":"icon-dpad-left",i=0===e?m.BN.DISABLED:m.BN.ENABLED;return(0,n.h)(p.h,{appendClass:{"scroll-button":!0,"scroll-back":!0},iconClass:t,buttonStyle:p.D.CLEAR,buttonState:i,onClick:this.onScrollBack,onMouseDown:this.onHoldScrollBack,onMouseUp:this.onScrollButtonUp})},this.renderScrollForwardButton=()=>{const e=this.getScrollPosition(),t=this.props.direction===a.Nm.vertical?"offsetHeight":"offsetWidth",i=this.props.direction===a.Nm.vertical?"icon-dpad-down":"icon-dpad-right",s=this.contentContainer[t]-this.innerWrapper[t]-e>0?m.BN.ENABLED:m.BN.DISABLED;return(0,n.h)(p.h,{appendClass:{"scroll-button":!0,"scroll-forward":!0},iconClass:i,buttonStyle:p.D.CLEAR,buttonState:s,onClick:this.onScrollForward,onMouseDown:this.onHoldScrollForward,onMouseUp:this.onScrollButtonUp})},this.setOuterWrapper=e=>this.outerWrapper=e,this.setInnerWrapper=e=>this.innerWrapper=e,this.setcontentContainer=e=>this.contentContainer=e,this.state={scrollCenter:null,scrollOffset:0,innerSize:0,contentSize:0},this.resizeSubscription=(0,u.kp)(u.g_.RESIZE,(()=>this.handleExternalChange(u.g_.RESIZE))),this.inputFilter=new h.Z({handlePressStart:this.handlePressStart,handlePressMove:this.handlePressMove,handleDragStart:this.handleDragStart,handleDragEnd:this.handleDragEnd,handleClick:this.handleClick})}componentDidMount(){this.resizeSubscription.renew(),this.props.thumbScrollingOnly?this.innerWrapper.addEventListener("click",this.handleClick):this.toggleDownEventListening(!0),this.toggleDragHandling(!0),this.innerWrapper.addEventListener("wheel",this.handleWheelEvent),this.inputFilter.setEnabled(!this.props.suppressDrag),this.handleExternalChange()}componentWillUnmount(){this.resizeSubscription.cancel(),this.innerWrapper.removeEventListener("wheel",this.handleWheelEvent),this.toggleDragHandling(!1),this.props.thumbScrollingOnly?this.innerWrapper.removeEventListener("click",this.handleClick):this.toggleDownEventListening(!1)}componentWillReceiveProps(e){e.thumbScrollingOnly&&!this.props.thumbScrollingOnly?(this.innerWrapper.addEventListener("click",this.handleClick),this.toggleDownEventListening(!1)):!e.thumbScrollingOnly&&this.props.thumbScrollingOnly&&(this.toggleDownEventListening(!0),this.innerWrapper.removeEventListener("click",this.handleClick)),e.suppressDrag!==this.props.suppressDrag&&this.inputFilter.setEnabled(!e.suppressDrag)}componentDidUpdate(e,t){const i=this.animation;if(i)if(i.isAnimating){const e=i.getUpdatedValue();window.requestAnimationFrame((()=>{this.innerWrapper&&this.scrollTo(e)}))}else this.animation=null;t.scrollOffset!==this.state.scrollOffset&&this.props.onScrolled&&this.props.onScrolled()}toggleDownEventListening(e){const t=this.handleEvent;e?window.PointerEvent?this.innerWrapper.addEventListener("pointerdown",t):(this.innerWrapper.addEventListener("mousedown",t),this.innerWrapper.addEventListener("touchstart",t)):window.PointerEvent?this.innerWrapper.removeEventListener("pointerdown",t):(this.innerWrapper.removeEventListener("mousedown",t),this.innerWrapper.removeEventListener("touchstart",t))}toggleDragHandling(e){const t=this.handleEvent;!this.listening&&e?(this.listening=!0,window.PointerEvent?(window.addEventListener("pointermove",t),window.addEventListener("pointerup",t)):(window.addEventListener("mousemove",t),window.addEventListener("mouseleave",t),window.addEventListener("mouseup",t),window.addEventListener("touchmove",t),window.addEventListener("touchend",t),window.addEventListener("touchcancel",t))):this.listening&&!e&&(this.listening=!1,window.PointerEvent?(window.removeEventListener("pointermove",t),window.removeEventListener("pointerup",t)):(window.removeEventListener("mousemove",t),window.removeEventListener("mouseleave",t),window.removeEventListener("mouseup",t),window.removeEventListener("touchmove",t),window.removeEventListener("touchend",t),window.removeEventListener("touchcancel",t)))}getScrollPosition(){if(!this.innerWrapper)return 0;const e=this.props.direction===a.Nm.vertical?"scrollTop":"scrollLeft";return this.innerWrapper[e]}setScrollPosition(e){if(!this.innerWrapper)return;const t=this.props.direction===a.Nm.vertical?"scrollTop":"scrollLeft";this.innerWrapper[t]=e}getAxis(){return this.props.direction===a.Nm.vertical?"y":"x"}getSnapshotBeforeUpdate(){this.props.waitToUpdate||this.handleExternalChange()}scrollToPercentage(e,t){this.animation=new c.Z({duration:t,startValue:this.getScrolledOffset(),endValue:Math.max(0,Math.min(1,e))})}scrollToElement(e){if(!(e&&e.compareDocumentPosition(this.innerWrapper)&Node.DOCUMENT_POSITION_CONTAINS))return;const t=this.props.direction===a.Nm.vertical;this.setState({scrollCenter:e});const i=t?"offsetTop":"offsetLeft",n=t?"offsetHeight":"offsetWidth";let s=e[i]+e[n]/2,o=e;for(;o.parentElement&&o!==this.innerWrapper;)o=o.parentElement,s+=o[i];const r=(s-this.outerWrapper.parentElement[n]/2)/this.state.contentSize;this.animation=new c.Z({duration:a.UI,startValue:this.getScrollPosition()/this.state.contentSize,endValue:Math.max(0,Math.min(1,r))})}handleExternalChange(e){if(!this.innerWrapper||!this.contentContainer)return;this.state.scrollCenter&&e&&e===u.g_.RESIZE&&this.scrollToElement(this.state.scrollCenter);const t=this.props.direction===a.Nm.vertical?"clientHeight":"clientWidth",i={innerSize:Number(this.innerWrapper&&this.innerWrapper[t])||1,contentSize:Number(this.contentContainer&&this.contentContainer[t])||1,scrollOffset:this.innerWrapper&&this.getScrollPosition()};(0,r.g)(this.state,i)&&this.setState(i)}needScrolling(){if(!this.contentContainer||!this.outerWrapper)return!1;const e=this.props.direction===a.Nm.vertical?"offsetHeight":"offsetWidth";return this.contentContainer[e]>this.outerWrapper[e]}render(){const{hideScrollbar:e,children:t,onScrollableChanged:i,scrollButtons:o,steps:r,onScrollPositionChange:a,direction:c,className:h}=this.props,{innerSize:d,contentSize:u,scrollOffset:p}=this.state,m=o&&!!r&&this.needScrolling();return(0,n.h)("div",{class:s("outerScrollbarWrapper",[c],[h],{"button-scrolling":m}),ref:this.setOuterWrapper},m&&this.renderScrollBackButton(),(0,n.h)("div",{class:"innerScrollbarWrapper",ref:this.setInnerWrapper},(0,n.h)("div",{class:"paddingScrollbarWrapper",ref:this.setcontentContainer},t)),(0,n.h)(l.L,{direction:c,wrapperLength:d,childLength:u,scrollOffset:p,scrollTo:this.scrollWithScrollBar,forceHidden:!!e,onVisibilityChange:i,onScrollPositionChange:a,onThumbDrag:this.onManualScroll}),m&&this.renderScrollForwardButton())}}},79830:(e,t,i)=>{"use strict";i.d(t,{h:()=>a,S:()=>SliderWithTooltip});var n=i(26605),s=i(28276),o=i(94184);let r=0;class SliderWithTooltip extends n.Component{constructor(e){super(e),this.setValue=e=>{this.setState({value:e}),this.slider&&this.slider.setValue(e)},this.getValue=()=>{const e=this.slider.getValue();return"object"==typeof e?e.value:e},this.onSliderInput=()=>{var e;this.layoutRecalculated||(null===(e=this.slider.MDComponent)||void 0===e||e.layout(),this.layoutRecalculated=!0);const t=this.getValue();this.setState({value:t}),this.props.onInput&&this.props.onInput(t)},this.onSliderChange=()=>{const e=this.getValue();this.setState({value:e}),this.props.onChange&&this.props.onChange(e)},this.getLeftOffset=()=>100*(this.state.value-this.props.min)/(this.props.max-this.props.min)+"%",this.getSliderId=()=>`slider-with-tooltip-${this.id}`,this.getStyleElement=()=>`#${this.getSliderId()} .mdc-slider__thumb-container {\n        left: ${this.getLeftOffset()}\n    }`,this.getDisplayValue=e=>{const{formatNumbers:t,units:i}=this.props;return(t?t(e):e)+(i||"")},this.setActive=e=>()=>this.setState({active:e}),this.hasChanged=()=>{this.setState({hasChanged:!1})},this.onMouseDown=e=>{this.props.onInputStart&&this.props.onInputStart()},this.onMouseUp=e=>{this.props.onInputEnd&&this.props.onInputEnd()},this.id=r++,this.state={value:void 0!==e.initialValue?e.initialValue:(e.max+e.min)/2,active:!1,hasChanged:!1},this.setActiveSlider=this.setActive(!0),this.setInactiveSlider=this.setActive(!1)}componentDidMount(){document.addEventListener("mouseup",this.onMouseUp),document.addEventListener("mouseleave",this.onMouseUp)}componentWillUnmount(){document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("mouseleave",this.onMouseUp)}componentDidUpdate(e,t){t.value!==this.state.value&&(clearTimeout(this.hasChangedTimeout),this.setState({hasChanged:!0}),this.hasChangedTimeout=window.setTimeout(this.hasChanged,450))}render(){const{width:e,displayBounds:t,min:i,max:r,discrete:l,tooltipPosition:c}=this.props,{active:h,hasChanged:d,value:u}=this.state;return(0,n.h)("div",{id:this.getSliderId(),class:o("slider-with-tooltip",{displayBounds:t}),style:`width:${e}px`,onMouseEnter:this.setActiveSlider,onMouseLeave:this.setInactiveSlider},c===a.UP&&(0,n.h)("div",{class:o("slider-tooltip",{active:h||d}),"data-balloon":this.getDisplayValue(u),"data-balloon-pos":a.UP,style:{left:this.getLeftOffset()}}),t&&(0,n.h)("div",{class:"min-amount"},this.getDisplayValue(i)),(0,n.h)(s.ZP,{ref:e=>this.slider=e,discrete:l,min:i,max:r,value:u,onInput:this.onSliderInput,onChange:this.onSliderChange,onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp}),t&&(0,n.h)("div",{class:"max-amount"},this.getDisplayValue(r)),(0,n.h)("style",{dangerouslySetInnerHTML:{__html:this.getStyleElement()}}),c===a.DOWN&&(0,n.h)("div",{class:o("slider-tooltip",{active:h||d}),"data-balloon":this.getDisplayValue(u),"data-balloon-pos":a.DOWN,style:{left:this.getLeftOffset()}}))}}var a;!function(e){e.UP="up",e.DOWN="down"}(a||(a={}))},84245:(e,t,i)=>{"use strict";i.d(t,{KQ:()=>n});const n=e=>{let t="";t+=Math.floor(e)+"'";const i=Math.floor(e%1*12);return i<10&&(t+="0"),t+=i+"''",t}},31399:(e,t,i)=>{"use strict";i.d(t,{Z:()=>p});var n=i(26605),s=i(94184),o=i(35825),r=i(2116),a=i(58091),l=i(95843),c=i(21265),h=i(93273),d=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let u=class TextInput extends n.Component{constructor(e){super(e),this.touchDevice=(0,c.Jm)(),this.handleOutsideClick=e=>{if(!this.state.editing||!this.input)return;const t=this.getTextString(this.input.value,this.props.defaultText);this.stopEditing(t,!0)},this.stopEditing=(e,t=!0)=>{this.setState({editing:!1}),t&&this.props.text!==e?(this.setState({currentText:e}),this.props.onEdited&&this.props.onEdited(e)):this.props.onCancelEditing&&this.props.onCancelEditing()},this.stopPropagation=e=>{e.stopPropagation()},this.onBlur=()=>{this.context.engine.broadcast(new h.S(this.input,!1))},this.onFocus=()=>{this.context.engine.broadcast(new h.S(this.input,!0))},this.startEditing=e=>{if(!this.input)return;e&&e.stopPropagation();const{onStartEditing:t,autoSelect:i,defaultText:n}=this.props,{currentText:s}=this.state;this.setState({editing:!0}),t&&t(),this.input.focus(),(i||n&&this.input.select&&s===n)&&this.input.select()},this.onKeyPress=e=>{if(this.props.onKeyPress&&this.props.onKeyPress(e))return;e.stopPropagation();const t=e.which||e.keyCode;if(!("keydown"===e.type&&t!==o.R.TAB||t!==o.R.RETURN&&t!==o.R.TAB||e.shiftKey)){e.preventDefault(),this.input.blur(),this.setState({editing:!1});const t=this.getTextString(e.target.value,this.props.defaultText);this.props.onEdited&&this.props.onEdited(t)}},this.onInput=e=>{const t=e.target.value;this.setState({currentText:t}),this.props.onInput&&this.props.onInput(t)},this.setRef=e=>{this.input=e},this.state={editing:!1,currentText:this.props.text}}componentDidMount(){this.input&&(this.input.addEventListener("keypress",this.stopPropagation),this.input.addEventListener("keydown",this.stopPropagation),this.input.addEventListener("keyup",this.stopPropagation),this.props.closeOnFocusOut&&this.input.addEventListener("focusout",this.handleOutsideClick),this.touchDevice&&(this.input.addEventListener("blur",this.onBlur),this.input.addEventListener("focus",this.onFocus)),(this.props.editing||this.props.autofocus)&&this.startEditing())}componentWillUnmount(){this.input&&(this.input.removeEventListener("keypress",this.stopPropagation),this.input.removeEventListener("keydown",this.stopPropagation),this.input.removeEventListener("keyup",this.stopPropagation),this.props.closeOnFocusOut&&this.input.removeEventListener("focusout",this.handleOutsideClick),this.touchDevice&&(this.input.removeEventListener("blur",this.onBlur),this.input.removeEventListener("focus",this.onFocus)),this.input.blur())}componentWillReceiveProps(e){if(e.editing&&!this.props.editing&&this.startEditing(),e.text!==this.props.text){const t=this.getTextString(e.text,e.defaultText);this.setState({currentText:t})}}componentDidUpdate(e,t){this.input&&(!t.editing&&this.state.editing?this.input.focus():t.editing&&!this.state.editing&&this.input.blur())}getTextString(e,t){return""===e&&void 0!==t?t:e}setCurrentText(e){this.setState({currentText:e}),this.focusInput(),this.props.onEdited&&this.props.onEdited(e)}getCurrentText(){return this.state.currentText}focusInput(){this.input&&this.input.focus()}getFractionalCounter(){if(this.props.maxLength&&this.props.fractionalCounter)return`${this.state.currentText.length}/${this.props.maxLength}`}render(){const{editing:e,currentText:t}=this.state,{appendClass:i,hint:o,isDisabled:r,placeholder:c,noFocusedPlaceholder:h,clickToEdit:d,maxLength:u,tabIndex:p,textarea:m,readOnlyText:g,autocapitalize:f,fractionalCounter:v,showUnderline:y,className:b}=this.props,w=!(t||!c||e&&h),S=w?c:void 0,E=!1!==d?this.startEditing:void 0,T=b||"",M={inputDiv:!0,editing:e};i&&Object.keys(i).length>0&&Object.assign(M,i);const _={ref:this.setRef,class:s(M),type:"text",value:t,placeholder:S,maxLength:u,onInput:this.onInput,onClick:this.props.propagateMouseEvent?void 0:this.stopPropagation,onKeyPress:this.onKeyPress,disabled:r,readonly:this.props.readOnlyMode,onKeyDown:this.onKeyPress,tabIndex:p,autocapitalize:f},x=(0,n.h)("div",{class:"current-text",onClick:E,"data-hint":o},t||c||"");return(0,n.h)("div",{class:s("modifiable-text",`${T}`,{editing:e,"fractional-counter":v,default:!t,"has-hint":!!o,"has-placeholder":w}),"data-hint":o,"data-fractional-counter":this.getFractionalCounter()},m?(0,n.h)(a.Z,{name:"text-input",singleScrollDirection:l.Nm.vertical,forceHidden:!1},x):x,(0,n.h)(m?"textarea":"input",_),g&&(0,n.h)("div",{class:"read-only-text"},g),y&&(0,n.h)("div",{class:"editable-line"}))}};u=d([r.Z],u);const p=u},47133:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var n=i(26605),s=i(2116),o=i(35825),r=i(93273),a=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let l=class TextInputBox extends n.Component{constructor(e){super(e),this.onInput=e=>{if(this.props.onInput){const t=e.target;this.props.onInput(t.value)}},this.onKeyPress=e=>{e.stopPropagation();const t=e.which||e.keyCode,i=[o.R.TAB,o.R.RETURN];if("keydown"===e.type&&!i.includes(t))return!1;const n=e.target;switch(this.props.maxLength&&n.value.length>this.props.maxLength&&e.preventDefault(),t){case o.R.TAB:case o.R.RETURN:e.shiftKey||(e.preventDefault(),this.blur(),this.props.onDone(n.value))}return!1},this.stopPropagation=e=>e.stopPropagation(),this.onFocus=e=>{this.context.messageBus.broadcast(new r.S(this.input,!0)),this.props.onFocus&&this.props.onFocus(e)},this.onBlur=e=>{this.context.messageBus.broadcast(new r.S(this.input,!1)),this.props.onBlur&&this.props.onBlur(e)},this.setRef=e=>this.input=e,this.state={currentText:e.text}}componentWillUnmount(){this.input&&this.input.blur()}componentWillReceiveProps(e){e.text!==this.props.text&&this.setState({currentText:e.text})}getText(){return this.input?this.input.value:""}focus(){this.input.focus()}blur(){this.input.blur()}render(){const{placeholder:e,tabIndex:t,maxLength:i,type:s}=this.props,{currentText:o}=this.state;return(0,n.h)("div",{class:"text-box"},(0,n.h)("input",{ref:this.setRef,class:"text-input-box",type:s||"text",value:o,placeholder:e,maxLength:i,onInput:this.onInput,onKeyPress:this.onKeyPress,onKeyDown:this.onKeyPress,onKeyUp:this.stopPropagation,onBlur:this.onBlur,onFocus:this.onFocus,tabIndex:t}))}};l=a([s.Z],l);const c=l},72822:(e,t,i)=>{"use strict";i.d(t,{Z:()=>l});var n=i(26605),s=i(2116),o=i(94184),r=i(29359),a=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let l=class Toggle extends n.Component{constructor(e,t){super(e),this.onClick=()=>{this.props.enabled&&this.props.onToggle()},this.locale={onSettingString:t.locale.t(r.Z.ON),offSettingString:t.locale.t(r.Z.OFF)};const i=Math.max(this.props.toggleTime||300);this.trackTransitionStyle=`transition: background-color ${i}ms`,this.thumbTransitionStyle=`${this.trackTransitionStyle}, left ${i}ms`}render(){const{id:e,toggled:t,enabled:i,onOffLabel:s}=this.props,r=t?this.locale.onSettingString:this.locale.offSettingString;return(0,n.h)("div",{class:o("reusable-toggle",{"toggle-on":t,enabled:i}),id:e,onClick:this.onClick},s&&(0,n.h)("span",{class:"toggle-label"},r),(0,n.h)("div",{style:this.trackTransitionStyle,class:"track"}),(0,n.h)("div",{style:this.thumbTransitionStyle,class:"thumb"}))}};l=a([s.Z],l)},59984:(e,t,i)=>{"use strict";i.d(t,{N:()=>l});var n,s=i(26605),o=i(2116),r=i(94184),a=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};!function(e){e[e.OPEN=0]="OPEN",e[e.UNLOADING=1]="UNLOADING",e[e.CLOSED=2]="CLOSED"}(n||(n={}));let l=class TransitionedUnload extends s.Component{constructor(e){super(e),this.onTransitionEnd=()=>{this.state.phase===n.UNLOADING&&this.setState({phase:n.CLOSED,activeChild:null})},this.onClick=e=>{this.props.onClick&&this.props.onClick(e)},this.onPointerDown=e=>{this.props.onPointerDown&&this.props.onPointerDown(e)},this.onPointerUp=e=>{this.props.onPointerUp&&this.props.onPointerUp(e)},this.state={phase:e.open?n.OPEN:n.CLOSED,activeChild:e.selectChild&&e.childKey||null}}componentWillReceiveProps(e){const{open:t}=this.props;t&&!e.open?this.setState({phase:n.UNLOADING}):!t&&e.open&&this.setState({phase:n.OPEN,activeChild:e.selectChild&&e.childKey||null})}renderChildren(){const{children:e,selectChild:t}=this.props,{phase:i,activeChild:s}=this.state;return i===n.CLOSED||t&&!s?null:t?e&&Array.isArray(e)&&e.length&&e.find((e=>e&&e.key===s))||null:e}render(){const{id:e,appendClass:t}=this.props,{phase:i}=this.state,o={unloading:i===n.UNLOADING};return t&&Object.keys(t).length>0&&Object.assign(o,t),(0,s.h)("div",{id:e,class:r(o),onTransitionEnd:this.onTransitionEnd,onClick:this.onClick,onPointerDown:this.onPointerDown,onPointerUp:this.onPointerUp},this.renderChildren())}};l=a([o.Z],l)},42733:(e,t,i)=>{"use strict";i.d(t,{BN:()=>s,qE:()=>o,ZJ:()=>r,zx:()=>u});var n,s,o,r,a=i(26605),l=i(2116),c=i(94184),h=i(21265),d=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};!function(e){e.ENABLED="enabled",e.DISABLED="disabled",e.DECORATIVE="decorative",e.DIMMED="dimmed",e.ACTIVE="active",e.BUSY="busy"}(s||(s={})),function(e){e[e.STANDARD=0]="STANDARD",e[e.MINI=1]="MINI",e[e.SMALL=2]="SMALL",e[e.LARGE=3]="LARGE"}(o||(o={})),function(e){e[e.PRIMARY=0]="PRIMARY",e[e.SECONDARY=1]="SECONDARY",e[e.TERTIARY=2]="TERTIARY",e[e.OUTLINE=3]="OUTLINE",e[e.OVERLAY=4]="OVERLAY",e[e.LIGHT=5]="LIGHT",e[e.SECONDARY_LIGHT=6]="SECONDARY_LIGHT",e[e.CLEAR=7]="CLEAR",e[e.TOOLBAR=8]="TOOLBAR",e[e.PLAIN=9]="PLAIN"}(r||(r={}));let u=n=class Button extends a.Component{constructor(e){super(e),this.handlingClick=!1,this.mouseupTimeout=0,this.onMouseDown=e=>{if(this.handlingClick=!1,this.props.onMouseDown)this.props.onMouseDown(e);else if(n.iMobile&&this.props.onClick){const t=document.activeElement;t&&e.cancelable&&(this.handlingClick=!0,e.preventDefault(),e.stopImmediatePropagation(),t.blur(),window.addEventListener("mouseup",(t=>{this.handlingClick&&(this.handleClick(e),window.clearTimeout(this.mouseupTimeout))}),{once:!0}),this.mouseupTimeout=window.setTimeout((()=>{this.handlingClick=!1}),300))}},this.onClick=e=>{this.handlingClick||this.handleClick(e)}}handleClick(e){const{buttonState:t}=this.props,i=t===s.DISABLED,n=t===s.BUSY,o=t===s.DECORATIVE;!this.props.onClick||i||n||o?e.stopPropagation():this.props.onClick(e)}render(){const{buttonState:e,buttonSize:t,buttonStyle:i,id:n,appendClass:l,dataValue:h,children:d,onMouseEnter:u,onMouseLeave:p,tooltipMsg:m,tooltipPosition:g,tooltipPreformatted:f}=this.props,v=e===s.DISABLED,y=e===s.BUSY,b=e===s.DECORATIVE,w=i===r.SECONDARY||i===r.SECONDARY_LIGHT,S=i===r.TERTIARY,E=i===r.LIGHT||i===r.SECONDARY_LIGHT,T={"button-small":t===o.SMALL,"button-large":t===o.LARGE,"button-mini":t===o.MINI,"button-secondary":w,"button-tertiary":S,"button-outline":i===r.OUTLINE,"button-light":E,"button-primary":i===r.PRIMARY,"button-overlay":i===r.OVERLAY,"button-clear":i===r.CLEAR,"button-plain":i===r.PLAIN,"button-toolbar":i===r.TOOLBAR,"button-active":e===s.ACTIVE,"button-dimmed":e===s.DIMMED,"button-busy":y,"button-disabled":v,"button-decorative":b};return l&&Object.keys(l).length>0&&Object.assign(T,l),(0,a.h)("div",{id:n,type:"button",class:c("button",T),"data-value":h,onClick:this.onClick,onMouseEnter:u,onMouseLeave:p,onMouseDown:this.onMouseDown,"data-balloon":m||null,"data-balloon-pre":!!f,"data-balloon-pos":g||null},d)}};u.iMobile=(0,h.s)()||(0,h._1)(),u=n=d([l.Z],u)},14071:(e,t,i)=>{"use strict";i.d(t,{A:()=>l,P:()=>CloseButton});var n=i(26605),s=i(80429),o=i(26265),r=i(29359);const{CLOSE_BUTTON_TOOLTIP_MESSAGE:a}=r.Z.REUSABLES;var l;!function(e){e[e.DEFAULT=0]="DEFAULT",e[e.LIGHT=1]="LIGHT",e[e.SHADOW=2]="SHADOW",e[e.OVERLAY=3]="OVERLAY",e[e.TOOLBAR=4]="TOOLBAR"}(l||(l={}));class CloseButton extends n.Component{constructor(e){super(e)}getIconButtonStyle(){switch(this.props.buttonStyle){case l.LIGHT:case l.SHADOW:return s.D.CLEAR;case l.OVERLAY:return s.D.OVERLAY;case l.TOOLBAR:return s.D.TOOLBAR;default:return s.D.PLAIN}}render(){const{locale:e}=this.context,{buttonStyle:t,onClose:i,hideTooltip:r}=this.props,c=r?void 0:e.t(a);return(0,n.h)(s.h,{appendClass:{"close-button":!0,"close-button-shadow":t===l.SHADOW,"close-button-light":t===l.LIGHT},iconClass:"icon-close",buttonStyle:this.getIconButtonStyle(),tooltipMsg:c,tooltipPosition:o.lZ.DOWN,onClick:i})}}},58091:(e,t,i)=>{"use strict";i.d(t,{Z:()=>Scrollbars});var n=i(26605),s=i(95843),o=i(85768),r=i(20072),a=i(1481),l=i(67538),c=i(1799),h=i(94184),d=i(10396);n.options.debounceRendering=requestAnimationFrame;class Scrollbars extends n.Component{constructor(e){super(e),this.horizontal=(0,s.Sv)(),this.vertical=(0,s.Sv)(),this.manuallyMoved=!1,this.scrollPosition={horizontal:s.Ij.Beginning,vertical:s.Ij.End},this.handleEvent=e=>{this.inputFilter.handleEvent(e)},this.getScrollableContainer=()=>this.innerWrapper,this.getScrolledOffset=e=>{const t=s.uG[e].scrollOffset;return this.innerWrapper[t]/this.state[e].childLength},this.state={horizontal:(0,s.cL)(),vertical:(0,s.cL)()},this.resizeSubscription=(0,d.kp)(d.g_.RESIZE,(()=>this.handleExternalChange(d.g_.RESIZE))),this.scrollTo=this.scrollTo.bind(this),this.handlePressStart=this.handlePressStart.bind(this),this.handlePressMove=this.handlePressMove.bind(this),this.handleDragEnd=this.handleDragEnd.bind(this),this.handleDragStart=this.handleDragStart.bind(this),this.handleWheelEvent=this.handleWheelEvent.bind(this),this.handleClick=this.handleClick.bind(this),this.toggleVisibility=this.toggleVisibility.bind(this),this.hasManuallyMoved=this.hasManuallyMoved.bind(this),this.inputFilter=new l.Z({handlePressStart:this.handlePressStart,handlePressMove:this.handlePressMove,handleDragStart:this.handleDragStart,handleDragEnd:this.handleDragEnd,handleClick:this.handleClick});const t=this.handleEvent;window.PointerEvent||(window.addEventListener("mousemove",t),window.addEventListener("mouseleave",t),window.addEventListener("mouseup",t)),window.addEventListener("pointermove",t),window.addEventListener("pointerup",t),window.addEventListener("touchmove",t),window.addEventListener("touchend",t),window.addEventListener("touchcancel",t)}componentDidMount(){if(this.resizeSubscription.renew(),this.innerWrapper.addEventListener("wheel",this.handleWheelEvent,!0),this.props.thumbScrollingOnly)this.innerWrapper.addEventListener("click",this.handleClick);else{const e=this.handleEvent;this.innerWrapper.addEventListener("mousedown",e),this.innerWrapper.addEventListener("pointerdown",e),this.innerWrapper.addEventListener("touchstart",e)}this.firstChild=this.innerWrapper.firstElementChild,this.props.onScrollPositionChange&&this.props.onScrollPositionChange(),this.props.hasOwnProperty("suppressDrag")&&this.inputFilter.setEnabled(!!this.props.suppressDrag)}componentWillUnmount(){const e=this.handleEvent;this.resizeSubscription.cancel(),window.PointerEvent||(window.removeEventListener("mousemove",e),window.removeEventListener("mouseleave",e),window.removeEventListener("mouseup",e)),window.removeEventListener("pointermove",e),window.removeEventListener("touchmove",e),window.removeEventListener("pointerup",e),window.removeEventListener("touchend",e),window.removeEventListener("touchcancel",e),this.innerWrapper.removeEventListener("wheel",this.handleWheelEvent,!0),this.props.thumbScrollingOnly?this.innerWrapper.removeEventListener("click",this.handleClick):(this.innerWrapper.removeEventListener("mousedown",e),this.innerWrapper.removeEventListener("pointerdown",e),this.innerWrapper.removeEventListener("touchstart",e))}componentWillReceiveProps(e){e.suppressDrag!==this.props.suppressDrag&&(this.inputFilter.setEnabled(!!this.props.suppressDrag),this.props.suppressDrag&&(this.manuallyMoved=!1))}getSnapshotBeforeUpdate(){this.props.waitToUpdate||this.handleExternalChange()}componentDidUpdate(){if(!this.horizontal.animation&&!this.vertical.animation)return;const e={};for(const t in this.state){const i=t;this[i].animation&&(this[i].animation.isAnimating?e[(0,s.O1)(i)]=this[i].animation.getUpdatedValue():this[i].animation=null)}Object.keys(e).length>0&&window.requestAnimationFrame((()=>{this.innerWrapper&&this.scrollTo(e)}))}scrollTo(e){if(!e.hasOwnProperty(s.RD.x)&&!e.hasOwnProperty(s.RD.y))return;const t={};for(const i of this.getVisibleAxes(e)){const n=(0,s.UC)(i),o=s.uG[n].scrollOffset,r=e[i];if(void 0!==r){if(isNaN(r))return;this.innerWrapper[o]=Math.max(Math.min(1,r)*this.state[n].childLength,0),t[n]=Object.assign(Object.assign({},this.state[n]),{scrollOffset:this.innerWrapper[o]})}}this.setState(t)}animatedScrollTo(e,t){if(e.hasOwnProperty(s.RD.x)||e.hasOwnProperty(s.RD.y))for(const i of this.getVisibleAxes(e)){const n=(0,s.UC)(i),o=s.uG[n].scrollOffset;this[n].animation=new a.Z({duration:t||s.UI,startValue:this.innerWrapper[o]/this.state[n].childLength,endValue:Math.max(0,Math.min(1,e[i]))})}}setScrollCenter(e){if(!(e&&e.compareDocumentPosition(this.innerWrapper)&Node.DOCUMENT_POSITION_CONTAINS))return;this.scrollCenter=e;const t={},i={};for(const n of this.getVisibleAxes(this.state)){const o=(0,s.O1)(n);t[o]=e[s.uG[n].positionOffset]+e[s.uG[n].offsetLength]/2;let r=e;for(;r.parentElement&&r!==this.innerWrapper;)r=r.parentElement,t[o]+=r[s.uG[n].positionOffset];const a=this.outerWrapper.parentElement[s.uG[n].offsetLength];i[o]=(t[o]-a/2)/this.state[n].childLength}Object.keys(i).length>0&&this.animatedScrollTo(i)}getVisibleAxes(e){const t=[];for(const i in e)(e[i]||"number"==typeof e[i])&&(i in s.RD&&this.state[(0,s.UC)(i)].isVisible||i in s.Nm&&this.state[i].isVisible)&&t.push(i);return t}handleDragStart(){delete this.scrollCenter,this.hasManuallyMoved()}handlePressStart(){this.horizontal.dragStartScroll=this.innerWrapper.scrollLeft,this.vertical.dragStartScroll=this.innerWrapper.scrollTop}handlePressMove(e){const t={};for(const i of this.getVisibleAxes(e)){const n=(0,s.UC)(i);t[i]=(e[i]+this[n].dragStartScroll)/this.state[n].childLength}this.scrollTo(t)}handleWheelEvent(e){this.props.singleScrollDirection===s.Nm.horizontal&&0===e.deltaX&&0!==e.deltaY?(this.handlePressStart(),this.handlePressMove({x:e.deltaY,y:0})):(this.hasManuallyMoved(),this.handleExternalChange())}handleClick(e){this.props.handleClick&&this.props.handleClick(e)}toggleVisibility(e){return t=>{const i=Object.assign(Object.assign({},this.state[e]),{isVisible:t});if((0,r.g)(this.state[e],i)){const t={};t[e]=i,this.setState(t),this.props.onScrollbarVisibilityChange&&this.props.onScrollbarVisibilityChange()}}}toggleScrollPosition(e){return t=>{this.scrollPosition[e]=t,this.props.onScrollPositionChange&&this.props.onScrollPositionChange(t)}}handleDragEnd(e,t){for(const i of this.getVisibleAxes(e)){const n=(0,s.UC)(i),o=e[i]/t,r=Math.min(s.UI,Math.abs(s.UI*o)),l=this.innerWrapper[s.uG[n].scrollOffset],h=o*r/2;this[n].animation=new a.Z({duration:r,startValue:l/this.state[n].childLength,endValue:Math.max(0,Math.min((l+h)/this.state[n].childLength,1)),easingFunction:c.hl})}this.setState({})}handleExternalChange(e){this.scrollCenter&&e&&e===d.g_.RESIZE&&this.setScrollCenter(this.scrollCenter);const t={};for(const e in this.state){const i=e,n=s.uG[i].clientLength,o=Object.assign(Object.assign({},this.state[i]),{wrapperLength:Number(this.innerWrapper&&this.innerWrapper[n])||1,childLength:Number(this.firstChild&&this.firstChild[n])||1,scrollOffset:this.innerWrapper&&this.innerWrapper[s.uG[i].scrollOffset]});(0,r.g)(this.state[i],o)&&(t[i]=o)}Object.keys(t).length>0&&this.setState(t)}hasManuallyMoved(){this.manuallyMoved=!0,this.props.onScrolled&&this.props.onScrolled()}resetManuallyMoved(){this.manuallyMoved=!1}render(){const{scrollbarHeight:e,singleScrollDirection:t,name:i,children:r,forceHidden:a}=this.props,l={"max-height":e||""},c=t?`${t}Only`:"dual-scroll";return(0,n.h)("div",{class:h("outerScrollbarWrapper",c,`scrollbar-${i}`),ref:e=>{this.outerWrapper=e},style:l},(0,n.h)("div",{class:"innerScrollbarWrapper",ref:e=>{this.innerWrapper=e}},(0,n.h)("div",{class:"paddingScrollbarWrapper"},r)),t!==s.Nm.vertical&&(0,n.h)(o.L,{direction:s.Nm.horizontal,ref:e=>{this.horizontal.scrollbar=e},wrapperLength:this.state.horizontal.wrapperLength,childLength:this.state.horizontal.childLength,scrollOffset:this.state.horizontal.scrollOffset,scrollTo:this.scrollTo,onVisibilityChange:this.toggleVisibility(s.Nm.horizontal),onScrollPositionChange:this.toggleScrollPosition(s.Nm.horizontal),forceHidden:a,onThumbDrag:this.hasManuallyMoved}),t!==s.Nm.horizontal&&(0,n.h)(o.L,{direction:s.Nm.vertical,ref:e=>{this.vertical.scrollbar=e},wrapperLength:this.state.vertical.wrapperLength,childLength:this.state.vertical.childLength,scrollOffset:this.state.vertical.scrollOffset,scrollTo:this.scrollTo,onVisibilityChange:this.toggleVisibility(s.Nm.vertical),onScrollPositionChange:this.toggleScrollPosition(s.Nm.vertical),forceHidden:a,onThumbDrag:this.hasManuallyMoved}))}}},95843:(e,t,i)=>{"use strict";i.d(t,{UI:()=>n,cL:()=>s,Sv:()=>o,Nm:()=>r,RD:()=>a,O1:()=>l,UC:()=>c,uG:()=>h,Ij:()=>d,w5:()=>u});const n=250,s=()=>({wrapperLength:1,childLength:1,scrollOffset:1,isVisible:!1}),o=()=>({scrollbar:null,animation:null,dragStartScroll:0});var r,a;!function(e){e.horizontal="horizontal",e.vertical="vertical"}(r||(r={})),function(e){e.x="x",e.y="y"}(a||(a={}));const l=e=>{switch(e){case r.horizontal:return a.x;case r.vertical:return a.y}throw Error()},c=e=>{switch(e){case a.x:return r.horizontal;case a.y:return r.vertical}throw Error()},h={[r.horizontal]:{scrollOffset:"scrollLeft",offsetLength:"offsetWidth",clientLength:"clientWidth",positionOffset:"offsetLeft",lengthName:"width",offsetName:"left",eventPosition:"clientX",delta:a.x},[r.vertical]:{scrollOffset:"scrollTop",offsetLength:"offsetHeight",clientLength:"clientHeight",positionOffset:"offsetTop",lengthName:"height",offsetName:"top",eventPosition:"clientY",delta:a.y}};var d;!function(e){e.Beginning="Beginning",e.Middle="Middle",e.End="End",e.None="None"}(d||(d={}));const u=(e,t)=>t?e<.01?d.Beginning:1-e<.01?d.End:d.Middle:d.None},85768:(e,t,i)=>{"use strict";i.d(t,{L:()=>Scrollbar});var n=i(26605),s=i(20072),o=i(67538),r=i(95843);class Scrollbar extends n.Component{constructor(e){super(e),this.state={visible:!1,trackLength:1,thumbLength:1,thumbOffset:0},this.direction=r.uG[e.direction],this.handlePressStart=this.handlePressStart.bind(this),this.handlePressMove=this.handlePressMove.bind(this),this.handleTrackClick=this.handleTrackClick.bind(this),this.inputFilter=new o.Z({handlePressStart:this.handlePressStart,handlePressMove:this.handlePressMove}),window.PointerEvent||(window.addEventListener("mousemove",this.inputFilter.handleEvent),window.addEventListener("mouseleave",this.inputFilter.handleEvent),window.addEventListener("mouseup",this.inputFilter.handleEvent)),window.addEventListener("pointermove",this.inputFilter.handleEvent),window.addEventListener("pointerup",this.inputFilter.handleEvent)}componentWillUnmount(){window.PointerEvent||(window.removeEventListener("mousemove",this.inputFilter.handleEvent),window.removeEventListener("mouseleave",this.inputFilter.handleEvent),window.removeEventListener("mouseup",this.inputFilter.handleEvent)),window.removeEventListener("pointermove",this.inputFilter.handleEvent),window.removeEventListener("pointerup",this.inputFilter.handleEvent)}getTrackLength(){return Number(this.thumbTrack&&this.thumbTrack[this.direction.clientLength]||window.innerWidth)}handleTrackClick(e){if(e.target!==this.thumbTrack)return;const t=this.direction.eventPosition,i=this.thumbTrack.getBoundingClientRect()[this.direction.offsetName],n=e[t]<i+this.state.thumbOffset,s=this.getTrackLength();let o=0;o=n?Math.max(0,(this.state.thumbOffset-this.state.thumbLength)/s):Math.min(s,(this.state.thumbOffset+this.state.thumbLength)/s),this.props.scrollTo({[(0,r.O1)(this.props.direction)]:o})}handlePressStart(e){this.dragStartThumbOffset=this.state.thumbOffset}handlePressMove(e){const t=this.getTrackLength(),i=(this.dragStartThumbOffset-e[this.direction.delta])/t;this.props.scrollTo({[(0,r.O1)(this.props.direction)]:i}),this.props.onThumbDrag&&this.props.onThumbDrag()}componentDidUpdate(){const{wrapperLength:e,childLength:t,scrollOffset:i}=this.props;if(e>0&&t>0){const n=this.getTrackLength(),o=e/t*n,a={thumbLength:o,visible:t>e,thumbOffset:Math.min(i/t*n,n-o)};if((0,s.g)(this.state,a)){const e=this.state.visible!==a.visible;e&&this.props.onVisibilityChange&&this.props.onVisibilityChange(a.visible);const t=(0,r.w5)(a.thumbOffset/(n-o),a.visible);(t!==this.scrollPosition||e)&&(this.scrollPosition=t,this.props.onScrollPositionChange&&this.props.onScrollPositionChange(t)),this.setState(a)}}}render(){const e={[`${this.direction.lengthName}`]:this.state.thumbLength+"px",[`${this.direction.offsetName}`]:this.state.thumbOffset+"px"},t=this.inputFilter.handleEvent,i=window.PointerEvent,s=i?t:void 0,o=i?void 0:t,r=i?void 0:t;return(0,n.h)("div",null,this.state.visible&&!this.props.forceHidden&&(0,n.h)("div",{class:"scrollbarTrack "+this.props.direction,onClick:this.handleTrackClick,ref:e=>{this.thumbTrack=e}},(0,n.h)("div",{class:"scrollbarThumb",style:e,onPointerDown:s,onMouseDown:r,onTouchStart:o})))}}},53189:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var n=i(26605),s=i(2116),o=i(93273),r=i(71313),a=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};let l=class TextBox extends n.Component{constructor(e){super(e),this.editing=!1,this.stopPropagation=e=>e.stopPropagation(),this.onPaste=e=>{if(!e.clipboardData)return;const{maxLength:t}=this.props,i=e.clipboardData.getData("text/plain");let n=i.length;const s=this.textElement.innerText,o=window.getSelection();if(o&&t&&s&&s.length+n>t){const e=t-s.length+o.toString().length;n=Math.min(e,n)}document.execCommand("insertText",!1,i.slice(0,n)),e.preventDefault()},this.onMouseDown=e=>{const{onClick:t,clickToEdit:i}=this.props;(this.editing||i)&&t&&(e.stopPropagation(),t(e),this.editing||this.toggleEditing(!0))},this.onInput=()=>{if(this.props.onInput){const e=this.textElement.innerText;this.props.onInput(e)}},this.onFocus=e=>{this.context.messageBus.broadcast(new o.S(this.textElement,!0)),this.props.onFocus&&this.props.onFocus(e)},this.onBlur=e=>{this.context.messageBus.broadcast(new o.S(this.textElement,!1)),this.props.onBlur&&this.props.onBlur(e)},this.setRef=e=>{this.textElement=e}}componentDidMount(){this.replaceTextContent(this.props.text)}componentWillUnmount(){this.textElement&&this.textElement.blur()}componentDidUpdate(e){this.props.text!==e.text&&this.replaceTextContent(this.props.text)}shouldComponentUpdate(){return!1}getTextElement(){return this.textElement}focus(){this.editing&&this.textElement.focus()}toggleEditing(e){this.textElement&&(this.editing!==e&&(this.editing=e,this.textElement.contentEditable=e?"true":"false",e?this.textElement.classList.add("editing"):this.textElement.classList.remove("editing")),e?this.textElement.focus():this.textElement.blur())}replaceTextContent(e){if(!this.textElement)return;const{hashtags:t,userMentions:i,onClickAnchor:n,activeLinks:s}=this.props;for(;this.textElement.firstChild;)this.textElement.removeChild(this.textElement.firstChild);r.v.deserialize(e,!!s,!!t,i?this.context.userData:void 0,n).forEach((e=>{this.textElement.appendChild(e)})),this.focus()}render(){const{placeholder:e,tabIndex:t,onKeyPress:i}=this.props;return(0,n.h)("div",{ref:this.setRef,class:"text-box-text",role:"textbox",draggable:!1,spellcheck:!0,contentEditable:!1,placeholder:e,onMouseDown:this.onMouseDown,onKeyDown:i,onKeyUp:this.stopPropagation,onKeyPress:i,onFocus:this.onFocus,onBlur:this.onBlur,onInput:this.onInput,onPaste:this.onPaste,tabIndex:t})}};l=a([s.A],l);const c=l},71313:(e,t,i)=>{"use strict";i.d(t,{o:()=>n,v:()=>TextParser});var n,s=i(74674);!function(e){e.TEXT="",e.LINK="link-url",e.HASH="link-hashtag",e.USER="link-user"}(n||(n={}));class TextParser{static parse(e,t,i){const n=[];if(!e)return[];const s=e.split("[").map(((e,t)=>0===t?e:"["+e));let o=0;for(;o<s.length;){const e=TextParser.parseIntoBlocks(s[o],n,t,i);e&&s.splice(o+1,0,e),o++}return n}static getPlainText(e,t,i){const n=TextParser.deserialize(e,!1,t,i),s=[];return n.map((e=>{e.textContent&&s.push(e.textContent)})),s.join("")}static parseIntoBlocks(e,t,i,n){if(n){const i=TextParser.getUserBlock(e,n)||TextParser.getDeprecatedUserBlock(e,n);if(i)return t.push(i),e.slice(i.markdown.length)}const s=TextParser.getLinkBlock(e);if(s&&s.value&&-1===s.value.indexOf("javascript:"))return t.push(s),e.slice(s.markdown.length);if(i){const i=TextParser.getHashBlock(e);if(i)return t.push(i),e.slice(i.markdown.length)}const o=TextParser.getTextBlock(e);return o&&t.push(o),null}static getTextBlock(e){return 0===e.length?null:{blockType:s.C.TEXT,text:e,markdown:e}}static getHashBlock(e){const t=e.match(TextParser.hashRegex);return!t||t.length<2?null:{blockType:s.C.HASH,markdown:t[0],text:t[1]}}static getUserBlock(e,t){const i=e.match(TextParser.userRegex);if(!i||i.length<3)return null;let n=i[1].substr(1),o=i[2];const r=n?t.getUserInfo(n):t.getUserInfoByEmail(o),a=r?r.name:"";return n=r?r.id:n,o=r?r.email:o,{blockType:s.C.USER,markdown:i[0],id:n,value:o,text:`@${a||o}`}}static getDeprecatedUserBlock(e,t){const i=e.match(TextParser.deprecatedUserRegex);if(!i||i.length<2)return null;const n=i[1].substr(1),o=t.getUserInfoDisplay(n);return{blockType:s.C.USER,markdown:i[0],value:n,text:`@${o.name}`}}static getLinkBlock(e){const t=e.match(TextParser.linkRegEx);if(!t)return null;const i=t[2];let n=1,o=0;for(;o<i.length&&("("===i[o]?n++:")"===i[o]&&n--,0!==n);)o++;const r=i.length-o;let a=TextParser.conditionallyEncode(t[2].substring(0,o));return-1===a.indexOf("://")&&(a="http://"+a),{blockType:s.C.LINK,markdown:t[0].substring(0,t[0].length-r),text:t[1],value:a}}static conditionallyEncode(e){return TextParser.needsEncoding(e)?encodeURI(e):e}static needsEncoding(e){if(e.match(/([#\s\{\}\"\']|[^\x00-\x7F]|%[^0-9a-fA-F]{2})+/g))return!0;let t=e;try{t=decodeURI(e)}catch(e){}return!1}}TextParser.hashRegex=/\[(#\w*)\]/,TextParser.userRegex=/\[(@\w*)\]\((.*)\)/,TextParser.linkRegEx=/\[([^\]]*)\]\((.*)\)/,TextParser.deprecatedUserRegex=/\[(@\w*)\]/,TextParser.serialize=(e,t=!1,i)=>{let n="";const s=[].slice.call(e.childNodes);for(const e of s)switch(e.nodeName){case"#text":n+=TextParser.serializeText(e,t);break;case"A":n+=TextParser.serializeAnchor(e,t,i);break;case"P":case"DIV":n+=TextParser.serializeElement(e,!0);break;case"SPAN":n+=TextParser.serializeElement(e,!1);break;case"BR":n+=TextParser.serializeBreak(e);break;default:n+=TextParser.serialize(e)}return n},TextParser.deserialize=(e,t,i,o,r)=>{const a=TextParser.parse(e,i,o),l=[];for(const e of a)switch(e.blockType){case s.C.TEXT:const i=document.createTextNode(""+e.text);l.push(i);break;case s.C.USER:const o=document.createElement(r?"a":"span");if(o.setAttribute("data-blocktype",e.blockType),r){const t=o;t.className=`link-annotation ${n.USER}`,t.contentEditable="false",t.removeAttribute("href"),t.onclick=r;let i=e.id||"",s=e.value||"";e.value&&-1===e.value.indexOf("@")&&(i=e.value,s=""),i&&t.setAttribute("data-id",i),s&&t.setAttribute("data-value",s)}o.textContent=`${e.text}`,l.push(o);break;case s.C.HASH:const a=document.createElement(r?"a":"span");if(a.setAttribute("data-blocktype",e.blockType),r){const e=a;e.className=`link-annotation ${n.HASH}`,e.contentEditable="false",e.removeAttribute("href"),e.onclick=r}a.textContent=`${e.text}`,l.push(a);break;case s.C.LINK:if(e.value){const i=t||!!r,s=document.createElement(i?"a":"span");if(s.setAttribute("data-blocktype",e.blockType),i){const t=s;t.href=`${e.value}`,t.target="_blank",t.className=`link-annotation ${n.LINK}`,t.contentEditable="false",r&&(t.onclick=r)}s.textContent=`${e.text}`,l.push(s)}}return l},TextParser.serializeText=(e,t)=>{let i=(e.textContent||"").replace(/\]\(/g,"]&zwnj;(");const n=new RegExp(/https?:\/\/(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u00a1-\uffff][a-z0-9\u00a1-\uffff_-]{0,62})?[a-z0-9\u00a1-\uffff]\.)+(?:[a-z\u00a1-\uffff]{2,}\.?))(?::\d{2,5})?(?:[/?#]\S*)?/gi);return i=i.replace(n,(e=>`[${e}](${e})`)),t&&(i=i.replace(TextParser.hashRegex,(e=>`[${e}]`))),i.replace(/\<\s*br\s*\/?>/gi,"\n")},TextParser.serializeAnchor=(e,t,i)=>{const n=e.dataset.blocktype;let o=e.innerText;switch(n){case s.C.HASH:t&&(o=`[${e.innerText}]`);break;case s.C.USER:if(i){let t=e.dataset.id||"",n=e.dataset.value||"";if(!t&&!n&&(n="@"===o[0]?o.substr(1):o,n)){const e=i.getUserInfoByEmail(n);e&&(t=e.id)}(t||TextParser.validateEmail(n))&&(o=`[@${t}](${n})`)}break;case s.C.LINK:default:o=`[${e.innerText}](${e.href})`}return o},TextParser.serializeElement=(e,t)=>{let i=t?"\n":" ";return e.childNodes.length>0&&(i+=TextParser.serialize(e)),i},TextParser.serializeBreak=e=>"\n",TextParser.validateEmail=(()=>{const e=/\S+@\S+\.\S+/,t=document.createElement("input");return t.type="email",t.required=!0,i=>(t.value=i,"function"==typeof t.checkValidity?t.checkValidity():e.test(i))})()},86134:(e,t,i)=>{"use strict";i.d(t,{x:()=>s,u:()=>h});var n,s,o=i(26605),r=i(2116),a=i(94184),l=i(14071),c=function(e,t,i,n){var s,o=arguments.length,r=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(r=(o<3?s(r):o>3?s(t,i,r):s(t,i))||r);return o>3&&r&&Object.defineProperty(t,i,r),r};!function(e){e.NONE="no-arrow",e.TOP_LEFT="position-top-left",e.TOP_RIGHT="position-top-right",e.TOP_CENTER="position-top-center",e.BOTTOM_RIGHT="position-bottom-right",e.BOTTOM_LEFT="position-bottom-left",e.BOTTOM_CENTER="position-bottom-center",e.RIGHT_BOTTOM="position-right-bottom"}(s||(s={}));let h=n=class Tooltip extends o.Component{constructor(e){super(e),this.closeTooltip=()=>{this.setState({showing:!1}),window.removeEventListener("click",this.handleOutsideClick)},this.timeoutTooltip=()=>{this.closeTooltip(),this.props.onTimeout&&this.props.onTimeout()},this.openTooltip=e=>{this.setState({showing:!0}),window.addEventListener("click",this.handleOutsideClick),void 0!==e&&window.setTimeout(this.timeoutTooltip,e)},this.getContentPosition=()=>{if(!this.tooltipWrapper)return{};const e=this.tooltipWrapper.parentElement;switch(this.props.arrowPos){case s.BOTTOM_RIGHT:return{transform:`translate(${32-this.tooltipContent.offsetWidth}px, ${-this.tooltipContent.offsetHeight-e.getBoundingClientRect().height-15}px)`};case s.BOTTOM_LEFT:return{transform:`translate(0, ${-this.tooltipContent.offsetHeight-e.getBoundingClientRect().height-35}px)`};case s.RIGHT_BOTTOM:return{transform:`translate(${-this.tooltipContent.offsetWidth-7}px, ${9-this.tooltipContent.offsetHeight}px)`};default:return{}}},this.handleOutsideClick=e=>{this.props.onClose&&this.props.onClose(e)},this.state={showing:e.open};const t=n.count++;this.wrapperId=`tooltip-wrapper-${e.name||t}`,this.id=`${e.tooltipId||`tooltip-${t}`}`}static clearCount(){this.count=0}componentDidMount(){this.props.open&&this.openTooltip(this.props.maxMsOpen)}componentWillUnmount(){this.state.showing&&this.closeTooltip()}componentWillReceiveProps(e){e.open&&!this.props.open?this.openTooltip(e.maxMsOpen):!e.open&&this.props.open&&this.closeTooltip()}render(){const{arrowPos:e,title:t,message:i,onClose:n,closeButton:r,darkTheme:c,appendHTML:h,appendBodyClass:d,appendClass:u}=this.props,{showing:p}=this.state,m={emulatedDialog:!0,open:p,dark:c,[void 0===e?s.TOP_CENTER:e]:!0};return u&&Object.keys(u).length>0&&Object.assign(m,u),(0,o.h)("div",{id:this.wrapperId,class:a(m),ref:e=>this.tooltipWrapper=e},(0,o.h)("div",{id:this.id,class:a("tooltip",d),style:this.getContentPosition(),ref:e=>this.tooltipContent=e},t&&(0,o.h)("div",{class:"title"},t),r&&n&&(0,o.h)(l.P,{onClose:n}),i,h))}};h.POPUP_OFFSET=28,h.count=0,h=n=c([r.Z],h)},29677:(e,t,i)=>{"use strict";i.d(t,{O8:()=>n,OR:()=>s,LH:()=>o,El:()=>r});const n=300,s=()=>window.innerWidth>767,o=375,r=750},1481:(e,t,i)=>{"use strict";i.d(t,{Z:()=>Animation});var n=i(1799);class Animation{constructor(e){this.isAnimating=!0,this.duration=e.duration,this.startValue=e.startValue,this.changeValue=e.endValue-this.startValue,this.easingFunction=e.easingFunction||n.to}getUpdatedValue(){this.startTime||(this.startTime=Date.now());const e=Date.now()-this.startTime;return e>this.duration&&(this.isAnimating=!1),this.easingFunction(Math.min(e,this.duration),this.startValue,this.changeValue,this.duration)}}},20072:(e,t,i)=>{"use strict";i.d(t,{g:()=>n});const n=(e,t)=>{for(const i in t)if(e[i]!==t[i])return!0;return!1}},67538:(e,t,i)=>{"use strict";i.d(t,{Z:()=>InputFilter});var n=i(3159),s=i(41397);class InputFilter{constructor(e){this.couldBeDrag=!1,this.isDragging=!1,this.shouldHandleEvents=!0,this.handleEvent=e=>{if(this.shouldHandleEvents)switch(e.stopPropagation(),e.type){case"mousedown":case"touchstart":case"pointerdown":this.onPressStart(e);break;case"mousemove":case"pointermove":case"touchmove":this.onPressMove(e);break;case"mouseup":case"pointerup":case"mouseleave":case"touchend":case"touchcancel":case"pointercancel":case"pointerleave":this.onPressEnd(e)}},this.callbacks=e}setEnabled(e){this.shouldHandleEvents=e,this.couldBeDrag=this.couldBeDrag&&e}getPosition(e){return(0,n.z6)(e)?{x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY}:{x:e.clientX,y:e.clientY}}onPressStart(e){this.couldBeDrag=!0,this.dragEvents=[],this.dragStart=this.getPosition(e),this.callbacks.handlePressStart&&this.callbacks.handlePressStart(this.getPosition(e))}onPressMove(e){if(!this.couldBeDrag)return;const t=this.getPosition(e);this.addDragEvent(t),this.isDragging||Math.sqrt(Math.pow(t.x-this.dragStart.x,2)+Math.pow(t.y-this.dragStart.y,2))>s.JU&&(this.isDragging=!0,this.callbacks.handleDragStart&&this.callbacks.handleDragStart()),this.callbacks.handlePressMove&&this.callbacks.handlePressMove({x:this.dragStart.x-t.x,y:this.dragStart.y-t.y})}onPressEnd(e){if(this.couldBeDrag){if(this.couldBeDrag=!1,this.isDragging){if(!this.dragEvents||!this.dragEvents[0])return;const e=this.dragEvents[0],t=this.dragEvents[this.dragEvents.length-1];if(this.callbacks.handleDragEnd){const i={x:0,y:0};Date.now()-t.timestamp<InputFilter.dragMoveTimeout&&(i.x=e.position.x-t.position.x,i.y=e.position.y-t.position.y),this.callbacks.handleDragEnd(i,t.timestamp-e.timestamp)}}else this.callbacks.handleClick&&this.callbacks.handleClick(e);this.isDragging=!1}}addDragEvent(e){this.dragEvents.push({position:e,timestamp:Date.now()}),this.dragEvents.length>10&&this.dragEvents.shift()}}InputFilter.dragMoveTimeout=100},84952:(e,t,i)=>{"use strict";i.d(t,{w:()=>n});const n=e=>e.innerWidth<487||e.innerHeight<487},98867:(e,t,i)=>{"use strict";i.d(t,{j:()=>s});var n=new RegExp("^(?:(?:(?:https?|ftp):)?\\/\\/)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z0-9\\u00a1-\\uffff][a-z0-9\\u00a1-\\uffff_-]{0,62})?[a-z0-9\\u00a1-\\uffff]\\.)+(?:[a-z\\u00a1-\\uffff]{2,}\\.?))(?::\\d{2,5})?(?:[/?#]\\S*)?$","i");const s=e=>(e=>n.test(e))(e)&&/^https?:\/\//.test(e)},73706:(e,t,i)=>{"use strict";i.d(t,{z:()=>HoverEvent,A:()=>UnhoverEvent});var n=i(86480);class HoverEvent extends n.G{constructor(){super(...arguments),this.type="hover"}}class UnhoverEvent extends n.G{constructor(){super(...arguments),this.type="unhover"}}},86480:(e,t,i)=>{"use strict";i.d(t,{G:()=>InputEvent});class InputEvent{constructor(){this.eventType="input"}}},75158:(e,t,i)=>{"use strict";i.d(t,{T:()=>ClickCancelEvent,R:()=>ClickEvent});var n=i(24946);class ClickCancelEvent extends n.C{constructor(e,t){super(),this.position=e,this.buttons=t}}class ClickEvent extends n.C{constructor(e,t){super(),this.position=e,this.button=t}}},21588:(e,t,i)=>{"use strict";i.d(t,{E0:()=>DragBeginEvent,_t:()=>DragEvent,_R:()=>DragEndEvent,u4:()=>DragGestureStartEvent,Zv:()=>DragGestureEndEvent});var n=i(24946);class DragBeginEvent extends n.C{constructor(e,t){super(),this.position=e,this.buttons=t}}class DragEvent extends n.C{constructor(e,t,i,n){super(),this.position=e,this.clientPosition=n,this.delta=t,this.buttons=i}}class DragEndEvent extends n.C{constructor(e,t,i,n,s){super(),this.position=e,this.delta=t,this.buttons=i,this.timeSinceLastMove=n,this.fullDelta=s}}class DragGestureStartEvent extends n.C{constructor(e,t){super(),this.position=e,this.pointer=t}}class DragGestureEndEvent extends n.C{constructor(e,t){super(),this.position=e,this.fullDelta=t}}},24946:(e,t,i)=>{"use strict";i.d(t,{C:()=>GestureEvent});var n=i(86480);class GestureEvent extends n.G{}},35056:(e,t,i)=>{"use strict";i.d(t,{DG:()=>LongPressMoveEvent,PC:()=>LongPressProgressEvent,Vh:()=>LongPressStartEvent,$b:()=>LongPressSuccessEvent,pt:()=>LongPressEndEvent});var n=i(24946);class LongPressMoveEvent extends n.C{constructor(e,t,i,n){super(),this.position=e,this.clientPosition=t,this.delta=i,this.buttons=n}}class LongPressProgressEvent extends n.C{constructor(e,t,i,n,s){super(),this.position=e,this.clientPosition=t,this.delta=i,this.buttons=n,this.progress=s}}class LongPressStartEvent extends n.C{constructor(e,t,i){super(),this.position=e,this.clientPosition=t,this.buttons=i}}class LongPressSuccessEvent extends n.C{constructor(e,t){super(),this.position=e,this.clientPosition=t}}class LongPressEndEvent extends n.C{constructor(e,t,i){super(),this.position=e,this.clientPosition=t,this.cancelled=i}}},93735:(e,t,i)=>{"use strict";i.d(t,{G:()=>PinchEvent,i:()=>PinchEndEvent});var n=i(24946);class PinchEvent extends n.C{constructor(e){super(),this.pinchDelta=e}}class PinchEndEvent extends n.C{constructor(e,t){super(),this.pinchDelta=e,this.timeSinceLastMove=t}}},25259:(e,t,i)=>{"use strict";i.d(t,{h:()=>RawPointersEvent});var n=i(24946);class RawPointersEvent extends n.C{constructor(e){super(),this.pointers=e}}},22079:(e,t,i)=>{"use strict";i.d(t,{D:()=>RotateEvent,u:()=>RotateEndEvent});var n=i(24946);class RotateEvent extends n.C{constructor(e){super(),this.rotateDelta=e}}class RotateEndEvent extends n.C{constructor(e,t){super(),this.rotateDelta=e,this.timeSinceLastMove=t}}},30604:(e,t,i)=>{"use strict";i.d(t,{a:()=>ScrollEvent});var n=i(24946);class ScrollEvent extends n.C{constructor(e,t){super(),this.position=e,this.delta=t}}},30963:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>InputIni});var n=i(54122),s=i(41307),o=i(3159),r=i(40582),a=i(36073),l=i(35175),c=i(62367),h=i(21265);class InputPointer{constructor(e,t,i,n){if(this.config=e,this.canvasData=i,this.handledTouchesAsPointer=0,this.lastTouchEnd=0,this.activeButtons=r.r3.NONE,this.preventDoubleTap=e=>{e.cancelable&&e.timeStamp-this.lastTouchEnd<=InputPointer.doubleTapThreshold&&e.preventDefault(),this.lastTouchEnd=e.timeStamp},this.preventMultiTouchGesture=e=>{const t=e.touches&&e.touches.length>1,i="scale"in e&&1!==e.scale;(t||i)&&e.cancelable&&e.preventDefault()},this.onEventCallback=n,window.PointerEvent||(t.addEventListener("mousedown",(e=>this.onMouseDown(e))),t.addEventListener("mouseup",(e=>this.onMouseUp(e))),t.addEventListener("mousemove",(e=>this.onMouseMove(e))),t.addEventListener("mouseenter",(e=>this.onMouseEnter(e)))),t.addEventListener("contextmenu",(e=>e.preventDefault())),t.addEventListener("touchstart",(e=>this.onTouchStart(e))),t.addEventListener("touchend",(e=>this.onTouchEnd(e))),t.addEventListener("touchmove",(e=>this.onTouchMove(e))),t.addEventListener("touchcancel",(e=>this.onTouchEnd(e))),t.addEventListener("pointerdown",(e=>this.onPointerDown(e))),t.addEventListener("pointerup",(e=>this.onPointerUp(e))),t.addEventListener("pointermove",(e=>this.onPointerMove(e))),t.addEventListener("pointercancel",(e=>this.onPointerUp(e))),t.addEventListener("pointerenter",(e=>this.onMouseEnter(e))),(0,h.s)()||(0,h._1)()){const e=!!l.h&&{passive:!1};document.addEventListener("touchmove",this.preventMultiTouchGesture,e),document.addEventListener("touchend",this.preventDoubleTap,e)}}onMouseDown(e){e.currentTarget.focus(),this.tryPreventDefault(e),this.activeButtons|=1<<e.button;const{ndc:t,client:i}=this.getPointerPosition(e);this.onEventCallback(new a.er(this.getPointerId(e),t,i,e.button,!0,a._A.MOUSE))}onMouseUp(e){this.tryPreventDefault(e),this.activeButtons&=~(1<<e.button);const{ndc:t,client:i}=this.getPointerPosition(e);this.onEventCallback(new a.er(this.getPointerId(e),t,i,e.button,!1,a._A.MOUSE))}onMouseMove(e){this.tryPreventDefault(e);const{ndc:t,client:i}=this.getPointerPosition(e);this.onEventCallback(new a.mE(this.getPointerId(e),t,i,this.activeButtons,a._A.MOUSE))}onMouseEnter(e){const t=(0,c.lY)(e.buttons,r.MP.MIDDLE,r.MP.SECONDARY),i=(this.activeButtons^t)&~t;for(let t=r.MP.PRIMARY;t<r.MP.COUNT;++t){const n=(0,r.AF)(t);if(n&&(i&n)>0){const{ndc:i,client:n}=this.getPointerPosition(e);this.onEventCallback(new a.er(this.getPointerId(e),i,n,t,!1,a._A.MOUSE))}}this.activeButtons=t}onTouchStart(e){if(e.currentTarget.focus(),e.cancelable&&e.preventDefault(),this.handledTouchesAsPointer)--this.handledTouchesAsPointer;else for(let t=0;t<e.changedTouches.length;t++){const i=e.changedTouches.item(t),{ndc:n,client:s}=this.getTouchPosition(i);this.onEventCallback(new a.er(i.identifier,n,s,r.MP.PRIMARY,!0,a._A.TOUCH))}}onTouchEnd(e){if(e.cancelable&&e.preventDefault(),this.handledTouchesAsPointer)--this.handledTouchesAsPointer;else for(let t=0;t<e.changedTouches.length;t++){const i=e.changedTouches.item(t),{ndc:n,client:s}=this.getTouchPosition(i);this.onEventCallback(new a.er(i.identifier,n,s,r.MP.PRIMARY,!1,a._A.TOUCH))}}onTouchMove(e){if(e.cancelable&&e.preventDefault(),this.handledTouchesAsPointer)--this.handledTouchesAsPointer;else for(let t=0;t<e.changedTouches.length;t++){const i=e.changedTouches.item(t),{ndc:n,client:s}=this.getTouchPosition(i),o=new a.mE(i.identifier,n,s,r.r3.PRIMARY,a._A.TOUCH);this.onEventCallback(o)}}onPointerDown(e){switch(this.tryPreventDefault(e),e.pointerType){case a._A.MOUSE:this.onMouseDown(e);break;case a._A.GAMEPAD:case a._A.TOUCH:++this.handledTouchesAsPointer;const{ndc:t,client:i}=this.getPointerPosition(e);this.onEventCallback(new a.er(e.pointerId,t,i,r.MP.PRIMARY,!0,e.pointerType))}}onPointerUp(e){switch(this.tryPreventDefault(e),e.pointerType){case a._A.MOUSE:this.onMouseUp(e);break;case a._A.GAMEPAD:case a._A.TOUCH:++this.handledTouchesAsPointer;const{ndc:t,client:i}=this.getPointerPosition(e);this.onEventCallback(new a.er(e.pointerId,t,i,r.MP.PRIMARY,!1,e.pointerType))}}onPointerMove(e){switch(this.tryPreventDefault(e),e.pointerType){case a._A.MOUSE:-1!==e.button?this.activeButtons<e.buttons?this.onMouseDown(e):this.activeButtons>e.buttons&&this.onMouseUp(e):this.onMouseMove(e);break;case a._A.GAMEPAD:case a._A.TOUCH:++this.handledTouchesAsPointer;const{ndc:t,client:i}=this.getPointerPosition(e);this.onEventCallback(new a.mE(e.pointerId,t,i,r.r3.PRIMARY,e.pointerType))}}getPointerId(e){return(0,o.bX)(e)?e.pointerId:0}getPointerPosition(e){return{ndc:this.normalizePosition(e.clientX,e.clientY),client:{x:e.clientX-this.canvasData.x,y:e.clientY-this.canvasData.y}}}getTouchPosition(e){return{ndc:this.normalizePosition(e.clientX,e.clientY),client:{x:e.clientX-this.canvasData.x,y:e.clientY-this.canvasData.y}}}normalizePosition(e,t){return{x:2*(e-this.canvasData.x)/this.canvasData.width-1,y:-2*(t-this.canvasData.y)/this.canvasData.height+1}}tryPreventDefault(e){this.config.pointerPreventDefault&&e.cancelable&&e.preventDefault()}}InputPointer.doubleTapThreshold=300;var d,u=i(35825),p=i(22767),m=i(78626);!function(e){e[e.SEMICOLON=59]="SEMICOLON",e[e.PLUSEQUALS=61]="PLUSEQUALS",e[e.DASHUNDERSCORE=173]="DASHUNDERSCORE"}(d||(d={}));class InputKey{constructor(e){this.keysDown={},this.onEventCallback=e,this.bindHandlers()}bindHandlers(){if(window&&window.document){const e=window.document;window.addEventListener("blur",(()=>{Object.keys(this.keysDown).forEach((e=>this.keysDown[e]=!1))})),e.addEventListener("keydown",(e=>{if(!e.ctrlKey&&!e.metaKey){e.preventDefault();const t=this.translateFirefoxKeys(e.which||e.keyCode);this.keysDown[t]=!0,this.onEventCallback(new m.e(t,p.M.DOWN,e))}})),e.addEventListener("keyup",(e=>{if(!e.ctrlKey&&!e.metaKey){e.preventDefault();const t=this.translateFirefoxKeys(e.which||e.keyCode);this.keysDown[t]&&this.onEventCallback(new m.e(t,p.M.PRESSED,e)),this.keysDown[t]=!1,this.onEventCallback(new m.e(t,p.M.UP,e))}}))}}translateFirefoxKeys(e){switch(e){case d.SEMICOLON:return u.R.SEMICOLON;case d.PLUSEQUALS:return u.R.PLUSEQUALS;case d.DASHUNDERSCORE:return u.R.DASHUNDERSCORE}return e}}var g,f=i(32818),v=i(2212);!function(e){e[e.WAITING=0]="WAITING",e[e.WAITINGTOEXCEEDTHRESHOLD=1]="WAITINGTOEXCEEDTHRESHOLD",e[e.GESTURING=2]="GESTURING"}(g||(g={}));var y=i(75158);class ClickGesturer{constructor(e=.04,t=300){this.startPosition=new v.Vector2,this.pointerDelta=new v.Vector2,this.activeButtons=r.r3.NONE,this.state=g.WAITING,this.dragLimit=e,this.holdLimit=t}start(e){if(this.state===g.WAITING&&this.startPosition.copy(e.position),0==(e.buttons&e.buttons-1))this.startTime=Date.now(),this.activeButtons=e.buttons,this.state=g.WAITINGTOEXCEEDTHRESHOLD;else if(this.activeButtons)return this.state=g.GESTURING,new y.T(e.position,this.activeButtons)}stop(){let e;return this.state===g.WAITINGTOEXCEEDTHRESHOLD&&Date.now()-this.startTime<this.holdLimit&&(e=new y.R(this.startPosition.add(this.pointerDelta),(0,r.L2)(this.activeButtons)),this.pointerDelta.set(0,0)),this.state=g.WAITING,e}onMove(e){if(this.state===g.WAITINGTOEXCEEDTHRESHOLD&&(this.pointerDelta.copy(e.position).sub(this.startPosition),this.pointerDelta.length()>this.dragLimit))return this.state=g.GESTURING,new y.T(e.position,e.buttons)}compareState(e){return e===this.state}}var b=i(21588);class DragGesturer{constructor(e,t=.04){this.onEventCallback=e,this.startPosition=new v.Vector2,this.previousPosition=new v.Vector2,this.pointerDelta=new v.Vector2,this.lastPointerMove=Date.now(),this.state=g.WAITING,this.threshold=t}start(e){return this.state===g.WAITING&&(this.startPosition.copy(e.position),this.previousPosition.copy(this.startPosition),this.state=g.WAITINGTOEXCEEDTHRESHOLD),new b.E0(e.position,e.buttons)}stop(){const e=(new v.Vector2).copy(this.previousPosition).sub(this.startPosition);this.state===g.GESTURING&&this.onEventCallback(new b.Zv(this.startPosition,e)),this.state===g.WAITING&&this.pointerDelta.set(0,0),this.state=g.WAITING;const t=Date.now()-this.lastPointerMove;return new b._R(this.previousPosition,this.pointerDelta,r.r3.NONE,t,e)}onMove(e){let t;return this.state===g.WAITINGTOEXCEEDTHRESHOLD&&(this.pointerDelta.copy(e.position).sub(this.startPosition),this.pointerDelta.length()>this.threshold&&(this.state=g.GESTURING,this.onEventCallback(new b.u4(this.startPosition,e)))),this.state===g.GESTURING&&(this.pointerDelta.copy(e.position).sub(this.previousPosition),this.pointerDelta.length()>0&&(t=new b._t(this.previousPosition,this.pointerDelta,e.buttons,e.clientPosition))),this.previousPosition.copy(e.position),this.lastPointerMove=Date.now(),t}compareState(e){return e===this.state}compareStartPoint(e){return e.equals(this.startPosition)}compareDelta(e){return e.equals(this.pointerDelta)}}var w=i(93735);class PointerMovement{constructor(e=new v.Vector2,t=new v.Vector2,i=0){this.lastPosition=e,this.velocity=t,this.samePositionTicks=i}start(e){this.lastPosition.copy(e),this.velocity.set(0,0),this.samePositionTicks=0}update(e){if(this.lastPosition.distanceTo(e)<=.01){if(this.samePositionTicks++,this.samePositionTicks<2)return}else this.samePositionTicks=0;this.velocity.copy(this.lastPosition).sub(e),this.lastPosition.copy(e)}stationary(){return this.samePositionTicks>=2||this.velocity.length()<.01}}const S=2*Math.SQRT2;class PinchGesturer{constructor(e=.04){this.threshold=e,this.startDistance=0,this.previousDistance=0,this.pointerDelta=new v.Vector2,this.lastPointerMove=Date.now(),this.pinchDelta=0,this.state=g.WAITING,this.pointerMovement1=new PointerMovement,this.pointerMovement2=new PointerMovement}start(e,t){this.state===g.WAITING&&(this.restart(e,t),this.pointerMovement1.start(e.position),this.pointerMovement2.start(t.position))}stop(){this.state=g.WAITING;const e=Date.now()-this.lastPointerMove;return new w.i(this.pinchDelta,e)}onMove(e,t){this.pointerMovement1.update(e.position),this.pointerMovement2.update(t.position);if(!(this.pointerMovement1.stationary()||this.pointerMovement2.stationary()||this.pointerMovement1.velocity.dot(this.pointerMovement2.velocity)<0))return void this.restart(e,t);this.pointerDelta.copy(e.position).sub(t.position);const i=this.pointerDelta.length()/S;if(this.state===g.WAITINGTOEXCEEDTHRESHOLD){const e=i-this.startDistance;Math.abs(e)>this.threshold&&(this.state=g.GESTURING)}let n;if(this.state===g.GESTURING){const e=i-this.previousDistance;Math.abs(e)>0&&(this.pinchDelta=e,n=new w.G(e))}return this.previousDistance=i,this.lastPointerMove=Date.now(),n}restart(e,t){this.state=g.WAITINGTOEXCEEDTHRESHOLD,this.startDistance=e.position.distanceTo(t.position)/S,this.previousDistance=this.startDistance}}var E=i(67126),T=i(22079);class RotateGesturer{constructor(e=.1){this.startPointerDelta=new v.Vector2,this.previousPointerDelta=new v.Vector2,this.pointerDelta=new v.Vector2,this.lastPointerMove=Date.now(),this.angleWithDirection=0,this.state=g.WAITING,this.threshold=e}start(e,t){this.state===g.WAITING&&(this.state=g.WAITINGTOEXCEEDTHRESHOLD,this.startPointerDelta.copy(e.position).sub(t.position).normalize(),this.pointerDelta.copy(this.startPointerDelta),this.previousPointerDelta.copy(this.pointerDelta))}stop(){this.state=g.WAITING;const e=Date.now()-this.lastPointerMove;return new T.u(this.angleWithDirection,e)}onMove(e,t){if(this.pointerDelta.copy(e.position).sub(t.position).normalize(),this.state===g.WAITINGTOEXCEEDTHRESHOLD){Math.acos((0,E.uZ)(this.pointerDelta.dot(this.startPointerDelta),-1,1))>this.threshold&&(this.state=g.GESTURING)}let i;if(this.state===g.GESTURING){const e=Math.acos((0,E.uZ)(this.pointerDelta.dot(this.previousPointerDelta),-1,1));if(e>0){const t=this.previousPointerDelta.x*this.pointerDelta.y-this.previousPointerDelta.y*this.pointerDelta.x;this.angleWithDirection=t>=0?e:-e,i=new T.D(this.angleWithDirection)}}return this.previousPointerDelta.copy(this.pointerDelta),this.lastPointerMove=Date.now(),i}compareState(e){return e===this.state}}var M=i(24946);class MultiSwipeEvent extends M.C{constructor(e,t,i){super(),this.pointerCount=e,this.position=Object.assign({},t),this.delta=Object.assign({},i)}}class MultiSwipeEndEvent extends M.C{constructor(e,t,i,n){super(),this.pointerCount=e,this.position=Object.assign({},t),this.delta=Object.assign({},i),this.timeSinceLastMove=n}}class MultiSwipeGesturer{constructor(e=.04){this.startEpicenter=new v.Vector2,this.previousEpicenter=new v.Vector2,this.deltaEpicenter=new v.Vector2,this.currentEpicenter=new v.Vector2,this.pointerCount=0,this.lastPointerMove=Date.now(),this.state=g.WAITING,this.pointerMovements=[],this.threshold=e}start(e){this.state===g.WAITING&&(this.restart(e),this.pointerMovements=e.map((e=>new PointerMovement)),e.forEach(((e,t)=>{this.pointerMovements[t].start(e.position)})))}stop(){this.state=g.WAITING;const e=this.pointerCount;this.pointerCount=0;const t=Date.now()-this.lastPointerMove;return new MultiSwipeEndEvent(e,this.currentEpicenter,this.deltaEpicenter,t)}onMove(e){(0,c.VS)(this.getPointerPositions(e),this.currentEpicenter),e.forEach(((e,t)=>{this.pointerMovements[t].update(e.position)}));if(this.pointerMovements.find((e=>e.stationary())))return void this.restart(e);const t=this.pointerMovements[0].velocity;if(this.pointerMovements.find((e=>t.dot(e.velocity)<0)))return void this.restart(e);if(this.state===g.WAITINGTOEXCEEDTHRESHOLD){this.currentEpicenter.distanceTo(this.startEpicenter)>this.threshold&&(this.state=g.GESTURING)}let i;return this.state===g.GESTURING&&(this.deltaEpicenter.copy(this.currentEpicenter).sub(this.previousEpicenter),i=new MultiSwipeEvent(e.length,this.currentEpicenter,this.deltaEpicenter)),this.previousEpicenter.copy(this.currentEpicenter),this.lastPointerMove=Date.now(),i}getPointerPositions(e){return e.map((e=>e.position))}restart(e){(0,c.VS)(this.getPointerPositions(e),this.startEpicenter),this.previousEpicenter.copy(this.startEpicenter),this.currentEpicenter.copy(this.previousEpicenter),this.state=g.WAITINGTOEXCEEDTHRESHOLD,this.pointerCount=e.length}}var _=i(30604),x=i(35056);const A=new(i(25799).Z)("longpress");var O;!function(e){e[e.IDLE=0]="IDLE",e[e.WAITING=1]="WAITING",e[e.STARTED=2]="STARTED",e[e.SUCCESSFUL=3]="SUCCESSFUL"}(O||(O={}));class LongPressGesturer{constructor(e,t=500){this.onEventCallback=e,this.state=O.IDLE,this.ndcStartPosition=new v.Vector2,this.pointerDelta=new v.Vector2,this.ndcPosition=new v.Vector2,this.clientPosition=new v.Vector2,this.pressConfirmThreshold=this.pressStartThreshold=Math.max(t,1e-4)}start(e){this.state!==O.IDLE&&this.stop(),this.state===O.IDLE&&0==(e.buttons&e.buttons-1)&&(this.ndcStartPosition.copy(e.position),this.state=O.WAITING,this.buttons=e.buttons,this.pointerDelta.set(0,0),this.ndcPosition.copy(e.position),this.clientPosition.copy(e.clientPosition),this.holdTimeout=window.setTimeout((()=>{this.state=O.STARTED,A.debug("STARTED"),this.startTime=Date.now(),this.progress(0),this.onEventCallback(new x.Vh(e.position,e.clientPosition,e.buttons)),this.successTimeout=window.setTimeout((()=>{A.debug("SUCCESSFUL"),this.state=O.SUCCESSFUL,this.progress(1),this.onEventCallback(new x.$b(this.ndcPosition,this.clientPosition))}),this.pressConfirmThreshold)}),this.pressStartThreshold))}stop(){const e=this.state;if(this.state=O.IDLE,window.clearTimeout(this.holdTimeout),window.clearTimeout(this.successTimeout),e>O.WAITING){A.debug("DONE, cancelled:",e<O.SUCCESSFUL);const t=e<O.SUCCESSFUL;this.onEventCallback(new x.pt(this.ndcPosition,this.clientPosition,t))}}onMove(e){const t=this.state===O.STARTED||this.state===O.WAITING,i=this.state===O.STARTED||this.state===O.SUCCESSFUL;(t||i)&&(this.ndcPosition.copy(e.position),this.clientPosition.copy(e.clientPosition),this.pointerDelta.copy(this.ndcPosition).sub(this.ndcStartPosition)),t&&this.pointerDelta.length()>.1?this.stop():i&&this.onEventCallback(new x.DG(this.ndcPosition,this.clientPosition,this.pointerDelta,this.buttons))}tick(){if(this.state===O.STARTED){const e=1-(this.pressStartThreshold-(Date.now()-this.startTime))/this.pressStartThreshold;this.progress(Math.min(1,e))}}progress(e){this.onEventCallback(new x.PC(this.ndcPosition,this.clientPosition,this.pointerDelta,this.buttons,e))}}var P=i(25259),C=i(30853);class InputDebugMenu{constructor(){this.displayTouches=!1,this.touches=new Map}async init(e){const[t]=await Promise.all([e.getModule(C.default)]);t.registerMenuButton({header:"Input",buttonName:"Toggle pointer visualization",callback:()=>{this.displayTouches=!this.displayTouches}})}addPointer(e,t){this.displayTouches&&(this.touches.set(e,this.createPointer(t)),this.movePointer(e,t))}removePointer(e){const t=this.touches.get(e);t&&(document.body.removeChild(t),this.touches.delete(e))}movePointer(e,t){const i=this.touches.get(e);i&&(i.style.left=t.x-25+"px",i.style.top=t.y-25+"px")}createPointer(e){const t=document.createElement("div");return t.style.position="fixed",t.style.backgroundColor="#aa11aa",t.style.width="50px",t.style.height="50px",t.style.zIndex="99999",t.style.pointerEvents="none",t.style.touchAction="none",t.style.borderRadius="50px",document.body.appendChild(t),t}}var D;!function(e){e[e.NONE=0]="NONE",e[e.CLICK_DRAG_LONGPRESS=1]="CLICK_DRAG_LONGPRESS",e[e.PINCH_ROTATE=2]="PINCH_ROTATE",e[e.MULTI_SWIPE_ONLY=3]="MULTI_SWIPE_ONLY"}(D||(D={}));class InputGesture{constructor(){this.activeGesture=D.NONE,this.pointers=[],this.couldBeClick=!1}async init(e,t,i){this.onEventCallback=t,this.clicker=new ClickGesturer(e.dragThreshold),this.longPress=new LongPressGesturer(t,e.holdThreshold),this.dragger=new DragGesturer(t,e.dragThreshold),this.pincher=new PinchGesturer(e.pinchThreshold),this.rotater=new RotateGesturer(e.rotateThreshold),this.multiswiper=new MultiSwipeGesturer(e.dragThreshold);const n=await i.getModule(f.default);e.disableWheel||this.bindWheelHandlers(n.element),this.inputDebug=new InputDebugMenu,this.inputDebug.init(i)}get activePointers(){return this.pointers.length}onPointerChange(e){this.isMoveEvent(e)?this.onPointerMove(e):this.onPointerButton(e)}isMoveEvent(e){return!e.hasOwnProperty("down")}onPointerMove(e){this.movePointer(e.id,e.position,e.clientPosition,e.buttons),this.inputDebug.movePointer(e.id,e.clientPosition)}onPointerButton(e){e.down?(this.addPointer(e.id,e.position,e.clientPosition,e.button),this.inputDebug.addPointer(e.id,e.clientPosition)):(this.removePointer(e.id,e.button),this.inputDebug.removePointer(e.id))}bindWheelHandlers(e){e.addEventListener("wheel",(e=>{e.preventDefault(),this.onEventCallback(new _.a({x:e.clientX,y:e.clientY},{x:this.normalizeWheelDelta(e.deltaMode,e.deltaX),y:this.normalizeWheelDelta(e.deltaMode,e.deltaY)}))}))}normalizeWheelDelta(e,t){if(e===WheelEvent.DOM_DELTA_LINE){return.7*t*t*t+13*t}return t}addPointer(e,t,i,n){const s=(0,r.AF)(n);if(!s)return;const o=this.getPointer(e);o&&0==(o.buttons&s)?(o.buttons|=s,o.activeButtons++):this.pointers.push({id:e,position:new v.Vector2(t.x,t.y),clientPosition:new v.Vector2(i.x,i.y),buttons:s,activeButtons:1}),this.toggleGestures()}removePointer(e,t){const i=(0,r.AF)(t);if(!i)return;const n=this.getPointerIndex(e);if(-1!==n){const e=this.pointers[n];0!=(e.buttons&i)&&(e.buttons&=~i,e.activeButtons--),e.activeButtons||this.pointers.splice(n,1),this.toggleGestures()}}movePointer(e,t,i,n){const s=this.getPointer(e);if(s)switch(s.position.copy(t),s.clientPosition.copy(i),s.buttons!==n?this.updateOffscreenPointer(s,n):this.onEventCallback(new P.h(this.pointers)),this.activeGesture){case D.CLICK_DRAG_LONGPRESS:const e=this.clicker.onMove(s);e&&this.onEventCallback(e);const t=this.dragger.onMove(s);t&&this.onEventCallback(t),this.longPress.onMove(s);break;case D.PINCH_ROTATE:const i=this.pincher.onMove(this.pointers[0],this.pointers[1]),n=this.rotater.onMove(this.pointers[0],this.pointers[1]);i&&this.onEventCallback(i),n&&this.onEventCallback(n);case D.MULTI_SWIPE_ONLY:const o=this.multiswiper.onMove(this.pointers);o&&this.onEventCallback(o)}}getPointer(e){const t=this.getPointerIndex(e);if(-1!==t)return this.pointers[t]}toggleGestures(){this.onEventCallback(new P.h(this.pointers));const e=this.activeGesture;if(this.activeGesture=this.pointers.length,e===D.CLICK_DRAG_LONGPRESS&&this.activeGesture===D.NONE&&this.couldBeClick){const e=this.clicker.stop();e&&this.onEventCallback(e)}if(this.couldBeClick=e===D.NONE&&this.activeGesture===D.CLICK_DRAG_LONGPRESS,this.activeGesture===D.CLICK_DRAG_LONGPRESS){const e=this.clicker.start(this.pointers[0]);e&&this.onEventCallback(e);const t=this.dragger.start(this.pointers[0]);t&&this.onEventCallback(t),this.longPress.start(this.pointers[0])}else if(e===D.CLICK_DRAG_LONGPRESS){const e=this.dragger.stop();this.longPress.stop(),this.onEventCallback(e)}this.activeGesture===D.PINCH_ROTATE?(this.pincher.start(this.pointers[0],this.pointers[1]),this.rotater.start(this.pointers[0],this.pointers[1]),this.multiswiper.start(this.pointers)):e===D.PINCH_ROTATE&&(this.onEventCallback(this.pincher.stop()),this.onEventCallback(this.rotater.stop()),this.onEventCallback(this.multiswiper.stop())),this.activeGesture===D.MULTI_SWIPE_ONLY?this.multiswiper.start(this.pointers):e===D.MULTI_SWIPE_ONLY&&this.onEventCallback(this.multiswiper.stop())}getPointerIndex(e){for(let t=0;t<this.pointers.length;t++){if(this.pointers[t].id===e)return t}return-1}updateOffscreenPointer(e,t){if(e.buttons=t,0===t){const t=this.getPointerIndex(e.id);this.pointers.splice(t,1),this.toggleGestures()}}tick(){this.longPress.tick()}}var I=i(86515),R=i(73706),L=i(99169),N=i(62513);class InputSubscription{constructor(e,t,i){this._renew=e,this._cancel=t,this.active=i}renew(){this.active()||this._renew()}cancel(){this.active()&&this._cancel()}}class InputIni extends n.Y{constructor(){super(...arguments),this.name="input-ini",this.fallbackHandlerMap={},this.meshHandlerMap={},this.priorityHandlerMap={},this.unfilteredHandlerMap={},this.captureHandlerMap={},this.gesturing=!1,this.gestureCapture=new I.Z((e=>e.object.id)),this.activeIntersections=new I.Z((e=>e.object.id)),this.eventTypeLookup=new s.cj,this.meshTypeLookup=new s.cj,this.hoveredMesh={object:null,instanceId:void 0,index:void 0},this.registerUnfilteredHandler=(e,t)=>{this.insertHandler(e,this.unfilteredHandlerMap,t);const i=this.eventTypeLookup.getKeyByType(e);return new InputSubscription((()=>this.registerUnfilteredHandler(e,t)),(()=>this.unregisterUnfilteredHandler(e,t)),(()=>-1!==this.unfilteredHandlerMap[i].indexOf(t)))},this.registerMesh=(e,t)=>{this.raycaster.targets.addTarget(e,t)},this.unregisterMesh=e=>{this.raycaster.targets.removeTarget(e)},this.onPointerEvent=e=>{const t=!e.hasOwnProperty("down"),i=!t&&e.down,n=!i&&!t;if(t||i){this.raycaster.pointer.updatePointer(e.position),this.activeIntersections.clear();for(const e of this.raycaster.pointer.cast())this.activeIntersections.add(e);if(!this.gesturing){this.gestureCapture.clear();for(const e of this.activeIntersections)this.gestureCapture.add(e);this.updateHoveredMesh()}i&&(this.gesturing=!0),this.onEvent(e)}this.inputGesture.onPointerChange(e),n&&this.onEvent(e),0===this.inputGesture.activePointers&&(this.activeIntersections.clear(),this.gestureCapture.clear(),this.gesturing=!1)},this.onEvent=e=>{const t=this.eventTypeLookup.getKeyByInstance(e),i=this.captureHandlerMap[t];if(i&&i.length>0){for(const t of i)t(e);return void(i.length=0)}const n=this.unfilteredHandlerMap[t];if(n)for(const t of n)t(e);const s=this.iterateMeshCallbacks(e,this.gesturing?this.gestureCapture:this.activeIntersections),o=this.fallbackHandlerMap[t];if(!s&&o)for(const t of o)t(e)}}async init(e,t){const i={disableWheel:!!e.disableWheel},n=await t.getModule(f.default),s=await t.market.waitForData(L.W);this.raycaster=await t.getModule(N.default),new InputPointer({pointerPreventDefault:e.pointerPreventDefault},n.element,s,this.onPointerEvent),new InputKey(this.onEvent),this.inputGesture=new InputGesture,this.inputGesture.init(i,this.onEvent,t)}registerHandler(e,t){this.insertHandler(e,this.fallbackHandlerMap,t);const i=this.eventTypeLookup.getKeyByType(e,!0);return new InputSubscription((()=>this.registerHandler(e,t)),(()=>this.unregisterHandler(e,t)),(()=>-1!==this.fallbackHandlerMap[i].indexOf(t)))}unregisterHandler(e,t){this.removeHandler(e,this.fallbackHandlerMap,t)}registerMeshHandler(e,t,i){return this._registerMeshHandler(e,{comparator:t,callback:i})}_registerMeshHandler(e,t){const i=this.eventTypeLookup.getKeyByType(e,!0);this.meshHandlerMap[i]||(this.meshHandlerMap[i]=[]);const n=this.meshHandlerMap[i];return n.push(t),new InputSubscription((()=>this._registerMeshHandler(e,t)),(()=>this.unregisterMeshHandler(e,t)),(()=>-1!==n.indexOf(t)))}unregisterMeshHandler(e,t){const i=this.eventTypeLookup.getKeyByType(e,!0);if(this.meshHandlerMap[i]){const e=this.meshHandlerMap[i],n=e.indexOf(t);n>-1&&e.splice(n,1)}}registerPriorityHandler(e,t,i){const n=this.eventTypeLookup.getKeyByType(e,!0),o=this.meshTypeLookup.getKeyByType(t,!0);this.priorityHandlerMap[n]||(this.priorityHandlerMap[n]={});const r=this.priorityHandlerMap[n];if(r[o]){const i=(0,s.z$)(e),n=(0,s.z$)(t);throw Error(`${i} already has a priority handler registered for mesh type: ${n}`)}return r[o]=i,new InputSubscription((()=>this.registerPriorityHandler(e,t,i)),(()=>this.unregisterPriorityHandler(e,t,i)),(()=>void 0!==r[o]))}unregisterPriorityHandler(e,t,i){const n=this.eventTypeLookup.getKeyByType(e),s=this.priorityHandlerMap[n];if(s){const e=this.meshTypeLookup.getKeyByType(t),n=s[e];n&&i===n&&delete s[e]}}unregisterUnfilteredHandler(e,t){this.removeHandler(e,this.unfilteredHandlerMap,t)}captureNext(e,t){return this.insertHandler(e,this.captureHandlerMap,t),t}removeCaptureHandler(e,t){this.removeHandler(e,this.captureHandlerMap,t)}updateHoveredMesh(){const e=this.activeIntersections.getByIndex(0),t=e&&e.object===this.hoveredMesh.object&&e.instanceId===this.hoveredMesh.instanceId&&e.index===this.hoveredMesh.index;let i=!1;if(this.hoveredMesh.object&&(void 0===e||!t)){const t=this.getMeshHandler(R.A,(0,s.oL)(this.hoveredMesh.object),this.priorityHandlerMap);if(t&&(i=t(new R.A,this.hoveredMesh.object,e)||!1),!i){const t=this.meshHandlerMap[this.eventTypeLookup.getKeyByType(R.A)];if(t)for(const i of t)i.comparator.compare(this.hoveredMesh.object)&&i.callback(new R.A,this.hoveredMesh.object,e)}}let n=!1;if(e&&!t){const t=this.getMeshHandler(R.z,(0,s.oL)(e.object),this.priorityHandlerMap);if(t&&(n=t(new R.z,e.object,e)||!1),!n){const t=this.meshHandlerMap[this.eventTypeLookup.getKeyByType(R.z)];if(t)for(const i of t)i.comparator.compare(e.object)&&i.callback(new R.z,e.object,e)}}this.hoveredMesh.object=e&&e.object||null,this.hoveredMesh.instanceId=null==e?void 0:e.instanceId,this.hoveredMesh.index=null==e?void 0:e.index}iterateMeshCallbacks(e,t){let i=!1;const n=this.eventTypeLookup.getKeyByInstance(e);for(const s of t){if(i)break;const t=s.object,o=this.activeIntersections.get(t.id)||s;for(const r in this.priorityHandlerMap[n])if(s.object instanceof this.meshTypeLookup.getTypeByKey(r)){const s=this.priorityHandlerMap[n]&&this.priorityHandlerMap[n][r];if(s&&(i=!0,s(e,t,o)))return!0}const r=this.meshHandlerMap[n];if(r)for(const n of r)if(n.comparator.compare(t)){const s=n.callback(e,t,o);i||(i=s||void 0===s)}}return i}insertHandler(e,t,i){const n=this.eventTypeLookup.getKeyByType(e,!0);t[n]||(t[n]=[]),t[n].push(i)}removeHandler(e,t,i){const n=t[this.eventTypeLookup.getKeyByType(e)];if(n)for(let e=0;e<n.length;e++)if(n[e]===i){n.splice(e,1);break}}getMeshHandler(e,t,i){const n=i[this.eventTypeLookup.getKeyByType(e)];if(n){return n[this.meshTypeLookup.getKeyByType(t)]}return null}onUpdate(){this.inputGesture.tick()}}},78626:(e,t,i)=>{"use strict";i.d(t,{e:()=>KeyEvent});var n=i(86480);class KeyEvent extends n.G{constructor(e,t,i){super(),this.key=e,this.state=t,this.modifiers=i}}},22767:(e,t,i)=>{"use strict";var n;i.d(t,{M:()=>n}),function(e){e[e.DOWN=0]="DOWN",e[e.PRESSED=1]="PRESSED",e[e.UP=2]="UP"}(n||(n={}))},35825:(e,t,i)=>{"use strict";var n;i.d(t,{R:()=>n}),function(e){e[e.BACKSPACE=8]="BACKSPACE",e[e.TAB=9]="TAB",e[e.RETURN=13]="RETURN",e[e.SHIFT=16]="SHIFT",e[e.CONTROL=17]="CONTROL",e[e.ALT=18]="ALT",e[e.ESCAPE=27]="ESCAPE",e[e.SPACE=32]="SPACE",e[e.HASH=35]="HASH",e[e.LEFTARROW=37]="LEFTARROW",e[e.UPARROW=38]="UPARROW",e[e.RIGHTARROW=39]="RIGHTARROW",e[e.DOWNARROW=40]="DOWNARROW",e[e.DELETE=46]="DELETE",e[e.ZERO=48]="ZERO",e[e.ONE=49]="ONE",e[e.TWO=50]="TWO",e[e.THREE=51]="THREE",e[e.FOUR=52]="FOUR",e[e.FIVE=53]="FIVE",e[e.SIX=54]="SIX",e[e.SEVEN=55]="SEVEN",e[e.EIGHT=56]="EIGHT",e[e.NINE=57]="NINE",e[e.AT=64]="AT",e[e.A=65]="A",e[e.B=66]="B",e[e.C=67]="C",e[e.D=68]="D",e[e.E=69]="E",e[e.F=70]="F",e[e.G=71]="G",e[e.H=72]="H",e[e.I=73]="I",e[e.J=74]="J",e[e.K=75]="K",e[e.L=76]="L",e[e.M=77]="M",e[e.N=78]="N",e[e.O=79]="O",e[e.P=80]="P",e[e.Q=81]="Q",e[e.R=82]="R",e[e.S=83]="S",e[e.T=84]="T",e[e.U=85]="U",e[e.V=86]="V",e[e.W=87]="W",e[e.X=88]="X",e[e.Y=89]="Y",e[e.Z=90]="Z",e[e.SEMICOLON=186]="SEMICOLON",e[e.PLUSEQUALS=187]="PLUSEQUALS",e[e.DASHUNDERSCORE=189]="DASHUNDERSCORE",e[e.OPENBRACKET=219]="OPENBRACKET"}(n||(n={}))},40582:(e,t,i)=>{"use strict";var n,s;i.d(t,{MP:()=>n,r3:()=>s,AF:()=>o,L2:()=>r}),function(e){e[e.PRIMARY=0]="PRIMARY",e[e.MIDDLE=1]="MIDDLE",e[e.SECONDARY=2]="SECONDARY",e[e.BACK=3]="BACK",e[e.FORWARD=4]="FORWARD",e[e.COUNT=5]="COUNT"}(n||(n={})),function(e){e[e.NONE=0]="NONE",e[e.PRIMARY=1]="PRIMARY",e[e.SECONDARY=4]="SECONDARY",e[e.MIDDLE=2]="MIDDLE",e[e.BACK=8]="BACK",e[e.FORWARD=16]="FORWARD",e[e.ALL=31]="ALL"}(s||(s={}));const o=e=>{const t=s[n[e]];return"number"==typeof t?t:void 0},r=e=>{const t=n[s[e]];return"number"==typeof t?t:void 0}},36073:(e,t,i)=>{"use strict";i.d(t,{_A:()=>n,er:()=>PointerButtonEvent,mE:()=>PointerMoveEvent});var n,s=i(86480);class PointerEvent extends s.G{}!function(e){e.MOUSE="mouse",e.TOUCH="touch",e.PEN="pen",e.GAMEPAD="gamepad"}(n||(n={}));class PointerButtonEvent extends PointerEvent{constructor(e,t,i,n,s,o){super(),this.id=e,this.position=t,this.clientPosition=i,this.button=n,this.down=s,this.device=o}}class PointerMoveEvent extends PointerEvent{constructor(e,t,i,n,s){super(),this.id=e,this.position=t,this.clientPosition=i,this.buttons=n,this.device=s}}},27468:(e,t,i)=>{"use strict";var n,s;i.d(t,{s:()=>n,f:()=>s}),function(e){e.Desktop="desktop",e.Mobile="mobile",e.VrOrientOnly="xr.orientonly",e.VrWithController="xr.controller",e.VrWithTrackedController="xr.trackedcontroller"}(n||(n={})),function(e){e.None="interaction.none",e.Direct="interaction.direct",e.Key="interaction.key",e.Gui="interaction.gui",e.Mouse="interaction.mouse",e.Touch="interaction.touch",e.Pen="interaction.pen",e.XRController="interaction.xr.controller",e.XRGaze="interaction.xr.gaze",e.XRScreen="interaction.xr.screen"}(s||(s={}))},75711:(e,t,i)=>{"use strict";i.d(t,{Z:()=>InteractionmodeData});var n=i(19413),s=i(27468);class InteractionmodeData extends n.V{constructor(){super(...arguments),this.name="interaction",this._source=InteractionmodeData.defaultSource,this._mode=InteractionmodeData.defaultMode}static get defaultMode(){return s.s.Desktop}static get defaultSource(){return s.f.None}get mode(){return this._mode}get source(){return this._source}updateSource(e){this._source=e}updateMode(e){this._mode=e}copy(e){this.updateMode(e.mode),this.updateSource(e.source)}hasController(e=this.mode){return e===s.s.VrWithController||e===s.s.VrWithTrackedController}isVR(e=this.mode){return e===s.s.VrOrientOnly||e===s.s.VrWithController||e===s.s.VrWithTrackedController}isMobile(e=this.mode){return e===s.s.Mobile}}},75752:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>InteractionModeModule});var n=i(54122),s=i(50101),o=i(30963),r=i(36073),a=i(78626),l=i(75711),c=i(27468),h=i(51418),d=i(21265);class InteractionModeModule extends n.Y{constructor(){super(...arguments),this.name="interactionmode",this.onPointerButtonEvent=e=>{let t=this.data.source;switch(e.device){case r._A.TOUCH:t=c.f.Touch;break;case r._A.MOUSE:t=c.f.Mouse;break;case r._A.PEN:t=c.f.Pen;break;case r._A.GAMEPAD:this.renderer.xr.enabled&&this.renderer.xr.isPresenting&&(t=c.f.XRController);break;default:this.log.debug("source:",e.device,e)}this.updateSource(t)},this.onKeyEvent=()=>{this.updateSource(c.f.Key)}}async init(e,t){this.engine=t,this.data=new l.Z,this.mobileBrowser=(0,d.tq)();const i=await t.getModule(s.default);this.renderer=i.threeRenderer,this.updateMode(this.getInteractionMode(),this.data.mode),this.engine.market.register(this,l.Z,this.data),t.getModule(o.default).then((e=>{this.bindings.push(e.registerHandler(r.er,this.onPointerButtonEvent),e.registerHandler(a.e,this.onKeyEvent))}))}onUpdate(e){const t=this.getInteractionMode();this.updateMode(t,this.data.mode)}getInteractionMode(){if(this.renderer.xr.enabled&&this.renderer.xr.isPresenting){const e=this.renderer.xr.getSession();if(null!==e&&e.inputSources.length>0)switch(e.inputSources[0].targetRayMode){case"gaze":case"screen":return c.s.VrOrientOnly;case"tracked-pointer":return c.s.VrWithTrackedController}return c.s.VrOrientOnly}return this.mobileBrowser?c.s.Mobile:c.s.Desktop}updateMode(e,t){e!==this.data.mode&&(this.data.updateMode(e),this.data.commit(),this.engine.broadcast(new h.m(this.data.mode,t)))}updateSource(e){e!==this.data.source&&(this.data.updateSource(e),this.data.commit(),this.engine.broadcast(new h.a(this.data.source)))}}},51418:(e,t,i)=>{"use strict";i.d(t,{m:()=>InteractionModeChangeMessage,a:()=>InteractionSourceChangeMessage});var n=i(93528);class InteractionModeChangeMessage extends n.v{constructor(e,t){super(),this.mode=e,this.fromMode=t}}class InteractionSourceChangeMessage extends n.v{constructor(e){super(),this.source=e}}},52388:(e,t,i)=>{"use strict";i.d(t,{_:()=>Label});var n=i(78909),s=i(2212);class Label extends n.T{constructor(){super(...arguments),this.position=new s.Vector3,this.floorId="",this.sid="",this.text="",this.visible=!1,this.roomId="",this.created=new Date,this.modified=new Date,this.version="3.1"}copy(e){return this.floorId=e.floorId,this.sid=e.sid,this.text=e.text,this.visible=e.visible,this.roomId=e.roomId,this.created=e.created,this.modified=e.modified,this.position.copy(e.position),this.version=e.version,this.commit(),this}}},7342:(e,t,i)=>{"use strict";i.d(t,{D:()=>LabelData});var n=i(19413),s=i(52388),o=i(71229),r=i(62367);const a=new(i(25799).Z)("label-data");class LabelData extends n.V{constructor(e){super(),this.name="label",this.has=e=>this.map.has(e),this.getLabel=e=>this.map.get(e),this.map=(0,o.q)(e||{})}add(e){let t=e.sid;for(this.map.has(t)&&a.warn("Label already tracked:",{sid:t,label:e,existing:this.getLabel(t)});!t||this.map.has(t);)t=(0,r.O1)(11);return e.sid=t,e.commit(),this.map.set(e.sid,e),t}remove(e){return!!this.map.has(e)&&(this.map.delete(e),!0)}clear(){for(const e of this.map.keys)this.map.delete(e)}getCollection(){return this.map}iterate(e){for(const t of this.map.keys)e(this.map.get(t),t)}isEqual(e){if(this.map.length!==e.map.length)return!1;for(const t of this.map){const i=e.map.get(t.sid);if(!i||!LabelData.labelsAreEqual(t,i))return!1}return!0}static labelsAreEqual(e,t){return e.floorId===t.floorId&&e.roomId===t.roomId&&e.position.x===t.position.x&&e.position.y===t.position.y&&e.position.z===t.position.z&&e.sid===t.sid&&e.text===t.text&&e.floorId===t.floorId&&e.roomId===t.roomId&&e.visible===t.visible}copy(e){return this.clear(),e.iterate((e=>{this.add((new s._).copy(e))})),this}clone(){return(new LabelData).copy(this)}getLabelsForRoom(e){const t=[];return this.iterate((i=>{i.roomId===e&&t.push(i)})),t}}},66872:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>LabelDataModule});var n=i(25799),s=i(54122),o=i(17256),r=i(43894),a=i(44333),l=i(83032),c=i(83083),h=i(64614),d=i(60841),u=i(70389),p=i(7342),m=i(20331),g=i(80034),f=i(41263),v=i(7943),y=i(15119),b=i(97620),w=i(52388),S=i(46162),E=i(32020);const T=new n.Z("label-serialization"),M=e=>{if(!e)return null;const t={};if(e)for(const i of Object.keys(e)){const n=e[i];try{if(!n||!n.version||isNaN(Number.parseFloat(n.version))||Number.parseFloat(n.version)<3)continue;const e=new w._;e.copy({floorId:"number"==typeof n.floorId?String(n.floorId):"",position:(0,b.gj)(n.position),sid:n.sid,text:n.text||"",visible:n.visible,roomId:n.roomId,created:(0,E.p)(n.created),modified:(0,E.p)(n.modified),version:n.version}),t[n.sid]=e}catch(e){T.warn("Error parsing label data; not adding label: ",n)}}return t},_=(e,t)=>{const i={},n=(0,S.p$)(e);(0,S.TS)(n,t);for(const e of Object.keys(n)){const t=n[e];if(!t)continue;const s=parseInt(t.floorId,10);if(isNaN(s))throw new Error(`Failed to serialize unsupported floor ID '${t.floorId}'`);i[t.sid]={floorId:s,position:t.position,sid:t.sid,text:t.text,visible:t.visible,roomId:t.roomId,created:(0,E.U)(t.created),modified:(0,E.U)(t.modified),version:t.version},i[t.sid].position=(0,b.gj)(t.position)}return i},x=(e,t)=>{const i=[],n=(0,S.p$)(e);(0,S.TS)(n,t);for(const e of Object.keys(n)){const t=n[e];if(!t)continue;const s=parseInt(t.floorId,10);if(isNaN(s))throw new Error(`Failed to serialize unsupported floor ID '${t.floorId}'`);i.push({floorId:s,position:(0,b.gj)(t.position),sid:t.sid,text:t.text,visible:t.visible,roomId:t.roomId,created:(0,E.U)(t.created),modified:(0,E.U)(t.modified),version:t.version})}return i};var A=i(32400),O=i(51770),P=i(60982);const C=new n.Z("mds-label-serialize");class MdsLabelCreateSerializer{constructor(){this.validate=e=>{if(!e)return!1;const t=["enabled","floorId","label","position"].filter((t=>!(t in e))),i=0===t.length,n=!!e.floorId&&"string"==typeof e.floorId,s=!!e.position&&(0,P.uU)(e.position),o=i&&n&&s;return o||C.debug("Label invalid:",{missingFields:t,validPosition:s}),o}}serialize(e){const t=D(e);return this.validate(t)?t:null}}class MdsLabelUpdateSerializer{constructor(){this.validate=e=>{if(!e)return!1;const t=["enabled","label","position","floorId","roomId"];return Object.keys(e).every((e=>t.includes(e)))}}serialize(e){const t=D(e);return t&&this.validate(t)?t:null}}const D=e=>{const t={};return void 0!==e.visible&&(t.enabled=e.visible),void 0!==e.text&&(t.label=e.text),void 0!==e.position&&(0,P.uU)(e.position)&&(t.position=b.ep.toVisionVector(e.position)),void 0!==e.floorId&&""!==e.floorId&&(t.floorId=e.floorId),void 0!==e.roomId&&""!==e.roomId&&(t.roomId=e.roomId),Object.keys(t).length>0?t:null},I=new n.Z("mds-label-deserializer");class MdsLabelDeserializer{constructor(){this.validate=e=>{if(!e)return!1;const t=["id","created","modified","enabled","floor","label","position"].filter((t=>!(t in e))),i=0===t.length,n=!(!e.floor||!e.floor.id),s=!!e.position&&(0,P.uU)(e.position);return i&&n&&s||I.debug("Label invalid:",{missingFields:t,validFloor:n,validPosition:s}),i&&n&&s}}deserialize(e){if(!e||!this.validate(e))return I.debug("Deserialized invalid Label data from MDS",e),null;const t=new w._;return t.sid=e.id,t.floorId=e.floor.id,t.text=e.label,t.visible=!!e.enabled,t.created=(0,E.p)(e.created),t.modified=(0,E.p)(e.modified),t.position=b.ep.fromVisionVector(e.position),e.room&&e.room.id&&(t.roomId=e.room.id),t}}var R=i(23637);const L=new n.Z("MdsLabelStore");class MdsLabelStore extends A.u{constructor(e){super(e),this.prefetchKey="data.model.labels",this.deserializer=new MdsLabelDeserializer,this.updateSerializer=new MdsLabelUpdateSerializer,this.createSerializer=new MdsLabelCreateSerializer}async read(e){const{includeDisabled:t=!1}=this.config,i={modelId:this.getViewId(),includeDisabled:t};return this.query(R.GetLabels,i,e).then((e=>{var t,i;const n=null===(i=null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.model)||void 0===i?void 0:i.labels;if(!n||!Array.isArray(n))return null;const s=[];for(const e of n){const t=this.deserializer.deserialize(e);t&&s.push(t)}return s.reduce(((e,t)=>(e[t.sid]=t,e)),{})}))}async create(e){const t=this.getViewId();return Promise.all(e.map((e=>{const i=this.createSerializer.serialize(e);if(!i)throw L.error("Failure saving label:",e.sid,e),new Error("Could not save Label");return this.mutate(R.AddLabel,{modelId:t,labelId:e.sid,data:i}).then((t=>{const i=(0,O.qw)(t,"data.addLabel"),n=(new w._).copy(e);return n.sid=i.id,n.commit(),L.debug(Object.assign({type:"addLabel"},t)),n}))})))}async update(e){const t=this.getViewId();return Promise.all(e.map((e=>{const i=e.sid,n=this.updateSerializer.serialize(e);if(!n)throw L.error("Failure updating label:",i,e),new Error("Could not update Label");return this.mutate(R.PatchLabel,{modelId:t,labelId:i,data:n}).then((e=>{L.debug(Object.assign({type:"patchLabel"},e))}))})))}async delete(e){const t=this.getViewId();return Promise.all(e.map((e=>{if(!e||!e.sid)throw L.error("Failure deleting label:",e),new Error("Could not update Label");const i=e.sid;return this.mutate(R.DeleteLabel,{modelId:t,labelId:i}).then((e=>{L.debug(Object.assign({type:"deleteLabel"},e))}))})))}}const N=new n.Z("label-data");class LabelDataModule extends s.Y{constructor(){super(...arguments),this.name="label-data",this.monitor=null}async init(e,t){this.config=Object.assign(Object.assign({},e),{readonly:!("readonly"in e)||!!e.readonly,storageProvider:e.storageProvider||o.Xq.JSONSTORE}),this.engine=t,this.market=t.market,this.store=this.configureStorage();const i=await this.store.read()||{};this.roomDataModule=await t.getModule(u.default);const n=await t.getModule(r.F);for(const e of Object.values(i))this.roomDataModule.inferMeshIdsFromPoint(e,e.position);this.labelData=t.market.tryGetData(p.D)||new p.D(i),this.market.register(this,p.D,this.labelData),this.config.readonly||this.configureSaving(this.store,this.labelData),this.bindings.push(n.onSave((()=>this.saveDiff()),{dataType:o.g.LABELS}),n.onRevert((()=>this.revert()),{dataType:o.g.LABELS}))}configureStorage(){const{modelId:e,baseUrl:t,queue:i,readonly:n}=this.config;if(N.info(`Loading Labels from ${this.config.storageProvider}`),this.config.storageProvider===o.Xq.MDS)return new MdsLabelStore({readonly:n,includeDisabled:!n,baseUrl:t});const s=function(e){const{modelId:t,readonly:i}=e,n=e.baseUrl||"",s=e.queue||new m.gO,o=M,r=_,a=`${n}/api/v1/jsonstore/model/Labels/${t}`;if(i){const e=new g.gh({queue:s,path:a,deserialize:o});return new f.iY({publishStores:[e]})}const l=new g.MU({queue:s,path:a,batchUpdate:!0,deserialize:o,serialize:r}),c=`${n}/api/v1/jsonstore/model/workshopSession/${t}`,h=new y.Z({queue:s,path:c,cachedData:{data:null},deserialize:v.S.sessionCollectionMap(y.j.Labels,o),serialize:x},y.j.Labels);return new f.iY({publishStores:[l],legacyEditStore:h,editStoreKey:f.aw.LABELS})}({modelId:e,baseUrl:t,readonly:n,queue:i});return new l.N(s,{dataType:o.g.LABELS,modelId:e,readonly:n,engine:this.engine})}configureSaving(e,t){this.monitor=new c.c(t.getCollection(),{aggregationType:d.E.Manual,shallow:!0},this.engine),this.store instanceof l.N&&e.addMonitor(this.monitor)}async save(){return this.engine.commandBinder.issueCommand(new a.VQ({dataTypes:[o.g.LABELS]}))}getDiffRecord(){var e;return(null===(e=this.monitor)||void 0===e?void 0:e.getDiffRecord())||[]}async saveDiff(){if(!this.store||!this.monitor)return void N.warn("Labels changes will NOT be saved");if(this.monitor.commitChanges(),this.store instanceof l.N)return;const e=this.monitor.getDiffRecord();this.monitor.clearDiffRecord();const t=e,i=t.filter((e=>e.action===h.KI.removed)).map((e=>({sid:e.index}))),n=t.filter((e=>e.action===h.KI.added)).map((e=>this.labelData.getLabel(e.index))),s=t.filter((e=>e.action===h.KI.updated)).map((e=>Object.assign({sid:e.index},e.diff)));return Promise.all([this.store.delete(i),this.store.create(n),this.store.update(s)]).then((()=>{}))}async revert(){if(this.store instanceof l.N)return this.store.revert()}onUpdate(e){}}},57155:(e,t,i)=>{"use strict";i.d(t,{Nj:()=>n,Mr:()=>s});const n="features/labels",s="features/3d_labels_visble"},93675:(e,t,i)=>{"use strict";i.d(t,{_:()=>s,I:()=>LabelAnchor});var n=i(2212);const s={ColorDefault:16777215,ColorSelected:3694079,ColorInvalid:16405248};class LabelAnchor extends n.Mesh{getId(){if(!this.data)throw new Error("LabelInputCollider used before configure");return this.data.sid}setColorHex(e){this.material.color.getHex()!==e&&this.material.color.setHex(e)}use(e){this.data=e.data}}},8292:(e,t,i)=>{"use strict";i.d(t,{M:()=>LabelMesh});var n=i(2212),s=i(88493),o=i(290),r=i(81032),a=i(62367),l=i(93675),c=i(64786);class LabelMesh extends n.Object3D{constructor(e,t,i){super(),this.anchor=e,this.text=t,this.line=i,this.maxOpacity=1,this.labelAnim=new o.z(0),this.anchorAnim=new o.z(0),this.radius=r.R.ANCHOR_MAX_RADIUS,this.targets={labelPos:new n.Vector3,labelLookAt:new n.Quaternion,anchorPos:new n.Vector3},this.temp={v3:new n.Vector3,line:new n.Line3,justShortOfAnchor:new n.Vector3,justShortOfLabel:new n.Vector3},this.selectState={active:!1,on:()=>{this.toggleAnchor(!0),this.anchor.setColorHex(l._.ColorSelected)},off:()=>{this.toggleAnchor(!1),this.anchor.setColorHex(l._.ColorDefault)}},this.validState={active:!0,on:()=>{const e=this.hoverState.active?c.BV.ColorHovered:c.BV.ColorDefault;this.text.setColorHex(e);const t=this.selectState.active?l._.ColorSelected:l._.ColorDefault;this.anchor.setColorHex(t)},off:()=>{this.text.setColorHex(c.BV.ColorInvalid),this.anchor.setColorHex(l._.ColorInvalid)}},this.hoverState={active:!1,on:()=>{this.validState.active&&this.text.setColorHex(c.BV.ColorHovered)},off:()=>{this.validState.active&&this.text.setColorHex(c.BV.ColorDefault)}},this.add(i.getMesh(s.B.line)),this.add(e),this.add(t)}getColliders(){return[this.anchor,this.text.collider]}use(e){this.data=e,this.userData.sid=e.sid,this.userData.data=e,this.line.updatePositions(e.position,e.position),this.anchor.use(this),this.anchorUpdate(e.position,this.radius,!0),this.text.use(this),this.labelUpdate(e.position,new n.Quaternion,"")}getId(){return this.data.sid}labelVisible(){return this.labelAnim.endValue>0}anchorVisible(){return this.anchorAnim.endValue>0}isSelected(){return this.anchorVisible()}updatePose(e,t,i){return this.targets.anchorPos.copy(e),this.targets.labelPos.copy(t),i&&this.targets.labelLookAt.copy(i),this}setMaxOpacity(e){this.maxOpacity=e,this.toggleLabel(this.labelVisible())}async free(){(this.labelVisible()||this.anchorVisible())&&(this.toggleAnchor(!1),this.toggleLabel(!1),await(0,a.gw)(r.R.FADE_DURATION))}tickAnimations(e){return this.animateLabelOpacity(.5*e),this.animateAnchorOpacity(.2*e),this.animateAnchor(),this.animateLineAndLabel(1),this}toggleLabel(e){const t=e?this.maxOpacity:0;return this.labelAnim.endValue!==t&&this.labelAnim.modifyAnimation(this.labelAnim.value,t,r.R.FADE_DURATION),this}toggleAnchor(e){const t=e?1:0;return this.anchorAnim.endValue!==t&&this.anchorAnim.modifyAnimation(this.anchorAnim.value,t,r.R.FADE_DURATION),this}animateLabelOpacity(e){const t=this.labelAnim.tick(e);Math.min(t,this.maxOpacity)!==this.text.opacity&&(this.text.opacity=t)}animateAnchorOpacity(e){const t=this.anchorAnim.tick(e),i=Math.min(t,r.R.LINE_OPACITY);this.line.currentOpacity!==i&&this.line.opacity(i)}animateAnchor(){const{anchorPos:e}=this.targets;if(!this.anchor.position.equals(e)){this.temp.v3.copy(this.anchor.position).lerp(e,this.anchorAnim.value);const t=this.labelVisible()?r.R.ANCHOR_MAX_RADIUS:r.R.ANCHOR_MIN_RADIUS;this.anchorUpdate(this.temp.v3,t)}}animateLineAndLabel(e){const{labelPos:t,anchorPos:i,labelLookAt:n}=this.targets;let s=!1;if(this.temp.v3.copy(this.text.position),this.text.position.equals(t)||(this.temp.v3.lerp(t,e),s=!0),this.labelUpdate(this.temp.v3,n,this.data.text),this.temp.line.set(this.text.position,i),this.temp.line.at(.9,this.temp.justShortOfAnchor),s||!this.line.endPosition.equals(this.temp.justShortOfAnchor)){this.temp.line.at(.08,this.temp.justShortOfLabel);const t=this.temp.v3.copy(this.line.endPosition).lerp(this.temp.justShortOfAnchor,e);this.line.updatePositions(this.temp.justShortOfLabel,t)}}anchorUpdate(e,t,i=!1){this.anchor.position.copy(e),void 0===t||!i&&this.radius===t||(this.anchor.scale.set(t,t,t),this.radius=t)}labelUpdate(e,t,i){this.text.position.copy(e),this.text.quaternion.copy(t),this.text.text=i}billboard(e,t,i,n,s,o,r){this.text.scaleBillboard(e,t,i,n,s,o,r),this.anchorVisible()&&this.anchor.scale.copy(this.text.scale).multiplyScalar(20)}}},64786:(e,t,i)=>{"use strict";i.d(t,{BV:()=>o,b6:()=>LabelTextMesh,Es:()=>LabelTextBackgroundMesh});var n=i(36168),s=i(2212);const o={ColorDefault:16777215,ColorHovered:i(61956).I.MP_BRAND.getHex(),ColorInvalid:16405248};class LabelTextMesh extends n.${use(e){this.userData.sid=e.data.sid,this.collider.data=e.data,this.collider.name=e.data.text,this.collider.labelMesh=e}}class LabelTextBackgroundMesh extends s.Mesh{constructor(){super(...arguments),this.hitTest=(()=>{const e=new s.Matrix4,t=new s.Ray,i=new s.Plane(new s.Vector3(0,0,-1)),n=new s.Vector3;return(s,o)=>{if(e.copy(this.matrixWorld).invert(),t.copy(s.ray).applyMatrix4(e),t.intersectPlane(i,n)){const e=this.scale.x/this.scale.y;let t=.5;e<1.5&&(t=1/e),Math.abs(n.x)<=t&&Math.abs(n.y)<=.75&&(n.applyMatrix4(this.matrixWorld),o.push({distance:s.ray.origin.distanceTo(n),point:n.clone(),object:this}))}}})()}labelVisible(){return!(!this.labelMesh||!this.labelMesh.labelVisible())}getId(){if(!this.data)throw new Error("LabelInputCollider used before configure");return this.data.sid}raycast(e,t){if(!this.labelVisible())return;if(this.material.depthTest)return void this.hitTest(e,t);const i=this.material.depthTest?t:[];this.hitTest(e,i),i.length>0&&(i[0].distance/=1e4,t.push(i[0]))}}},51091:(e,t,i)=>{"use strict";i.r(t),i.d(t,{USER_LABELS:()=>E.R,default:()=>$});var n=i(54122),s=i(7342),o=i(89155),r=i(22729),a=i(48769),l=i(50101),c=i(59120),h=i(2212),d=i(36168),u=i(30041),p=i(74725),m=i(20599),g=i(64786),f=i(93675);class LabelPartMaker{constructor(e){this.makeLine=(e="white")=>{const t=c.default.makeLineMaterial(new h.Color(e).getHex(),!0,{linewidth:6}),i=new p.c(new h.Vector3,new h.Vector3,t,{});return i.setRenderOrder(m.z.labels),i.setRenderLayer(this.layer),i.opacity(0),i},this.makeLabel=()=>{const e=new g.b6(Object.assign({},this.textStyle));return e.scaleType=d.N.WORLD,e.setRenderOrder(m.z.labels),e.setRenderLayer(this.layer),e.opacity=0,e},this.makeAnchor=()=>{const e=new h.SphereGeometry(1,16,16),t=new h.MeshBasicMaterial({transparent:!0,opacity:0,color:"white"});t.depthWrite=!1;const i=new f.I(e,t);return i.renderOrder=m.z.labels,i.layers.mask=this.layer.mask,i},this.textStyle=u.u.makeConfig({color:"white",background:!e,backgroundAsCollider:!0,backgroundColliderType:g.Es,backgroundColor:"#222",backgroundOpacity:1,outline:e,outlineWidth:8,backgroundBorderHeight:26,backgroundBorderWidth:20,wordWrapWidth:void 0,disableDepth:!0})}setRenderLayer(e){this.layer=e}}var v=i(71229),y=i(8292),b=i(25799);const w=new b.Z("label-spawner");class LabelSpawner{constructor(e,t){this.map=e,this.maker=t,this.container=new h.Object3D,this.pool=[],this.bindings=[],this.iterator=()=>this.meshesMap.values,this.meshesMap=(0,v.q)(),this.container.name="RoomLabels";const i=e.keys;for(const t of i){const i=e.get(t);this.add(i,t)}this.bindings.push(e.onElementChanged({onAdded:(e,t)=>{this.add(e,t),w.debug("LabelMesh: added:",t)},onRemoved:(e,t)=>{w.debug("LabelMesh: removing:",t);const i=this.meshesMap.get(t);i&&this.free(i)}}))}subscribe(e){return this.meshesMap.onElementChanged(e)}get(e){return this.meshesMap.get(e)}free(e){const t=e.getId(),i=this.meshesMap.get(t);return i.free().then((()=>{this.meshesMap.delete(t),this.container.remove(i),this.pool.push(i),w.debug("LabelMesh: removed:",i)}))}add(e,t){const i=this.pool.shift();if(void 0!==i)return i.use(e),this.container.add(i),this.meshesMap.set(t,i),i;{const i=new y.M(this.maker.makeAnchor(),this.maker.makeLabel(),this.maker.makeLine());return i.use(e),this.container.add(i),this.meshesMap.set(t,i),i}}dispose(){for(const e of this.iterator())this.free(e);this.bindings.forEach((e=>e.cancel()))}}var S=i(97620),E=i(81032);class LabelRenderer{constructor(e,t,i,n){this.meshes=e,this.cameraData=t,this.positionHelper=i,this.screenFilter=n}beforeRender(){const{position:e,rotation:t,projection:i}=this.cameraData.pose,{height:n}=this.cameraData,s=this.cameraData.zoom(),o=this.cameraData.aspect();this.screenFilter.update();for(const r of this.meshes()){r.labelVisible()&&!this.screenFilter.visible(r.data.sid)&&r.toggleLabel(!1);const a=this.positionHelper.position(r),l=r.labelVisible()?a.anchor:a.label;r.updatePose(l,a.label,t);const c=(0,S.dS)(64-E.R.LABEL_SIZE,0,64,.02,.1);r.billboard(e,t,i,s,n,o,c)}}render(e){for(const t of this.meshes())t.tickAnimations(e)}deactivate(){}init(){}dispose(){}activate(){}}var T=i(82582),M=i.n(T),_=i(75195);class Label2DFiltering{constructor(e,t,i){this.meshes=e,this.cameraData=t,this.enabled=i,this.tree=new(M()),this.visibleMap={},this._screenPosition=new h.Vector2,this._ndcPosition=new h.Vector3,this._cornerWorldPosition=new h.Vector3,this._cornerScreenPosition=new h.Vector2,this.update=()=>{this.enabled()?(this.visibleMap={},this.updatePositions()):Object.keys(this.visibleMap).length&&(this.visibleMap={})}}visible(e){if(!(e in this.visibleMap))return!1;return e in this.visibleMap}updatePositions(){this.tree.clear(),this.meshes().filter((e=>e.labelVisible())).map((e=>{(0,_.q9)(this.cameraData,e.text.position,this._screenPosition,this._ndcPosition);const{width:t,height:i}=e.text.textGeometry.layout;this._cornerWorldPosition.set(.5*t,-.5*i,0),this._cornerWorldPosition.applyMatrix4(e.text.matrixWorld),(0,_.q9)(this.cameraData,this._cornerWorldPosition,this._cornerScreenPosition);const n=e.isSelected()?-999:this._ndcPosition.z;return this.describeBbox(e.text,this._screenPosition,this._cornerScreenPosition,n)})).sort(((e,t)=>e.depth-t.depth)).forEach((e=>{this.tree.collides(e)||(this.tree.insert(e),this.visibleMap[e.id]=e)}))}describeBbox(e,t,i,n){i.sub(t);const s=i.x,o=i.y;return{id:e.userData.sid,depth:n,minX:t.x-s,minY:t.y-o,maxX:t.x+s,maxY:t.y+o}}}var x=i(12775),A=i(39936),O=i(57155),P=i(62431),C=i(90601),D=i(29675),I=i(47173);class LabelVisibilityRules{constructor(e){this.meshes=e,this.initialized=!1,this.featureEnabled=()=>{if(!this.initialized)return!1;const e=this.appData.phase===D.nh.PLAYING,t=this.settingsData.tryGetProperty(I.Q,!1),i=this.settingsData.tryGetProperty(O.Nj,!1),n=this.appData.application===D.Mx.WORKSHOP,s=this.settingsData.tryGetProperty(P.gx.Labels,!1)||n;return e&&i&&s&&(t||n)},this.visibleByTool=()=>!!this.initialized&&(null===this.toolsData.activeToolName||this.toolsData.activeToolName===C.w1.LABELS||this.toolsData.activeToolName===C.w1.PHOTOS),this.visibleByViewmode=()=>{const e=this.settingsData.tryGetProperty(I.Q,!1),t=this.settingsData.tryGetProperty(P.gx.LabelsDollhouse,!1)||e&&this.toolsData.activeToolName===C.w1.LABELS,i=this.viewmodeData.isDollhouse()&&t&&e;return this.viewmodeData.isFloorplan()&&(this.appData.application===D.Mx.WORKSHOP&&this.visibleByTool()||e&&this.settingsData.tryGetProperty(P.gx.Labels,!1))||i},this.hiddenByTransition=()=>this.viewmodeData.transitionActive()||this.floorsViewData.transitionActive,this.visibleByFloor=e=>{const t=this.settingsData.tryGetProperty(I.Q,!1),i=this.toolsData.activeToolName===C.w1.LABELS;if(t&&!i){const{roomSelectModeActive:e,floorSelectModeActive:t}=this.floorsViewData;if(!e)return!1;if(t)return!1}return this.floorsViewData.currentFloor?this.floorsViewData.isCurrentOrAllFloors(e):this.floorsViewData.topFloorId===e}}async init(e){[this.viewmodeData,this.floorsViewData,this.settingsData,this.toolsData,this.appData]=await Promise.all([e.waitForData(x.O),e.waitForData(r.c),e.waitForData(A.e),e.waitForData(a.t),e.waitForData(D.pu)]),this.initialized=!0}onUpdate(){if(!this.initialized)return;const e=this.featureEnabled(),t=!this.hiddenByTransition(),i=this.visibleByTool(),n=e&&t&&i&&this.visibleByViewmode();this.settingsData.setProperty(O.Mr,n);for(const e of this.meshes()){const t=n&&(this.visibleByFloor(e.data.floorId)||"pending"===e.data.sid)&&e.data.visible;e.toggleLabel(t)}}}var R=i(27829),L=i(91055);class LabelPositionWithinRoom{constructor(e,t){this.floorsViewData=e,this.pose=t,this.shift={minAngle:60,maxAngle:70,minVal:0,maxVal:0},this.vectors={labelPos:new h.Vector3,anchorPos:new h.Vector3,shiftTowardsCamPos:new h.Vector3,lookDir:new h.Vector3,flattenedLookDir:new h.Vector3}}position(e){return this.positionAboveLabelAnchor(e)}onCurrentFloor(e){return this.floorsViewData.transitionActive?void 0!==this.floorsViewData.nearestFloor&&this.floorsViewData.nearestFloor.id===e:this.floorsViewData.getHighestVisibleFloor().id===e}getFloor(e){let t=this.floorsViewData.getHighestVisibleFloor();try{t=this.floorsViewData.floors.getFloor(e)}catch(e){}return t}getFloorHeight(e){return this.getFloor(e).medianSweepHeight()}getFloorBottom(e){return this.getFloor(e).bottom}positionAboveLabelAnchor(e){const t=this.vectors.lookDir.copy(R.f.FORWARD).applyQuaternion(this.pose.rotation),i=this.vectors.flattenedLookDir.copy(t).setY(0),n=t.angleTo(i)*S.MN,s=this.getFloorHeight(e.data.floorId),o=e.data.position.y;if(this.vectors.labelPos.set(e.data.position.x,Math.max(o,s),e.data.position.z),this.onCurrentFloor(e.data.floorId)){const e=(0,S.dS)(n,this.shift.minAngle,this.shift.maxAngle,this.shift.minVal,this.shift.maxVal);(0,L.Pp)(this.pose.projection)?this.vectors.labelPos.setY(this.vectors.labelPos.y+e):(this.vectors.shiftTowardsCamPos.copy(this.pose.position).sub(this.vectors.labelPos).setLength(e).add(this.vectors.labelPos),this.vectors.labelPos.copy(this.vectors.shiftTowardsCamPos))}return e.anchorVisible()?this.vectors.anchorPos.set(e.data.position.x,this.getFloorBottom(e.data.floorId),e.data.position.z):this.vectors.anchorPos.copy(this.vectors.labelPos),{anchor:this.vectors.anchorPos,label:this.vectors.labelPos}}}var N=i(77956),k=i(72942),B=i(47924),F=i(75712),U=i(73706),V=i(75158),H=i(57501),G=i(53999),z=i(76258),j=i(7065);class LabelRendererInput{constructor(e,t,i,n,s,o){this.labelRenderer=e,this.issueCommand=t,this.input=i,this.floorsViewData=n,this.toolsData=s,this.roomNavigationPose=o,this.inputBindings=[],this.appStateBindings=[],this.raycasterRegistrationBindings=[],this.active=!0,this.enabled=!0,this.refresh=()=>{this.shouldBeInteractive!==this.active&&(this.inputBindings.forEach((e=>this.shouldBeInteractive?e.renew():e.cancel())),this.raycasterRegistrationBindings.forEach((e=>this.shouldBeInteractive?e.renew():e.cancel())),this.active=this.shouldBeInteractive)},this.refreshColliders=()=>{for(const e of this.labelRenderer.labelMeshIterator())this.shouldBeInteractive?this.input.registerMesh(e.text.collider,!1):this.input.unregisterMesh(e.text.collider)},this.clearColliders=()=>{for(const e of this.labelRenderer.labelMeshIterator())this.input.unregisterMesh(e.text.collider)},this.inputBindings.push(...this.setupInputBindings()),this.raycasterRegistrationBindings.push(...this.setupRaycasterBindings());const r=this.toolsData.onToolChanged(this.refresh),a=this.floorsViewData.makeFloorChangeSubscription(this.refresh),l=this.floorsViewData.onRoomSelectModeChange(this.refresh);this.appStateBindings.push(r,a,l),this.refresh()}toggleInput(e){this.enabled!==e&&(this.enabled=e,this.appStateBindings.forEach((t=>e?t.renew():t.cancel())),this.refresh())}get shouldBeInteractive(){return this.enabled&&null===this.toolsData.activeToolName&&this.floorsViewData.roomSelectModeActive}setupRaycasterBindings(){return[(0,H.k1)((()=>this.refreshColliders()),(()=>this.clearColliders()),!0,"toggleLabelMeshInput"),this.labelRenderer.subscribe({onAdded:e=>this.input.registerMesh(e.text.collider,!1),onRemoved:e=>this.input.unregisterMesh(e.text.collider)})]}setupInputBindings(){const e=F.s.is((e=>e instanceof g.Es&&e.labelVisible()));let t=null;return[new G.V(this.input.registerMeshHandler(U.z,e,((e,i)=>{const n=this.labelRenderer.getLabelMesh(i.getId());n&&(n.hoverState.active=!0,n.hoverState.on(),t=n,this.issueCommand(new z.u(j.C.FINGER)))})),this.input.registerMeshHandler(U.A,F.s.isType(g.Es),((e,i)=>{t&&this.issueCommand(new z.u(j.C.DEFAULT));const n=this.labelRenderer.getLabelMesh(i.getId());n&&(n.hoverState.active=!1,n.hoverState.off()),t=null})),(0,H.k1)((()=>{}),(()=>{t&&(t.hoverState.active=!1,t.hoverState.off(),this.issueCommand(new z.u(j.C.DEFAULT)),t=null)}),!0,"labelHoverClear")),this.input.registerMeshHandler(V.R,e,((e,t)=>{const i=this.labelRenderer.getLabelMesh(t.getId());if(i){const e=i.data.roomId,t=this.roomNavigationPose.getPoseForRoom(e,i.data.position);t&&this.issueCommand(new k._i(k.BD.INSIDE,B.n.Interpolate,t))}}))]}}var W=i(30963),Z=i(18687),q=i(71208);const K=new b.Z("room-with-a-view");class RoomNavigationPose{constructor(e,t){this.sweepData=e,this.roomData=t}getPoseForRoom(e,t){const i=this.bestViewForRoom(e,t);if(i){return{rotation:i.rotation,sweepID:i.sweepID,viewmode:q.Ey.Panorama}}return null}bestViewForRoom(e,t){const i=this.sweepData.filter((t=>t.roomId===e));if(0===i.length)return K.debug("no sweeps in selected room",{roomId:e,scansInRoom:i}),null;let n=1;const s=this.roomData.get(e),o=new h.Vector3(s.size.x,s.size.y,s.size.z).length();t&&o>10&&(n=.2);const r=i.sort(((i,s)=>{let o=0,r=0;t&&(o=i.position.distanceTo(t),r=s.position.distanceTo(t));const a=i.neighbours.map((e=>this.sweepData.getSweep(e))).filter((t=>t.roomId===e)).length,l=s.neighbours.map((e=>this.sweepData.getSweep(e))).filter((t=>t.roomId===e)).length;return 1*n*(l-a)-3*(r-o)})),a=r[0];if(!a)return K.debug("no start sweep",{roomId:e,scansInRoom:i,connectedness:r}),null;const l=a.neighbours.map((e=>this.sweepData.getSweep(e))).sort(((t,i)=>{let n=a.position.distanceTo(t.position),s=a.position.distanceTo(i.position);return t.roomId===e&&(n*=1e3),i.roomId===e&&(s*=1e3),s-n})).map((e=>({sweep:e,dist:a.position.distanceTo(e.position),rm:e.roomId}))),c=l[0];K.warn({roomId:e,roomSize:o,scoring:r,byDistance:l,scansInRoom:i});const d=new h.Quaternion;if(1===i.length&&void 0!==c){const e=(new h.Matrix4).setPosition(a.position);e.lookAt(c.sweep.position,a.position,R.f.UP),d.setFromRotationMatrix(e)}else{const e=(new h.Matrix4).setPosition(a.position);e.lookAt(a.position,c.sweep.position,R.f.UP),d.setFromRotationMatrix(e)}return{sweepID:a.id,rotation:d}}}var Y=i(57723);class LabelRendererModule extends n.Y{constructor(){super(...arguments),this.name="user-labels",this.labelMeshIterator=()=>this.spawner.iterator(),this.checkForRTL=(()=>{const e=/[\u0591-\u07FF]/;let t;return(i,n)=>{if(!n.tryGetProperty(I.Q,!1))return;const s=i=>{n.tryGetProperty(I.Q,!1)&&e.test(i.text)&&(this.broadcast(new Y.V),n.setProperty(I.Q,!1),t&&t.cancel())};i.getCollection().entries().forEach((e=>s(e[1]))),n.tryGetProperty(I.Q,!1)&&(t=i.getCollection().onElementChanged({onAdded:s,onUpdated:s}),this.bindings.push(t))}})()}async init(e,t){const[i,n,c,h,d,u,p,m,g]=await Promise.all([t.market.waitForData(s.D),t.market.waitForData(o.M_),t.market.waitForData(r.c),t.market.waitForData(a.t),t.market.waitForData(N.Z),t.market.waitForData(Z.Z),t.getModule(l.default),t.getModule(W.default),t.market.waitForData(A.e)]),f=p.getScene();this.broadcast=t.broadcast,this.checkForRTL(i,g);const v=new LabelPartMaker(g.tryGetProperty(I.Q,!1));v.setRenderLayer(t.claimRenderLayer("labels")),this.spawner=new LabelSpawner(i.getCollection(),v),f.add(this.spawner.container),this.visibilityRules=new LabelVisibilityRules(this.labelMeshIterator),this.visibilityRules.init(t.market);const y=new Label2DFiltering(this.labelMeshIterator,n,(()=>this.visibilityRules.featureEnabled()&&this.visibilityRules.visibleByTool())),b=new LabelPositionWithinRoom(c,n.pose),w=new LabelRenderer(this.labelMeshIterator,n,b,y);t.addComponent(this,w);const S=new RoomNavigationPose(d,u);this.labelNavInput=new LabelRendererInput(this,t.commandBinder.issueCommand,m,c,h,S),this.toggleInput(!0)}getLabelMesh(e){return e&&this.spawner.get(e)||null}addLabelMesh(e,t){return this.spawner.add(e,t)}freeLabelMesh(e){e&&this.spawner.free(e)}toggleInput(e){this.labelNavInput.toggleInput(e)}subscribe(e){return this.spawner.subscribe(e)}onUpdate(){this.visibilityRules&&this.visibilityRules.onUpdate()}}const $=LabelRendererModule},57723:(e,t,i)=>{"use strict";i.d(t,{V:()=>RTLDisabledRoomnavMessage});var n=i(93528);class RTLDisabledRoomnavMessage extends n.v{}},81032:(e,t,i)=>{"use strict";i.d(t,{R:()=>s});var n=i(21265);const s={LABEL_SIZE:0,FADE_DURATION:200,ANCHOR_2D_COLLAPSE_RADIUS:20,ANCHOR_MAX_RADIUS:.09,ANCHOR_MIN_RADIUS:.04,ANCHOR_OPACITY:1,LINE_OPACITY:.4,ANCHOR_OPACITY_COLLAPSE:0,LABEL_OPACITY_COLLAPSE:0,SCREEN_FILTER_WIDTH_FACTOR:0,SHOW_ANCHOR:1===(0,n.hu)("anchor",0),DEBUG:-1!==(0,n.hu)("debug","").indexOf("labels")}},74725:(e,t,i)=>{"use strict";i.d(t,{c:()=>LineSegment});var n=i(2212),s=i(88493);class Line extends n.Mesh{constructor(e,t){super(),this.type="Line",this.part=s.B.line,this.computeLineDistances=(()=>{const e=new n.Vector3,t=new n.Vector3;return()=>{const i=this.geometry,s=i.attributes.instanceStart,o=i.attributes.instanceEnd,r=new Float32Array(2*s.data.count);for(let i=0,n=0,a=s.data.count;i<a;i++,n+=2)e.fromBufferAttribute(s,i),t.fromBufferAttribute(o,i),r[n]=0===n?0:r[n-1],r[n+1]=r[n]+e.distanceTo(t);return this.instanceDistanceBuffer?(this.instanceDistanceBuffer.set(r,0),this.instanceDistanceBuffer.needsUpdate=!0):(this.instanceDistanceBuffer=new n.InstancedInterleavedBuffer(r,2,1),i.setAttribute("instanceDistanceStart",new n.InterleavedBufferAttribute(this.instanceDistanceBuffer,1,0,!1)),i.setAttribute("instanceDistanceEnd",new n.InterleavedBufferAttribute(this.instanceDistanceBuffer,1,1,!1))),this}})(),this.geometry=e,this.material=t}copy(e){throw Error("not implemented")}}class LineSegmentsGeometry extends n.InstancedBufferGeometry{constructor(){super(),this.type="LineSegmentsGeometry";this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new n.Float32BufferAttribute([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new n.Float32BufferAttribute([0,1,.5,1,0,.5,.5,.5,0,0,.5,0,0,1,.5,1],2))}applyMatrix(e){const t=this.attributes.instanceStart,i=this.attributes.instanceEnd;return void 0!==t&&(t.applyMatrix4(e),i.applyMatrix4(e),this.positionBuffer.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}setPositions(e){let t;return e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e)),t&&(this.positionBuffer?(this.positionBuffer.set(t,0),this.positionBuffer.needsUpdate=!0):(this.positionBuffer=new n.InstancedInterleavedBuffer(t,6,1),this.setAttribute("instanceStart",new n.InterleavedBufferAttribute(this.positionBuffer,3,0,!1)),this.setAttribute("instanceEnd",new n.InterleavedBufferAttribute(this.positionBuffer,3,3,!1))),this.computeBoundingBox(),this.computeBoundingSphere()),this}setColors(e){let t;return e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e)),t&&(this.colorBuffer?(this.colorBuffer.set(t,0),this.colorBuffer.needsUpdate=!0):(this.colorBuffer=new n.InstancedInterleavedBuffer(t,6,1),this.setAttribute("instanceColorStart",new n.InterleavedBufferAttribute(this.colorBuffer,3,0,!1)),this.setAttribute("instanceColorEnd",new n.InterleavedBufferAttribute(this.colorBuffer,3,3,!1)))),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new n.WireframeGeometry(e.geometry)),this}fromLineSegements(e){const t=e.geometry;return t instanceof n.Geometry?this.setPositions(t.vertices):t instanceof n.BufferGeometry&&this.setPositions(t.position.array),this}computeBoundingBox(){this.boundingBox||(this.boundingBox=new n.Box3),this.box||(this.box=new n.Box3);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;void 0!==e&&void 0!==t&&(this.boundingBox.setFromBufferAttribute(e),this.box.setFromBufferAttribute(t),this.boundingBox.union(this.box))}computeBoundingSphere(){this.tempVector||(this.tempVector=new n.Vector3),this.boundingSphere||(this.boundingSphere=new n.Sphere),this.boundingBox||this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(void 0!==e&&void 0!==t){const i=this.boundingSphere.center;this.boundingBox.getCenter(i);let n=0;for(let s=0,o=e.count;s<o;s++)this.tempVector.fromBufferAttribute(e,s),n=Math.max(n,i.distanceToSquared(this.tempVector)),this.tempVector.fromBufferAttribute(t,s),n=Math.max(n,i.distanceToSquared(this.tempVector));this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error("computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}}class LineGeometry extends LineSegmentsGeometry{constructor(){super(),this.type="LineGeometry",this.isLineGeometry=!0}setPositions(e){const t=e.length-3,i=new Float32Array(2*t);for(let n=0;n<t;n+=3)i[2*n]=e[n],i[2*n+1]=e[n+1],i[2*n+2]=e[n+2],i[2*n+3]=e[n+3],i[2*n+4]=e[n+4],i[2*n+5]=e[n+5];return LineSegmentsGeometry.prototype.setPositions.call(this,i),this}setColors(e){const t=e.length-3,i=new Float32Array(2*t);for(let n=0;n<t;n+=3)i[2*n]=e[n],i[2*n+1]=e[n+1],i[2*n+2]=e[n+2],i[2*n+3]=e[n+3],i[2*n+4]=e[n+4],i[2*n+5]=e[n+5];return LineSegmentsGeometry.prototype.setColors.call(this,i),this}fromLine(e){throw new Error("LineGeometry.fromLine not converted to TS yet")}copy(e){return this}}var o=i(91055),r=i(53628);class LineEndpoint extends n.Mesh{constructor(e,t,i=r.V9.endpointSelected,n=r.V9.endpointDefault){super(e,t),this.selectedSize=i,this.defaultSize=n,this.currentSize=r.V9.endpointDefault,this.currentSize=this.defaultSize,this.scale.set(r.Ey,r.Ey,r.Ey)}dispose(){this.material.dispose(),this.geometry.dispose()}billboardScale(e,t,i){const n=(0,o.mY)(t,e,this.position,i,.5),s=Math.max(Math.min(1/n*this.currentSize,r.g4),r.Ey);this.scale.set(s,s,s)}updateSelected(e){this.currentSize=e?this.selectedSize:this.defaultSize}}var a=i(20599);class LineSegment{constructor(e,t,i,r,l){this.lineMaterial=i,this.options=r,this.endpointMaterial=l,this.startPosition=new n.Vector3,this.endPosition=new n.Vector3,this.endpoints=!1,this.isVisible=!0,this.meshToLinePartMap={},this.opacity=e=>(this.endpointMaterial&&this.endpointMaterial.setOpacity(e),this.lineMesh.material.setOpacity(e),this),this.updatePositions=(e,t)=>(this.startPosition.copy(e),this.endPosition.copy(t),this.options.beforeUpdatePositions&&(e=this.options.beforeUpdatePositions(e),t=this.options.beforeUpdatePositions(t)),this.lineMesh.geometry.setPositions([e.x,e.y,e.z,t.x,t.y,t.z]),this.endpoints&&(this.endMesh.position.copy(t),this.startMesh.position.copy(e),this.lastBillboardOptions&&this.updateBillboard(this.lastBillboardOptions)),this.lineMesh.material.dashed&&this.lineMesh.computeLineDistances(),this),this.updateBillboard=e=>{if(this.endpoints&&(e.rotation&&(this.endMesh.quaternion.copy(e.rotation),this.startMesh.quaternion.copy(e.rotation)),e.position&&e.projection&&!(0,o.s1)(e.projection))){const t=this.lineMesh.material.uniforms.resolution.y;this.endMesh.billboardScale(e.position,e.projection,t),this.startMesh.billboardScale(e.position,e.projection,t)}return this.lastBillboardOptions=e,this},this.updateSelected=e=>(this.lineMesh.material.updateSelected(e),this.endpoints&&(this.endMesh.material.updateHovered(e),this.endMesh.updateSelected(e),this.startMesh.updateSelected(e)),this),this.setRenderLayer=e=>{this.children.forEach((t=>t.layers.mask=e.mask))},this.setRenderOrder=e=>{this.children.forEach((t=>t.renderOrder=e))},this.updateResolution=(e,t)=>(this.lineMesh.material.uniforms.resolution.x=e,this.lineMesh.material.uniforms.resolution.y=t,this),this.hide=()=>{this.options.onHide&&this.options.onHide(),this.isVisible=!1},this.show=()=>{this.options.onShow&&this.options.onShow(),this.isVisible=!0},this.toggle=e=>(e?this.show():this.hide(),this),this.dispose=()=>{this.options.onHide&&this.options.onHide(),this.lineMesh.geometry.dispose(),this.lineMesh.material.dispose(),this.endMesh&&this.endMesh.dispose(),this.startMesh&&this.startMesh.dispose(),this.meshToLinePartMap={}},this.overrideLineMaterial=e=>{this.lineMesh.material=e},this.restoreLineMaterial=()=>{this.lineMesh.material=this.lineMaterial},this.startPosition.copy(e),this.endPosition.copy(t),this.lineMesh=new Line(new LineGeometry,i),this.lineMesh.matrixAutoUpdate=!1,this.lineMesh.part=s.B.line,this.lineMesh.renderOrder=a.z.lines,this.meshToLinePartMap[s.B.line]=this.lineMesh,l&&(this.endpoints=!0,this.endMesh=new LineEndpoint(new n.PlaneBufferGeometry(1,1),l),this.endMesh.part=s.B.end,this.endMesh.renderOrder=a.z.endpoints,this.meshToLinePartMap[s.B.end]=this.endMesh,this.startMesh=new LineEndpoint(new n.PlaneBufferGeometry(1,1),l),this.startMesh.part=s.B.start,this.startMesh.renderOrder=a.z.endpoints,this.meshToLinePartMap[s.B.start]=this.startMesh),this.updatePositions(this.startPosition,this.endPosition),this.updateSelected(!1)}get currentOpacity(){return this.lineMesh.material.getOpacity()}getMesh(e){return this.meshToLinePartMap[e]}get children(){return Object.keys(this.meshToLinePartMap).map((e=>this.meshToLinePartMap[e]))}get visible(){return this.isVisible}}},88493:(e,t,i)=>{"use strict";var n;i.d(t,{B:()=>n}),function(e){e.line="line",e.start="start",e.end="end"}(n||(n={}))},59120:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>Lines});var n,s=i(54122),o=i(2212),r=i(74725),a=i(60778),l=i(91975),c=i(40886),h=i(71370),d=i(88296);!function(e){e[e.LINE_DEFAULT=0]="LINE_DEFAULT",e[e.LINE_HOVER=1]="LINE_HOVER",e[e.END_DEFAULT=2]="END_DEFAULT",e[e.END_HOVER=3]="END_HOVER"}(n||(n={}));class LineTextures{constructor(){const e=(0,a.p)(l),t=(0,a.p)(c),i=(0,a.p)(h),s=(0,a.p)(d);this.textures={[n.LINE_DEFAULT]:i,[n.LINE_HOVER]:s,[n.END_DEFAULT]:e,[n.END_HOVER]:t},i.minFilter=o.LinearFilter,s.minFilter=o.LinearFilter,e.minFilter=o.LinearFilter,t.minFilter=o.LinearFilter}get(e){return this.textures[e]}dispose(){for(const e in this.textures){const t=Number(e);this.get(t).dispose()}}}var u=i(30092);class LineEndpointMaterial extends o.RawShaderMaterial{constructor(e,t,i){const n=o.UniformsUtils.clone(u.T.endpoint.uniforms);super({fragmentShader:u.T.endpoint.fragmentShader,vertexShader:u.T.endpoint.vertexShader,uniforms:n,name:"LineEndpointMaterial",transparent:!0,depthWrite:!1,depthTest:!0}),this.color=e,this.defaultTex=t,this.hoverTex=i,this.uniforms.bg.value=t,this.uniforms.color.value.copy(this.color)}clone(){return new LineEndpointMaterial(this.color,this.defaultTex,this.hoverTex).copy(this)}setOpacity(e){this.uniforms&&e!==this.uniforms.opacity.value&&(this.uniforms.opacity.value=e)}getOpacity(){return this.uniforms.opacity.value}updateHovered(e){const t=e?this.hoverTex:this.defaultTex;this.uniforms.bg.value!==t&&(this.uniforms.bg.value=t)}}var p=i(7167),m=i(89155),g=i(50101),f=i(60303),v=i(99169),y=i(53628);class Lines extends s.Y{constructor(){super(...arguments),this.name="lines",this.makeLineMaterial=(e,t,i={},n,s)=>Lines.makeLineMaterial(e,t,i,n,s),this.makeEndpointMaterial=(e,t,i)=>Lines.makeEndpointMaterial(e,t,i),this.onCanvasChange=e=>{for(const t of this.segments)t.updateResolution(e.width,e.height)}}static get textures(){return Lines._textures||(Lines._textures=new LineTextures),Lines._textures}async init(e,t){Lines._textures||(Lines._textures=new LineTextures);const i=await t.getModule(g.default);this.scene=i.getScene(),this.canvas=await t.market.waitForData(v.W),this.cameraData=await t.market.waitForData(m.M_),this.bindings.push(this.canvas.onChanged(this.onCanvasChange)),this.cameraPosition=new o.Vector3,this.segments=[]}onUpdate(){this.cameraPosition.copy(this.cameraData.pose.position)}dispose(e){super.dispose(e),this.segments.forEach((e=>e.dispose()))}makeLine(e,t,i,n,s=(()=>!1)){const o=s()?y.iV.OFFSET_TOWARDS_CAMERA:0,a=s()?e=>this.cameraPosition.clone().sub(e).setLength(o).add(e):e=>e,l=new r.c(e,t,i,{beforeUpdatePositions:a,onShow:()=>l.children.forEach((e=>this.scene.addChild(f.a.Root,e))),onHide:()=>l.children.forEach((e=>this.scene.removeChild(f.a.Root,e)))},n);return l.updateResolution(this.canvas.width,this.canvas.height),l.opacity(1),l.show(),l.updatePositions(e,t),this.segments.push(l),l}}Lines.makeLineMaterial=(e,t,i={},s,r)=>{const a=r||Lines.textures.get(n.LINE_HOVER),l=s||Lines.textures.get(n.LINE_DEFAULT),c=new o.Vector2(window.innerWidth,window.innerHeight);return t?new p.Y(Object.assign({color:new o.Color(e),resolution:c},i),a,l):new p.Y(Object.assign({color:new o.Color(e)},i))},Lines.makeEndpointMaterial=(e,t,i)=>{const s=i||Lines.textures.get(n.END_HOVER),r=t||Lines.textures.get(n.END_DEFAULT);return new LineEndpointMaterial(new o.Color(e),r,s)}},7167:(e,t,i)=>{"use strict";i.d(t,{Y:()=>LineMaterial});var n=i(2212),s=i(30092),o=i(53628);class LineMaterial extends n.ShaderMaterial{constructor(e,t,i,r=o.V9.lineSelected){super(),this.parameters=e,this.hoverTexture=t,this.defaultTexture=i,this.selectedWidth=r,this.type="LineMaterial",this.isLineMaterial=!0,this.defaultWidth=o.V9.lineDefault,this.setValues({uniforms:n.UniformsUtils.clone(s.T.line.uniforms),vertexShader:s.T.line.vertexShader,fragmentShader:s.T.line.fragmentShader,transparent:!0,depthWrite:!1,depthTest:!0,opacity:1}),this.setValues(e),i&&(this.mask=i),this.defaultWidth=e&&e.linewidth?e.linewidth:o.V9.lineDefault}updateSelected(e){const t=e?this.hoverTexture:this.defaultTexture;t&&this.mask!==t&&(this.mask=t,e?this.setLinewidth(this.selectedWidth):this.setLinewidth(this.defaultWidth))}setLinewidth(e){this.uniforms.linewidth||(this.uniforms=n.UniformsUtils.clone(s.T.line.uniforms)),this.getLinewidth()!==e&&(this.uniforms.linewidth.value=e)}getLinewidth(){return this.uniforms.linewidth.value}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}getOpacity(){return this.uniforms.opacity.value}setOpacity(e){this.uniforms||(this.uniforms=n.UniformsUtils.clone(s.T.line.uniforms)),this.getOpacity()!==e&&(this.uniforms.opacity.value=e)}get dashScale(){return this.uniforms.dashScale.value}set dashScale(e){this.uniforms.dashScale.value=e}set dashed(e){e?this.defines.USE_DASH="":delete this.defines.USE_DASH,this.needsUpdate=!0}get dashed(){return"USE_DASH"in this.defines}get dashSize(){return this.uniforms.dashSize.value}set dashSize(e){this.uniforms.dashSize.value=e}get gapSize(){return this.uniforms.gapSize.value}set gapSize(e){this.uniforms.gapSize.value=e}get resolution(){return this.uniforms.resolution.value}set resolution(e){this.uniforms.resolution.value=e}set mask(e){this.uniforms.mask.value!==e&&(e?this.defines.USE_MASK="":delete this.defines.USE_MASK,this.uniforms.mask.value=e,this.needsUpdate=!0)}get mask(){return this.uniforms.mask.value}copy(e){return n.ShaderMaterial.prototype.copy.call(this,e),this.parameters=e.parameters,this.color.copy(e.color),this.defaultWidth=e.defaultWidth,this.setLinewidth(e.getLinewidth()),this.resolution.copy(e.resolution),this.defaultTexture=e.defaultTexture,this.hoverTexture=e.hoverTexture,this.mask=e.mask,this.setOpacity(e.getOpacity()),this.dashed=e.dashed,this.dashScale=e.dashScale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}},30092:(e,t,i)=>{"use strict";i.d(t,{T:()=>a});var n=i(2212),s=i(13441),o=i(81047),r=i(48101);const a={endpoint:{uniforms:{opacity:{type:"f",value:1},color:{type:"c",value:new n.Color},bg:{type:"t",value:null}},vertexShader:(0,r.m)(o,i(82334)),fragmentShader:(0,r.m)(s,i(7281))},line:{uniforms:n.UniformsUtils.merge([n.UniformsLib.common,n.UniformsLib.fog,{linewidth:{value:4},resolution:{value:new n.Vector2(window.innerWidth,window.innerHeight)},dashScale:{value:1},dashSize:{value:.025},gapSize:{value:.05},mask:{value:null}}]),vertexShader:i(9391),fragmentShader:i(29966)}}},53628:(e,t,i)=>{"use strict";i.d(t,{iV:()=>n,V9:()=>s,Ey:()=>o,g4:()=>r});const n={FADE_DURATION:300,LABEL_HIDDEN_OPACITY:.15,DEPTH_WRITE_THRESHOD:.15,ALIGN_LABELS:!1,LABEL_SIZING:.14,LABEL_NDC_SCALEFACTOR:.5,LABEL_ASPECT_SCALEFACTOR:.035,OFFSET_TOWARDS_CAMERA:.25,HIDE_LABELS:!1},s={dottedLineDefault:2,lineDefault:6,lineSelected:6,endpointDefault:2.5,endpointSelected:3.75},o=.01,r=5},55656:(e,t,i)=>{"use strict";i.d(t,{a:()=>n,B:()=>s});const n="en-US",s={en:n,es:"es-MX",fr:"fr-FR",de:"de-DE",ru:"ru-RU",ja:"ja-JP",zh:"zh-CN",ko:"ko-KR",nl:"nl-NL",it:"it-IT",pt:"pt-BR",cn:"zh-CN",jp:"ja-JP"}},29359:(e,t,i)=>{"use strict";var n;i.d(t,{Z:()=>s}),function(e){e.LOADING="LOADING",e.PRESENTED_BY_CAPS="PRESENTED_BY_CAPS",e.EXPLORE_3D_SPACE="EXPLORE_3D_SPACE",e.POWERED_BY="POWERED_BY",e.SC_LOCKOUT_MESSAGE="SC_LOCKOUT_MESSAGE",e.SC_LOCKOUT_TITLE="SC_LOCKOUT_TITLE",e.SC_PASSWORD_TITLE="SC_PASSWORD_TITLE",e.SC_PASSWORD_INVALID="SC_PASSWORD_INVALID",e.SC_PASSWORD_PLACEHOLDER="SC_PASSWORD_PLACEHOLDER",e.SC_PASSWORD_SUBMIT="SC_PASSWORD_SUBMIT",e.VIEW_INSIDE="VIEW_INSIDE",e.VIEW_INSIDE_MESH="VIEW_INSIDE_MESH",e.VIEW_DOLLHOUSE="VIEW_DOLLHOUSE",e.VIEW_FLOORPLAN="VIEW_FLOORPLAN",e.VIEW_FULLSCREEN="VIEW_FULLSCREEN",e.EXIT_FULLSCREEN="EXIT_FULLSCREEN",e.OPEN_HIGHLIGHTS="OPEN_HIGHLIGHTS",e.CLOSE_HIGHLIGHTS="CLOSE_HIGHLIGHTS",e.PAUSE="PAUSE",e.SOCIAL_SHARING="SOCIAL_SHARING",e.VIEW_IN_VR="VIEW_IN_VR",e.FLOOR_NAME="FLOOR_NAME",e.FLOOR_ALL="FLOOR_ALL",e.PRESENTED_BY="PRESENTED_BY",e.MORE="MORE",e.LESS="LESS",e.LEARN_MORE="LEARN_MORE",e.TERMS="TERMS",e.HELP="HELP",e.TERMS_FAIL="TERMS_FAIL",e.HELP_NAVIGATION_TAB="HELP_NAVIGATION_TAB",e.HELP_MORE_HELP_TAB="HELP_MORE_HELP_TAB",e.HELP_DESKTOP_360_2A="HELP_DESKTOP_360_2A",e.HELP_DESKTOP_360_2B="HELP_DESKTOP_360_2B",e.HELP_DESKTOP_DOLLHOUSE_1A="HELP_DESKTOP_DOLLHOUSE_1A",e.HELP_DESKTOP_DOLLHOUSE_1B="HELP_DESKTOP_DOLLHOUSE_1B",e.HELP_DESKTOP_DOLLHOUSE_2A="HELP_DESKTOP_DOLLHOUSE_2A",e.HELP_DESKTOP_DOLLHOUSE_3A="HELP_DESKTOP_DOLLHOUSE_3A",e.HELP_DESKTOP_FLOORPLAN_1A="HELP_DESKTOP_FLOORPLAN_1A",e.HELP_DESKTOP_FLOORPLAN_2A="HELP_DESKTOP_FLOORPLAN_2A",e.HELP_DESKTOP_FLOORPLAN_2B="HELP_DESKTOP_FLOORPLAN_2B",e.HELP_DESKTOP_FLOORPLAN_3A="HELP_DESKTOP_FLOORPLAN_3A",e.HELP_DESKTOP_FLOORPLAN_3B="HELP_DESKTOP_FLOORPLAN_3B",e.HELP_DESKTOP_MORE_360_B="HELP_DESKTOP_MORE_360_B",e.HELP_DESKTOP_MORE_DOLLHOUSE_B="HELP_DESKTOP_MORE_DOLLHOUSE_B",e.HELP_DESKTOP_MORE_FLOORS_B="HELP_DESKTOP_MORE_FLOORS_B",e.HELP_DESKTOP_MORE_FULLSCREEN_B="HELP_DESKTOP_MORE_FULLSCREEN_B",e.HELP_DESKTOP_MORE_HLR_B="HELP_DESKTOP_MORE_HLR_B",e.HELP_DESKTOP_MORE_INSIDE_B="HELP_DESKTOP_MORE_INSIDE_B",e.HELP_DESKTOP_MORE_MATTERTAG_B="HELP_DESKTOP_MORE_MATTERTAG_B",e.HELP_DESKTOP_MORE_TOUR_B="HELP_DESKTOP_MORE_TOUR_B",e.HELP_DESKTOP_MORE_VR_B="HELP_DESKTOP_MORE_VR_B",e.HELP_DESKTOP_MORE_ZOOM_B="HELP_DESKTOP_MORE_ZOOM_B",e.HELP_DESKTOP_PANORAMA_1A="HELP_DESKTOP_PANORAMA_1A",e.HELP_DESKTOP_PANORAMA_1B="HELP_DESKTOP_PANORAMA_1B",e.HELP_DESKTOP_PANORAMA_2A="HELP_DESKTOP_PANORAMA_2A",e.HELP_DESKTOP_PANORAMA_2B="HELP_DESKTOP_PANORAMA_2B",e.HELP_DESKTOP_PANORAMA_3A="HELP_DESKTOP_PANORAMA_3A",e.HELP_DESKTOP_PANORAMA_3B="HELP_DESKTOP_PANORAMA_3B",e.HELP_MOBILE_3="HELP_MOBILE_3",e.HELP_MOBILE_360_2="HELP_MOBILE_360_2",e.HELP_MOBILE_DOLLHOUSE_1="HELP_MOBILE_DOLLHOUSE_1",e.HELP_MOBILE_DOLLHOUSE_2="HELP_MOBILE_DOLLHOUSE_2",e.HELP_MOBILE_FLOORPLAN_1="HELP_MOBILE_FLOORPLAN_1",e.HELP_MOBILE_FLOORPLAN_2="HELP_MOBILE_FLOORPLAN_2",e.HELP_MOBILE_MORE_360_B="HELP_MOBILE_MORE_360_B",e.HELP_MOBILE_MORE_DOLLHOUSE_B="HELP_MOBILE_MORE_DOLLHOUSE_B",e.HELP_MOBILE_MORE_INSIDE_B="HELP_MOBILE_MORE_INSIDE_B",e.HELP_MOBILE_MORE_MATTERTAG_B="HELP_MOBILE_MORE_MATTERTAG_B",e.HELP_MOBILE_MORE_VR_B="HELP_MOBILE_MORE_VR_B",e.HELP_MOBILE_PANORAMA_1="HELP_MOBILE_PANORAMA_1",e.HELP_MOBILE_PANORAMA_2="HELP_MOBILE_PANORAMA_2",e.HELP_MORE_360_A="HELP_MORE_360_A",e.HELP_MORE_DOLLHOUSE_A="HELP_MORE_DOLLHOUSE_A",e.HELP_MORE_FLOORS_A="HELP_MORE_FLOORS_A",e.HELP_MORE_FLOORPLAN_A="HELP_MORE_FLOORPLAN_A",e.HELP_MORE_FULLSCREEN_A="HELP_MORE_FULLSCREEN_A",e.HELP_MORE_HLR_A="HELP_MORE_HLR_A",e.HELP_MORE_INSIDE_A="HELP_MORE_INSIDE_A",e.HELP_MORE_MATTERTAG_A="HELP_MORE_MATTERTAG_A",e.HELP_MORE_TOUR_A="HELP_MORE_TOUR_A",e.HELP_MORE_VR_A="HELP_MORE_VR_A",e.HELP_MORE_ZOOM_A="HELP_MORE_ZOOM_A",e.VR_APP_INSTRUCT="VR_APP_INSTRUCT",e.VR_APP_RECCOMMENDED="VR_APP_RECCOMMENDED",e.VR_ENTER="VR_ENTER",e.VR_LEARN_MORE_CAPS="VR_LEARN_MORE_CAPS",e.VR_QUEST="VR_QUEST",e.VR_RECOMMENDED="VR_RECOMMENDED",e.VR_SUPPORTS="VR_SUPPORTS",e.VR_VIEW_SPACE="VR_VIEW_SPACE",e.ERROR_WEBGL_UNSUPPORTED_PROBLEM="ERROR_WEBGL_UNSUPPORTED_PROBLEM",e.ERROR_BROWSER_SOLUTION="ERROR_BROWSER_SOLUTION",e.ERROR_BROWSER_EXPLANATION="ERROR_BROWSER_EXPLANATION",e.ERROR_LOADING_FAILED_PROBLEM="ERROR_LOADING_FAILED_PROBLEM",e.ERROR_LOADING_FAILED_ACTIONS_1="ERROR_LOADING_FAILED_ACTIONS_1",e.ERROR_LOADING_FAILED_ACTIONS_2="ERROR_LOADING_FAILED_ACTIONS_2",e.ERROR_GENERIC_PROBLEM="ERROR_GENERIC_PROBLEM",e.ERROR_GENERIC_SOLUTION="ERROR_GENERIC_SOLUTION",e.ERROR_GENERIC_ACTIONS_1="ERROR_GENERIC_ACTIONS_1",e.ERROR_GENERIC_ACTIONS_2="ERROR_GENERIC_ACTIONS_2",e.ERROR_GENERIC_ACTIONS_3="ERROR_GENERIC_ACTIONS_3",e.ERROR_GENERIC_ACTIONS_4="ERROR_GENERIC_ACTIONS_4",e.DESKTOP_SHORT_CTA="DESKTOP_SHORT_CTA",e.MOBILE_SHORT_CTA="MOBILE_SHORT_CTA",e.ROTATE="ROTATE",e.MOVE="MOVE",e.PLAY="PLAY",e.INSIDE="INSIDE",e.ZOOM="ZOOM",e.MEASUREMENT="MEASUREMENT",e.MEASUREMENT_START_ADDING="MEASUREMENT_START_ADDING",e.MEASUREMENT_CONTINUOUS_LINES="MEASUREMENT_CONTINUOUS_LINES",e.MEASUREMENT_SNAPPING="MEASUREMENT_SNAPPING",e.MEASUREMENT_UNITS="MEASUREMENT_UNITS",e.MEASUREMENT_IMPERIAL="MEASUREMENT_IMPERIAL",e.MEASUREMENT_METRIC="MEASUREMENT_METRIC",e.MEASUREMENT_SETTINGS="MEASUREMENT_SETTINGS",e.MEASUREMENT_HELP_CLICK_ANYWHERE="MEASUREMENT_HELP_CLICK_ANYWHERE",e.MEASUREMENT_HELP_ESCAPE="MEASUREMENT_HELP_ESCAPE",e.MEASUREMENT_HELP_PRESS_START="MEASUREMENT_HELP_PRESS_START",e.MEASUREMENT_HELP_DRAG_EDIT="MEASUREMENT_HELP_DRAG_EDIT",e.MEASUREMENT_HELP_PRESS_END="MEASUREMENT_HELP_PRESS_END",e.MEASUREMENT_MODE="MEASUREMENT_MODE",e.MEASUREMENT_HELP_MODAL_SUB_HEADER="MEASUREMENT_HELP_MODAL_SUB_HEADER",e.MEASUREMENT_HELP_MODAL_BODY_1="MEASUREMENT_HELP_MODAL_BODY_1",e.MEASUREMENT_HELP_MODAL_BODY_2="MEASUREMENT_HELP_MODAL_BODY_2",e.MEASUREMENT_NUDGE_TITLE="MEASUREMENT_NUDGE_TITLE",e.MEASUREMENT_NUDGE_MESSAGE="MEASUREMENT_NUDGE_MESSAGE",e.ON="ON",e.OFF="OFF",e.CLOSE="CLOSE",e.COPY="COPY",e.COPY_URL="COPY_URL",e.SHARE="SHARE",e.SHARE_COPIED="SHARE_COPIED",e.SHARE_CURRENT_LOCATION="SHARE_CURRENT_LOCATION",e.SHARE_DEFAULT_LOCATION="SHARE_DEFAULT_LOCATION",e.SHARE_ERROR_SWEEP_DISABLED="SHARE_ERROR_SWEEP_DISABLED",e.SHARE_EXPLORE="SHARE_EXPLORE",e.SHARE_LINK_TO_LOCATION="SHARE_LINK_TO_LOCATION",e.SHARE_AT="SHARE_AT",e.SHARE_WITH="SHARE_WITH",e.SHARE_3D="SHARE_3D",e.SHARE_MODAL_TITLE="SHARE_MODAL_TITLE",e.SHARED_TITLE="SHARED_TITLE",e.SHARED_MESSAGE="SHARED_MESSAGE",e.SHARED_MESSAGE_HASHTAG="SHARED_MESSAGE_HASHTAG"}(n||(n={})),function(e){let t,i,n,s,o;!function(e){e.CLOSE_BUTTON_TOOLTIP_MESSAGE="REUSABLES.CLOSE_BUTTON_TOOLTIP_MESSAGE",e.HELP_BUTTON_TOOLTIP_MESSAGE="REUSABLES.HELP_BUTTON_TOOLTIP_MESSAGE"}(t=e.REUSABLES||(e.REUSABLES={})),function(e){let t,i;!function(e){e.DEFAULT_NAME="SHOWCASE.FLOORS.DEFAULT_NAME"}(t=e.FLOORS||(e.FLOORS={})),function(e){e.TYPE="SHOWCASE.TAGS.TYPE",e.NUM_TYPE="SHOWCASE.TAGS.NUM_TYPE",e.HIDE_LIST_ITEM_TOOLTIP_MESSAGE="SHOWCASE.TAGS.HIDE_LIST_ITEM_TOOLTIP_MESSAGE",e.SHOW_LIST_ITEM_TOOLTIP_MESSAGE="SHOWCASE.TAGS.SHOW_LIST_ITEM_TOOLTIP_MESSAGE",e.EDIT_LIST_ITEM_OPTION_CTA="SHOWCASE.TAGS.EDIT_LIST_ITEM_OPTION_CTA",e.DELETE_LIST_ITEM_OPTION_CTA="SHOWCASE.TAGS.DELETE_LIST_ITEM_OPTION_CTA",e.MULTI_FLOOR_EMPTY_MESSAGE="SHOWCASE.TAGS.MULTI_FLOOR_EMPTY_MESSAGE",e.SINGLE_FLOOR_EMPTY_MESSAGE="SHOWCASE.TAGS.SINGLE_FLOOR_EMPTY_MESSAGE",e.EMPTY_LIST_MESSAGE="SHOWCASE.TAGS.EMPTY_LIST_MESSAGE"}(i=e.TAGS||(e.TAGS={}))}(i=e.SHOWCASE||(e.SHOWCASE={})),function(e){e.BLUR="TOOLS.BLUR",e.BLUR_HELP_MESSAGE="TOOLS.BLUR_HELP_MESSAGE",e.HLR="TOOLS.HLR",e.HLR_HELP_MESSAGE="TOOLS.HLR_HELP_MESSAGE",e.LABELS="TOOLS.LABELS",e.LABELS_HELP_MESSAGE="TOOLS.LABELS_HELP_MESSAGE",e.MATTERTAGS="TOOLS.MATTERTAGS",e.MATTERTAGS_HELP_MESSAGE="TOOLS.MATTERTAGS_HELP_MESSAGE",e.MEASUREMENTS="TOOLS.MEASUREMENTS",e.MEASUREMENTS_HELP_MESSAGE="TOOLS.MEASUREMENTS_HELP_MESSAGE",e.NOTES="TOOLS.NOTES",e.PHOTOS="TOOLS.PHOTOS",e.PHOTOS_HELP_MESSAGE="TOOLS.PHOTOS_HELP_MESSAGE",e.SCANS_3D="TOOLS.SCANS_3D",e.SCANS_3D_HELP_MESSAGE="TOOLS.SCANS_3D_HELP_MESSAGE",e.SETTINGS_PANEL="TOOLS.SETTINGS_PANEL",e.START_LOCATION="TOOLS.START_LOCATION",e.START_LOCATION_HELP_MESSAGE="TOOLS.START_LOCATION_HELP_MESSAGE",e.TAGS="TOOLS.TAGS",e.VIEW_360="TOOLS.VIEW_360",e.VIEW_360_HELP_MESSAGE="TOOLS.VIEW_360_HELP_MESSAGE",e.VR_PATH="TOOLS.VR_PATH",e.VR_PATH_HELP_MESSAGE="TOOLS.VR_PATH_HELP_MESSAGE"}(n=e.TOOLS||(e.TOOLS={})),function(e){e.INVITE_USER="USERS.INVITE_USER",e.INVITE_VIEWER_BUTTON="USERS.INVITE_VIEWER_BUTTON",e.INVITE_EDITOR_BUTTON="USERS.INVITE_EDITOR_BUTTON",e.INVITE_USERS="USERS.INVITE_USERS",e.INVITE_VIEWERS_BUTTON="USERS.INVITE_VIEWERS_BUTTON",e.INVITE_EDITORS_BUTTON="USERS.INVITE_EDITORS_BUTTON",e.INVITE_VISIBLE_MSG="USERS.INVITE_VISIBLE_MSG"}(s=e.USERS||(e.USERS={})),function(e){let t,i,n,s,o,r,a,l,c,h,d,u,p,m,g,f;!function(e){e.DELETE_SELECTED_CTA="WORKSHOP.ACCORDION.DELETE_SELECTED_CTA",e.SELECT_ALL_CTA="WORKSHOP.ACCORDION.SELECT_ALL_CTA",e.ENTER_SELECT_MODE_CTA="WORKSHOP.ACCORDION.ENTER_SELECT_MODE_CTA",e.EXIT_SELECT_MODE_CTA="WORKSHOP.ACCORDION.EXIT_SELECT_MODE_CTA",e.DELETE_FOOTER_CTA="WORKSHOP.ACCORDION.DELETE_FOOTER_CTA",e.TOGGLE_VISIBILITY_FOOTER_CTA="WORKSHOP.ACCORDION.TOGGLE_VISIBILITY_FOOTER_CTA",e.BATCH_DELETE_MODAL_TITLE="WORKSHOP.ACCORDION.BATCH_DELETE_MODAL_TITLE",e.BATCH_DELETE_MODAL_MESSAGE="WORKSHOP.ACCORDION.BATCH_DELETE_MODAL_MESSAGE",e.RENAME_HEADER_OPTION_CTA="WORKSHOP.ACCORDION.RENAME_HEADER_OPTION_CTA"}(t=e.ACCORDION||(e.ACCORDION={})),function(e){e.CHANGES_SAVED_MESSAGE="WORKSHOP.APP_SWITCH.CHANGES_SAVED_MESSAGE",e.EDIT_CTA="WORKSHOP.APP_SWITCH.EDIT_CTA",e.UNSUPPORTED_TOOLTIP_MESSAGE="WORKSHOP.APP_SWITCH.UNSUPPORTED_TOOLTIP_MESSAGE",e.UNSUPPORTED_TOOLTIP_TITLE="WORKSHOP.APP_SWITCH.UNSUPPORTED_TOOLTIP_TITLE",e.PUBLIC_PUBLISH_TOOLTIP_TITLE="WORKSHOP.APP_SWITCH.PUBLIC_PUBLISH_TOOLTIP_TITLE",e.PRIVATE_PUBLISH_TOOLTIP_TITLE="WORKSHOP.APP_SWITCH.PRIVATE_PUBLISH_TOOLTIP_TITLE",e.PUBLIC_PUBLISH_TOOLTIP_MESSAGE="WORKSHOP.APP_SWITCH.PUBLIC_PUBLISH_TOOLTIP_MESSAGE",e.PRIVATE_PUBLISH_TOOLTIP_MESSAGE="WORKSHOP.APP_SWITCH.PRIVATE_PUBLISH_TOOLTIP_MESSAGE",e.PUBLISH_CHANGES_CTA="WORKSHOP.APP_SWITCH.PUBLISH_CHANGES_CTA",e.PUBLISHING_CHANGES_CTA="WORKSHOP.APP_SWITCH.PUBLISHING_CHANGES_CTA",e.REVERT_CHANGES_MODAL_TITLE="WORKSHOP.APP_SWITCH.REVERT_CHANGES_MODAL_TITLE",e.REVERT_CHANGES_MODAL_HEADER="WORKSHOP.APP_SWITCH.REVERT_CHANGES_MODAL_HEADER",e.REVERT_CHANGES_MODAL_EXPLANATION="WORKSHOP.APP_SWITCH.REVERT_CHANGES_MODAL_EXPLANATION",e.REVERT_CHANGES_MODAL_WARNING="WORKSHOP.APP_SWITCH.REVERT_CHANGES_MODAL_WARNING",e.REVERT_CHANGES_MODAL_LEARN_MORE_CTA="WORKSHOP.APP_SWITCH.REVERT_CHANGES_MODAL_LEARN_MORE_CTA",e.REVERT_CHANGES_MODAL_CANCEL_CTA="WORKSHOP.APP_SWITCH.REVERT_CHANGES_MODAL_CANCEL_CTA",e.REVERT_CHANGES_MODAL_REVERT_CTA="WORKSHOP.APP_SWITCH.REVERT_CHANGES_MODAL_REVERT_CTA",e.FLOORS_CHECKBOX_LABEL="WORKSHOP.APP_SWITCH.FLOORS_CHECKBOX_LABEL",e.MEASUREMENTS_CHECKBOX_LABEL="WORKSHOP.APP_SWITCH.MEASUREMENTS_CHECKBOX_LABEL",e.MATTERTAGS_CHECKBOX_LABEL="WORKSHOP.APP_SWITCH.MATTERTAGS_CHECKBOX_LABEL",e.LABELS_CHECKBOX_LABEL="WORKSHOP.APP_SWITCH.LABELS_CHECKBOX_LABEL",e.HIGHLIGHTS_CHECKBOX_LABEL="WORKSHOP.APP_SWITCH.HIGHLIGHTS_CHECKBOX_LABEL",e.START_LOCATION_CHECKBOX_LABEL="WORKSHOP.APP_SWITCH.START_LOCATION_CHECKBOX_LABEL",e.SETTINGS_CHECKBOX_LABEL="WORKSHOP.APP_SWITCH.SETTINGS_CHECKBOX_LABEL",e.SWEEPS_CHECKBOX_LABEL="WORKSHOP.APP_SWITCH.SWEEPS_CHECKBOX_LABEL",e.BLURS_CHECKBOX_LABEL="WORKSHOP.APP_SWITCH.BLURS_CHECKBOX_LABEL",e.NO_UNPUBLISHED_CHANGES_CHECKBOX_LABEL="WORKSHOP.APP_SWITCH.NO_UNPUBLISHED_CHANGES_CHECKBOX_LABEL",e.EXIT_EDIT_MODE_CTA="WORKSHOP.APP_SWITCH.EXIT_EDIT_MODE_CTA",e.EXIT_EDIT_MODE_TOOLTIP_MESSAGE="WORKSHOP.APP_SWITCH.EXIT_EDIT_MODE_TOOLTIP_MESSAGE",e.DISCARD_CHANGES_TOOLTIP_MESSAGE="WORKSHOP.APP_SWITCH.DISCARD_CHANGES_TOOLTIP_MESSAGE",e.PREVIEW_CHANGES_CTA="WORKSHOP.APP_SWITCH.PREVIEW_CHANGES_CTA",e.TIMESTAMP_UNPUBLISHED_CHANGES="WORKSHOP.APP_SWITCH.TIMESTAMP_UNPUBLISHED_CHANGES",e.TIMESTAMP_GREATER_THAN_ONE_MONTH="WORKSHOP.APP_SWITCH.TIMESTAMP_GREATER_THAN_ONE_MONTH",e.TIMESTAMP_DAY="WORKSHOP.APP_SWITCH.TIMESTAMP_DAY",e.TIMESTAMP_HOUR="WORKSHOP.APP_SWITCH.TIMESTAMP_HOUR",e.TIMESTAMP_MINUTE="WORKSHOP.APP_SWITCH.TIMESTAMP_MINUTE",e.TIMESTAMP_LESS_THAN_ONE_MINUTE="WORKSHOP.APP_SWITCH.TIMESTAMP_LESS_THAN_ONE_MINUTE",e.TIMESTAMP_LAST_PUBLISHED_MESSAGE="WORKSHOP.APP_SWITCH.TIMESTAMP_LAST_PUBLISHED_MESSAGE",e.UNABLE_TO_SAVE_CHANGES_ERROR_MESSAGE="WORKSHOP.APP_SWITCH.UNABLE_TO_SAVE_CHANGES_ERROR_MESSAGE",e.UNABLE_TO_PUBLISH_CHANGES_ERROR_MESSAGE="WORKSHOP.APP_SWITCH.UNABLE_TO_PUBLISH_CHANGES_ERROR_MESSAGE",e.UNABLE_TO_REVERT_CHANGES_ERROR_MESSAGE="WORKSHOP.APP_SWITCH.UNABLE_TO_REVERT_CHANGES_ERROR_MESSAGE",e.UNAUTHORIZED_ERROR_MESSAGE="WORKSHOP.APP_SWITCH.UNAUTHORIZED_ERROR_MESSAGE"}(i=e.APP_SWITCH||(e.APP_SWITCH={})),function(e){e.TYPE="WORKSHOP.BLURS.TYPE",e.NUM_TYPE="WORKSHOP.BLURS.NUM_TYPE",e.APPLY_BLURS_CTA="WORKSHOP.BLURS.APPLY_BLURS_CTA",e.OVERLAY_MESSAGE="WORKSHOP.BLURS.OVERLAY_MESSAGE",e.CREATE_TOOLTIP_TITLE="WORKSHOP.BLURS.CREATE_TOOLTIP_TITLE",e.CREATE_TOOLTIP_MESSAGE="WORKSHOP.BLURS.CREATE_TOOLTIP_MESSAGE",e.BRUSH_TOOLTIP_TITLE="WORKSHOP.BLURS.BRUSH_TOOLTIP_TITLE",e.BRUSH_TOOLTIP_MESSAGE="WORKSHOP.BLURS.BRUSH_TOOLTIP_MESSAGE",e.DELETE_BLUR_CTA="WORKSHOP.BLURS.DELETE_BLUR_CTA",e.MULTI_FLOOR_EMPTY_MESSAGE="WORKSHOP.BLURS.MULTI_FLOOR_EMPTY_MESSAGE",e.SINGLE_FLOOR_EMPTY_MESSAGE="WORKSHOP.BLURS.SINGLE_FLOOR_EMPTY_MESSAGE",e.OTHER_GROUP_LABEL="WORKSHOP.BLURS.OTHER_GROUP_LABEL",e.DEFAULT_BLUR_NAME="WORKSHOP.BLURS.DEFAULT_BLUR_NAME",e.DEFAULT_ALERT_TITLE="WORKSHOP.BLURS.DEFAULT_ALERT_TITLE",e.DEFAULT_ALERT_CONFIRMATION="WORKSHOP.BLURS.DEFAULT_ALERT_CONFIRMATION",e.ALREADY_PROCESSING_ALERT_MESSAGE="WORKSHOP.BLURS.ALREADY_PROCESSING_ALERT_MESSAGE",e.ALREADY_PROCESSING_ALERT_TITLE="WORKSHOP.BLURS.ALREADY_PROCESSING_ALERT_TITLE",e.BLUR_STATUS_PROCESSING="WORKSHOP.BLURS.BLUR_STATUS_PROCESSING",e.BLUR_STATUS_SUGGESTED="WORKSHOP.BLURS.BLUR_STATUS_SUGGESTED",e.BLUR_STATUS_APPLIED="WORKSHOP.BLURS.BLUR_STATUS_APPLIED",e.BLUR_STATUS_FAILED="WORKSHOP.BLURS.BLUR_STATUS_FAILED",e.HIDE_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.BLURS.HIDE_LIST_ITEM_TOOLTIP_MESSAGE",e.SHOW_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.BLURS.SHOW_LIST_ITEM_TOOLTIP_MESSAGE",e.APPLY_MODAL_TITLE="WORKSHOP.BLURS.APPLY_MODAL_TITLE",e.APPLY_MODAL_MESSAGE="WORKSHOP.BLURS.APPLY_MODAL_MESSAGE",e.APPLY_MODAL_WARNING="WORKSHOP.BLURS.APPLY_MODAL_WARNING",e.APPLY_MODAL_CONFIRM="WORKSHOP.BLURS.APPLY_MODAL_CONFIRM",e.APPLY_MODAL_RETRY="WORKSHOP.BLURS.APPLY_MODAL_RETRY",e.UNABLE_TO_SAVE_CHANGES_ERROR_MESSAGE="WORKSHOP.BLURS.UNABLE_TO_SAVE_CHANGES_ERROR_MESSAGE",e.UNABLE_TO_APPLY_BLURS_ERROR_MESSAGE="WORKSHOP.BLURS.UNABLE_TO_APPLY_BLURS_ERROR_MESSAGE",e.UNAUTHORIZED_ERROR_MESSAGE="WORKSHOP.BLURS.UNAUTHORIZED_ERROR_MESSAGE"}(n=e.BLURS||(e.BLURS={})),function(e){e.HELP_LINK="WORKSHOP.EDIT_BAR.HELP_LINK",e.BETA_TAG="WORKSHOP.EDIT_BAR.BETA_TAG",e.COLLAPSE_LIST_TOOLTIP_MESSAGE="WORKSHOP.EDIT_BAR.COLLAPSE_LIST_TOOLTIP_MESSAGE",e.EXPAND_LIST_TOOLTIP_MESSAGE="WORKSHOP.EDIT_BAR.EXPAND_LIST_TOOLTIP_MESSAGE"}(s=e.EDIT_BAR||(e.EDIT_BAR={})),function(e){e.TYPE="WORKSHOP.HLR.TYPE",e.NUM_TYPE="WORKSHOP.HLR.NUM_TYPE",e.ADD_HIGHLIGHT_CTA="WORKSHOP.HLR.ADD_HIGHLIGHT_CTA",e.ADD_HIGHLIGHT_DISABLED_CTA="WORKSHOP.HLR.ADD_HIGHLIGHT_DISABLED_CTA",e.ADD_FROM_PHOTOS_TOOLTIP_MESSAGE="WORKSHOP.HLR.ADD_FROM_PHOTOS_TOOLTIP_MESSAGE",e.SCAN_NOT_HIDDEN_TOOLTIP_TITLE="WORKSHOP.HLR.SCAN_NOT_HIDDEN_TOOLTIP_TITLE",e.SCAN_GENERIC_HIDDEN_TOOLTIP_TITLE="WORKSHOP.HLR.SCAN_GENERIC_HIDDEN_TOOLTIP_TITLE",e.SCAN_NUMBER_HIDDEN_TOOLTIP_TITLE="WORKSHOP.HLR.SCAN_NUMBER_HIDDEN_TOOLTIP_TITLE",e.ADD_HIGHLIGHT_INSTRUCTIONS="WORKSHOP.HLR.ADD_HIGHLIGHT_INSTRUCTIONS",e.DISMISS_TOOLTIP_CTA="WORKSHOP.HLR.DISMISS_TOOLTIP_CTA",e.TOAST_ERROR_MESSAGE="WORKSHOP.HLR.TOAST_ERROR_MESSAGE",e.TOAST_ERROR_CTA="WORKSHOP.HLR.TOAST_ERROR_CTA",e.CLEAR_HLR_MODAL_TITLE="WORKSHOP.HLR.CLEAR_HLR_MODAL_TITLE",e.CLEAR_HLR_MODAL_MESSAGE="WORKSHOP.HLR.CLEAR_HLR_MODAL_MESSAGE",e.DELETE_HIGHLIGHT_TOOLTIP_MESSAGE="WORKSHOP.HLR.DELETE_HIGHLIGHT_TOOLTIP_MESSAGE",e.REMOVE_HIGHLIGHT_TOOLTIP_MESSAGE="WORKSHOP.HLR.REMOVE_HIGHLIGHT_TOOLTIP_MESSAGE",e.EDIT_HIGHLIGHT_TOOLTIP_MESSAGE="WORKSHOP.HLR.EDIT_HIGHLIGHT_TOOLTIP_MESSAGE",e.TRANSITION_SETTING_SLIDESHOW="WORKSHOP.HLR.TRANSITION_SETTING_SLIDESHOW",e.TRANSITION_SETTING_WALKTHROUGH="WORKSHOP.HLR.TRANSITION_SETTING_WALKTHROUGH",e.EDIT_SETTINGS_TOOLTIP_MESSAGE="WORKSHOP.HLR.EDIT_SETTINGS_TOOLTIP_MESSAGE",e.CLEAR_REEL_CTA="WORKSHOP.HLR.CLEAR_REEL_CTA",e.PAN_DIRECTION_SETTING_AUTO="WORKSHOP.HLR.PAN_DIRECTION_SETTING_AUTO",e.PAN_DIRECTION_SETTING_LABEL="WORKSHOP.HLR.PAN_DIRECTION_SETTING_LABEL",e.PAN_DIRECTION_SETTING_LEFT="WORKSHOP.HLR.PAN_DIRECTION_SETTING_LEFT",e.PAN_DIRECTION_SETTING_RIGHT="WORKSHOP.HLR.PAN_DIRECTION_SETTING_RIGHT",e.ROTATION_ANGLE_SETTING_LABEL="WORKSHOP.HLR.ROTATION_ANGLE_SETTING_LABEL",e.ROTATION_SPEED_SETTING_LABEL="WORKSHOP.HLR.ROTATION_SPEED_SETTING_LABEL",e.DOLLHOUSE_ROTATION_SPEED_SETTING_LABEL="WORKSHOP.HLR.DOLLHOUSE_ROTATION_SPEED_SETTING_LABEL",e.SPEED_SETTING_FAST="WORKSHOP.HLR.SPEED_SETTING_FAST",e.SPEED_SETTING_MEDIUM="WORKSHOP.HLR.SPEED_SETTING_MEDIUM",e.SPEED_SETTING_SLOW="WORKSHOP.HLR.SPEED_SETTING_SLOW",e.SLIDESHOW_SPEED_SETTING_LABEL="WORKSHOP.HLR.SLIDESHOW_SPEED_SETTING_LABEL",e.WALKTHROUGH_SPEED_SETTING_LABEL="WORKSHOP.HLR.WALKTHROUGH_SPEED_SETTING_LABEL",e.ZOOM_SPEED_SETTING_LABEL="WORKSHOP.HLR.ZOOM_SPEED_SETTING_LABEL",e.TRANSITION_SETTING_LABEL="WORKSHOP.HLR.TRANSITION_SETTING_LABEL",e.INDIVIDUAL_TRANSITION_SETTING_LABEL="WORKSHOP.HLR.INDIVIDUAL_TRANSITION_SETTING_LABEL",e.INDIVIDUAL_PAN_DIRECTION_SETTING_LABEL="WORKSHOP.HLR.INDIVIDUAL_PAN_DIRECTION_SETTING_LABEL",e.SETTINGS_MODAL_TITLE="WORKSHOP.HLR.SETTINGS_MODAL_TITLE",e.PANNING_SETTINGS_TAB_TITLE="WORKSHOP.HLR.PANNING_SETTINGS_TAB_TITLE",e.TRANSITION_SETTINGS_TAB_TITLE="WORKSHOP.HLR.TRANSITION_SETTINGS_TAB_TITLE",e.CLOSE_SETTINGS_CTA="WORKSHOP.HLR.CLOSE_SETTINGS_CTA",e.PREVIEW_SETTINGS_CTA="WORKSHOP.HLR.PREVIEW_SETTINGS_CTA",e.RESTORE_DEFAULTS_CTA="WORKSHOP.HLR.RESTORE_DEFAULTS_CTA",e.TRANSITION_IS_360_DISABLED_MESSAGE="WORKSHOP.HLR.TRANSITION_IS_360_DISABLED_MESSAGE",e.TRANSITION_AFTER_360_DISABLED_MESSAGE="WORKSHOP.HLR.TRANSITION_AFTER_360_DISABLED_MESSAGE",e.TRANSITION_SAME_SWEEP_DISABLED_MESSAGE="WORKSHOP.HLR.TRANSITION_SAME_SWEEP_DISABLED_MESSAGE",e.TRANSITION_NO_ROTATION_DISABLED_MESSAGE="WORKSHOP.HLR.TRANSITION_NO_ROTATION_DISABLED_MESSAGE",e.TRANSITION_EDITOR_TITLE="WORKSHOP.HLR.TRANSITION_EDITOR_TITLE",e.HIGHLIGHT_CAPTION_HINT="WORKSHOP.HLR.HIGHLIGHT_CAPTION_HINT",e.HIGHLIGHT_CAPTION_PLACEHOLDER="WORKSHOP.HLR.HIGHLIGHT_CAPTION_PLACEHOLDER",e.APPLY_TO_ALL_CTA="WORKSHOP.HLR.APPLY_TO_ALL_CTA"}(o=e.HLR||(e.HLR={})),function(e){e.TYPE="WORKSHOP.LABELS.TYPE",e.NUM_TYPE="WORKSHOP.LABELS.NUM_TYPE",e.EDIT_TEXT_CANCEL_CTA="WORKSHOP.LABELS.EDIT_TEXT_CANCEL_CTA",e.EDIT_TEXT_DONE_CTA="WORKSHOP.LABELS.EDIT_TEXT_DONE_CTA",e.INPUT_PLACEHOLDER="WORKSHOP.LABELS.INPUT_PLACEHOLDER",e.MOBILE_OVERLAY_MESSAGE="WORKSHOP.LABELS.MOBILE_OVERLAY_MESSAGE",e.ADD_LABEL_TOOLTIP_MESSAGE="WORKSHOP.LABELS.ADD_LABEL_TOOLTIP_MESSAGE",e.RENAME_LIST_ITEM_OPTION_CTA="WORKSHOP.LABELS.RENAME_LIST_ITEM_OPTION_CTA",e.DELETE_LIST_ITEM_OPTION_CTA="WORKSHOP.LABELS.DELETE_LIST_ITEM_OPTION_CTA",e.LIST_ITEM_INPUT_PLACEHOLDER="WORKSHOP.LABELS.LIST_ITEM_INPUT_PLACEHOLDER",e.MULTI_FLOOR_EMPTY_MESSAGE="WORKSHOP.LABELS.MULTI_FLOOR_EMPTY_MESSAGE",e.SINGLE_FLOOR_EMPTY_MESSAGE="WORKSHOP.LABELS.SINGLE_FLOOR_EMPTY_MESSAGE",e.HIDE_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.LABELS.HIDE_LIST_ITEM_TOOLTIP_MESSAGE",e.SHOW_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.LABELS.SHOW_LIST_ITEM_TOOLTIP_MESSAGE",e.EDIT_LABEL="WORKSHOP.LABELS.EDIT_LABEL"}(r=e.LABELS||(e.LABELS={})),function(e){e.KITCHEN="WORKSHOP.LABEL_SUGGESTIONS.KITCHEN",e.PRIMARY_BEDROOM="WORKSHOP.LABEL_SUGGESTIONS.PRIMARY_BEDROOM",e.BEDROOM="WORKSHOP.LABEL_SUGGESTIONS.BEDROOM",e.PRIMARY_BATHROOM="WORKSHOP.LABEL_SUGGESTIONS.PRIMARY_BATHROOM",e.BATHROOM="WORKSHOP.LABEL_SUGGESTIONS.BATHROOM",e.LIVING_ROOM="WORKSHOP.LABEL_SUGGESTIONS.LIVING_ROOM",e.FAMILY_ROOM="WORKSHOP.LABEL_SUGGESTIONS.FAMILY_ROOM",e.DINING_ROOM="WORKSHOP.LABEL_SUGGESTIONS.DINING_ROOM",e.PATIO="WORKSHOP.LABEL_SUGGESTIONS.PATIO",e.BALCONY="WORKSHOP.LABEL_SUGGESTIONS.BALCONY",e.BACKYARD="WORKSHOP.LABEL_SUGGESTIONS.BACKYARD",e.FRONT_YARD="WORKSHOP.LABEL_SUGGESTIONS.FRONT_YARD",e.HALLWAY="WORKSHOP.LABEL_SUGGESTIONS.HALLWAY",e.LAUNDRY="WORKSHOP.LABEL_SUGGESTIONS.LAUNDRY",e.PANTRY="WORKSHOP.LABEL_SUGGESTIONS.PANTRY",e.CLOSET="WORKSHOP.LABEL_SUGGESTIONS.CLOSET",e.GARAGE="WORKSHOP.LABEL_SUGGESTIONS.GARAGE",e.DRIVEWAY="WORKSHOP.LABEL_SUGGESTIONS.DRIVEWAY",e.BASEMENT="WORKSHOP.LABEL_SUGGESTIONS.BASEMENT",e.FACADE="WORKSHOP.LABEL_SUGGESTIONS.FACADE",e.GARDEN="WORKSHOP.LABEL_SUGGESTIONS.GARDEN",e.LOBBY="WORKSHOP.LABEL_SUGGESTIONS.LOBBY",e.OFFICE="WORKSHOP.LABEL_SUGGESTIONS.OFFICE",e.POOL="WORKSHOP.LABEL_SUGGESTIONS.POOL",e.UNFURNISHED="WORKSHOP.LABEL_SUGGESTIONS.UNFURNISHED",e.STAIRWAY="WORKSHOP.LABEL_SUGGESTIONS.STAIRWAY",e.ELEVATOR="WORKSHOP.LABEL_SUGGESTIONS.ELEVATOR",e.ESCALATOR="WORKSHOP.LABEL_SUGGESTIONS.ESCALATOR",e.STUDY="WORKSHOP.LABEL_SUGGESTIONS.STUDY",e.SPA="WORKSHOP.LABEL_SUGGESTIONS.SPA",e.RECEPTION="WORKSHOP.LABEL_SUGGESTIONS.RECEPTION",e.MEETING_ROOM="WORKSHOP.LABEL_SUGGESTIONS.MEETING_ROOM",e.STORAGE="WORKSHOP.LABEL_SUGGESTIONS.STORAGE",e.BREAK_ROOM="WORKSHOP.LABEL_SUGGESTIONS.BREAK_ROOM",e.LUNCH_ROOM="WORKSHOP.LABEL_SUGGESTIONS.LUNCH_ROOM",e.CONFERENCE_ROOM="WORKSHOP.LABEL_SUGGESTIONS.CONFERENCE_ROOM"}(a=e.LABEL_SUGGESTIONS||(e.LABEL_SUGGESTIONS={})),function(e){e.TYPE="WORKSHOP.MATTERTAGS.TYPE",e.NUM_TYPE="WORKSHOP.MATTERTAGS.NUM_TYPE",e.EDIT_BILLBOARD_CANCEL_CTA="WORKSHOP.MATTERTAGS.EDIT_BILLBOARD_CANCEL_CTA",e.EDIT_BILLBOARD_DONE_CTA="WORKSHOP.MATTERTAGS.EDIT_BILLBOARD_DONE_CTA",e.LINK_TOOLTIP_MESSAGE="WORKSHOP.MATTERTAGS.LINK_TOOLTIP_MESSAGE",e.LINK_DISABLED_TOOLTIP_MESSAGE="WORKSHOP.MATTERTAGS.LINK_DISABLED_TOOLTIP_MESSAGE",e.COLOR_TOOLTIP_MESSAGE="WORKSHOP.MATTERTAGS.COLOR_TOOLTIP_MESSAGE",e.STEM_TOOLTIP_MESSAGE="WORKSHOP.MATTERTAGS.STEM_TOOLTIP_MESSAGE",e.MEDIA_TOOLTIP_MESSAGE="WORKSHOP.MATTERTAGS.MEDIA_TOOLTIP_MESSAGE",e.HIDE_TOOLTIP_MESSAGE="WORKSHOP.MATTERTAGS.HIDE_TOOLTIP_MESSAGE",e.SHOW_TOOLTIP_MESSAGE="WORKSHOP.MATTERTAGS.SHOW_TOOLTIP_MESSAGE",e.TITLE_PLACEHOLDER="WORKSHOP.MATTERTAGS.TITLE_PLACEHOLDER",e.DESCRIPTION_PLACEHOLDER="WORKSHOP.MATTERTAGS.DESCRIPTION_PLACEHOLDER",e.STEM_SLIDER_RESET_CTA="WORKSHOP.MATTERTAGS.STEM_SLIDER_RESET_CTA",e.SHOW_STEM_LABEL="WORKSHOP.MATTERTAGS.SHOW_STEM_LABEL",e.MEDIA_LINK_LABEL="WORKSHOP.MATTERTAGS.MEDIA_LINK_LABEL",e.MEDIA_LINK_SUPPORTED_FORMATS_LINK="WORKSHOP.MATTERTAGS.MEDIA_LINK_SUPPORTED_FORMATS_LINK",e.MEDIA_LINK_APPLY_CTA="WORKSHOP.MATTERTAGS.MEDIA_LINK_APPLY_CTA",e.MEDIA_LINK_ERROR_MESSAGE="WORKSHOP.MATTERTAGS.MEDIA_LINK_ERROR_MESSAGE",e.MEDIA_LINK_HELP_LINK="WORKSHOP.MATTERTAGS.MEDIA_LINK_HELP_LINK",e.MEDIA_LINK_LOADING_MESSAGE="WORKSHOP.MATTERTAGS.MEDIA_LINK_LOADING_MESSAGE",e.MEDIA_LINK_INVALID_URL_MESSAGE="WORKSHOP.MATTERTAGS.MEDIA_LINK_INVALID_URL_MESSAGE",e.HIDE_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.MATTERTAGS.HIDE_LIST_ITEM_TOOLTIP_MESSAGE",e.SHOW_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.MATTERTAGS.SHOW_LIST_ITEM_TOOLTIP_MESSAGE",e.DEFAULT_LIST_ITEM_TEXT="WORKSHOP.MATTERTAGS.DEFAULT_LIST_ITEM_TEXT",e.MULTI_FLOOR_EMPTY_MESSAGE="WORKSHOP.MATTERTAGS.MULTI_FLOOR_EMPTY_MESSAGE",e.SINGLE_FLOOR_EMPTY_MESSAGE="WORKSHOP.MATTERTAGS.SINGLE_FLOOR_EMPTY_MESSAGE",e.EDIT_LIST_ITEM_OPTION_CTA="WORKSHOP.MATTERTAGS.EDIT_LIST_ITEM_OPTION_CTA",e.DELETE_LIST_ITEM_OPTION_CTA="WORKSHOP.MATTERTAGS.DELETE_LIST_ITEM_OPTION_CTA",e.ADD_MATTERTAG_TOOLTIP_MESSAGE="WORKSHOP.MATTERTAGS.ADD_MATTERTAG_TOOLTIP_MESSAGE",e.MOBILE_OVERLAY_MESSAGE="WORKSHOP.MATTERTAGS.MOBILE_OVERLAY_MESSAGE",e.DELETE_MATTERTAGS_MODAL_TITLE="WORKSHOP.MATTERTAGS.DELETE_MATTERTAGS_MODAL_TITLE",e.DELETE_MATTERTAGS_MODAL_MESSAGE="WORKSHOP.MATTERTAGS.DELETE_MATTERTAGS_MODAL_MESSAGE",e.DISCARD_MATTERTAG_MODAL_TITLE="WORKSHOP.MATTERTAGS.DISCARD_MATTERTAG_MODAL_TITLE",e.DISCARD_MATTERTAG_MODAL_MESSAGE="WORKSHOP.MATTERTAGS.DISCARD_MATTERTAG_MODAL_MESSAGE"}(l=e.MATTERTAGS||(e.MATTERTAGS={})),function(e){e.TYPE="WORKSHOP.MEASUREMENTS.TYPE",e.NUM_TYPE="WORKSHOP.MEASUREMENTS.NUM_TYPE",e.HIDE_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.MEASUREMENTS.HIDE_LIST_ITEM_TOOLTIP_MESSAGE",e.SHOW_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.MEASUREMENTS.SHOW_LIST_ITEM_TOOLTIP_MESSAGE",e.OTHER_GROUP_LABEL="WORKSHOP.MEASUREMENTS.OTHER_GROUP_LABEL",e.RENAME_LIST_ITEM_OPTION_CTA="WORKSHOP.MEASUREMENTS.RENAME_LIST_ITEM_OPTION_CTA",e.DELETE_LIST_ITEM_OPTION_CTA="WORKSHOP.MEASUREMENTS.DELETE_LIST_ITEM_OPTION_CTA",e.LIST_ITEM_INPUT_PLACEHOLDER="WORKSHOP.MEASUREMENTS.LIST_ITEM_INPUT_PLACEHOLDER",e.MULTI_FLOOR_EMPTY_MESSAGE="WORKSHOP.MEASUREMENTS.MULTI_FLOOR_EMPTY_MESSAGE",e.SINGLE_FLOOR_EMPTY_MESSAGE="WORKSHOP.MEASUREMENTS.SINGLE_FLOOR_EMPTY_MESSAGE"}(c=e.MEASUREMENTS||(e.MEASUREMENTS={})),function(e){e.ERROR_TITLE="WORKSHOP.MODAL.ERROR_TITLE",e.SAVING_ERROR_TITLE="WORKSHOP.MODAL.SAVING_ERROR_TITLE",e.SAVING_ERROR_MESSAGE="WORKSHOP.MODAL.SAVING_ERROR_MESSAGE",e.NO="WORKSHOP.MODAL.NO",e.YES="WORKSHOP.MODAL.YES",e.CANCEL="WORKSHOP.MODAL.CANCEL",e.OK="WORKSHOP.MODAL.OK",e.DISCARD="WORKSHOP.MODAL.DISCARD",e.SAVE="WORKSHOP.MODAL.SAVE"}(h=e.MODAL||(e.MODAL={})),function(e){e.TYPE="WORKSHOP.PHOTOS.TYPE",e.NUM_TYPE="WORKSHOP.PHOTOS.NUM_TYPE",e.ADD_PHOTOS_CTA="WORKSHOP.PHOTOS.ADD_PHOTOS_CTA",e.ADDING_PHOTOS_CTA="WORKSHOP.PHOTOS.ADDING_PHOTOS_CTA",e.MODAL_TITLE="WORKSHOP.PHOTOS.MODAL_TITLE",e.NUM_SELECTED="WORKSHOP.PHOTOS.NUM_SELECTED",e.SELECT_ALL_CTA="WORKSHOP.PHOTOS.SELECT_ALL_CTA",e.UNSELECT_ALL_CTA="WORKSHOP.PHOTOS.UNSELECT_ALL_CTA",e.SAVING_TOAST_MESSAGE="WORKSHOP.PHOTOS.SAVING_TOAST_MESSAGE",e.SAVED_TOAST_MESSAGE="WORKSHOP.PHOTOS.SAVED_TOAST_MESSAGE",e.SAVED_TOAST_CTA="WORKSHOP.PHOTOS.SAVED_TOAST_CTA",e.ERROR_MODAL_TITLE="WORKSHOP.PHOTOS.ERROR_MODAL_TITLE",e.ERROR_MODAL_MESSAGE="WORKSHOP.PHOTOS.ERROR_MODAL_MESSAGE",e.CAMERA_PITCH_RESET_MESSAGE="WORKSHOP.PHOTOS.CAMERA_PITCH_RESET_MESSAGE",e.ZOOM_RESET_MESSAGE="WORKSHOP.PHOTOS.ZOOM_RESET_MESSAGE",e.ZOOM_IN_MESSAGE="WORKSHOP.PHOTOS.ZOOM_IN_MESSAGE",e.ZOOM_OUT_MESSAGE="WORKSHOP.PHOTOS.ZOOM_OUT_MESSAGE",e.CANNOT_SAVE_TOOLTIP_MESSAGE="WORKSHOP.PHOTOS.CANNOT_SAVE_TOOLTIP_MESSAGE",e.CANNOT_SAVE_SCAN_NUMBER_TOOLTIP_MESSAGE="WORKSHOP.PHOTOS.CANNOT_SAVE_SCAN_NUMBER_TOOLTIP_MESSAGE",e.CANNOT_SAVE_TOOLTIP_TITLE="WORKSHOP.PHOTOS.CANNOT_SAVE_TOOLTIP_TITLE",e.CANNOT_SAVE_TOOLTIP_CTA="WORKSHOP.PHOTOS.CANNOT_SAVE_TOOLTIP_CTA",e.CAN_TAKE_2D_PHOTO_TOOLTIP_MESSAGE="WORKSHOP.PHOTOS.CAN_TAKE_2D_PHOTO_TOOLTIP_MESSAGE",e.CAN_TAKE_360_PHOTO_TOOLTIP_MESSAGE="WORKSHOP.PHOTOS.CAN_TAKE_360_PHOTO_TOOLTIP_MESSAGE",e.CANNOT_TAKE_360_PHOTO_TOOLTIP_MESSAGE="WORKSHOP.PHOTOS.CANNOT_TAKE_360_PHOTO_TOOLTIP_MESSAGE",e.PANO_CTA="WORKSHOP.PHOTOS.PANO_CTA",e.SETTINGS_TOOLTIP_MESSAGE="WORKSHOP.PHOTOS.SETTINGS_TOOLTIP_MESSAGE",e.ASSETS_SETTING_LABEL="WORKSHOP.PHOTOS.ASSETS_SETTING_LABEL",e.SHOW_GRID_SETTING_LABEL="WORKSHOP.PHOTOS.SHOW_GRID_SETTING_LABEL",e.SNAPSHOT_ERROR_TOAST_MESSAGE="WORKSHOP.PHOTOS.SNAPSHOT_ERROR_TOAST_MESSAGE",e.SNAPSHOT_ERROR_TOAST_CTA="WORKSHOP.PHOTOS.SNAPSHOT_ERROR_TOAST_CTA"}(d=e.PHOTOS||(e.PHOTOS={})),function(e){e.TYPE="WORKSHOP.SCANS.TYPE",e.NUM_TYPE="WORKSHOP.SCANS.NUM_TYPE",e.BATCH_SHOW_CTA="WORKSHOP.SCANS.BATCH_SHOW_CTA",e.BATCH_HIDE_CTA="WORKSHOP.SCANS.BATCH_HIDE_CTA",e.HIDE_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.SCANS.HIDE_LIST_ITEM_TOOLTIP_MESSAGE",e.SHOW_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.SCANS.SHOW_LIST_ITEM_TOOLTIP_MESSAGE",e.LIST_ITEM_TEXT="WORKSHOP.SCANS.LIST_ITEM_TEXT",e.FLOOR_EMPTY_MESSAGE="WORKSHOP.SCANS.FLOOR_EMPTY_MESSAGE",e.NO_HIDE_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.SCANS.NO_HIDE_LIST_ITEM_TOOLTIP_MESSAGE",e.HLR_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.SCANS.HLR_LIST_ITEM_TOOLTIP_MESSAGE",e.START_LOCATION_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.SCANS.START_LOCATION_LIST_ITEM_TOOLTIP_MESSAGE",e.OVERLAY_HIDE_CTA="WORKSHOP.SCANS.OVERLAY_HIDE_CTA",e.OVERLAY_SHOW_CTA="WORKSHOP.SCANS.OVERLAY_SHOW_CTA",e.OVERLAY_PANORAMA_INFO="WORKSHOP.SCANS.OVERLAY_PANORAMA_INFO",e.OVERLAY_INFO="WORKSHOP.SCANS.OVERLAY_INFO",e.START_LOCATION_TOOLTIP_TITLE="WORKSHOP.SCANS.START_LOCATION_TOOLTIP_TITLE",e.START_LOCATION_TOOLTIP_MESSAGE="WORKSHOP.SCANS.START_LOCATION_TOOLTIP_MESSAGE",e.START_LOCATION_TOOLTIP_CTA="WORKSHOP.SCANS.START_LOCATION_TOOLTIP_CTA",e.REMOVE_HLR_MODAL_TITLE="WORKSHOP.SCANS.REMOVE_HLR_MODAL_TITLE",e.REMOVE_HLR_MODAL_MESSAGE="WORKSHOP.SCANS.REMOVE_HLR_MODAL_MESSAGE",e.REMOVE_HLR_MODAL_BATCH_MESSAGE="WORKSHOP.SCANS.REMOVE_HLR_MODAL_BATCH_MESSAGE",e.REMOVE_HLR_MODAL_WARNING="WORKSHOP.SCANS.REMOVE_HLR_MODAL_WARNING",e.REMOVE_SCANS_FROM_HLR_MODAL_TITLE="WORKSHOP.SCANS.REMOVE_SCANS_FROM_HLR_MODAL_TITLE",e.REMOVE_SCAN_FROM_HLR_MODAL_MESSAGE="WORKSHOP.SCANS.REMOVE_SCAN_FROM_HLR_MODAL_MESSAGE",e.REMOVE_BATCH_FROM_HLR_MODAL_SCANS_MESSAGE="WORKSHOP.SCANS.REMOVE_BATCH_FROM_HLR_MODAL_SCANS_MESSAGE",e.REMOVE_BATCH_FROM_HLR_MODAL_HIGHLIGHTS_MESSAGE="WORKSHOP.SCANS.REMOVE_BATCH_FROM_HLR_MODAL_HIGHLIGHTS_MESSAGE"}(u=e.SCANS||(e.SCANS={})),function(e){e.NAV_OPTION_PRESENTATION="WORKSHOP.SETTINGS.NAV_OPTION_PRESENTATION",e.NAV_OPTION_TOUR_HLR="WORKSHOP.SETTINGS.NAV_OPTION_TOUR_HLR",e.NAV_OPTION_UNITS="WORKSHOP.SETTINGS.NAV_OPTION_UNITS",e.NAV_OPTION_ADVANCED="WORKSHOP.SETTINGS.NAV_OPTION_ADVANCED",e.SHOW_LABELS_IN_DOLLHOUSE_OPTION="WORKSHOP.SETTINGS.SHOW_LABELS_IN_DOLLHOUSE_OPTION",e.HIDE_LABELS_IN_DOLLHOUSE_OPTION="WORKSHOP.SETTINGS.HIDE_LABELS_IN_DOLLHOUSE_OPTION",e.SHOW_SAVED_MEASUREMENTS_OPTION="WORKSHOP.SETTINGS.SHOW_SAVED_MEASUREMENTS_OPTION",e.HIDE_SAVED_MEASUREMENTS_OPTION="WORKSHOP.SETTINGS.HIDE_SAVED_MEASUREMENTS_OPTION",e.UNITS_HEADER="WORKSHOP.SETTINGS.UNITS_HEADER",e.UNITS_SUBHEADER="WORKSHOP.SETTINGS.UNITS_SUBHEADER",e.UNITS_IMPERIAL_CTA="WORKSHOP.SETTINGS.UNITS_IMPERIAL_CTA",e.UNITS_METRIC_CTA="WORKSHOP.SETTINGS.UNITS_METRIC_CTA",e.TOUR_AND_HLR_HEADER="WORKSHOP.SETTINGS.TOUR_AND_HLR_HEADER",e.TOUR_OPTION_LABEL="WORKSHOP.SETTINGS.TOUR_OPTION_LABEL",e.TOUR_OPTION_MESSAGE="WORKSHOP.SETTINGS.TOUR_OPTION_MESSAGE",e.HLR_OPTION_LABEL="WORKSHOP.SETTINGS.HLR_OPTION_LABEL",e.HLR_OPTION_MESSAGE="WORKSHOP.SETTINGS.HLR_OPTION_MESSAGE",e.ADVANCED_HEADER="WORKSHOP.SETTINGS.ADVANCED_HEADER",e.ADVANCED_DOLLHOUSE_LABEL="WORKSHOP.SETTINGS.ADVANCED_DOLLHOUSE_LABEL",e.ADVANCED_DOLLHOUSE_MESSAGE="WORKSHOP.SETTINGS.ADVANCED_DOLLHOUSE_MESSAGE",e.ADVANCED_FLOORPLAN_LABEL="WORKSHOP.SETTINGS.ADVANCED_FLOORPLAN_LABEL",e.ADVANCED_FLOORPLAN_MESSAGE="WORKSHOP.SETTINGS.ADVANCED_FLOORPLAN_MESSAGE",e.ADVANCED_ROOM_LABELS_LABEL="WORKSHOP.SETTINGS.ADVANCED_ROOM_LABELS_LABEL",e.ADVANCED_ROOM_LABELS_MESSAGE="WORKSHOP.SETTINGS.ADVANCED_ROOM_LABELS_MESSAGE",e.ADVANCED_FLOOR_SELECTION_LABEL="WORKSHOP.SETTINGS.ADVANCED_FLOOR_SELECTION_LABEL",e.ADVANCED_FLOOR_SELECTION_MESSAGE="WORKSHOP.SETTINGS.ADVANCED_FLOOR_SELECTION_MESSAGE",e.ADVANCED_MEASUREMENT_MODE_LABEL="WORKSHOP.SETTINGS.ADVANCED_MEASUREMENT_MODE_LABEL",e.ADVANCED_MEASUREMENT_MODE_MESSAGE="WORKSHOP.SETTINGS.ADVANCED_MEASUREMENT_MODE_MESSAGE",e.ADVANCED_ROOM_LABELS_MENU_LABEL="WORKSHOP.SETTINGS.ADVANCED_ROOM_LABELS_MENU_LABEL",e.ADVANCED_MEASUREMENT_MODE_MENU_LABEL="WORKSHOP.SETTINGS.ADVANCED_MEASUREMENT_MODE_MENU_LABEL",e.PRESENTATION_HEADER="WORKSHOP.SETTINGS.PRESENTATION_HEADER",e.PRESENTATION_INFORMATION_HEADER="WORKSHOP.SETTINGS.PRESENTATION_INFORMATION_HEADER",e.PRESENTATION_INFORMATION_EVERYTHING_LABEL="WORKSHOP.SETTINGS.PRESENTATION_INFORMATION_EVERYTHING_LABEL",e.PRESENTATION_INFORMATION_EVERYTHING_MESSAGE="WORKSHOP.SETTINGS.PRESENTATION_INFORMATION_EVERYTHING_MESSAGE",e.PRESENTATION_INFORMATION_COMPACT_LABEL="WORKSHOP.SETTINGS.PRESENTATION_INFORMATION_COMPACT_LABEL",e.PRESENTATION_INFORMATION_COMPACT_MESSAGE="WORKSHOP.SETTINGS.PRESENTATION_INFORMATION_COMPACT_MESSAGE",e.PRESENTATION_INFORMATION_NONE_LABEL="WORKSHOP.SETTINGS.PRESENTATION_INFORMATION_NONE_LABEL",e.PRESENTATION_BACKGROUND_HEADER="WORKSHOP.SETTINGS.PRESENTATION_BACKGROUND_HEADER",e.PRESENTATION_BACKGROUND_SUBHEADER="WORKSHOP.SETTINGS.PRESENTATION_BACKGROUND_SUBHEADER",e.PRESENTATION_BACKGROUND_BLACK_LABEL="WORKSHOP.SETTINGS.PRESENTATION_BACKGROUND_BLACK_LABEL",e.PRESENTATION_BACKGROUND_GREY_LABEL="WORKSHOP.SETTINGS.PRESENTATION_BACKGROUND_GREY_LABEL",e.PRESENTATION_BACKGROUND_WHITE_LABEL="WORKSHOP.SETTINGS.PRESENTATION_BACKGROUND_WHITE_LABEL"}(p=e.SETTINGS||(e.SETTINGS={})),function(e){e.ENABLED_TOOLTIP_TITLE="WORKSHOP.START_LOCATION.ENABLED_TOOLTIP_TITLE",e.DISABLED_TOOLTIP_TITLE="WORKSHOP.START_LOCATION.DISABLED_TOOLTIP_TITLE",e.HIDDEN_SWEEP_MESSAGE="WORKSHOP.START_LOCATION.HIDDEN_SWEEP_MESSAGE",e.UNPLACED_360_MESSAGE="WORKSHOP.START_LOCATION.UNPLACED_360_MESSAGE",e.ENABLED_MESSAGE="WORKSHOP.START_LOCATION.ENABLED_MESSAGE",e.TOOLTIP_CTA="WORKSHOP.START_LOCATION.TOOLTIP_CTA",e.SET_NEW_LOCATION_CTA="WORKSHOP.START_LOCATION.SET_NEW_LOCATION_CTA",e.SETTING_NEW_LOCATION_CTA="WORKSHOP.START_LOCATION.SETTING_NEW_LOCATION_CTA",e.THUMBNAIL_PREVIEW_CTA="WORKSHOP.START_LOCATION.THUMBNAIL_PREVIEW_CTA"}(m=e.START_LOCATION||(e.START_LOCATION={})),function(e){e.START_LOCATION_REMOVAL_MESSAGE="WORKSHOP.VIEWS_360.START_LOCATION_REMOVAL_MESSAGE",e.START_LOCATION_MARKER_MESSAGE="WORKSHOP.VIEWS_360.START_LOCATION_MARKER_MESSAGE",e.DEFAULT_NAME="WORKSHOP.VIEWS_360.DEFAULT_NAME",e.OVERLAY_MESSAGE="WORKSHOP.VIEWS_360.OVERLAY_MESSAGE",e.OVERLAY_INFO_MISSING_SWEEP="WORKSHOP.VIEWS_360.OVERLAY_INFO_MISSING_SWEEP",e.OVERLAY_INFO_CURRENT_SWEEP="WORKSHOP.VIEWS_360.OVERLAY_INFO_CURRENT_SWEEP",e.OVERLAY_INFO_SELECTED_SWEEP="WORKSHOP.VIEWS_360.OVERLAY_INFO_SELECTED_SWEEP",e.ROTATE_TOOLTIP_TITLE="WORKSHOP.VIEWS_360.ROTATE_TOOLTIP_TITLE",e.ROTATE_TOOLTIP_MESSAGE="WORKSHOP.VIEWS_360.ROTATE_TOOLTIP_MESSAGE",e.ROTATE_TOOLTIP_CTA="WORKSHOP.VIEWS_360.ROTATE_TOOLTIP_CTA",e.UNPLACED_CARD_MESSAGE="WORKSHOP.VIEWS_360.UNPLACED_CARD_MESSAGE",e.RENAME_ITEM_OPTION_CTA="WORKSHOP.VIEWS_360.RENAME_ITEM_OPTION_CTA",e.REMOVE_ITEM_OPTION_CTA="WORKSHOP.VIEWS_360.REMOVE_ITEM_OPTION_CTA",e.NO_VIEWS_MESSAGE="WORKSHOP.VIEWS_360.NO_VIEWS_MESSAGE"}(g=e.VIEWS_360||(e.VIEWS_360={})),function(e){e.TOAST_MESSAGE="WORKSHOP.VR.TOAST_MESSAGE",e.TOAST_CTA="WORKSHOP.VR.TOAST_CTA"}(f=e.VR||(e.VR={}))}(o=e.WORKSHOP||(e.WORKSHOP={}))}(n||(n={}));const s=n},79994:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>Locale});var n=i(54122),s=i(39936),o=i(25799),r=i(54078),a=i(21265),l=i(55656);async function c(e,t){const i="./locale/strings-"+e+".json",n=await t.get(i);return JSON.parse(n)}const h=new o.Z("Locale");class Locale extends n.Y{constructor(){super(...arguments),this.name="locale",this._languageCode=l.a}async init(e,t){const i=(await t.market.waitForData(s.e)).tryGetProperty("lang",(0,a.ht)());l.B.hasOwnProperty(i)&&(this._languageCode=l.B[i]);const n=this._languageCode.substr(0,2);this.polyglot=new r({locale:n,interpolation:{prefix:"%{",suffix:"}"},onMissingKey:e=>(h.warn("Missing phrase key:"+e),Locale.missingPrefix+e)});const o=await async function(e,t){const i=await c(e,t);if(e===l.a)return i;const n=await c(l.a,t);return Object.assign(Object.assign({},n),i)}(this._languageCode,e.queue);this.polyglot.extend(o)}t(e,t){return this.polyglot.t(e,t)}get languageCode(){return this._languageCode}}Locale.missingPrefix="FIX-"},54708:(e,t,i)=>{"use strict";i.d(t,{$:()=>DescriptionParser});var n=i(45296),s=i(87694),o=i(28615);class DescriptionParser{constructor(e){this.modelSID=e.model,this.capabilites={links:{enable:e.supportLinks,keepLabels:e.keepLinkLabels}}}parse(e){const t=[];if(!e)return[];return e.split("[").map((function(e,t){return 0===t?e:"["+e})).forEach((e=>{const i=this.findLink(e);i?-1===i.url.indexOf("javascript:")&&(this.addLinkChunk(t,i),this.addTextChunk(t,e.slice(i.markdown.length))):this.addTextChunk(t,e)})),t}findLink(e){const t=e.match(/\[([^\]]*)\]\((.*)\)/);if(!t)return null;const i=t[2];let n=1,s=0;for(;s<i.length&&("("===i[s]?n++:")"===i[s]&&n--,0!==n);)s++;const o=i.length-s;return{markdown:t[0].substring(0,t[0].length-o),label:t[1],url:this.conditionallyEncode(t[2].substring(0,s))}}conditionallyEncode(e){return this.needsEncoding(e)?encodeURI(e):e}needsEncoding(e){if(e.match(/([#\s\{\}\"\']|[^\x00-\x7F]|%[^0-9a-fA-F]{2})+/g))return!0;let t=e;try{t=decodeURI(e)}catch(e){}return!1}addTextChunk(e,t){0!==t.length&&e.push({type:o.z.text,text:t})}addLinkChunk(e,t){if(!this.capabilites.links.enable)return void(this.capabilites.links.keepLabels&&this.addTextChunk(e,t.label));const i={label:t.label,url:t.url,type:n.U.EXT_LINK};-1===i.url.indexOf("://")&&(i.url="http://"+i.url);const r=-1!==i.url.indexOf("matterport.com/show"),a=-1!==i.url.indexOf(window.location.host+"/show");if(r||a){const e=-1!==i.url.indexOf(this.modelSID),t=s.K.deserialize(i.url);e&&t?(i.type=n.U.NAVIGATION,i.navigationData=t):(i.type=n.U.MODEL,i.url+="&play=1")}e.push({type:o.z.link,link:i})}}},45296:(e,t,i)=>{"use strict";var n;i.d(t,{U:()=>n}),function(e){e[e.NAVIGATION=0]="NAVIGATION",e[e.MODEL=1]="MODEL",e[e.EXT_LINK=2]="EXT_LINK"}(n||(n={}));n.NAVIGATION,n.MODEL,n.EXT_LINK},28615:(e,t,i)=>{"use strict";var n;i.d(t,{z:()=>n}),function(e){e.text="text",e.link="link",e.photo="photo",e.video="video",e.rich="rich",e.none="none",e.error="error"}(n||(n={})),function(e){e.parse=t=>null!==t&&t in e?e[t]:e.none}(n||(n={}))},54733:(e,t,i)=>{"use strict";i.d(t,{V:()=>n,s:()=>MattertagDataAnalytics});var n,s=i(20983),o=i(43084),r=i(4292),a=i(28615);!function(e){e.OVERLAY="overlay",e.HOVER="hover",e.OPEN="open"}(n||(n={}));class MattertagDataAnalytics{constructor(){this.handlers=[{msgType:r.QY,func:(e,t,i)=>{const n=i.tryGetData(s.n),r=i.tryGetData(o.P5);if(!n||!r)return;const l=n.getTagCount(),c=r.getVisitedTags().length,h=r.getViewedTagCount(),d=n.getTag(t.sid);d&&e.track("tag_opened",{tag_count:l,tag_id:t.sid,tags_visited:c,tag_view_count:h,has_media:d.mediaType!==a.z.none})}},{msgType:r.dJ,func:(e,t,i)=>{const n=i.tryGetData(s.n),r=i.tryGetData(o.P5);if(!n||!r)return;const a=n.getTagCount(),l=r.getVisitedTags().length,c=r.getViewedTagCount(),h=n.getTag(t.sid);if(h){const i={mattertag_sid:t.sid,mattertag_view:t.view,mattertag_media:h.mediaType,mattertags_count:a,mattertags_total_views:c,mattertags_visited:l};e.track("mattertag_view",i)}}}]}}},88538:(e,t,i)=>{"use strict";i.d(t,{cH:()=>GetDiscPositionsCommand,Fz:()=>AddMattertagCommand,Gn:()=>RemoveMattertagCommand,Ek:()=>EditMattertagCommand});var n=i(99681);class GetDiscPositionsCommand extends n.m{constructor(e){super(),this.id="MATTERTAG_DISC_POSITIONS",this.payload={tags:e}}}class AddMattertagCommand extends n.m{constructor(e,t,i){super(),this.id="ADD_MATTERTAG",this.payload=Object.assign(Object.assign(Object.assign({},e),t),i)}}class RemoveMattertagCommand extends n.m{constructor(e){super(),this.id="DELETE_MATTERTAG",this.payload={sid:e}}}class EditMattertagCommand extends n.m{constructor(e,t,i,n){super(),this.payload={sid:e,options:Object.assign(Object.assign(Object.assign({},t),i),n)}}}},20983:(e,t,i)=>{"use strict";i.d(t,{n:()=>MattertagsData});var n=i(19413),s=i(71229);class MattertagsData extends n.V{constructor(e){if(super(),this.name="tag",this.mattertags=(0,s.q)(),e)for(const t of e)this.mattertags.set(t.sid,t);this.commit()}clear(){for(const e of this.mattertags)this.removeTag(e.sid)}clone(){return(new MattertagsData).copy(this)}copy(e){return MattertagsData.copyTagCollection(this,e),this}static copyTagCollection(e,t){const i=e.mattertags,n=t.mattertags;for(const t of i.keys)n.has(t)||e.removeTag(t);for(const t of n)e.addTag(t)}get collection(){return this.mattertags}addTag(e){this.mattertags.has(e.sid)?this.mattertags.get(e.sid).copy(e):this.mattertags.set(e.sid,e.clone())}removeTag(e){return this.mattertags.delete(e)}getTag(e){return this.mattertags.get(e)}getTagList(){return this.mattertags.keys}getTagCount(){return this.mattertags.length}iterate(e){for(const t of this.mattertags)e(t)}*[Symbol.iterator](){for(const e of this.mattertags)yield e}}},39668:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>MattertagDataModule});var n=i(54122),s=i(2212),o=i(61956),r=i(28615),a=i(90709),l=i(78909);class Mattertag extends l.T{constructor(){super(...arguments),this.sid="",this.created=new Date,this.modified=new Date,this.enabled=!0,this.label="",this.description="",this.parsedDescription=[],this.anchorPosition=new s.Vector3,this.anchorNormal=new s.Vector3(0,1,0),this.stemVector=new s.Vector3(0,0,(0,a._F)(1)),this.stemHeight=(0,a._F)(1),this.stemVisible=!0,this.color=o.I.MATTERTAG_BLUE.clone(),this.mediaType=r.z.none,this.mediaSrc="",this.widgetFrame=null}copy(e){this.anchorNormal.copy(e.anchorNormal),this.anchorPosition.copy(e.anchorPosition),this.color.copy(e.color),this.created.setTime(e.created.getTime()),this.description=e.description,this.enabled=e.enabled,this.floorId=e.floorId,this.roomId=e.roomId,this.label=e.label,this.mediaType=e.mediaType,this.mediaSrc=e.mediaSrc,this.modified.setTime(e.modified.getTime()),this.sid=e.sid,this.stemVector.copy(e.stemVector),this.stemHeight=e.stemHeight,this.stemVisible=e.stemVisible,this.parsedDescription=[];for(const t of e.parsedDescription)this.parsedDescription.push({link:t.link&&{label:t.link.label.slice(),url:t.link.url.slice(),type:t.link.type,navigationData:t.link.navigationData&&{floorVisibility:t.link.navigationData.floorVisibility,mode:t.link.navigationData.mode,sweepIndex:t.link.navigationData.sweepIndex,panoId:t.link.navigationData.panoId,position:t.link.navigationData.position&&t.link.navigationData.position.clone(),quaternion:t.link.navigationData.quaternion.clone(),zoom:t.link.navigationData.zoom}},text:t.text,type:t.type});return this.copyWidgetFrame(e.widgetFrame),this.commit(),this}clone(){return(new Mattertag).copy(this)}copyWidgetFrame(e){e?this.widgetFrame?(!function(e,t,...i){for(const n of i)e[n]=t[n]}(this.widgetFrame.size,e.size,"width","height"),this.widgetFrame.frame=e.frame):this.widgetFrame=Object.assign({},e):this.widgetFrame=null}}var c=i(62367),h=i(43894),d=i(17256),u=i(83032),p=i(64614),m=i(83083),g=i(60841),f=i(70389),v=i(25799),y=i(88538),b=i(20983),w=i(54708),S=i(71439);class ListSerializer{constructor(e){this.config=e}serialize(e){const{serializer:t}=this.config;if(!e||!Array.isArray(e)||!t)return null;const i=[];for(const n of e){const e=t.serialize(n);e&&i.push(e)}return i}deserialize(e){const{deserializer:t}=this.config;if(!e||!Array.isArray(e)||!t)return null;const i=[];for(const n of e){const e=t.deserialize(n);e&&i.push(e)}return i}}var E=i(32400),T=i(51770),M=i(60982);const _=new v.Z("mds-mattertag-serializer");class MdsMattertagCreateSerializer{constructor(e,t){this.updateSerializer=e,this.mediaSerializer=t}serialize(e){const t=this.mediaSerializer.serialize(e),i=this.updateSerializer.serialize(e),n=null!==t?Object.assign(Object.assign({},t),i):i;return this.validate(n)?n:null}validate(e){if(!e)return!1;const t=["label","description","mediaUrl"].some((t=>t in e)),i=["floorId","enabled","anchorPosition"].filter((t=>!(t in e))),n=0===i.length,s=!!e.anchorPosition&&(0,M.uU)(e.anchorPosition),o=n&&t&&s;return o||_.debug("Invalid MattertagDetails:",{missingFields:i,validPosition:s}),o}}var x=i(41964),A=i(32020),O=i(97620);const P=new v.Z("mds-mattertag-serializer");class MdsMattertagDeserializer{deserialize(e){if(!e||!this.validate(e))return P.debug("Deserialized invalid Mattertag data from MDS",e),null;const t=e.anchorPosition?O.ep.fromVisionVector(e.anchorPosition):void 0,i=e.stemNormal?O.ep.fromVisionVector(e.stemNormal):void 0,n=new Mattertag;if(n.sid=e.id,n.label=e.label||"",n.description=e.description||"",n.enabled=!!e.enabled,e.color&&(n.color=new s.Color(e.color)),n.created=(0,A.p)(e.created),n.modified=(0,A.p)(e.modified),e.floor&&e.floor.id&&(n.floorId=e.floor.id),e.room&&e.room.id&&(n.roomId=e.room.id),t&&(n.anchorPosition=t),e.media&&(n.mediaSrc=e.media),e.mediaType&&(n.mediaType=this.getTagDescriptionChunkType(e.mediaType)),void 0!==e.stemLength&&(n.stemHeight=e.stemLength),i){const t=i.clone().setLength(n.stemHeight);n.anchorNormal=i,n.stemVector=t,n.stemVisible=!!e.stemEnabled}else n.stemVector=new s.Vector3(0,0,0),n.stemVisible=!!e.stemEnabled;return n}validate(e){if(!e)return!1;const t=["id","created","modified","enabled"].every((t=>t in e)),i=e.floor&&"number"==typeof e.floor.meshId;return t&&i||P.debug("Invalid MdsMattertag:",{hasRequiredFields:t,validFloor:i,data:e}),t&&i}getTagDescriptionChunkType(e){const t={[x.L.VIDEO]:r.z.video,[x.L.PHOTO]:r.z.photo,[x.L.RICH]:r.z.rich};return e in t?t[e]:r.z.none}}class MdsMattertagMediaRemoveSerializer{serialize(e){return this.validate(e)?{sid:e.sid}:null}validate(e){const t=null!==e&&!!e.mediaType&&e.mediaType===r.z.none;return null!==e&&!!e.sid&&t}}const C=new v.Z("mds-mattertag-serializer");class MdsMattertagMediaUpdateSerializer{serialize(e){const t=this.extractMedia(e);return this.validate(t)?t:null}validate(e){if(!e)return!1;const t=["mediaUrl","mediaType"].every((t=>t in e)),i=void 0!==e.mediaType&&["rich","photo","video"].includes(e.mediaType),n=t&&i;return n||C.debug("invalid media",e,{hasRequiredFields:t,hasValidMediaType:i}),n}extractMedia(e){const t={};return e.mediaSrc&&(t.mediaUrl=e.mediaSrc),e.mediaType&&e.mediaType in D&&(t.mediaType=e.mediaType),t.mediaUrl&&t.mediaType?t:null}}const D={[r.z.photo]:[x.L.PHOTO],[r.z.rich]:[x.L.RICH],[r.z.video]:[x.L.VIDEO]};var I=i(69281);const R=new v.Z("mds-mattertag-serializer");class MdsMattertagUpdateSerializer{serialize(e){if(!e)return null;const t={};return void 0!==e.enabled&&(t.enabled=e.enabled),void 0!==e.stemVisible&&(t.stemEnabled=e.stemVisible),void 0!==e.label&&(t.label=e.label),void 0!==e.description&&(t.description=e.description),void 0!==e.color&&(0,I.D5)(e.color)&&(t.color=(0,I.Ex)(e.color)),void 0!==e.anchorPosition&&(0,M.uU)(e.anchorPosition)&&(t.anchorPosition=O.ep.toVisionVector(e.anchorPosition)),void 0!==e.anchorNormal&&(0,M.uU)(e.anchorNormal)&&(t.stemNormal=O.ep.toVisionVector(e.anchorNormal)),void 0!==e.stemHeight&&(t.stemLength=e.stemHeight),e.floorId&&(t.floorId=e.floorId),e.roomId&&(t.roomId=e.roomId),t&&this.validate(t)?t:null}validate(e){if(!e)return!1;const t=["floorId","roomId","color","label","description","enabled","stemEnabled","stemLength","stemNormal","anchorPosition"],i=Object.keys(e).length>0,n=Object.keys(e).every((e=>t.includes(e))),s=n&&i;return s||R.debug("Invalid MattertagPatch:",{hasContents:i,hasValidFields:n,data:e}),s}}var L=i(55482);const N=new v.Z("MdsMattertagStore");class MdsMattertagStore extends E.u{constructor(e){super(e),this.prefetchKey="data.model.mattertags",this.patchSerializer=new MdsMattertagUpdateSerializer,this.mediaUpdateSerializer=new MdsMattertagMediaUpdateSerializer,this.mediaRemovalSerializer=new MdsMattertagMediaRemoveSerializer,this.createSerializer=new MdsMattertagCreateSerializer(this.patchSerializer,this.mediaUpdateSerializer);const t=new MdsMattertagDeserializer;this.deserializer=new ListSerializer({deserializer:t})}async read(e){const{includeDisabled:t=!1}=this.config,i={modelId:this.getViewId(),includeDisabled:t};return this.query(L.GetMattertags,i,e).then((e=>{var t,i;const n=null===(i=null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.model)||void 0===i?void 0:i.mattertags;if(!n||!Array.isArray(n))return null;return(this.deserializer.deserialize(n)||[]).reduce(((e,t)=>(e[t.sid]=t,e)),{})}))}async create(e){const t=this.getViewId();return Promise.all(e.map((e=>{const i=this.createSerializer.serialize(e);if(!i)throw N.error("Failure saving tag:",e.sid,e),new Error("Could not save Mattertag");return this.mutate(L.AddMattertag,{modelId:t,mattertagId:e.sid,data:i}).then((t=>{if(N.debug(Object.assign({type:"addMattertag"},t)),t.errors&&t.errors.length>0)throw N.error(Object.assign({},t)),new Error("MattertagStore.create failed");const i=(0,T.qw)(t,"data.addMattertag"),n=(new Mattertag).copy(e);return n.sid=i.id,n.commit(),n}))})))}async update(e){const t=this.getViewId();return Promise.all(e.map((e=>{const i=e.sid,n=this.mediaUpdateSerializer.serialize(e),s=this.mediaRemovalSerializer.serialize(e),o=this.patchSerializer.serialize(e);if(!o&&!n&&!s)throw Error("MattertagStore.update failed");const r=""+(o?", $patch: MattertagPatch!":""),a=""+(n?", $mediaType: MattertagMediaType!, $mediaUrl:String!":""),l=S.Ps`
        mutation tagUpdate($modelId: ID!, $mattertagId: ID! ${r} ${a}) {
          ${o?"patchMattertag(\n              modelId: $modelId, ,\n              mattertagId: $mattertagId,\n              patch: $patch) {\n                id\n              }":""}
          ${s?"removeMattertagMedia(\n              modelId: $modelId, ,\n              mattertagId: $mattertagId) {\n                id\n              }":""}
          ${n?"updateMattertagMediaUrl(\n              modelId: $modelId, ,\n              mattertagId: $mattertagId,\n              type: $mediaType,\n              url: $mediaUrl) {\n                id\n              }":""}
        }
      `;return this.mutate(l,{modelId:t,mattertagId:i,patch:o,mediaType:n&&n.mediaType,mediaUrl:n&&n.mediaUrl}).then((e=>{if(N.debug(Object.assign({},e)),e.errors&&e.errors.length>0)throw N.error(Object.assign({},e)),new Error("MattertagStore.update failed")}))})))}async delete(e){const t=this.getViewId();return Promise.all(e.map((e=>{if(!e||e&&!e.sid)throw new Error("MattertagStore.delete failed");return this.mutate(L.DeleteMattertag,{modelId:t,mattertagId:e.sid}).then((e=>{if(N.debug(Object.assign({},e)),e.errors&&e.errors.length>0)throw N.error(Object.assign({},e)),new Error("MattertagStore.delete failed")}))})))}}var k,B=i(40032),F=i(46162);!function(e){e.LINK="link",e.PHOTO="photo",e.VIDEO="video",e.RICH="rich"}(k||(k={}));const U=new v.Z("mattertags"),V=e=>{var t;if(!e)return null;const i={};for(const n in e){const o=e[n];try{const e=new Mattertag;e.sid=o.sid,e.created=(0,A.p)(o.created),e.modified=(0,A.p)(o.modified),e.enabled=o.enabled,e.label=o.label||"",e.description=o.description||"",e.anchorPosition=new s.Vector3(o.position.x,o.position.y,o.position.z),(0,M.mB)(o.normal)?U.debug("Ignored empty Mattertag normal",o.normal):e.anchorNormal=new s.Vector3(o.normal.x,o.normal.y,o.normal.z),(null===(t=o.stem)||void 0===t?void 0:t.direction)?e.stemVector=new s.Vector3(o.stem.direction.x,o.stem.direction.y,o.stem.direction.z):(e.stemVector=e.anchorNormal.clone().setLength((0,a._F)(1)),U.debug(`Ignored missing stem direction for ${o.sid}`)),e.stemHeight=e.stemVector.length(),e.stemVisible=void 0===o.stem.enabled||o.stem.enabled,e.floorId="number"==typeof o.floor?String(o.floor):"",e.color=o.color?new s.Color(o.color):new s.Color("#03687d"),o.media?(e.mediaType=r.z.parse(o.media.type),e.mediaSrc=o.media.src):(e.mediaType=r.z.none,e.mediaSrc=""),i[n]=e}catch(e){U.error("Failed to parse tag: "+o.sid,e)}}return i},H=e=>{const t=parseInt(e.floorId,10);if(isNaN(t))throw new Error(`Failed to serialize unsupported floor ID '${e.floorId}'`);const i={sid:e.sid,created:(0,A.U)(e.created),modified:(0,A.U)(e.modified),enabled:e.enabled,label:e.label,description:e.description,color:(0,B.Ex)(e.color),position:(0,B.m)(e.anchorPosition),normal:(0,B.m)(e.anchorNormal),floor:t,stem:{direction:(0,B.m)(e.stemVector),enabled:void 0===e.stemVisible||e.stemVisible}};var n;return n=e.mediaType,Object.values(k).includes(n)&&(i.media={type:e.mediaType,src:e.mediaSrc}),i},G=(e,t)=>{const i={},n=(0,F.p$)(e);(0,F.TS)(n,t);for(const e of Object.keys(n)){const t=n[e];t&&(i[t.sid]=H(t))}return i},z=(e,t)=>{const i=[],n=(0,F.p$)(e);(0,F.TS)(n,t);for(const e of Object.keys(n)){const t=n[e];t&&i.push(H(t))}return i};var j=i(20331),W=i(80034),Z=i(41263),q=i(15119),K=i(7943);var Y=i(89155),$=i(75195);const X=new v.Z("mattertag-data");class MattertagDataModule extends n.Y{constructor(){super(...arguments),this.name="mattertag-data",this.monitor=null,this.getDiscPositions=(()=>{const e=[],t={},i={},n=new s.Vector3;return async o=>(e.length=0,o.tags.forEach((o=>{const r=this.data.getTag(o);r&&(i[o]||(i[o]=new s.Vector3),i[o].copy(r.anchorPosition).add(r.stemVector),t[o]||(t[o]=new s.Vector2),(0,$.q9)(this.cameraData,i[o],t[o],n),e.push({sid:o,screen:n.z>1?null:t[o],world:i[o]}))})),e)})(),this.addTag=async e=>{const t=new Mattertag;let i=(0,c.O1)(11);for(;this.data.getTag(i);)i=(0,c.O1)(11);return t.sid=i,this._editTag(t,e),this.data.addTag(t),i},this.editTag=async e=>{const t=this.data.getTag(e.sid);t&&this._editTag(t,e.options)},this._editTag=(e,t)=>{void 0!==t.color&&e.color.copy(t.color),void 0!==t.enabled&&(e.enabled=t.enabled),void 0!==t.stemHeight&&(e.stemHeight=t.stemHeight,e.stemVector.copy(e.anchorNormal).setLength(t.stemHeight)),void 0!==t.stemVisible&&(e.stemVisible=t.stemVisible),void 0!==t.label&&(e.label=t.label.slice()),void 0!==t.description&&(e.description=t.description,e.parsedDescription=this.descParser.parse(e.description)),void 0!==t.floorId&&(e.floorId=t.floorId),void 0!==t.mediaType&&(e.mediaType=t.mediaType),void 0!==t.mediaSrc&&(e.mediaSrc=t.mediaSrc.slice()),void 0!==t.normal&&(e.anchorNormal.copy(t.normal).normalize(),e.stemVector.copy(t.normal).setLength(e.stemHeight)),void 0!==t.position&&e.anchorPosition.copy(t.position),e.modified=new Date,e.commit()},this.removeTag=async e=>{if(void 0!==this.data.getTag(e.sid)&&this.data.removeTag(e.sid))return e.sid}}async init(e,t){this.engine=t,this.descParser=new w.$({model:e.modelId,supportLinks:!0,keepLinkLabels:!0}),this.store=this.configureStorage(e);const i=await this.store.read()||{};this.roomDataModule=await t.getModule(f.default),this.cameraData=await t.market.waitForData(Y.M_);const n=await t.getModule(h.F);this.data=t.market.tryGetData(b.n)||new b.n,this.initializeTagData(i,t.market,e.parserOptions),this.monitor=this.configureMonitor(e,this.store,this.data),this.bindings.push(t.commandBinder.addBinding(y.cH,this.getDiscPositions),t.commandBinder.addBinding(y.Fz,this.addTag),t.commandBinder.addBinding(y.Ek,this.editTag),t.commandBinder.addBinding(y.Gn,this.removeTag),n.onSave((()=>this.save()),{dataType:d.g.MATTERTAGS}),n.onRevert((()=>this.revert()),{dataType:d.g.MATTERTAGS}))}async revert(){if(this.store instanceof u.N)return this.store.revert()}async save(){if(this.monitor&&this.monitor.commitChanges(),this.store instanceof u.N)return;if(!this.store||!this.monitor)return void X.warn("Mattertags changes will NOT be saved");const e=this.monitor.getDiffRecord();this.monitor.clearDiffRecord();const t=e,i=t.filter((e=>e.action===p.KI.removed)).map((e=>({sid:e.index}))),n=t.filter((e=>e.action===p.KI.added)).map((e=>this.data.getTag(e.index))),s=t.filter((e=>e.action===p.KI.updated)).map((e=>{const t=Object.assign({sid:e.index},e.diff);return"mediaSrc"in t&&(t.mediaType=this.data.getTag(e.index).mediaType),t}));return Promise.all([this.store.delete(i),this.store.create(n),this.store.update(s)]).then((()=>{}))}clearDiffRecord(){this.monitor&&this.monitor.clearDiffRecord()}configureStorage(e){const{modelId:t,baseUrl:i,queue:n,storageProvider:s,readonly:o}=e;if(X.info(`Loading Mattertags from ${s}`),s===d.Xq.MDS)return new MdsMattertagStore({readonly:o,includeDisabled:!o,baseUrl:i});const r=function(e){const{modelId:t,readonly:i,serialize:n,deserialize:s}=e,o=e.baseUrl||"",r=e.queue||new j.gO;if(!n||!s)throw new Error("Mattertag sync requires serializer and deserializer");const a=`${o}/api/v1/jsonstore/model/mattertags/${t}`;if(i){const e=new W.gh({queue:r,path:a,deserialize:s});return new Z.iY({publishStores:[e]})}const l=new W.MU({queue:r,path:a,batchUpdate:!0,deserialize:s,serialize:n}),c=`${o}/api/v1/jsonstore/model/workshopSession/${t}`,h=new q.Z({queue:r,path:c,cachedData:{data:null},deserialize:K.S.sessionCollectionMap(q.j.Mattertags,s),serialize:z},q.j.Mattertags);return new Z.iY({publishStores:[l],legacyEditStore:h,editStoreKey:Z.aw.MATTERTAGS})}({modelId:t,readonly:o,baseUrl:i,serialize:G,deserialize:V,queue:n});return new u.N(r,{dataType:d.g.MATTERTAGS,modelId:t,readonly:o,engine:this.engine})}configureMonitor(e,t,i){const{readonly:n}=e;if(!n){const e=new m.c(i.collection,{aggregationType:g.E.Manual,shallow:!0});return t instanceof u.N&&t.addMonitor(e),e}return null}initializeTagData(e,t,i){const n=i?new w.$(i):this.descParser;for(const t in e){const i=e[t];i.parsedDescription=n.parse(e[t].description),this.roomDataModule.inferMeshIdsFromPoint(i,i.anchorPosition),this.data.addTag(i)}t.register(this,b.n,this.data)}}},4292:(e,t,i)=>{"use strict";i.d(t,{QY:()=>MattertagNavigatedMessage,Ik:()=>MattertagLinkOpenedMessage,dJ:()=>MattertagViewedMessage,vE:()=>MattertagFullSizeMessage});var n=i(93528);class MattertagNavigatedMessage extends n.v{constructor(e){super(),this.sid=e}}class MattertagLinkOpenedMessage extends n.v{constructor(e,t){super(),this.url=e,this.embed=t}}class MattertagViewedMessage extends n.v{constructor(e,t){super(),this.sid=e,this.view=t}}class MattertagFullSizeMessage extends n.v{constructor(e){super(),this.fullSized=e}}},91172:(e,t,i)=>{"use strict";i.d(t,{re:()=>n,lc:()=>s});Object.freeze({mattertags:{visibility:{alphaTestLevel:.05},disc:{scale:{nearBound:1.5,farBound:4.8,maxSize:80,minSize:40,baseViewportSize:800,responsiveness:100}},pole:{height:.5,width:2,opacity:.5,color:"white"}}});const n="features/mattertags",s="embedlyKey"},17282:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>MattertagMeshModule});var n=i(54122),s=i(39936),o=i(20983),r=i(90926),a=i(61155),l=i(21685),c=i(91172),h=i(43084),d=i(60778),u=i(64366),p=i(78947);class MattertagMeshModule extends n.Y{constructor(){super(...arguments),this.name="mattertag-mesh",this.visibilityDirty=!0,this.unanchoredTagOpacity=1,this.anchoredTagOpacity=1,this.addNewTagMesh=(e,t)=>{this.settings.tryGetProperty(l.R,!1)||this.pinRenderer.updatePin(e.sid,r.Er.MATTERTAG,Object.assign(Object.assign({},e),{stemNormal:e.stemVector,stemLength:e.stemHeight,stemEnabled:e.stemVisible,color:`#${e.color.getHexString()}`}),this.backgroundTexture,this.maskTexture)},this.removeTagMesh=(e,t)=>{this.pinRenderer.removePin(e.sid)},this.updateTagMesh=(e,t)=>{this.addNewTagMesh(e,e.sid)},this.initializeTagVisibility=()=>{if(this.settings.tryGetProperty(l.R,!1))return;const e=this.settings.tryGetProperty(c.re,!0);this.pinRenderer.setPinOpacityByType(r.Er.MATTERTAG,e?1:0),e&&this.mattertagData.iterate((e=>{this.pinRenderer.setPinVisible(e.sid,e.enabled)}))},this.updateTagVisibilty=()=>{if(this.settings.tryGetProperty(l.R,!1))return;this.settings.tryGetProperty(c.re,!1)?this.fadePinsToState():this.pinRenderer.fadePinOpacityByType(r.Er.MATTERTAG,0)},this.selectedTagChanged=()=>{if(!this.settings.tryGetProperty(l.R,!1)){if(this.mattertagViewData.selectedTag&&!this.mattertagViewData.navigating){const e=this.mattertagData.getTag(this.mattertagViewData.selectedTag);this.pinRenderer.showSelectedMesh(r.Er.MATTERTAG,e.sid)}this.mattertagViewData.selectedTag||this.pinRenderer.hideSelectedMesh()}}}async init(e,t){const[i,n,r,l]=await Promise.all([t.market.waitForData(o.n),t.getModule(a.default),t.market.waitForData(s.e),t.market.waitForData(h.P5)]);this.settings=r,this.mattertagData=i,this.mattertagViewData=l,this.pinRenderer=n.pinRenderer;const m=()=>{this.visibilityDirty=!0};this.bindings.push(this.mattertagData.collection.onElementChanged({onAdded:this.addNewTagMesh,onRemoved:this.removeTagMesh,onUpdated:this.updateTagMesh}),this.mattertagViewData.onToolStateChanged(m),this.settings.onPropertyChanged(c.re,m),this.mattertagData.onChanged(m),this.mattertagViewData.onSelectedTagChanged(this.selectedTagChanged),this.mattertagViewData.onNavigatingTagChanged(this.selectedTagChanged)),this.backgroundTexture=(0,d.p)(u),this.maskTexture=(0,d.p)(p),this.mattertagData.iterate((e=>{this.addNewTagMesh(e,e.sid)})),this.initializeTagVisibility()}dispose(e){this.pinRenderer.removePinsByType(r.Er.MATTERTAG),this.backgroundTexture.dispose(),this.maskTexture.dispose(),super.dispose(e)}onUpdate(e){this.visibilityDirty&&(this.visibilityDirty=!1,this.updateTagVisibilty())}showAnchorMesh(e){this.pinRenderer.showAnchorMesh(r.Er.MATTERTAG,e.sid,Object.assign(Object.assign({},e),{stemNormal:e.stemVector,stemLength:e.stemHeight})),this.unanchoredTagOpacity=.5,this.anchoredTagOpacity=1,this.anchorTagId=e.sid,this.fadePinsToState()}hideAnchorMesh(){this.unanchoredTagOpacity=1,this.anchoredTagOpacity=1,this.anchorTagId=void 0,this.pinRenderer.hideAnchorMesh(),this.fadePinsToState()}resetPinOpacity(){this.fadePinsToState()}changeDiscOpacity(e,t){this.pinRenderer.setPinOpacity(e,t)}setTagVisibility(e){this.pinRenderer.setPinTypeVisible(r.Er.MATTERTAG,e)}setTagVisible(e,t){this.pinRenderer.setPinVisible(e,t)}setOverrideMaterial(e,t,i){this.pinRenderer.setPinRenderOverrides(e,t,i)}fadePinsToState(){const{selectedTag:e}=this.mattertagViewData;this.mattertagData.iterate((t=>{const i=t.enabled||e===t.sid;this.pinRenderer.setPinVisible(t.sid,i);const n=t.sid===this.anchorTagId?this.anchoredTagOpacity:this.unanchoredTagOpacity;this.pinRenderer.fadePinOpacity(t.sid,i?n:0)}))}}},25145:(e,t,i)=>{"use strict";i.d(t,{c:()=>MattertagNavigateToLinkCommand,Y:()=>NavigateToMattertagCommand});var n=i(99681);class MattertagNavigateToLinkCommand extends n.m{constructor(e){super(),this.id="MATTERTAG_NAV_LINK",this.payload={chunk:e}}}class NavigateToMattertagCommand extends n.m{constructor(e,t,i=!1){super(),this.id="MATTERTAG_NAVIGATE",this.payload={sid:e,transition:t,navigateToDisabled:i}}}},43084:(e,t,i)=>{"use strict";i.d(t,{Pg:()=>n,rI:()=>s,P5:()=>MattertagsViewData,ZJ:()=>BillboardData});var n,s,o=i(19413),r=i(90134),a=i(5442),l=i(71229),c=i(78909);!function(e){e.UP="Up",e.DOWN="Down",e.LEFT="Left",e.LEFT_UP="LeftUp",e.LEFT_DOWN="LeftDown",e.RIGHT="Right",e.RIGHT_UP="RightUp",e.RIGHT_DOWN="RightDown"}(n||(n={})),function(e){e.CLOSED="closed",e.IDLE="idle",e.DISABLED="disabled",e.CREATING="creating",e.PRESSING="pressing",e.PLACING="placing",e.PLACED="placed",e.EDITING="editing"}(s||(s={}));class MattertagsViewData extends o.V{constructor(e){super(),this.mattertags=e,this.name="tag-view",this.visitedTags=new r.d,this.navigatingTag=(0,a.Y)(null),this.toolStateObservable=(0,a.Y)(s.CLOSED),this.openTagObservable=(0,a.Y)(null),this.selectedTagObservable=(0,a.Y)(null),this.uncommittedTagObservable=(0,a.Y)(null),this.progressObservable=new a.f(-1),this.screenPositionObservable=new a.f(null),this.viewedTags=0,this.creatingNewMattertag=!1,this.tagCapabilities={},this.getViewData=e=>{const t=this.mattertags.getTag(e),i=this.derivedData[e];return t&&!i&&this.makeViewData&&(this.derivedData[e]=this.makeViewData(t)),this.derivedData[e]},this.derivedData={},this.activeBillboards=(0,l.q)()}setViewDataFactory(e){this.makeViewData=e}openBillboard(e){this.openTag&&this.openTag!==e&&this.closeBillboard(this.openTag),this.openTag!==e&&this.setOpenTag(e)}hideBillboard(e){this.openTag===e&&this.setOpenTag(null)}closeBillboard(e){this.openTag===e&&this.setOpenTag(null),this.selectedTag===e&&this.setSelectedTag(null)}closeOpenBillboard(){this.openTag&&this.closeBillboard(this.openTag)}setTagCapabilities(e,t){const i=this.tagCapabilities[e]||{};i.opening=t.opening,i.navigating=t.navigating,this.tagCapabilities[e]=i,this.openTag!==e||this.tagCapabilities.opening||this.closeBillboard(e)}getTagCount(){return this.mattertags.collection.length}get navigating(){return this.navigatingTag.value}setNavigatingTag(e){this.navigatingTag.value=e}onNavigatingTagChanged(e){return this.navigatingTag.onChanged(e)}setSelectedTag(e){this.selectedTagObservable.value=e}get selectedTag(){return this.selectedTagObservable.value}onSelectedTagChanged(e){return this.selectedTagObservable.onChanged(e)}setUncommittedTag(e){this.uncommittedTagObservable.value=e}get uncommittedTag(){return this.uncommittedTagObservable.value}onUncommittedChanged(e){return this.uncommittedTagObservable.onChanged(e)}setProgress(e){this.progressObservable.value=e}get progress(){return this.progressObservable.value}onProgressChanged(e){return this.progressObservable.onChanged(e)}get screenPosition(){return this.screenPositionObservable.value}setScreenPosition(e){this.screenPositionObservable.value=e}onScreenPositionChanged(e){return this.screenPositionObservable.onChanged(e)}setToolState(e){switch(e){case s.CREATING:this.creatingNewMattertag=!0;break;case s.IDLE:case s.CLOSED:this.creatingNewMattertag=!1}this.toolStateObservable.value=e}get toolState(){return this.toolStateObservable.value}onToolStateChanged(e){return this.toolStateObservable.onChanged(e)}get openTag(){return this.openTagObservable.value}setOpenTag(e){this.openTagObservable.value=e}onOpenTagChanged(e){return this.openTagObservable.onChanged(e)}isCreatingNewMattertag(){return this.creatingNewMattertag}visitTag(e){this.viewedTags++,-1===this.visitedTags.indexOf(e)&&this.visitedTags.push(e)}getViewedTagCount(){return this.viewedTags}getVisitedTags(){return this.visitedTags.values()}setNavigatingPosition(e){this.navigatingPosition=e}getNavigatingPosition(){return this.navigatingPosition}}class BillboardData extends c.T{constructor(e){super(),this.sid=e,this.closing=!1,this.position=null,this.distance=0,this.timeoutId=0}}},31640:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>MattertagViewDataModule});var n=i(2212),s=i(54122),o=i(20983),r=i(88538),a=i(89155),l=i(4292),c=i(47678),h=i(48840),d=i(3471),u=i(47924),p=i(77956),m=i(54733),g=i(29675),f=i(71208),v=i(91172),y=i(21685),b=i(39936),w=i(25145),S=i(55525),E=i(25799),T=i(72942),M=i(43084),_=i(27829),x=i(90926),A=i(61155),O=i(43770);const P=new E.Z("mattertag-viewdata-module");class MattertagViewDataModule extends s.Y{constructor(){super(...arguments),this.name="mattertags-viewdata",this.distance=new n.Vector3,this.cameraPosition=new n.Vector3,this.hoverTimeout=0,this.updateViewData=()=>{this.data.iterate((e=>{this.viewData.derivedData[e.sid]=this.makeViewDataForMattertag(e)})),this.viewData.commit()},this.makeViewDataForMattertag=e=>{const t=this.viewData.activeBillboards.get(e.sid),i=this.viewData.selectedTag===e.sid,n=t?t.position:null,s=t?t.distance:0;return{position:n,selected:i,located:!(!n||!s),closeTheTag:!t||t.closing||!(i||!this.viewData.selectedTag),navigating:!(!this.viewData.navigating||this.viewData.navigating!==e.sid),navigatingPosition:i?this.viewData.getNavigatingPosition():void 0,positioned:!1,distance:s,stemHeight:e.stemHeight,visible:e.enabled,color:`#${e.color.getHexString()}`,onTagDirectionChanged:this.onTagDirectionChanged}},this.onCameraUpdate=e=>{this.viewData.activeBillboards.keys.length>0&&(this.cameraPosition.copy(e.pose.position),this.updateActiveBillboards(this.viewData.activeBillboards.keys),this.viewData.commit())},this.updateBillboardData=(e,t)=>{const i=this.viewData.activeBillboards.get(e);i&&(Object.assign(i,t),i.commit())},this.addActiveBillboard=e=>{this.viewData.activeBillboards.has(e)||this.viewData.activeBillboards.set(e,new M.ZJ(e))},this.removeFromActiveBillboards=e=>{this.viewData.activeBillboards.has(e)&&this.viewData.activeBillboards.delete(e)},this.handleOpenBillboardChanged=()=>{const e=this.viewData.openTag;this.viewData.activeBillboards.atomic((()=>{e&&(this.viewData.activeBillboards.get(e)?(window.clearTimeout(this.viewData.activeBillboards.get(e).timeoutId),this.updateBillboardData(e,{timeoutId:0,closing:!1})):this.addActiveBillboard(e),this.updateActiveBillboards([e]));for(const t of this.viewData.activeBillboards.keys){if(t===e)return;this.updateBillboardData(t,{closing:!0,direction:void 0,timeoutId:window.setTimeout((()=>{this.removeFromActiveBillboards(t)}),1e3)})}}))},this.updateActiveBillboards=async e=>{try{await this.engine.commandBinder.issueCommand(new r.cH(e)).then((e=>{for(const t of e)this.updateBillboardData(t.sid,{distance:this.distance.copy(this.cameraPosition).distanceToSquared(t.world),position:t.screen})}))}catch(e){P.error(`Could not get Disc Positions for tags - ${e}`)}},this.onSweepChosen=e=>{this.viewData.setNavigatingPosition(e)},this.onDiscHoverChange=e=>{if(this.settings.tryGetProperty(y.R,!1))return;if(e.pinType!==x.Er.MATTERTAG)return;const t=this.viewData.toolState;if(t!==M.rI.CLOSED&&this.viewData.selectedTag)return;const i=this.data.getTag(e.id);if(i&&i.enabled)if(clearTimeout(this.hoverTimeout),e.hovering)t!==M.rI.EDITING&&(this.hoverTimeout=window.setTimeout((()=>this.discHoverChange(e.id,e.hovering)),125));else{if(e.id===this.viewData.selectedTag)return;this.discHoverChange(e.id,!1)}},this.onDiscClicked=e=>{if(this.settings.tryGetProperty(y.R,!1))return;const t=this.viewData.toolState;e.pinType===x.Er.MATTERTAG&&t===M.rI.CLOSED&&(e.id===this.viewData.selectedTag?this.closeBillboard(e.id):(this.viewData.setSelectedTag(e.id),this.navigateToTag(e.id,u.n.Interpolate)))},this.onSweepExit=e=>{e.toSweep&&e.fromSweep!==e.toSweep&&(this.viewData.isCreatingNewMattertag()||this.viewData.closeOpenBillboard())},this.onAppChange=e=>{this.currentApp=e.application,this.viewData.closeOpenBillboard(),this.viewData.setSelectedTag(null)},this.onViewmodeChange=e=>{null===this.viewData.navigating&&e.fromMode===f.Ey.Panorama&&this.viewData.closeOpenBillboard()},this.onNavigationLinkClicked=async e=>{if(e.chunk.link&&e.chunk.link.navigationData){const t={2:T.BD.DOLLHOUSE,3:T.BD.FLOORPLAN},{sweepIndex:i,quaternion:n,mode:s}=e.chunk.link.navigationData;let{panoId:o,position:r}=e.chunk.link.navigationData;if(!o&&void 0!==i){const e=this.sweepData.getSweepByIndex(i);e&&(o=e.id)}if(o)this.engine.commandBinder.issueCommand(new S.ju({sweep:o,rotation:n,transition:u.n.FadeToBlack}));else{if(!(s in t))throw new Error("Unknown navigation link pose: "+JSON.stringify(e.chunk.link.navigationData));this.engine.commandBinder.issueCommand(new T._i(t[s],u.n.Interpolate,{rotation:n,position:r}))}}},this.onTagDirectionChanged=(e,t)=>{this.updateBillboardData(e,{direction:t})}}async init(e,t){this.engine=t;const[i,n,s,r,l]=await Promise.all([t.market.waitForData(o.n),t.market.waitForData(p.Z),t.market.waitForData(b.e),t.market.waitForData(a.M_),t.getModule(A.default)]);this.data=i,this.sweepData=n,this.settings=s,this.cameraData=r,this.pinRenderer=l.pinRenderer,this.viewData=t.market.tryGetData(M.P5)||new M.P5(this.data),t.market.register(this,M.P5,this.viewData),this.viewData.setViewDataFactory(this.makeViewDataForMattertag),this.updateViewData(),this.settings.onPropertyChanged(v.re,(e=>{0!==e&&this.viewData.closeOpenBillboard()})),this.bindings.push(t.subscribe(O.tP,this.onDiscHoverChange),t.subscribe(O.F7,this.onDiscClicked),t.subscribe(c.Z,this.onSweepExit),t.subscribe(h.Z,this.onViewmodeChange),t.subscribe(d.bS,this.onAppChange),this.cameraData.onChanged(this.onCameraUpdate),this.data.onChanged(this.updateViewData),this.viewData.onOpenTagChanged(this.handleOpenBillboardChanged),this.viewData.activeBillboards.onChanged(this.updateViewData)),this.engine.commandBinder.addBinding(w.c,this.onNavigationLinkClicked),this.engine.commandBinder.addBinding(w.Y,(async e=>this.navigateToTag(e.sid,e.transition,e.navigateToDisabled)))}openBillboard(e){const t=this.viewData.tagCapabilities[e];t&&!t.opening||this.viewData.openBillboard(e)}closeBillboard(e){this.viewData.closeBillboard(e)}async navigateToTag(e,t,i=!1){if(this.settings.tryGetProperty(y.R,!1))return;const n=this.data.getTag(e);if(!n)throw new Error("No tag with that sid was found");if(!n.enabled&&!i)throw new Error("Cannot navigate to a disabled mattertag");const s=this.viewData.tagCapabilities[e];if(s&&!s.navigating)return;this.viewData.setNavigatingTag(e);const o=this.viewData.activeBillboards.get(e),r=o&&o.direction,{anchorPosition:a,stemVector:l,stemHeight:c}=n,h=this.tagDirectionToOrientationAdjust(r),d={anchorPosition:a,stemNormal:l,stemLength:c};return this.engine.commandBinder.issueCommand(new S.OR({pinPosition:d,transition:t,orientationAdjust:h,onSweepChosen:this.onSweepChosen})).then((()=>{this.viewData.setSelectedTag(e),this.onTagVisited(e),this.openBillboard(e),this.viewData.setNavigatingTag(null),this.viewData.setNavigatingPosition(void 0)})).catch((e=>{P.debug(e),this.viewData.setNavigatingTag(null),this.viewData.setNavigatingPosition(void 0)}))}onTagVisited(e){this.viewData.visitTag(e),this.engine.broadcast(new l.dJ(e,m.V.OPEN)),this.engine.broadcast(new l.QY(e))}discHoverChange(e,t){if(this.settings.tryGetProperty(y.R,!1))return;if(!this.data.getTag(e))return;const i=this.viewData.openTag===e;t&&!i?(this.currentApp===g.Mx.SHOWCASE&&this.engine.broadcast(new l.dJ(e,m.V.HOVER)),this.openBillboard(e),this.pinRenderer.setPinColorVariant(e,x.K_.HIGHLIGHTED)):!t&&i&&(this.closeBillboard(e),this.pinRenderer.setPinColorVariant(e,x.K_.DEFAULT)),this.viewData.commit()}tagDirectionToOrientationAdjust(e,t=new n.Quaternion){const i=.25;let s=0,o=0;if(e){switch(e){case M.Pg.RIGHT:case M.Pg.RIGHT_DOWN:case M.Pg.RIGHT_UP:s=-.25;break;case M.Pg.LEFT:case M.Pg.LEFT_DOWN:case M.Pg.LEFT_UP:s=i}switch(e){case M.Pg.UP:case M.Pg.LEFT_UP:case M.Pg.RIGHT_UP:o=i;break;case M.Pg.DOWN:case M.Pg.LEFT_DOWN:case M.Pg.RIGHT_DOWN:s=-.25}}else s=-.25,o=-.25;return t.setFromAxisAngle(_.f.RIGHT,o),t.multiply((new n.Quaternion).setFromAxisAngle(_.f.UP,s)),t}}},11618:(e,t,i)=>{"use strict";i.d(t,{h:()=>Grouper,Z:()=>Group});var n=i(11203),s=i(46162),o=i(67125);class Grouper{constructor(e){this.contents=e,this.groupInfo=[],this.groupIndices=[],this.groupInfoMap={},this.groupIndicesMap={}}startGroup(e){const t=0===this.groupCount,i=this.contents.length!==this.groupIndices[this.groupCount-1];if(t||i){let t=e.sid;if(!t)for(t=(0,o.f)();this.groupInfoMap.hasOwnProperty(t);)t=(0,o.f)();const i=Object.assign(Object.assign({},e),{sid:t});this.groupInfo.push(i),this.groupInfoMap[t]=i,this.groupIndices.push(this.contents.length),this.groupIndicesMap[this.contents.length]=!0}return this.groupIndices.length-1}reset(){this.contents.atomic((()=>{for(let e=this.contents.length-1;e>=0;--e)this.removeFromIdx(e);this.groupIndices=[],this.groupInfo=[],this.groupIndicesMap={}}))}isStartIndex(e){return!!this.groupIndicesMap[e]}*groups(){for(let e=0;e<this.groupCount;++e)yield this.getGroup(e)}*[Symbol.iterator](){for(const e of this.contents)yield e}getGroupStartIndex(e){return this.groupIndices[e]}getGroup(e){const t=this.groupIndices[e],i=this.groupIndices[e+1],n=isNaN(i)?this.contents.length-1:i-1;return new Group(e,this.contents,t,n,Object.assign({},this.groupInfo[e]))}getGroupById(e){for(let t=0;t<this.groupInfo.length;t++)if(e===this.groupInfo[t].sid)return this.getGroup(t)}indexOfGroup(e){for(let t=0;t<this.groupInfo.length;t++)if(e(this.groupInfo[t]))return t;return-1}updateGroupInfo(e,t){const i=this.groupInfo[e].sid;delete this.groupInfoMap[i];const n=Object.assign({sid:i},t);this.groupInfo.splice(e,1,n),this.groupInfoMap[i]=n}get groupCount(){return this.groupIndices.length}get length(){return this.contents.length}get(e){return this.contents.get(e)}push(e){if(0===this.groupCount)throw Error("Grouper: Error pushing points when we have no groups!");return this.contents.push(e.clone()),this.contents.length}pop(){return this.removeFromIdx(this.contents.length-1)}removeFromIdx(e){if(e<this.contents.length&&e>=0&&this.contents.length>=0){const t=this.contents.get(e);return this.contents.remove(e),this.removeEmptyGroups(),t}}removeEmptyGroups(){this.contents.length<=this.groupIndices[this.groupCount-1]&&this.removeGroup(this.groupCount-1)}groupFromPointIndex(e){if(0>e||e>=this.length)return-1;let t=this.groupCount-1;for(;e<this.groupIndices[t];)--t;return t}removeGroup(e){if(e>this.groupCount||e<0)return;const t=this.getGroup(e);if(0===t.count)return;const i=this.groupIndices[e];this.groupIndices.splice(e,1),this.groupInfo.splice(e,1),delete this.groupInfoMap[t.info.sid],delete this.groupIndicesMap[i];for(let i=e;i<this.groupCount;++i){const e=this.groupIndices[i],n=e-t.count;this.groupIndices[i]=n,delete this.groupIndicesMap[e],this.groupIndicesMap[n]=!0}this.contents.splice(t.startIndex,t.count)}update(e,t){this.contents.update(e,t.clone())}copy(e){return this.contents.atomic((()=>{this.reset();for(const t of e){this.startGroup(t.info);for(const e of t)this.push(e)}})),this}toString(){return`Grouper: { groupCount: ${this.groupCount}, length: ${this.length}, groups: [${[...this.groups()].map((e=>`${e}`))}]}`}}class Group{constructor(e,t,i,n,s){this.index=e,this.grouper=t,this.startIndex=i,this.endIndex=n,this.data=s}*[Symbol.iterator](){for(let e=0;e<this.count;++e)yield this.get(e)}get(e){if(!this.has(e))throw RangeError(`Out of range error ${e} / ${this.count-1}`);return this.grouper.get(this.startIndex+e)}has(e){return e>=0&&this.startIndex+e<=this.endIndex}get count(){return this.endIndex-this.startIndex+1}get info(){return this.data}get isClosed(){const e=this.grouper.get(this.startIndex),t=this.grouper.get(this.endIndex);return this.count>2&&e.distanceTo(t)<=n.NZ}get length(){let e=0,t=null;for(let i=0;i<this.count;i++)t&&(e+=this.get(i).distanceTo(t)),t=this.get(i);return e}hasLength(){const e=this.grouper.get(this.startIndex),t=this.grouper.get(this.endIndex);return e&&t&&(this.isClosed||e.distanceTo(t)>n.NZ)}clone(){const e=[],t={get:t=>e[t],contents:e};for(let e=0;e<this.count;e++)t.contents.push(this.get(e));return new Group(this.index,t,0,t.contents.length-1,Object.assign({},this.data))}describe(e=this.endIndex){return`GroupSegment${this.index}/${this.startIndex}/${e}}`}equals(e){if(this.count!==e.count||this.index!==e.index)return!1;if((0,s.NK)(this.info,e.info))return!1;for(let t=0;t<this.count;++t)if(!this.get(t).equals(e.get(t)))return!1;return!0}}},26983:(e,t,i)=>{"use strict";i.d(t,{X:()=>MeasurementModeData});var n=i(19413),s=i(45982),o=i(5442),r=i(57501);class MeasurementModeData extends n.V{constructor(){super(...arguments),this.name="measure-mode",this._groups=[],this._groupMap={},this.onDataChangedCallbacks=new Set,this._editingGroupId=null,this._creatingGroupId=null,this.phaseObservable=(0,o.Y)(s.au.CLOSED),this.selectedGroupIndexObservable=new o.f(-1),this.pressProgressObservable=new o.f(-1),this.pointPositionObservable=new o.f(null)}modeActive(){return this.phase!==s.au.CLOSED}*groups(){for(const e of this._groups)yield e}get selectedGroupSid(){const e=this.selectedGroupInfo;return e&&e.info.sid?e.info.sid:null}get selectedGroupInfo(){return-1===this.selectedGroupIndex?null:this.getGroupInfo(this.selectedGroupIndex)}get phase(){return this.phaseObservable.value}get creatingGroupId(){return this._creatingGroupId}set creatingGroupId(e){this._creatingGroupId=e}get editingGroupId(){return this._editingGroupId}set editingGroupId(e){this._editingGroupId=e}setPhase(e){this.phase!==e&&(this.phaseObservable.value=e)}onPhaseChanged(e){return this.phaseObservable.onChanged(e)}notifyDataChanged(){this.onDataChangedCallbacks.forEach((e=>e()))}onDataChanged(e){return(0,r.k1)((()=>this.onDataChangedCallbacks.add(e)),(()=>this.onDataChangedCallbacks.delete(e)),!0)}get groupCount(){return this._groups.length}get selectedGroupIndex(){return this.selectedGroupIndexObservable.value}setSelectedGroupIndex(e){this.selectedGroupIndexObservable.value=e}onSelectedGroupIndexChanged(e){return this.selectedGroupIndexObservable.onChanged(e)}get pointPosition(){return this.pointPositionObservable.value}setPointPosition(e){this.pointPositionObservable.value=e}onPointPositionChanged(e){return this.pointPositionObservable.onChanged(e)}setPressProgress(e){this.pressProgressObservable.value=e}get pressProgress(){return this.pressProgressObservable.value}onPressProgressChanged(e){return this.pressProgressObservable.onChanged(e)}getGroupInfo(e){return e<0||e>=this._groups.length?null:this._groups[e]}getGroupInfoBySid(e){return e?this._groupMap[e]:null}repopulate(e){this.clear();for(const t of e){const e=t.clone();this._groups.push(e),this._groupMap[t.info.sid]=e}(this.editingGroupId||this.creatingGroupId)&&this.notifyDataChanged()}clear(){this._groups=[],this._groupMap={}}}},45982:(e,t,i)=>{"use strict";var n;i.d(t,{au:()=>n,Pj:()=>s,Ph:()=>o,q8:()=>r,WN:()=>a}),function(e){e[e.CLOSED=0]="CLOSED",e[e.IDLE=1]="IDLE",e[e.EDITING=2]="EDITING",e[e.CREATING=3]="CREATING",e[e.POINT_PLACED=4]="POINT_PLACED",e[e.CREATING_NEXT_POINT=5]="CREATING_NEXT_POINT",e[e.CONFIRMING_POINT=6]="CONFIRMING_POINT"}(n||(n={}));const s={mobile:{[n.POINT_PLACED]:!0,[n.EDITING]:!0},desktop:{[n.CREATING]:!0,[n.CREATING_NEXT_POINT]:!0,[n.EDITING]:!0}},o={mobile:{[n.CREATING_NEXT_POINT]:!0,[n.POINT_PLACED]:!0,[n.EDITING]:!0},desktop:{[n.CREATING]:!0,[n.CREATING_NEXT_POINT]:!0,[n.EDITING]:!0}},r={[n.IDLE]:!0,[n.EDITING]:!0},a={[n.IDLE]:!0,[n.EDITING]:!0}},79758:(e,t,i)=>{"use strict";i.d(t,{d:()=>MeasurementContentsReplace});var n=i(99681);class MeasurementContentsReplace extends n.m{constructor(e){super(),this.payload=e}}},60579:(e,t,i)=>{"use strict";i.d(t,{Ev:()=>MeasurementDeleteSelectedCommand,Tn:()=>MeasurementDeleteCommand,JM:()=>MeasurementListDeletionCommand});var n=i(99681);class MeasurementDeleteSelectedCommand extends n.m{}class MeasurementDeleteCommand extends n.m{constructor(e){super(),this.payload={index:e}}}class MeasurementListDeletionCommand extends n.m{constructor(...e){super(),this.payload={sids:e}}}},54590:(e,t,i)=>{"use strict";i.d(t,{O:()=>MeasurementModeToggle});var n=i(99681);class MeasurementModeToggle extends n.m{constructor(e,t){super(),this.payload={on:e,dimWhileActive:void 0!==t?t:e}}}},77399:(e,t,i)=>{"use strict";i.d(t,{c:()=>MeasurementNewline});var n=i(99681);class MeasurementNewline extends n.m{}},42060:(e,t,i)=>{"use strict";i.d(t,{R:()=>MeasurementRenameCommand});var n=i(99681);class MeasurementRenameCommand extends n.m{constructor(e,t=""){super(),this.id="RENAME_MEASUREMENT",this.payload={sid:e,text:t}}}},35887:(e,t,i)=>{"use strict";i.d(t,{v:()=>MeasurementSelect,t:()=>MeasurementSelectById});var n=i(99681);class MeasurementSelect extends n.m{constructor(e){super(),this.payload=e}}class MeasurementSelectById extends n.m{constructor(e){super(),this.payload={sid:e}}}},1437:(e,t,i)=>{"use strict";i.d(t,{B:()=>MeasurementStop});var n=i(99681);class MeasurementStop extends n.m{}},86034:(e,t,i)=>{"use strict";i.d(t,{W:()=>MeasurementVisibilityCommand});var n=i(99681);class MeasurementVisibilityCommand extends n.m{constructor(e,...t){super(),this.id="VISIBILITY_MEASUREMENT",this.payload={sids:t,visible:e}}}},62194:(e,t,i)=>{"use strict";i.d(t,{rf:()=>MeasurementSegmentCreatedMessage,u6:()=>MeasurementCreatedMessage,ff:()=>MeasurementCreationCancelledMessage,ty:()=>MeasurementTitleAddedMessage,mM:()=>MeasurementTitleChangedMessage,$Z:()=>MeasurementDeletedMessage,av:()=>MeasurementUpdatedMessage,$n:()=>MeasurementModeToggledMessage});var n=i(93528);class MeasurementSegmentCreatedMessage extends n.v{constructor(e){super(),this.data=e}}class MeasurementCreatedMessage extends n.v{constructor(e){super(),this.data=e}}class MeasurementCreationCancelledMessage extends n.v{}class MeasurementTitleAddedMessage extends n.v{constructor(e,t){super(),this.sid=e,this.text=t}}class MeasurementTitleChangedMessage extends n.v{constructor(e,t,i){super(),this.sid=e,this.oldText=t,this.newText=i}}class MeasurementDeletedMessage extends n.v{constructor(e){super(),this.data=e}}class MeasurementUpdatedMessage extends n.v{constructor(e){super(),this.data=e}}class MeasurementModeToggledMessage extends n.v{constructor(e,t,i){super(),this.opened=e,this.viewmode=t,this.count=i}}},11203:(e,t,i)=>{"use strict";i.d(t,{yV:()=>s,NZ:()=>o,E0:()=>r,ox:()=>a,X7:()=>l,xh:()=>c,Oq:()=>h,Hn:()=>d});var n=i(90384);const s=.01,o=.001,r=!0,a={highResThreshold:1081,desktopSize:192,desktopSizeHighRes:320,mobileSize:128},l={smoothness:.4,perspective:{fov:40,thresholdClose:1,thresholdFar:8,offsetClose:.25,offsetFar:.5,scale:1},ortho:{fov:5,thresholdClose:5,thresholdFar:20,offsetClose:15,offsetFar:30,scale:4}},c={desktop:n.l1.Edges,floorplan:n.l1.Axes,mobile:n.l1.Edges,alt:n.l1.Free,shift:n.l1.PlanarAxes,shiftAlt:n.l1.EdgesAndPlanarAxes,disabled:n.l1.Free},h={mobile:.15,desktop:.1},d={SCALE:.1,SCALE_NDC:.5,SCALE_ASPECT:.035,SCALE_DISTANCE:.025}},70781:(e,t,i)=>{"use strict";var n;i.d(t,{T:()=>n}),function(e){e[e.FloorplanOnly=0]="FloorplanOnly",e[e.ThreeD=1]="ThreeD"}(n||(n={}))},94052:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>MeasurementDataModule});var n=i(83032),s=i(54122),o=i(43894),r=i(17256),a=i(2212),l=i(70781),c=i(78909);class Measurement extends c.T{constructor(){super(...arguments),this.type=l.T.FloorplanOnly,this.sid="",this.visible=!1,this.version="3.2",this.created=new Date,this.modified=new Date,this.start_position=new a.Vector3,this.end_position=new a.Vector3,this.text="",this.group=-1,this.groupOrder=-1}copy(e){return this.type=e.type,this.sid=e.sid,this.text=e.text,this.visible=e.visible,this.created=e.created,this.modified=e.modified,this.floorId=e.floorId,this.start_position.copy(e.start_position),this.end_position.copy(e.end_position),this.group=e.group,this.groupOrder=e.groupOrder,this.roomId=e.roomId,this.commit(),this}}Measurement.RAYCASTER_GROUP="measurements";var h=i(70389),d=i(25799),u=i(79758),p=i(11618),m=i(90134);const g=new d.Z("measure->group"),f=(e,t)=>{if(t?(t.pointGroups.reset(),t.lookup.idToGroup={},t.lookup.groupToIds={},t.lookup.groupCount=0):t={pointGroups:new p.h((0,m.C)([])),lookup:{idToGroup:{},groupToIds:{},groupCount:0}},e.length>0){e.sort(((e,t)=>100*(e.group+1)+e.groupOrder-(100*(t.group+1)+t.groupOrder)));for(const i of e){const e=0===t.pointGroups.groupCount||i.group>=t.pointGroups.groupCount;v(i,t.pointGroups,e,t.lookup)}d.Z.level>=4&&(g.debug("sorce",e.slice().map((e=>`${e.sid},${e.group},${e.groupOrder}`))),g.debug(t.pointGroups.toString()))}return t},v=(e,t,i,n)=>{if(i){const{floorId:i,roomId:s,text:o,type:r,sid:a,visible:l,created:c,modified:h}=e,d={floorId:i,roomId:s,text:o,type:r,sid:a,visible:l,created:c,modified:h};t.startGroup(d),t.push(e.start_position),n.groupCount++}const s=t.groupCount-1;t.push(e.end_position),n.idToGroup[e.sid]=s,n.groupToIds[s]||(n.groupToIds[s]=[]),n.groupToIds[s].push(e.sid)};var y=i(41263),b=i(80034),w=i(20331),S=i(7943),E=i(15119),T=i(97620),M=i(46162),_=i(32020);const x=new d.Z("measurement-serialization"),A=e=>{if(!e)return null;const t={};try{if(e)for(const i of Object.keys(e)){const n=e[i];if(!n||!n.version||isNaN(Number.parseFloat(n.version))||Number.parseFloat(n.version)<3)continue;const s="type"in n?n.type:l.T.FloorplanOnly,o=new Measurement,r=void 0!==n.floor&&-1!==n.floor?String(n.floor):"",a=n.room?String(n.room):null;t[n.sid]=o.copy({start_position:(0,T.gj)(n.start_position),end_position:(0,T.gj)(n.end_position),type:s,sid:n.sid,text:n.text||"",visible:n.visible,floorId:r,created:(0,_.p)(n.created),modified:(0,_.p)(n.modified),version:o.version,roomId:a,group:void 0!==n.group?n.group:-1,groupOrder:void 0!==n.groupOrder?n.groupOrder:-1})}}catch(e){return x.debug("Error parsing measurement data;",e),null}return t},O=(e,t)=>{const i={},n=(0,M.p$)(e);(0,M.TS)(n,t);for(const e of Object.keys(n)){const t=n[e];if(!t)continue;i[t.sid]={type:t.type,start_position:(0,T.gj)(t.start_position),end_position:(0,T.gj)(t.end_position),sid:t.sid,text:t.text,visible:t.visible,created:(0,_.U)(t.created),modified:(0,_.U)(t.modified),version:"3.2",group:t.group,groupOrder:t.groupOrder};const s=parseInt(t.floorId,10);isNaN(s)||(i[t.sid].floor=s);const o=parseInt(t.roomId||"",10);isNaN(o)||(i[t.sid].room=o)}return i};function P(e){const{modelId:t,readonly:i}=e,n=e.baseUrl||"",s=e.queue||new w.gO,o=A,r=(e,t)=>{const i=(0,M.p$)(e);(0,M.TS)(i,t);const n={};for(const e of Object.keys(i)){const t=i[e];void 0!==a&&t.type!==a||(n[e]=t)}return O(n,{})};var a;const l=`${n}/api/v1/jsonstore/model/measurements/${t}`;if(i){const e=new b.gh({queue:s,path:l,deserialize:o});return new y.iY({publishStores:[e]})}const c=new b.MU({queue:s,path:l,batchUpdate:!0,deserialize:o,serialize:r}),h=`${n}/api/v1/jsonstore/model/workshopSession/${t}`,d=new E.Z({queue:s,path:h,cachedData:{data:null},deserialize:S.S.sessionObjectExtract(E.j.WS3_Measurements,o),serialize:r},E.j.WS3_Measurements);return new y.iY({publishStores:[c],legacyEditStore:d,editStoreKey:y.aw.MEASUREMENTS})}var C=i(71229),D=i(26983),I=i(67125),R=i(83083),L=i(60841),N=i(29675),k=i(62431);const B=new d.Z("MeasurementData");class MeasurementDataModule extends s.Y{constructor(){super(...arguments),this.name="measurements-data",this.idLookup=new Map,this.tryInferMeshIds=e=>{for(const t in e){const i=e[t];i.type!==l.T.ThreeD&&i.type!==l.T.FloorplanOnly||this.roomDataModule.inferMeshIdsFromPoint(i,i.start_position)}},this.tryInferGroups=e=>{const t=Object.keys(e);if(t.every((t=>void 0!==e[t].group&&-1!==e[t].group)))return;let i=0,n=0,s=0;const o={},r={},a=new Set,l=e=>`${e.x.toFixed(5)},${e.y.toFixed(5)},${e.z.toFixed(5)}`;for(const c of t){const t=e[c],h=l(t.start_position),d=l(t.end_position);a.has(h)?(n=o[h],s=e[r[h]].groupOrder+1):a.has(d)?(n=o[d],s=e[r[d]].groupOrder+1):(n=i++,s=0),a.has(h)||a.add(h),a.has(d)||a.add(d),o[h]=n,o[d]=n,r[h]=t.sid,r[d]=t.sid,t.group=n,t.groupOrder=s,t.commit()}}}async init(e,t){this.engine=t;const{readonly:i}=e,n=[this.tryInferMeshIds,this.tryInferGroups,this.updateIdLookup.bind(this)],[s,a,l,c,d]=await Promise.all([t.getModule(h.default),t.getModule(o.F),t.market.waitForData(k.af),t.market.waitForData(D.X),t.market.waitForData(N.pu)]);this.config=e,this.roomDataModule=s,this.measurementModeData=c,this.applicationData=d;const u=l.options.measurements&&l.options.measurements_saved;if(i&&!u)return;this.store=this.configureStorage(this.config);const p=await this.store.read()||{};if(n.forEach((e=>e(p))),this.measurementMap=(0,C.q)(p),!i){const e=new R.c(this.measurementMap,{aggregationType:L.E.NextFrame},t);this.store.addMonitor(e),this.bindings.push(d.onPropertyChanged("application",(()=>this.onApplicationChanged())),a.onSave((()=>this.save()),{dataType:r.g.MEASUREMENTS}),a.onRevert((()=>this.revert()),{dataType:r.g.MEASUREMENTS}))}this.onApplicationChanged()}configureStorage(e){const{modelId:t,baseUrl:i,queue:s,readonly:o}=e;B.info(`Loading Measurements from ${r.Xq.JSONSTORE}`);const a=P({modelId:t,readonly:o,baseUrl:i,queue:s});return new n.N(a,{dataType:r.g.MEASUREMENTS,modelId:t,readonly:o,engine:this.engine})}onApplicationChanged(){const e=this.measurementMap.values.map((e=>(new Measurement).copy(e)));this.engine.commandBinder.issueCommand(new u.d({points:f(e).pointGroups}))}async save(){this.applicationData.application===N.Mx.WORKSHOP&&this.updateMeasurementsFromGroups()}async revert(){this.store instanceof n.N&&await this.store.revert()}updateMeasurementsFromGroups(){const e=new Set(this.measurementMap.keys),t=new Set;for(const e of this.measurementModeData.groups())for(let i=0;i<e.count;i++){const n=e.get(i),s=e.has(i+1)&&e.get(i+1);if(!s)continue;const o=this.idLookup.get(e.info.sid);let r;r=o&&i in o?o[i]:0===i?e.info.sid:(0,I.f)(),t.add(r);const a=(new Measurement).copy({sid:r,start_position:n,end_position:s,floorId:e.info.floorId,roomId:e.info.roomId,group:e.index,groupOrder:i,text:e.info.text,visible:e.info.visible,version:"3.2",type:e.info.type,created:e.info.created,modified:e.info.modified});this.measurementMap.has(r)?this.measurementMap.get(r).copy(a):(B.debug(`Added Measurement ${r} in group ${e.index} (${i})`),this.measurementMap.set(r,a))}for(const i of e)t.has(i)||(B.debug(`Removed Measurement ${i}`),this.measurementMap.delete(i));this.updateIdLookup(this.measurementMap.values)}updateIdLookup(e){const t=Object.values(e).reduce(((e,t)=>(0===t.groupOrder&&(e[t.group]=t.sid),e)),{}),i=Object.values(e).sort(((e,t)=>e.group-t.group||e.groupOrder-t.groupOrder)),n=new Map;for(const e of i){const i=t[e.group];if(void 0===i){B.warn(`Group ${e.group} started with unexpected index ${e.groupOrder}`);continue}const s=n.get(i)||[];s.push(e.sid),n.set(i,s)}this.idLookup=n}onUpdate(e){}}},75638:(e,t,i)=>{"use strict";i.d(t,{b:()=>n});const n="features/measurements-nudge"},12153:(e,t,i)=>{"use strict";i.d(t,{Z:()=>ModelDataLoadedMessage});var n=i(93528);class ModelDataLoadedMessage extends n.v{constructor(e,t,i){super(),this.urls=e,this.sid=t,this.vrSupported=i}}},55580:(e,t,i)=>{"use strict";i.d(t,{T:()=>ModelData});var n=i(19413);class ModelData extends n.V{constructor(e){super(),this.name="model",this.model=e}}},22423:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ModelDataModule});var n=i(54122),s=i(30853),o=i(14567),r=i(17256),a=i(25290),l=i(20331),c=i(45805),h=i(25799),d=i(26149),u=i(26986);const p=new h.Z("modelurls");class UrlContainerV3{constructor(){this.version=3,this.baseUrl="",this.expires=0}validate(e){return e.templates&&e.catalog_file}update(e){if(!e.templates)throw new Error("No templates found.");return this.baseUrl=e.templates[0],e.expires?this.expires=1e3*e.expires:this.expires=Date.now()+c.Z.signedUrlDefaultExpireTime,Promise.resolve()}get(e){return this.baseUrl&&this.baseUrl.replace("{{filename}}",e)}}class UrlContainerNoop{constructor(){this.version=3,this.baseUrl="",this.expires=0}validate(e){return!0}update(e){return Promise.resolve()}get(e){if(!e.startsWith("http://")&&!e.startsWith("https://"))throw new Error("Tried getting relative model url with no signed urls configured.");return e}}class ModelUrls{constructor(e,t){this.api=e,this.endpoint=t,this.urlContainer=null,this.previousRefreshPromise=null,this.containerClasses=[UrlContainerNoop],t&&(this.containerClasses=[UrlContainerV3],this.endpoint=t+"?type=3")}needsRefresh(){const e=this.urlContainer?this.urlContainer.expires:Date.now();return Date.now()+c.Z.signedUrlRefreshBuffer>e}refresh(){if(!this.needsRefresh())return Promise.resolve();if(!this.previousRefreshPromise){p.debug("Refreshing urls...");const e=this;this.previousRefreshPromise=this._refresh().then((function(){p.debug("Refreshed"),e.previousRefreshPromise=null}),(function(t){p.error("Failed url refresh, urls might go stale soon",t),e.previousRefreshPromise=null}))}return this.previousRefreshPromise}async _refresh(e=!0){const t=this.endpoint?await this.api.get(this.endpoint,{responseType:"json",prefetchFrom:e?"files":void 0,auth:(0,d.PW)(this.endpoint),priority:l.ru.HIGHEST}):null;if(this.urlContainer&&this.urlContainer.validate(t))return this.urlContainer.update(t);for(const e of this.containerClasses){const i=new e;if(i.validate(t))return p.info("Using urls version "+i.version),this.urlContainer=i,this.urlContainer.update(t)}if(e)return this._refresh(!1);throw new Error("missing-urls")}async getSignedUrl(e){if(await this.refresh(),!this.urlContainer)throw new Error("Tried to use ModelUrls.get before urlContainer is established.");const t=this.urlContainer.get(e);if(!t)throw new Error(`Could not get signed URL for path ${e}`);return t}async getFile(e,t,i){const n=e.match(/^https?:/)?e:(0,u.bf)(await this.getSignedUrl(e),i);return this.api.get(n,t)}async getImage(e,t,i){const n=e.match(/^https?:/)?e:(0,u.bf)(await this.getSignedUrl(e),i);return this.api.getImage(n,t)}async getImageBitmap(e,t,i,n,s){const o=(0,u.bf)(await this.getSignedUrl(e),s);return this.api.getImageBitmap(o,t,i,n)}}var m,g=i(68519),f=i(55580),v=i(12153),y=i(52227),b=i(32400);!function(e){e.AVAILABLE="available",e.LOCKED="locked",e.UNAVAILABLE="unavailable"}(m||(m={}));var w=i(32020),S=i(51770);class Model{constructor(){this.lastPublished=null,this.editable=!1}refresh(e){for(const t in this.textures)e.textures[t]&&this.textures[t].refreshFrom(e.textures[t]);this.meshUrls.forEach(((t,i)=>{const n=e.meshUrls[i]&&e.meshUrls[i].url;t.url&&n&&t.url.refreshFrom(n)}))}}const E=new h.Z("mds-snapshot-serializer");class MdsModelDeserializer{deserialize(e){if(!e||!this.validate(e))return E.debug("Deserialized invalid model data from MDS",e),null;const t=e.publication||{},i=t.contact||{},n=e.options,s=e.address||{},o=new Model;o.sid=e.id,o.organizationId=e.organization||null,o.editable=void 0!==e.visibility,o.image=e.image?e.image.id:"",o.details={sid:e.id,name:e.name||"",presentedBy:t.presentedBy||"",summary:t.summary||"",formattedAddress:s.address||"",contact:{email:i.email||"",name:i.name||"",phone:i.phoneNumber||"",formattedPhone:i.phoneNumber||""},externalUrl:t.externalUrl||""},o.options={socialSharing:!!n.socialSharingEnabled,isPublic:!!t.published,isVR:!!n.vrEnabled},t.lastPublished&&(o.lastPublished=(0,w.p)(t.lastPublished,null));const r=e.assets.textures.filter((e=>"high"===e.quality))[0],a=e.assets.textures.filter((e=>"low"===e.quality))[0];o.textures={},r&&(o.textures.high=new g.n(r,(0,w.p)(r.validUntil,null))),a&&(o.textures.low=new g.n(a,(0,w.p)(a.validUntil,null)));const l=this.getDamFileUrls(e);if(!l)throw new Error(`No .dam file found for model ${e.id}`);return o.meshUrls=l,o}validate(e){return["id","assets","publication"].every((t=>t in e))}getDamFileUrls(e){return((0,S.qw)(e,"assets.meshes")||[]).reduce(((e,t)=>{if(t.status===m.AVAILABLE){const i={url:new g.n(t.url,(0,w.p)(t.validUntil,null)),suffix:t.resolution?`_${t.resolution}`:"",extension:t.format||""};"50k"===t.resolution?e.unshift(i):e.push(i)}return e}),[])}}class MdsModelStore extends b.u{constructor(){super(...arguments),this.serializer=new MdsModelDeserializer,this.prefetchKey="data.model"}async read(e){const t={modelId:this.getViewId()};return this.query(y.GetModelDetails,t,e).then((e=>{var t;return this.serializer.deserialize(null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.model)}))}async refresh(){return this.refreshPromise||(this.refreshPromise=this.read({fetchPolicy:"no-cache"}).finally((()=>{this.refreshPromise=void 0}))),this.refreshPromise}}var T=i(83852),M=i(64519),_=i(35135),x=i(80034);class MpWebModelDeserializer{deserialize(e){const t=new Model;return t.sid=e.sid,t.uuid=e.job.uuid,t.image=e.icon||"",t.organizationId=e.owner.group_sid,e.metainfo&&Array.isArray(e.metainfo.allowed_methods)&&(t.editable=e.metainfo.allowed_methods.includes("POST")),t.details={sid:e.sid,name:e.name,presentedBy:e.presented_by,summary:e.summary,formattedAddress:this.formatAddress(e.address),contact:{email:e.contact_email,name:e.contact_name,phone:e.contact_phone,formattedPhone:e.formatted_contact_phone},externalUrl:e.external_url},t.options={socialSharing:!!e.enable_social_sharing,isPublic:!!e.is_public,isVR:!!e.is_vr},t}formatAddress(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){return""}if(!(e&&(e.address_1||e.address_2||e.city||e.state||e.zip)))return"";const t=[];return e.address_1&&t.push(e.address_1),e.address_2&&t.push(e.address_2),e.city&&(t.length>0&&t.push(", "),t.push(e.city)),e.state&&(t.length>0&&t.push(", "),t.push(e.state)),e.zip&&(t.length>0&&t.push(", "),t.push(e.zip)),t.join("")}}class MpWebModelStore extends M.n{constructor(e){super(e),this.deserializer=new MpWebModelDeserializer}async read(){const{modelId:e}=this.config,t=`/api/v1/player/models/${e}/`;let i;return i=_.t.model?_.t.model:await this.request(x.w$.GET,t),this.deserializer.deserialize(i)}async refresh(){throw new T.n("Model refresh not implemented")}}const A=new h.Z("model-data");class ModelDataModule extends n.Y{constructor(){super(...arguments),this.name="model-data"}async init(e,t){this.engine=t;const{modelId:i,baseUrl:n}=e;this.store=this.getStore(e);const[s,l]=await Promise.all([this.store.read(),t.getModule(a.default)]);if(!s)throw Error("Could not fetch model data");(0,g.s)(s,(async()=>{const e=await this.store.refresh();s.refresh(e)})),this.model=s;const c=new f.T(this.model);t.market.register(this,f.T,c),this.registerSettings(c),t.market.waitForData(o.Q).then((e=>{s.lastPublished&&(e.lastPublished=s.lastPublished.getTime())}));const h=l.getApi(),d=e.storageProvider===r.Xq.JSONSTORE?`${n}/api/player/models/${i}/files`:null;this.signedUrls=new ModelUrls(h,d),this.signedUrls.meshUrls=this.model.meshUrls,t.broadcast(new v.Z(this.signedUrls,this.model.sid,this.model.vrSupported))}async registerSettings(e){const t=await this.engine.getModule(s.default),i=e.model.options||{};t.registerSetting("ModelData","enable_social_sharing",i.socialSharing),t.registerSetting("ModelData","is_public",i.isPublic),t.registerSetting("ModelData","is_vr",i.isVR)}getSignedUrls(){return this.signedUrls}getStore(e){if(this.store)return this.store;const{modelId:t,baseUrl:i,queue:n}=e,s=e.storageProvider||r.Xq.JSONSTORE,o=!("readonly"in e)||!!e.readonly;return A.info(`Loading model details from ${s}`),s===r.Xq.MDS?new MdsModelStore({readonly:o,baseUrl:i}):new MpWebModelStore({readonly:!0,modelId:t,baseUrl:i,queue:n})}}},56730:(e,t,i)=>{"use strict";i.d(t,{n:()=>MeshPreviewSetPositonCommand});var n=i(99681);class MeshPreviewSetPositonCommand extends n.m{constructor(e,t,i){super(),this.id="MESH_PREVIEW_POSITION",this.payload={enabled:e,previewCirclePosition:t,size:i}}}},63073:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ModelMeshPreview});var n=i(54122),s=i(85197),o=i(56730);class ModelMeshPreview extends n.Y{constructor(){super(...arguments),this.name="model-mesh-preview",this.defaultSize=.3}async init(e,t){this.engine=t,this.bindings.push(t.commandBinder.addBinding(o.n,this.update.bind(this))),this.modelMeshModule=await t.getModule(s.default)}async update(e){this.modelMeshModule||(this.modelMeshModule=await this.engine.getModule(s.default));const t=e.enabled&&e.previewCirclePosition?e.previewCirclePosition:null,i=e.size?e.size:this.defaultSize;for(const e of this.modelMeshModule.mesh.chunks)e.setMeshPreviewSphere(t,i)}}},72760:(e,t,i)=>{"use strict";i.d(t,{z:()=>Chunk});var n=i(2212),s=i(97982);class ChunkMaterial extends n.RawShaderMaterial{constructor(e,t,i){const n={};for(const e of t)n[e]=!0;super({extensions:{derivatives:!0},fragmentShader:s.Z.modelChunk.fragmentShader,vertexShader:s.Z.modelChunk.vertexShader,uniforms:i,name:e,defines:n}),this.capabilities=t}}var o=i(73902),r=i(63213),a=i(62367),l=i(42481);let c,h=1;try{c=(0,r.k7)(0,0)}catch(e){}const d=[{key:o.h.PanoTextureTransition,enabled:function(e){return e.progress.value>0&&e.progress.value<1&&e.pano0Map.value!==e.pano1Map.value},dependsOn:[o.h.PanoTexture]},{key:o.h.PanoTexture,enabled:function(e){return e.panoOpacity.value>0},dependsOn:[]},{key:o.h.ColorOverlay,enabled:function(e){return null!==e.colorOverlay.value},dependsOn:[]},{key:o.h.MeshPreviewSphere,enabled:function(e){return null!==e.meshPreviewCenter.value},dependsOn:[o.h.MeshTexture]},{key:o.h.MeshTexture,enabled:function(e){return e.meshOpacity.value>0&&e.map.value},dependsOn:[]},{key:o.h.Wireframe,enabled:function(e){return!1},dependsOn:[]},{key:o.h.FlatShading,enabled:function(e){return!1},dependsOn:[]},{key:o.h.PanoOverlay,enabled:function(e){return!!e.overlay0Map.value},dependsOn:[o.h.PanoTexture]},{key:o.h.PanoOverlayTransition,enabled:function(e){return!!(e.progress.value>0&&e.progress.value<1&&e.overlay0Map.value&&e.overlay1Map.value&&e.overlay0Map.value!==e.overlay1Map.value)},dependsOn:[o.h.PanoOverlay,o.h.PanoTexture,o.h.PanoTextureTransition]}];class Chunk{constructor(e,t,i,o=""){this.meshGroup=e,this.meshSubgroup=t,this.geometry=i,this.textureName=o,this.id=h++,this.renderingMode=l.S.Standard,this.chunkMaterials={},this.modeMaterials={},this.capabilityOverrides={},this.uniformCache=this.getUniformDefaults(),this.setProjectedPano=(()=>{const e=new n.Matrix4,t=new n.Matrix4,i=new n.Quaternion;return(n,s,o,r)=>{let a=1===n?"pano1Map":"pano0Map";this.setMaterialsUniform(a,r||c),s&&(a=1===n?"pano1Position":"pano0Position",this.setMaterialsUniform(a,s)),o&&s&&(a=1===n?"pano1Matrix":"pano0Matrix",e.makeRotationFromQuaternion(i.copy(o).invert()),t.makeScale(-1,1,1),this.setMaterialsUniform(`${a}1`,e),this.setMaterialsUniform(`${a}2`,t))}})(),this.modeMaterials[l.S.Standard]=this.getChunkMaterial(this.getCapabilities()),this._material=this.modeMaterials[l.S.Standard];const r=n.UniformsUtils.clone(s.Z.depth.uniforms);this.modeMaterials[l.S.Depth]=new n.RawShaderMaterial({fragmentShader:s.Z.depth.fragmentShader,vertexShader:s.Z.depth.vertexShader,uniforms:r,side:n.FrontSide,name:"materialDepth"});const a=n.UniformsUtils.clone(s.Z.modelOutside.uniforms);a.opacity.value=.2,this.modeMaterials[l.S.Transparent]=new n.RawShaderMaterial({fragmentShader:s.Z.modelOutside.fragmentShader,vertexShader:s.Z.modelOutside.vertexShader,uniforms:a,side:n.FrontSide,transparent:!0,name:"materialTransparent"});const d=n.UniformsUtils.clone(s.Z.modelOutside.uniforms);d.opacity.value=.5,d.colorOverlay.value.set(1,1,1,1),this.modeMaterials[l.S.Wireframe]=new n.RawShaderMaterial({fragmentShader:s.Z.modelOutside.fragmentShader,vertexShader:s.Z.modelOutside.vertexShader,uniforms:d,side:n.FrontSide,transparent:!0,wireframe:!0,name:"materialWireframe"})}getUniformDefaults(){const e={};for(const t in s.Z.modelChunk.uniforms){const i=n.UniformsUtils.clone(s.Z.modelChunk.uniforms[t]);for(const t in i)e[t]=i[t]}return e}set material(e){this._material!==e&&this.onMaterialUpdate&&this.onMaterialUpdate(e),this._material=e}get material(){return this._material}setMeshTexture(e){this.setMaterialsUniform("map",e)}setColorOverlay(e){this.setMaterialsUniform("colorOverlay",e)}setMeshTextureOpacity(e){this.setMaterialsUniform("meshOpacity",e),this.setMaterialsUniform("panoOpacity",1-e)}setProgress(e){this.setMaterialsUniform("progress",e)}setOpacity(e){this.setMaterialsUniform("opacity",e)}setTime(e){this.renderingMode===l.S.Wireframe&&this.setMaterialsUniform("time",e)}setTransparentDiscard(e){this.setMaterialsUniform("transparentDiscardDist",e)}setMeshPreviewSphere(e,t=.3){this.setMaterialsUniform("meshPreviewCenter",e),this.setMaterialsUniform("meshPreviewSize",t)}setWireframe(e){e&&(this.geometry.getIndex()&&this.geometry.copy(this.geometry.toNonIndexed()),(0,r.ko)(this.geometry)),this.overrideCapability(o.h.Wireframe,e)}setFlatShading(e){e&&this.geometry.computeVertexNormals(),this.overrideCapability(o.h.FlatShading,e)}getCapabilities(){const e=new Set;for(const t in this.capabilityOverrides)this.capabilityOverrides[t]&&e.add(t);for(const t of d)if(!e.has(t.key)&&t.enabled(this.uniformCache)){e.add(t.key);for(const i of t.dependsOn)e.add(i)}return e}overrideCapability(e,t){this.capabilityOverrides[e]=t,this.updateMaterialCapabilities()}updateMaterialCapabilities(){const e=this.getCapabilities(),t=this.modeMaterials[l.S.Standard];if((0,a.TH)(t.capabilities,e))return;const i=this.getChunkMaterial(e);i.side=t.side,i.transparent=t.transparent,i.depthWrite=t.depthWrite,this.modeMaterials[l.S.Standard]=i,this.renderingMode===l.S.Standard&&(this.material=i)}getChunkMaterial(e){let t="chunkMaterial_";for(const i of d)t+=e.has(i.key)?"1":"0";return this.chunkMaterials[t]||(this.chunkMaterials[t]=new ChunkMaterial(t,e,this.getUniformsForCapabilities(e))),this.chunkMaterials[t]}getUniformsForCapabilities(e){const t={};for(const i of e){const e=s.Z.modelChunk.uniforms[i];for(const i in e)t[i]=this.uniformCache[i]}return t}setMaterialsUniform(e,t){if(!(e in this.uniformCache))throw new Error(`Uniform ${e} does not exist in Chunk`);const i=this.uniformCache[e];i.value!==t&&(t&&(t.isVector3||t.isVector4||t.isMatrix3||t.isMatrix4||t.isColor)?null===i.value?i.value=t.clone():i.value.copy(t):i.value=t,this.updateMaterialCapabilities())}setRenderingMode(e){this.renderingMode=e,this.material=this.modeMaterials[e]}setSide(e){for(const t in this.chunkMaterials)this.chunkMaterials[t].side=e}forEachMaterial(e){for(const t in this.chunkMaterials)e(this.chunkMaterials[t])}setOverlayPano(e,t,i){const s=`overlay${e}`;if(t){const e=(new n.Matrix4).makeRotationFromQuaternion(t);this.setMaterialsUniform(s+"Matrix",e)}this.setMaterialsUniform(s+"Map",i||c)}}},42481:(e,t,i)=>{"use strict";var n;i.d(t,{S:()=>n}),function(e){e[e.Standard=0]="Standard",e[e.Depth=1]="Depth",e[e.Transparent=2]="Transparent",e[e.Wireframe=3]="Wireframe"}(n||(n={}))},9163:(e,t,i)=>{"use strict";i.d(t,{T:()=>FallbackMesh});var n=i(2212),s=i(20599),o=i(72760);const r=new n.Vector3(0,0,0),a=new n.Vector3(100,100,100),l=new n.Vector3,c=new n.Vector3,h=new n.Box3;class FallbackMesh extends n.Mesh{constructor(){super(),this.bounds=new n.Box3,this.geometry=new n.BoxBufferGeometry(1,1,1),this.geometry.computeBoundingBox(),this.geometry.computeBoundingSphere(),this.chunk=new o.z(-1,-1,this.geometry),this.chunk.onMaterialUpdate=e=>{this.material=e,this.material.side=n.BackSide,this.material.transparent=!0,this.material.depthWrite=!1},this.chunk.onMaterialUpdate(this.chunk.material),this.name="FallbackMesh",this.renderOrder=s.z.boundingSkybox,this.setFromCenterAndSize(r,a)}setBounds(e){if(this.bounds.equals(e))return;this.bounds.copy(e);const t=e.getSize(l);this.position.copy(e.getCenter(c)),this.scale.set(t.x,t.y,t.z),this.updateMatrixWorld(!0)}setFromCenterAndSize(e,t=a){this.setBounds(h.setFromCenterAndSize(e,t))}}},61718:(e,t,i)=>{"use strict";i.d(t,{S:()=>ModelColliderTarget});var n=i(2212);class ModelColliderTarget extends n.Mesh{constructor(){super(...arguments),this.raycastEnabled=!0}}},93781:(e,t,i)=>{"use strict";i.d(t,{g:()=>RoomMesh});var n=i(2212),s=i(2779),o=i(46266),r=i(61718),a=i(20599),l=i(15782);class RoomMesh extends r.S{constructor(e,t,i=s.o.ALL){super(),this.material=[],this._opacity=1,this._chunks=[],this._fadeDist=0,this.size=new n.Vector3,this.center=new n.Vector3,this.built=!1,this.layers.mask=i.mask,this.name=`RoomMesh:${e}-${t}`,this.meshGroup=e,this.meshSubgroup=t,this.floorId=String(e),this.roomId=String(t),this.renderOrder=a.z.default}dispose(){this.dispose()}reset(){this._chunks.length=0,this.geometry.dispose(),this.built=!1}addChunk(e){-1===this._chunks.indexOf(e)&&this._chunks.push(e)}getChunk(e){return this._chunks[e]}build(){if(this.built)throw new Error("build() should only be called once");if(!this._chunks.length)return;const e=(0,o.q)(this._chunks.map((e=>e.geometry)));e.clearGroups();let t=0;this._chunks.forEach(((i,n)=>{i.geometry&&i.geometry.index&&(e.addGroup(t,i.geometry.index.count,n),t+=i.geometry.index.count,i.geometry.dispose(),i.geometry=e,i.onMaterialUpdate=e=>{this.material[n]=e})})),this.geometry=e,this.geometry.computeBoundingBox(),this.geometry.computeBoundingSphere(),this.material=this._chunks.map((e=>e.material)),this.size=this.boundingBox.getSize(this.size),this.center=this.boundingBox.getCenter(this.center),this.built=!0}get boundingBox(){return(0,o.A)(this.geometry)}set opacity(e){if(e!==this.opacity){this._opacity=e,this.raycastEnabled=e>l.xx.FADE_CLICKABLE_THRESHOLD,this.renderOrder=e<l.xx.FADE_OPAQUE?a.z.ghostFloor:a.z.default;for(const t of this.chunks)t.material.transparent=e<l.xx.FADE_OPAQUE,t.material.depthWrite=e>l.xx.FADE_IN_VALUE+l.xx.FADE_IN_HOVER_BOOST_VALUE,t.setOpacity(e)}}get opacity(){return this._opacity}get transparentFadeDist(){return this._fadeDist}set transparentFadeDist(e){if(e!==this.transparentFadeDist){this._fadeDist=e;for(const t of this.chunks)t.setTransparentDiscard(e)}}get chunks(){return this._chunks}}},23941:(e,t,i)=>{"use strict";i.d(t,{U:()=>SetChunkRenderModeCommand});var n=i(99681),s=i(42481);class SetChunkRenderModeCommand extends n.m{constructor(e){super(),this.id="SET_CHUNK_RENDER_MODE",this.payload={mode:e}}}SetChunkRenderModeCommand.modes=s.S},97507:(e,t,i)=>{"use strict";i.d(t,{g:()=>SetMeshOpacityCommand});var n=i(99681);class SetMeshOpacityCommand extends n.m{constructor(e){super(),this.id="SET_MESH_OPACITY",this.payload={value:e}}}},67890:(e,t,i)=>{"use strict";i.d(t,{u:()=>SetMeshOverlayCommand});var n,s=i(99681);!function(e){e.all="all",e.byFloorId="byFloorId",e.byRoomId="byRoomId"}(n||(n={}));class SetMeshOverlayCommand extends s.m{constructor(e,t,i){super(),this.id="SET_MESH_OVERLAY_COLOR",this.payload={selectBy:e,color:t,id:i}}}SetMeshOverlayCommand.select=n},83299:(e,t,i)=>{"use strict";i.d(t,{M:()=>SetPanoOverlayCommand});var n=i(99681);class SetPanoOverlayCommand extends n.m{constructor(e,t,i){super(),this.id="SET_PANO_OVERLAY",this.payload={sweepId:e,texture:t,quaternion:i}}}},44133:(e,t,i)=>{"use strict";i.d(t,{I:()=>ToggleMeshOverlayColorCommand});var n=i(99681);class ToggleMeshOverlayColorCommand extends n.m{constructor(e){super(),this.id="TOGGLE_MESH_OVERLAY_COLOR",this.payload={enabled:e}}}},27871:(e,t,i)=>{"use strict";i.d(t,{_:()=>MeshData});var n=i(19413),s=i(2212),o=i(290);class MeshData extends n.V{constructor(e,t){super(),this.name="mesh-data",this.bounds=new s.Box3,this.center=new s.Vector3,this.size=new s.Vector3,this.opacity=new o.z(e),this.bounds.copy(t),this.bounds.getCenter(this.center),this.bounds.getSize(this.size)}copy(e){this.opacity.copy(e.opacity),this.bounds.copy(e.bounds),this.bounds.getCenter(this.center),this.bounds.getSize(this.size)}}},24975:(e,t,i)=>{"use strict";i.d(t,{T0:()=>o,Pv:()=>r,Nr:()=>a});var n=i(61718);const s=e=>e instanceof n.S,o=e=>s(e),r=e=>s(e)&&e.raycastEnabled&&e.visible,a=e=>{let t=e.visible;t&&e.traverseAncestors((e=>{t&&(t=e.visible)}));return!o(e)&&t||r(e)}},85197:(e,t,i)=>{"use strict";i.r(t),i.d(t,{TextureLOD:()=>me,default:()=>ModelMeshModule});var n=i(54122),s=i(29675),o=i(27829),r=i(89155),a=i(30963),l=i(27468),c=i(51418),h=i(22423),d=i(55580),u=i(62513),p=i(73354),m=i(47678),g=i(46101),f=i(56022),v=i(77956),y=i(57369),b=i(7922),w=i(85381),S=i(53339),E=i(48840),T=i(39869),M=i(12775),_=i(71208),x=i(50101),A=i(1799),O=i(2212),P=i(97507),C=i(44133),D=i(27871),I=i(15782);class MeshOverlayColor{constructor(e){this.getChunks=e,this.enabled=null,this.toggleEnabled=e=>{if(e!==this.enabled){for(const t of this.getChunks())t.setColorOverlay(e?I.Y7:null);this.enabled=e}}}}var R=i(20640);class ModelCollider{constructor(e,t,i){this.addToRaycasting=e,this.removeFromRaycasting=t,this.mesh=i,this.clear()}dispose(){this.clear()}activate(e){const t={};for(const e of Object.keys(this.groupNames))for(const i of this.groupColliders[e])t[i.id]=!0,this.addToRaycasting(i,!0);for(const e of this.allColliders)t[e.id]||this.addToRaycasting(e,!0)}deactivate(e){for(const e of this.allColliders)this.removeFromRaycasting(e)}init(){for(const e of this.mesh.floorMeshes){let t=this.groupColliders[e.meshGroup];t||(this.groupColliders[e.meshGroup]=t=[]);for(const i of e.roomMeshes)t.push(i),this.allColliders.push(i)}}setSide(e){for(const t of this.allColliders)this.setSideRecursively(t,e)}setSideRecursively(e,t){e instanceof O.Mesh&&e.material&&e.material instanceof O.MeshBasicMaterial&&(e.material.side=t);for(const i of e.children)this.setSideRecursively(i,t)}getReadonlyColliderList(){return this.allColliders}getReadonlyColliderListForGroup(e){return this.groupColliders[e]}getGroupName(e){return this.groupNames[e]}render(){}setVisible(e){if(this._visible!==e){this._visible=e;for(const t of this.allColliders)t.visible=e}}clear(){this.allColliders=[],this.groupColliders={},this.groupNames={}}}var L=i(3614),N=i(25799),k=i(72760),B=i(63213);const F=new N.Z("dam-loader");class DamLoader{constructor(){this.decoder=i(16801).uO}async load(e,t,i){F.time("download");const n=await t.getFile(e,{responseType:"arraybuffer",onProgress:i});return F.timeEnd("download"),this.parse(n)}parse(e){F.time("parse proto");const t=this.decoder.read(new L(e));F.timeEnd("parse proto"),F.time("convert to webgl");const i=this.convertProtobufToSceneObject(t);return F.timeEnd("convert to webgl"),i}convertProtobufToSceneObject(e){if(0===e.chunk.length)return F.warn("No chunks in damfile..."),[];const t=new O.Matrix4;return t.set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),e.chunk.map((function(e){const i=new O.BufferGeometry;i.setAttribute("position",new O.BufferAttribute(new Float32Array(e.vertices.xyz,0,3),3)),e.vertices.uv.length>0&&i.setAttribute("uv",new O.BufferAttribute(new Float32Array(e.vertices.uv,0,2),2)),i.setIndex(new O.BufferAttribute(new Uint32Array(e.faces.faces,0,1),1)),i.applyMatrix4(t),i.computeBoundingBox();const{group:n,subgroup:s}=(0,B.xc)(e.chunk_name);return new k.z(n,s,i,e.material_name)}))}}var U=i(86515),V=i(2779),H=i(17617);class MeshCreationException extends H.y{constructor(e){super(e),this.name="MeshCreationException"}}var G=i(93781);class FloorMesh extends O.Object3D{constructor(e,t=V.o.ALL){super(),this.renderLayer=t,this.roomMeshes=new U.Z((e=>e.meshSubgroup)),this.boundingBox=new O.Box3,this.size=new O.Vector3,this.center=new O.Vector3,this._chunks=[],this.built=!1,this.name=`FloorMesh:${e}`,this.meshGroup=e,this.floorId=void 0}dispose(){this.reset(),this.roomMeshes.clear()}reset(){for(const e of this.roomMeshes)e.dispose(),this.remove(e);this._chunks.length=0,this.built=!1}addChunk(e){const t=this.getOrCreateRoomMesh(e.meshSubgroup);this._chunks.push(e),t.addChunk(e)}build(){if(this.built)throw new Error("build() should only be called once");this.boundingBox.makeEmpty();for(const e of this.roomMeshes)this.add(e),this.boundingBox.union(e.boundingBox);this.center=this.boundingBox.getCenter(this.center),this.size=this.boundingBox.getSize(this.size),this.built=!0}get chunks(){return this._chunks}getOrCreateRoomMesh(e){let t=this.roomMeshes.get(e);return t||(t=new G.g(this.meshGroup,e,this.renderLayer),this.roomMeshes.add(t),this.add(t)),t}}const z=new N.Z("mesh");class ModelMesh extends O.Object3D{constructor(e,t,i=V.o.ALL){super(),this.renderLayer=i,this.floorMeshes=new U.Z((e=>e.meshGroup)),this.boundingBox=new O.Box3,this.size=new O.Vector3,this.center=new O.Vector3,this.built=!1,this._chunks=[],this.uuid=e,this.name=`ModelMesh:${e}`,this.signedUrls=t,this.layers.mask=i.mask}dispose(){this.floorMeshes.mapElements((e=>{e.dispose(),this.remove(e)})),this.floorMeshes.clear(),this._chunks.length=0,this.built=!1}reset(){this.floorMeshes.mapElements((e=>{e.reset(),this.remove(e)})),this._chunks.length=0,this.built=!1}async load(e={}){let t=e.chunks?e.chunks:await class ModelLoader{static async load(e,t,i,n=0){const s=new DamLoader;I.ZP.highQualityDam&&0===n&&(n=1);const o=(t.meshUrls?t.meshUrls:[{suffix:"_50k",extension:"dam"},{suffix:"",extension:"dam"}])[n];if(!o)return Promise.reject("No suitable model file found...");const{url:r,suffix:a,extension:l}=o,c=r?await r.get():`${e}${a}.${l}`;return s.load(c,t,i).catch((()=>this.load(e,t,i,++n)))}}.load(this.uuid,this.signedUrls,e.onProgress).catch((e=>{z.error(e);const t=e instanceof Error?e.message:"Failed to load model mesh";throw new MeshCreationException(t)}));if(0===t.length){z.warn("No geometry found for model, loading faux geometry, disabling outside view-mode");const e=new O.PlaneBufferGeometry(5,5,1,1);e.rotateX(-Math.PI/2),e.computeBoundingBox();const i=new k.z(0,0,e);i.forEachMaterial((e=>e.visible=!1)),t=[i]}return t.forEach(((e,t)=>{this.addChunk(e)})),this.build(),this}addChunk(e){const t=this.getOrCreateFloorMesh(e.meshGroup);this._chunks.push(e),t.addChunk(e)}build(){if(this.built)throw new Error("build() should only be called once");let e=0,t=0;for(const i of this.floorMeshes){this.add(i);for(const t of i.roomMeshes)t.build(),e++;i.build(),t++}z.debug(`FloorMeshes: ${t} RoomMeshes: ${e} Chunks: ${this._chunks.length}`),this.boundingBox.makeEmpty();for(const e of this.floorMeshes)this.boundingBox.union(e.boundingBox);this.size=this.boundingBox.getSize(this.size),this.center=this.boundingBox.getCenter(this.center),this.built=!0}get roomMeshes(){const e=new Set;for(const t of this.floorMeshes)for(const i of t.roomMeshes)e.add(i);return e}get chunks(){return this._chunks}getOrCreateFloorMesh(e){let t=this.floorMeshes.get(e);return t||(t=new FloorMesh(e,this.renderLayer),this.floorMeshes.add(t),this.add(t)),t}}var j=i(62367),W=i(69281),Z=i(39936),q=i(30853),K=i(42481),Y=i(73902),$=i(9163),X=i(67890),Q=i(23941),J=i(83299),ee=i(97982);const te=new N.Z("modelrenderer");class ModelRenderer{constructor(e,t,i,n,s,o,r,a){this.scene=e,this.mesh=t,this.modelCollider=i,this.panoRenderer=n,this.meshData=s,this.sweepData=o,this.applicationData=r,this.renderOptions=a,this.chunkRenderingModeOverride=null,this.lastChunkRenderingModeOverride=null,this.fallbackMesh=new $.T,this.overlayTextures=[{sweepId:void 0,texture:void 0,renderTarget:new O.WebGLCubeRenderTarget(2048,{format:O.RGBAFormat}),quaternion:new O.Quaternion},{sweepId:void 0,texture:void 0,renderTarget:new O.WebGLCubeRenderTarget(2048,{format:O.RGBAFormat}),quaternion:new O.Quaternion}],this.overlayEnabled=!1,this.bindings=[],this.updateFallbackMesh=(()=>{const e=new O.Box3;return()=>{if(this.sweepData.currentAlignedSweepObject&&this.viewmodeData.currentMode===_.Ey.Panorama){const t=e.copy(this.meshData.bounds).expandByScalar(.2);this.fallbackMesh.setBounds(t)}else this.cameraData&&this.fallbackMesh.setFromCenterAndSize(this.cameraData.pose.position)}})(),this.debugColorizeChunks=(()=>{let e=!1;return(t,i)=>{const n=new O.Vector4(1,1,1,0);e=!e,(e=>{for(const t of this.mesh.floorMeshes)for(const s of t.roomMeshes){let t=e?(0,W.G1)(.5):n;for(const o of s.chunks)i&&(t=e?(0,W.G1)(.5):n),o.setColorOverlay(t)}})(t||e)}})()}init(){}dispose(){this.mesh.dispose()}async activate(e){this.engine=e,[this.viewmodeData,this.settings,this.cameraData,this.renderer]=await Promise.all([e.market.waitForData(M.O),e.market.waitForData(Z.e),e.market.waitForData(r.M_),e.getModule(x.default)]),this.scene.add(this.mesh),this.scene.add(this.fallbackMesh),this.fallbackMesh.layers.mask=this.mesh.layers.mask,this.updateRenderState(),this.bindings.push(this.viewmodeData.onChanged(this.updateRenderState.bind(this)),this.sweepData.onChanged(this.updateRenderState.bind(this)),this.settings.onChanged(this.updateRenderState.bind(this)),e.commandBinder.addBinding(X.u,this.onMeshOverlayCommand.bind(this)),e.commandBinder.addBinding(Q.U,this.onSetChunkRenderStateCommand.bind(this)),e.commandBinder.addBinding(J.M,this.onPanoOverlayCommand.bind(this))),this.renderOptions.colorizeRooms&&this.debugColorizeChunks(!0),this.renderOptions.colorizeChunks&&this.debugColorizeChunks(!0,!0),this.renderOptions.wireframe&&this.toggleWireframe(!0),this.setupDebugMenu(e)}deactivate(){for(const e of this.bindings)e.cancel();this.bindings=[],this.scene.remove(this.mesh),this.scene.remove(this.fallbackMesh),this.currentSweepId&&this.panoRenderer.freeTexture(this.currentSweepId),this.currentSweepId=null,this.targetSweepId=null}updateSweepRenderTarget(e,t,i,n){const s=this.panoRenderer.useTexture(t);if(s)for(const t of this.allChunks())t.setProjectedPano(e,i,n,s)}*allChunks(){yield*this.mesh.chunks,yield this.fallbackMesh.chunk}updateExistingTexture(e,t,i,n){for(const s of this.allChunks())e===this.currentSweepId&&s.setProjectedPano(0,i,n,t),e===this.targetSweepId&&s.setProjectedPano(1,i,n,t)}render(){}beforeRender(){const e=!this.displayingUnaligned(this.sweepData,this.viewmodeData);this.mesh.visible=e,this.modelCollider.setVisible(e);for(const e of this.mesh.chunks)e.setMeshTextureOpacity(this.meshData.opacity.value),e.setProgress(this.sweepData.transition.progress.value);const t=(0,A.w2)(this.meshData.opacity.value,0,1,1);this.fallbackMesh.chunk.setMeshTextureOpacity(t),this.fallbackMesh.chunk.setProgress(this.sweepData.transition.progress.value),this.updateFallbackMesh()}displayingUnaligned(e,t){return t.closestMode===_.Ey.Panorama&&!!e.currentSweep&&e.isSweepUnaligned(e.currentSweep)}updateChunkMaterialMode(e,t){const i=t||K.S.Standard,n=e?O.DoubleSide:O.FrontSide;for(const e of this.mesh.chunks)e.setRenderingMode(i),e.setSide(n)}updateChunkedColliderSide(e){const t=e===_.Ey.Panorama?O.DoubleSide:O.FrontSide;this.modelCollider.setSide(t)}updateRenderState(){if(this.mesh.visible=this.settings.tryGetProperty(I.AN,!0),this.viewmodeData.currentMode!==this.lastViewmode||this.lastChunkRenderingModeOverride!==this.chunkRenderingModeOverride){this.lastChunkRenderingModeOverride=this.chunkRenderingModeOverride;const e=this.viewmodeData.currentMode===_.Ey.Panorama;this.updateChunkMaterialMode(e,this.chunkRenderingModeOverride),this.viewmodeData.currentMode&&this.updateChunkedColliderSide(this.viewmodeData.currentMode),this.lastViewmode=this.viewmodeData.currentMode}if(this.viewmodeData.transition.active&&this.viewmodeData.transition.to===_.Ey.Panorama||this.viewmodeData.currentMode===_.Ey.Panorama){const e=this.sweepData.currentSweep,t=this.sweepData.transition,i=t.active&&(this.applicationData.phase===s.nh.PLAYING||this.applicationData.phase===s.nh.STARTING),n=i?t.from:e,o=i?t.to:e,r=this.currentSweepId,a=this.targetSweepId;this.currentSweepId=n||null,this.targetSweepId=o||null,this.handleSweepChange(0,r,this.currentSweepId),this.handleSweepChange(1,a,this.targetSweepId)}if(this.overlayEnabled){const e=this.overlayTextures.find((e=>e.sweepId===this.currentSweepId)),t=this.overlayTextures.find((e=>e.sweepId===this.targetSweepId));for(const i of this.allChunks())i.setOverlayPano(0,e?e.quaternion:void 0,e?e.texture:void 0),i.setOverlayPano(1,t?t.quaternion:void 0,t?t.texture:void 0)}}handleSweepChange(e,t,i){if(t!==i&&(t&&this.panoRenderer.freeTexture(t),i)){const t=this.sweepData.getSweep(i);this.updateSweepRenderTarget(e,i,t.position,t.rotation)}}async onPanoOverlayCommand(e){this.overlayEnabled=!0;const t=t=>{const i=t.renderTarget;t.renderTarget.width=e.texture.image.width,t.renderTarget.height=e.texture.image.height,t.sweepId=e.sweepId,t.texture=i.texture,t.quaternion=e.quaternion,this.renderer.cwfRenderer.copyCubemap(e.texture,t.renderTarget)};let i=!1;for(const n of this.overlayTextures)i||n.sweepId!==e.sweepId||(t(n),i=!0);for(const e of this.overlayTextures)i||e.sweepId===this.targetSweepId||e.sweepId===this.currentSweepId||(t(e),i=!0);this.updateRenderState()}async onMeshOverlayCommand(e){let t;switch(e.selectBy){case X.u.select.all:t=()=>!0;break;case X.u.select.byFloorId:t=t=>t.floorId===e.id;break;case X.u.select.byRoomId:t=t=>t.roomId===e.id}if(!t)return;const i=e.color?new O.Vector4(e.color.x,e.color.y,e.color.z,e.color.w):null;for(const e of this.mesh.roomMeshes)if(t(e))for(const t of e.chunks)t.setColorOverlay(i)}async onSetChunkRenderStateCommand(e){this.chunkRenderingModeOverride=e.mode,this.updateRenderState()}toggleWireframe(e){for(const t of this.mesh.chunks)t.setWireframe(e)}async setupDebugMenu(e){const[t,i]=await Promise.all([e.market.waitForData(Z.e),e.getModule(q.default)]);i.registerButton("Mesh","Toggle visible",(()=>{for(const e of this.mesh.floorMeshes)e.visible=!e.visible})),i.registerButton("Mesh","Toggle depth",(()=>{const t=this.chunkRenderingModeOverride?null:K.S.Depth;e.commandBinder.issueCommand(new Q.U(t))})),i.registerButton("Mesh","Toggle transparent",(()=>{const t=this.chunkRenderingModeOverride?null:K.S.Transparent;e.commandBinder.issueCommand(new Q.U(t))})),i.registerButton("Mesh","Toggle wireframe",(()=>{const t=this.chunkRenderingModeOverride?null:K.S.Wireframe;e.commandBinder.issueCommand(new Q.U(t))}));let n=!1;i.registerButton("Mesh","Toggle flat shading",(()=>{n=!n;for(const e of this.mesh.chunks)e.setFlatShading(n)})),i.registerButton("Mesh","Cycle all chunk materials",(()=>{this.debugCycleChunkMaterials()})),i.registerButton("Mesh","Highlight Rooms",this.debugColorizeChunks),i.registerButton("Mesh","Highlight Chunks",(()=>this.debugColorizeChunks(!0,!0)));const s=(e,n,s,o,r)=>{i.registerSetting(e,n,s,!0,q.SettingPersistence.NONE,r),t.onPropertyChanged(n,o)};s("Wireframe",I.Lp,!1,this.toggleWireframe.bind(this));const o={[Y.h.Wireframe]:{Wireframe:["thickness","wireframeOpacity","stroke","fillEnabled","fill","insideAltColor","dualStroke","secondThickness"],"Wireframe Dashes":["dashEnabled","dashLength","dashAnimate","dashOverlap"],"Wireframe Advanced":["squeeze","squeezeMin","squeezeMax"]}};for(const e in o){const t=ee.Z.modelChunk.uniforms[e];for(const i in o[e])for(const n of o[e][i])s(i,n,t[n].value,(e=>{for(const t of this.mesh.chunks)t.setMaterialsUniform(n,e)}),t[n].range)}}async debugCycleChunkMaterials(){const e=[];for(const t in Y.h)isNaN(Number(t))&&e.push(Y.h[t]);const t=[];for(const e in K.S)isNaN(Number(e))&&t.push(K.S[e]);te.info(`Available ChunkMaterialCapabilities: ${e}`);const i=[];for(let t=0;t<1<<e.length-1;t++){const n={};for(let i=e.length-1;i>=0;i--){n[e[i]]=Boolean(t&1<<i)}i.push(n)}te.info(`There are ${i.length*t.length} options to test`);for(let e=0;e<t.length;e++){await this.engine.commandBinder.issueCommand(new Q.U(e));for(const t of i){te.info(`Testing ChunkRenderingMode.${K.S[e]} with capabilities: ${JSON.stringify(t,void 0,2)}`);const i=new O.Vector4(Math.random(),Math.random(),Math.random(),.5);for(const e of Object.keys(t))for(const n of this.mesh.chunks)n.setColorOverlay(i),n.setMeshPreviewSphere(new O.Vector3(0,0,0)),n.overrideCapability(e,t[e]);await(0,j.gw)(100)}await(0,j.gw)(100)}await this.engine.commandBinder.issueCommand(new Q.U(null))}}var ie,ne=i(20331),se=i(40440),oe=i(2124);class MeshTextureSlot{constructor(e){this.textureName=e,this.chunks=[],this.minQuality=se.r5,this.maxQuality=se.r5,this.targetQuality=se.r5,this.loading=!1,this.screenCoverage=0,this.screenCoverageScore=0,this.sightings=new oe.P(100)}setTexture(e){this.texture&&this.texture!==e&&this.texture.dispose(),this.texture=e;for(const e of this.chunks)e.setMeshTexture(this.texture)}async getUrl(e){const t=se.tT[e].assetType;if(this.textureData){const e=this.textureName.match(/[_.]([0-9]{3})[_.]/);if(!e)throw new Error(`Could not parse texture index from texture name: ${this.textureName}`);return(await this.textureData[t].get()).urlTemplate.replace("<texture>",e[1])}{const e=this.textureName.match(/^([a-f0-9]+(_10k|_50k)?)/);if(!e)throw new Error(`Unknown format for texture name: ${this.textureName}`);return`${e[0]}_texture_jpg_${t}/${this.textureName}`}}addSighting(e,t,i){this.sightings.push({point:e,distance:t,time:i})}}!function(e){e[e.LOAD_MORE=0]="LOAD_MORE",e[e.STAY=1]="STAY",e[e.UNLOAD=2]="UNLOAD"}(ie||(ie={}));class TextureBudgeter{constructor(e){this.slots=e,this.strategy=ie.STAY,this.baseSizeUnit=se.tT[se.r5].textureSize,this.minBudget=this.slots.length,this.maxBudget=this.slots.length*this.getBudgetSize(se.KG),this._budget=this.minBudget}update(e){this.budget=this.maxBudget}getBudgetSize(e){return e?(se.tT[e].textureSize/this.baseSizeUnit)**2:0}calcCurrentUsedBudget(){return this.slots.reduce(((e,t)=>e+this.getBudgetSize(t.quality)),0)}clampBudget(e){return Math.min(this.maxBudget,Math.max(this.minBudget,e))}get budget(){return this._budget}set budget(e){e=this.clampBudget(e),this.budget!==e&&(this._budget=e,this.updateTargetQualitiesFromBudget())}updateTargetQualitiesFromBudget(){let e=0;for(const t of this.slots)t.targetQuality=se.r5,e+=this.getBudgetSize(t.targetQuality);for(const t of se.ib)for(const i of this.slots)if(!(i.maxQuality<t)){if(e-=this.getBudgetSize(i.targetQuality),e+=this.getBudgetSize(t),e>this.budget)return;i.targetQuality=t}}}class MeshRenderPass{constructor(e,t){this.slots=e,this.renderToTextureModule=t,this.renderTarget=new O.WebGLRenderTarget(1,1),this.sizeMultiplier=1/4,this.pixelBuffer=new Uint8Array(4)}render(e,t,i=!1){this.beforeRender();let{width:n,height:s}=this.renderToTextureModule.getRenderSize();n=Math.max(1,Math.floor(n*this.sizeMultiplier)),s=Math.max(1,Math.floor(s*this.sizeMultiplier)),n===this.renderTarget.width&&s===this.renderTarget.height||this.renderTarget.setSize(n,s),this.renderToTextureModule.render(this.renderTarget,e,t),i&&this.renderToScreen(),this.afterRender()}renderToScreen(){this.renderToTextureModule.renderToScreen(this.renderTarget)}readPixels(){const e=this.renderTarget.width*this.renderTarget.height*4;this.pixelBuffer.length!==e&&(this.pixelBuffer=new Uint8Array(e));const t=this.pixelBuffer;return this.renderToTextureModule.getRenderTargetData(this.renderTarget,t),this.pixelBuffer}beforeRender(){for(const e of this.slots)for(const t of e.chunks)this.beforeRenderChunk(t,e)}afterRender(){for(const e of this.slots)for(const t of e.chunks)this.afterRenderChunk(t,e)}}class TextureQualityRenderPass extends MeshRenderPass{beforeRenderChunk(e,t){e.setColorOverlay(se.tT[t.quality].debugColor)}afterRenderChunk(e,t){e.setColorOverlay(null)}}class TextureScoreRenderPass extends MeshRenderPass{beforeRender(){this.maxValue=this.slots.reduce(((e,t)=>Math.max(e,t.screenCoverageScore)),1e-9),super.beforeRender()}beforeRenderChunk(e,t){const i=t.screenCoverageScore/this.maxValue,n=new O.Vector4(i,i,i,1);e.setColorOverlay(n)}afterRenderChunk(e,t){e.setColorOverlay(null)}}var re=i(91055);const ae=[];let le=0;var ce=i(67126),he=i(26199),de=i(24975);const ue=new N.Z("/index.js");class MeshTextureLoader{constructor(e,t,i,n,s,o,r,a,l,c,h){this.textureLOD=e,this.urls=t,this.model=i,this.modelMesh=n,this.camera=s,this.cameraData=o,this.renderer=r,this.renderToTextureModule=a,this.raycaster=l,this.scene=c,this.engine=h,this.slots=[],this.chunkIdToSlot={},this.minQuality=se.r5,this.maxQuality=se.KG,this.concurrentLoadingTextures=3,this.concurrentDownloadingTiles=12,this.autoLoadTiles=!1,this.lastSortedAt=0,this.loadingTextures=0,this.downloadingTiles=0,this.textureQualityRenderPass=new TextureQualityRenderPass(this.slots,this.renderToTextureModule),this.textureScoreRenderPass=new TextureScoreRenderPass(this.slots,this.renderToTextureModule),this._raycastCounter=0;const d={};for(const e of n.chunks){let t=d[e.textureName];t||(t=new MeshTextureSlot(e.textureName),this.model.textures&&(t.textureData=this.model.textures),d[e.textureName]=t,this.slots.push(d[e.textureName])),t.chunks.push(e),this.chunkIdToSlot[e.id]=t}this.textureBudgeter=new TextureBudgeter(this.slots)}setQuality(e,t){if(e>t)throw new Error("min quality must be smaller or equal to max");this.minQuality=e,this.maxQuality=t;for(const e of this.slots)e.minQuality=this.minQuality,e.maxQuality=Math.min(e.maxQuality,this.maxQuality)}get textureCount(){return this.slots.length}loadAll(e){if(!this.slots[0]||!this.slots[0].textureName)return Promise.resolve([]);const t=this.slots.map((t=>this.loadTexture(t,e,!1)));return Promise.all(t)}async loadTexture(e,t,i=!0){const n=se.tT[t].textureSize;if(e.lastLoadedAt=performance.now(),t===e.quality)return ue.warn(`Texture was already at level ${se.S7[t]}, not reloading`),e.texture;if(t<e.quality){const i=this.renderToTextureModule.resizeTexture(e.texture,n);return e.quality=t,e.setTexture(i),e.texture}const s=new O.Texture;s.format=O.RGBFormat,this.textureLOD!==me.NONE&&i&&(s.generateMipmaps=!1,s.minFilter=O.LinearFilter,s.magFilter=O.LinearFilter),this.renderer.initSizedTexture2D(n,s),e.loading=!0,this.loadingTextures++;try{s.sourceFile=await e.getUrl(t),this.textureLOD!==me.NONE&&i?await this.updateTextureTiled(s,t):await this.updateTextureSolid(s,t),e.setTexture(s)}catch(e){ue.warn(`Failed loading texture ${s.sourceFile}`)}finally{this.loadingTextures--,e.quality=t,e.loading=!1}return s}async updateTextureTiled(e,t){const{textureSize:i,tileSize:n,assetSize:s}=se.tT[t],o=s/(i/n),r=I.ZP.flipY,a=async(t,a)=>{const l={};let c;o!==n&&(l.width=`${n}`),o!==s&&(l.crop=`${o},${o},x${t/i},y${a/i}`),this.downloadingTiles+=1;try{c=await this.urls.getImageBitmap(e.sourceFile,n,n,{priority:ne.ru.LOW,flipY:r},l)}finally{this.downloadingTiles-=1}const h=t,d=i-a-c.height;return(await this.engine.commandBinder.issueCommand(new he._("mesh/texture/upload-tiles",(()=>this.renderer.uploadTexture2D(c,e,h,d)),100))).promise},l=[];for(let e=0;e<i;e+=n)for(let t=0;t<i;t+=n)l.push(a(e,t));return Promise.all(l)}async updateTextureSolid(e,t){const{textureSize:i}=se.tT[t],n=I.ZP.flipY,s=await this.urls.getImageBitmap(e.sourceFile,i,i,{priority:ne.ru.LOW,flipY:n},{width:`${i}`});this.renderer.uploadTexture2D(s,e,0,0)}raycastRandomScreenLocation(e,t,i){this._raycastCounter++;const n=(2-2*t)/e,s=-1+t,o=this._raycastCounter%(e*e),r=o%e,a=s+(o-r)/e*n,l=s+r*n+Math.random()*n,c=a+Math.random()*n,h=new O.Vector3(l,c,-1).unproject(this.camera),d=new O.Vector3(l,c,1).unproject(this.camera).clone().sub(h).normalize(),u=this.raycaster.pick(h,d,de.Pv);if(u&&u.object&&u.object instanceof G.g&&u.face){i&&i(u);const e=u.object.getChunk(u.face.materialIndex);this.chunkIdToSlot[e.id].addSighting(u.point.clone(),u.distance,this._raycastCounter)}}analyzeTextureScreenCoverageFromRaycasts(){const e=window.innerWidth,t=(new O.Vector3).copy(this.cameraData.pose.position);for(const i of this.slots){i.screenCoverage=0,i.screenCoverageScore=0,i.maxQuality=this.minQuality;for(const n of i.sightings){if(this._raycastCounter-n.time>1e3)continue;const s=t.distanceTo(n.point);let o=pe((0,re._U)(s,this.camera.projectionMatrix,e));o=Math.min(o,this.maxQuality),i.screenCoverageScore+=o,i.screenCoverage+=1,i.maxQuality=Math.max(o,i.maxQuality)}}this.slots.sort(((e,t)=>t.screenCoverageScore-e.screenCoverageScore)),this.textureBudgeter.updateTargetQualitiesFromBudget()}update(e){if(this.textureBudgeter.update(e),!this.camera||!this.autoLoadTiles)return;const t=performance.now();this.textureLOD===me.RAYCAST&&this.minQuality!==this.maxQuality&&(this.raycastTaskPromise||(this.raycastTaskPromise=this.engine.commandBinder.issueCommand(new he._("mesh/texture/raycast",(()=>{this.raycastRandomScreenLocation(5,.05,I.ZP.debugLOD?((e,t)=>{if(0===ae.length)for(let e=0;e<100;e++){const e=new O.Mesh(new O.SphereBufferGeometry(.005),new O.MeshBasicMaterial);ae.push(e)}return i=>{const n=ae[le++%ae.length];n.position.copy(i.point),n.scale.set(i.distance,i.distance,i.distance),n.material.color.setHex(e),n.parent||t.scene.add(n)}})(65280,this.scene):void 0)}),50)).then((async e=>{await e.promise,this.raycastTaskPromise=null}))),!this.analyzeTaskPromise&&t-this.lastSortedAt>200&&(this.analyzeTaskPromise=this.engine.commandBinder.issueCommand(new he._("mesh/texture/analyze-screen-coverage",(()=>{this.analyzeTextureScreenCoverageFromRaycasts(),this.lastSortedAt=performance.now()}),100)).then((async e=>{await e.promise,this.analyzeTaskPromise=null}))));for(let e=this.slots.length-1;e>=0;e--){const i=this.slots[e],n=(0,ce.uZ)(i.targetQuality,i.minQuality,i.maxQuality),s=t-i.lastLoadedAt<1e3;if(!i.loading&&i.quality>n&&!s){this.loadTexture(i,n);break}}for(const e of this.slots){if(this.loadingTextures>=this.concurrentLoadingTextures||this.downloadingTiles>=this.concurrentDownloadingTiles)break;const t=(0,ce.uZ)(e.targetQuality,e.minQuality,e.maxQuality);!e.loading&&e.quality<t&&this.loadTexture(e,e.quality+1)}I.ZP.debugLOD&&(this.textureScoreRenderPass.render(this.modelMesh,this.camera,!0),this.textureQualityRenderPass.render(this.modelMesh,this.camera,!0))}}function pe(e){let t=se.KG;for(;e>se.tT[t].texelSize&&t>se.r5;)t--;return t}var me;!function(e){e[e.NONE=0]="NONE",e[e.RAYCAST=1]="RAYCAST"}(me||(me={}));class ModelMeshModule extends n.Y{constructor(){super(...arguments),this.name="model-mesh",this.renderingMesh=!0,this.colorOverlay=null,this.toggleMeshOverlayColor=e=>{this.colorOverlay||(this.colorOverlay=new MeshOverlayColor((()=>this.modelMesh.chunks))),this.colorOverlay.toggleEnabled(e)}}async init(e,t){this.market=t.market;const[i,n,A,I,L,N,k,B,F,U]=await Promise.all([t.getModule(x.default),t.getModule(u.default),t.getModule(h.default),t.market.waitForData(d.T),t.getModule(a.default),t.getModule(p.default),t.market.waitForData(r.M_),t.market.waitForData(M.O),t.market.waitForData(v.Z),t.getModule(w.Z)]);this.viewmodeData=B;const V=i.getScene(),H=A.getSignedUrls(),G=I.model.uuid;this.renderingMesh=!!e.renderMeshGeometry,this.panoRenderer=U.getRenderer(),this.modelMesh=new ModelMesh(G,H,t.claimRenderLayer(this.name));const z=await this.modelMesh.load({onProgress:e=>{t.broadcast(new R.Z(e.loaded,e.total))}}),j=z.boundingBox.clone(),W=new O.Box3;let Z;if(F.iterate((e=>{e.placementType!==y.hU.UNPLACED&&(W.setFromCenterAndSize(e.position,o.f.UNIT),j.union(W))})),this.meshData=new D._(0,j),this.market.register(this,D._,this.meshData),e.renderMeshGeometry){this.modelTextureLoader=new MeshTextureLoader(e.textureLOD,H,I.model,this.modelMesh,V.camera,k,i.cwfRenderer,N,n.picking,V,t);let s,o=!1,r=B.currentMode;const a=()=>{const t=s===l.s.VrOrientOnly||s===l.s.VrWithController||s===l.s.VrWithTrackedController,i=this.modelTextureLoader.textureCount<=e.textureLODThreshold?Math.max(se.S7.ULTRA,e.maxQuality):se.S7.MEDIUM,n=Math.max(i,r===_.Ey.Panorama&&0===this.meshData.opacity.value?i:e.maxQuality);this.modelTextureLoader.setQuality(i,n);const a=r!==_.Ey.Dollhouse&&r!==_.Ey.Floorplan,c=B.transition.active&&B.transition.to===_.Ey.Panorama;this.modelTextureLoader.autoLoadTiles=!(t||c||o&&a)&&e.textureLOD!==me.NONE};let h=this.meshData.opacity;this.bindings.push(this.meshData.onChanged((e=>{e.opacity!==h&&a(),h=e.opacity})),t.subscribe(E.Z,(e=>{this.startOpacityTransition(),r=e.toMode,o=!0,a()})),t.subscribe(T.Z,(e=>{o=!1,r=e.toMode,a()})),t.subscribe(S.oR,(()=>{o=!0,a()})),t.subscribe(S.NR,(()=>{o=!1,a()})),t.subscribe(m.Z,(()=>{o=!0,a()})),t.subscribe(g.Z,(e=>{F.getSweep(e.toSweep).alignmentType===y.z9.UNALIGNED&&this.setMeshOpacity(0)})),t.subscribe(f.Z,(()=>{o=!1,a()})),t.subscribe(c.m,(e=>{s=e.mode,a()})),t.subscribe(b.Z,(e=>{this.renderer.updateExistingTexture(e.sweepId,e.renderTarget.texture)})));const d=e.textureLOD!==me.NONE?se.S7.LOW:e.maxQuality;Z=this.modelTextureLoader.loadAll(d).then((()=>{a()}))}if(this.modelCollider=new ModelCollider(L.registerMesh,L.unregisterMesh,z),n.setupOctree(z),t.addComponent(this,this.modelCollider),e.renderMeshGeometry){const i=await t.market.waitForData(s.pu);this.renderer=new ModelRenderer(V.scene,z,this.modelCollider,this.panoRenderer,this.meshData,F,i,e),t.addComponent(this,this.renderer),await Z}this.bindings.push(t.commandBinder.addBinding(P.g,(async e=>this.setMeshOpacity(e.value))),t.commandBinder.addBinding(C.I,(async e=>this.toggleMeshOverlayColor(e.enabled))))}onUpdate(e){this.modelTextureLoader&&this.modelTextureLoader.update(e),this.meshData.opacity.active&&(this.meshData.opacity.updateProgress(this.viewmodeData.transition.progress),this.meshData.commit());const t=performance.now()/1e3;for(const e of this.modelMesh.chunks)e.setTime(t)}get mesh(){return this.modelMesh}get collider(){return this.modelCollider}startOpacityTransition(){const e=this.viewmodeData.transition.to,t=this.meshData.opacity.value,i=e===_.Ey.Panorama?0:1,n=e===_.Ey.Panorama?A.Q9:A.w2;this.meshData.opacity.value!==i&&this.meshData.opacity.modifyAnimation(t,i,1,n)}setMeshOpacity(e){this.meshData.opacity.modifyAnimation(e,e,0),this.meshData.commit()}isRenderingMesh(){return this.renderingMesh}}},73902:(e,t,i)=>{"use strict";var n;i.d(t,{h:()=>n}),function(e){e.PanoTexture="PANO_TEXTURE",e.PanoTextureTransition="PANO_TEXTURE_TRANSITION",e.MeshTexture="MESH_TEXTURE",e.ColorOverlay="COLOR_OVERLAY",e.MeshPreviewSphere="MESH_PREVIEW_SPHERE",e.Wireframe="WIREFRAME",e.FlatShading="FLAT_SHADING",e.PanoOverlay="PANO_OVERLAY",e.PanoOverlayTransition="PANO_OVERLAY_TRANSITION"}(n||(n={}))},67399:(e,t,i)=>{"use strict";i.d(t,{$4:()=>r});var n=i(93781);const s=e=>!!e&&e instanceof n.g,o=e=>"object"==typeof e&&!!e&&"floorId"in e&&!!e.floorId,r={hasFloorId:o,hasRoomId:e=>o(e)&&"roomId"in e&&!!e.roomId,isRoomMesh:s,matchesFloorId:e=>t=>o(t)&&t.floorId===e,isVisibleRoomMesh:e=>s(e)&&e.raycastEnabled&&e.visible}},20640:(e,t,i)=>{"use strict";i.d(t,{Z:()=>ModelLoadProgressMessage});var n=i(93528);class ModelLoadProgressMessage extends n.v{constructor(e,t){super(),this.loaded=e,this.total=t}}},15782:(e,t,i)=>{"use strict";i.d(t,{ZP:()=>o,AN:()=>r,Lp:()=>a,Y7:()=>l,xx:()=>c});var n=i(2212),s=i(21265);const o=Object.freeze({debugLOD:s.hu("debuglod",!1),highQualityDam:s.hu("highqdam",!1),flipY:s.hu("flipY",!0)}),r="features/mesh-rendering",a="wireframeEnabled",l=new n.Vector4(0,0,0,.3),c={FADE_OPAQUE:1,FADE_ABOVE:.06,FADE_BELOW:.1,FADE_CLICKABLE_THRESHOLD:.079,FADE_IN_VALUE:.08,FADE_IN_END_ANGLE:45,FADE_IN_START_ANGLE:22,FADE_IN_HOVER_BOOST_VALUE:.2,FADE_BELOW_START:0,FADE_BELOW_MULT:1,DISCARD_FOCAL_MULTI:.125}},97982:(e,t,i)=>{"use strict";i.d(t,{Z:()=>l});var n=i(48101),s=i(2212),o=i(13441),r=i(81047),a=i(73902);const l={cube:{uniforms:{map:{type:"t",value:null},opacity:{type:"f",value:1}},vertexShader:(0,n.m)(r,i(49423)),fragmentShader:(0,n.m)(o,i(36357))},blurCube:{uniforms:{map:{type:"t",value:null},opacity:{type:"f",value:1},dir:{type:"v2",value:new s.Vector2(0,0)}},vertexShader:(0,n.m)(r,i(56163)),fragmentShader:(0,n.m)(o,i(15145))},modelChunk:{uniforms:{[a.h.MeshTexture]:{map:{type:"t",value:null},meshOpacity:{type:"f",value:0},opacity:{type:"f",value:1},transparentDiscardDist:{type:"f",value:0}},[a.h.PanoTexture]:{pano0Map:{type:"t",value:null},pano0Position:{type:"v3",value:new s.Vector3},pano0Matrix1:{type:"m4",value:new s.Matrix4},pano0Matrix2:{type:"m4",value:new s.Matrix4},panoOpacity:{type:"f",value:1}},[a.h.PanoTextureTransition]:{progress:{type:"f",value:0},pano1Map:{type:"t",value:null},pano1Position:{type:"v3",value:new s.Vector3},pano1Matrix1:{type:"m4",value:new s.Matrix4},pano1Matrix2:{type:"m4",value:new s.Matrix4}},[a.h.PanoOverlay]:{overlay0Map:{type:"t",value:null},overlay0Matrix:{type:"m4",value:new s.Matrix4}},[a.h.PanoOverlayTransition]:{overlay1Map:{type:"t",value:null},overlay1Matrix:{type:"m4",value:new s.Matrix4}},[a.h.ColorOverlay]:{colorOverlay:{type:"v4",value:null}},[a.h.MeshPreviewSphere]:{meshPreviewCenter:{type:"v3",value:null},meshPreviewSize:{type:"f",value:.3}},[a.h.Wireframe]:{time:{type:"f",value:0},fill:{type:"c",value:new s.Color(16711680)},stroke:{type:"c",value:new s.Color(16777215)},dualStroke:{type:"b",value:!1},fillEnabled:{type:"b",value:!1},insideAltColor:{type:"b",value:!1},thickness:{type:"f",value:.1},secondThickness:{type:"f",value:.1},dashEnabled:{type:"b",value:!1},dashRepeats:{type:"f",value:10},dashOverlap:{type:"b",value:!1},dashLength:{type:"f",value:.1,range:[0,1]},dashAnimate:{type:"b",value:!1},squeeze:{type:"b",value:!1},squeezeMin:{type:"f",value:.1},squeezeMax:{type:"f",value:1},wireframeOpacity:{type:"f",value:1,range:[0,1]}}},vertexShader:(0,n.m)(r,i(73291)),fragmentShader:(0,n.m)(o,i(43775))},modelOutside:{uniforms:{map:{type:"t",value:null},opacity:{type:"f",value:1},colorOverlay:{type:"v4",value:new s.Vector4(0,0,0,0)}},vertexShader:(0,n.m)(r,i(25256)),fragmentShader:(0,n.m)(o,i(65635))},depth:{uniforms:{opacity:{type:"f",value:1},maxDistance:{type:"f",value:20}},vertexShader:(0,n.m)(r,i(25928)),fragmentShader:(0,n.m)(o,i(43411))}}},40440:(e,t,i)=>{"use strict";i.d(t,{S7:()=>n,tT:()=>o,ib:()=>r,r5:()=>a,KG:()=>l,Pm:()=>c});var n,s=i(2212);!function(e){e[e.LOW=1]="LOW",e[e.MEDIUM=2]="MEDIUM",e[e.HIGH=3]="HIGH",e[e.ULTRA=4]="ULTRA"}(n||(n={}));const o={[n.LOW]:{debugColor:new s.Vector4(1,0,0,.5),textureSize:256,tileSize:256,assetType:"low",assetSize:512,texelSize:.096},[n.MEDIUM]:{debugColor:new s.Vector4(1,1,0,.5),textureSize:512,tileSize:512,assetType:"low",assetSize:512,texelSize:.048},[n.HIGH]:{debugColor:new s.Vector4(0,1,0,.5),textureSize:1024,tileSize:512,assetType:"high",assetSize:2048,texelSize:.024},[n.ULTRA]:{debugColor:new s.Vector4(0,1,1,.5),textureSize:2048,tileSize:512,assetType:"high",assetSize:2048,texelSize:.012}},r=[n.LOW,n.MEDIUM,n.HIGH,n.ULTRA],a=r[0],l=r[r.length-1],c=e=>{for(const t in o)if(o[t].textureSize===e)return parseInt(t,10);throw new Error(`Not a valid texture size: ${e}`)}},63213:(e,t,i)=>{"use strict";i.d(t,{xc:()=>s,ko:()=>o,k7:()=>r});var n=i(2212);function s(e){const t=e.match(/group([0-9]+)/),i=e.match(/sub([0-9]+)/);return{group:t?parseInt(t[1],10):0,subgroup:i?parseInt(i[1],10):0}}function o(e,t=!1){if(e.getAttribute("barycentric"))return;const i=(e.getIndex()||e.getAttribute("position")).count/3,s=[];for(let e=0;e<i;e++){const i=t?1:0;e%2==0?s.push(0,0,1,0,1,0,1,0,i):s.push(0,1,0,0,0,1,1,0,i)}const o=new Float32Array(s),r=new n.BufferAttribute(o,3);e.setAttribute("barycentric",r)}function r(e=16777215*Math.random(),t=1){const i=function(e,t,i,n=1){const s=document.createElement("canvas");s.width=t,s.height=i;const o=s.getContext("2d");return o.fillStyle=`rgba(${255*e.r|0},${255*e.g|0},${255*e.b|0}, ${255*n|0})`,o.fillRect(0,0,t,i),s}(new n.Color(e),1,1,t),s=new n.CubeTexture([i,i,i,i,i,i]);return s.format=n.RGBAFormat,s.needsUpdate=!0,s}},76258:(e,t,i)=>{"use strict";i.d(t,{u:()=>SetMouseCursorCommand});var n=i(99681);class SetMouseCursorCommand extends n.m{constructor(e=null){super(),this.id="SET_MOUSE_CURSOR",this.payload={cursor:e}}}},7065:(e,t,i)=>{"use strict";var n;i.d(t,{C:()=>n}),function(e){e.NONE="none",e.DEFAULT="default",e.MOVE="move",e.MOVE_LF="col-resize",e.MOVE_UD="row-resize",e.XHAIR="crosshair",e.PLUS="cell",e.QUESTION="help",e.NOPE="not-allowed",e.FINGER="pointer",e.TEXT="text",e.TEXT_VERT="vertical-text",e.ZOOM_IN="zoom-in",e.ZOOM_OUT="zoom-in",e.GRAB="grab",e.GRABBING="grabbing",e.ARROW_R="e-resize",e.ARROW_L="w-resize",e.ARROW_U="n-resize",e.ARROW_D="s-resize",e.ARROW_UR="ne-resize",e.ARROW_UL="nw-resize",e.ARROW_DR="se-resize",e.ARROW_DL="sw-resize",e.ARROW_LR="ew-resize",e.ARROW_UD="ns-resize",e.ARROW_URDL="nesw-resize",e.ARROW_ULDR="nwse-resize"}(n||(n={}))},35739:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Cursor:()=>s.C,SetMouseCursorCommand:()=>o.u,default:()=>MouseCursor});var n=i(54122),s=i(7065),o=i(76258);class MouseCursor extends n.Y{constructor(){super(...arguments),this.name="mouse-cursor",this.activeCursor=null}async init(e,t){this.config=Object.assign({classPrefix:"cursor"},e),this.bindings.push(t.commandBinder.addBinding(o.u,(async e=>this.changeCursor(e.cursor))))}changeCursor(e){const{container:t,classPrefix:i}=this.config;e!==this.activeCursor&&(this.activeCursor&&t.classList.remove(`${i}-${this.activeCursor}`),e&&t.classList.add(`${i}-${e}`),this.activeCursor=e)}}},55525:(e,t,i)=>{"use strict";i.d(t,{ZK:()=>LockNavigationCommand,Lp:()=>UnlockNavigationCommand,Np:()=>NavigateToBox,zs:()=>FocusOnPointInsideCommand,OR:()=>FocusOnPinInsideCommand,ju:()=>NavigateToSweepCommand});var n=i(99681);class LockNavigationCommand extends n.m{constructor(){super(),this.id="LOCK_NAVIGATION"}}class UnlockNavigationCommand extends n.m{constructor(){super(),this.id="UNLOCK_NAVIGATION"}}class NavigateToBox extends n.m{constructor(e){super(),this.payload=e,this.id="NAVIGATE_TO_BOX"}}class FocusOnPointInsideCommand extends n.m{constructor(e){super(),this.payload=e,this.id="FOCUS_ON_POINT_INSIDE"}}class FocusOnPinInsideCommand extends n.m{constructor(e){super(),this.payload=e,this.id="FOCUS_ON_PIN_INSIDE"}}class NavigateToSweepCommand extends n.m{constructor(e){super(),this.id="MOVE_TO_SWEEP",this.payload=Object.assign({},e)}}},84496:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>Navigation});var n=i(54122),s=i(39936),o=i(89155),r=i(47924),a=i(73029),l=i(30963),c=i(75711),h=i(55525),d=i(17617);class NavigationException extends d.y{constructor(e){super(e),this.name="NavigationException"}}const u={Locked:"Cannot move while navigation is locked",InsideOnly:"Cannot navigate between panos when not in Panorama mode",InvalidSweep:"Not at a valid sweep",InTransition:"Cannot move while in a transition",NoDestinationFound:"Cannot move in that direction"};var p=i(75158),m=i(73706),g=i(75712),f=i(12505),v=i(86682),y=i(24975),b=i(66272),w=i(85995),S=i(76258),E=i(7065),T=i(90601),M=i(47173);class NavigationInputFocus{constructor(e,t,i,n,s,o,r,a,l,c){this.canStartTransition=e,this.commandBinder=t,this.input=i,this.floorsViewData=n,this.navigation=s,this.navigationDollhouse=o,this.sweepData=r,this.cameraModule=a,this.toolsData=l,this.settingsData=c,this.bindings=[],this.lastSelection={floorId:"",cancelTransition:!1},this.didSetCursor=!1,this.toggleInput=e=>{this.bindings.forEach((t=>e?t.renew():t.cancel()))},this.onRoomClick=(e,t,i)=>{if(this.shouldIgnore())return;if(!this.canStartTransition())return;if(!i||!i.point)return;const n=this.floorsViewData.floors.getFloorByMeshGroup(t.meshGroup);if(!n)return;if(this.lastSelection.cancelTransition)return;const s=1!==this.floorsViewData.totalFloors&&n.id!==this.lastSelection.floorId,o=()=>{this.lastSelection.floorId=n.id,this.lastSelection.cancelTransition=!1};if(!s)return this.floorsViewData.roomSelectModeActive||this.floorsViewData.floorSelectModeActive?(this.lastSelection.cancelTransition=!0,this.cameraModule.cancelTransition().then((()=>this.navigation.navigateToPanoNearIntersection(i))).then((()=>{this.lastSelection.cancelTransition=!1,o()})),void this.commandBinder.issueCommand(new S.u(E.C.DEFAULT))):void(this.floorsViewData.floorSelectModeActive?o():this.navigationDollhouse.navigateToPoint(i.point).then((()=>{this.lastSelection.cancelTransition||this.setFocusSweep(i),o()})));this.commandBinder.issueCommand(new v.Vw(n.id,!1,void 0,i.point)).then((()=>{o()}))},this.onBackgroundClick=()=>{this.shouldIgnore()||this.canStartTransition()&&(this.lastSelection.cancelTransition||(this.lastSelection.cancelTransition=!0,this.cameraModule.cancelTransition().then((()=>this.commandBinder.issueCommand(new v.Vw(null,!1)))).then((()=>{this.lastSelection.cancelTransition=!1}))))},this.onBackgroundHover=()=>{this.shouldIgnore()||null!==this.floorsViewData.currentFloorId&&this.toolsData.activeToolName!==T.w1.LABELS&&(this.didSetCursor=!0,this.commandBinder.issueCommand(new S.u(E.C.FINGER)))},this.onBackgroundUnhover=()=>{this.shouldIgnore()||this.didSetCursor&&(this.commandBinder.issueCommand(new S.u(E.C.DEFAULT)),this.didSetCursor=!1)},this.onFloorChange=()=>{this.shouldIgnore()||null===this.floorsViewData.currentFloorId&&this.commandBinder.issueCommand(new S.u(E.C.DEFAULT))},this.bindings.push(this.input.registerMeshHandler(p.R,g.s.is(y.Pv),this.onRoomClick),this.input.registerMeshHandler(p.R,g.s.isType(f.i),this.onBackgroundClick),this.input.registerMeshHandler(m.z,g.s.isType(f.i),this.onBackgroundHover),this.input.registerMeshHandler(m.A,g.s.isType(f.i),this.onBackgroundUnhover),this.floorsViewData.makeFloorChangeSubscription(this.onFloorChange))}async setFocusSweep(e){if(!this.canStartTransition())return;if(this.lastSelection.cancelTransition)return;const t=(0,b.b)(this.sweepData,!1,e);t.length>0&&t[0].sweep&&await this.commandBinder.issueCommand(new w.aK(t[0].sweep.id))}shouldIgnore(){return!this.settingsData.tryGetProperty(M.Q,!1)}}var _=i(2212),x=i(27829),A=i(35825),O=i(30604),P=i(78626),C=i(22767),D=i(61718),I=i(40582),R=i(25799);const L=new R.Z("nav-input");class NavigationInputInside{constructor(e,t,i){this.navigation=e,this.inputIni=t,this.insideNav=[],this.insideVrNav=[],this.toggleInput=e=>{this.insideNav.forEach((t=>e?t.renew():t.cancel()))},this.toggleVrInput=e=>{this.insideVrNav.forEach((t=>e?t.renew():t.cancel()))},this.registerInsideClickHandlers=e=>[e.registerMeshHandler(p.R,g.s.is(y.Pv),((e,t,i)=>this.tryExecuteAction(((e,t)=>B(e)&&N(t)),((e,t)=>N(t)&&this.navigation.navigateTowardsIntersection(t)),e,i))),e.registerMeshHandler(p.R,g.s.isType(f.i),((e,t,i)=>this.tryExecuteAction(((e,t)=>B(e)&&N(t)),((e,t)=>N(t)&&this.navigation.navigateTowardsIntersection(t)),e,i)))],this.registerVrClickHandlers=e=>[e.registerMeshHandler(p.R,g.s.isInstanceOf(D.S),((e,t,i)=>this.tryExecuteAction(((e,t)=>B(e)&&N(t)),((e,t)=>N(t)&&this.navigation.navigateToPanoNearIntersection(t)),e,i)))],this.registerWheelInput=e=>[e.registerHandler(O.a,(e=>this.tryExecuteAction((e=>!0),(e=>{if(e instanceof O.a){const t=new _.Vector3(0,0,Math.sign(e.delta.y));return!!this.navigation.navigateInLocalDirection(t)}return!1}),e)))],this.hotkeys=e=>[e.registerHandler(P.e,(e=>this.tryExecuteAction((e=>k(e)&&e.key in NavigationInputInside.hotkeyDirections),(e=>{if(k(e)){const t=NavigationInputInside.hotkeyDirections[e.key];return!!this.navigation.navigateInLocalDirection(t)}return!1}),e)))],this.tryExecuteAction=(e,t,i,n)=>{let s=!1;try{this.navigation.isNavigationInputAllowed()&&e(i,n)&&(s=t(i,n))}catch(e){if(!(e instanceof NavigationException))throw L.warn(e),e;L.debug(e)}return s},this.insideVrNav.push(...this.registerVrClickHandlers(this.inputIni)),this.insideNav.push(...this.registerInsideClickHandlers(this.inputIni),...this.hotkeys(this.inputIni)),i&&this.insideNav.push(...this.registerWheelInput(this.inputIni))}get bindings(){return[...this.insideNav,...this.insideVrNav]}}function N(e){return void 0!==e&&void 0!==e.point}function k(e){return e instanceof P.e&&e.state===C.M.PRESSED}function B(e){return e instanceof p.R&&e.button===I.MP.PRIMARY}NavigationInputInside.hotkeyDirections={[A.R.W]:x.f.FORWARD,[A.R.A]:x.f.LEFT,[A.R.S]:x.f.BACK,[A.R.D]:x.f.RIGHT,[A.R.UPARROW]:x.f.FORWARD,[A.R.DOWNARROW]:x.f.BACK};const F=new R.Z("nav-input");class NavigationInputOutside{constructor(e,t,i){this.navigation=e,this.input=t,this.settings=i,this.bindings=[],this.toggleInput=e=>{F.debug("toggling dollhouse input",e),this.bindings.forEach((t=>e?t.renew():t.cancel()))},this.bindings.push(...this.registerEnterPanoHandler())}registerEnterPanoHandler(){return[this.input.registerMeshHandler(p.R,g.s.isInstanceOf(D.S),((e,t,i)=>!this.settings.tryGetProperty(M.Q,!1)&&(!!this.navigation.isNavigationInputAllowed()&&(e.button===I.MP.PRIMARY&&void 0!==i&&this.navigation.navigateToPanoNearIntersection(i)))))]}}var U=i(38610),V=i(77956),H=i(72942),G=i(12775),z=i(71208),j=i(19334),W=i(89895),Z=i(22729),q=i(62513),K=i(94210),Y=i(48769),$=i(89997),X=i(97620),Q=i(91055),J=i(44266);class NavigationDollhouse{constructor(e,t,i){this.canStartTransition=e,this.pose=t,this.cameraModule=i,this.navigateToPoint=async e=>{if(!this.canStartTransition())return;const t=this.pose.focalDistance,i=(0,Q.fd)(this.pose.rotation,e,t);await this.cameraModule.cancelTransition(),await this.cameraModule.moveTo({pose:{position:i},transitionType:r.n.Interpolate,focalDistance:t,transitionTime:U.E.TRANSITION_TIME_DH})},this.navigateToBox=e=>{if(!this.canStartTransition())return J.Q.resolve();const{position:t,rotation:i,focalDistance:n}=this.getPoseForBox(e);return this.cameraModule.moveTo({pose:{position:t,rotation:i},transitionType:r.n.Interpolate,focalDistance:n,transitionTime:U.E.TRANSITION_TIME_DH})},this.getPoseForBox=e=>{const t=e.getCenter(new _.Vector3),i=e.getSize(new _.Vector3),n=i.z>i.x;let s=this.pose.rotation;s=n?s.angleTo(ee.LANDSCAPE_LEFT)>s.angleTo(ee.LANDSCAPE_RIGHT)?ee.LANDSCAPE_LEFT:ee.LANDSCAPE_RIGHT:s.angleTo(ee.PORTRAIT_RIGHT)>s.angleTo(ee.PORTRAIT_LEFT)?ee.PORTRAIT_LEFT:ee.PORTRAIT_RIGHT;const o=-85*X.Ue,r=2*Math.atan(1/this.pose.projection.elements[5]),a=(0,Q.YN)(t,s,o,e,1.2*r,this.pose.aspect()),l=t.distanceTo(a.position);return{position:a.position,rotation:a.rotation,focalDistance:l}}}}const ee={LANDSCAPE_LEFT:(new _.Quaternion).setFromAxisAngle(x.f.UP,45*X.Ue),LANDSCAPE_RIGHT:(new _.Quaternion).setFromAxisAngle(x.f.UP,-45*X.Ue),PORTRAIT_LEFT:(new _.Quaternion).setFromAxisAngle(x.f.UP,25*X.Ue),PORTRAIT_RIGHT:(new _.Quaternion).setFromAxisAngle(x.f.UP,-25*X.Ue)};var te=i(17321),ie=i(81733),ne=i(75195),se=i(1707);const oe=!0,re=8,ae=.1,le=25,ce=500;class NavigationPoint{constructor(e,t,i,n,s){this.engine=e,this.cameraData=t,this.sweepData=i,this.viewmodeModule=n,this.raycaster=s,this.tryNavigateToPoint=async(e,t,i,n)=>{const s=[],o=[];if(s.push(te._T()),s.push(te._k()),t===r.n.Interpolate&&this.viewmodeModule.currentMode===z.Ey.Panorama&&this.sweepData.currentSweep){const t=.5,i=this.sweepData.currentSweep,n=this.sweepData.getSweep(i),r=n.position.clone().sub(e).normalize();s.push(te.pI(e,r,t)),s.push(te.T3(n)),o.push(ie.o7(e,r))}s.push(this.withinLatitudeFilter(e)),s.push(this.notTooCloseFilter(e)),s.push(this.notTooFarFilter(e));o.push(ie.Dv(e,-2));const a=this.sweepData.sortByScore(s,o),l=new _.Vector3;let c=null,d=!1,u=null;for(const s of a)if(this.sweepCanSeeNote(e,s.sweep)){if(u=s.sweep,t===r.n.Interpolate){l.copy(e).sub(u.position).normalize(),d=!0;const s=this.getSweepToPointRotation(u.position,e,n),o=this.cameraData.pose.projection.asThreeMatrix4(),{width:a,height:p}=this.cameraData,m=(0,ne.bD)(e,u.position,s,a,p,o);i&&i(m),c=this.viewmodeModule.currentMode!==z.Ey.Panorama?this.viewmodeModule.switchToMode(z.Ey.Panorama,t,{rotation:s,sweepID:u.id}):this.commandBinder.issueCommand(new h.ju({transition:t||r.n.Interpolate,sweep:u.id,rotation:s}))}break}return!(!d&&t===r.n.Interpolate)&&(!c&&u&&(c=this.engine.commandBinder.issueCommand(new h.ju({transition:t,transitionTime:ce,sweep:u.id,rotation:this.getSweepToPointRotation(u.position,e,n)}))),c&&await c,!0)},this.getSweepToPointRotation=(e,t,i)=>{const n=(0,Q.n0)(e,t);return i&&n.multiply(i),(0,X.Z)(n)},this.notTooCloseFilter=e=>t=>Math.abs(t.position.x-e.x)>ae||Math.abs(t.position.z-e.z)>ae,this.notTooFarFilter=e=>t=>{if(!oe){return t.position.distanceTo(e)>re}return!0},this.withinLatitudeFilter=e=>t=>{const i=(new _.Vector3).copy(e).sub(t.position),n=-Math.atan(i.y/Math.sqrt(i.x*i.x+i.z*i.z)),s=_.MathUtils.degToRad(le);return se.zf-s<n&&n<se.uQ+s},this.commandBinder=e.commandBinder}async focusPin(e,t,i,n){const{anchorPosition:s,stemNormal:o,stemLength:r}=e,a=s.clone().add(o.setLength(r));return this.focusPoint(a,t,i,n)}async focusPoint(e,t,i,n){if(this.cameraData.canTransition()&&this.sweepData.canTransition()&&!await this.tryNavigateToPoint(e,t,i,n)){if(t!==r.n.Interpolate)return this.goToNearestSweep(e,t,i,n);try{await this.commandBinder.issueCommand(new H._i(H.BD.DOLLHOUSE,r.n.Interpolate))}catch(s){await this.goToNearestSweep(e,t,i,n)}await this.tryNavigateToPoint(e,t,i,n)||await this.goToNearestSweep(e,t,i,n)}}async goToNearestSweep(e,t,i,n){const s=e,o=this.sweepData.getClosestSweep(s,!0);if(!o)throw new Error("Cannot find sweep closest to Mattertag disc");const a=this.getSweepToPointRotation(o.position,s,n),l=this.cameraData.pose.projection.asThreeMatrix4(),{width:c,height:d}=this.cameraData,u=(0,ne.bD)(s,o.position,a,c,d,l);i&&i(u),await this.commandBinder.issueCommand(new h.ju({sweep:o.id,rotation:a,transition:t||r.n.Interpolate}))}sweepCanSeeNote(e,t){const i=(new _.Vector3).copy(e).sub(t.position),n=i.length();i.normalize();const s=this.raycaster.picking.pick(t.position,i,y.Pv);return!s||n<=s.distance}}const he=new R.Z("navigation");class Navigation extends n.Y{constructor(){super(...arguments),this.name="navigation",this.navigationEnabled=!0,this.inputOutside=[],this.navigationRules=[()=>!0],this.addNavigationRule=e=>{-1===this.navigationRules.indexOf(e)&&this.navigationRules.push(e)},this.removeNavigationRule=e=>{const t=this.navigationRules.indexOf(e);-1!==t&&this.navigationRules.splice(t,1)},this.isNavigationInputAllowed=()=>{const e=this.navigationRules.reduce(((e,t)=>e&&t()),!0);return!(!this.navigationEnabled||!e)||(he.debug("Cannot move while navigation is locked",{blockedByRules:!e,blockedByCommand:!this.navigationEnabled}),!1)}}async init(e,t){let n,r;this.commandBinder=t.commandBinder,this.bindings.push(this.commandBinder.addBinding(h.ZK,(async()=>this.lockNavigation())),this.commandBinder.addBinding(h.Lp,(async()=>this.unlockNavigation())),this.commandBinder.addBinding(h.Np,(async e=>this.navigateToBox(e.box))),this.commandBinder.addBinding(h.zs,(async e=>{const{focusPosition:t,transition:i,orientationAdjust:n,onSweepChosen:s}=e;return this.navigationPoint.focusPoint(t,i,s,n)})),this.commandBinder.addBinding(h.OR,(async e=>{const{pinPosition:t,transition:i,orientationAdjust:n,onSweepChosen:s}=e;return this.navigationPoint.focusPin(t,i,s,n)})),this.commandBinder.addBinding(h.ju,(e=>this.navigateToSweep(e.sweep,e.rotation,e.transition,e.transitionTime,e.transitionSpeedMultiplier)))),[this.settingsData,this.sweepData,this.sweepModule,this.viewmodeData,this.viewmodeModule,this.cameraData,this.cameraModule,this.interactionmodeData,n,r]=await Promise.all([t.market.waitForData(s.e),t.market.waitForData(V.Z),t.getModule(K.default),t.market.waitForData(G.O),t.getModule($.default),t.market.waitForData(o.M_),t.getModule(W.default),t.market.waitForData(c.Z),t.getModule(q.default),t.market.waitForData(Y.t)]),this.navigationPoint=new NavigationPoint(t,this.cameraData,this.sweepData,this.viewmodeModule,n);const a=await t.getModule(l.default),d=await t.market.waitForData(Z.c);this.inputOutside.push(new NavigationInputOutside(this,a,this.settingsData));const u=()=>this.isNavigationInputAllowed()&&this.viewmodeData.canStartTransition()&&!d.transitionActive&&this.sweepData.canTransition(),p=()=>u()&&(this.viewmodeData.isDollhouse()||this.viewmodeData.isFloorplan());this.navigationDollhouse=new NavigationDollhouse(p,this.cameraData.pose,this.cameraModule),this.inputOutside.push(new NavigationInputFocus(p,t.commandBinder,a,d,this,this.navigationDollhouse,this.sweepData,this.cameraModule,r,this.settingsData)),this.inputInside=new NavigationInputInside(this,a,!!e.enableWheel),this.inputOutside.forEach((e=>this.bindings.push(...e.bindings))),this.bindings.push(...this.inputInside.bindings),this.updateInputBindings(),this.bindings.push(this.viewmodeData.makeModeChangeSubscription((()=>{this.viewmodeData.currentMode!==z.Ey.Transition&&this.updateInputBindings()}))),U.E.debugMenu&&Promise.all([i.e(164),i.e(383)]).then(i.bind(i,39772)).then((e=>{new e.NavigationVisuals(t)}))}updateInputBindings(){const e=this.interactionmodeData.isVR(),t=this.viewmodeData.isPano();this.inputInside.toggleInput(t&&!e),this.inputInside.toggleVrInput(t&&e),this.inputOutside.forEach((e=>e.toggleInput(!t)))}navigateInLocalDirection(e){const t=this.cameraData.pose.rotation;return this.navigateInDirection(e.clone().applyQuaternion(t))}navigateTowardsIntersection(e){return!!this.navigateInDirection(e.point.clone().sub(this.cameraData.pose.position))}navigateToPanoNearIntersection(e){if(!this.cameraData.canTransition())return!1;const t=(0,b.b)(this.sweepData,this.viewmodeData.isPano(),e),i=t.length>0?t[0].sweep:this.sweepData.getClosestSweep(e.point,!0),n=a.y[this.interactionmodeData.mode];if(this.viewmodeData.isPano()&&i)return this.navigateToSweep(i.id,void 0,n),!0;if(this.viewmodeData.canSwitchViewMode(z.Ey.Panorama)){const e=i?i.id:void 0;return this.commandBinder.issueCommand(new H._i(H.BD.INSIDE,n,{sweepID:e})),!0}return!1}navigateInDirection(e){if(!this.viewmodeData.isPano())throw new NavigationException(u.InsideOnly);if(!this.sweepData.currentSweep)throw new NavigationException(u.InvalidSweep);if(!this.sweepData.canTransition()||!this.cameraData.canTransition())throw new NavigationException(u.InTransition);const t=a.y[this.interactionmodeData.mode],i=(0,b.T)(this.sweepData,e);if(i.length>0&&i[0].sweep)return this.navigateToSweep(i[0].sweep.id,void 0,t);throw new NavigationException(u.NoDestinationFound)}async navigateToBox(e){return this.navigationDollhouse.navigateToBox(e)}lockNavigation(){this.navigationEnabled=!1,he.debug("Navigation input locked")}unlockNavigation(){this.navigationEnabled=!0,he.debug("Navigation input unlocked")}async navigateToSweep(e,t,i,n,s){const o=this.settingsData.tryGetProperty(j.gj,r.n.Interpolate);let a;void 0===i&&(i=o);const l=this.sweepData.currentSweep;if(i===r.n.Interpolate){const t=!l||this.sweepData.isSweepAligned(l),n=this.sweepData.isSweepAligned(e),s=l!==e,o=!t||!n,a=this.viewmodeData.currentMode===z.Ey.Panorama;s&&o&&a&&(i=r.n.FadeToBlack)}return a=this.viewmodeData.currentMode!==z.Ey.Panorama?this.viewmodeModule.switchToMode(z.Ey.Panorama,i,{sweepID:e,rotation:t}):this.sweepModule.moveToSweep({transitionType:i,sweepId:e,rotation:t,transitionTime:n,transitionSpeedMultiplier:s}),await a,this.sweepData.currentSweep}}},38610:(e,t,i)=>{"use strict";i.d(t,{E:()=>n});const n={longerTransitionMaxDist:10,debugMenu:!!(0,i(21265).hu)("debug","").includes("nav"),TRANSITION_TIME_DH:650}},66272:(e,t,i)=>{"use strict";i.d(t,{T:()=>a,b:()=>l});var n=i(67399),s=i(17321),o=i(81733),r=i(38610);const a=(e,t)=>{if(!e.currentSweepObject)return[];const i=e.currentSweepObject,n=[s.ff(i),s._k(),s.vO(i),s.pI(i.position,t)],r=[o.o7(i.position,t),o.TE(i.position)],a=e.getSweepNeighbours(i);return e.sortByScore(n,r,a)},l=(e,t,i)=>{const a=[s._k(),s._T()],l=[o.Dv(i.point)],c=e.currentSweepObject;t&&c&&a.push(s.ff(c),s.SF(c.position,r.E.longerTransitionMaxDist),s.vO(c)),i.face&&a.push(s.D5(i.point,i.face.normal)),n.$4.hasFloorId(i.object)&&l.push(o.Bv(i.object.floorId));const h=e.sortByScore(a,l);if(0===h.length){const t=e.getClosestSweep(i.point,!0);h.push({sweep:t,score:0})}return h}},13545:(e,t,i)=>{"use strict";i.d(t,{c:()=>HashtagData});var n=i(19413),s=i(90134);class HashtagData extends n.V{constructor(){super(...arguments),this.name="hashtag-data",this.hashtags=(0,s.C)([])}addHashtag(e){const t=e.trim().toLowerCase();-1===this.hashtags.indexOf(t)&&this.hashtags.push(e)}getHashtags(){return this.hashtags.values()}}},77113:(e,t,i)=>{"use strict";var n;i.d(t,{U:()=>n}),function(e){e.CLOSED="closed",e.IDLE="idle",e.CREATING="creating",e.OPENING="opening",e.VIEWING="viewing",e.ANNOTATING="annotating",e.EDITING="editing"}(n||(n={}))},72215:(e,t,i)=>{"use strict";i.d(t,{X:()=>NotesViewData});var n=i(19413),s=i(5442),o=i(90134),r=i(74674),a=i(51090),l=i(77113),c=i(95892);class NotesViewData extends n.V{constructor(e,t,i,n,r){super(),this.data=e,this.attachmentsData=t,this.backgroundTexture=i,this.maskTexture=n,this.jsonStore=r,this.name="notes-view-data",this.notes=(0,o.C)([]),this.annotationViews=(0,o.C)([]),this.noteCreation=!1,this.openNoteViewObservable=(0,s.Y)(null),this.listIndexObservable=(0,s.Y)(-1),this.notesPhaseObservable=(0,s.Y)(l.U.CLOSED),this.notesFilterObservable=(0,s.Y)(c.$.OPEN),this.updateViewData(null)}getNotesList(){return this.notes}onNotesChanged(e){return this.notes.onChanged(e)}getNoteView(e){const t=this.notes.findIndex((t=>t.id===e));return-1!==t?this.notes.get(t):null}updateViewData(e){const t=[];this.data.iterate((e=>{var i;const n=this.createNoteView(e);if(t.push(n),!this.jsonStore){const e=n.comments.get(0);e&&(n.text=e.text,n.edited=e.edited)}(null===(i=this.openNoteView)||void 0===i?void 0:i.id)===n.id&&this.setOpenNoteView(n)})),this.notes.replace(t);const i=this.getFilteredNotes(),n=e?this.getAnnotationSearchResults(i,e):this.getNoteAnnotations(i);this.annotationViews.replace(n.sort(((e,t)=>t.createdTime-e.createdTime)))}createNoteView(e){const t=e.comments.get(0),i=t&&!this.jsonStore?this.attachmentsData.getAttachmentsForAsset(t.id,a.h.COMMENT):this.attachmentsData.getAttachmentsForAsset(e.id,a.h.NOTE);return Object.assign(Object.assign({},e),{attachments:i,backgroundTexture:this.backgroundTexture,maskTexture:this.maskTexture})}getAnnotationViewList(){return this.annotationViews}getFilteredNotes(){const e=this.notesFilter===c.$.ALL,t=this.notesFilter===c.$.RESOLVED,i=[];return this.notes.forEach((n=>{(e||n.resolved===t)&&i.push(n)})),i}getSearchMatch(e,t,i){if(e.blockType===r.C.USER){if(e.id){const i=t.indexOf(e.id);if(-1!==i)return i-2}if(e.value){const i=t.toLowerCase().indexOf(e.value.toLowerCase());if(-1!==i)return t.lastIndexOf("[",i)}if(e.id===i)return 0}else{const i=e.text.toLowerCase();if(i){const e=t.toLowerCase().indexOf(i);if(-1!==e)return e}}return-1}getNoteAnnotations(e){return e.map((e=>{const t=e.comments.get(0);if(!t)throw new Error("No root comment in a note");return{id:e.id,text:t.text,user:e.user,color:e.color,createdTime:e.lastCommentMs,assetType:a.h.NOTE,textIndex:0,numAttachments:e.attachments.length,numComments:e.comments.length}}))}getAnnotationSearchResults(e,t){const i=[];return e.forEach((e=>{e.comments.forEach((n=>{const s=this.getSearchMatch(t,n.text,n.user.id);-1!==s&&i.push({id:n.id,text:n.text,user:n.user,color:e.color,createdTime:n.created.getTime(),assetType:a.h.COMMENT,textIndex:s,numAttachments:this.attachmentsData.getAttachmentsForAsset(n.id,a.h.COMMENT).length,numComments:0,assetId:e.id})}))})),i}getNote(e){const t=this.notes.findIndex((t=>t.id===e));return this.notes.get(t)}get creatingNote(){return this.noteCreation}setCreatingNote(e){this.noteCreation=e}getPendingNote(){return this.noteCreation&&this.openNoteView?this.openNoteView:null}setNotesPhase(e){this.notesPhaseObservable.value=e}get notesPhase(){return this.notesPhaseObservable.value}onNotesPhaseChanged(e){return this.notesPhaseObservable.onChanged(e)}setNotesFilter(e){this.notesFilterObservable.value=e}get notesFilter(){return this.notesFilterObservable.value}onNotesFilterChanged(e){return this.notesFilterObservable.onChanged(e)}setListIndex(e){this.listIndexObservable.value=e}get listIndex(){return this.listIndexObservable.value}onListIndexChanged(e){return this.listIndexObservable.onChanged(e)}setOpenNoteView(e){this.openNoteViewObservable.value=e}get openNoteView(){return this.openNoteViewObservable.value}onOpenNoteViewChanged(e){return this.openNoteViewObservable.onChanged(e)}updateOpenNoteView(e){const t=this.openNoteView;t&&Object.assign(t,e)}}},90039:(e,t,i)=>{"use strict";i.d(t,{yK:()=>NotesModeToggleCommand,yC:()=>PreviewNoteCommand,dR:()=>OpenNoteCommand,xy:()=>OpenStartingNoteCommand,VI:()=>StartNewNoteCommand,FB:()=>SaveNewNoteCommand,gc:()=>CancelNewNoteCommand,_N:()=>CloseNoteCommand,kd:()=>SaveNoteChangesCommand,Wh:()=>CancelNoteChangesCommand,df:()=>ToggleNoteToolEditorCommand,oE:()=>SaveNoteAppearanceCommand,yp:()=>ResolveNoteCommand,sG:()=>DeleteNoteCommand,uT:()=>OpenAnnotationViewCommand,Df:()=>AddCommentCommand,Uw:()=>UpdateCommentCommand,mH:()=>DeleteCommentCommand,pH:()=>AddHashtagCommand});var n=i(99681);class NotesModeToggleCommand extends n.m{constructor(e){super(),this.payload={opened:e}}}class PreviewNoteCommand extends n.m{constructor(e){super(),this.payload={noteId:e}}}class OpenNoteCommand extends n.m{constructor(e,t,i,n=-1,s=!1){super(),this.payload={noteId:e,transition:t,attachmentId:i,listIndex:n,editText:s}}}class OpenStartingNoteCommand extends n.m{constructor(){super()}}class StartNewNoteCommand extends n.m{constructor(){super()}}class SaveNewNoteCommand extends n.m{constructor(e){super(),this.payload={text:e}}}class CancelNewNoteCommand extends n.m{constructor(){super()}}class CloseNoteCommand extends n.m{constructor(){super()}}class SaveNoteChangesCommand extends n.m{constructor(e,t){super(),this.payload={noteId:e,text:t}}}class CancelNoteChangesCommand extends n.m{constructor(e){super(),this.payload={noteId:e}}}class ToggleNoteToolEditorCommand extends n.m{constructor(e){super(),this.payload={opened:e}}}class SaveNoteAppearanceCommand extends n.m{constructor(e,t){super(),this.payload={noteId:e,properties:t}}}class ResolveNoteCommand extends n.m{constructor(e,t){super(),this.payload={noteId:e,resolved:t}}}class DeleteNoteCommand extends n.m{constructor(e){super(),this.payload={noteId:e}}}class OpenAnnotationViewCommand extends n.m{constructor(e,t,i){super(),this.payload={id:e,assetType:t,editText:i}}}class AddCommentCommand extends n.m{constructor(e,t,i){super(),this.payload={noteId:e,text:t,replyId:i}}}class UpdateCommentCommand extends n.m{constructor(e,t,i){super(),this.payload={noteId:e,commentId:t,text:i}}}class DeleteCommentCommand extends n.m{constructor(e,t){super(),this.payload={noteId:e,commentId:t}}}class AddHashtagCommand extends n.m{constructor(e){super(),this.payload={hashtag:e}}}},95892:(e,t,i)=>{"use strict";var n,s;i.d(t,{$:()=>n,Y:()=>s}),function(e){e.OPEN="open",e.RESOLVED="resolved",e.ALL="all"}(n||(n={})),function(e){e.DEFAULT="default",e.HIGHLIGHTED="highlighted",e.DIMMED="dimmed"}(s||(s={}))},26430:(e,t,i)=>{"use strict";i.r(t),i.d(t,{AddCommentCommand:()=>re.Df,AddHashtagCommand:()=>re.pH,CancelNewNoteCommand:()=>re.gc,CancelNoteChangesCommand:()=>re.Wh,CloseNoteCommand:()=>re._N,Comment:()=>Comment,CommentsData:()=>CommentsData,DeleteCommentCommand:()=>re.mH,DeleteNoteCommand:()=>re.sG,HashtagData:()=>ne.c,Note:()=>Note,NoteColorVariant:()=>X.Y,NotesData:()=>NotesData,NotesFilter:()=>X.$,NotesModeOpenedMessage:()=>ae.E,NotesModeToggleCommand:()=>re.yK,NotesPhase:()=>$.U,NotesViewData:()=>ie.X,OpenAnnotationViewCommand:()=>re.uT,OpenNoteCommand:()=>re.dR,OpenStartingNoteCommand:()=>re.xy,PreviewNoteCommand:()=>re.yC,ResolveNoteCommand:()=>re.yp,SaveNewNoteCommand:()=>re.FB,SaveNoteAppearanceCommand:()=>re.oE,SaveNoteChangesCommand:()=>re.kd,StartNewNoteCommand:()=>re.VI,ToggleNoteToolEditorCommand:()=>re.df,UpdateCommentCommand:()=>re.Uw,default:()=>Me});var n=i(54122),s=i(57501),o=i(25799),r=i(17256),a=i(21265),l=i(60778),c=i(28636),h=i(27314),d=i(62367),u=i(47924),p=i(90601),m=i(43711),g=i(6201),f=i(48769),v=i(71583),y=i(91843),b=i(51090),w=i(21517),S=i(63838),E=i(72386),T=i(29675),M=i(3471),_=i(77956),x=i(12775),A=i(39936),O=i(75711),P=i(25936),C=i(22729),D=i(46101),I=i(51418),R=i(55525),L=i(80034),N=i(80994),k=i(32020),B=i(31305),F=i(78909),U=i(90134),V=i(80807);class Comment extends F.T{constructor(e){super(),this.id="",this.assetId="",this.assetType=b.h.NOTE,this.text="",this.user=(0,V.Q)(""),this.created=new Date,this.modified=new Date,this.edited=!1,this.attachments=(0,U.C)([]),e&&Object.assign(this,e)}copy(e){return this.id=e.id,this.user=e.user,this.assetId=e.assetId,this.assetType=e.assetType,this.created.setTime(e.created.getTime()),this.modified.setTime(e.modified.getTime()),this.text=e.text,this.edited=e.edited,this.attachments=e.attachments,this.commit(),this}}class CommentSerializer{constructor(){}serialize(e){if(!e)return null;return{id:e.id,assetId:e.assetId,assetType:e.assetType,text:e.text,user:e.user.id,edited:e.edited,created:(0,k.U)(e.created),modified:(0,k.U)(e.modified)}}}class CommentDeserializer{constructor(){}deserialize(e){if(!this.validate(e))return null;const t=new Comment;return t.id=e.id,t.assetId=e.assetId,t.assetType=e.assetType,t.text=e.text,t.user=new B.a({id:e.user,email:""}),t.edited=e.edited,t.created=(0,k.p)(e.created),t.modified=(0,k.p)(e.modified),t}validate(e){if(!e||"object"!=typeof e)return!1;return["id","text","user","assetId","assetType","edited","created","modified"].every((t=>t in e))}}var H=i(61155),G=i(90926),z=i(43770),j=i(68611),W=i(43098),Z=i(90991),q=i(73305),K=i(36520),Y=i(98507),$=i(77113),X=i(95892),Q=i(2212),J=i(83455);class Note extends F.T{constructor(e){super(),this.id="",this.color=J.Rn,this.anchorPosition=new Q.Vector3,this.stemNormal=new Q.Vector3,this.stemLength=J.ZP.stem.length,this.stemEnabled=!0,this.created=new Date,this.modified=new Date,this.lastCommentMs=(new Date).getTime(),this.resolved=!1,this.user=(0,V.Q)(""),this.comments=(0,U.C)([]),this.edited=!1,this.text="",e&&Object.assign(this,e)}copy(e){return this.id=e.id,this.user=e.user,this.text=e.text,this.edited=e.edited,this.resolved=e.resolved,this.color=e.color,this.floorId=e.floorId,this.roomId=e.roomId,this.anchorPosition.copy(e.anchorPosition),this.stemNormal.copy(e.stemNormal),this.stemLength=e.stemLength,this.stemEnabled=e.stemEnabled,this.created.setTime(e.created.getTime()),this.modified.setTime(e.modified.getTime()),this.lastCommentMs=e.lastCommentMs,this.comments=e.comments,this.commit(),this}getComment(e){return this.comments.find((t=>t.id===e))||null}updateComment(e){const t=this.comments.findIndex((t=>t.id===e.id));-1!==t&&(e.assetId=this.id,this.comments.update(t,e))}}var ee=i(19413),te=i(71229);class NotesData extends ee.V{constructor(e){super(),this.name="notes-data",this.notes=(0,te.q)(e)}iterate(e){for(const t of this.notes)e(t)}addNote(e){this.notes.has(e.id)?this.notes.get(e.id).copy(e):this.notes.set(e.id,e)}updateNote(e,t){if(this.notes.has(e)){const i=this.notes.get(e);let n=!1;void 0!==t.text&&t.text!==i.text&&(i.text=t.text,i.edited=!0,n=!0),void 0!==t.resolved&&t.resolved!==i.resolved&&(i.resolved=t.resolved,n=!0),void 0!==t.color&&t.color!==i.color&&(i.color=t.color,n=!0),void 0!==t.anchorPosition&&t.anchorPosition!==i.anchorPosition&&(i.anchorPosition=t.anchorPosition,n=!0),void 0!==t.stemNormal&&t.stemNormal!==i.stemNormal&&(i.stemNormal=t.stemNormal,n=!0),void 0!==t.stemLength&&t.stemLength!==i.stemLength&&(i.stemLength=t.stemLength,n=!0),void 0!==t.stemEnabled&&t.stemEnabled!==i.stemEnabled&&(i.stemEnabled=t.stemEnabled,n=!0),void 0!==t.floorId&&t.floorId!==i.floorId&&(i.floorId=t.floorId,n=!0),void 0!==t.roomId&&t.roomId!==i.roomId&&(i.roomId=t.roomId,n=!0),n&&(i.modified=new Date,i.commit())}}removeNote(e){this.notes.has(e)&&(this.notes.delete(e),this.commit())}getNote(e){return this.notes.get(e)}getNoteProperties(e){const t=this.notes.get(e);if(!t)return null;return Object.assign({},t)}get collection(){return this.notes}}var ie=i(72215),ne=i(13545);const se=new o.Z("comments-data");class CommentsData extends ee.V{constructor(e){super(),this.jsonStore=e,this.name="comments-data",this.comments=(0,te.q)()}async load(){if(!this.jsonStore)return se.error("Comment JSON storage is not configured"),this.comments;const e=await this.jsonStore.read()||{};for(const t in e)this.comments.set(t,e[t]);return this.comments}async save(e){if(!this.jsonStore)return void se.error("Comment JSON storage is not configured");const t=e?{[e.id]:e}:this.comments.deepCopy();return this.jsonStore.update(t)}iterate(e){for(const t of this.comments)e(t)}addComment(e){this.comments.has(e.id)?this.comments.get(e.id).copy(e):this.comments.set(e.id,e)}updateCommentText(e,t){if(this.comments.has(e)){const i=this.comments.get(e);i.text!==t&&(i.text=t,i.modified=new Date,i.edited=!0,i.commit())}}removeComment(e){this.comments.has(e)&&(this.comments.delete(e),this.commit(),this.jsonStore&&this.jsonStore.update({[e]:null}))}removeCommentsForNote(e){const t={};this.iterate((i=>{i.assetType===b.h.NOTE&&i.assetId===e&&(t[i.id]=null,this.comments.delete(i.id))})),Object.keys(t).length&&(this.commit(),this.jsonStore&&this.jsonStore.update(t))}getCommentsForNote(e){const t=[];return this.iterate((i=>{i.assetType===b.h.NOTE&&i.assetId===e&&t.push(i)})),t}getCommentsForAllNotes(){const e=[];return this.iterate((t=>{t.assetType===b.h.NOTE&&e.push(t)})),e}getComment(e){return this.comments.get(e)}get collection(){return this.comments}}var oe,re=i(90039),ae=i(5261),le=i(70110),ce=i(32400),he=i(61111),de=i(51770),ue=i(67420);!function(e){e.RESOLVED="resolved",e.OPEN="open"}(oe||(oe={}));var pe=i(60982),me=i(97620);const ge=new o.Z("mds-note-serialize");class MdsNoteCreateSerializer{constructor(){this.getNoteDetails=e=>{const t={enabled:!0,floorId:"",roomId:""};if(void 0!==e.floorId&&""!==e.floorId&&(t.floorId=e.floorId),void 0!==e.roomId&&""!==e.roomId&&(t.roomId=e.roomId),void 0!==e.color&&""!==e.color&&(t.color=e.color),void 0!==e.stemEnabled&&(t.stemEnabled=e.stemEnabled),void 0!==e.stemLength&&(t.stemLength=e.stemLength),void 0!==e.anchorPosition&&(0,pe.uU)(e.anchorPosition)&&(t.anchorPosition=me.ep.toVisionVector(e.anchorPosition)),void 0!==e.stemNormal&&(0,pe.uU)(e.stemNormal)&&(t.stemNormal=me.ep.toVisionVector(e.stemNormal)),void 0!==e.resolved&&(t.resolution=e.resolved?oe.RESOLVED:oe.OPEN),void 0!==e.text){const i={text:e.text};t.comment=i}return Object.keys(t).length>0?t:null},this.validate=e=>{if(!e)return!1;const t=["floorId","roomId","enabled"].filter((t=>!(t in e))),i=0===t.length,n=!!e.floorId&&"string"==typeof e.floorId,s=!!e.anchorPosition&&(0,pe.uU)(e.anchorPosition),o=i&&n&&s;return o||ge.debug("Note invalid:",{missingFields:t,validPosition:s}),o}}serialize(e){const t=this.getNoteDetails(e);return this.validate(t)?t:null}}class MdsNotePatchSerializer{constructor(){this.getNotePatch=e=>{if(!e)return null;const t={};return void 0!==e.floorId&&""!==e.floorId&&(t.floorId=e.floorId),void 0!==e.roomId&&""!==e.roomId&&(t.roomId=e.roomId),void 0!==e.color&&""!==e.color&&(t.color=e.color),void 0!==e.stemEnabled&&(t.stemEnabled=e.stemEnabled),void 0!==e.stemLength&&(t.stemLength=e.stemLength),void 0!==e.anchorPosition&&(0,pe.uU)(e.anchorPosition)&&(t.anchorPosition=me.ep.toVisionVector(e.anchorPosition)),void 0!==e.stemNormal&&(0,pe.uU)(e.stemNormal)&&(t.stemNormal=me.ep.toVisionVector(e.stemNormal.normalize())),Object.keys(t).length>0?t:null},this.validate=e=>{if(!e)return!1;const t=["floorId","roomId","color","anchorPosition","stemNormal","stemLength","stemEnabled","stemNormal","enabled"];return Object.keys(e).every((e=>t.includes(e)))}}serialize(e){const t=this.getNotePatch(e);return t&&this.validate(t)?t:null}}const fe=new o.Z("mds-note-deserializer");class MdsNoteDeserializer{constructor(e,t){this.commentDeserializer=e,this.userData=t,this.validate=e=>{if(!e)return!1;const t=["id","created","modified","floor","resolution"].filter((t=>!(t in e))),i=0===t.length,n=!(!e.floor||!e.floor.id);return i&&n||fe.debug("Note invalid:",{missingFields:t,validFloor:n}),i&&n}}deserialize(e){if(!e||!this.validate(e))return fe.debug("Deserialized invalid Note data from MDS",e),null;const t=new Note;t.id=e.id,t.floorId=e.floor.id,e.room&&e.room.id&&(t.roomId=e.room.id),t.resolved=e.resolution===oe.RESOLVED,t.created=(0,k.p)(e.created),t.modified=(0,k.p)(e.modified),t.user=this.userData.loadUser(e.createdBy),t.lastCommentMs=(0,k.p)(e.lastCommentAt).getTime();const i=this.deserializeComments(e);if(!(i.length>0))return fe.error("Note without a comment:",t.id),null;{const e=i[0];e.text&&(t.text=e.text),t.edited=e.edited,t.comments.replace(i)}e.color&&(t.color=e.color);const n=e.anchorPosition?me.ep.fromVisionVector(e.anchorPosition):void 0;n&&(t.anchorPosition=n),void 0!==e.stemLength&&(t.stemLength=e.stemLength);const s=e.stemNormal?me.ep.fromVisionVector(e.stemNormal):void 0;return s?(t.stemNormal=s,t.stemEnabled=!!e.stemEnabled):(t.stemNormal=new Q.Vector3(0,0,0),t.stemEnabled=!!e.stemEnabled),t}deserializeComments(e){const t=(0,de.qw)(e,"comments.results")||[],i=[];return t.forEach((t=>{const n=this.commentDeserializer.deserialize(t);n&&(n.assetId=e.id,n.assetType=b.h.NOTE,i.push(n))})),i}}class MdsCommentSerializer{constructor(){this.validate=e=>!!e}serialize(e){if(void 0===e.text)return null;const t={text:e.text};return t&&this.validate(t)?t:null}}const ve=new o.Z("mds-comment-deserializer");class MdsCommentDeserializer{constructor(e,t){this.attachmentDeserializer=e,this.userData=t}deserialize(e){if(!e||!this.validate(e))return ve.debug("Deserialized invalid Comment data from MDS",e),null;const t=new Comment;t.id=e.id,t.created=(0,k.p)(e.created),t.modified=(0,k.p)(e.modified),e.text&&(t.text=e.text),t.edited=e.edited,t.user=this.userData.loadUser(e.createdBy);const i=this.deserializeAttachments(e);return i.length>0&&t.attachments.replace(i),t}deserializeAttachments(e){const t=(0,de.qw)(e,"externalAttachments")||[],i=[];return t.forEach((t=>{const n=this.attachmentDeserializer.deserialize(t);n&&(n.assetId=e.id,n.assetType=b.h.COMMENT,i.push(n))})),i}validate(e){if(!e)return!1;const t=["id","created","modified","edited","createdBy"].filter((t=>!(t in e))),i=0===t.length;return i||ve.debug("Comment invalid:",{missingFields:t}),i}}var ye=i(20619);const be=new o.Z("MdsNoteStore");class MdsNoteStore extends ce.u{constructor(e,t){super(e),this.userData=t,this.prefetchKey="data.model.notes",this.attachmentDeserializer=new ue.E,this.commentDeserializer=new MdsCommentDeserializer(this.attachmentDeserializer,this.userData),this.deserializer=new MdsNoteDeserializer(this.commentDeserializer,this.userData),this.createSerializer=new MdsNoteCreateSerializer,this.patchSerializer=new MdsNotePatchSerializer,this.commentSerializer=new MdsCommentSerializer}async read(e){const t={includeDisabled:!0,modelId:this.getViewId()};return this.query(ye.GetNotes,t,e).then((e=>{var t,i;const n=null===(i=null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.model)||void 0===i?void 0:i.notes;if(!n||!Array.isArray(n))return null;const s=[];for(const e of n){const t=this.deserializer.deserialize(e);t&&s.push(t)}return s.reduce(((e,t)=>(e[t.id]=t,e)),{})}))}async create(e){if(this.config.readonly)throw new he.d7;const t=this.getViewId(),i=this.createSerializer.serialize(e);if(!i)throw be.error("Failure creating note:",e.id,e),new Error("Could not create Note");return this.mutate(ye.AddNote,{modelId:t,data:i}).then((e=>{if(be.debug(Object.assign({type:"addNote"},e)),e.errors&&e.errors.length>0)throw be.error(Object.assign({},e)),new Error("MdsNoteStore.create failed");return this.deserializer.deserialize((0,de.qw)(e,"data.addNote"))}))}async update(e){if(this.config.readonly)throw new he.d7;const t=this.getViewId(),i=e.id,n=this.patchSerializer.serialize(e);if(!n)throw be.error("Failure updating note:",i),new Error("Could not update Note");return this.mutate(ye.PatchNote,{modelId:t,noteId:i,data:n}).then((e=>{be.debug(Object.assign({type:"patchNote"},e))}))}async updateResolution(e,t){if(this.config.readonly)throw new he.d7;const i=this.getViewId(),n=t?ye.ResolveNote:ye.ReopenNote,s=t?"data.resolveNote":"data.reopenNote";return this.mutate(n,{modelId:i,noteId:e}).then((e=>{if(be.debug(Object.assign({},e)),e.errors&&e.errors.length>0)throw be.error(Object.assign({},e)),new Error(`MdsNoteStore.${n} failed`);return(0,de.qw)(e,s)}))}async delete(e){if(this.config.readonly)throw new he.d7;const t=this.getViewId();return Promise.all(e.map((e=>{if(!e||e&&!e.id)throw new Error("MdsNoteStore.delete failed");return this.mutate(ye.DeleteNote,{modelId:t,noteId:e.id}).then((e=>{if(be.debug(Object.assign({},e)),e.errors&&e.errors.length>0)throw be.error(Object.assign({},e)),new Error("MdsNoteStore.delete failed")}))})))}async createComment(e,t){if(this.config.readonly)throw new he.d7;const i=this.getViewId(),n=this.commentSerializer.serialize(t);if(!n)throw be.error("Failure creating comment:",t),new Error("Could not create Comment");return this.mutate(ye.AddNoteComment,{modelId:i,noteId:e,data:n}).then((e=>{if(be.debug(Object.assign({type:"AddNoteComment"},e)),e.errors&&e.errors.length>0)throw be.error(Object.assign({},e)),new Error("MdsNoteStore.createComment failed");return this.commentDeserializer.deserialize((0,de.qw)(e,"data.addNoteComment"))}))}async updateComment(e){if(this.config.readonly)throw new he.d7;const t=this.getViewId(),i=e.id,n=this.commentSerializer.serialize(e);if(!n)throw be.error("Failure updating comment:",i),new Error("Could not update Comment");return this.mutate(ye.PatchComment,{modelId:t,commentId:i,data:n}).then((e=>(be.debug(Object.assign({type:"PatchComment"},e)),this.commentDeserializer.deserialize((0,de.qw)(e,"data.patchComment")))))}async deleteComment(e){if(this.config.readonly)throw new he.d7;const t=this.getViewId();if(!e||e&&!e.id)throw new Error("MdsNoteStore.deleteComment failed");return this.mutate(ye.DeleteComment,{modelId:t,commentId:e.id}).then((e=>{if(be.debug(Object.assign({},e)),e.errors&&e.errors.length>0)throw be.error(Object.assign({},e)),new Error("MdsNoteStore.deleteComment failed")}))}}var we=i(40032);const Se=new o.Z("NoteSerializer");class NoteSerializer{constructor(e){this.floorsData=e}serialize(e){if(!e)return null;const t=this.floorsData.hasFloor(e.floorId)&&this.floorsData.getFloor(e.floorId);if(!t)return null;return{id:e.id,resolved:e.resolved,text:e.text,user:e.user.id,edited:e.edited,color:e.color,stemLength:e.stemLength,stemEnabled:e.stemEnabled,anchorPosition:(0,we.m)(e.anchorPosition),stemNormal:(0,we.m)(e.stemNormal),floor:t.index,created:(0,k.U)(e.created),modified:(0,k.U)(e.modified)}}}class NoteDeserializer{constructor(e,t){this.commentsData=e,this.floorsData=t}deserialize(e){const t=this.floorsData.getFloorAtIndex(e.floor);if(!this.validate(e)||!t)return Se.debug("Deserialized invalid Note",e),null;const i=new Note;return i.id=e.id,i.text=e.text,i.user=new B.a({id:e.user,email:""}),i.edited=e.edited,i.resolved=!!e.resolved,i.color=e.color||J.Rn,i.stemLength=isNaN(e.stemLength)?J.ZP.stem.length:e.stemLength,i.stemEnabled=void 0===e.stemEnabled||e.stemEnabled,i.anchorPosition=new Q.Vector3(e.anchorPosition.x,e.anchorPosition.y,e.anchorPosition.z),i.stemNormal=new Q.Vector3(e.stemNormal.x,e.stemNormal.y,e.stemNormal.z).normalize(),i.floorId=t.id,i.created=(0,k.p)(e.created),i.modified=(0,k.p)(e.modified),i.lastCommentMs=i.created.getTime(),Ee(i,this.commentsData),i}validate(e){if(!e||"object"!=typeof e)return!1;return["id","text","user","edited","resolved","color","floor","stemLength","stemEnabled","anchorPosition","stemNormal","created","modified"].every((t=>t in e))}}function Ee(e,t){let i=(0,d.O1)(11);for(;t.getComment(i);)i=(0,d.O1)(11);const n=[new Comment({id:i,assetId:e.id,assetType:b.h.NOTE,text:e.text,created:e.created,modified:e.modified,user:e.user})];n.push(...t.getCommentsForNote(e.id));const s=e.lastCommentMs;n.forEach((t=>{const i=t.created.getTime();i>s&&(e.lastCommentMs=i)})),e.comments.replace(n.sort(((e,t)=>e.created.getTime()-t.created.getTime())))}const Te=new o.Z("notes-module");class NotesModule extends n.Y{constructor(){super(...arguments),this.name="notes",this.startingNote=null,this.activated=!1,this.registered=!1,this.activeBindings=[],this.refreshPromise=null,this.pollOnNotes=()=>{let e;return(0,s.k1)((()=>{clearInterval(e),e=window.setInterval((()=>{this.refreshNotes()}),1e3*J.GR)}),(()=>{window.clearInterval(e)}),!0)},this.updatePerSettings=()=>{const e=this.settingsData.tryGetProperty(J.Mp,!1),t=!this.in360View(),i=!this.interactionmodeData.isVR(),n=t&&i&&e,s=n?this.getFilteredNoteIds(!1):[];this.pinRenderer.fadePinOpacityByType(G.Er.NOTE,n?1:0,s)},this.userOpenedNotesMode=()=>{this.toolsData.setToolAccess(p.X$.TOOL)},this.toggleNotesMode=async e=>{e.opened?this.activateTool():this.deactivateTool()},this.addHashtag=async e=>{this.addHashtags(e.hashtag),this.hashtagData.commit()},this.togglePinAssetEditor=async e=>{e.opened?this.viewData.setNotesPhase($.U.EDITING):this.viewData.notesPhase===$.U.EDITING&&this.viewData.setNotesPhase($.U.VIEWING)},this.openStartingNote=async()=>{if(this.startingNote){const e=this.viewData,t=e.getNoteView(this.startingNote);if(!t)return;this.startingNote=null,t.resolved&&e.setNotesFilter(X.$.ALL),await this.engine.commandBinder.issueCommand(new m.tT(p.w1.NOTES,!0)),await(0,d.gw)(500),this.openNote(t.id,u.n.FadeToBlack,(0,a.AO)().comment)}},this.onAppChange=()=>{this.deactivateTool(),this.updatePerSettings()},this.onCloseNote=async()=>{this.closeNote()},this.pinAddCancelled=e=>{e.pinType===G.Er.NOTE&&this.cancelNoteCreation()},this.onCancelNewNote=async()=>{this.cancelNoteCreation()},this.cancelNoteCreation=()=>{const e=this.viewData;this.userData.isCommenter()&&(this.engine.broadcast(new z.w0(G.Er.NOTE)),this.engine.broadcast(new g.Ur),this.cancelAttachmentChanges(),e.setCreatingNote(!1),e.setOpenNoteView(null),e.setNotesPhase($.U.IDLE))},this.noteWasAdded=(e,t)=>{this.updateNotePin(e)},this.noteWasUpdated=(e,t)=>{this.updateNotePin(e)},this.notesWereChanged=()=>{this.updateNoteViewData()},this.onNoteFilterChanged=()=>{this.viewData.setOpenNoteView(null),this.updateNoteViewData(),this.updateNoteVisibility()},this.onSearchBlockChanged=()=>{this.closeNote(),this.updateNoteViewData()},this.onViewModeOrFloorChanged=()=>{this.updatePerSettings()},this.onOpenNoteViewChanged=()=>{const e=this.viewData.openNoteView;e&&this.updateNotePin(e)},this.startNoteCreation=async()=>{if(!this.userData.isCommenter())return;const e=this.viewData;let t=(0,d.O1)(11);for(;this.notesData.getNote(t);)t=(0,d.O1)(11);const i=new Note;i.user=this.userData.getCurrentUser(),i.id=t,i.floorId=this.floorsViewData.getHighestVisibleFloor().id;const n=e.createNoteView(i);e.setCreatingNote(!0),e.setNotesPhase($.U.CREATING),e.setOpenNoteView(n),this.engine.broadcast(new z.nO(n,G.Er.NOTE)),this.engine.commandBinder.issueCommand(new W.B)},this.saveNewNote=async e=>{if(!this.userData.isCommenter())return;const{text:t}=e,i=this.viewData,n=i.getPendingNote();if(n){let e;if(n.text=t,this.config.storageProvider===r.Xq.JSONSTORE)e=new Note,e.copy(n),e.created=new Date,e.modified=new Date,Ee(e,this.commentsData),await this.store.update({[e.id]:e}),await this.confirmAttachmentChanges(e.id,b.h.NOTE,n.id);else{const t=await this.store.create(n);if(!t)return void Te.error("MDS Note saved failed");e=t;const i=e.comments.get(0);if(!i)throw new Error("No root comment in the new note");await this.confirmAttachmentChanges(i.id,b.h.COMMENT,n.id,b.h.NOTE)}this.pinRenderer.removePin(n.id),this.notesData.addNote(e),t&&this.addHashtags(t),i.setCreatingNote(!1);if(0===(0,le.l)(e.text,this.userData,w.x.PUBLIC).length)this.closeNote();else{i.setOpenNoteView(i.getNoteView(e.id));const t=i.openNoteView;t&&this.engine.broadcast(new z.sD(t,G.Er.NOTE,this.userData.isCommenter()))}}else Te.debug("No pending note")},this.pinMoved=e=>{const t=this.viewData.openNoteView;if(t&&e.pinType===G.Er.NOTE&&e.id===t.id){const t=this.notesData.getNote(e.id);t?(this.notesData.updateNote(e.id,e.pinPos),this.saveNoteChangesToStore(t,e.pinPos)):Te.debug("Cannot move a non-existent note")}},this.pinPlaced=e=>{const t=this.viewData.openNoteView;t&&e.pinType===G.Er.NOTE&&e.id===t.id&&(this.viewData.updateOpenNoteView(e.pinPos),this.viewData.setNotesPhase($.U.OPENING),this.viewData.setNotesPhase($.U.ANNOTATING),this.engine.broadcast(new g.ZL(b.h.NOTE,t.id)))},this.pinDeselected=e=>{const{openNoteView:t,notesPhase:i}=this.viewData;t&&e.pinType===G.Er.NOTE&&e.id===t.id&&i===$.U.VIEWING&&this.closeNote()},this.openAnnotationView=async e=>{const t=this.viewData.getAnnotationViewList().values(),i=t.findIndex((t=>t.id===e.id&&t.assetType===e.assetType));if(-1===i)return void Te.debug("annotationId not in list");const n=t[i];if(!n)return void Te.debug("Cannot open non-existent list annotation");const s=n.assetType===b.h.COMMENT,o=s&&n.assetId?n.assetId:n.id,r=s?n.id:void 0,a=this.toolsData.toolPanelLayout===p.wS.SIDE_PANEL?u.n.FadeToBlack:u.n.Instant;this.openNote(o,a,r,void 0,i,e.editText)},this.previewNote=async e=>{const t=this.viewData.getNoteView(e.noteId);t&&this.engine.commandBinder.issueCommand(new j._l(t,G.Er.NOTE))},this.onOpenNote=async e=>this.openNote(e.noteId,e.transition,void 0,e.attachmentId,e.listIndex,e.editText),this.deleteNote=async e=>{const t=e.noteId,i=this.notesData.getNote(t);if(i){if(this.engine.commandBinder.issueCommand(new v.rE),this.config.storageProvider===r.Xq.JSONSTORE){await this.engine.commandBinder.issueCommand(new q.Qm(t,b.h.NOTE));const e=i.comments.map((e=>e.id));await this.engine.commandBinder.issueCommand(new q.HC(e,b.h.COMMENT)),this.commentsData.removeCommentsForNote(i.id),await this.store.update({[t]:null})}else{this.store.delete([i]);const e=i.comments.map((e=>e.id));await this.engine.commandBinder.issueCommand(new q.HC(e,b.h.COMMENT))}this.notesData.removeNote(t),this.engine.broadcast(new z.VZ(t,G.Er.NOTE));const e=this.viewData.openNoteView;e&&e.id===t&&this.closeNote()}else Te.debug("Cannot delete a non-existent note")},this.onResolveNoteCommand=async e=>{this.toggleNoteResolution(e.noteId,e.resolved)},this.onSaveNoteChanges=async e=>{const{noteId:t,text:i}=e,n=this.notesData,s=this.viewData,o=n.getNote(t);if(o)if(this.config.storageProvider===r.Xq.MDS){const e=o.comments.get(0);e?(await this.updateNoteComment(t,e.id,i),s.updateOpenNoteView({text:i,edited:!0})):Te.warn("no root comment")}else{const{user:e}=o;e.id===this.userData.getCurrentUserId()?(i&&this.addHashtags(i),o.resolved&&(s.setNotesFilter(X.$.ALL),await this.toggleNoteResolution(t,!1)),s.updateOpenNoteView({text:i,edited:!0}),n.updateNote(t,{text:i,edited:!0}),this.saveNoteChangesToStore(o),await this.confirmAttachmentChanges(o.id,b.h.NOTE),this.viewData.setNotesPhase($.U.VIEWING)):Te.debug("Cannot update another user's note text")}else Te.debug("Cannot update a non-existent note")},this.cancelNoteChanges=async e=>{const t=this.viewData.openNoteView;t&&t.id===e.noteId&&this.resetOpenNoteView(),this.cancelAttachmentChanges(),this.viewData.setNotesPhase($.U.VIEWING)},this.saveNoteAppearance=async e=>{const t=this.notesData,i=this.viewData,n=t.getNote(e.noteId);if(n){const s=e.properties;if(Object.keys(s)){i.updateOpenNoteView(s);const e=i.openNoteView;e&&this.engine.broadcast(new z.KR(e,G.Er.NOTE)),t.updateNote(n.id,s),this.saveNoteChangesToStore(n,s)}}else Te.debug("Cannot update a non-existent note")},this.addComment=async e=>{const{noteId:t,text:i,replyId:n}=e,s=this.notesData.getNote(t);if(s){let e;if(s.resolved&&(this.viewData.setNotesFilter(X.$.ALL),await this.toggleNoteResolution(s.id,!1)),this.config.storageProvider===r.Xq.JSONSTORE){let n=(0,d.O1)(11);for(;this.commentsData.getComment(n);)n=(0,d.O1)(11);e=new Comment({id:n,assetId:t,assetType:b.h.NOTE,user:this.userData.getCurrentUser(),created:new Date,modified:new Date,text:i}),this.commentsData.addComment(e),await this.commentsData.save(e)}else{const n=await this.store.createComment(t,{text:i});if(!n)return Te.error("Cannot create MDS comment"),null;e=n}return this.addHashtags(i),this.viewData.setNotesPhase($.U.VIEWING),await this.confirmAttachmentChanges(e.id,b.h.COMMENT,n),this.refreshNotes(),e}return Te.debug("Cannot add a comment to a non-existent note"),null},this.onUpdateComment=async e=>{const{noteId:t,commentId:i,text:n}=e;return this.updateNoteComment(t,i,n)},this.deleteComment=async e=>{const{commentId:t,noteId:i}=e,n=this.notesData.getNote(i);if(n){if(await this.engine.commandBinder.issueCommand(new q.rh),await this.engine.commandBinder.issueCommand(new q.N0),await this.engine.commandBinder.issueCommand(new q.Qm(t,b.h.COMMENT)),this.config.storageProvider===r.Xq.JSONSTORE)await this.commentsData.removeComment(t),await this.commentsData.save();else{const e=n.getComment(t);e&&await this.store.deleteComment(e)}this.refreshNotes()}else Te.debug("Cannot delete a comment in a non-existent note")}}async init(e,t){const[i,n,s]=await Promise.all([t.market.waitForData(A.e),t.market.waitForData(O.Z),t.market.waitForData(S.m)]);if(!s.isLoggedIn()||n.isVR()||!i.tryGetProperty(J.IA,!1))return;this.engine=t,this.config=e,this.startingNote=e.startingNote||null,this.interactionmodeData=n,this.userData=s,this.settingsData=i;const[o]=await Promise.all([t.getModule(H.default)]);this.pinRenderer=o.pinRenderer;const[a,d,u,p,m,g,v,y]=await Promise.all([t.market.waitForData(T.pu),t.market.waitForData(f.t),t.market.waitForData(_.Z),t.market.waitForData(x.O),t.market.waitForData(K.b),t.market.waitForData(P.i),t.market.waitForData(C.c),t.market.waitForData(Z.A)]);this.appData=a,this.toolsData=d,this.sweepData=u,this.viewmodeData=p,this.attachmentsData=m,this.floorsViewData=v,this.annotationsViewData=y,await this.getCommentsStore(),this.store=this.getStore(g);const b=await this.store.read();this.notesData=new NotesData(b||{}),t.market.register(this,NotesData,this.notesData),e.storageProvider===r.Xq.JSONSTORE?await this.loadNoteAndCommentUsers():this.loadAttachments(),await this.loadUserMentions(),this.maskTexture=(0,l.p)(h),this.backgroundTexture=(0,l.p)(c),this.viewData=new ie.X(this.notesData,this.attachmentsData,this.backgroundTexture,this.maskTexture,e.storageProvider===r.Xq.JSONSTORE),this.hashtagData=new ne.c,t.market.register(this,ne.c,this.hashtagData),this.bindings.push(i.onPropertyChanged(J.Mp,this.updatePerSettings),t.commandBinder.addBinding(re.yK,this.toggleNotesMode),t.commandBinder.addBinding(re.dR,this.onOpenNote),t.commandBinder.addBinding(re.yC,this.previewNote),t.commandBinder.addBinding(re.xy,this.openStartingNote),t.subscribe(M.bS,this.onAppChange),p.makeModeChangeSubscription(this.onViewModeOrFloorChanged),v.makeFloorChangeSubscription(this.onViewModeOrFloorChanged),t.subscribe(D.Z,this.updatePerSettings),t.subscribe(I.m,this.updatePerSettings),t.subscribe(ae.E,this.userOpenedNotesMode),this.pollOnNotes()),t.market.register(this,ie.X,this.viewData),this.updatePerSettings(),this.displayNotes()}dispose(e){this.deactivateTool(),this.bindings.forEach((e=>{e.cancel()})),this.bindings=[],this.activeBindings=[],this.pinRenderer.removePinsByType(G.Er.NOTE),this.maskTexture.dispose(),this.backgroundTexture.dispose(),super.dispose(e)}onUpdate(){}async refreshNotes(){if(this.refreshPromise)return;const{creatingNote:e,notesPhase:t}=this.viewData,i=t===$.U.ANNOTATING||t===$.U.EDITING;if(e||i)return;this.refreshPromise=this.store.read().finally((()=>{this.refreshPromise=null}));const n=await this.refreshPromise||{},s=Object.values(n),{collection:o}=this.notesData;this.notesData.atomic((()=>{const e=o.keys.filter((e=>!n[e]));if(e.length&&e.forEach((e=>{o.delete(e)})),s.length){const e=this.config.storageProvider===r.Xq.JSONSTORE;s.forEach((t=>{e&&Ee(t,this.commentsData),this.notesData.addNote(t)}))}}))}activateTool(){this.activated||(this.config.workshop&&(this.appData.application===T.Mx.WORKSHOP&&this.engine.commandBinder.issueCommand(new v.Mn(!1)),this.engine.commandBinder.issueCommand(new y.KW(!1))),this.userData.isCommenter()&&this.engine.commandBinder.issueCommand(new j.EP(!0)),this.viewData.setNotesPhase($.U.IDLE),this.collectHashtags(),this.registered?this.activeBindings.forEach((e=>{e.renew()})):this.registerHandlers(),this.activated=!0)}deactivateTool(){if(!this.activated)return;const{creatingNote:e,openNoteView:t}=this.viewData;e?this.cancelNoteCreation():t&&this.closeNote(),this.annotationsViewData.setSearchBlock(null),this.viewData.setNotesPhase($.U.CLOSED),this.engine.commandBinder.issueCommand(new j.EP(!1)),this.config.workshop&&(this.appData.application===T.Mx.WORKSHOP&&this.engine.commandBinder.issueCommand(new v.Mn(!0)),this.engine.commandBinder.issueCommand(new y.KW(!0))),this.activeBindings.forEach((e=>{e.cancel()})),this.activated=!1}getStore(e){const{modelId:t,baseUrl:i,queue:n,readonly:s,storageProvider:o}=this.config;if(Te.info(`Loading Notes from ${o}`),o===r.Xq.MDS)return new MdsNoteStore({readonly:s,includeDisabled:!0,baseUrl:i,viewId:t},this.userData);{const s=new N.A({serializer:new NoteSerializer(e),deserializer:new NoteDeserializer(this.commentsData,e)});return new L.MU({queue:n,path:`${i}/api/v1/jsonstore/model/notes/${t}`,batchUpdate:!0,httpMethod:L.w$.PATCH,deserialize:e=>s.deserialize(e),serialize:e=>s.serialize(e)})}}async getCommentsStore(){const{modelId:e,baseUrl:t,queue:i,storageProvider:n}=this.config;if(n===r.Xq.JSONSTORE){Te.info("Loading Comments from Jsonstore");const n=new N.A({serializer:new CommentSerializer,deserializer:new CommentDeserializer}),s=new L.MU({queue:i,path:`${t}/api/v1/jsonstore/model/comments/${e}`,batchUpdate:!0,httpMethod:L.w$.PATCH,deserialize:e=>n.deserialize(e),serialize:e=>n.serialize(e)});this.commentsData=new CommentsData(s),await this.commentsData.load(),this.engine.market.register(this,CommentsData,this.commentsData)}}async saveNoteChangesToStore(e,t={}){return this.config.storageProvider===r.Xq.JSONSTORE?this.store.update({[e.id]:e}):(t.id=e.id,this.store.update(t))}registerHandlers(){const e=this.engine.commandBinder;this.activeBindings.push(this.engine.subscribe(z.b0,this.pinPlaced),this.engine.subscribe(z.bV,this.pinMoved),this.engine.subscribe(z.hu,this.pinAddCancelled),this.engine.subscribe(z.Fe,this.pinDeselected),e.addBinding(re.VI,this.startNoteCreation),e.addBinding(re.FB,this.saveNewNote),e.addBinding(re.gc,this.onCancelNewNote),e.addBinding(re._N,this.onCloseNote),e.addBinding(re.kd,this.onSaveNoteChanges),e.addBinding(re.Wh,this.cancelNoteChanges),e.addBinding(re.uT,this.openAnnotationView),e.addBinding(re.sG,this.deleteNote),e.addBinding(re.yp,this.onResolveNoteCommand),e.addBinding(re.Df,this.addComment),e.addBinding(re.Uw,this.onUpdateComment),e.addBinding(re.mH,this.deleteComment),e.addBinding(re.pH,this.addHashtag),e.addBinding(re.oE,this.saveNoteAppearance),e.addBinding(re.df,this.togglePinAssetEditor),this.annotationsViewData.onSearchBlockChanged(this.onSearchBlockChanged),this.viewData.onNotesFilterChanged(this.onNoteFilterChanged),this.viewData.onOpenNoteViewChanged(this.onOpenNoteViewChanged),this.notesData.onChanged(this.notesWereChanged),this.notesData.collection.onElementChanged({onAdded:this.noteWasAdded,onUpdated:this.noteWasUpdated})),this.registered=!0}async loadNoteAndCommentUsers(){const e=new Set,t=this.userData.getCurrentUserId();if(this.notesData.iterate((i=>{i.user.id!==t&&e.add(i.user.id),i.comments.forEach((i=>{i.user.id!==t&&e.add(i.user.id)}))})),e.size>0)return this.engine.commandBinder.issueCommand(new E.P(null,e,null))}loadAttachments(){this.notesData.iterate((e=>{e.comments.forEach((e=>{e.attachments.forEach((e=>{this.attachmentsData.addAttachment(new Y.P(e))}))}))}))}async loadUserMentions(){const e=new Set,t=new Set,i=this.userData.getCurrentUserId();return this.notesData.iterate((n=>{n.comments.forEach((n=>{(0,le.l)(n.text,this.userData).forEach((n=>{n.id&&n.id!==i?e.add(n.id):n.email&&t.add(n.email)}))}))})),this.engine.commandBinder.issueCommand(new E.P(null,e,t))}collectHashtags(){this.notesData.iterate((e=>{e.comments.forEach(((e,t)=>{this.addHashtags(e.text)}))})),this.hashtagData.commit()}addHashtags(e){const t=this.hashtagData,i=e.match(/\[\#\S+\]/g);i&&i.forEach((e=>{t.addHashtag(e.substring(2,e.length-1))}))}in360View(){const e=this.sweepData.currentSweep?this.sweepData.currentSweep:"";return this.viewmodeData.isPano()&&this.sweepData.isSweepUnaligned(e)}closeNote(){this.cancelAttachmentChanges(),this.viewData.openNoteView&&(this.engine.broadcast(new z.A(this.viewData.openNoteView.id,G.Er.NOTE)),this.engine.broadcast(new g.Ur)),this.viewData.setNotesPhase($.U.IDLE),this.viewData.setOpenNoteView(null),this.updateNoteVisibility()}updateNoteViewData(){this.viewData.updateViewData(this.annotationsViewData.searchBlock)}getFilteredNoteIds(e){const t=[];return this.notesData.iterate((i=>{this.getNoteVisibility(i)===e&&t.push(i.id)})),t}getNoteVisibility(e){const{notesFilter:t,openNoteView:i}=this.viewData,{id:n,resolved:s}=e;return i&&i.id===n||t===X.$.ALL||s&&t===X.$.RESOLVED||!s&&t===X.$.OPEN}updateNoteVisibility(){this.notesData.iterate((e=>{this.pinRenderer.setPinVisible(e.id,this.getNoteVisibility(e))}))}displayNotes(){this.notesData.iterate((e=>this.updateNotePin(e)))}updateNotePin(e){const t=this.getNoteVisibility(e);this.pinRenderer.updatePin(e.id,G.Er.NOTE,e,this.backgroundTexture,this.maskTexture,t)}async confirmAttachmentChanges(e,t,i,n){return Promise.all([this.engine.commandBinder.issueCommand(new q.GW(e,t,i,n)),this.engine.commandBinder.issueCommand(new q.N0)])}async cancelAttachmentChanges(){return Promise.all([this.engine.commandBinder.issueCommand(new q.rh),this.engine.commandBinder.issueCommand(new q.u)])}async openNote(e,t,i,n,s=-1,o=!1){const{toolsData:r,viewData:a,engine:l,activated:c,userData:h,pinRenderer:d}=this;c?-1!==s&&r.toolAccess===p.X$.TOOL&&r.setToolAccess(p.X$.LIST):(await l.commandBinder.issueCommand(new m.tT(p.w1.NOTES,!0)),r.setToolAccess(p.X$.SCENE));const f=a.getNoteView(e);if(f){const r=a.openNoteView,c=!!r&&r.id===e;if(!c){const e=null!==t?t:u.n.Instant;a.setOpenNoteView(f),l.broadcast(new z.sD(f,G.Er.NOTE,h.isCommenter())),a.setNotesPhase($.U.OPENING),null!==e&&(d.hideSelectedMesh(),await l.commandBinder.issueCommand(new R.OR({pinPosition:f,transition:e})),d.showSelectedMesh(G.Er.NOTE,f.id)),o?a.setNotesPhase($.U.ANNOTATING):a.setNotesPhase($.U.VIEWING)}if(i||!c){const e=i||f.comments.get(0).id;l.broadcast(new g.ZL(b.h.COMMENT,e))}let p=s;if(-1===s&&f&&(p=a.getAnnotationViewList().values().findIndex((e=>e.assetType===b.h.NOTE&&e.id===f.id||e.assetType===b.h.COMMENT&&e.assetId===f.id))),a.setListIndex(p),n&&!o){const t=f.comments.map((e=>e.id)),i=[e].concat(t);l.commandBinder.issueCommand(new q.VO(n,i))}else l.commandBinder.issueCommand(new v.rE)}else Te.debug("Cannot open a non-existent note")}async toggleNoteResolution(e,t){const i=this.notesData.getNote(e);if(i){if(i.resolved!==t){const n={resolved:t};this.viewData.updateOpenNoteView(n),this.notesData.updateNote(e,n),this.config.storageProvider===r.Xq.JSONSTORE?await this.store.update({[i.id]:i}):await this.store.updateResolution(e,t)}}else Te.debug("Cannot resolve/reopen a non-existent note")}resetOpenNoteView(){const e=this.viewData.openNoteView;if(e){const t=this.notesData.getNoteProperties(e.id);t&&this.viewData.updateOpenNoteView(t)}}async updateNoteComment(e,t,i){const n=this.notesData.getNote(e);if(n){const s=n.getComment(t);if(s)if(s.user.id===this.userData.getCurrentUserId()){if(this.config.storageProvider===r.Xq.JSONSTORE)this.commentsData.updateCommentText(t,i),await this.commentsData.save(this.commentsData.getComment(t)),Ee(n,this.commentsData);else{const e=await this.store.updateComment({id:t,text:i});e&&(n.text=i,n.edited=!0,n.updateComment(e))}await this.confirmAttachmentChanges(t,b.h.COMMENT),this.addHashtags(i),n.resolved&&(this.viewData.setNotesFilter(X.$.ALL),await this.toggleNoteResolution(e,!1)),this.viewData.setNotesPhase($.U.VIEWING)}else Te.debug("Cannot update another user's comment");else Te.debug("Cannot update a non-existent comment")}else Te.debug("Cannot update a comment in a non-existent note")}}const Me=NotesModule},5261:(e,t,i)=>{"use strict";i.d(t,{E:()=>NotesModeOpenedMessage});var n=i(93528);class NotesModeOpenedMessage extends n.v{}},83455:(e,t,i)=>{"use strict";i.d(t,{IA:()=>n,Mp:()=>s,pE:()=>o,GR:()=>r,E8:()=>a,TM:()=>l,Ko:()=>c,Rn:()=>h,ZP:()=>d});const n="features/notes-mode",s="features/notes",o="features/notes-nudge",r=60,a=15,l=500,c=500,h="#5c7fff",d=Object.freeze({noteMesh:{scale:{nearBound:1.5,farBound:4.8,maxSize:80,minSize:40,baseViewportSize:800,responsiveness:100}},colors:["#d44441","#f44336","#e91e63","#f78da7","#9c4b92","#673ab7","#5c7fff","#03a9f4","#417505","#00bcd4","#51a868","#37d67a","#cddc39","#fbcd00","#ffac17","#ff6900","#abb8c3","#607d8b"],stem:{length:.23,width:1,opacity:1,transparent:!1,color:"white",alphaTest:.05},anchor:{size:.1},navigation:{anyDistance:!0,visibleDistance:8,cameraClearance:.1,tiltTolerance:25}})},70110:(e,t,i)=>{"use strict";i.d(t,{l:()=>o});var n=i(71313),s=i(74674);function o(e,t,i){const o=[];for(const r of n.v.parse(e,!1,t))if(r.blockType===s.C.USER&&r.value){const e=r.id,n=e?t.getUserInfoDisplay(e):t.getUserInfoDisplayByEmail(r.value);""===n.email&&(n.email=r.value),""===n.email||i&&n.modelAccess!==i||o.push(n)}return o}},1707:(e,t,i)=>{"use strict";i.d(t,{SI:()=>s,uQ:()=>o,zf:()=>r,O8:()=>a,WI:()=>l});var n=i(2212);const s=1e3/60,o=n.MathUtils.degToRad(70),r=-o,a=.05,l=.1/60},55530:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>PanoramaControls,lookAccelerationKey:()=>M});var n=i(54122),s=i(2212),o=i(30963),r=i(27829),a=i(1707),l=i(45805),c=i(67126),h=i(22888),d=i(44266);class CameraControls extends h.Z{constructor(e){super(),this.lookVelocity=new s.Vector2,this.lookAccel=new s.Vector2,this.tempAxis=new s.Vector3,this.tempOrientation=new s.Quaternion,this.currentOrientation=new s.Quaternion,this.tempEuler=new s.Euler,this.cameraModule=e,this.transition={active:!1,startTime:0,elapsed:0,duration:0,velocity:new s.Vector2,easeOut:!1}}setLookAcceleration(e,t=!1){this.transition.active||(t&&(e.x&&this.lookVelocity.x&&Math.sign(e.x)!==Math.sign(this.lookVelocity.x)&&(this.lookVelocity.x=0),e.y&&this.lookVelocity.y&&Math.sign(e.y)!==Math.sign(this.lookVelocity.y)&&(this.lookVelocity.y=0)),this.lookAccel.x=void 0!==e.x?e.x:this.lookAccel.x,this.lookAccel.y=void 0!==e.y?e.y:this.lookAccel.y)}startTransition(e,t,i){const n=new d.Q;return this.transition.active=!0,this.transition.duration=e,this.transition.elapsed=0,this.transition.startTime=Date.now(),this.transition.deferred=n,this.transition.velocity.copy(t),this.transition.easeOut=i,this.lookAccel.set(0,0),this.lookVelocity.copy(t),this.cameraModule.beginExternalTransition(),n.promise()}stopTransition(){this.transition.active&&(this.cameraModule.endExternalTransition(),this.transition.active=!1),this.transition.deferred&&(this.transition.deferred.resolve(),this.transition.deferred=void 0)}updateTransition(e){const t=e/a.SI;if(this.lookVelocity.copy(this.transition.velocity),this.transition.elapsed+=e,this.transition.elapsed>=this.transition.duration){const t=this.transition.duration-(this.transition.elapsed-e);this.lookVelocity.multiplyScalar(t/e)}else this.lookVelocity.multiplyScalar(t)}updateCameraParameters(){const e=this.cameraModule.getData(!1);this.tempEuler.setFromQuaternion(e.pose.rotation,"YXZ");const t=this.tempEuler.x,i=(0,c.uZ)(this.lookVelocity.y,a.zf-t,a.uQ-t);this.tempAxis.copy(r.f.RIGHT),this.tempOrientation.setFromAxisAngle(this.tempAxis.applyQuaternion(e.pose.rotation),i),this.currentOrientation.copy(e.pose.rotation).premultiply(this.tempOrientation),this.tempOrientation.setFromAxisAngle(r.f.UP,this.lookVelocity.x),this.currentOrientation.premultiply(this.tempOrientation),e.pose.rotation.equals(this.currentOrientation)||(this.tempOrientation.copy(this.currentOrientation).normalize(),this.cameraModule.updateCameraRotation(this.tempOrientation))}update(e){const t=this.cameraModule.getData(!1),i=e/a.SI;t.pose.rotation.equals(this.currentOrientation)||this.currentOrientation.copy(t.pose.rotation),this.transition.active?(this.updateTransition(e),this.updateCameraParameters(),this.transition.elapsed>=this.transition.duration&&(this.stop(this.transition.easeOut),this.transition.active=!1)):(this.lookAccel.length()>l.Z.epsilon||this.lookVelocity.length()>l.Z.epsilon)&&(this.lookVelocity.addScaledVector(this.lookAccel,i),this.updateCameraParameters(),this.lookVelocity.multiplyScalar(Math.pow(1-a.O8,i)))}stop(e=!1){this.stopTransition(),this.lookAccel.set(0,0),e||this.lookVelocity.set(0,0)}startRotateTransition(e,t,i){const n=this.cameraModule.getData(!1);return n.transition&&n.transition.activeInternal&&n.transition.to.rotation&&(n.transition.to.rotation=void 0),this.startTransition(e,t.clone().multiplyScalar(a.SI),i).nativePromise()}startTranslateTransition(e,t,i=!0){throw new Error("Panning isn't supported in Panorama Controls")}startZoomTransition(e,t,i){throw new Error("Zooming isn't supported in Panorama Controls")}}var u=i(89895),p=i(12775),m=i(75711),g=i(71208),f=i(40582),v=i(35825),y=i(22767),b=i(48840),w=i(21588),S=i(78626),E=i(60959),T=i(39936);const M="Rotation speed";class PanoramaControls extends n.Y{constructor(){super(...arguments),this.name="panorama-controls",this.controlsEngaged=!1,this.lookAccelerationSpeed=a.WI,this.calcRotationAngle=(()=>{const e=new s.Matrix4,t=new s.Vector3,i=new s.Vector3;return(n,o,r)=>{const a=n.getData(!1);e.copy(a.pose.projection.asThreeMatrix4()),e.invert(),t.set(o.x-r.x,o.y-r.y,-1).applyMatrix4(e),i.set(o.x,o.y,-1).applyMatrix4(e);const l=Math.sqrt(t.x*t.x+t.z*t.z),c=Math.sqrt(i.x*i.x+i.z*i.z),h=Math.atan2(t.y,l),d=Math.atan2(i.y,c)-h;t.y=0,i.y=0,t.normalize(),i.normalize();const u=Math.acos(t.dot(i));let p=0;return isNaN(u)||(p=u,r.x>0&&(p*=-1)),new s.Vector2(-p,-d)}})()}async init(e,t){const i=await t.getModule(u.default);this.controls=new CameraControls(i);(await t.getModule(E.default)).addControls(g.Ey.Panorama,this.controls),this.market=t.market,this.bindings.push(t.subscribe(b.Z,(e=>{this.controls.stop()}))),t.getModule(o.default).then((e=>{e.registerHandler(w.E0,(e=>{this.validateViewmode()&&this.controls.stop()})),e.registerHandler(w._t,(e=>{this.validateViewmode()&&e.buttons&f.r3.PRIMARY&&(this.controlsEngaged=!0,this.onDrag(i,e.position,e.delta),this.controls.update(a.SI),this.controls.stop())})),e.registerHandler(w._R,(e=>{this.validateViewmode()&&this.controlsEngaged&&(e.timeSinceLastMove<100&&!(e.buttons&f.r3.PRIMARY)&&(this.onDrag(i,e.position,e.delta),this.controls.update(a.SI),this.controls.setLookAcceleration({x:0,y:0})),this.controlsEngaged=!1)})),e.registerHandler(S.e,(e=>{this.validateViewmode()&&this.onKey(e.key,e.state)}))}))}onUpdate(e){this.validateViewmode()&&this.controls.update(e)}onDrag(e,t,i){this.controls.setLookAcceleration(this.calcRotationAngle(e,t,i))}onKey(e,t){let i=null;const n=this.market.tryGetData(T.e);n&&(i=n.tryGetProperty(M,null)),this.lookAccelerationSpeed=i?i*(Math.PI/180)/60:this.lookAccelerationSpeed;const s=t===y.M.DOWN;switch(e){case v.R.LEFTARROW:case v.R.J:this.controls.setLookAcceleration({x:s?this.lookAccelerationSpeed:0},!0);break;case v.R.RIGHTARROW:case v.R.L:this.controls.setLookAcceleration({x:s?-this.lookAccelerationSpeed:0},!0);break;case v.R.K:this.controls.setLookAcceleration({y:s?-this.lookAccelerationSpeed:0},!0);break;case v.R.I:this.controls.setLookAcceleration({y:s?this.lookAccelerationSpeed:0},!0)}}validateViewmode(){const e=this.market.tryGetData(p.O),t=this.market.tryGetData(m.Z);return!e||!t||e.isPano()&&!t.isVR()}}},75931:(e,t,i)=>{"use strict";i.d(t,{j:()=>PinAnchorMesh});var n=i(20599),s=i(60778),o=i(2212),r=i(30749),a=i(90666);class PinAnchorMesh extends o.Mesh{constructor(e){super(new o.PlaneBufferGeometry(a.Z.anchor.size,a.Z.anchor.size),new o.MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,map:PinAnchorMesh.getTexture(),side:o.DoubleSide})),this.visible=!1,this.layers.mask=e.mask,this.renderOrder=n.z.pins}static getTexture(){return PinAnchorMesh.anchorTexture||(PinAnchorMesh.anchorTexture=(0,s.p)(r)),PinAnchorMesh.anchorTexture}}},73749:(e,t,i)=>{"use strict";i.d(t,{$:()=>PinHeadMesh});var n=i(45805),s=i(20599),o=i(2212),r=i(90666);class PinHeadMesh extends o.Mesh{constructor(e,t,i,n){super(t,i),this.geomScale=new o.Vector3(1,1,1),this.userData.sid=e,this.worldPosition=new o.Vector3,this.cameraPosition=new o.Vector3,this.layers.mask=n.mask,this.renderOrder=s.z.pins,this.scale.set(.01,.01,.01)}dispose(){this.material.dispose(),this.geometry.dispose()}updatePosition(e){this.position.copy(e.stemNormal).setLength(Math.max(e.stemLength,.01))}update(e,t,i){const s=r.Z.pinHeadMesh.scale;this.getWorldPosition(this.worldPosition);const a=e.getWorldPosition(this.cameraPosition).distanceTo(this.worldPosition);this.quaternion.copy(e.quaternion);const l=s.maxSize-(s.maxSize-s.minSize)*o.MathUtils.smoothstep(a,s.nearBound,s.farBound),c=this.worldPosition.clone().project(e),h=new o.Vector3(i.width/2,i.height/2,1).multiply(c),d=new o.Vector3(l/2,0,0).add(h),u=new o.Vector3(2/i.width,2/i.height,1).multiply(d).clone().unproject(e).clone().distanceTo(this.worldPosition)*(1+s.responsiveness/100*(t-1)),p=o.MathUtils.clamp(u,n.Z.epsilon,u);this.scale.set(p*this.geomScale.x,p*this.geomScale.y,p*this.geomScale.z)}}},70008:(e,t,i)=>{"use strict";i.d(t,{B:()=>PinsViewData});var n=i(19413),s=i(5442),o=i(90926);class PinsViewData extends n.V{constructor(){super(),this.name="pins-view-data",this.creatingPin=!1,this.pinStateObservable=(0,s.Y)(o.tS.IDLE),this.openPinObservable=(0,s.Y)(null),this.editableObservable=(0,s.Y)(!0),this.previewPinObservable=(0,s.Y)(null),this.progressObservable=(0,s.Y)(-1),this.screenPositionObservable=(0,s.Y)(null),this.canPlaceObservable=(0,s.Y)(!0),this.canAddObservable=(0,s.Y)(!0)}get creatingNewPin(){return this.creatingPin}updateOpenPin(e){const t=this.openPin;if(t){const i=Object.assign(Object.assign({},t),e);this.setOpenPin(i)}}setOpenPin(e){this.openPinObservable.value=e}get openPin(){return this.openPinObservable.value}onOpenPinChanged(e){return this.openPinObservable.onChanged(e)}setPreviewPin(e){this.previewPinObservable.value=e}get previewPin(){return this.previewPinObservable.value}onPreviewPinChanged(e){return this.previewPinObservable.onChanged(e)}setPinState(e){switch(this.pinState){case o.tS.IDLE:case o.tS.OPEN:case o.tS.PREVIEWING:this.creatingPin=!1;break;case o.tS.CREATING:this.creatingPin=!0}this.pinStateObservable.value=e}get pinState(){return this.pinStateObservable.value}onPinStateChanged(e){return this.pinStateObservable.onChanged(e)}setProgress(e){this.progressObservable.value=e}get progress(){return this.progressObservable.value}onProgressChanged(e){const t=this.progressObservable.onChanged(e);return t.renew(),t}get screenPosition(){return this.screenPositionObservable.value}setScreenPosition(e){this.screenPositionObservable.value=e}onScreenPositionChanged(e){return this.screenPositionObservable.onChanged(e)}get isPinEditable(){return this.editableObservable.value}setEditablePin(e){this.editableObservable.value=e}get canAdd(){return this.canAddObservable.value}setCanAdd(e){this.canAddObservable.value=e}onCanAddChanged(e){return this.canAddObservable.onChanged(e)}get canPlace(){return this.canPlaceObservable.value}setCanPlace(e){this.canPlaceObservable.value=e}onCanPlaceChanged(e){return this.canPlaceObservable.onChanged(e)}}},68611:(e,t,i)=>{"use strict";i.d(t,{EP:()=>EnablePinEditingCommand,_l:()=>PreviewPinCommand,Ar:()=>SelectPinCommand,$b:()=>OpenPinCommand,fe:()=>AdjustPinStemLengthCommand,G3:()=>ClickAwayFromPinCommand,ip:()=>PlacePinCommand,I$:()=>MovePinCommand,tT:()=>CancelNewPinCommand});var n=i(99681),s=i(47924);class EnablePinEditingCommand extends n.m{constructor(e){super(),this.payload={enabled:e}}}class PreviewPinCommand extends n.m{constructor(e,t){super(),this.payload={pin:e,pinType:t}}}class SelectPinCommand extends n.m{constructor(e,t,i=s.n.Instant){super(),this.payload={id:e,pinType:t,transition:i}}}class OpenPinCommand extends n.m{constructor(e,t,i,n,s=-1,o=!1){super(),this.payload={id:e,pinType:t,transition:i,attachmentId:n,listIndex:s,editText:o}}}class AdjustPinStemLengthCommand extends n.m{constructor(e,t,i){super(),this.payload={id:e,pinType:t,stemLength:i}}}class ClickAwayFromPinCommand extends n.m{constructor(){super()}}class PlacePinCommand extends n.m{constructor(){super()}}class MovePinCommand extends n.m{constructor(e,t){super(),this.payload={id:e,pos:t}}}class CancelNewPinCommand extends n.m{constructor(){super()}}},90926:(e,t,i)=>{"use strict";var n,s,o,r;i.d(t,{Er:()=>n,K_:()=>s,tS:()=>o,Od:()=>r}),function(e){e.MATTERTAG="mattertag",e.NOTE="note"}(n||(n={})),function(e){e.DEFAULT="default",e.HIGHLIGHTED="highlighted",e.DIMMED="dimmed"}(s||(s={})),function(e){e.IDLE="idle",e.CREATING="creating",e.PRESSING="pressing",e.PLACING="placing",e.PLACED="placed",e.PREVIEWING="previewing",e.SELECTED="selected",e.OPEN="open",e.EDITING="editing"}(o||(o={})),function(e){e.UP="up",e.UP_LEFT="up-left",e.UP_RIGHT="up-right",e.DOWN="down",e.DOWN_LEFT="down-left",e.DOWN_RIGHT="down-right",e.LEFT="left",e.RIGHT="right"}(r||(r={}))},61155:(e,t,i)=>{"use strict";i.r(t),i.d(t,{AdjustPinStemLengthCommand:()=>X.fe,CancelNewPinCommand:()=>X.tT,ClickAwayFromPinCommand:()=>X.G3,EnablePinEditingCommand:()=>X.EP,FocusPinAnnotationMessage:()=>Q.nY,MovePinCommand:()=>X.I$,OpenPinCommand:()=>X.$b,PinAddCancelledMessage:()=>Q.hu,PinAnchorMesh:()=>Y.j,PinClickedMessage:()=>Q.F7,PinClosedMessage:()=>Q.A,PinColorVariant:()=>q.K_,PinDeletedMessage:()=>Q.VZ,PinDeselectMessage:()=>Q.Fe,PinDiscardedMessage:()=>Q.w0,PinEditor:()=>PinEditor,PinHeadMesh:()=>K.$,PinHoverChangeMessage:()=>Q.tP,PinMovedMessage:()=>Q.bV,PinOpenedMessage:()=>Q.sD,PinPlacedMessage:()=>Q.b0,PinPreviewDirection:()=>q.Od,PinRenderer:()=>PinRenderer,PinSelectedMessage:()=>Q.Q4,PinStartCreatingMessage:()=>Q.nO,PinState:()=>q.tS,PinType:()=>q.Er,PinUpdatedMessage:()=>Q.KR,PinsViewData:()=>x.B,PlacePinCommand:()=>X.ip,PreviewPinCommand:()=>X._l,SelectPinCommand:()=>X.Ar,default:()=>Te});var n=i(2212),s=i(54122),o=i(30963),r=i(62513),a=i(50101),l=i(75195),c=i(47924),h=i(21265),d=i(29675),u=i(99169),p=i(22729),m=i(75711),g=i(89155),f=i(77956),v=i(12775),y=i(71208),b=i(46101),w=i(39869),S=i(13402),E=i(3471),T=i(6201),M=i(87493),_=i(90039),x=i(70008),A=i(53999),O=i(67399),P=i(26956),C=i(50266),D=i(61718),I=i(7065),R=i(77787),L=i(76258),N=i(12505),k=i(25799),B=i(75712),F=i(24975),U=i(40582),V=i(36073),H=i(21588),G=i(35056),z=i(75158),j=i(78626),W=i(22767),Z=i(35825),q=i(90926),K=i(73749),Y=i(75931),$=i(90666),X=i(68611),Q=i(43770),J=i(25936),ee=i(85995),te=i(55525),ie=i(56730),ne=i(90014);class PinEditor{constructor(e,t,i,s){this.viewData=e,this.engine=t,this.input=i,this.pinRenderer=s,this.bindings=[],this.externalBehaviorsBlocked=!1,this.touchDevice=(0,h.Jm)(),this.longPressCreateThreshold=500,this.ndcPoint=new n.Vector3,this.movingPin=!1,this.anchored=!1,this.inAnchorClick=!1,this.log=new k.Z("note-editor"),this.stopEventPropagation=()=>!0,this.updateMeshPreviewSphere=async(e,t)=>{this.engine.commandBinder.issueCommand(new ie.n(e,t))},this.startPinCreation=()=>{this.creatingHandlers.renew(),this.touchDevice||this.engine.commandBinder.issueCommand(new L.u(I.C.XHAIR)),this.engine.commandBinder.issueCommand(new ee.ZD)},this.endPinCreation=()=>{this.draggingHandlers.cancel(),this.creatingHandlers.cancel(),this.clearLongPressTimeout(),this.allowExternalBehaviors(!0),this.engine.commandBinder.issueCommand(new L.u(I.C.DEFAULT)),this.engine.commandBinder.issueCommand(new ee.zd)},this.onOpenPinChanged=()=>{this.updateAnchorMesh()},this.onPinStateUpdated=()=>{const e=this.viewData.pinState;switch(this.updateAnchorMesh(),e){case q.tS.PLACING:this.draggingHandlers.renew();break;case q.tS.IDLE:this.allowExternalBehaviors(!0)}},this.updateAnchorMesh=()=>{const{openPin:e,pinState:t}=this.viewData;e?t===q.tS.SELECTED?this.selectedHandlers.renew():[q.tS.PLACING,q.tS.PLACED,q.tS.EDITING].includes(t)&&(this.pinRenderer.showAnchorMesh(e.pinType,e.id,e),this.anchored=!0,this.selectedHandlers.renew()):(this.selectedHandlers.cancel(),this.anchored&&(this.removePinAnchorMesh(),this.pinRenderer.hideSelectedMesh(),this.updateMeshPreviewSphere(!1)))},this.clearLongPressTimeout=()=>{this.longPressStart=0,-1!==this.longPressTimeout&&window.clearTimeout(this.longPressTimeout),this.longPressTimeout=-1},this.placePin=()=>{const e=this.viewData;e.pinState===q.tS.PLACING&&(e.setPinState(q.tS.PLACED),this.engine.commandBinder.issueCommand(new L.u(I.C.DEFAULT)),this.engine.commandBinder.issueCommand(new X.ip),this.engine.broadcast(new Q.nY),this.updateMeshPreviewSphere(!1))},this.onDragEvent=e=>{e.buttons!==U.r3.PRIMARY&&(this.touchDevice||this.viewData.openPin)||this.positionPin(e)},this.onDragEnd=e=>{const{openPin:t,creatingNewPin:i,pinState:n}=this.viewData;if((!i||this.touchDevice||n!==q.tS.PLACING)&&t&&!i){const e={anchorPosition:t.anchorPosition,stemNormal:t.stemNormal,floorId:t.floorId,roomId:t.roomId,stemLength:t.stemLength,stemEnabled:t.stemEnabled,color:t.color};this.engine.commandBinder.issueCommand(new X.I$(t.id,e)),this.updateMeshPreviewSphere(!1)}},this.positionPin=(()=>{const e=new n.Vector3;return async t=>{if(this.touchDevice&&t.buttons!==U.r3.PRIMARY)return!1;const i=this.viewData,n=i.pinState;if(n===q.tS.CREATING)this.engine.commandBinder.issueCommand(new ne.y(!0));else if(n!==q.tS.PLACING&&!this.movingPin)return!1;const s=i.openPin;if(!s)return!1;this.saveScreenPosition(t.position.x,t.position.y);const o=this.getModelIntersection();if(o&&o.face){this.engine.commandBinder.issueCommand(new L.u(I.C.XHAIR)),i.setCanPlace(!0);const t=(0,R.c)(this.floorsData,o);if(null===t)return!1;const r=O.$4.hasRoomId(o.object)?o.object.roomId:void 0;return e.copy(s.stemNormal).setLength(s.stemLength),this.updateMeshPreviewSphere(!0,s.anchorPosition),i.updateOpenPin({anchorPosition:s.anchorPosition.copy(o.point),stemNormal:s.stemNormal.copy(o.face.normal).normalize(),floorId:t,roomId:r}),n===q.tS.CREATING&&i.setPinState(q.tS.PLACING),!0}return this.engine.commandBinder.issueCommand(new L.u(I.C.NOPE)),i.setCanPlace(!1),!1}})(),this.allowExternalBehaviors=async e=>{e||this.externalBehaviorsBlocked?e&&this.externalBehaviorsBlocked&&(this.dragInterceptor.cancel(),this.engine.commandBinder.issueCommand(new te.Lp),this.externalBehaviorsBlocked=!1):(this.dragInterceptor.renew(),this.engine.commandBinder.issueCommand(new te.ZK),this.externalBehaviorsBlocked=!0)},this.getModelIntersection=()=>{const e=.5*$.Z.anchor.size;return this.fatcaster.cast(e,F.Nr,C.a.Filter.CENTER_GROUP(e))},this.onPointerButton=e=>{e.down||this.viewData.pinState!==q.tS.PLACED||(this.allowExternalBehaviors(!0),this.engine.commandBinder.issueCommand(new ne.y(!1)))},this.onAnchorSelect=e=>{const t=this.viewData;if(!t.openPin||e.button!==U.MP.PRIMARY)return;t.pinState===q.tS.EDITING&&(e.down?(this.movingPin=!0,this.allowExternalBehaviors(!1),this.draggingHandlers.renew(),this.engine.commandBinder.issueCommand(new L.u(I.C.GRABBING)),this.engine.commandBinder.issueCommand(new ne.y(!0)),this.inAnchorClick=!0):(this.doneMovingPin(),this.inAnchorClick=!1))},this.doneMovingPin=()=>{this.viewData.openPin&&this.movingPin&&(this.draggingHandlers.cancel(),this.engine.commandBinder.issueCommand(new L.u(null)),this.engine.commandBinder.issueCommand(new ne.y(!1)),this.movingPin=!1,this.allowExternalBehaviors(!0),this.updateMeshPreviewSphere(!1))},this.onClickElsewhere=e=>{const{openPin:t,pinState:i}=this.viewData;if(!(i===q.tS.CREATING&&t||this.inAnchorClick))return t&&(this.movingPin?this.doneMovingPin():this.engine.commandBinder.issueCommand(new X.G3)),!0},this.onLongPressStart=async e=>{if(e.buttons!==U.r3.PRIMARY)return;const t=this.viewData;t.pinState===q.tS.CREATING&&(this.longPressStart=Date.now(),t.setPinState(q.tS.PRESSING),this.allowExternalBehaviors(!1),this.saveScreenPosition(e.position.x,e.position.y),this.longPressTimeout=window.setTimeout((async()=>{t.setPinState(q.tS.PLACING);await this.positionPin(e)||(t.setPinState(q.tS.CREATING),t.setCanPlace(!1)),this.longPressTimeout=-1}),this.longPressCreateThreshold))},this.onLongPressEnd=()=>{const e=this.viewData.pinState;e===q.tS.PRESSING?(this.log.debug("Did not press long enough"),this.endPinCreation()):e===q.tS.PLACING&&this.placePin()},this.onPointerEvent=e=>{const t=this.viewData.pinState;t!==q.tS.PLACING&&t!==q.tS.CREATING||this.positionPin(e)},this.onClickToPlacePin=()=>{this.placePin()},this.onKeyEvent=e=>{if(e.state===W.M.PRESSED)switch(e.key){case Z.R.ESCAPE:this.viewData.creatingNewPin&&this.engine.commandBinder.issueCommand(new X.tT)}},Promise.all([t.market.waitForData(g.M_),t.market.waitForData(J.i),t.getModule(P.default)]).then((([e,t,i])=>{this.cameraData=e,this.floorsData=t,this.fatcaster=i,this.registerHandlers()}))}dispose(){this.removePinAnchorMesh(),this.updateMeshPreviewSphere(!1),this.dragInterceptor.cancel(),this.creatingHandlers.cancel(),this.draggingHandlers.cancel(),this.selectedHandlers.cancel(),this.bindings.forEach((e=>{e.cancel()}))}update(){const e=this.viewData;if(this.touchDevice&&e.pinState===q.tS.PRESSING){const t=Math.min(1,(Date.now()-this.longPressStart)/this.longPressCreateThreshold);e.setProgress(t)}}registerHandlers(){const e=this.input;this.bindings.push(this.viewData.onPinStateChanged(this.onPinStateUpdated),this.viewData.onOpenPinChanged(this.onOpenPinChanged),e.registerPriorityHandler(V.er,K.$,this.stopEventPropagation)),this.dragInterceptor=new A.V(e.registerPriorityHandler(H._t,D.S,(()=>!0)),e.registerPriorityHandler(H._t,N.i,(()=>!0))),this.dragInterceptor.cancel(),this.draggingHandlers=new A.V(e.registerUnfilteredHandler(H._t,this.onDragEvent),e.registerUnfilteredHandler(H._R,this.onDragEnd)),this.draggingHandlers.cancel(),this.touchDevice?(this.creatingHandlers=new A.V(e.registerHandler(V.er,this.onPointerButton),e.registerUnfilteredHandler(G.Vh,this.onLongPressStart),e.registerUnfilteredHandler(G.pt,this.onLongPressEnd)),this.selectedHandlers=new A.V(e.registerMeshHandler(V.er,B.s.isType(Y.j),this.onAnchorSelect),e.registerPriorityHandler(z.R,D.S,this.onClickElsewhere),e.registerPriorityHandler(z.R,N.i,this.onClickElsewhere))):(this.creatingHandlers=new A.V(e.registerHandler(j.e,this.onKeyEvent),e.registerHandler(V.er,this.onPointerButton),e.registerUnfilteredHandler(z.R,this.onClickToPlacePin),e.registerHandler(V.mE,this.onPointerEvent)),this.selectedHandlers=new A.V(e.registerMeshHandler(V.er,B.s.isType(Y.j),this.onAnchorSelect),e.registerPriorityHandler(z.R,D.S,this.onClickElsewhere),e.registerPriorityHandler(z.R,N.i,this.onClickElsewhere))),this.creatingHandlers.cancel(),this.selectedHandlers.cancel()}removePinAnchorMesh(){this.pinRenderer.hideAnchorMesh(),this.anchored=!1}saveScreenPosition(e,t){this.ndcPoint.set(e,t,0);const i=(0,l.fi)(this.cameraData.width,this.cameraData.height,this.ndcPoint);this.viewData.setScreenPosition(i)}}var se=i(73706),oe=i(1481),re=i(93781),ae=i(1799),le=i(20599),ce=i(48101),he=i(13441),de=i(81047);const ue={pinHead:{uniforms:{alpha:{type:"f",value:1},color:{type:"c",value:new n.Color},bg:{type:"t",value:null},mask:{type:"t",value:null}},vertexShader:(0,ce.m)(de,i(23482)),fragmentShader:(0,ce.m)(he,i(43655))},pinStem:{uniforms:{pinHeadMatrix:{value:new n.Matrix4},resolution:{value:new n.Vector2},alpha:{value:1}},vertexShader:(0,ce.m)(de,i(53496)),fragmentShader:(0,ce.m)(he,i(92712))},pinSelected:{vertexShader:(0,ce.m)(de,i(60264)),fragmentShader:(0,ce.m)(he,i(51953))}};var pe=i(82334),me=i(52857);class PinHeadMaterial extends n.RawShaderMaterial{constructor(e,t,i,s){const o=n.UniformsUtils.clone(ue.pinHead.uniforms);o.bg.value=t,o.mask.value=i,o.color.value.copy(e),o.alpha.value=s,super({fragmentShader:ue.pinHead.fragmentShader,vertexShader:ue.pinHead.vertexShader,uniforms:o,name:"PinHeadMaterial",transparent:!0})}}class PinStemMaterial extends n.RawShaderMaterial{constructor(){const e=n.UniformsUtils.clone(ue.pinStem.uniforms);super({fragmentShader:ue.pinStem.fragmentShader,vertexShader:ue.pinStem.vertexShader,uniforms:e,name:"PinStemMaterial",linewidth:$.Z.stem.width,opacity:$.Z.stem.opacity,transparent:$.Z.stem.transparent,alphaTest:$.Z.stem.opacity*$.Z.stem.alphaTest})}}class InstancedPinStemMaterial extends n.RawShaderMaterial{constructor(){const e=n.UniformsUtils.clone(ue.pinStem.uniforms);super({defines:{INSTANCED:!0},fragmentShader:ue.pinStem.fragmentShader,vertexShader:ue.pinStem.vertexShader,uniforms:e,name:"InstancedPinStemMaterial",linewidth:$.Z.stem.width,opacity:$.Z.stem.opacity,transparent:$.Z.stem.transparent,alphaTest:$.Z.stem.opacity*$.Z.stem.alphaTest})}}class InstancedPinHeadMaterial extends n.RawShaderMaterial{constructor(e,t){const i=n.UniformsUtils.clone(ue.pinHead.uniforms);i.bg.value=e,i.mask.value=t,super({defines:{INSTANCED:!0},fragmentShader:ue.pinHead.fragmentShader,vertexShader:ue.pinHead.vertexShader,uniforms:i,name:"InstancedPinHeadMaterial",transparent:!0})}}class PinHeadCustomMaterial extends n.RawShaderMaterial{constructor(e,t){super({defines:{INSTANCED:t},vertexShader:(0,ce.m)(de,pe),fragmentShader:(0,ce.m)(he,me),uniforms:{alpha:{value:1},tDiffuse:{value:e}},name:"InstancedPinHeadCustomMaterial",transparent:!0})}}class PinSelectedMaterial extends n.RawShaderMaterial{constructor(){super({depthTest:!0,depthWrite:!1,transparent:!0,side:n.DoubleSide,vertexShader:ue.pinSelected.vertexShader,fragmentShader:ue.pinSelected.fragmentShader})}}class PinSelectedMesh extends n.Mesh{constructor(e){super(new n.PlaneBufferGeometry($.Z.anchor.size,$.Z.anchor.size),new PinSelectedMaterial),this.visible=!1,this.layers.mask=e.mask,this.renderOrder=le.z.pinSelectedHalo}}class PinRenderer{constructor(e,t,i,s){this.input=e,this.layer=t,this.commandBinder=i,this.raycaster=s,this.container=new n.Object3D,this.floorIdToContainer=new Map,this.hexColorToColor=new Map,this.bindings=[],this.anchor=null,this.selected=null,this.haloEasing=(0,ae.tf)(.5,.52,0,1.98),this.pinsWithOverrideTexture=new Set,this.updateAnchorPosition=(()=>{const e=new n.Vector3,t=new n.Vector3,i=new n.Vector3;return n=>{const s=this.anchorMesh;if(!s)return;const o=this.raycaster.picking;e.copy(n.stemNormal).normalize(),t.copy(e).multiplyScalar(.2).add(n.anchorPosition),i.copy(e).multiplyScalar(-1);const r=o.pick(t,i,(e=>e instanceof re.g));if(r){const e=Math.min(.2,r.distance);s.position.copy(t).add(i.multiplyScalar(.999*e))}else s.position.copy(t).add(i.multiplyScalar(.999*n.stemLength));s.lookAt(t)}})(),this.onAnchorHover=()=>{this.commandBinder.issueCommand(new L.u(I.C.GRAB)),this.commandBinder.issueCommand(new ne.y(!0))},this.onAnchorUnhover=()=>{this.commandBinder.issueCommand(new L.u(null)),this.commandBinder.issueCommand(new ne.y(!1))}}init(){this.container.name="PinContainer",this.container.layers.mask=this.layer.mask,this.anchorMesh=new Y.j(this.layer),this.anchorMesh.name="Anchor Mesh",this.container.add(this.anchorMesh),this.selectedMesh=new PinSelectedMesh(this.layer),this.selectedMesh.name="Selected Mesh",this.container.add(this.selectedMesh)}dispose(){this.container.parent&&this.container.parent.remove(this.container);for(const e of[this.anchorMesh,this.selectedMesh])e&&e.parent&&e.parent.remove(e)}activate(e){this.bindings.length>0||this.bindings.push(this.input.registerMeshHandler(se.z,B.s.isType(Y.j),this.onAnchorHover),this.input.registerMeshHandler(se.A,B.s.isType(Y.j),this.onAnchorUnhover))}deactivate(e){for(const e of this.bindings)e.cancel();this.bindings.length=0}render(e){if(!this.selected)return;const{animation:t,hideWhenDoneAnimating:i}=this.selected,s=this.selectedMesh;if(s&&s.visible&&t){const e=this.pinHeadTransform(this.selected.id),o=new n.Vector3,r=new n.Quaternion,a=new n.Vector3;e.decompose(o,r,a),a.multiplyScalar(t.getUpdatedValue()),i&&!t.isAnimating?(s.visible=!1,this.selected=null):(s.position.copy(o),s.quaternion.copy(r),s.scale.copy(a))}}updatePin(e,t,i,n,s,o){this.anchorMesh&&this.anchorMesh.visible&&this.anchor&&this.anchor.pinType===t&&this.anchor.id===e&&this.updateAnchorPosition(i)}removePin(e){this.selected&&this.selected.id===e&&this.clearSelected()}removePinsByType(e){this.removePinsByPredicate((t=>t===e))}removePinsByPredicate(e){}setPinVisible(e,t){}setPinColorVariant(e,t){}setPinColorVariants(e,t){}setPinColorVariantByType(e,t,i){}setPinOpacity(e,t){}setPinOpacityByType(e,t,i){}fadePinOpacity(e,t){}fadePinOpacityByType(e,t,i=[]){}setPinRenderOverrides(e,t,i){t?(this.pinsWithOverrideTexture.add(e),this.selected&&this.selected.id===e&&this.clearSelected()):this.pinsWithOverrideTexture.delete(e)}setFloorsHidden(e){this.floorIdToContainer.forEach(((t,i)=>{t.visible=!e(i)}))}setPinTypeVisible(e,t){this.floorIdToContainer.forEach((i=>{i.userData.typeContainers[e].visible=t}))}showAnchorMesh(e,t,i){this.anchor={pinType:e,id:t},this.anchorMesh&&!this.anchorMesh.visible&&(this.anchorMesh.visible=!0,this.input.registerMesh(this.anchorMesh,!1)),this.updateAnchorPosition(i)}hideAnchorMesh(){this.anchorMesh&&this.anchorMesh.visible&&(this.anchorMesh.visible=!1,this.input.unregisterMesh(this.anchorMesh))}showSelectedMesh(e,t){const i=this.selected&&this.selected.pinType===e&&this.selected.id===t;this.selected&&i||this.pinsWithOverrideTexture.has(t)||(this.selected={pinType:e,id:t,hideWhenDoneAnimating:!1,animation:new oe.Z({startValue:10,endValue:14,duration:300,easingFunction:this.haloEasing})},this.selectedMesh.visible=!0)}hideSelectedMesh(){this.selected&&(this.selected.animation=new oe.Z({startValue:14,endValue:10,duration:300}),this.selected.hideWhenDoneAnimating=!0)}getFloorContainer(e){let t=this.floorIdToContainer.get(e);if(t)return t;t=new n.Object3D,t.name="Floor "+e,t.userData.typeContainers={},t.layers.mask=this.layer.mask;for(const e of Object.values(q.Er)){const i=new n.Object3D;i.name=e,i.layers.mask=this.layer.mask,t.add(i),t.userData.typeContainers[e]=i}return this.container.add(t),this.floorIdToContainer.set(e,t),t.userData.floorId=e,t}getColor(e){let t=this.hexColorToColor.get(e);if(t)return t;const i=new n.Color(e),s={h:0,s:0,l:0};i.getHSL(s);return t={baseColor:i,hoverColor:(new n.Color).setHSL(s.h,s.s,.8*s.l),dimmedColor:(new n.Color).setHSL(s.h,.5*s.s,s.l)},this.hexColorToColor.set(e,t),t}getViewportScale(e){return Math.sqrt(Math.min(e.width,e.height)/$.Z.pinHeadMesh.scale.baseViewportSize)}clearSelected(){this.selectedMesh.visible=!1,this.selected=null}}class PinStemMesh extends n.Line{constructor(e,t,i,s,o){const r=new n.BufferGeometry,a=new Float32Array(6);a[0]=a[1]=a[2]=0,a[3]=e.x,a[4]=e.y,a[5]=e.z,r.setAttribute("position",new n.BufferAttribute(a,3));const l=new PinStemMaterial;super(r,l),this.geometry=r,this.layers.mask=i.mask,this.visible=t,this.vector=e.clone(),this.onBeforeRender=(e,t,i,n,r)=>{const a=r;a.uniforms.pinHeadMatrix.value.copy(s.matrixWorld),a.uniforms.resolution.value.set(o.width,o.height),a.uniformsNeedUpdate=!0},this.pinStemMaterial=l}dispose(){this.geometry.dispose()}updatePosition(e){this.vector.copy(e.stemNormal).setLength(Math.max(e.stemLength,.01));const t=this.geometry.getAttribute("position");t.setXYZ(1,this.vector.x,this.vector.y,this.vector.z),t.needsUpdate=!0}}function ge(e,t){switch(t){case q.K_.DEFAULT:return e.baseColor;case q.K_.DIMMED:return e.dimmedColor;case q.K_.HIGHLIGHTED:return e.hoverColor}}var fe=i(290);class PinMeshGroup extends n.Object3D{constructor(e,t,i,s,o,r,a,l){super(),this.pinId=e,this.pinType=t,this.pinColor=s,this.stemVector=new n.Vector3,this.stemEnabled=!0,this.currentColorVariant=q.K_.DEFAULT,this.baseOpacity=1,PinMeshGroup.pinHeadGeometry||(PinMeshGroup.pinHeadGeometry=new n.PlaneBufferGeometry($.l,$.l));const c=(new n.Color).copy(s.baseColor);this.pinHeadMeshMaterial=new PinHeadMaterial(c,a,l,1),this.pinHeadMesh=new K.$(e,PinMeshGroup.pinHeadGeometry,this.pinHeadMeshMaterial,o),this.add(this.pinHeadMesh),this.stemMesh=new PinStemMesh(i.stemNormal,i.stemEnabled,o,this.pinHeadMesh,r),this.add(this.stemMesh),this.updateMeshPosition(i),this.opacityAnimation=new fe.z(1)}dispose(){this.remove(this.pinHeadMesh),this.pinHeadMesh.material.dispose(),this.pinHeadMesh.dispose(),this.remove(this.stemMesh),this.stemMesh.dispose()}static disposeAll(){PinMeshGroup.pinHeadGeometry.dispose()}updateFromPin(e,t,i,n){this.position.copy(e.anchorPosition),this.pinHeadMesh.updatePosition(e),this.stemVector.copy(e.stemNormal).setLength(e.stemLength),this.stemEnabled=e.stemEnabled,this.stemMesh.updatePosition(e),this.stemMesh.visible=e.stemEnabled,t!==this.pinColor&&(this.pinColor=t,this.setColorVariant(this.currentColorVariant));const s=this.pinHeadMeshMaterial.uniforms;s.bg.value===i&&s.mask.value===n||(s.bg.value=i,s.mask.value=n,this.pinHeadMeshMaterial.uniformsNeedUpdate=!0)}setColorVariant(e){const t=ge(this.pinColor,e);this.pinHeadMeshMaterial.uniforms.color.value.copy(t),this.currentColorVariant=e}setOpacity(e){this.baseOpacity=e,this.updateOpacity()}fadeOpacity(e){e>0&&(this.visible=!0),this.opacityAnimation.modifyAnimation(this.opacityAnimation.value,e,300).onComplete((()=>{e<=0&&(this.visible=!1)}))}setVisibility(e,t){this.visible=e,this.pinHeadMesh.visible=e,this.stemMesh.visible=e&&t}setStemEnabled(e){this.stemMesh.visible=this.visible&&e}updateMeshPosition(e){this.position.copy(e.anchorPosition),this.pinHeadMesh.updatePosition(e),this.stemMesh.updatePosition(e)}update(e,t,i,n){this.pinHeadMesh.update(t,i,n);const s=this.opacityAnimation.active;this.opacityAnimation.tick(e),s&&this.updateOpacity()}setRenderOverrides(e,t){this.pinHeadMesh.material=e?new PinHeadCustomMaterial(e,!1):this.pinHeadMeshMaterial,t?this.pinHeadMesh.geomScale.copy(t):this.pinHeadMesh.geomScale.set(1,1,1),this.setOpacity(this.pinHeadMeshMaterial.opacity)}updateOpacity(){const e=this.opacityAnimation.value*this.baseOpacity;if(this.pinHeadMeshMaterial.opacity=e,this.pinHeadMeshMaterial.uniforms.alpha.value=e,this.pinHeadMesh.material!==this.pinHeadMeshMaterial){this.pinHeadMesh.material.opacity=e;const t=this.pinHeadMesh.material;t&&t.uniforms&&t.uniforms.alpha&&(t.uniforms.alpha.value=e)}this.stemMesh.pinStemMaterial.uniforms.alpha.value=e}}class NonInstancedPinRenderer extends PinRenderer{constructor(e,t,i,n,s,o){super(e,n,s,o),this.camera=t,this.canvasData=i,this.idToMesh=new Map}dispose(){super.dispose(),this.removePinsByPredicate((()=>!0)),PinMeshGroup.disposeAll()}activate(e){this.bindings.length>0||(super.activate(e),this.bindings.push(this.input.registerPriorityHandler(z.R,K.$,((t,i)=>{const n=i.parent;return e.broadcast(new Q.F7(n.pinId,n.pinType)),!0}))),(0,h.Jm)()||(this.bindings.push(this.input.registerMeshHandler(se.z,B.s.isType(K.$),((t,i)=>{const n=i.parent;e.broadcast(new Q.tP(n.pinId,!0,n.pinType)),e.commandBinder.issueCommand(new L.u(I.C.FINGER)),e.commandBinder.issueCommand(new ne.y(!0))}))),this.bindings.push(this.input.registerMeshHandler(se.A,B.s.isType(K.$),((t,i)=>{const n=i.parent;e.broadcast(new Q.tP(n.pinId,!1,n.pinType)),e.commandBinder.issueCommand(new L.u(null)),e.commandBinder.issueCommand(new ne.y(!1))})))))}render(e){const t=this.getViewportScale(this.canvasData);this.idToMesh.forEach((i=>{i.update(e,this.camera,t,this.canvasData)})),super.render(e)}updatePin(e,t,i,n,s,o){var r,a;super.updatePin(e,t,i,n,s,o);const l=this.getColor(i.color);let c=this.idToMesh.get(e);c||(c=new PinMeshGroup(e,t,i,l,this.layer,this.canvasData,n,s),this.idToMesh.set(e,c),this.input.registerMesh(c.pinHeadMesh,!1)),void 0!==o&&(c.visible=o),c.updateFromPin(i,l,n,s);const h=i.floorId;c.parent&&(null===(r=c.parent)||void 0===r?void 0:r.userData.floorId)===h||(c.parent&&(null===(a=c.parent)||void 0===a||a.remove(c)),this.getFloorContainer(h).userData.typeContainers[t].add(c))}removePin(e){var t;super.removePin(e);const i=this.idToMesh.get(e);i&&(this.idToMesh.delete(e),null===(t=i.parent)||void 0===t||t.remove(i),this.input.unregisterMesh(i.pinHeadMesh),i.dispose())}removePinsByPredicate(e){this.idToMesh.forEach(((t,i)=>{e(t.pinType)&&this.removePin(i)}))}setPinVisible(e,t){const i=this.idToMesh.get(e);i&&(i.visible=t)}setPinColorVariant(e,t){const i=this.idToMesh.get(e);i&&i.setColorVariant(t)}setPinColorVariants(e,t){this.idToMesh.forEach((i=>{i.pinId!==t&&i.setColorVariant(e)}))}setPinColorVariantByType(e,t,i){this.idToMesh.forEach((n=>{n.pinType===e&&n.pinId!==i&&n.setColorVariant(t)}))}setPinOpacity(e,t){const i=this.idToMesh.get(e);i&&i.setOpacity(t)}fadePinOpacity(e,t){const i=this.idToMesh.get(e);i&&i.fadeOpacity(t)}setPinOpacityByType(e,t,i){this.idToMesh.forEach((n=>{n.pinType===e&&n.pinId!==i&&n.setOpacity(t)}))}fadePinOpacityByType(e,t,i=[]){this.idToMesh.forEach((n=>{n.pinType!==e||i.includes(n.pinId)||n.fadeOpacity(t)}))}setPinRenderOverrides(e,t,i){super.setPinRenderOverrides(e,t,i);const n=this.idToMesh.get(e);n&&n.setRenderOverrides(t,i)}pinHeadTransform(e){const t=this.idToMesh.get(e);return t?t.pinHeadMesh.matrixWorld:new n.Matrix4}}var ve=i(45805),ye=i(27829);const be=new k.Z("InstancedPinHeads");class InstancedPinHeads extends n.InstancedMesh{constructor(e,t,i,s){const o=new n.PlaneBufferGeometry($.l,$.l),r=new Float32Array(e),a=new n.InstancedBufferAttribute(r,1);o.setAttribute("instanceAlpha",a);super(o,s&&i?new InstancedPinHeadMaterial(t,i):new PinHeadCustomMaterial(t,!0),e),this.maxCount=e,this.opacityArray=r,this.opacityAttrib=a,this.setColorAt(0,new n.Color),this.renderedPins=[],this.renderOrder=le.z.pins}update(e){let t=0;this.renderedPins.length=0;for(const i of e)i.visible&&(t>=this.maxCount?be.error("Instance count is too small!"):(this.setMatrixAt(t,i.pinHeadMatrix),this.setColorAt(t,i.pinColor),this.opacityArray[t]=i.opacity*i.opacityAnimation.value,t++,this.renderedPins.push(i)));this.count=t,this.visible=this.count>0,this.instanceMatrix.needsUpdate=!0,this.opacityAttrib.needsUpdate=!0,this.instanceColor?this.instanceColor.needsUpdate=!0:be.error("Instance color should be defined")}}const we=new InstancedPinStemMaterial,Se=new k.Z("InstancedPinHeads");class InstancedPinLines extends n.InstancedMesh{constructor(e){const t=new n.BufferGeometry,i=new Float32Array(6);i[0]=i[1]=i[2]=0,i[3]=1,i[4]=1,i[5]=1,t.setAttribute("position",new n.BufferAttribute(i,3));const s=new Float32Array(3*e),o=new n.InstancedBufferAttribute(s,3);t.setAttribute("stemVector",o);const r=new Float32Array(e),a=new n.InstancedBufferAttribute(r,1);t.setAttribute("instanceAlpha",a);const l=[],c=[];for(let i=0;i<4;i++){const s=new Float32Array(4*e),o=new n.InstancedBufferAttribute(s,4);t.setAttribute(`pinHeadMatrixCol${i}`,o),l.push(s),c.push(o)}super(t,we,e),this.maxCount=e,this.stemVectorArray=s,this.stemVectorAttrib=o,this.pinHeadMatrixArray=l,this.pinHeadMatrixAttrib=c,this.opacityArray=r,this.opacityAttrib=a,this.renderOrder=le.z.lines,this.posMatrix=new n.Matrix4,this.isLine=!0,this.isMesh=!1}update(e,t){let i=0;for(const t of e){if(!t.visible||!t.stemEnabled||t.stemLength<.001)continue;if(i>=this.maxCount){Se.error("Instance count is too small!");continue}this.posMatrix.setPosition(t.anchorPosition),this.setMatrixAt(i,this.posMatrix),this.opacityArray[i]=t.opacity*t.opacityAnimation.value;const e=3*i;t.pinHeadObjPosition.toArray(this.stemVectorArray,e);let n=0;for(let e=0;e<4;e++)for(let s=0;s<4;s++)this.pinHeadMatrixArray[e][s+4*i]=t.pinHeadMatrix.elements[n++];i++}this.count=i,this.visible=this.count>0,this.instanceMatrix.needsUpdate=!0,this.stemVectorAttrib.needsUpdate=!0;for(const e of this.pinHeadMatrixAttrib)e.needsUpdate=!0;this.opacityAttrib.needsUpdate=!0,we.uniforms.resolution.value.set(t.width,t.height),we.uniformsNeedUpdate=!0}}const Ee=new k.Z("InstancedPinRenderer");class InstancedPinRenderer extends PinRenderer{constructor(e,t,i,s,o,r){super(e,s,o,r),this.camera=t,this.canvasData=i,this.pins=new Map,this.idToPin=new Map,this.keyToRenderObjs=new Map,this.updatePinHeadMatrix=(()=>{const e=new n.Vector3,t=new n.Vector3,i=new n.Vector3,s=new n.Vector3,o=new n.Vector3,r=new n.Vector3,a=new n.Vector3;return l=>{const c=$.Z.pinHeadMesh.scale,h=this.getViewportScale(this.canvasData),d=1+c.responsiveness/100*(h-1);this.camera.getWorldPosition(r);const u=this.camera.quaternion,p=this.canvasData;for(const h of l){a.copy(h.pinHeadObjPosition).add(h.anchorPosition);const l=r.distanceTo(a),m=c.maxSize-(c.maxSize-c.minSize)*n.MathUtils.smoothstep(l,c.nearBound,c.farBound);t.copy(a).project(this.camera),i.set(p.width/2,p.height/2,1).multiply(t),s.set(m/2,0,0).add(i),o.set(2/p.width,2/p.height,1).multiply(s);const g=o.unproject(this.camera).distanceTo(a)*d,f=n.MathUtils.clamp(g,ve.Z.epsilon,g),v=h.geomScale||ye.f.UNIT;e.set(f*v.x,f*v.y,f*v.z),h.pinHeadMatrix.compose(a,u,e)}}})()}dispose(){super.dispose()}activate(e){this.bindings.length>0||(super.activate(e),this.bindings.push(this.input.registerPriorityHandler(z.R,InstancedPinHeads,((t,i,n)=>{if(!n||void 0===n.instanceId)return!0;const s=i.renderedPins[n.instanceId];return e.broadcast(new Q.F7(s.id,s.pinType)),!0}))),(0,h.Jm)()||(this.bindings.push(this.input.registerMeshHandler(se.z,B.s.isType(InstancedPinHeads),((t,i,n)=>{if(!n||void 0===n.instanceId)return;const s=i.renderedPins[n.instanceId];this.lastHoverId=s.id,this.lastHoverType=s.pinType,e.broadcast(new Q.tP(s.id,!0,s.pinType)),e.commandBinder.issueCommand(new L.u(I.C.FINGER)),e.commandBinder.issueCommand(new ne.y(!0))}))),this.bindings.push(this.input.registerMeshHandler(se.A,B.s.isType(InstancedPinHeads),(()=>{e.broadcast(new Q.tP(this.lastHoverId,!1,this.lastHoverType)),e.commandBinder.issueCommand(new L.u(null)),e.commandBinder.issueCommand(new ne.y(!1))})))))}render(e){for(const t of this.pins.values()){const i=Array.from(t.values());if(0===i.length)continue;const n=this.keyFromPin(i[0]),s=this.keyToRenderObjs.get(n);if(!s){Ee.error("Expecting renderObjs for this key.",this.keyToRenderObjs,this.keyFromPin(i[0]));continue}let{lines:o,pinHeads:r}=s;if(i.forEach((t=>t.opacityAnimation.tick(e))),this.updatePinHeadMatrix(i),o.maxCount<i.length){const e=o.parent;if(!e){Ee.error("Expecting a parent.");continue}e.remove(o),o.dispose(),e.remove(r),this.input.unregisterMesh(r);const{backgroundTexture:t,maskTexture:n,overrideTexture:a}=i[0];r.dispose(),Object.assign(s,this.createInstances(e,s.id,i.length+16,t,n,a)),o=s.lines,r=s.pinHeads}o.update(i,this.canvasData),r.update(i)}super.render(e)}updatePin(e,t,i,s,o,r){var a;super.updatePin(e,t,i,s,o,r);let l=this.idToPin.get(e);const c=i.floorId,h=this.getColor(i.color).baseColor,d=`${c}_${t}_${(null===(a=null==l?void 0:l.overrideTexture)||void 0===a?void 0:a.uuid)||s.uuid}`;if(!l){l=Object.assign(Object.assign({id:e},i),{visible:!0,opacity:1,pinType:t,opacityAnimation:new fe.z(1),backgroundTexture:s,maskTexture:o,pinHeadMatrix:new n.Matrix4,pinHeadObjPosition:new n.Vector3,pinColor:h,colorVariant:q.K_.DEFAULT,overrideTexture:null,geomScale:null}),this.idToPin.set(e,l);let r=this.pins.get(d);r||(r=new Map,this.pins.set(d,r)),r.set(e,l),this.createRenderObjsForPin(l)}const u=this.keyFromPin(l);Object.assign(l,i,{pinType:t,textureId:s.uuid}),this.changePinHeadGroupIfNeeded(u,d,l),l.pinHeadObjPosition.copy(l.stemNormal).setLength(l.stemLength),l.pinColor=ge(this.getColor(l.color),l.colorVariant),void 0!==r&&this.setPinVisible(e,r)}removePin(e){super.removePin(e);const t=this.idToPin.get(e);if(!t)return;this.idToPin.delete(e);const i=this.keyFromPin(t),n=this.pins.get(i);n&&(n.delete(e),this.cleanupRenderObjIfNeeded(i))}removePinsByPredicate(e){this.idToPin.forEach(((t,i)=>{e(t.pinType)&&this.removePin(i)}))}setPinVisible(e,t){const i=this.idToPin.get(e);i?i.visible=t:Ee.error("setPinVisible on a pin that doesn't exist.",e)}setPinColorVariant(e,t){const i=this.idToPin.get(e);i?(i.colorVariant=t,i.pinColor=ge(this.getColor(i.color),t)):Ee.error("setPinColorVariant on a pin that doesn't exist.")}setPinColorVariants(e,t){this.idToPin.forEach(((i,n)=>{n!==t&&this.setPinColorVariant(n,e)}))}setPinColorVariantByType(e,t,i){this.idToPin.forEach(((n,s)=>{n.pinType===e&&s!==i&&this.setPinColorVariant(s,t)}))}setPinOpacity(e,t){const i=this.idToPin.get(e);i?i.opacity=t:Ee.error("setPinOpacity on a pin that doesn't exist.")}fadePinOpacity(e,t){const i=this.idToPin.get(e);i?(t>0&&this.setPinVisible(e,!0),i.opacityAnimation.modifyAnimation(i.opacityAnimation.value,t,300).onComplete((()=>{t<=0&&this.setPinVisible(e,!1)}))):Ee.error("setPinVisible on a pin that doesn't exist.",e)}setPinOpacityByType(e,t,i){this.idToPin.forEach(((n,s)=>{n.pinType===e&&s!==i&&this.setPinOpacity(s,t)}))}fadePinOpacityByType(e,t,i=[]){this.idToPin.forEach(((n,s)=>{n.pinType!==e||i.includes(s)||this.fadePinOpacity(s,t)}))}setPinRenderOverrides(e,t,i){super.setPinRenderOverrides(e,t,i);const n=this.idToPin.get(e);if(!n)return void Ee.error("setPinRenderOverrides on a pin that doesn't exist.");const s=this.keyFromPin(n);if(!this.keyToRenderObjs.get(s))return void Ee.error("Expecting renderObjs while setting override material");n.overrideTexture=t,n.geomScale=i;const o=this.keyFromPin(n);this.changePinHeadGroupIfNeeded(s,o,n)}pinHeadTransform(e){const t=this.idToPin.get(e);return t?t.pinHeadMatrix:(Ee.error("pinHeadTransform on a pin that doesn't exist."),new n.Matrix4)}keyFromPin(e){return`${e.floorId}_${e.pinType}_${e.overrideTexture?e.overrideTexture.uuid:e.backgroundTexture.uuid}`}createRenderObjsForPin(e){const{backgroundTexture:t,maskTexture:i,overrideTexture:n}=e,s=this.keyFromPin(e);if(this.keyToRenderObjs.get(s))return;const o=this.getFloorContainer(e.floorId).userData.typeContainers[e.pinType];o.userData||(o.userData={});const r=e.overrideTexture?e.overrideTexture.uuid:e.backgroundTexture.uuid;if(!o.userData[r]){const e=this.createInstances(o,r,16,t,i,n);o.userData[r]=e,this.keyToRenderObjs.set(s,e)}}createInstances(e,t,i,n,s,o){const r=new InstancedPinLines(i);r.layers.mask=this.layer.mask,e.add(r);const a=new InstancedPinHeads(i,o||n,o?null:s,!o);return a.layers.mask=this.layer.mask,e.add(a),this.input.registerMesh(a,!1),{lines:r,pinHeads:a,id:t}}changePinHeadGroupIfNeeded(e,t,i){if(e!==t){let n=this.pins.get(t);n||(n=new Map,this.pins.set(t,n)),n.set(i.id,i),this.createRenderObjsForPin(i);const s=this.pins.get(e);s&&(null==s||s.delete(i.id),this.cleanupRenderObjIfNeeded(e))}}cleanupRenderObjIfNeeded(e){const t=this.pins.get(e),i=this.keyToRenderObjs.get(e);if(t&&0===t.size&&i){const t=i.lines.parent;if(this.input.unregisterMesh(i.pinHeads),this.pins.delete(e),this.keyToRenderObjs.delete(e),!t)return void Ee.error("Expecting pinTypeObj!");t.userData[i.id]=void 0,t.remove(i.lines),t.remove(i.pinHeads)}}}class PinsModule extends s.Y{constructor(){super(...arguments),this.name="pins",this.editActivated=!1,this.editBindings=[],this.touchDevice=(0,h.Jm)(),this.worldPosition=new n.Vector3,this.visibilityChanged=()=>{const e=!this.in360View(),t=!this.interactionmodeData.isVR();this.pinRenderer.container.visible=e&&t;const{floorsViewData:i}=this,n=this.viewmode===y.Ey.Dollhouse||this.viewmode===y.Ey.Floorplan,s=i.transition.progress.active?()=>!0:i.isHidden;this.pinRenderer.setFloorsHidden(n?s:()=>!1)},this.viewmodeChanged=e=>{this.viewmode=e.toMode,this.visibilityChanged()},this.onEnablePinEditing=async e=>{e.enabled?this.enableEditing():this.disableEditing()},this.applicationChanged=e=>{this.pinEditor&&(e.application,d.Mx.WORKSHOP)},this.updateRenderedPin=()=>{const{pinState:e,creatingNewPin:t,openPin:i,previewPin:n}=this.viewData;if(!t||[q.tS.PLACING,q.tS.PLACED].includes(e)){this.editActivated&&this.pinEditor.updateAnchorMesh();const e=n||i;if(e){const{id:t,pinType:i,backgroundTexture:n,maskTexture:s}=e;this.pinRenderer.updatePin(t,i,e,n,s),this.pinRenderer.setPinColorVariant(t,q.K_.HIGHLIGHTED),this.pinRenderer.setPinColorVariants(q.K_.DEFAULT,t)}else this.pinRenderer.setPinColorVariants(q.K_.DEFAULT)}},this.onPinUpdated=e=>{const t=Object.assign(Object.assign({},e.pin),{pinType:e.pinType});this.viewData.updateOpenPin(t),this.saveScreenPosition(t)},this.onPinSelected=e=>{const t=Object.assign(Object.assign({},e.pin),{pinType:e.pinType}),i=this.viewData;i.setPinState(q.tS.SELECTED),i.setOpenPin(t),this.saveScreenPosition(t)},this.onPinClosed=e=>{const{pinType:t,id:i}=e,{openPin:n,previewPin:s}=this.viewData,o=i===(null==n?void 0:n.id)?n:i===(null==s?void 0:s.id)?s:null;o&&o.pinType===t&&o.id===i&&(this.resetState(),o.id===(null==n?void 0:n.id)?this.viewData.setOpenPin(null):o.id===(null==s?void 0:s.id)&&this.viewData.setPreviewPin(null))},this.onPinOpened=e=>{const t=this.viewData,i=Object.assign(Object.assign({},e.pin),{pinType:e.pinType});t.setEditablePin(e.editable),t.setPinState(e.editable?q.tS.EDITING:q.tS.OPEN),t.setOpenPin(i),this.saveScreenPosition(i)},this.onStartPinCreation=e=>{const t=this.viewData,i=Object.assign(Object.assign({},e.pin),{pinType:e.pinType});t.setEditablePin(!0),t.setPinState(q.tS.CREATING),t.setOpenPin(i),this.pinEditor.startPinCreation()},this.onPreviewPinAnnotation=async e=>{const t=this.viewData,i=Object.assign(Object.assign({},e.pin),{pinType:e.pinType});t.pinState===q.tS.SELECTED&&t.setOpenPin(null),t.setPinState(q.tS.PREVIEWING),t.setPreviewPin(i),this.saveScreenPosition(i)},this.onOpenPin=async e=>{if(e.pinType!==q.Er.MATTERTAG||this.tagsEnabled)return this.openPin(e.id,e.pinType,e.transition,e.attachmentId,e.listIndex,e.editText)},this.onSelectPin=async e=>{(e.pinType!==q.Er.MATTERTAG||this.tagsEnabled)&&this.selectPin(e.id,e.pinType,e.transition)},this.onPreviewStemLength=async e=>{const{openPin:t,isPinEditable:i}=this.viewData;i&&t&&t.id===e.id?this.viewData.updateOpenPin({stemLength:e.stemLength}):this.log.debug("Cannot preview stem length, not open for edit")},this.saveScreenPosition=(()=>{const e=new n.Vector3;return t=>{const i=this.viewData;e.copy(t.stemNormal).setLength(t.stemLength),this.worldPosition.copy(t.anchorPosition).add(e);const n=(0,l.q9)(this.cameraData,this.worldPosition);i.setScreenPosition(n.screenPosition)}})(),this.onCameraUpdate=()=>{const{creatingNewPin:e,previewPin:t,openPin:i}=this.viewData;!e&&t?this.saveScreenPosition(t):i&&this.saveScreenPosition(i)},this.onAssetOpened=e=>{this.viewData.setPreviewPin(null)},this.onToolToggled=e=>{e.open||this.resetState()},this.handleSweepChange=()=>this.handleSweepAndViewModeChange(),this.handleViewModeChange=()=>this.handleSweepAndViewModeChange(),this.cancelAndReset=()=>{const{creatingNewPin:e,openPin:t}=this.viewData;e&&t&&(this.pinRenderer.removePin(t.id),this.engine.broadcast(new Q.hu(t.id,t.pinType))),this.viewData.setOpenPin(null),this.resetState()},this.resetState=()=>{const e=this.viewData;e.setEditablePin(!1),e.setCanPlace(!0),e.setScreenPosition(null),e.setPinState(q.tS.IDLE),e.setCanAdd(!this.in360View()),this.pinRenderer.hideSelectedMesh()},this.cancelPinCreation=async()=>{this.cancelAndReset()},this.onPinDeleted=e=>{const{pinType:t}=e;if(t===q.Er.MATTERTAG&&!this.tagsEnabled)return;this.pinRenderer.removePin(e.id);const{openPin:i}=this.viewData;(null==i?void 0:i.id)===e.id&&(null==i?void 0:i.pinType)===e.pinType&&this.cancelAndReset()},this.onPinClicked=e=>{const{pinType:t,id:i}=e;if(t!==q.Er.MATTERTAG||this.tagsEnabled)if(t===q.Er.MATTERTAG)this.selectPin(i,t,c.n.Interpolate);else{const{openPin:e}=this.viewData,n=i===(null==e?void 0:e.id)&&t===(null==e?void 0:e.pinType);e&&this.deselectPin(e),n||this.openPin(i,t,c.n.Interpolate)}},this.onHoverChanged=e=>{const{pinType:t,id:i,hovering:n}=e;if(t===q.Er.MATTERTAG&&!this.tagsEnabled)return;const{creatingNewPin:s,pinState:o,previewPin:r,openPin:a}=this.viewData;if(!s)if(n){if(a){if(a.id===i&&a.pinType===t)return;o===q.tS.SELECTED&&(this.viewData.setOpenPin(null),this.pinRenderer.hideSelectedMesh())}t===q.Er.MATTERTAG?this.engine.commandBinder.issueCommand(new M.X8(i)):t===q.Er.NOTE&&this.engine.commandBinder.issueCommand(new _.yC(i)),this.pinRenderer.setPinColorVariantByType(t,q.K_.DEFAULT,null==r?void 0:r.id),this.pinRenderer.setPinColorVariant(i,q.K_.HIGHLIGHTED)}else{const e=o===q.tS.PREVIEWING;r&&e&&(this.pinRenderer.setPinColorVariant(r.id,q.K_.DEFAULT),this.viewData.setPreviewPin(null))}},this.clickOffPin=async()=>{const{openPin:e}=this.viewData;e&&this.deselectPin(e)},this.movePin=async e=>{const{openPin:t,isPinEditable:i}=this.viewData;i&&(t&&t.id===e.id?(this.viewData.updateOpenPin(e.pos),this.engine.broadcast(new Q.bV(t.id,t.pinType,e.pos))):this.log.debug("Cannot move the pin, not open for edit"))},this.placePin=async e=>{const{openPin:t,isPinEditable:i,canPlace:n}=this.viewData;i&&(t&&n?(this.viewData.setPinState(q.tS.EDITING),this.engine.broadcast(new Q.b0(t.id,t.pinType,t))):(this.log.debug("Cannot place pin because there is no open pin"),this.cancelAndReset()))}}async init(e,t){this.engine=t,this.tagsEnabled=e.newTagsEnabled;const[i,n,s,l,c]=await Promise.all([t.getModule(o.default),t.getModule(a.default),t.market.waitForData(u.W),t.market.waitForData(d.pu),t.getModule(r.default)]);this.input=i;const h=t.claimRenderLayer(this.name);this.pinRenderer=n.supportsInstancing()?new InstancedPinRenderer(i,n.getCamera(),s,h,t.commandBinder,c):new NonInstancedPinRenderer(i,n.getCamera(),s,h,t.commandBinder,c),n.getScene().add(this.pinRenderer.container),t.addComponent(this,this.pinRenderer),[this.floorsViewData,this.viewmodeData,this.interactionmodeData,this.sweepData,this.cameraData]=await Promise.all([t.market.waitForData(p.c),t.market.waitForData(v.O),t.market.waitForData(m.Z),t.market.waitForData(f.Z),t.market.waitForData(g.M_)]),this.viewData=new x.B,this.pinEditor=new PinEditor(this.viewData,this.engine,this.input,this.pinRenderer),this.floorsViewData.iterate((e=>this.pinRenderer.getFloorContainer(e.id))),this.viewmode=this.viewmodeData.currentMode,this.bindings.push(t.commandBinder.addBinding(X.EP,this.onEnablePinEditing),t.commandBinder.addBinding(X.$b,this.onOpenPin),t.commandBinder.addBinding(X.Ar,this.onSelectPin),t.commandBinder.addBinding(X.G3,this.clickOffPin),this.interactionmodeData.onChanged(this.visibilityChanged),this.floorsViewData.onChanged(this.visibilityChanged),this.viewmodeData.makeModeChangeSubscription(this.visibilityChanged),t.subscribe(b.Z,this.visibilityChanged),t.subscribe(S.a,this.viewmodeChanged),t.subscribe(w.Z,this.viewmodeChanged),t.subscribe(Q.F7,this.onPinClicked),t.subscribe(Q.sD,this.onPinOpened),t.subscribe(Q.Q4,this.onPinSelected),t.subscribe(Q.KR,this.onPinUpdated),t.subscribe(Q.A,this.onPinClosed),t.subscribe(T.ZL,this.onAssetOpened),t.subscribe(T.Oj,this.onToolToggled),t.subscribe(E.bS,this.applicationChanged),this.viewData.onPinStateChanged(this.updateRenderedPin),this.viewData.onOpenPinChanged(this.updateRenderedPin),this.viewData.onPreviewPinChanged(this.updateRenderedPin)),this.touchDevice||this.bindings.push(t.commandBinder.addBinding(X._l,this.onPreviewPinAnnotation),t.subscribe(Q.tP,this.onHoverChanged),this.cameraData.onChanged(this.onCameraUpdate));let y=l.application;this.bindings.push(l.onPropertyChanged("application",(e=>{e!==y&&(this.visibilityChanged(),y=e)}))),this.visibilityChanged(),t.market.register(this,x.B,this.viewData)}dispose(e){this.disableEditing(),this.viewData.setPinState(q.tS.IDLE),this.pinEditor.dispose(),this.pinRenderer.dispose(),this.bindings.forEach((e=>{e.cancel()})),this.bindings=[],this.editBindings=[],super.dispose(e)}onUpdate(){this.pinEditor.update()}in360View(){const e=this.sweepData.currentSweep?this.sweepData.currentSweep:"";return this.viewmodeData.isPano()&&this.sweepData.isSweepUnaligned(e)}enableEditing(){if(!this.editActivated){if(0===this.editBindings.length){const e=this.engine,t=e.commandBinder;this.editBindings.push(e.subscribe(Q.nO,this.onStartPinCreation),e.subscribe(Q.w0,this.cancelAndReset),e.subscribe(Q.VZ,this.onPinDeleted),t.addBinding(X.fe,this.onPreviewStemLength),t.addBinding(X.ip,this.placePin),t.addBinding(X.tT,this.cancelPinCreation),t.addBinding(X.I$,this.movePin),this.sweepData.makeSweepChangeSubscription(this.handleSweepChange),e.subscribe(w.Z,this.handleViewModeChange))}else this.editBindings.forEach((e=>{e.renew()}));this.handleSweepAndViewModeChange(),this.editActivated=!0}}disableEditing(){this.editActivated&&(this.cancelAndReset(),this.viewData.setPinState(q.tS.IDLE),this.editBindings.forEach((e=>{e.cancel()})),this.editActivated=!1)}handleSweepAndViewModeChange(){const e=this.viewData,t=!this.in360View();e.creatingNewPin&&!t?this.cancelAndReset():e.setCanAdd(t)}selectPin(e,t,i){if(t===q.Er.MATTERTAG){const{openPin:n}=this.viewData;e===(null==n?void 0:n.id)&&t===(null==n?void 0:n.pinType)||this.engine.commandBinder.issueCommand(new M.YC(e,i||void 0))}}async openPin(e,t,i,n,s=-1,o=!1){return t===q.Er.NOTE?this.engine.commandBinder.issueCommand(new _.dR(e,i,n,s,o)):t===q.Er.MATTERTAG?this.engine.commandBinder.issueCommand(new M.lt(e,i,n,s)):void 0}deselectPin(e){this.engine.broadcast(new Q.Fe(e.id,e.pinType))}}const Te=PinsModule},43770:(e,t,i)=>{"use strict";i.d(t,{tP:()=>PinHoverChangeMessage,F7:()=>PinClickedMessage,b0:()=>PinPlacedMessage,bV:()=>PinMovedMessage,Fe:()=>PinDeselectMessage,hu:()=>PinAddCancelledMessage,w0:()=>PinDiscardedMessage,nO:()=>PinStartCreatingMessage,sD:()=>PinOpenedMessage,Q4:()=>PinSelectedMessage,KR:()=>PinUpdatedMessage,A:()=>PinClosedMessage,VZ:()=>PinDeletedMessage,nY:()=>FocusPinAnnotationMessage});var n=i(93528);class PinHoverChangeMessage extends n.v{constructor(e,t,i){super(),this.id=e,this.hovering=t,this.pinType=i}}class PinClickedMessage extends n.v{constructor(e,t){super(),this.id=e,this.pinType=t}}class PinPlacedMessage extends n.v{constructor(e,t,i){super(),this.id=e,this.pinType=t,this.pinPos=i}}class PinMovedMessage extends n.v{constructor(e,t,i){super(),this.id=e,this.pinType=t,this.pinPos=i}}class PinDeselectMessage extends n.v{constructor(e,t){super(),this.id=e,this.pinType=t}}class PinAddCancelledMessage extends n.v{constructor(e,t){super(),this.id=e,this.pinType=t}}class PinDiscardedMessage extends n.v{constructor(e){super(),this.pinType=e}}class PinStartCreatingMessage extends n.v{constructor(e,t){super(),this.pin=e,this.pinType=t}}class PinOpenedMessage extends n.v{constructor(e,t,i){super(),this.pin=e,this.pinType=t,this.editable=i}}class PinSelectedMessage extends n.v{constructor(e,t){super(),this.pin=e,this.pinType=t}}class PinUpdatedMessage extends n.v{constructor(e,t){super(),this.pin=e,this.pinType=t}}class PinClosedMessage extends n.v{constructor(e,t){super(),this.id=e,this.pinType=t}}class PinDeletedMessage extends n.v{constructor(e,t){super(),this.id=e,this.pinType=t}}class FocusPinAnnotationMessage extends n.v{}},90666:(e,t,i)=>{"use strict";i.d(t,{l:()=>n,Z:()=>s});const n=1,s=Object.freeze({anchor:{size:.1},stem:{length:.23,width:1,opacity:1,transparent:!0,color:"white",alphaTest:.05},pinHeadMesh:{scale:{nearBound:1.5,farBound:4.8,maxSize:80,minSize:40,baseViewportSize:800,responsiveness:100}}})},50004:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>PreRendererModule});var n,s=i(54122),o=i(77956),r=i(13453),a=i(96640),l=i(62367);!function(e){e[e.None=0]="None",e[e.Queued=1]="Queued",e[e.Rendering=2]="Rendering",e[e.Rendered=3]="Rendered"}(n||(n={}));class PreRenderer{constructor(e){this.statusMap={},this.active=[],this.queued=[],this.panoRenderer=e,this.disablePreRendering()}init(){}dispose(){}activate(e){}deactivate(e){this.disablePreRendering()}enablePreRendering(){this.enabled=!0}disablePreRendering(){this.enabled=!1}render(){}beforeRender(){this.enabled&&this.processQueued()}tryPreRender(e){return this.getPreRenderState(e)===n.None&&(this.queued.push(e),this.statusMap[e]=n.Queued,!0)}getPreRenderState(e){const t=this.statusMap[e];return void 0!==t?t:n.None}processQueued(){let e=0;for(const t of Object.keys(this.statusMap))this.statusMap[t]===n.Rendering&&e++;if(0===e&&this.queued.length>0){const e=this.queued.shift();if(e){this.active.push(e),this.statusMap[e]=n.Rendering;this.panoRenderer.activateSweep(e).then((()=>{this.onRendered(e)}))}}}cleanup(e=[]){const t=(0,l.ow)(e),i=[];for(const e of this.queued)t[e]?i.push(e):this.statusMap[e]=n.None;this.queued.length=0,this.queued.push.apply(this.queued,i);const s=[];for(const e of this.active)t[e]?s.push(e):this.statusMap[e]=n.None;this.active.length=0,this.active.push.apply(this.active,s)}onRendered(e){this.statusMap[e]=n.Rendered}}var c=i(21265);const h=Object.freeze({prerender:{preRenderTourPanos:c.hu("pre",1)}});var d=i(85381);class PreRendererModule extends s.Y{constructor(){super(...arguments),this.name="prerenderer-module",this.lastPrerendered=null}async init(e,t){if(h.prerender.preRenderTourPanos||e.preRenderTourPanos){this.sweepData=await t.market.waitForData(o.Z);const e=await t.getModule(d.Z);this.panoRenderer=e.getRenderer(),this.preRenderer=new PreRenderer(this.panoRenderer),t.addComponent(this,this.preRenderer),this.bindings.push(t.subscribe(r.Z,(e=>{this.preRenderer.enablePreRendering(),this.lastPrerendered=null,e.sweepIds&&e.sweepIds.length>=3&&(this.lastPrerendered=e.sweepIds[2],this.preRenderer.tryPreRender(this.lastPrerendered)),this.cleanup(this.sweepData),this.currentRestrictedSweeps=e.sweepIds}))),this.bindings.push(t.subscribe(a.Z,(e=>{this.preRenderer.disablePreRendering(),this.cleanup(this.sweepData,!0),this.currentRestrictedSweeps=null})))}}getCurrentSweeps(){return this.currentRestrictedSweeps||[]}cleanup(e,t=!1){const i=[];e.transition.active?(e.transition.from&&i.push(e.transition.from),e.transition.to&&i.push(e.transition.to)):e.currentSweep&&i.push(e.currentSweep),this.lastPrerendered&&i.push(this.lastPrerendered),t&&this.panoRenderer.freeAllTextures(i),this.preRenderer.cleanup(i)}}},24135:(e,t,i)=>{"use strict";i.d(t,{P:()=>RaycasterData,E:()=>RaycastHit});var n=i(2212),s=i(19413);class RaycasterData extends s.V{constructor(){super(...arguments),this.name="pointer",this.hit=null,this.hits=[],this.pointerNdcPosition=new n.Vector2,this.pointerScreenPosition=new n.Vector2,this.pointerOrigin=new n.Vector3,this.pointerDirection=new n.Vector3,this.pointerRay=new n.Ray}}class RaycastHit{constructor(e,t,i,n){this.point=e,this.normal=t,this.object=i,this.intersection=n,this.face={normal:t}}}},62513:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>RaycasterModule});var n=i(54122),s=i(2212),o=i(97620),r=i(46266);class Box3Helper extends s.LineSegments{constructor(e,t){const i=e.max,n=e.min,o=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1];o[0]=i.x,o[1]=i.y,o[2]=i.z,o[3]=n.x,o[4]=i.y,o[5]=i.z,o[6]=n.x,o[7]=n.y,o[8]=i.z,o[9]=i.x,o[10]=n.y,o[11]=i.z,o[12]=i.x,o[13]=i.y,o[14]=n.z,o[15]=n.x,o[16]=i.y,o[17]=n.z,o[18]=n.x,o[19]=n.y,o[20]=n.z,o[21]=i.x,o[22]=n.y,o[23]=n.z;const r=void 0!==t?t:16776960,a=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),l=new s.BufferGeometry;l.setIndex(new s.BufferAttribute(a,1)),l.setAttribute("position",new s.Float32BufferAttribute(o,3)),l.computeBoundingSphere(),super(l,new s.LineBasicMaterial({color:r})),this.box=e}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),s.Object3D.prototype.updateMatrixWorld.call(this,e))}}const a=new s.Matrix4;class ColliderNode{constructor(){this.parent=null,this.raycastDistance=1/0,this.distance=1/0}updateRaycastDistance(e){this.raycastDistance=this.bounds.distanceToPoint(e)}updateDistanceToBounds(e){this.distance=this.bounds.distanceToPoint(e)}}class ColliderFacesTarget extends ColliderNode{constructor(e,t,i){super(),this.mesh=e,this.faces=t,this.nearestPointOnGeometry=(()=>{const e=new s.Triangle,t=new s.Vector3,i=new s.Vector3,n=new s.Vector3;return o=>{let r=1/0;const a=o.clone(),l=new s.Vector3,c=new s.Vector3(1/0,1/0,1/0);for(const s of this.faces){e.set(t.set(s.ax,s.ay,s.az),i.set(s.bx,s.by,s.bz),n.set(s.cx,s.cy,s.cz)),e.closestPointToPoint(a,l);const o=a.distanceToSquared(l);o<r&&(c.copy(l),r=o)}return c}})(),this.geometry=this.makeGeometryFromFaces(t),this.facesBounds=(0,r.A)(this.geometry),this.facesCenter=this.facesBounds.getCenter(new s.Vector3),this.bounds=this.facesBounds.clone().intersect(i),this.center=this.bounds.getCenter(new s.Vector3)}makeGeometryFromFaces(e){const t=new Float32Array(9*e.length);let i=0;const n={};for(const s of e){let e=n[s.materialIndex];e||(e=n[s.materialIndex]={start:i/3,count:0,materialIndex:s.materialIndex}),e.count+=3,t[i++]=s.ax,t[i++]=s.ay,t[i++]=s.az,t[i++]=s.bx,t[i++]=s.by,t[i++]=s.bz,t[i++]=s.cx,t[i++]=s.cy,t[i++]=s.cz}const o=new s.BufferGeometry;o.setAttribute("position",new s.BufferAttribute(t,3)),o.computeBoundingBox(),o.boundingBox&&(o.boundingSphere=o.boundingBox.getBoundingSphere(new s.Sphere));for(const e in n){const t=n[e];o.addGroup(t.start,t.count,t.materialIndex)}return o}raycast(e,t){const i=this.mesh.geometry,n=this.mesh.matrixWorld,s=this.mesh.matrix;this.mesh.geometry=this.geometry,this.mesh.matrix=a,this.mesh.matrixWorld=a,this.mesh.raycast(e,t),this.mesh.geometry=i,this.mesh.matrix=s,this.mesh.matrixWorld=n}}class ColliderMeshTarget extends ColliderNode{constructor(e){super(),this.mesh=e,this._bounds=new s.Box3,this.mesh.geometry.boundingBox||this.mesh.geometry.computeBoundingBox(),this.center=this.bounds.getCenter(new s.Vector3)}get bounds(){return this._bounds.copy((0,r.A)(this.mesh.geometry)).applyMatrix4(this.mesh.matrixWorld)}raycast(e,t){this.mesh.visible&&this.mesh.raycast(e,t)}}class ColliderFace{constructor(e,t,i,n,o,r,a,l,c,h){this.materialIndex=e,this.ax=t,this.ay=i,this.az=n,this.bx=o,this.by=r,this.bz=a,this.cx=l,this.cy=c,this.cz=h,this.bounds=new s.Box3(new s.Vector3(Math.min(t,o,l),Math.min(i,r,c),Math.min(n,a,h)),new s.Vector3(Math.max(t,o,l),Math.max(i,r,c),Math.max(n,a,h)))}}class ColliderOctreeNode extends ColliderNode{constructor(e,t,i,n){super(),this.level=t,this.leafMinSize=i,this.leafMaxFaces=n,this.childNodes=[],this.children=[],this.listeners={},this.bounds=e.clone(),this.size=e.getSize(new s.Vector3),this.center=e.getCenter(new s.Vector3)}get depth(){return this.level}*addMeshes(e){e.updateMatrixWorld(!0);const t=[];e.traverse((e=>{e instanceof s.Mesh&&t.push(e)}));for(const e of t){const t=new ColliderMeshTarget(e);if(e.geometry instanceof s.BufferGeometry&&this.bounds.containsBox(t.bounds)){const t=this.geometryToFaces(e.geometry,e.matrixWorld);yield,yield*this.addFaces(e,t)}else this.addMesh(t)}}removeMeshes(e){let t=!1;for(let i=0;i<this.children.length;i++){const n=this.children[i];(n instanceof ColliderMeshTarget||n instanceof ColliderFacesTarget)&&n.mesh.id===e.id&&(n.parent=null,this.children.splice(i,1),this.emit("removed",this,n),t=!0)}if(!t)throw new Error("Mesh that is being attempted removed does not exist in this node.")}addMesh(e){let t=!1;if(this.size.length()>this.leafMinSize){0===this.childNodes.length&&this.buildChildNodes();for(const i of this.childNodes)i.bounds.containsBox(e.bounds)&&(t=!0,i.addMesh(e))}t||this.add(e)}add(e){if(e.parent)throw new Error("ColliderNode already has a parent, remove before trying to add in another node");e.parent=this,this.children.push(e),this.emit("added",this,e)}*addFaces(e,t){if(t.length>this.leafMaxFaces&&this.size.length()>this.leafMinSize)0===this.childNodes.length&&this.buildChildNodes(),yield*this.splitFaces(e,t);else if(t.length>0){const i=new ColliderFacesTarget(e,t,this.bounds);yield this.addMesh(i)}yield}*splitFaces(e,t){for(const i of this.childNodes){const n=[];for(const e of t)i.bounds.intersectsBox(e.bounds)&&n.push(e);yield*i.addFaces(e,n)}}buildChildNodes(){const e=this.size.multiplyScalar(.5);for(let t=0;t<2;t++)for(let i=0;i<2;i++)for(let n=0;n<2;n++){const o=this.bounds.min.x+e.x*n,r=o+e.x,a=this.bounds.min.y+e.y*t,l=a+e.y,c=this.bounds.min.z+e.z*i,h=c+e.z,d=new s.Box3(new s.Vector3(o,a,c),new s.Vector3(r,l,h)),u=new ColliderOctreeNode(d,this.level+1,this.leafMinSize,this.leafMaxFaces);this.childNodes.push(u),this.add(u)}}raycast(e,t){if(!0===e.ray.intersectsBox(this.bounds))for(const i of this.children)i.raycast(e,t)}pick(e,t,i){if(!e.ray.intersectsBox(this.bounds))return t;for(const t of this.children)t.updateRaycastDistance(e.ray.origin);this.children.sort(((e,t)=>e.raycastDistance-t.raycastDistance));for(const n of this.children){if(t&&t.distance<n.raycastDistance)break;if(i(n))if(n instanceof ColliderOctreeNode)t=n.pick(e,t,i);else{const i=[];n.raycast(e,i);for(const e of i)(!t||t.distance>e.distance)&&(t=e)}}return t}nearestTo(e,t,i=null){for(const t of this.children)t.updateDistanceToBounds(e);this.children.sort(((e,t)=>e.distance-t.distance));for(const n of this.children){if(0!==n.distance&&i&&i.distance<n.distance)break;if(t(n))if(n instanceof ColliderOctreeNode)i=n.nearestTo(e,t,i);else if(n instanceof ColliderFacesTarget){const t=n.nearestPointOnGeometry(e),s=t.distanceTo(e);if(!i||i.distance>s){i={point:t,object:n.mesh,distance:s}}}}return i}geometryToFaces(e,t){let i=e.getAttribute("position");if(i instanceof s.InterleavedBufferAttribute)throw new Error("InterleavedBufferAttribute not supported");t.equals(a)||(i=i.clone(),i.applyMatrix4(t));const n=i.array;let o;if(e.index){const t=e.index.array;o=new Array(t.length/3);let i=0;const s=e.groups.length>0?e.groups:[{start:0,count:t.length,materialIndex:0}];for(const e of s)for(let s=e.start;s<e.start+e.count;s+=3){const r=3*t[s],a=3*t[s+1],l=3*t[s+2];o[i++]=new ColliderFace(e.materialIndex||0,n[r],n[r+1],n[r+2],n[a],n[a+1],n[a+2],n[l],n[l+1],n[l+2])}}else{o=new Array(n.length/9);let t=0;const i=e.groups.length>0?e.groups:[{start:0,count:n.length/3,materialIndex:0}];for(const e of i)for(let i=3*e.start;i<3*(e.start+e.count);i+=9)o[t++]=new ColliderFace(e.materialIndex||0,n[i],n[i+1],n[i+2],n[i+3],n[i+4],n[i+5],n[i+6],n[i+7],n[i+8])}return o}getAllBounds(e,t=0,i=1/0,n=!1){for(const s of this.children)this.level>=t&&this.level<=i&&(s instanceof ColliderFacesTarget||!n)&&e.push(s.bounds.clone()),s instanceof ColliderOctreeNode&&s.getAllBounds(e,t,i,n)}emit(e,...t){const i=this.listeners[e]||[];for(const e of i)e(...t);this.parent&&this.parent.emit(e,...t)}on(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}}class OctreeCollider{constructor(e,t,i){this.meshToNodes={},this._depth=0;const n=(0,o.rj)(e);this.root=new ColliderOctreeNode(n,0,t,i),this.root.on("added",((e,t)=>{e.depth>this._depth&&(this._depth=e.depth),(t instanceof ColliderMeshTarget||t instanceof ColliderFacesTarget)&&(this.meshToNodes[t.mesh.id]||(this.meshToNodes[t.mesh.id]=[]),this.meshToNodes[t.mesh.id].push(t))})),this.root.on("removed",((e,t)=>{if(t instanceof ColliderMeshTarget||t instanceof ColliderFacesTarget){const e=this.meshToNodes[t.mesh.id];for(let i=0;i<e.length;i++)e[i]===t&&e.splice(i,1)}}))}get depth(){return this._depth}*addMeshesAsync(e){yield*this.root.addMeshes(e)}addMeshes(e){for(const t of this.root.addMeshes(e));}removeMeshes(e){e.traverse((e=>{const t=this.meshToNodes[e.id]||[];for(const i of t)i.parent&&i.parent.removeMeshes(e)}))}raycast(e){const t=[];return this.root.raycast(e,t),t}getAllBounds(e=0,t=1/0,i=!1){const n=[];return this.root.getAllBounds(n,e,t,i),n}pick(e,t){return this.root.pick(e,null,(e=>!t||!(e instanceof ColliderMeshTarget||e instanceof ColliderFacesTarget)||t(e.mesh)))}nearestMeshTo(e,t){const i=this.root.bounds.clampPoint(e,new s.Vector3);return this.root.nearestTo(i,(e=>!t||!(e instanceof ColliderMeshTarget||e instanceof ColliderFacesTarget)||t(e.mesh)))}getDebugBoundsMesh(e=16777215,t=0,i=1/0,n=!1){const o=this.getAllBounds(t,i,n),a=new s.LineBasicMaterial({color:e});if(o.length>0){const e=[];for(const t of o){const i=new Box3Helper(t);e.push(i.geometry)}const t=(0,r.q)(e);return new s.LineSegments(t,a)}return new s.LineSegments(new s.BufferGeometry,a)}}class Raycaster{constructor(e,t){this.camera=e,this.defaultRaycastFilter=t,this.meshes={},this.octreeEnabledMeshes={},this.raycaster=new s.Raycaster,this.prevRay=new s.Ray,this._hitCache=[],this.getOctree=()=>this.octree,this.addTarget=(e,t)=>{const i=e,n=i.collider?i.collider:e;this.meshes[e.id]=n,this.octreeEnabledMeshes[e.id]=t,this.octree&&t&&this.octree.addMeshes(e)},this.removeTarget=e=>{this.octree&&this.octreeEnabledMeshes[e.id]&&this.octree.removeMeshes(e),delete this.meshes[e.id]}}init(){this.raycaster=new s.Raycaster,this.raycaster.params.Line&&(this.raycaster.params.Line.threshold=.1)}dispose(){this._hitCache.length=0,this.meshes={}}cast(e,t,i){if(e&&t&&(this.prevRay.copy(this.raycaster.ray),this.raycaster.set(e,t)),this.prevRay.equals(this.raycaster.ray))return this._hitCache;if(this.raycaster.layers.mask=this.camera.layers.mask,this._hitCache.length=0,this.octree){const e=this.getRaycastFilter(l.OctreeMeshes,i),t=this.octree.pick(this.raycaster,e);t&&this._hitCache.push(t)}const n=this.getRaycastFilter(l.DynamicMeshes,i);for(const e in this.meshes){const t=this.meshes[e];if(n(t)){const e=this.raycaster.intersectObject(t,!0);this._hitCache=this._hitCache.concat(e)}}return this._hitCache.sort(this.sortIntersectionsByDistance),this.prevRay.copy(this.raycaster.ray),this._hitCache}pick(e,t,i){this.raycaster.set(e,t);const n=this.getRaycastFilter(l.OctreeMeshes,i);return this.octree.pick(this.raycaster,n)}nearest(e,t){return this.octree.nearestMeshTo(e,this.getRaycastFilter(l.OctreeMeshes,t))}setupOctree(e){this.octree=new OctreeCollider(e.boundingBox,.5,200);for(const e of Object.keys(this.meshes))if(this.octreeEnabledMeshes[e]){const t=this.meshes[e];this.octree.addMeshes(t)}return this.octree}getRaycastFilter(e,t){const i=t||this.defaultRaycastFilter,n=t=>{const i=this.octreeEnabledMeshes[t.id];switch(e){case l.DynamicMeshes:return!i;case l.OctreeMeshes:return i}};return e=>n(e)&&i(e)}sortIntersectionsByDistance(e,t){return e.distance>t.distance?1:e.distance<t.distance?-1:0}render(){}activate(){}deactivate(){}}var l;!function(e){e[e.OctreeMeshes=0]="OctreeMeshes",e[e.DynamicMeshes=1]="DynamicMeshes"}(l||(l={}));var c=i(24135),h=i(70691),d=i(25799);const u=new d.Z("surface-edge-finder"),p=new s.Triangle,m=["a","b","c"];class Face extends s.Face3{constructor(e,t,i,n){super(e.a,e.b,e.c,e.normal),this.va=t,this.vb=i,this.vc=n,this.area=p.set(this.va.vector,this.vb.vector,this.vc.vector).getArea(),this.midpoint=p.getMidpoint(new s.Vector3),this.vertices=[this.va,this.vb,this.vc],t.faces.push(this),i.faces.push(this),n.faces.push(this)}}class Vertex{constructor(e){this.vector=e,this.faces=[]}}class Surface{constructor(){this.area=0,this.normal=new s.Vector3,this.midpoint=new s.Vector3,this.faces=[],this.normalSum=new s.Vector3,this.midpointSum=new s.Vector3}add(e){e.surface&&e.surface.remove(e),this.faces.push(e),this.area+=e.area,this.midpointSum.add(e.midpoint),this.normalSum.add(e.normal),this.recalcFromSums(),e.surface=this}remove(e){e.surface&&(this.faces.splice(this.faces.indexOf(e),1),this.area-=e.area,this.midpointSum.sub(e.midpoint),this.normalSum.sub(e.normal),this.recalcFromSums()),e.surface=null}recalcFromSums(){this.normal.copy(this.normalSum).normalize(),this.midpoint.copy(this.midpointSum).divideScalar(this.faces.length)}mergeSurfaces(e){for(const t of e.faces)t.surface=this,this.faces.push(t);this.area+=e.area,this.normalSum.add(e.normalSum),this.midpointSum.add(e.midpointSum),this.recalcFromSums(),e.faces=[],e.area=0,e.normal.set(0,0,0),e.normalSum.set(0,0,0),e.midpointSum.set(0,0,0),e.midpoint.set(0,0,0)}getEdges(){const e={},t={};for(const t of this.faces)for(let i=0;i<3;i++){const n=t[m[i]],s=t[m[(i+1)%3]],o=Math.min(n,s)+","+Math.max(n,s);if(void 0===e[o]){const t={edge1:n,edge2:s,isEdge:!0};e[o]=t}else e[o].isEdge=!1}for(const{edge1:i,edge2:n,isEdge:s}of Object.values(e))s&&(t[i]||(t[i]=[]),t[i].push(n),t[n]||(t[n]=[]),t[n].push(i));return t}getCircularPaths(e){const t=this.getEdges(),i=new Set,n=[],s=Object.keys(t).map((e=>parseInt(e,10)));let o;for(;o=s.pop();){const s=[];for(;o;){let n;s.push(e[o]);let r=0;for(const s of t[o]){const t=Math.min(o,s)+","+Math.max(o,s);if(i.has(t))continue;const a=e[o].vector.distanceToSquared(this.midpoint);(void 0===n||a>r)&&(n=s,r=a)}if(!n)break;{const e=Math.min(o,n)+","+Math.max(o,n);i.add(e),o=n}}s.length>2&&n.push(s)}return n}}class SurfaceEdgeFinder{constructor(e,t){this.roomId=e,this.floorId=t,this.surfaces=new Set,this.lines=[],this.points=[]}*run(e,t=[1,5,10],i=.2,n=.01,s=20){const r=e.vertices.map((e=>new Vertex(e))),a=[];for(const t of e.faces)a.push(new Face(t,r[t.a],r[t.b],r[t.c])),yield;for(let e=0,t=a.length;e<t;e++){const t=a[e];(new Surface).add(t)}for(const e of t)yield*this.mergeSurfacesByNormal(a,e);for(const e of a)this.surfaces.add(e.surface);let l=0;const c=[];for(const e of this.surfaces){if(e.area<=i)continue;const t=e.getCircularPaths(r);for(const e of t)this.cullPath(e,((e,t)=>{if(e.length()<n||t.length()<n)return l++,!1;const i=e.angleTo(t)*o.MN;return!(i<s||i>180-s)||(l++,!1)})),e.length>2&&c.push(e);yield}u.debug(`Culled ${l} path points`);const d=new Set,p=new Set,m=e=>`${e.x.toFixed(3)},${e.y.toFixed(3)},${e.z.toFixed(3)}`,g=e=>`${m(e.start)}:${m(e.end)}`,f=e=>`${m(e.end)}:${m(e.start)}`;for(const e of c)for(let t=0;t<e.length;t++){const i=e[t].vector,n=e[(t+1)%e.length].vector,s=new h.FM(i,n,this.floorId,this.roomId),o=g(s),r=f(s),a=m(i);p.has(o)||p.has(r)||(p.add(o),p.add(r),this.lines.push(s)),d.has(a)||(d.add(a),this.points.push(new h.UQ(i,this.floorId,this.roomId)))}yield}cullPath(e,t){const i=new s.Vector3,n=new s.Vector3;let o=!0;for(;o;){o=!1;for(let s=0;s<e.length&&e.length>2;s++){const r=e[0===s?e.length-1:s-1].vector,a=e[s].vector,l=e[(s+1)%e.length].vector;i.copy(r).sub(a),n.copy(l).sub(a),t(i,n)||(e.splice(s,1),o=!0,s--)}}}*mergeSurfacesByNormal(e,t,i=5){let n=-1,o=0;for(;0!==n&&o++<i;){u.debug(`Merging surfaces by normal angle threshold: ${t}`);const i=Math.cos(s.MathUtils.DEG2RAD*t);n=0;let o=0;for(const t of e){o++%1e3==0&&(yield);for(const e of t.vertices)for(const s of e.faces){const e=s.surface;t.surface!==e&&t.surface.normal.dot(e.normal)>=i&&(t.surface.faces.length>e.faces.length?t.surface.mergeSurfaces(e):e.mergeSurfaces(t.surface),n++)}}n&&u.debug(`Merged ${n} surfaces by normal...`)}}}var g=i(30853),f=i(50101),v=i(25396);const y=new d.Z("snapcaster");var b;!function(e){e[e.UNINITIALIZED=0]="UNINITIALIZED",e[e.WORKING=1]="WORKING",e[e.READY=2]="READY"}(b||(b={}));class Snapcaster{constructor(e){this.cameraData=e,this.edgeFinders=[],this.raycaster=new s.Raycaster,this.modelRaycaster=new s.Raycaster,this.status=b.UNINITIALIZED,this.cast=(e,t,i,n)=>{let o;i&&n&&(o=(new s.Plane).setFromNormalAndCoplanarPoint(n,i)),this.raycaster.set(e.origin,e.direction);const r=this.snappingOctree.raycast(this.raycaster,t)||[],a=e=>{let t=(1+e.distance)*(1+e.distanceToRay)**2;return(e.object instanceof h.UQ||e.object instanceof s.Vector3)&&(t/=10),o&&o.distanceToPoint(e.point)<-.2&&(t+=10),t};return r.sort(((e,t)=>a(e)-a(t))),r},this.pick=(e,t,i,n,s)=>{i||(i=this.cast(e,t,n,s));let o=null;for(const t of i){this.modelRaycaster.ray.origin.copy(e.origin),this.modelRaycaster.ray.direction.copy(t.point).sub(e.origin).normalize(),this.modelRaycaster.far=t.distance-.05;if(!this.modelOctree.pick(this.modelRaycaster,(e=>e.visible))){o=t;break}}return o?{isLineOctreeIntersection:!0,distance:o.distance,distanceToRay:o.distanceToRay,point:o.point,object:o.object}:null},this.add=(...e)=>{for(const t of e)this.snappingOctree.add(t)},this.remove=(...e)=>{for(const t of e)this.snappingOctree.remove(t)}}render(){}init(){}dispose(){}deactivate(e){}async activate(e){this.engine=e;const t=await e.getModule(g.default),i=(await e.getModule(f.default)).getScene().scene;let n,o;t.registerButton("Snapping","Visualize Snapping",(()=>{if(n)return i.remove(n),void(n=null);n=new s.Object3D,i.add(n);const e=new s.SphereGeometry(.02,5,5),t=new s.MeshBasicMaterial({color:65280});this.snappingOctree.traverse((i=>{if(i instanceof h.FM){const e=(new s.Geometry).setFromPoints([i.start,i.end]),t=.2+.8*Math.random(),o=.2+.8*Math.random(),r=.2+.8*Math.random(),a=new s.Line(e,new s.LineBasicMaterial({color:16711680*t+65280*o+255*r}));n.add(a)}else if(i instanceof h.UQ){const o=new s.Mesh(e,t);o.position.copy(i),n.add(o)}}))})),t.registerButton("Snapping","Visualize Snap Surfaces",(()=>{if(o)return i.remove(o),void(o=null);const e=new s.BufferGeometry,t=[],n=[];for(const e of this.edgeFinders)for(const i of e.surfaces){const e=i.area>.1,s=Math.random(),o=e?0:.2+.8*s,r=e?.2+.8*s:0,a=0;for(const e of i.faces){const i=e.va.vector,s=e.vb.vector,l=e.vc.vector;t.push(i.x,i.y,i.z),t.push(s.x,s.y,s.z),t.push(l.x,l.y,l.z),n.push(o,r,a,o,r,a,o,r,a)}}e.setAttribute("position",new s.Float32BufferAttribute(t,3)),e.setAttribute("color",new s.Float32BufferAttribute(n,3)),o=new s.Mesh(e,new s.MeshBasicMaterial({vertexColors:!0})),i.add(o)}))}get snappingOctree(){return this.status===b.UNINITIALIZED&&this.preloadMeshSnapping(),this._snappingOctree}setupOctree(e,t){this.modelOctree=t,this.modelMesh=e,this.modelRaycaster.layers.mask=e.layers.mask,this._snappingOctree=new h.ZP(this.modelMesh.boundingBox)}async preloadMeshSnapping(){this.status===b.UNINITIALIZED&&(this.status=b.WORKING,this.populateProcess=await this.engine.commandBinder.issueCommand(new v.S("snapping",this.buildSnappingForModel(),6e4)),await this.populateProcess.promise,this.status=b.READY,this.populateProcess=null)}*buildSnappingForModel(){const e=[];for(const t of this.modelMesh.floorMeshes)for(const i of t.roomMeshes)e.push({room:i,distanceToCamera:1/0});const t=new s.Vector3,i=()=>{e.forEach((e=>e.distanceToCamera=e.room.boundingBox.getCenter(t).distanceTo(this.cameraData.pose.position))),e.sort(((e,t)=>t.distanceToCamera-e.distanceToCamera))};for(;e.length;){i();const t=e.pop().room,n=(new s.Geometry).fromBufferGeometry(t.geometry);yield*this.buildSnappingForGeometry(n,t.roomId,t.floorId),yield}y.info(`Snapping found ${this._snappingOctree.pointCount} points and ${this._snappingOctree.lineCount} lines`)}*buildSnappingForGeometry(e,t,i){e.computeFaceNormals(),yield;const n=new SurfaceEdgeFinder(t,i);yield*n.run(e),y.debug(`Room done, added ${n.points.length} points and ${n.lines.length} lines`);for(const e of n.points)this._snappingOctree.add(e);for(const e of n.lines)this._snappingOctree.add(e);this.edgeFinders.push(n)}}var w=i(75195);class RaycastPointerScreen{constructor(e,t){this.raycaster=e,this.cameraData=t,this.lastHits=[],this.lastRay=new s.Ray(new s.Vector3(1,1,1),new s.Vector3(0,1,0)),this.currentRay=new s.Ray,this.pointer=new s.Vector2(-2,-2),this.origin=new s.Vector3,this.direction=new s.Vector3,this.cast=()=>{const e=this.pointerRay;return this.lastRay.equals(e)||(this.lastHits=this.raycaster.cast(e.origin,e.direction).slice(),this.lastRay.copy(e)),this.lastHits},this.updatePointer=e=>{this.pointer.distanceToSquared(e)>2e-5&&this.pointer.set(e.x,e.y)}}get pointerRay(){const{origin:e,direction:t}=this.updateDirections();return this.currentRay.set(e,t)}get ndcPosition(){return this.pointer}updateDirections(){return(0,w.Kh)(this.cameraData.pose,this.origin.set(this.pointer.x,this.pointer.y,-1),this.origin),(0,w.Kh)(this.cameraData.pose,this.direction.set(this.pointer.x,this.pointer.y,1),this.direction),this.direction.sub(this.origin).normalize(),{origin:this.origin,direction:this.direction}}}class RaycastPointerDataUpdate{constructor(e,t,i){this.raycaster=e,this.data=t,this.cameraData=i,this.cache={normal4:new s.Vector4,normal:new s.Vector3,rotationMatrix:new s.Matrix4,ndc3:new s.Vector3}}beforeRender(){if(this.raycaster.pointer.pointerRay.equals(this.data.pointerRay))return;this.data.pointerRay.copy(this.raycaster.pointer.pointerRay),this.data.pointerOrigin.copy(this.data.pointerRay.origin),this.data.pointerDirection.copy(this.data.pointerRay.direction);const e=this.raycaster.pointer.cast();if(this.data.hits.length=0,this.data.hits.push(...e),this.data.pointerNdcPosition.copy(this.raycaster.pointer.ndcPosition),this.cache.ndc3.set(this.data.pointerNdcPosition.x,this.data.pointerNdcPosition.y,.5),this.data.pointerScreenPosition.copy((0,w.fi)(this.cameraData.width,this.cameraData.height,this.cache.ndc3)),e.length>0){const t=e[0];if(t&&t.face){const e=t.face.normal;this.cache.normal4.set(e.x,e.y,e.z,0),this.cache.rotationMatrix.extractRotation(t.object.matrixWorld),this.cache.normal4.applyMatrix4(this.cache.rotationMatrix),this.cache.normal.set(this.cache.normal4.x,this.cache.normal4.y,this.cache.normal4.z),this.data.hit=new c.E(t.point.clone(),this.cache.normal.clone(),t.object,t)}}else this.data.hit=null;this.data.commit()}init(){}render(){}dispose(){}activate(){}deactivate(){}}var S=i(89155),E=i(69281);const T=new d.Z("raycaster-debug");class OctreeDebugMenu{constructor(e,t,i){Promise.all([e.getModule(g.default)]).then((([e])=>{const n=[];let s=!1;const o=()=>{n&&n.forEach((e=>{e.geometry.dispose(),e.material.dispose(),i.remove(e)}))},r=(e,s,o)=>{T.info("draw",{from:e,to:s,faces:o});const r=t.getOctree().getDebugBoundsMesh((0,E.rn)().getHex(),e,s,o);r.frustumCulled=!1,r.updateMatrixWorld(!0),i.add(r),n.push(r)};e.registerMenuButton({header:"Raycaster",buttonName:"Add Octree Level Buttons",callback:()=>{if(!s){for(let i=0;i<=t.getOctree().depth;i++)e.registerMenuButton({header:"Octree Levels",buttonName:`Anything on Level: ${i}`,callback:()=>{o(),r(i,i,!1)}});for(let i=0;i<=t.getOctree().depth;i++)e.registerMenuButton({header:"Octree Faces",buttonName:`Faces on Level: ${i}`,callback:()=>{o(),r(i,i,!0)}});s=!0}}}),e.registerMenuButton({header:"Raycaster",buttonName:"Visualize Octree - All",callback:()=>{o();for(let e=0;e<=t.getOctree().depth;e++)r(e,e,!1)}}),e.registerMenuButton({header:"Raycaster",buttonName:"Visualize Octree - Faces",callback:()=>{o();for(let e=0;e<=t.getOctree().depth;e++)r(e,e,!0)}}),e.registerMenuButton({header:"Raycaster",buttonName:"Clear Octree Visuals",callback:o})}))}}var M,_=i(31017),x=i(12505),A=i(27829);!function(e){e.normal="normal",e.hitClass="hitClass",e.hitBounds="hitBounds"}(M||(M={}));const O={color:"yellow"};class RaycasterDataDebugMenu{constructor(e,t){this.engine=e,this.cached={v1:new s.Vector3,v2:new s.Vector3,quat:new s.Quaternion},this.showClass=!0,this.showName=!0,this.showNormal=!0,this.showBounds=!1,this.drawRaycastHitNormal=e=>{const t=this.draw.line(M.normal,"red",4);e&&t.updatePositions(e.point,this.cached.v1.copy(e.point).addScaledVector(e.normal,.2)),t.toggle(null!==e)},this.drawRaycastObjectInfo=(e,t,i,n)=>{const s=this.draw.label(M.hitClass,"X",this.cached.v1,1);if(s.visible=!1,e&&t&&(i||n)){const{position:r,rotation:a}=t.pose,{point:l,object:c}=e,h=i?c.__proto__.constructor.name:"",d=n?""!==c.name?c.name:c.id:"";s.text=`${h} - ${d}`,s.setPosition(l,(e=>t.isOrtho()?e.addScaledVector(A.f.UP,10):(0,o.Xe)(r,e,.5,e))),s.scaleBillboard(r,a,t.pose.projection,t.zoom(),t.height,t.aspect(),.05),s.setOrientation(a),s.visible=!0}},this.drawRaycastHitBounds=e=>{const t=this.draw.boxWire(M.hitBounds,O).toggle(!1);if(e&&e.object&&!(e.object instanceof x.i)&&e.object instanceof s.Mesh){const i=(0,r.A)(e.object.geometry),n=i.getCenter(this.cached.v1).applyMatrix4(e.object.matrixWorld),s=i.getSize(this.cached.v2).multiply(e.object.scale).multiplyScalar(.5);t.mesh.quaternion.copy(e.object.quaternion),t.toggle(!0).update(n,s)}},e.getModule(g.default).then((e=>{let i=!1;const n=t.onChanged((()=>this.update(t)));n.cancel();const s=()=>{i?(n.cancel(),this.draw.toggleAll(!1)):n.renew(),i=!i};e.registerMenuButton({header:"Raycaster",buttonName:"HIT: Visualize",callback:()=>s()}),e.registerMenuButton({header:"Raycaster",buttonName:"HIT: Class",callback:()=>this.showClass=!this.showClass}),e.registerMenuButton({header:"Raycaster",buttonName:"HIT: Name",callback:()=>this.showName=!this.showName}),e.registerMenuButton({header:"Raycaster",buttonName:"HIT: Normal",callback:()=>this.showNormal=!this.showNormal}),e.registerMenuButton({header:"Raycaster",buttonName:"HIT: Bounds",callback:()=>this.showBounds=!this.showBounds})}))}get draw(){return this._draw||(this._draw=new _.M,this._draw.addToScene(this.engine)),this._draw}update(e){const t=this.engine.market.tryGetData(S.M_);this.showNormal&&this.drawRaycastHitNormal(e.hit),this.showBounds&&this.drawRaycastHitBounds(e.hit),this.drawRaycastObjectInfo(e.hit,t,this.showClass,this.showName)}}var P=i(24975);class RaycasterModule extends n.Y{constructor(){super(...arguments),this.name="raycaster",this.raycasterPointerData=new c.P,this.overridePointer=null,this.setOverridePointer=e=>{this.overridePointer=e}}async init(e,t){t.market.register(this,c.P,this.raycasterPointerData);const[i,n]=await Promise.all([t.getModule(f.default),t.market.waitForData(S.M_)]),s=i.getCamera();this.raycaster=new Raycaster(s,P.Nr),t.addComponent(this,this.raycaster),this.defaultPointer=new RaycastPointerScreen(this.raycaster,n),this.snapcaster=new Snapcaster(n),t.addComponent(this,this.snapcaster);const o=new RaycastPointerDataUpdate(this,this.raycasterPointerData,n);t.addComponent(this,o),new OctreeDebugMenu(t,this.raycaster,i.getScene()),new RaycasterDataDebugMenu(t,this.raycasterPointerData)}dispose(){}setupOctree(e){const t=this.raycaster.setupOctree(e);this.snapcaster.setupOctree(e,t)}get pointer(){return null!==this.overridePointer?this.overridePointer:this.defaultPointer}get targets(){return this.raycaster}get picking(){return this.raycaster}get snapping(){return this.snapcaster}}},16696:(e,t,i)=>{"use strict";i.d(t,{oM:()=>RequestRenderTargetCommand,sH:()=>Context2dCaptureCommand,vU:()=>ScreenCaptureCommand,sp:()=>RenderToCubemapCommand,fZ:()=>EquirectangularCommand,ep:()=>ComposeTargetsCommand});var n=i(99681);class RequestRenderTargetCommand extends n.m{constructor(){super(...arguments),this.id="RequestRenderTargetCommand"}}class Context2dCaptureCommand extends n.m{constructor(e,t){super(),this.payload={renderTarget:e,context:t}}}class ScreenCaptureCommand extends n.m{constructor(e,t,i){super(),this.payload={renderTarget:e,sceneObject:t,camera:i}}}class RenderToCubemapCommand extends n.m{constructor(e,t,i){super(),this.payload={renderTarget:e,sceneObject:t,camera:i}}}class EquirectangularCommand extends n.m{constructor(e,t,i=0){super(),this.payload={renderTarget:e,texture:t,heading:i}}}class ComposeTargetsCommand extends n.m{constructor(e,t){super(),this.payload={target1:e,target2:t}}}},73354:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>RenderToTexture});var n=i(54122),s=i(50101),o=i(2779),r=i(2212),a=i(13441),l=i(81047),c=i(48101);const h={circle_projection:new r.RawShaderMaterial({uniforms:{textureSampleScale:{value:5},panoTexture:{value:null},borderSize:{value:0},borderColor:{value:new r.Vector4(1,1,1,1)}},depthWrite:!1,depthTest:!0,side:r.DoubleSide,vertexShader:(0,c.m)(l,i(69242)),fragmentShader:(0,c.m)(a,i(89641))}),equirectangular:new r.RawShaderMaterial({uniforms:{cubemap:{value:null},yaw:{value:0}},depthWrite:!1,depthTest:!1,vertexShader:(0,c.m)(l,i(58295)),fragmentShader:(0,c.m)(a,i(16723))}),compose:new r.RawShaderMaterial({uniforms:{mask:{value:null},bg:{value:null}},transparent:!0,vertexShader:(0,c.m)(l,i(20672)),fragmentShader:(0,c.m)(a,i(4035))}),copyOpaque:new r.RawShaderMaterial({uniforms:{texture:{value:null}},vertexShader:(0,c.m)(l,i(49749)),fragmentShader:(0,c.m)(a,i(38251))})};var d=i(83974),u=i(16696);class RenderTarget{constructor(e,t){this._renderer=e,this._renderTarget=t}get target(){return this._renderTarget}get width(){return this._renderTarget.width}get height(){return this._renderTarget.height}get bpp(){return 4}readRenderTargetData(e){const t=this._renderTarget.width,i=this._renderTarget.height;return e=e||new Uint8Array(t*i*4),this._renderer.readRenderTargetPixels(this._renderTarget,0,0,t,i,e),e}setSize(e,t){this._renderTarget.setSize(e,t)}dispose(){this._renderTarget.dispose()}}const p=new(i(25799).Z)("rtt");class RenderToTexture extends n.Y{constructor(){super(...arguments),this.name="render-to-texture",this.circleProjectionPlane=new d.E(new r.PlaneBufferGeometry(1,1),h.circle_projection),this.equirectProjectionPlane=new d.E(new r.PlaneBufferGeometry(1,1),h.equirectangular),this.composePlane=new d.E(new r.PlaneBufferGeometry(1,1),h.compose),this.copyPlane=new d.E(new r.PlaneBufferGeometry(1,1),h.copyOpaque),this.cachedSize=new r.Vector2,this.cachedViewport=new r.Vector4,this.cachedViewport2=new r.Vector4,this.solidWhiteTexture=new r.DataTexture(new Uint8Array([255,255,255,255]),1,1),this.debugRenderOffset=0}async init(e,t){const i=await t.getModule(s.default);this.cwfRenderer=i.cwfRenderer,this.renderer=i.cwfRenderer.renderer,this.camera=new r.Camera,this.orthoCamera=new r.OrthographicCamera(-.5,.5,.5,-.5,0,1),this.camera.layers.mask=o.o.ALL.mask,this.scene=new r.Scene,this.scene.name="rtt",this.scene.autoUpdate=!1,this.bindings.push(t.commandBinder.addBinding(u.oM,(async e=>new RenderTarget(this.renderer,this.createRenderTarget2D(0))))),this.bindings.push(t.commandBinder.addBinding(u.sH,(async e=>{this.renderContext(e.renderTarget.target,e.context)}))),this.bindings.push(t.commandBinder.addBinding(u.vU,(async e=>{this.render(e.renderTarget.target,e.sceneObject,e.camera)}))),this.bindings.push(t.commandBinder.addBinding(u.fZ,(async e=>{this.renderEquirectangular(e.texture,e.renderTarget.target,e.heading)}))),this.bindings.push(t.commandBinder.addBinding(u.sp,(async e=>{this.render(e.renderTarget,e.sceneObject,e.camera)}))),this.bindings.push(t.commandBinder.addBinding(u.ep,(async e=>{this.compose(e.target1.target,e.target2.target,e.target2.target)})))}getRenderSize(){const e=this.renderer.getPixelRatio(),t=this.renderer.getSize(this.cachedSize);return t.width*=e,t.height*=e,t}onUpdate(){this.debugRenderOffset=0}createRenderTarget2D(e,t=e,i,n=!0){const s=new r.WebGLRenderTarget(e,t,i);return s.texture.generateMipmaps=n,s}clearRenderTarget2D(e){this.renderer.setRenderTarget(e),this.renderer.clear(),this.renderer.setRenderTarget(null)}disposeRenderTarget2D(e){e.texture.dispose(),e.depthTexture&&e.depthTexture.dispose(),e.dispose()}getRenderTargetData(e,t){const i=e.width,n=e.height;return t=t||new Uint8Array(i*n*4),this.renderer.readRenderTargetPixels(e,0,0,i,n,t),t}compose(e,t,i=this.solidWhiteTexture){this.composePlane.material.uniforms.bg.value=this.isRenderTarget(t)?t.texture:t,this.composePlane.material.uniforms.mask.value=this.isRenderTarget(i)?i.texture:i,this.scene.add(this.composePlane),this.overrideRenderTarget(e,(()=>{this.renderer.render(this.scene,this.orthoCamera)})),this.scene.remove(this.composePlane)}copyTextureOpaque(e,t){this.copyPlane.material.uniforms.texture.value=t&&this.isRenderTarget(t)?t.texture:t,this.scene.add(this.copyPlane),this.overrideRenderTarget(e,(()=>{this.renderer.render(this.scene,this.orthoCamera)})),this.scene.remove(this.copyPlane)}copyTexture(e,t){return t.format===r.RGBFormat?this.copyTextureOpaque(e,t):this.compose(e,t)}resizeTexture(e,t){const i=new r.WebGLRenderTarget(t,t);return i.texture.format=e.format,i.texture.addEventListener("dispose",i.dispose.bind(i)),this.copyTexture(i,e),i.texture}renderToScreen(e,t,i){const n=this.isRenderTarget(e)?e.width:e.image.width,s=this.isRenderTarget(e)?e.height:e.image.height,o=t?t.x:this.debugRenderOffset,r=t?t.y:this.cachedSize.height-s-48;this.renderer.getViewport(this.cachedViewport),this.renderer.setViewport(o,r,n,s),this.compose(null,e,i),this.renderer.setViewport(this.cachedViewport),t||(this.debugRenderOffset+=n+4)}isRenderTarget(e){return e.hasOwnProperty("texture")}renderContext(e,t){e.texture.image=t.canvas,e.texture.needsUpdate=!0}render(e,t,i,n){const s=t.parent;if(s&&this.scene.applyMatrix4(s.matrixWorld),this.scene.add(t),e.isWebGLCubeRenderTarget){const t=new r.CubeCamera(.01,1e3,e);i.getWorldPosition(t.position),i.getWorldQuaternion(t.quaternion),this.scene.add(t),this.scene.updateMatrixWorld(),t.layers.mask=n?n.mask:i.layers.mask,t.update(this.renderer,this.scene),this.scene.remove(t)}else{i.getWorldPosition(this.camera.position),i.getWorldQuaternion(this.camera.quaternion),this.camera.projectionMatrix.copy(i.projectionMatrix),this.camera.layers.mask=n?n.mask:i.layers.mask;const t=this.renderer.getSize(this.cachedSize),s=t.width/t.height,o=e.width/e.height,r=this.camera.projectionMatrix;s>o?r.elements[0]=r.elements[5]/o:r.elements[5]=r.elements[0]*o,this.overrideRenderTarget(e,(()=>{this.renderer.clear(),this.renderer.render(this.scene,this.camera)}))}return s&&(s.add(t),this.scene.matrixWorld.identity()),this.scene.remove(t),e}setScissors(e,t){if(e){if(!t)throw Error("Rect to restrict rendering to required when enabling scissors.");this.renderer.setScissorTest(!0),this.renderer.setScissor(t.x,t.y,t.width,t.height)}else{const e=this.renderer.getSize(this.cachedSize);this.renderer.setScissor(0,0,e.width,e.height),this.renderer.setScissorTest(!1)}}renderSphericalProjection(e,t,i,n,s){const o=h.circle_projection;o.uniforms.borderColor.value.copy(s||new r.Vector4(1,1,1,1)),o.uniforms.borderSize.value=n||0,o.uniforms.textureSampleScale.value=i||5,o.uniforms.panoTexture.value=e,this.scene.add(this.circleProjectionPlane),this.circleProjectionPlane.position.z=0,this.overrideRenderTarget(t,(()=>{this.renderer.render(this.scene,this.orthoCamera)})),this.scene.remove(this.circleProjectionPlane)}renderEquirectangular(e,t,i=0){const n=this.equirectProjectionPlane.material;n.uniforms.cubemap.value=e,n.uniforms.yaw.value=i,this.scene.add(this.equirectProjectionPlane),this.equirectProjectionPlane.position.z=0,this.overrideRenderTarget(t,(()=>{this.renderer.render(this.scene,this.orthoCamera)})),this.scene.remove(this.equirectProjectionPlane),n.uniforms.cubemap.value=null,n.uniforms.yaw.value=0}overrideRenderTarget(e,t){const i=this.renderTargetSwap(e);t(),this.renderTargetRestore(i)}renderTargetSwap(e){const t=this.renderer.xr.enabled,i=this.renderer.getRenderTarget(),n=this.renderer.getViewport(this.cachedViewport2);return this.renderer.xr.enabled=!1,this.renderer.setRenderTarget(e),{xr:t,rtt:i,viewport:n}}renderTargetRestore(e){this.renderer.xr.enabled=e.xr,this.renderer.setRenderTarget(e.rtt),this.renderer.setViewport(e.viewport)}renderAndReadAsync(e,t,i){const n=i.buffer;if(!this.renderer.capabilities.isWebGL2)return p.debug("renderAsync call webgl2, falling back to sync render/read"),this.render(e.target,e.mesh,e.camera),Promise.resolve(this.getRenderTargetData(e.target,n));const s=this.renderTargetSwap(e.target),o=this.renderer.getContext(),r=i.webglBuffer||o.createBuffer();if(!r)throw Error("Unable to create pack buffer");return o.bindBuffer(o.PIXEL_PACK_BUFFER,r),o.bufferData(o.PIXEL_PACK_BUFFER,n.byteLength,o.DYNAMIC_READ),e.clear&&this.renderer.clear(),this.renderer.render(e.mesh,e.camera),o.readPixels(t.x,t.y,t.width,t.height,o.RGBA,o.UNSIGNED_BYTE,0),o.bindBuffer(o.PIXEL_PACK_BUFFER,null),this.renderTargetRestore(s),this.cwfRenderer.fence(o).then((()=>(o.bindBuffer(o.PIXEL_PACK_BUFFER,r),o.getBufferSubData(o.PIXEL_PACK_BUFFER,0,n),o.bindBuffer(o.PIXEL_PACK_BUFFER,null),i.webglBuffer||o.deleteBuffer(r),n)))}}},6518:(e,t,i)=>{"use strict";i.d(t,{vP:()=>o,Xk:()=>r,jJ:()=>a,fY:()=>l});var n=i(62367);let s=null;const o=async(e,t)=>{const n=new Uint8Array(e.width*e.height*4);if(e.readRenderTargetData(n),!s){const e=await Promise.all([i.e(764),i.e(718)]).then(i.bind(i,19784));s=e.createJpegEncodeWorker()}const o=n.buffer,r=await s.exec({data:o,width:e.width,height:e.height,options:{exif:t,quality:85,flipY:!0}},[o]);return new Uint8Array(r.data)},r=e=>new Blob([e],{type:"image/jpeg"}),a=e=>"data:image/jpg;base64,"+(0,n.$B)(e),l=(e,t,i,n)=>'http://ns.adobe.com/xap/1.0/\0<?xpacket begin="ï»¿" id="W5M0MpCehiHzreSzNTczkc9d"?><x:xmpmeta xmlns:x="adobe:ns:meta/"><rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:GPano="http://ns.google.com/photos/1.0/panorama/"><GPano:CroppedAreaImageHeightPixels>'+t+"</GPano:CroppedAreaImageHeightPixels><GPano:CroppedAreaImageWidthPixels>"+e+"</GPano:CroppedAreaImageWidthPixels><GPano:CroppedAreaLeftPixels>0</GPano:CroppedAreaLeftPixels><GPano:CroppedAreaTopPixels>0</GPano:CroppedAreaTopPixels><GPano:FullPanoHeightPixels>"+t+"</GPano:FullPanoHeightPixels><GPano:FullPanoWidthPixels>"+e+"</GPano:FullPanoWidthPixels><GPano:ProjectionType>equirectangular</GPano:ProjectionType><GPano:UsePanoramaViewer>True</GPano:UsePanoramaViewer><GPano:InitialViewHeadingDegrees>"+i+"</GPano:InitialViewHeadingDegrees><GPano:InitialViewPitchDegrees>"+n+'</GPano:InitialViewPitchDegrees><GPano:CaptureSoftware>Matterport Camera</GPano:CaptureSoftware><GPano:StitchingSoftware>Matterport Cloud</GPano:StitchingSoftware></rdf:Description></rdf:RDF></x:xmpmeta><?xpacket end="w"?>'},86293:(e,t,i)=>{"use strict";i.d(t,{d:()=>Room});class Room{constructor(e){this.tags=[],e&&Object.assign(this,e)}}},18687:(e,t,i)=>{"use strict";i.d(t,{Z:()=>RoomData});var n=i(2212),s=i(40032),o=i(19413),r=i(25799),a=i(5442),l=i(86293);const c=new r.Z("room-data");class RoomData extends o.V{constructor(e){if(super(),this.name="rooms",this.selected=new a.f(null),this._rooms={},this.floorToRoomsMap=new Map,this._bbox=new n.Box3,this.rooms=()=>{const e=this._rooms,t=Object.keys(this._rooms);return function*(){for(const i of t)yield e[i]}()},this.get=e=>this._rooms[e],this.getBySubgroup=e=>Object.values(this._rooms).find((t=>t.meshSubgroup===e)),this.roomIdsFromPoint=e=>{const t=[];for(const i of this.rooms())this._bbox.min.set(i.min.x,i.min.y,i.min.z),this._bbox.max.set(i.max.x,i.max.y,i.max.z),this._bbox.containsPoint(e)&&t.push(i.id);return t},e)for(const t of Object.values(e))this.add(t)}mapMeshesToRooms(e){for(const t of e){let e=this.getBySubgroup(t.meshSubgroup);e||(c.debug(`Created non-existant Room for mesh subgroup ${t.meshSubgroup}`),e=new l.d({id:t.roomId,meshSubgroup:t.meshSubgroup,floorId:t.floorId}),this.add(e));const i=t.boundingBox;e.min=(0,s.m)(i.min),e.max=(0,s.m)(i.max),e.size=(0,s.m)(i.getSize(new n.Vector3)),e.mesh=t,t.roomId=e.id}for(const e in this._rooms)this._rooms[e].mesh||(c.debug(`Removing non-existant Room with mesh subgroup ${this._rooms[e].meshSubgroup}`),this.remove(e))}add(e){this._rooms[e.id]=e;const t=this.floorToRoomsMap.get(e.floorId);t?t.push(e):this.floorToRoomsMap.set(e.floorId,[e])}remove(e){const t=this.get(e);if(!t)return;const i=this.floorToRoomsMap.get(t.floorId);if(i){const e=i.indexOf(t);e>-1&&i.splice(e,1)}delete this._rooms[e]}copy(e){this._rooms={},this.floorToRoomsMap.clear();for(const t of e.rooms()){const e=new l.d({id:t.id,floorId:t.floorId,min:t.min,max:t.max,size:t.size,mesh:t.mesh,meshSubgroup:t.meshSubgroup,height:t.height,width:t.width,depth:t.depth,areaFloor:t.areaFloor,tags:[...t.tags]});this.add(e)}return this}get roomCount(){return Object.keys(this._rooms).length}get floorCount(){return this.floorToRoomsMap.size}get collection(){return this._rooms}getByMeshSubgroup(e){return Object.values(this._rooms).find((t=>t.meshSubgroup===e))}roomsByFloor(e){return this.floorToRoomsMap.get(e)||[]}}},70389:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>RoomDataModule});var n=i(54122),s=i(85197),o=i(18687),r=i(77956),a=i(12775),l=i(32359),c=i(52050),h=i(32400),d=i(25799),u=i(86293);const p=new d.Z("mds-floor-deserializer");class MdsRoomDeserializer{deserialize(e){if(!e||!this.validate(e))return p.debug("Deserialized invalid room data from MDS",e),null;const t=e.dimensions||{},{height:i,width:n,depth:s,areaFloor:o}=t;return new u.d({id:e.id,meshSubgroup:e.meshId,floorId:e.floor.id,height:i,width:n,depth:s,areaFloor:o,tags:e.tags})}validate(e){const t=["id","meshId"].every((t=>t in e)),i=e.floor&&e.floor.id&&"number"==typeof e.floor.meshId;return t&&!!i}}class MdsRoomStore extends h.u{constructor(){super(...arguments),this.prefetchKey="data.model.rooms"}async read(e){const t=new MdsRoomDeserializer,i={modelId:this.getViewId()};return this.query(c.GetRooms,i,e).then((e=>{var i,n;const s=null===(n=null===(i=null==e?void 0:e.data)||void 0===i?void 0:i.model)||void 0===n?void 0:n.rooms;if(!s||!Array.isArray(s))return null;return s.reduce(((e,i)=>{const n=t.deserialize(i);return n&&(e[n.id]=n),e}),{})}))}}var m=i(25936),g=i(17256);const f=(...e)=>function(t){return e.every((e=>e(t)))};var v=i(67399),y=i(2212),b=i(62513);const w=new d.Z("room-data-module");class RoomDataModule extends n.Y{constructor(){super(...arguments),this.name="room-data",this.visitedRooms={}}async init(e,t){const[i,n,c,h]=await Promise.all([t.getModule(s.default),t.market.waitForData(a.O),t.market.waitForData(m.i),t.getModule(b.default)]);this.raycaster=h,this.floorData=c,this.configureStorage(e);const d=this.store?await this.store.read():{};this.data=new o.Z(d||{}),this.data.mapMeshesToRooms(i.mesh.roomMeshes),t.market.register(this,o.Z,this.data);const u=this.data.roomCount,p=e=>{const i=n.closestMode;this.visitedRooms[e.id]||(this.visitedRooms[e.id]={visitCount:0}),this.visitedRooms[e.id].visitCount++;const s=this.visitedRooms[e.id].visitCount;t.broadcast(new l.D(e.id,e.meshSubgroup,i,s,u,""))},g=await t.market.waitForData(r.Z),f=g.makeSweepChangeSubscription((e=>{if(e){const t=g.getSweep(e);this.data.selected.value=t.roomId,this.data.commit()}})),v=this.data.selected.onChanged((e=>{if(null!==e){const t=this.data.get(e);t&&p(t)}}));this.bindings.push(f,v)}configureStorage(e){const{storageProvider:t,baseUrl:i}=e;this.store||t!==g.Xq.MDS||(this.store=new MdsRoomStore({baseUrl:i,readonly:!0}))}inferMeshIdsFromPoint(e,t){const i=!e.roomId||!this.data.get(e.roomId),n=!e.floorId||!this.floorData.hasFloor(e.floorId);if(i||n){const s=n?v.$4.isRoomMesh:f(v.$4.isRoomMesh,v.$4.matchesFloorId(e.floorId)),o=this.raycaster.picking.nearest((new y.Vector3).set(t.x,t.y,t.z),s);o&&v.$4.isRoomMesh(o.object)?(w.debug("data-fixup:",i?{roomId:o.object.roomId,prev:e.roomId}:"",n?{floorId:o.object.floorId,prev:e.floorId}:"",{data:e}),i&&(e.roomId=o.object.roomId),n&&(e.floorId=o.object.floorId)):w.warn("Nearest Room/Floor not found for:",{point:t,data:e,invalidRoomId:i,invalidFloorId:n})}return e}}},32359:(e,t,i)=>{"use strict";i.d(t,{D:()=>RoomVisitedMessage});var n=i(93528);class RoomVisitedMessage extends n.v{constructor(e,t,i,n,s,o){super(),this.roomId=e,this.meshSubgroup=t,this.viewmode=i,this.visitCount=n,this.roomCount=s,this.roomType=o}}},81303:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});const n="cwf/src/modules/scaninfo-data"},38124:(e,t,i)=>{"use strict";i.d(t,{j6:()=>SceneModule,LG:()=>s,DO:()=>o});var n=i(54122);class SceneModule extends n.Y{constructor(){super(...arguments),this.name="scene-placeholder"}}function s(){return{type:SceneModule,promise:()=>Promise.resolve({default:SceneModule})}}const o=async(e,t)=>Promise.resolve()},25396:(e,t,i)=>{"use strict";i.d(t,{S:()=>ScheduleProcessCommand});var n=i(99681);class ScheduleProcessCommand extends n.m{constructor(e,t,i,n=1){super(),this.id="SCHEDULE_PROCESS_COMMAND",this.payload={type:e,func:t,maxDelay:i,steps:n}}}},26199:(e,t,i)=>{"use strict";i.d(t,{_:()=>ScheduleTaskCommand});var n=i(99681);class ScheduleTaskCommand extends n.m{constructor(e,t,i){super(),this.id="SCHEDULE_TASK_COMMAND";const n=function*(){return t()}();this.payload={type:e,func:n,maxDelay:i,steps:1}}}},68345:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>SchedulerModule});var n,s=i(54122),o=i(2124);class TaskType{constructor(e){this.name=e,this.taskDurations=new o.P(100)}get typicalStepDuration(){return 1}addTaskDuration(e){this.taskDurations.push(e)}}!function(e){e.WAITING="waiting",e.STARTED="started",e.DONE="done"}(n||(n={}));class Scheduler{constructor(){this.tasks=[],this.types={}}getType(e){return this.types[e]||(this.types[e]=new TaskType(e)),this.types[e]}addTask(e){this.tasks.push(e)}update(e){this.tasks=this.tasks.filter((e=>e.status!==n.DONE)),this.tasks.sort(((e,t)=>t.urgency-e.urgency));let t=0;e:for(const i of this.tasks)for(;i.status!==n.DONE;){const n=performance.now(),s=t+i.type.typicalStepDuration>e,o=n>=i.deadline;if(s&&!o)break e;const r=n;i.run();const a=performance.now()-r;i.type.addTaskDuration(a),t+=a}}}var r=i(26199),a=i(25396);class Task{constructor(e,t,i,s){this.type=e,this.func=t,this.deadline=i,this.steps=s,this.status=n.WAITING,this.promise=new Promise(((e,t)=>{this.onSuccess=e,this.onError=t}))}run(){let e;this.status=n.STARTED;try{e=this.func.next()}catch(e){return this.status=n.DONE,void this.onError(e)}this.steps-=1,e.done&&(this.status=n.DONE,this.onSuccess(e.value))}get estimatedDuration(){return this.steps*this.type.typicalStepDuration}get urgency(){const e=this.deadline-performance.now();return e<=0?1e6-e:this.estimatedDuration/e/e}}class SchedulerModule extends s.Y{constructor(){super(...arguments),this.name="scheduler-module",this.scheduler=new Scheduler}async init(e,t){this.engine=t,this.engine.commandBinder.addBinding(r._,(async e=>{const t=new Task(this.scheduler.getType(e.type),e.func,performance.now()+e.maxDelay,e.steps);return this.scheduler.addTask(t),t})),this.engine.commandBinder.addBinding(a.S,(async e=>{const t=new Task(this.scheduler.getType(e.type),e.func,performance.now()+e.maxDelay,e.steps);return this.scheduler.addTask(t),t}))}onUpdate(e){this.scheduler.update(4)}}},48912:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ScreenshotsModule});var n=i(54122),s=i(30853),o=i(99169),r=i(2779),a=i(21265),l=i(6518),c=i(23941),h=i(97507),d=i(25799),u=i(50101),p=i(2212),m=i(73354),g=i(16696);const f=new d.Z("screenshots");class ScreenshotsModule extends n.Y{constructor(){super(...arguments),this.name="screenshots-module",this.capturer=new ScreenCapturer}async init(e,t){this.engine=t,[this.settingsModule,this.canvas,this.renderer,this.renderToTexture]=await Promise.all([t.getModule(s.default),t.market.waitForData(o.W),t.getModule(u.default),t.getModule(m.default)]),this.settingsModule.registerButton("Debug","Take screenshot",(async()=>{const e=Date.now();await this.takeAndDownloadScreenshot({height:this.canvas.height,width:this.canvas.width},`image_${e}.jpg`,r.o.ALL)})),this.settingsModule.registerButton("Debug","Take 4k screenshot",(async()=>{const e=Date.now();await this.takeAndDownloadScreenshot({height:2304,width:4096},`image_${e}.jpg`,r.o.ALL)})),this.settingsModule.registerButton("Debug","Take 8k screenshot",(async()=>{const e=Date.now();await this.takeAndDownloadScreenshot({height:4608,width:8192},`image_${e}.jpg`,r.o.ALL)})),this.settingsModule.registerButton("Debug","Take 16k screenshot",(async()=>{const e=Date.now();await this.takeAndDownloadScreenshot({height:9e3,width:16e3},`image_${e}.jpg`,r.o.ALL)})),this.settingsModule.registerButton("Debug","Take FB 3D screenshot",(async()=>{const e=Date.now(),t=this.engine.getRenderLayer("model-mesh"),i=this.engine.getRenderLayer("skybox"),n=t.clone();n.addLayers(i);try{await this.takeAndDownloadScreenshot({height:this.canvas.height,width:this.canvas.width},`image_${e}.jpg`,n),await this.engine.commandBinder.issueCommand(new c.U(c.U.modes.Depth)),await this.engine.commandBinder.issueCommand(new h.g(1)),await this.takeAndDownloadScreenshot({height:Math.floor(this.canvas.height/4),width:Math.floor(this.canvas.width/4)},`image_${e}_depth.jpg`,t)}catch(e){throw f.error("Could not take screenshot"),e}finally{await this.engine.commandBinder.issueCommand(new c.U(null)),await this.engine.commandBinder.issueCommand(new h.g(0))}}))}async takeAndDownloadScreenshot(e,t,i){this.renderTarget||(this.renderTarget=await this.engine.commandBinder.issueCommandWhenBound(new g.oM));const n=await this.capturer.capture(i,e,this.renderer,this.renderToTexture,this.renderTarget);(0,a.Hx)((0,l.Xk)(n),t)}}class ScreenCapturer{constructor(){this.captureCamera=new p.Camera}async capture(e,t,i,n,s){const{camera:o,scene:r}=i.getScene();return o.getWorldPosition(this.captureCamera.position),o.getWorldQuaternion(this.captureCamera.quaternion),this.captureCamera.projectionMatrix.copy(o.projectionMatrix),this.captureCamera.layers.mask=e.mask,s.setSize(t.width,t.height),n.render(s.target,r,this.captureCamera),await(0,l.vP)(s)}}},84250:(e,t,i)=>{"use strict";i.d(t,{K:()=>SensorModule});var n=i(54122),s=i(56040),o=i(27829),r=i(2212);class SensorObserver{constructor(){this.needsUpdate=!0}notify(){this.needsUpdate=!0}}var a=i(23812);class SensorObservable{constructor(e){this.observable=new a.$,this.notifier=new class{constructor(e){this.sensorObservable=e}notify(){this.sensorObservable.observable.notify()}}(this),this.dependencySub=e.sub(this.notifier)}dispose(){this.dependencySub.cancel()}observe(e){return this.observable.observe(e)}}class CameraFrustumVolume{constructor(e){this.cameraData=e,this._forward=new r.Vector3,this.frustum=new r.Frustum,this.frustumTransform=new s.M,this.frustumProjection=new s.M,this.forwardObserver=new SensorObserver,this.frustumObserver=new SensorObserver,this.frustumObservable=new SensorObservable(new CameraDataSubsriber(e)),this.frustumObservable.observe(this.forwardObserver),this.frustumObservable.observe(this.frustumObserver)}dispose(){this.frustumObservable.dispose()}get fovx(){return this.cameraData.fovX()}get fovy(){return this.cameraData.fovY()}get forward(){return this.forwardObserver.needsUpdate&&(this.forwardObserver.needsUpdate=!1,this._forward.copy(o.f.FORWARD),this._forward.applyQuaternion(this.cameraData.pose.rotation)),this._forward}observe(e){return this.frustumObservable.observe(e)}get origin(){return this.cameraData.pose.position}containsPoint(e){return this.updateVolume(),this.frustum.containsPoint(e)}updateVolume(){if(this.frustumObserver.needsUpdate){this.frustumObserver.needsUpdate=!1;const e=this.cameraData.pose;this.frustumTransform.compose(e.position,e.rotation,o.f.UNIT).getInverse(this.frustumTransform),this.frustumProjection.copy(this.cameraData.pose.projection),this.frustum.setFromProjectionMatrix(this.frustumTransform.multiplyMatrices(this.frustumProjection,this.frustumTransform).asThreeMatrix4())}}}class CameraDataSubsriber{constructor(e){this.cameraData=e}sub(e){return this.cameraData.onChanged((()=>e.notify()))}}var l=i(30963),c=i(62513),h=i(50101),d=i(89155);class SensorUpdater{constructor(){this.sensors=new Set}addSensor(e){this.sensors.add(e)}removeSensor(e){this.sensors.delete(e)}update(){for(const e of this.sensors)e.update()}}class SensorDecorator{constructor(e,t,i){this.frustum=e,this.raycaster=t,this.sensorDisposer=i,this.volumeObserver=new SensorObserver,this.sources=new Set,this.dirtySources=new Set,this.sourceWatchers=new Map,this.readingsCache=new Map,this.readingObservable=new a.$,this.raycastDirection=new r.Vector3,this.volumeSub=e.observe(this.volumeObserver)}get origin(){return this.frustum.origin}dispose(){this.volumeSub.cancel(),this.sensorDisposer.disposeSensor(this)}addSource(...e){for(const t of e)this.sources.add(t),this.dirtySources.add(t),this.sourceWatchers.set(t,new SourceWatcher(this.dirtySources,t))}get readings(){return this.readingsCache}update(){this.volumeObserver.needsUpdate?(this.volumeObserver.needsUpdate=!1,this.recomputeAllReadings(),this.readingObservable.notify()):this.dirtySources.size>0&&(this.recomputeDirtyReadings(),this.readingObservable.notify())}recomputeAllReadings(){for(const e of this.sources)this.recomputeReading(e);this.dirtySources.clear()}recomputeDirtyReadings(){for(const e of this.dirtySources)this.recomputeReading(e);this.dirtySources.clear()}recomputeReading(e){this.raycastDirection.copy(e.origin).sub(this.frustum.origin).normalize();const t=this.frustum.origin.distanceToSquared(e.origin),i=this.readingsCache.get(e)||{direction:new r.Vector3};i.inRange=function(e,t){return t.volume.containsPoint(e.origin)}(this,e),i.inView=i.inRange&&this.frustum.containsPoint(e.origin)&&!function(e,t){return!!t&&e>t.distance**2}(t,this.raycaster.picking.pick(this.frustum.origin,this.raycastDirection)),i.direction.copy(this.raycastDirection),i.distanceSq=t,this.readingsCache.set(e,i)}onReadingsUpdated(e){return this.readingObservable.observe(e)}}class SourceWatcher{constructor(e,t){this.sub=t.volume.observe({notify(){e.add(t)}})}dispose(){this.sub.cancel()}}var u=i(73706),p=i(75158),m=i(75712),g=i(67126),f=i(9351);const v=(e,t)=>e.type===f.SourceType.BOX?b(t):e.type===f.SourceType.CYLINDER?function(e){const t=new r.CylinderBufferGeometry(.5,.5,1);t.translate(0,.5,0);const i=new r.Mesh(t,new r.MeshBasicMaterial);i.scale.set(.05,.1,.05);const n=new r.MeshBasicMaterial({transparent:!0,opacity:.1,side:r.DoubleSide,depthWrite:!1}),s=new r.Mesh(t,new r.MeshBasicMaterial({wireframe:!0})),o=new r.Mesh(t,n);return o.add(s),e.add(i),e.add(o),{interactionMesh:i,volumeMesh:o,dispose(){e.remove(i),e.remove(o),i.geometry.dispose(),i.material.dispose(),o.geometry.dispose(),o.material.dispose(),s.geometry.dispose(),s.material.dispose()},setColor(e){o.material.color.set(e),s.material.color.set(e)}}}(t):y(t),y=e=>{const t=new r.SphereBufferGeometry(1,20,20),i=new r.Mesh(t,new r.MeshBasicMaterial);i.scale.set(.5,.5,.5);const n=new r.Mesh(t,new r.MeshBasicMaterial({wireframe:!0})),s=new r.Mesh(t,new r.MeshBasicMaterial({transparent:!0,opacity:.1,side:r.DoubleSide,depthWrite:!1}));return s.add(n),e.add(i),e.add(s),{interactionMesh:i,volumeMesh:s,dispose:()=>{e.remove(i),e.remove(s),i.geometry.dispose(),i.material.dispose(),s.geometry.dispose(),s.material.dispose(),n.geometry.dispose(),n.material.dispose()},setColor:e=>{s.material.color.set(e),n.material.color.set(e)}}},b=e=>{const t=new r.BoxBufferGeometry(1,1,1),i=new r.Mesh(t,new r.MeshBasicMaterial);i.scale.set(.1,.1,.1);const n=new r.MeshBasicMaterial({transparent:!0,opacity:.1,side:r.DoubleSide,depthWrite:!1}),s=new r.Mesh(t,n),o=new r.LineSegments(new r.EdgesGeometry(t),new r.LineBasicMaterial);return s.add(o),e.add(i),e.add(s),{interactionMesh:i,volumeMesh:s,dispose:()=>{e.remove(i),e.remove(s),i.geometry.dispose(),i.material.dispose(),s.geometry.dispose(),s.material.dispose(),o.geometry.dispose(),o.material.dispose()},setColor:e=>{s.material.color.set(e),o.material.color.set(e)}}};const w=e=>{if(e.type===f.SourceType.BOX){const t=e,i=Object.assign({},t.volume.size);return i.x=(0,g.uZ)(i.x,.1,4),i.y=(0,g.uZ)(i.y,.1,4),i.z=(0,g.uZ)(i.z,.1,4),i}if(e.type===f.SourceType.CYLINDER){const t=e,i={x:t.volume.radius,y:t.volume.height,z:t.volume.radius};return i.x=(0,g.uZ)(i.x,.1,4),i.y=(0,g.uZ)(i.y,.1,4),i.z=(0,g.uZ)(i.z,.1,4),i}{const t=e,i=(0,g.uZ)(t.volume.radius,.1,4);return{x:i,y:i,z:i}}},S=(new r.Quaternion).identity();function E(e){if(e.type===f.SourceType.BOX){return e.volume.orientation}return S}class VolumeVisualizer{constructor(e,t,i){this.source=e,this.scene=t,this.inputIni=i,this.subs=[],this.stickyHover=!1,this.sourceDirty=!0,this.meshes=v(e,this.scene.scene),this.meshes.interactionMesh.scale.set(.1,.1,.1),this.meshes.interactionMesh.position.copy(this.source.origin),this.meshes.interactionMesh.material.color.set(16724312),this.meshes.volumeMesh.scale.set(0,0,0),this.meshes.volumeMesh.position.copy(this.source.origin),this.meshes.volumeMesh.visible=!1;const n=E(e);this.meshes.volumeMesh.quaternion.copy(n);this.mixer=new r.AnimationMixer(this.meshes.volumeMesh);const s=w(e),o=new r.VectorKeyframeTrack(".scale",[0,.4],[0,0,0,s.x,s.y,s.z],r.InterpolateSmooth),a=new r.AnimationClip(void 0,.4,[o]);this.onHoverAction=this.mixer.clipAction(a),this.onHoverAction.clampWhenFinished=!0,this.onHoverAction.loop=r.LoopOnce,this.subs.push(this.inputIni.registerMeshHandler(u.z,m.s.isValue(this.meshes.interactionMesh),(()=>{const e=this.onHoverAction.time;this.onHoverAction.reset(),this.meshes.volumeMesh.visible=!0,this.onHoverAction.timeScale=1,this.onHoverAction.time=e,this.onHoverAction.play()}))),this.subs.push(this.inputIni.registerMeshHandler(u.A,m.s.isValue(this.meshes.interactionMesh),(()=>{if(!this.stickyHover){const e=this.onHoverAction.time;this.onHoverAction.reset(),this.onHoverAction.time=e,this.onHoverAction.timeScale=-1,this.onHoverAction.play()}}))),this.subs.push(this.inputIni.registerMeshHandler(p.R,m.s.isValue(this.meshes.interactionMesh),(()=>{this.stickyHover=!this.stickyHover,this.stickyHover?this.meshes.interactionMesh.material.color.set(4473924):this.meshes.interactionMesh.material.color.set(16724312)}))),this.inputIni.registerMesh(this.meshes.interactionMesh,!1),this.subs.push(e.volume.observe(this))}notify(){this.sourceDirty=!0}update(e,t){if(this.sourceDirty){this.sourceDirty=!1,this.meshes.interactionMesh.position.copy(this.source.origin),this.meshes.volumeMesh.position.copy(this.source.origin),this.meshes.volumeMesh.quaternion.copy(E(this.source));const e=w(this.source),t=this.onHoverAction.getClip().tracks[0].values;t[3]=e.x,t[4]=e.y,t[5]=e.z}this.meshes.setColor(t.inRange?65280:16711680),this.mixer.update(e/1e3)}dispose(){this.meshes.dispose(),this.mixer.stopAllAction();for(const e of this.subs)e.cancel()}}class SensorRenderer{constructor(e,t,i){this.sensor=e,this.scene=t,this.inputIni=i,this.subs=[],this.visuals=new Map}init(){this.subs.push(this.sensor.onReadingsUpdated(this))}render(e){for(const[t,i]of this.sensor.readings){let n=this.visuals.get(t);n||(n=new VolumeVisualizer(t,this.scene,this.inputIni),this.visuals.set(t,n)),n.update(e,i)}}dispose(){}activate(){}deactivate(){for(const e of this.subs)e.cancel();for(const e of this.visuals.values())e.dispose();this.visuals.clear()}notify(){}}class SensorModule extends n.Y{constructor(){super(...arguments),this.name="sensor-module",this.sensorUpdater=new SensorUpdater,this.debugSensor=null,this.sensorDisposer=new class{constructor(e){this.sensors=e}disposeSensor(e){this.sensors.removeSensor(e)}}(this)}async init(e,t){[this.cameraData,this.raycaster,this.renderer,this.inputIni]=await Promise.all([await t.market.waitForData(d.M_),await t.getModule(c.default),await t.getModule(h.default),await t.getModule(l.default)]),this.cameraVolume=new CameraFrustumVolume(this.cameraData);var i,n,s,o;this.sensorDebuggerFactory=(i=e=>{t.addComponent(this,e)},n=e=>{t.removeComponent(this,e)},s=this.renderer.getScene(),o=this.inputIni,e=>{const t=new SensorRenderer(e,s,o);return i(t),{dispose:()=>{n(t)}}})}dispose(){this.cameraVolume.dispose()}createSensor(e){const t=new SensorDecorator(e,this.raycaster,this.sensorDisposer);return this.sensorUpdater.addSensor(t),t}createCameraBoundSensor(){return this.createSensor(this.cameraVolume)}setDebugSensor(e){this.debugSensor&&(this.debugSensor.dispose(),this.debugSensor=null),e&&(this.debugSensor=this.sensorDebuggerFactory(e))}onUpdate(){this.sensorUpdater.update()}removeSensor(e){this.sensorUpdater.removeSensor(e)}}},9351:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a,SensorModule:()=>n.K,BoxVolume:()=>s.k,CylinderVolume:()=>o.X,SphereVolume:()=>r.b,SourceType:()=>l});var n=i(84250),s=i(54564),o=i(49194),r=i(46841);const a=n.K;var l;!function(e){e.SPHERE="sourcetype.sphere",e.BOX="sourcetype.box",e.CYLINDER="sourcetype.cylinder"}(l||(l={}))},54564:(e,t,i)=>{"use strict";i.d(t,{k:()=>BoxVolume});var n=i(2212),s=i(23812);class BoxVolume extends s.${constructor(){super(),this.box=new n.Box3,this.center=new n.Vector3,this.size=new n.Vector3(1/0,1/0,1/0),this.orientation=new n.Quaternion,this.inverseOrientation=new n.Quaternion,this.pointCache=new n.Vector3,this.transformNeedsUpdate=!1,this.box.setFromCenterAndSize(this.center,this.size)}get origin(){return this.center}updateCenter(e){this.center.copy(e),this.box.setFromCenterAndSize(this.center,this.size),this.transformNeedsUpdate=!0}updateDimensions(e){this.size.copy(e),this.box.setFromCenterAndSize(this.center,this.size)}updateOrientation(e){this.orientation.copy(e),this.transformNeedsUpdate=!0}containsPoint(e){return this.transformNeedsUpdate&&(this.transformNeedsUpdate=!1,this.inverseOrientation.copy(this.orientation).invert()),this.pointCache.copy(e).sub(this.center),this.pointCache.applyQuaternion(this.orientation),this.pointCache.add(this.center),this.box.containsPoint(this.pointCache)}}},49194:(e,t,i)=>{"use strict";i.d(t,{X:()=>CylinderVolume});var n=i(2212),s=i(23812);class CylinderVolume extends s.${constructor(){super(...arguments),this._basePoint=new n.Vector3,this._height=1/0,this._radius=1/0,this.pointCache=new n.Vector3}get origin(){return this._basePoint}get basePoint(){return this._basePoint}get height(){return this._height}get radius(){return this._radius}updateBasePoint(e){this.basePoint.set(e.x,e.y,e.z)}updateHeight(e){this._height=e}updateRadius(e){this._radius=e}containsPoint(e){return this.pointCache.set(e.x,this._basePoint.y,e.z),this._basePoint.distanceToSquared(this.pointCache)<=this.radius**2&&this._basePoint.y<=e.y&&e.y<=this._basePoint.y+this.height}}},46841:(e,t,i)=>{"use strict";i.d(t,{b:()=>SphereVolume});var n=i(2212),s=i(23812);class SphereVolume extends s.${constructor(){super(...arguments),this.origin=new n.Vector3,this.radius=1/0}updateRadius(e){this.radius=e}updateOrigin(e){this.origin.copy(e)}containsPoint(e){return this.origin.distanceToSquared(e)<=this.radius**2}}},12505:(e,t,i)=>{"use strict";i.d(t,{i:()=>SkySphereMesh});var n=i(2212);class SkySphereMesh extends n.Mesh{}},79234:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>SkyboxModule});var n=i(54122),s=i(2212),o=i(13441),r=i(81047),a=i(48101);const l={sky:{uniforms:{topColor:{type:"v3",value:new s.Vector3(.094,.102,.11)},bottomColor:{type:"v3",value:new s.Vector3(.2,.216,.235)},radius:{type:"f",value:100}},vertexShader:(0,a.m)(r,i(91411)),fragmentShader:(0,a.m)(o,i(451))}};class SkyboxMaterial extends s.RawShaderMaterial{constructor(e={}){super(Object.assign({fragmentShader:l.sky.fragmentShader,vertexShader:l.sky.vertexShader,uniforms:s.UniformsUtils.clone(l.sky.uniforms),name:"SkyboxMaterial"},e))}}var c=i(2779),h=i(12505),d=i(20599),u=i(64279);class Skybox{constructor(e,t,i,n,s=c.o.ALL){this.scene=e,this.cameraData=t,this.addToRaycasting=i,this.removeFromRaycasting=n,this.renderLayer=s,this.bindings=[]}init(){const{visualMesh:e,colliderMesh:t}=this.setupSkysphere();this.skyVisual=e,this.material=this.skyVisual.material,this.skyCollider=t}dispose(){this.material.uniforms.pano0Map.value.dispose(),this.material.uniforms.pano1Map.value.dispose(),this.material.dispose(),this.skyVisual.geometry.dispose()}activate(e){this.scene.addChild(this.scene.ids.Root,this.skyVisual),this.skyVisual.updateMatrixWorld(!0),this.skyVisual.visible=!0,this.addToRaycasting(this.skyCollider,!1)}deactivate(e){for(const e of this.bindings)e.cancel();this.bindings=[],this.scene.removeChild(this.scene.ids.Root,this.skyVisual),this.scene.removeChild(this.scene.ids.CameraRig,this.skyCollider),this.removeFromRaycasting(this.skyCollider)}updateBackgroundColors(e,t){const i=new s.Color(e),n=new s.Color(t);this.material.uniforms.topColor.value.set(i.r,i.g,i.b),this.material.uniforms.bottomColor.value.set(n.r,n.g,n.b)}beforeRender(){this.skyVisual.position.copy(this.cameraData.pose.position),this.skyCollider.position.copy(this.cameraData.pose.position)}render(){}setupSkysphere(e){const t=new s.SphereBufferGeometry(1e4,5,5);t.computeBoundingBox();const i=u.oR.far-10,n=new s.SphereBufferGeometry(i,5,5);n.computeBoundingBox(),e||(e=new SkyboxMaterial({side:s.BackSide}));const o=new h.i(n,e);o.layers.mask=this.renderLayer.mask,o.name="Skysphere",o.renderOrder=d.z.boundingSkybox,o.updateMatrixWorld(!0),e.uniforms.radius.value=i,e.depthWrite=!1,e.depthTest=!1;return{visualMesh:o,colliderMesh:new h.i(t,new s.MeshBasicMaterial({opacity:0,depthWrite:!1,side:s.BackSide}))}}}var p=i(50101),m=i(30963),g=i(39936),f=i(78383),v=i(62431),y=i(89155);class SkyboxModule extends n.Y{constructor(){super(...arguments),this.name="skybox-module"}async init(e,t){const[i,n,s,o]=await Promise.all([t.getModule(p.default),t.market.waitForData(g.e),t.getModule(m.default),t.market.waitForData(y.M_)]),r=t.claimRenderLayer("skybox"),a=i.getScene();this.skybox=new Skybox(a,o,s.registerMesh,s.unregisterMesh,r),t.addComponent(this,this.skybox);const l=n.tryGetProperty(v.gx.BackgroundColor,f.z.default);this.skybox.updateBackgroundColors(f.K[l].bgPrimary,f.K[l].bgSecondary),this.bindings.push(n.onPropertyChanged(v.gx.BackgroundColor,(e=>{this.skybox.updateBackgroundColors(f.K[e].bgPrimary,f.K[e].bgSecondary)})))}}},8639:(e,t,i)=>{"use strict";i.d(t,{E:()=>CaptureSnapshotCommand,e:()=>EquirectSnapshotCommand});var n=i(17513),s=i(99681),o=i(87131),r=i(21746);class CaptureSnapshotCommand extends s.m{constructor(e){super(),this.id="CAPTURE_SNAPSHOT",this.payload={maxSize:e.maxSize||o.SL.ULTRAHIGH,aspect:e.aspect||r.g$,category:e.category||n.i.USER,onProgress:e.onProgress,waitForUpload:void 0===e.waitForUpload||e.waitForUpload}}}class EquirectSnapshotCommand extends s.m{constructor(e){super(),this.id="EQUIRECTANGULAR_SNAPSHOT",this.payload={onProgress:e.onProgress,waitForUpload:void 0===e.waitForUpload||e.waitForUpload}}}},58797:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>SnapshotsEditor});var n=i(54122),s=i(50101),o=i(77956),r=i(89155),a=i(71208),l=i(12775),c=i(16696),h=i(6518),d=i(84559),u=i(47254),p=i(19938),m=i(28281),g=i(2779),f=i(87131),v=i(97620),y=i(8639),b=i(5442),w=i(26247),S=i(27829),E=i(21746),T=i(91055),M=i(19418),_=i(17617);class SnapshotCaptureError extends _.y{constructor(e){super(e),this.name="SnapshotCaptureError"}}class SnapshotUploadError extends _.y{constructor(e){super(e),this.name="SnapshotUploadError"}}var x=i(17513),A=i(25799),O=i(22729),P=i(57369),C=i(62367),D=i(55525),I=i(92925),R=i(46086),L=i(944);const N=new A.Z("snapshot-editor"),k=m.Xd.uploadIntervalDelay;class SnapshotsEditor extends n.Y{constructor(){super(...arguments),this.name="snapshots-editor"}async init(e,t){this.engine=t,[this.renderer,this.sweepTilingModule]=await Promise.all([t.getModule(s.default),t.getModule(u.Z)]),[this.sweepData,this.viewmodeData,this.cameraData,this.floorsViewData]=await Promise.all([t.market.waitForData(o.Z),t.market.waitForData(l.O),t.market.waitForData(r.M_),t.market.waitForData(O.c),t.market.waitForData(w.P)]),[this.snapshotTarget,this.snapshotOverlayTarget]=await Promise.all([t.commandBinder.issueCommandWhenBound(new c.oM),t.commandBinder.issueCommandWhenBound(new c.oM)]),this.bindings.push(t.commandBinder.addBinding(y.E,(async e=>{const i=e.onProgress||(0,b.Y)(0);i.value=10,t.commandBinder.issueCommand(new D.ZK);const n=await this.queryIdealResolution(e.maxSize,e.aspect);this.snapshotTarget.setSize(n.width,n.height),this.snapshotOverlayTarget.setSize(n.width,n.height),await this.fetchHighestAvailable(!1,e.maxSize,(e=>i.value=Math.max(10,e))),await(0,C.gw)(2*k),await this.takeScreenshot();const s=this.sweepData.getSweep(this.sweepData.currentSweep);this.viewmodeData.currentMode===a.Ey.Panorama&&await this.sweepTilingModule.revertTilingSettings(s.id),t.commandBinder.issueCommand(new D.Lp);let o=e.category;s&&(s.alignmentType===P.z9.UNALIGNED||s.placementType===P.hU.MANUAL)&&o===x.i.USER&&(o=x.i.UNALIGNED);const r=this.uploadAndAddSnapshot(o).then((e=>e&&e.sid)).catch((e=>{throw N.error(e),this.engine.broadcast(new M.q(e)),e}));return e.waitForUpload?r:null})));const i=S.f.FORWARD.clone(),n=S.f.FORWARD.clone();this.bindings.push(t.commandBinder.addBinding(y.e,(async e=>{const s=e.onProgress||(0,b.Y)(0);s.value=10,t.commandBinder.issueCommand(new D.ZK),await(0,C.gw)(50);const o=this.queryIdealEqResolution();this.snapshotTarget.setSize(o.width,o.height);const r=this.sweepData.getSweep(this.sweepData.currentSweep);i.copy(S.f.FORWARD).applyQuaternion(r.rotation).setY(0),n.copy(S.f.FORWARD).applyQuaternion(this.cameraData.pose.rotation).setY(0);const a=(0,T.k2)(i,n)+Math.PI;await this.fetchHighestAvailable(!0,f.SL.ULTRAHIGH,(e=>s.value=Math.max(10,e))),await this.takeEquirectangular(a),await this.sweepTilingModule.revertTilingSettings(r.id),t.commandBinder.issueCommand(new D.Lp);const l=(0,h.fY)(this.snapshotTarget.width,this.snapshotTarget.height,a,0),c=this.uploadAndAddSnapshot(x.i.PANORAMA,l).then((e=>e&&e.sid)).catch((e=>{throw N.error(e),this.engine.broadcast(new M.q(e)),e}));return e.waitForUpload?c:null})))}async uploadAndAddSnapshot(e,t){const i=this.createSnapshot(e);i.state=R.R.CAPTURING,i.imageBlob=(0,h.Xk)(await(0,h.vP)(this.snapshotTarget,t)),i.state=R.R.UPLOADING;try{return await this.engine.commandBinder.issueCommand(new L.nM(i))}catch(e){throw i.state=R.R.ERROR,N.error(e),new SnapshotUploadError("Failed to upload snapshot")}}createSnapshot(e){const t=this.viewmodeData.isPano();let i=(0,C.DZ)(new Date);if(t){const e=this.sweepData.getSweep(this.sweepData.currentSweep).name;e&&(i=e)}const n=new I.a;return n.name=i,n.category=e,n.is360=t&&!this.sweepData.currentAlignedSweepObject,n.metadata={cameraMode:this.viewmodeData.currentMode,cameraPosition:this.cameraData.pose.position.clone(),cameraQuaternion:this.cameraData.pose.rotation.clone(),orthoZoom:this.viewmodeData.currentMode===a.Ey.Floorplan?this.cameraData.zoom():-1,ssZoom:this.cameraData.zoom(),scanId:t?this.sweepData.currentSweep:void 0,floorId:this.floorsViewData.currentFloorId,floorVisibility:this.floorsViewData.getFloorsVisibility()},n}async queryIdealResolution(e=f.SL.ULTRAHIGH,t){let i=3840,n=i*E.LP;const s=this.renderer.maxTextureSize;if(i>s&&(N.warn(`The active gl context does not support 4k x 2k equirectangular capture\nCapture is limited to a max size of ${s}`),i=s,n=i*E.LP),this.viewmodeData.currentMode===a.Ey.Panorama){const o=await this.sweepTilingModule.availableResolution(this.sweepData.currentSweepObject,e),r=d.Z.getPanoSize(o)*(this.cameraData.fovY()*v.MN)/90;i=Math.min(Math.round(r*t),s),n=Math.round(i/t)}return Promise.resolve({width:i,height:n})}queryIdealEqResolution(){let e=4096,t=.5*e;if(this.viewmodeData.currentMode!==a.Ey.Panorama)throw new SnapshotCaptureError("Equirectangular capture is only supported in Panorama mode");const i=this.renderer.maxTextureSize;return e>i&&N.warn(`The active gl context does not support 4k x 2k equirectangular capture\nCapture is limited to a max size of ${i}`),e=Math.min(i,e),t=.5*e,{width:e,height:t}}fetchHighestAvailable(e,t=f.SL.ULTRAHIGH,i){if(this.viewmodeData.currentMode===a.Ey.Panorama){const n=this.sweepData.currentSweepObject,s=e?p.v.FullPanorama:p.v.CurrentView;return this.sweepTilingModule.requestResolution(n,t,s,!0).then((e=>{const t=this.sweepTilingModule.waitForQueue(s,e);return i&&t.progress((e=>i(e*SnapshotsEditor.captureProgressFudgeFactor))),t}))}return i&&i(SnapshotsEditor.captureProgressFudgeFactor),Promise.resolve()}takeScreenshot(){const e=g.o.ALL;e.removeLayers(this.engine.getRenderLayer("grid-underlay")),e.removeLayers(this.engine.getRenderLayer("cursor-mesh")),e.removeLayers(this.engine.getRenderLayer("current-pano-marker"));const t=this.renderer.getScene().scene,i=this.renderer.getScene().camera,n=i.layers.mask;return i.layers.mask=e.mask,this.engine.commandBinder.issueCommand(new c.vU(this.snapshotTarget,t,i)).then((()=>{i.layers.mask=n}))}takeEquirectangular(e){const t=this.sweepData.currentSweep,i=this.sweepTilingModule.getRenderer(),n=i.useTexture(t),s=this.engine.commandBinder.issueCommand(new c.fZ(this.snapshotTarget,n,e));return i.freeTexture(t),s}}SnapshotsEditor.captureProgressFudgeFactor=90},19418:(e,t,i)=>{"use strict";i.d(t,{q:()=>SnapshotErrorMessage});var n=i(93528);class SnapshotErrorMessage extends n.v{constructor(e){super()}}},92925:(e,t,i)=>{"use strict";i.d(t,{a:()=>Snapshot});var n=i(78909),s=i(71208),o=i(17513);class Snapshot extends n.T{constructor(){super(),this.category=o.i.USER}clone(){return(new Snapshot).copy(this)}copy(e){return this.sid=e.sid,this.thumbnailUrl=e.thumbnailUrl,this.imageUrl=e.imageUrl,this.name=e.name,this.is360=e.is360,this.category=e.category,this.height=e.height,this.width=e.width,this.created=e.created,this.modified=e.modified,this.visionLabel=e.visionLabel,this.visionName=e.visionName,this.imageBlob=e.imageBlob,this.metadata={cameraMode:e.metadata.cameraMode,cameraPosition:e.metadata.cameraPosition.clone(),cameraQuaternion:e.metadata.cameraQuaternion.clone(),scanId:e.metadata.scanId,orthoZoom:e.metadata.orthoZoom,ssZoom:e.metadata.ssZoom,floorId:e.metadata.floorId,floorVisibility:e.metadata.floorVisibility},this.commit(),this}isInsidePano(){return this.metadata.cameraMode===s.Ey.Panorama&&""!==this.metadata.scanId}refresh(e){this.thumbnailUrl.refreshFrom(e.thumbnailUrl),this.imageUrl.refreshFrom(e.imageUrl)}}},17513:(e,t,i)=>{"use strict";var n;i.d(t,{i:()=>n}),function(e){e.USER="user",e.PANORAMA="panorama",e.UNALIGNED="unaligned",e.AUTO="auto",e.TOUR="tour"}(n||(n={}))},46086:(e,t,i)=>{"use strict";var n;i.d(t,{R:()=>n}),function(e){e.CAPTURING="capturing",e.UPLOADING="uploading",e.ERROR="error",e.DONE="done"}(n||(n={}))},944:(e,t,i)=>{"use strict";i.d(t,{yz:()=>RenameSnapshotCommand,Ad:()=>DeleteSnapshotCommand,nM:()=>UploadSnapshotCommand});var n=i(99681);class RenameSnapshotCommand extends n.m{constructor(e,t){super(),this.id="RENAME_SNAPSHOT",this.payload={id:e,name:t}}}class DeleteSnapshotCommand extends n.m{constructor(e){super(),this.id="DELETE_SNAPSHOT",this.payload={id:e}}}class UploadSnapshotCommand extends n.m{constructor(e){super(),this.id="UPLOAD_SNAPSHOT",this.payload={snapshot:e}}}},26247:(e,t,i)=>{"use strict";i.d(t,{P:()=>SnapshotsData});var n=i(19413),s=i(62367),o=i(68519);class SnapshotsData extends n.V{constructor(e){super(),this.name="snapshots",this.snapshots={};for(const t in e)this.snapshots[t]=e[t].clone()}get(e){return this.snapshots[e]}get collection(){return this.snapshots}add(e){e.sid=this.validateSid(e.sid),this.snapshots[e.sid]=e,this.updateOnStaleCallbacks(),this.commit()}remove(e){delete this.snapshots[e.sid],this.commit()}validateSid(e){for(;!e||this.snapshots[e];)e=(0,s.O1)(11);return e}clone(){return new SnapshotsData(this.snapshots)}set onStale(e){this.hydrate=e,this.updateOnStaleCallbacks()}updateOnStaleCallbacks(){this.hydrate&&(0,o.s)(this.snapshots,(async()=>{const e=await this.hydrate();for(const t in this.snapshots)e&&e[t]&&this.snapshots[t].refresh(e[t])}))}}},88635:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>SnapshotsDataModule});var n=i(54122),s=i(17256),o=i(71208),r=i(25799),a=i(77956),l=i(26247),c=i(24411),h=i(32400),d=i(51770),u=i(70096),p=i(62749),m=i(60268),g=i(97620),f=i(40032),v=i(17513);const y={[o.Ey.Dollhouse]:p.w.DOLLHOUSE,[o.Ey.Floorplan]:p.w.FLOORPLAN,[o.Ey.Panorama]:p.w.PANORAMA,[o.Ey.Outdoor]:p.w.PANORAMA,[o.Ey.Transition]:p.w.MESH};class MdsSnapshotUploadSerializer{constructor(){}serialize(e,t){const i=[];for(const[n,s]of e.metadata.floorVisibility.entries())if(1===s){const e=t.floorsData.getFloorAtIndex(n);e&&i.push(e.id)}return{label:e.name,contents:{filename:`${e.name}.jpg`,blob:e.imageBlob},snapshotLocation:{anchorId:e.metadata.scanId,visibleFloorIds:i,position:(0,f.m)(g.ep.toVisionVector(e.metadata.cameraPosition)),rotation:(0,f.J5)(g.ep.toVisionCameraQuaternion(e.metadata.cameraQuaternion)),viewMode:y[e.metadata.cameraMode],zoom:e.metadata.cameraMode===o.Ey.Floorplan?e.metadata.orthoZoom:e.metadata.ssZoom},photoType:e.category===v.i.PANORAMA?m.B.EQUIRECTANGULAR:m.B.PHOTO2D}}}const b=new r.Z("mds-snapshot-store");class MdsSnapshotStore extends h.u{constructor(){super(...arguments),this.deserializer=new u.f,this.serializer=new MdsSnapshotUploadSerializer,this.prefetchKey="data.model.assets.photos"}async read(e){const t={modelId:this.getViewId()};return this.query(c.GetSnapshots,t,e).then((e=>{var t,i,n;const s=((null===(n=null===(i=null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.model)||void 0===i?void 0:i.assets)||void 0===n?void 0:n.photos)||[]).map((e=>this.deserializer.deserialize(e))),o={};for(const e of s)e&&(o[e.sid]=e);return o}))}async refresh(){return this.refreshPromise||(this.refreshPromise=this.read({fetchPolicy:"no-cache"}).finally((()=>{this.refreshPromise=void 0}))),this.refreshPromise}async create(e,t){var i;const n=h.u.baseViewId,s=e.category===v.i.TOUR,o=s?"UploadHighlightReelSnapshot":"UploadModelSnapshot",r=s?c.UploadHighlightReelSnapshot:c.UploadModelSnapshot,a=this.serializer.serialize(e,t),l=await this.client.upload(r,o,Object.assign(Object.assign({},a),{modelId:n}));if(l.errors&&l.errors.length>0)throw b.error(l.errors),new Error("Snapshot creation failed");return this.deserializer.deserialize(null===(i=l.data)||void 0===i?void 0:i.snapshot)}async update(e){const t=h.u.baseViewId,i=await this.client.mutate(c.PatchPhoto,{modelId:t,photoId:e.sid,label:e.name});if(i.errors&&i.errors.length>0)throw b.error(i.errors),new Error("Failed to update snapshot");const n=(0,d.qw)(i,"data.patchPhoto");return this.deserializer.deserialize(n)}async delete(e){const t=h.u.baseViewId,i=await this.client.mutate(c.DeletePhoto,{modelId:t,photoId:e});if(i.errors&&i.errors.length>0)throw b.error(i.errors),new Error("Failed to delete snapshot");return(0,d.qw)(i,"data.deletePhoto")||!1}}var w=i(944),S=i(96832),E=i(25936),T=i(83852),M=i(61111);const _=new r.Z("MpWebSnapshotSerializer");class MpWebSnapshotSerializer{serialize(e){if(!this.validate(e))return _.info("Cannot serialize invalid snapshot",e),null;const t={camera_mode:(0,o.tU)(e.metadata.cameraMode),camera_position:(0,g.gj)(e.metadata.cameraPosition),camera_quaternion:(0,f.J5)((0,g.EV)(e.metadata.cameraQuaternion)),ortho_zoom:e.metadata.orthoZoom,ss_zoom:e.metadata.ssZoom,scan_id:e.metadata.scanId,is_ortho:e.metadata.cameraMode===o.Ey.Floorplan,floorVisibility:e.metadata.floorVisibility},i=e.category,n=`${e.name}.jpg`;return{src:[e.imageBlob,n],name:e.name,metadata:JSON.stringify(t),category:i}}validate(e){return!!e.imageBlob}}var x,A=i(68519);!function(e){e.AUTO="auto",e.PANORAMA="panorama",e.TOUR="tour",e.UNALIGNED="unaligned",e.USER="user"}(x||(x={}));var O=i(2212),P=i(92925),C=i(46086);const D=new r.Z("MpWebSnapshotDeserializer"),I={[x.AUTO]:v.i.AUTO,[x.PANORAMA]:v.i.PANORAMA,[x.TOUR]:v.i.TOUR,[x.UNALIGNED]:v.i.UNALIGNED,[x.USER]:v.i.USER};class MpWebSnapshotDeserializer{deserialize(e){const t=this.validate(e);if(!t)return D.debug("Deserialized invalid snapshot",e),null;const i=(0,o.Lm)(3===t.metadata.camera_mode?0:t.metadata.camera_mode),n=(0,g.gj)(t.metadata.camera_position?t.metadata.camera_position:new O.Vector3);let s=(0,g.EV)(t.metadata.camera_quaternion||new O.Quaternion);i!==o.Ey.Floorplan&&(s=(0,g.Z)(s));let r=null;const a=t.metadata.floorVisibility;if("object"==typeof a)for(let e=0;e<a.length;e++)a[e]&&(r=e.toString());const l=t.metadata.highest_floor;"number"==typeof l&&l>-1&&(r=l.toString());const c={cameraMode:i,cameraPosition:n,cameraQuaternion:s,scanId:t.metadata.scan_id||"",orthoZoom:t.metadata.ortho_zoom,floorId:r,ssZoom:t.metadata.ss_zoom||1,floorVisibility:t.metadata.floorVisibility},h=I[t.category];return(new P.a).copy({sid:t.sid,state:C.R.DONE,metadata:c,thumbnailUrl:new A.n(t.thumbnail_signed_src,null),imageUrl:new A.n(t.signed_src,null),name:t.name,is360:"unaligned"===t.category,category:h,height:t.height,width:t.width,modified:new Date(Date.parse(t.modified)),created:new Date(Date.parse(t.created)),visionLabel:t.vision_generated_label,visionName:t.vision_generated_name})}validate(e){if(!e)return null;let t;try{t=JSON.parse(e.metadata)}catch(t){return D.info("Failed to parse image metadata: ",e.metadata),null}return 0===Object.keys(t).length||"assetType"in t?null:e.category in I?Object.assign(Object.assign({},e),{metadata:t}):(D.debug(`Invalid snapshot category ${e.category}`),null)}}var R=i(64519),L=i(80034),N=i(35135);class MpWebSnapshotStore extends R.n{constructor(e){super(e),this.serializer=new MpWebSnapshotSerializer,this.deserializer=new MpWebSnapshotDeserializer}async refresh(){throw new T.n("Refresh not implemented for mp_web images")}async read(){const{modelId:e}=this.config,t=`/api/v1/player/models/${e}/`;let i;if(i=N.t.model?N.t.model:await this.request(L.w$.GET,t),!i||!Array.isArray(i.images))return null;const n={};for(const e of i.images){const t=this.deserializer.deserialize(e);t&&(n[t.sid]=t)}return n}async create(e){const{modelId:t,readonly:i}=this.config;if(i)throw new M.d7;const n=this.serializer.serialize(e);if(!n)throw new Error("Failed to upload image");const s=new FormData;for(const[e,t]of Object.entries(n))Array.isArray(t)&&t[0]instanceof Blob?s.append(e,...t):s.append(e,t);const o=`/api/v1/player/models/${t}/images/`,r=await this.request(L.w$.POST,o,{body:s});return this.deserializer.deserialize(r)}async update(e){const{modelId:t,readonly:i}=this.config;if(i)throw new M.d7;const n={name:e.name},s=`/api/v1/player/models/${t}/images/${e.sid}`,o=await this.request(L.w$.PATCH,s,{body:n});return this.deserializer.deserialize(o)}async delete(e){const{modelId:t,readonly:i}=this.config;if(i)throw new M.d7;const n=`/api/v1/player/models/${t}/images/${e}`;return await this.request(L.w$.DELETE,n),!0}}const k=new r.Z("snapshots");class SnapshotsDataModule extends n.Y{constructor(){super(...arguments),this.name="snapshots-data"}async init(e,t){const{readonly:i}=e;this.engine=t,this.store=this.getStore(e);const n=await this.store.read()||{};this.sweepData=await t.market.waitForData(a.Z);for(const e in n)this.processSnapshot(n[e]);this.snapshotsData=new l.P(n),this.snapshotsData.onStale=()=>this.store.read(),t.market.register(this,l.P,this.snapshotsData),i||this.bindings.push(t.commandBinder.addBinding(w.nM,(({snapshot:e})=>this.uploadSnapshot(e))),t.commandBinder.addBinding(w.yz,(({id:e,name:t})=>this.renameSnapshot(e,t))),t.commandBinder.addBinding(w.Ad,(({id:e})=>this.deleteSnapshot(e))))}async uploadSnapshot(e){const t=await this.engine.market.waitForData(E.i),i=await this.store.create(e,{floorsData:t});return i&&(this.processSnapshot(i),this.snapshotsData.add(i),this.engine.broadcast(new S.t(i))),i}async renameSnapshot(e,t){const i=this.snapshotsData.get(e);if(t!==i.name)return i.name=t,i.commit(),this.snapshotsData.commit(),this.store.update(i)}async deleteSnapshot(e){return this.store.delete(e)}getStore(e){if(this.store)return this.store;const{modelId:t,baseUrl:i,queue:n}=e,o=e.storageProvider||s.Xq.JSONSTORE,r=!("readonly"in e)||!!e.readonly;return k.info(`Loading Snapshots from ${o}`),o===s.Xq.MDS?new MdsSnapshotStore({readonly:r,baseUrl:i}):new MpWebSnapshotStore({modelId:t,readonly:r,queue:n,baseUrl:i})}processSnapshot(e){const t=e.metadata.cameraMode===o.Ey.Panorama,i=!this.sweepData.isSweepAligned(e.metadata.scanId);if(e.is360=t&&i,t){const t=this.sweepData.getSweep(e.metadata.scanId);t&&e.metadata.cameraPosition.copy(t.position)}e.name.match(/^[0-9.]+_[0-9.]+$/)&&(e.name="")}}},96832:(e,t,i)=>{"use strict";i.d(t,{t:()=>SnapshotCreatedMessage});var n=i(93528);class SnapshotCreatedMessage extends n.v{constructor(e){super(),this.snapshot=e}}},70096:(e,t,i)=>{"use strict";i.d(t,{f:()=>MdsSnapshotDeserializer});var n,s,o=i(2212);!function(e){e.SNAPSHOT="snapshot",e.TOUR="tour"}(n||(n={})),function(e){e.USER="user",e.VISION="vision"}(s||(s={}));var r=i(99555),a=i(62749),l=i(60268),c=i(71208),h=i(25799),d=i(97620),u=i(51770),p=i(32020),m=i(92925),g=i(17513),f=i(68519);const v=new h.Z("mds-snapshot-deserializer");class MdsSnapshotDeserializer{deserialize(e){if(!e||!this.validate(e))return v.debug("Deserialized invalid Snapshot data from MDS",e),null;const t=new m.a;t.sid=e.id,t.thumbnailUrl=new f.n(e.thumbnailUrl||"",(0,p.p)(e.validUntil,null)),t.imageUrl=new f.n(e.presentationUrl||"",(0,p.p)(e.validUntil,null)),t.name=e.label||"",t.category=this.getCwfSnapshotCategory(e)||g.i.USER,t.width=e.width||0,t.height=e.height||0,t.created=(0,p.p)(e.created),t.modified=(0,p.p)(e.modified),t.visionLabel=e.classification||"";const i=(0,u.qw)(e,"snapshotLocation.anchor.pano.placement");t.is360=!(!i||i===r.b.AUTO);const{snapshotLocation:n}=e;if(n){const e=n.position?d.ep.fromVisionVector(n.position):new o.Vector3,i=n.rotation?d.ep.fromVisionCameraQuaternion(n.rotation):new o.Quaternion,s=this.getCwfViewmode(n.viewMode)||c.Ey.Panorama,r=[];for(const e of n.floorVisibility){for(let t=0;t<e.sequence;t++)r[t]=r[t]||0;r[e.sequence]=1}t.metadata={cameraMode:s,cameraPosition:e,cameraQuaternion:i,scanId:n.anchor&&n.anchor.id||"",orthoZoom:s===c.Ey.Floorplan?n.zoom:-1,ssZoom:n.zoom||1,floorId:n.floorVisibility.length>0?n.floorVisibility[0].id:null,floorVisibility:r}}return t}validate(e){var t;if(!(null===(t=e.snapshotLocation)||void 0===t?void 0:t.position))return!1;const i=["id","snapshotLocation","thumbnailUrl","presentationUrl"].every((t=>t in e)),n=null!==this.getCwfSnapshotCategory(e);return i&&n}getCwfViewmode(e){const t={[a.w.DOLLHOUSE]:c.Ey.Dollhouse,[a.w.PANORAMA]:c.Ey.Panorama,[a.w.FLOORPLAN]:c.Ey.Floorplan,[a.w.MESH]:c.Ey.Panorama};return e in t?t[e]:null}getCwfSnapshotCategory(e){if(e.category===n.TOUR)return g.i.TOUR;if(e.origin===s.VISION)return g.i.AUTO;if(e.type===l.B.EQUIRECTANGULAR)return g.i.PANORAMA;const t=(0,u.qw)(e,"snapshotLocation.anchor.pano.placement");return e.type===l.B.PHOTO2D?t===r.b.MANUAL?g.i.UNALIGNED:g.i.USER:null}}},32400:(e,t,i)=>{"use strict";i.d(t,{u:()=>MdsStore});var n=i(83852),s=i(86785),o=i(25799),r=i(61111);const a=new o.Z("MdsStore");class MdsStore{constructor(e={readonly:!0}){this.viewId=null;const{queue:t,baseUrl:i,viewId:n}=e;this.config=e,this.client=new s.w({queue:t,baseUrl:i}),n&&(this.viewId=n)}async create(...e){throw new n.n}async read(e={}){throw new n.n}async update(...e){throw new n.n}async delete(...e){throw new n.n}async query(e,t,i={}){if(!this.getViewId())throw new r.SN;const n=Object.assign({fetchPolicy:"cache-first",prefetchKey:this.prefetchKey},i),{fetchPolicy:s}=i;let o;if("no-cache"!==s)for(const i of MdsStore.sharedCache)if(o=await i.read(e,t,n),void 0!==o){a.debug(`Using cached response for ${n.prefetchKey}`);break}return o||this.client.query(e,t,n)}async mutate(e,t,i){const{readonly:n}=this.config;if(n)throw new r.d7;if(!this.getViewId())throw new r.SN;return this.client.mutate(e,t,i).then((e=>{if(e.errors&&e.errors.length>0)throw a.error(Object.assign({},e)),new r.w0;return e}))}getViewId(){return this.viewId||MdsStore.currentViewId||MdsStore.baseViewId}static setCurrentViewId(e){MdsStore.currentViewId=e}static setBaseViewId(e){MdsStore.baseViewId=e}static addSharedCache(e){MdsStore.sharedCache.add(e)}static removeSharedCache(e){MdsStore.sharedCache.delete(e)}}MdsStore.baseViewId=null,MdsStore.currentViewId=null,MdsStore.sharedCache=new Set},64519:(e,t,i)=>{"use strict";i.d(t,{n:()=>MpWebStore});var n=i(83852),s=i(25799),o=i(20331),r=i(26149),a=i(80034);const l=new s.Z("MpWebStore");class MpWebStore{constructor(e){const{queue:t}=e;this.queue=t||new o.gO,this.config=e}getRequestOptions(e){return{responseType:"json",auth:(0,r.PW)(e)}}getCachedResponse(e,t=a.w$.GET){if(t===a.w$.GET&&e in MpWebStore.cache)return l.info(`Loaded ${e} from cache`),MpWebStore.cache[e]}setCachedResponse(e,t){MpWebStore.cache[e]=t}async request(e,t,i={}){const{baseUrl:n}=this.config,s=Object.assign(Object.assign({},this.getRequestOptions(`${n}${t}`)),i),o=this.getCachedResponse(t,e);if(o)return o;const r=await this.queue.request(e,`${n}${t}`,s);return r&&this.setCachedResponse(t,r),r}async read(){throw new n.n}}MpWebStore.cache={}},35135:(e,t,i)=>{"use strict";i.d(t,{t:()=>PrefetchedData});class PrefetchedData{static get model(){const{model:e}=window.MP_PREFETCHED_MODELDATA||{};return e&&e.sid?e:void 0}static get hasPassword(){const{model:e}=window.MP_PREFETCHED_MODELDATA||{};return e&&e.has_public_access_password}static getQuery(e){var t;return((null===(t=window.MP_PREFETCHED_MODELDATA)||void 0===t?void 0:t.queries)||{})[e]}}},14567:(e,t,i)=>{"use strict";i.d(t,{Q:()=>StorageData});var n=i(19413),s=i(25799),o=i(17256),r=i(61111),a=i(32400);const l=new s.Z("storage-data");class StorageData extends n.V{constructor(e,t={}){super(),this.lastPublished=null,this.hasUnpublishedChanges=!1,this.publishingEnabled=!1,this.saveEnabled=!1,this.revertEnabled=!1,this.transactionState=o.g7.IDLE,this.views=[],this.unpublished=new Set,this.revertable=new Set,this.currentViewId=e,Object.assign(this,t)}setCurrentView(e){if(e===this.currentViewId)return;const t=this.getView(e);if(!t)throw new r.SN("View not found");l.debug(`Active view set to ${e} (${t.viewType})`),this.currentViewId=e,a.u.setCurrentViewId(e),this.togglePublishingFeatures(),this.commit()}getCurrentView(){return this.getView(this.currentViewId)}getCurrentViewId(){return this.currentViewId}setTransactionState(e){if(e!==this.transactionState){if(![this.transactionState,e].includes(o.g7.IDLE))throw new Error(`Cannot transition from ${this.transactionState} to ${e}`);this.transactionState=e,this.commit()}}setViews(e){this.views=e,this.togglePublishingFeatures(),this.commit()}setUnpublished(...e){for(const t of e)this.unpublished.add(t);this.hasUnpublishedChanges=this.unpublished.size>0,this.commit()}clearUnpublished(...e){if(e.length)for(const t of e)this.unpublished.delete(t);else this.unpublished.clear();this.unpublished.size||(this.hasUnpublishedChanges=!1),this.commit()}getUnpublished(){return[...this.unpublished]}getRevertable(){return[...this.revertable]}setRevertable(...e){for(const t of e)this.revertable.add(t);this.commit()}clearRevertable(...e){if(e.length)for(const t of e)this.revertable.delete(t);else this.revertable.clear();this.commit()}getView(e){return this.views.find((t=>t.id===e))}getViewByType(e){return this.views.find((t=>t.viewType===e))}togglePublishingFeatures(){const e=this.getCurrentView();e&&e.viewType===o.XZ.SESSION?(this.publishingEnabled=!0,this.revertEnabled=!0,this.saveEnabled=!0):(this.publishingEnabled=!1,this.revertEnabled=!1,this.saveEnabled=!0),this.commit()}}},43894:(e,t,i)=>{"use strict";i.d(t,{F:()=>StorageModule});var n,s=i(41263),o=i(54122),r=i(57501),a=i(86785),l=i(89155),c=i(87694),h=i(22729),d=i(77956),u=i(12775),p=i(21265),m=i(96041),g=i(25799),f=i(51770),v=i(44333),y=i(14567),b=i(61111),w=i(34170),S=i(17256);!function(e){e.IMAGE="image",e.FLOORS="floors",e.MEASUREMENT_PATHS="measurementPaths",e.MATTERTAGS="mattertags",e.LABELS="labels",e.HIGHLIGHT_REEL="highlightReel",e.SWEEPS="sweeps",e.PLAYER_OPTIONS="playerOptions"}(n||(n={}));class ModelViewDiff{constructor(e={}){Object.assign(this,e)}}const E=new g.Z("mds-mergediff-deserializer"),T={[S.g.FLOORS]:n.FLOORS,[S.g.MEASUREMENTS]:n.MEASUREMENT_PATHS,[S.g.MATTERTAGS]:n.MATTERTAGS,[S.g.LABELS]:n.LABELS,[S.g.HIGHLIGHTS]:n.HIGHLIGHT_REEL,[S.g.SWEEPS]:n.SWEEPS,[S.g.SETTINGS]:n.PLAYER_OPTIONS,[S.g.START_LOCATION]:n.IMAGE,[S.g.BLURS]:void 0},M={[n.IMAGE]:S.g.START_LOCATION,[n.FLOORS]:S.g.FLOORS,[n.MEASUREMENT_PATHS]:S.g.MEASUREMENTS,[n.MATTERTAGS]:S.g.MATTERTAGS,[n.LABELS]:S.g.LABELS,[n.HIGHLIGHT_REEL]:S.g.HIGHLIGHTS,[n.SWEEPS]:S.g.SWEEPS,[n.PLAYER_OPTIONS]:S.g.SETTINGS};class MdsMergeDiffDeserializer{deserialize(e){if(!(e&&e.src&&e.dest&&e.typesModified))return E.debug("Deserialized invalid merge diff from MDS",e),null;const t=[];for(const i of e.typesModified)i in M&&t.push(M[i]);return new ModelViewDiff({srcId:e.src,targetId:e.dest,dataTypes:t})}}class ModelView{constructor(e={}){this.viewType=null,Object.assign(this,e)}}const _=new g.Z("mds-modelview-deserializer");class MdsModelViewDeserializer{deserialize(e){return e&&e.id&&e.type?new ModelView({id:e.id,viewType:this.getModelViewType(e.type),rawViewType:e.type}):(_.debug("Deserialized invalid ModelView data from MDS",e),null)}getModelViewType(e){const t={"matterport.workshop.session":S.XZ.SESSION,"matterport.model.default":S.XZ.BASE,"trueplan.session":S.XZ.TRUEPLAN};return e in t?t[e]:null}}var x=i(32400),A=i(20540),O=i(20517),P=i(30853),C=i(9713);const D=new g.Z("PrefetchedQueryCache");class PrefetchedQueryCache{constructor(e){this.config=e,e.initialData&&(this.data=e.initialData)}async read(e,t,i={}){const{prefetchKey:n,prefetchPolicy:s=this.config.prefetchPolicy}=i;if(!n||s===S.hV.NONE)return;s!==S.hV.PRELOAD||this.preloadPromise||(this.preloadPromise=this.preload()),void 0===this.data&&this.preloadPromise&&await this.preloadPromise;const o=this.has(n);return D.debug(`Cache ${o?"hit":"miss"} for ${n}`),o?this.data:void 0}clear(){this.data=void 0}async preload(){const{query:e,variables:t,client:i}=this.config;return i.query(e,t).then((e=>{this.data=e})).catch((e=>{D.info(e),this.data={}}))}has(e){return void 0!==(0,f.qw)(this.data,e)}}var I=i(35135);const R=new g.Z("storage");class StorageModule extends o.Y{constructor(){super(...arguments),this.name="storage",this.saveHandlers=new Set,this.revertHandlers=new Set,this.publishHandlers=new Set,this.lock=new m.H}async init(e,t){const{baseUrl:i,queue:n,modelId:o,prefetchPolicy:r}=e;if(this.config=e,this.engine=t,this.client=new a.w({baseUrl:i,queue:n}),this.data=new y.Q(e.modelId),t.market.register(this,y.Q,this.data),!e.mdsEnabled){this.data.publishingEnabled=!0;const e=s.b3.globalSession;e&&e.lastPublished&&(this.data.lastPublished=e.lastPublished.getTime())}x.u.setBaseViewId(o),this.prefetchCache=new PrefetchedQueryCache({client:this.client,prefetchPolicy:r,initialData:I.t.getQuery("GetModelPrefetch"),query:A.GetModelPrefetch,variables:{modelId:o}}),x.u.addSharedCache(this.prefetchCache),this.bindings.push(t.commandBinder.addBinding(v.R_,(()=>this.publish())),t.commandBinder.addBinding(v.qz,(e=>this.revert(e.dataTypes))),t.commandBinder.addBinding(v.VQ,(e=>this.save(e.dataTypes))),t.commandBinder.addBinding(v.dS,(e=>this.setDefaultViewType(e.viewType)))),this.registerSettings()}dispose(e){super.dispose(e),x.u.removeSharedCache(this.prefetchCache)}onSave(e,t={}){const i={callback:e,dataType:t.dataType,phase:t.phase||S.Q.ON};return(0,r.k1)((()=>this.saveHandlers.add(i)),(()=>this.saveHandlers.delete(i)),!0)}onPublish(e,t={}){const i={callback:e,dataType:t.dataType,phase:t.phase||S.Q.ON};return(0,r.k1)((()=>this.publishHandlers.add(i)),(()=>this.publishHandlers.delete(i)),!0)}onRevert(e,t={}){const i={callback:e,dataType:t.dataType,phase:t.phase||S.Q.ON};return(0,r.k1)((()=>{this.revertHandlers.add(i),this.updateRevertableTypes()}),(()=>{this.revertHandlers.delete(i),this.updateRevertableTypes()}),!0)}async publish(){const{mdsEnabled:e}=this.config,t=await this.lock.lock(),i=e=>{throw R.error(e),t.unlock(),this.data.setTransactionState(S.g7.IDLE),this.engine.broadcast(new w.aT(e)),new b.X4(e.message)},{before:n,on:o,after:r}=this.getCallbacksByPhase(this.publishHandlers);if(o.push((()=>s.b3.publishAll())),e){const e=this.data.getViewByType(S.XZ.SESSION);e&&o.push((()=>this.mergeView(e.id)))}R.debug("Publishing..."),this.data.setTransactionState(S.g7.PUBLISHING),await Promise.all(n.map((e=>e()))).catch(i),await Promise.all(o.map((e=>e()))).catch(i),this.data.lastPublished=Date.now(),this.data.commit(),this.data.clearUnpublished(),await Promise.all(r.map((e=>e()))).catch(i),t.unlock(),this.data.setTransactionState(S.g7.IDLE),this.engine.broadcast(new w.zK),R.debug("Publishing completed")}async revert(e=[]){const{mdsEnabled:t}=this.config,i=await this.lock.lock(),n=t=>{throw R.error(t),i.unlock(),this.data.setTransactionState(S.g7.IDLE),this.engine.broadcast(new w.Kx(t,e)),new b.mE(t.message)},{before:s,on:o,after:r}=this.getCallbacksByPhase(this.revertHandlers,e);if(t){const t=this.data.getViewByType(S.XZ.SESSION);if(!t)return void n(new b.SN);o.push((()=>this.revertView(t.id,e)))}R.debug(`Reverting ${[...e].join(", ")}...`),this.data.setTransactionState(S.g7.REVERTING),await Promise.all(s.map((e=>e()))).catch(n),await Promise.all(o.map((e=>e()))).catch(n),await Promise.all(r.map((e=>e()))).catch(n),i.unlock(),this.data.setTransactionState(S.g7.IDLE),this.data.clearUnpublished(...e),this.engine.broadcast(new w.F1(e)),R.debug(`Reverting ${[...e].join(", ")} completed`)}async save(e){const{before:t,on:i,after:n}=this.getCallbacksByPhase(this.saveHandlers,e),s=await this.lock.lock(),o=t=>{throw R.error(t),s.unlock(),this.data.setTransactionState(S.g7.IDLE),this.engine.broadcast(new w.dz(t,e)),new b.OX(t.message)};R.debug(`Saving ${[...e].join(", ")}...`),this.data.setTransactionState(S.g7.SAVING),await Promise.all(t.map((e=>e()))).catch(o),await Promise.all(i.map((e=>e()))).catch(o),await Promise.all(n.map((e=>e()))).catch(o),this.data.publishingEnabled&&this.data.setUnpublished(...e),s.unlock(),this.data.setTransactionState(S.g7.IDLE),this.engine.broadcast(new w.xj(e)),R.debug(`Saving ${[...e].join(", ")} completed`)}getCallbacksByPhase(e,t){const i=Array.isArray(t)?t:Object.values(S.g),n=[...e.values()].filter((e=>!e.dataType||i.includes(e.dataType))),s={[S.Q.BEFORE]:[],[S.Q.ON]:[],[S.Q.AFTER]:[]};return n.reduce(((e,t)=>(e[t.phase].push((()=>t.callback(i))),e)),s)}async setDefaultViewType(e){await this.loadViews();const t=this.data.getViewByType(e),i=this.data.getCurrentView();if(t&&i&&i.viewType===S.XZ.BASE)return R.debug(`Switching to default view type '${e}'`),this.switchToView(t.id)}async switchToView(e){const t=this.data.getView(e);if(!t||e===this.data.getCurrentViewId())return;this.data.setCurrentView(t.id);const i=await this.getViewDiff(t.id);i&&i.dataTypes&&this.data.setUnpublished(...i.dataTypes)}updateRevertableTypes(){const e=new Set;for(const{dataType:t,phase:i}of this.revertHandlers)t&&i===S.Q.ON&&e.add(t);this.data.setRevertable(...e)}async loadViews(){if(!this.config.mdsEnabled)return;const{modelId:e}=this.config,t=new MdsModelViewDeserializer,i=await this.client.query(O.GetViews,{modelId:e}),n=(0,f.qw)(i,"data.model.views"),s=[];if(n)for(const e of n){const i=t.deserialize(e);i&&s.push(i)}this.data.setViews(s)}async getViewDiff(e){if(!this.config.mdsEnabled)return null;const t=new MdsMergeDiffDeserializer,i=await this.client.query(O.GetMergeDiff,{viewId:e}),n=(0,f.qw)(i,"data.model.mergeDiff");return t.deserialize(n)}async revertView(e,t=[]){const i=t.map((e=>T[e])).filter((e=>!!e)),n=await this.client.query(O.RevertView,{viewId:e,mergeTypes:i});if(n&&n.errors)throw new Error("Failed to revert view")}async mergeView(e){const t=await this.client.query(O.PublishView,{viewId:e});if(t&&t.errors)throw new Error("Failed to merge layers")}async reloadWorkshop(e={}){const{market:t}=this.engine,{useCurrentLocation:i=!1}=e;let n={};if(i){const[e,i,s,o]=await Promise.all([t.waitForData(d.Z),t.waitForData(u.O),t.waitForData(h.c),t.waitForData(l.M_)]);n=c.K.serialize({cameraData:o,viewmodeData:i,floorsViewData:s,sweepData:e})}n.edit="1",n.qs="1",p.Vf(n)}async registerSettings(){const{mdsEnabled:e}=this.config;(await this.engine.getModule(P.default)).registerSetting("Storage",C.$,e,!1)}}},26856:(e,t,i)=>{"use strict";i.d(t,{T:()=>StorageAnalytics});class StorageAnalytics{constructor(){this.handlers=[]}}},44333:(e,t,i)=>{"use strict";i.d(t,{R_:()=>PublishCommand,qz:()=>RevertCommand,VQ:()=>SaveCommand,dS:()=>SetDefaultViewTypeCommand});var n=i(99681);class PublishCommand extends n.m{constructor(){super(...arguments),this.id="PUBLISH_COMMAND"}}class RevertCommand extends n.m{constructor(e){super(),this.id="REVERT_COMMAND",this.payload=e}}class SaveCommand extends n.m{constructor(e){super(),this.id="SAVE_COMMAND",this.payload=e}}class SetDefaultViewTypeCommand extends n.m{constructor(e){super(),this.id="SET_DEFAULT_VIEW_TYPE_COMMAND",this.payload=e}}},17256:(e,t,i)=>{"use strict";var n,s,o,r,a,l;i.d(t,{g7:()=>n,Q:()=>s,g:()=>o,XZ:()=>r,Xq:()=>a,hV:()=>l}),function(e){e.IDLE="idle",e.REVERTING="reverting",e.PUBLISHING="publishing",e.SAVING="saving"}(n||(n={})),function(e){e.ON="on",e.BEFORE="before",e.AFTER="after"}(s||(s={})),function(e){e.FLOORS="floors",e.HIGHLIGHTS="highlights",e.LABELS="labels",e.MATTERTAGS="mattertags",e.MEASUREMENTS="measurements",e.SETTINGS="settings",e.START_LOCATION="startlocation",e.SWEEPS="sweeps",e.BLURS="blurs"}(o||(o={})),function(e){e.BASE="base",e.TRUEPLAN="trueplan",e.SESSION="session"}(r||(r={})),function(e){e.MDS="mds",e.JSONSTORE="jsonstore"}(a||(a={})),function(e){e.CACHE="cache",e.PRELOAD="preload",e.NONE="none"}(l||(l={}))},61111:(e,t,i)=>{"use strict";i.d(t,{X4:()=>PublishException,mE:()=>RevertException,OX:()=>SaveException,d7:()=>ReadOnlyException,SN:()=>InvalidViewError,Zb:()=>MdsReadError,w0:()=>MdsWriteError});var n=i(17617);class PublishException extends n.y{constructor(e){super(e||"Failed to publish changes"),this.name="Publish"}}class RevertException extends n.y{constructor(e){super(e||"Failed to revert unpublished changes"),this.name="Revert"}}class SaveException extends n.y{constructor(e){super(e||"Failed to save changes"),this.name="Save"}}class ReadOnlyException extends n.y{constructor(e){super(e||"Store is currently in read-only mode"),this.name="ReadOnly"}}class InvalidViewError extends n.y{constructor(e){super(e||"Invalid view"),this.name="InvalidView"}}class MdsReadError extends n.y{constructor(e){super(e||"Could not read from MDS storage"),this.name="MdsRead"}}class MdsWriteError extends n.y{constructor(e){super(e||"Could not write to MDS storage"),this.name="MdsWrite"}}},52721:(e,t,i)=>{"use strict";i.r(t),i.d(t,{PublishCommand:()=>n.R_,RevertCommand:()=>n.qz,SaveCommand:()=>n.VQ,SetDefaultViewTypeCommand:()=>n.dS,DataType:()=>s.g,ModelViewType:()=>s.XZ,PrefetchPolicy:()=>s.hV,StorageProvider:()=>s.Xq,TransactionPhase:()=>s.Q,TransactionState:()=>s.g7,InvalidViewError:()=>o.SN,MdsReadError:()=>o.Zb,MdsWriteError:()=>o.w0,PublishException:()=>o.X4,ReadOnlyException:()=>o.d7,RevertException:()=>o.mE,SaveException:()=>o.OX,DataPublishedMessage:()=>r.zK,DataRevertedMessage:()=>r.F1,DataSavedMessage:()=>r.xj,PublishErrorMessage:()=>r.aT,RevertErrorMessage:()=>r.Kx,SaveErrorMessage:()=>r.dz,StorageAnalytics:()=>a.T,SETTING_MDS_ENABLED:()=>l.$,StorageData:()=>c.Q,MdsStore:()=>h.u,default:()=>d.F});var n=i(44333),s=i(17256),o=i(61111),r=i(34170),a=i(26856),l=i(9713),c=i(14567),h=i(32400),d=i(43894)},34170:(e,t,i)=>{"use strict";i.d(t,{xj:()=>DataSavedMessage,zK:()=>DataPublishedMessage,F1:()=>DataRevertedMessage,dz:()=>SaveErrorMessage,Kx:()=>RevertErrorMessage,aT:()=>PublishErrorMessage});var n=i(93528);class DataSavedMessage extends n.v{constructor(e){super(),this.dataTypes=e}}class DataPublishedMessage extends n.v{}class DataRevertedMessage extends n.v{constructor(e){super(),this.dataTypes=e}}class SaveErrorMessage extends n.v{constructor(e,t=[]){super(),this.error=e,this.dataTypes=t}}class RevertErrorMessage extends n.v{constructor(e,t=[]){super(),this.error=e,this.dataTypes=t}}class PublishErrorMessage extends n.v{constructor(e,t=[]){super(),this.error=e,this.dataTypes=t}}},9713:(e,t,i)=>{"use strict";i.d(t,{$:()=>n});const n="storage/mds_enabled"},80034:(e,t,i)=>{"use strict";i.d(t,{w$:()=>n,gh:()=>ReadOnlyStore,yh:()=>Store,MU:()=>JsonStoreStore});var n,s=i(26149),o=i(62367),r=i(1143);!function(e){e.GET="GET",e.POST="POST",e.PATCH="PATCH",e.PUT="PUT",e.DELETE="DELETE",e.OPTIONS="OPTIONS"}(n||(n={}));class ReadOnlyStore extends class Auth{constructor(){this._options={responseType:"json"}}get options(){const e=this._options;return e.auth=(0,s.PW)(this.url),(0,r.iF)(e),e}}{constructor(e){super(),this.config=e,this.url=e.path}async read(){const{deserialize:e}=this.config;let t=null;return this.config.cachedData&&this.config.cachedData.data?t=this.config.cachedData.data:(t=await this.config.queue.get(this.config.path,this.options),this.config.cachedData&&(this.config.cachedData.data=t)),e(t)}clearCache(){this.config.cachedData&&(this.config.cachedData.data=null)}}class Store extends ReadOnlyStore{constructor(e){super(e),this.config=e}async create(e){this.clearCache();const{serialize:t}=this.config,i=t(e),n=Object.assign(Object.assign({},this.options),{body:i});return this.config.queue.put(this.config.path,n)}async update(e,t){this.clearCache();const{serialize:i}=this.config,s=i(e,t),o=Object.assign(Object.assign({},this.options),{body:s});return this.config.queue.request(this.config.httpMethod||n.POST,this.config.path,o)}async delete(e){if(this.clearCache(),!(e instanceof Array))return this.config.queue.delete(this.config.path,this.options);for(const t of e)await this.config.queue.delete(`${this.config.path}/${t.sid}`,this.options)}get acceptsPartial(){return this.config.httpMethod===n.PATCH}}class JsonStoreStore extends ReadOnlyStore{constructor(e){super(e),this.config=e,this.acceptsPartial=!1,this.config.batchUpdate="batchUpdate"in this.config&&this.config.batchUpdate}async create(e){throw Error("Not implemented")}updateBatch(e,t){const{serialize:i}=this.config,s=[],o=[...new Set([...Object.keys(e),...Object.keys(t)])];for(const i of o){e[i]||t[i]||s.push(this.config.queue.delete(`${this.config.path}/${i}`,this.options))}const r=i(e,t),a=Object.assign(Object.assign({},this.options),{body:r});return s.push(this.config.queue.request(this.config.httpMethod||n.POST,this.config.path,a)),Promise.all(s)}updateInternal(e,t){const{serialize:i}=this.config,s=[],r=Object.assign({},this.options),a=Object.keys(e),l=Object.keys(t),c=(0,o.XN)(a.concat(l));for(const o in c){const a=c[o],l=e[a]||t[a];if(l){const e={};e[a]=l;const o={},c=t[a];c&&(o[a]=c);const h=i(e,o);r.body=h,s.push(this.config.queue.request(this.config.httpMethod||n.POST,this.config.path,r))}else s.push(this.config.queue.delete(`${this.config.path}/${a}`,this.options))}return Promise.all(s)}async update(e,t){this.clearCache(),await(this.config.batchUpdate?this.updateBatch(e,t||{}):this.updateInternal(e,t||{}))}async delete(e){throw Error("Not implemented")}}},47678:(e,t,i)=>{"use strict";i.d(t,{Z:()=>BeginMoveToSweepMessage});var n=i(46101);class BeginMoveToSweepMessage extends n.Z{}},56022:(e,t,i)=>{"use strict";i.d(t,{Z:()=>EndMoveToSweepMessage});var n=i(46101);class EndMoveToSweepMessage extends n.Z{constructor(e,t,i,n){super(e,n),this.alignmentType=t,this.placementType=i}}},46101:(e,t,i)=>{"use strict";i.d(t,{Z:()=>MoveToSweepMessage});var n=i(93528);class MoveToSweepMessage extends n.v{constructor(e,t){super(),this.fromSweep=t,this.toSweep=e,this.timestamp=Date.now()}}},57369:(e,t,i)=>{"use strict";i.d(t,{z9:()=>n,hU:()=>s,ZP:()=>Sweep});var n,s,o=i(2212),r=i(78909),a=i(87131);!function(e){e.ALIGNED="aligned",e.UNALIGNED="unaligned"}(n||(n={})),function(e){e.UNPLACED="unplaced",e.AUTO="auto",e.MANUAL="manual"}(s||(s={}));const l={[a.SL.BASE]:"512",[a.SL.STANDARD]:"1k",[a.SL.HIGH]:"2k",[a.SL.ULTRAHIGH]:"4k"},c={[a.SL.BASE]:"low",[a.SL.STANDARD]:"high",[a.SL.HIGH]:"2k",[a.SL.ULTRAHIGH]:"4k"};class Sweep extends r.T{constructor(e){super(),this.skyboxes={},e&&(e.id&&(this.id=e.id),void 0!==e.index&&(this.index=e.index),this.name=e.name||"",this.position=e.position||new o.Vector3,this.floorPosition=e.floorPosition||new o.Vector3,void 0!==e.floorId&&(this.floorId=e.floorId),this.roomId=e.roomId||null,this.rotation=e.rotation||new o.Quaternion,this.enabled=e.enabled||!1,this.vrenabled=e.vrenabled||!1,this.neighbours=e.neighbours||[],this.alignmentType=e.alignmentType||n.ALIGNED,this.placementType=e.placementType||s.UNPLACED,void 0!==e.uuid&&(this.uuid=e.uuid))}isAligned(){return this.alignmentType===n.ALIGNED}equals(e){return this.id===e.id&&this.index===e.index&&this.name===e.name&&this.position.equals(e.position)&&this.floorId===e.floorId&&this.roomId===e.roomId&&this.rotation.equals(e.rotation)&&this.enabled===e.enabled&&this.vrenabled===e.vrenabled&&this.alignmentType===e.alignmentType&&this.placementType===e.placementType}copy(e){return this.id=e.id,this.index=e.index,this.name=e.name,this.position=(new o.Vector3).copy(e.position),this.floorPosition=(new o.Vector3).copy(e.floorPosition),this.floorId=e.floorId,this.roomId=e.roomId,this.rotation=(new o.Quaternion).copy(e.rotation),this.enabled=e.enabled,this.vrenabled=e.vrenabled,this.neighbours=e.neighbours.slice(),this.alignmentType=e.alignmentType,this.placementType=e.placementType,this.resolutions=e.resolutions,this.skyboxes=Object.assign({},e.skyboxes),this}refresh(e){this.resolutions=e.resolutions;for(const t in this.skyboxes){const i=t;this.skyboxes[i].refreshFrom(e.skyboxes[i])}}async getTileUrl(e,t,i,n){const s=await this.getSkybox(e);let o;return o=s?s.tileUrlTemplate:`tiles/${this.id}/${l[e]}_face<face>_<x>_<y>.jpg`,o.replace("<face>",`${t}`).replace("<x>",`${i}`).replace("<y>",`${n}`)}async getFaceUrl(e,t){const i=await this.getSkybox(e);let n;return n=i?i.urlTemplate:`pan/${c[e]}/${this.id}_skybox${t}.jpg`,n.replace("<face>",`${t}`)}async getSkybox(e){const t=this.skyboxes[e];return t?t.get():t}}},85995:(e,t,i)=>{"use strict";i.d(t,{NO:()=>ClearCurrentSweepCommand,aK:()=>SetCurrentSweepCommand,iF:()=>SweepSelectCommand,kR:()=>SweepHoverCommand,e9:()=>ToggleNonPanoCurrentPuckCommand,zd:()=>EnableSweepSelectionCommand,ZD:()=>DisableSweepSelectionCommand});var n=i(99681);class ClearCurrentSweepCommand extends n.m{}class SetCurrentSweepCommand extends n.m{constructor(e){super(),this.sweepId=e,this.payload={sweepId:e}}}class SweepSelectCommand extends n.m{constructor(e,t,i=500){super(),this.id="SELECT_SWEEP",this.payload={id:e,selected:t,duration:i}}}class SweepHoverCommand extends n.m{constructor(e,t,i=500){super(),this.id="HOVER_SWEEP",this.payload={id:e,hovered:t,duration:i}}}class ToggleNonPanoCurrentPuckCommand extends n.m{constructor(e){super(),this.id="TOGGLE_NON_PANO_CURRENT_PUCK",this.payload={visible:e}}}class EnableSweepSelectionCommand extends n.m{constructor(){super(...arguments),this.id="ENABLE_SWEEP_SELECTION"}}class DisableSweepSelectionCommand extends n.m{constructor(){super(...arguments),this.id="DISABLE_SWEEP_SELECTION"}}},77956:(e,t,i)=>{"use strict";i.d(t,{Z:()=>SweepData});var n=i(57369),s=i(19413),o=i(90134),r=i(71229),a=i(290);class SweepData extends s.V{constructor(e){if(super(),this.name="sweeps",this.transitionActive=!1,this.sweepList=new o.d,this.sweepMap={},e){const t=Object.values(e).sort(((e,t)=>e.index-t.index));for(const e of t)this.sweepMap[e.id]=e,this.sweepList.push(e)}this.transition={progress:new a.z(0),active:!1,from:void 0,to:void 0}}refresh(e){for(const t in this.sweepMap)e[t]&&this.sweepMap[t].refresh(e[t])}canTransition(){return!this.transition.active}get currentSweepIndex(){if(this.currentSweep)return this.sweepMap[this.currentSweep].index}get currentSweepObject(){if(this.currentSweep)return this.getSweep(this.currentSweep)}get currentAlignedSweepObject(){if(this.currentSweep&&!this.isSweepUnaligned(this.currentSweep))return this.getSweep(this.currentSweep)}makeSweepChangeSubscription(e){return this.onPropertyChanged("currentSweep",e)}copy(e){let t=!1;if(this.sweepList.length===e.sweepList.length){t=!0;for(let i=0;i<this.sweepList.length;i++){const n=this.sweepList.get(i),s=e.sweepList.get(i);if(n.id!==s.id){t=!1;break}}}t||(this.sweepMap={},this.sweepList.length=0,e.sweepList.forEach((e=>{this.addSweep(e)}))),this.currentSweep=e.currentSweep,this.transition.progress.copy(e.transition.progress),this.transition.active=e.transition.active,this.transition.to=e.transition.to,this.transition.from=e.transition.from,this.transitionActive=e.transitionActive,this.commit()}clone(){const e=new SweepData;return e.copy(this),e}addSweep(e){this.containsSweep(e.id)||(this.sweepList.push(e),this.sweepMap[e.id]=e)}getSweep(e){return this.sweepMap[e]}getSweepByIndex(e){return this.sweepList.find((t=>t.index===e))}getSweepByUuid(e){return this.sweepList.find((t=>t.uuid===e))}containsSweep(e){return e in this.sweepMap}getFirstSweep(){let e=-1;for(;++e<this.sweepList.length;){const t=this.sweepList.get(e);if(t.enabled)return t}throw new Error("First enabled sweep not found")}getStartSweep(e){const t=e&&e.pano&&e.pano.uuid?this.getSweep(e.pano.uuid):null;return t&&t.enabled?t:this.getFirstSweep()}getClosestSweep(e,t){let i=Number.MAX_VALUE,s=null;return this.iterate((o=>{if(o.enabled&&(!t||o.alignmentType===n.z9.ALIGNED)){const t=e.distanceTo(o.position);t<i&&(i=t,s=o)}})),s}getFirstAlignedSweep(){let e=-1;for(;++e<this.sweepList.length;){const t=this.sweepList.get(e);if(t.enabled&&t.alignmentType===n.z9.ALIGNED)return t}return null}activateTransition(e,t){this.transition.active=!0,this.transition.from=t,this.transition.to=e,this.transitionActive=!0}deactivateTransition(){this.transition.active=!1,this.transition.from=void 0,this.transition.to=void 0,this.transitionActive=!1}isSweepUnaligned(e){if(!e)return!1;const t=this.getSweep(e);return t&&!t.isAligned()}isSweepAligned(e){const t=this.getSweep(e);return t&&t.isAligned()}isSweepDisabled(e=this.currentSweep){if(!e)return!1;const t=this.getSweep(e);return t&&!t.enabled}*sweeps(){for(const e of this.sweepList)yield e}iterate(e){this.sweepList.forEach(((t,i)=>{e(t,i)}))}filter(e){return this.sweepList.filter(e)}sortByScore(e,t,i){return(i||this.sweepList).filter((t=>e.every((e=>e(t))))).map((e=>({sweep:e,score:t.reduce(((t,i)=>t+i(e)),0)}))).sort(((e,t)=>t.score-e.score))}getSweepList(){return this.sweepList.values()}getSweepNeighbours(e){const t=[];for(const i of e.neighbours)t.push(this.getSweep(i));return t}getCollection(){return(0,r.q)(this.sweepMap)}getConnectedSweeps(e,t){const i=[e],n=new Set;for(t=t||(e=>!0);i.length;){const e=i.pop(),s=this.getSweep(e);n.add(e);for(const e of s.neighbours){t(this.getSweep(e))&&!n.has(e)&&i.push(e)}}return n}equals(e){if(this.sweepMap.length!==e.sweepMap.length||this.currentSweep!==e.currentSweep||this.transition.active!==e.transition.active||this.transition.from!==e.transition.from||this.transition.to!==e.transition.to)return!1;for(const t in this.sweepMap){if(!e.containsSweep(t))return!1;if(!this.sweepMap[t].equals(e.getSweep(t)))return!1}return!0}}},17321:(e,t,i)=>{"use strict";i.d(t,{ff:()=>r,vO:()=>a,T3:()=>l,H7:()=>c,_T:()=>h,WO:()=>d,b1:()=>u,nK:()=>p,pI:()=>m,_k:()=>g,D5:()=>f,SF:()=>v,jN:()=>y});var n=i(57369),s=i(2212);const o=.25,r=e=>t=>t!==e,a=e=>t=>!!e.neighbours&&-1!==e.neighbours.indexOf(t.id),l=e=>t=>e===t||a(e)(t),c=e=>e.placementType===n.hU.MANUAL,h=()=>e=>e.alignmentType===n.z9.ALIGNED,d=()=>e=>e.alignmentType!==n.z9.ALIGNED,u=e=>t=>e.floorId===t.floorId,p=e=>t=>e===t.floorId,m=(()=>{const e=new s.Vector3;return(t,i,n=o)=>s=>e.copy(s.position).sub(t).normalize().dot(i)>n})(),g=()=>e=>e.enabled,f=(e,t)=>{const i=new s.Vector3;return t=t.clone(),n=>i.copy(n.position).sub(e).normalize().dot(t)>0},v=(e,t)=>i=>e.distanceTo(i.position)<t,y=(e,t)=>i=>e.distanceToSquared(i.position)<t},94210:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>SweepDataModule});var n=i(54122),s=i(77956),o=i(47924),r=i(89895),a=i(64279),l=i(56022),c=i(47678),h=i(44266),d=i(1799),u=i(85381),p=i(89155),m=i(25799),g=i(83032),f=i(46101),v=i(85995),y=i(80034),b=i(41263),w=i(7943),S=i(15119),E=i(97620),T=i(57369),M=i(46162),_=i(62367),x=i(40032);const A=new m.Z("sweeps");function O(e=!0){function t(t,i,n,s,o){const r=t[i];if(void 0!==r)n[s]=o?o(r):r;else if(e)throw Error(`Required property missing in data: ${i}`)}return function(e){if(!e||Object.keys(e).length<1)return null;const i={};try{const n=[];for(const i of e){const e=new T.ZP;if(t(i,"index",e,"index"),n[e.index])throw Error("Duplicate sweep index found");n[e.index]=e,t(i,"sweep_uuid",n[e.index],"id",(e=>e.replace(/-/g,"")))}for(const s of e){const e=n[s.index];t(s,"neighbors",e,"neighbours",(e=>e.map((e=>n[e]?n[e].id:void 0)).filter((e=>void 0!==e)))),t(s,"alignment_type",e,"alignmentType",(e=>"string"==typeof e&&T.z9.hasOwnProperty(e.toUpperCase())?e:T.z9.UNALIGNED)),t(s,"placement",e,"placementType",(t=>{if(e.alignmentType===T.z9.ALIGNED)return T.hU.AUTO;return"string"==typeof s.placement&&T.hU.hasOwnProperty(s.placement.toUpperCase())?s.placement:T.hU.UNPLACED})),t(s,"rotation",e,"rotation",(e=>E.ep.fromVisionQuaternion(e))),t(s,"position",e,"position",(e=>E.ep.fromVisionVector(e))),t(s,"floor_position",e,"floorPosition",(e=>E.ep.fromVisionVector(e))),t(s,"sweep_name",e,"name"),t(s,"floor_index",e,"floorId",(e=>"number"==typeof e&&e>-1?String(e):null)),t(s,"room_index",e,"roomId",(e=>"number"==typeof e&&e>-1?String(e):null)),t(s,"tags",e,"enabled",(e=>-1!==e.indexOf("showcase"))),t(s,"tags",e,"vrenabled",(e=>-1!==e.indexOf("vr"))),e.uuid=e.id,i[e.id]=e}}catch(e){A.error("Error reading sweeps list",e)}return 0===Object.keys(i).length?null:i}}const P=(e,t)=>{const i=[];if(!t)throw Error("SweepsV2 must serialize via diffs");function n(e,t,i){return function(n,s,o){if((0,_.nr)(t,n)){let r;null!==t[n]&&"object"==typeof t[n]?(r={},(0,M.TS)(r,e[n]),"rotation"===n&&(r=(0,x.J5)(r))):r=e[n],i[s]=o?o(r):r}}}for(const s in t){const o=e[s],r=t[s],a={},l=n(o,r,a);l("placementType","placement"),r.placementType!==T.hU.UNPLACED&&(l("position","position",(e=>E.ep.toVisionVector(e))),l("rotation","rotation",(e=>(0,x.J5)(E.ep.toVisionQuaternion(e))))),((0,_.nr)(r,"enabled")||(0,_.nr)(r,"vrenabled"))&&(a.tags=[],(void 0!==r.enabled?r.enabled:o.enabled)&&(a.tags.push("showcase"),(void 0!==r.vrenabled?r.vrenabled:o.vrenabled)&&a.tags.push("vr"))),l("name","sweep_name"),l("floorId","floor_index",(e=>{if(!e)return-1;const t=parseInt(e||"",10);if(isNaN(t))throw new Error(`Failed to serialize unsupported floor ID '${e}'`);return t})),Object.keys(a).length>0&&(a.index=o.index,a.sweep_uuid=o.id,i.push(a))}return 0===i.length?null:i};var C=i(20331);var D=i(71439),I=i(36690),R=i(32400);const L=new m.Z("mds-sweep-serializer");class MdsAnchorLocationUpdateSerializer{serialize(e){const t={};return void 0===e.enabled&&void 0===e.vrenabled||(t.tags=[],e.enabled&&t.tags.push("showcase"),e.vrenabled&&t.tags.push("vr")),this.validate(t)?t:null}validate(e){if(!e)return!1;const t=["tags"],i=t.some((t=>t in e)),n=0===Object.keys(e).filter((e=>!t.includes(e))).length,s=void 0===e.tags||Array.isArray(e.tags),o=s&&i&&n;return o||L.debug("Invalid AnchorPatch:",{tagsIsArrayIfPresent:s,hasSomeChanges:i,hasNoExtraChanges:n,mutableFields:t,data:e}),o}}var N,k=i(99555);!function(e){e.VISION="vision",e.UPLOAD="upload"}(N||(N={}));var B=i(87131),F=i(32020),U=i(68519),V=i(60982);const H=new m.Z("mds-sweep-serializer"),G={[k.b.AUTO]:T.hU.AUTO,[k.b.MANUAL]:T.hU.MANUAL,[k.b.UNPLACED]:T.hU.UNPLACED},z={[N.VISION]:T.z9.ALIGNED,[N.UPLOAD]:T.z9.UNALIGNED};class MdsSweepDeserializer{deserialize(e){var t,i;if(!e||!this.validate(e))return H.debug("Deserialized invalid Sweep data from MDS",e),null;const n=e,s=new T.ZP;s.id=n.id,s.index=n.index,s.enabled=n.tags.includes("showcase"),s.vrenabled=n.tags.includes("vr"),s.neighbours=n.neighbors||[],n.position&&(s.floorPosition=E.ep.fromVisionVector(n.position)),s.floorId=(null===(t=n.floor)||void 0===t?void 0:t.id)||null,s.roomId=(null===(i=n.room)||void 0===i?void 0:i.id)||null;const o=n.pano;s.name=o.label||"",s.alignmentType=z[o.source],s.uuid=o.sweepUuid||"",s.alignmentType===T.z9.ALIGNED?s.placementType=T.hU.AUTO:s.placementType=G[o.placement],o.position&&(s.position=E.ep.fromVisionVector(o.position)),s.resolutions=[];const r=o.skyboxes||[];if(o.resolutions)for(const e of o.resolutions){const t=this.getPanoSizeClass(e),i=r.find((t=>t.resolution===e));t&&i?(s.resolutions.push(t),s.skyboxes[t]=this.makeSkybox(i)):H.debug(`Invalid pano size class ${e}`)}return o.rotation&&(s.rotation=E.ep.fromVisionQuaternion(o.rotation)),s.floorId||(s.alignmentType===T.z9.ALIGNED?H.warn(`Aligned sweep ${s.index} has no floor association`):s.placementType===T.hU.MANUAL&&H.debug(`Manually placed sweep ${s.index} has no floor association`)),s.roomId||s.alignmentType===T.z9.ALIGNED&&H.warn(`Aligned sweep ${s.index} has no room association`),s}validate(e){if(!e)return!1;const t=[],i=["id","index","tags"];if(t.push((()=>i.every((t=>t in e)))),t.push((()=>"number"==typeof e.index)),t.push((()=>!!e.position&&(0,V.uU)(e.position))),t.push((()=>"pano"in e&&!!e.pano)),e.pano){const{placement:i,source:n,position:s}=e.pano;t.push((()=>!!i&&i in G)),t.push((()=>!!n&&n in z)),t.push((()=>!!s&&(0,V.uU)(s)))}return t.every((e=>e()))}getPanoSizeClass(e){const t={low:B.SL.BASE,high:B.SL.STANDARD,"2k":B.SL.HIGH,"4k":B.SL.ULTRAHIGH};return e in t?t[e]:void 0}makeSkybox(e){return new U.n({tileUrlTemplate:e.tileUrlTemplate,tileResolution:parseInt(e.tileResolution,10),tileCount:e.tileCount,urlTemplate:e.urlTemplate},(0,F.p)(e.validUntil,null))}}const j=new m.Z("mds-sweep-serializer");class MdsSweepPanoUpdateSerializer{serialize(e){const t={};return e.rotation&&(t.rotation=(0,x.J5)(E.ep.toVisionQuaternion(e.rotation))),e.position&&(t.position=(0,x.m)(E.ep.toVisionVector(e.position))),e.placementType&&e.placementType===T.hU.UNPLACED&&(t.resetPlacement=!0),"roomId"in e&&(e.roomId?t.roomId=e.roomId:t.resetRoom=!0),"floorId"in e&&(e.floorId?t.floorId=e.floorId:t.resetFloor=!0),"name"in e&&(t.label=e.name||""),this.validate(t)?t:null}validate(e){if(!e)return!1;const t=["resetPlacement","resetFloor","resetRoom","rotation","position","floorId","roomId","label"],i=t.some((t=>t in e)),n=0===Object.keys(e).filter((e=>!t.includes(e))).length,s=i&&n;return s||j.debug("Invalid PanoramaLocation:",{hasSomeChanges:i,hasNoExtraChanges:n,mutableFields:t,data:e}),s}}const W=new m.Z("mds-sweep-store");class MdsSweepStore extends R.u{constructor(){super(...arguments),this.deserializer=new MdsSweepDeserializer,this.panoSerializer=new MdsSweepPanoUpdateSerializer,this.anchorSerializer=new MdsAnchorLocationUpdateSerializer,this.prefetchKey="data.model.locations"}async read(e={}){const{readonly:t}=this.config,i={modelId:this.getViewId()},n=t?I.GetShowcaseSweeps:I.GetSweeps;return this.query(n,i,e).then((e=>{var t,i;const n=null===(i=null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.model)||void 0===i?void 0:i.locations;if(!n||!Array.isArray(n))return null;const s={};for(const e of n){const t=this.deserializer.deserialize(e);t&&(s[t.id]=t)}return s}))}async refresh(){return this.refreshPromise||(this.refreshPromise=this.read({fetchPolicy:"no-cache"}).finally((()=>{this.refreshPromise=void 0}))),this.refreshPromise}async update(e){const t=this.getViewId();return Promise.all(e.map((i=>{const n=this.panoSerializer.serialize(i),s=this.anchorSerializer.serialize(i);if(!n&&!s)throw W.error("No changes to update:",i,e),new Error("MdsSweepStore.update failed");const o=""+(n?", $pano: PanoramicImageLocationPatch!":""),r=` ${s?", $anchor: AnchorPatch!":""} `,a=D.Ps`
        mutation sweep($modelId: ID!, $sweepId: ID! ${o} ${r}) {
        ${n?"\n          patchPanoLocation(modelId: $modelId, , locationId: $sweepId, patch: $pano) {\n            id\n            placement\n          }":""}
        ${s?"\n          patchAnchor(modelId: $modelId, , anchorId: $sweepId, patch: $anchor) {\n            id\n            tags\n          }":""}
      }`;return this.mutate(a,{modelId:t,sweepId:i.id,pano:n,anchor:s}).then((e=>{if(W.debug(Object.assign({},e)),e.errors&&e.errors.length>0)throw W.error(Object.assign({},e)),new Error("MdsSweepStore.update failed")}))})))}}var Z=i(83083),q=i(60841),K=i(64614),Y=i(43894),$=i(44333),X=i(17256),Q=i(17617);class SweepTransitionError extends Q.y{constructor(e="Failed to transition to sweep"){super(e),this.name="SweepTransition"}}class InvalidSweepError extends Q.y{constructor(e="Invalid Sweep"){super(e),this.name="InvalidSweep"}}const J=new m.Z("sweep-module");class SweepDataModule extends n.Y{constructor(){super(...arguments),this.name="sweep-data",this.internalProgress=!1,this.defaultEasing=d.qb,this.moveToSweep=e=>{const t=new h.Q;return e.prevSweepId=e.prevSweepId||this.sweepData.currentSweep,this.activateSweep(e).then((()=>(this.beginSweepTransition(e),this.defaultSweepCameraMove(t,e)))).then((()=>{this.endSweepTransition(e),t.resolve()})).catch((i=>{J.debug(`Failure moving to sweep ${e.sweepId}`,i),t.reject(i)})),t.promise()},this.activateSweep=async e=>{if(!this.sweepData.canTransition()||!this.cameraData.canTransition())throw new SweepTransitionError("Tried to start transition while another transition was active");if(!this.sweepData.containsSweep(e.sweepId))throw new InvalidSweepError(`Invalid sweep ${e.sweepId}`);return this.activateSweepUnsafe(e)},this.activateSweepUnsafe=async e=>{this.sweepPanoModule||(this.sweepPanoModule=await this.engine.getModule(u.Z));return this.sweepPanoModule.getRenderer().activateSweep(e.sweepId)},this.instantSweepTransition=e=>{const t=this.sweepData.currentSweep;this.beginSweepTransition({sweepId:e,transitionTime:0,internalProgress:!0,prevSweepId:t}),this.sweepData.currentSweep=e,this.sweepData.commit(),this.engine.broadcast(new f.Z(e,t)),this.endSweepTransition({sweepId:e,prevSweepId:t})},this.beginSweepTransition=e=>{this.sweepData.activateTransition(e.sweepId,e.prevSweepId||this.sweepData.currentSweep),this.internalProgress=e.internalProgress||!1,this.sweepData.transition.progress.modifyAnimation(0,1,e.transitionTime||0,e.easing||this.defaultEasing),this.sweepData.commit(),this.engine.broadcast(new c.Z(e.sweepId,e.prevSweepId))},this.endSweepTransition=e=>{const t=this.sweepData.getSweep(e.sweepId);this.sweepData.deactivateTransition(),this.sweepData.currentSweep=e.sweepId,this.sweepData.transition.progress.stop(1),this.internalProgress=!1,this.sweepData.commit(),this.engine.broadcast(new l.Z(e.sweepId,t.alignmentType,t.placementType,e.prevSweepId))},this.defaultSweepCameraMove=async(e,t)=>{const i={position:this.sweepData.getSweep(t.sweepId).position,rotation:t.rotation},n=(0,a.AN)(this.cameraData.aspect());let s=o.n.Interpolate;void 0!==t.transitionType&&o.n[t.transitionType]&&(s=t.transitionType);const r=this.cameraModule.moveTo({transitionType:s,pose:i,transitionTime:t.transitionTime,transitionSpeedMultiplier:t.transitionSpeedMultiplier,projection:n,easing:t.easing,rotationDelay:t.rotationDelay});let l=!1;return r.progress((i=>{this.sweepData.transition.progress.updateProgress(i),e.notify(i),i>=.5&&!l&&(l=!0,this.sweepData.currentSweep=t.sweepId,this.sweepData.commit(),this.engine.broadcast(new f.Z(t.sweepId,t.prevSweepId)))})),r.nativePromise()},this.tryInferFloorIds=e=>{for(const t of Object.values(e))if(t.isAligned()&&null===t.floorId){J.warn(`Aligned sweep ${t.index} has no floor association`);const i=t.neighbours.map((i=>({id:i,floorId:e[i].floorId,distance:e[i].floorPosition.distanceToSquared(t.floorPosition)})));i.sort(((e,t)=>e.distance-t.distance));const n=i.find((e=>e.floorId));n&&(J.debug(`Inferred Sweep ${t.index} floor as ${n.floorId} from neighbors`),t.floorId=n.floorId)}}}async init(e,t){const{readonly:i}=e;this.engine=t,this.market=this.engine.market,this.store=this.getStore(e);const n=await this.store.read()||{};[this.filterSweepData,this.tryInferFloorIds].forEach((e=>e(n))),(0,U.s)(n,(async()=>{if(this.store.refresh){const e=await this.store.refresh();this.sweepData.refresh(e||{})}else J.debug("Can't refresh sweep URLs - operation not supported")})),this.sweepData=new s.Z(n),this.market.register(this,s.Z,this.sweepData);const o=await t.getModule(Y.F);!1===i&&(this.monitor=new Z.c(this.sweepData.getCollection(),{aggregationType:q.E.NextFrame,shallow:!0},t),this.monitor.onChanged((()=>this.engine.commandBinder.issueCommand(new $.VQ({dataTypes:[X.g.SWEEPS]})))),this.store instanceof g.N&&this.store.addMonitor(this.monitor)),this.cameraModule=await this.engine.getModule(r.default),this.cameraData=await t.market.waitForData(p.M_),this.bindings.push(t.commandBinder.addBinding(v.NO,(async()=>{this.sweepData.currentSweep=void 0,this.sweepData.commit()})),t.commandBinder.addBinding(v.aK,(async e=>{if(e.sweepId)try{const t=e.sweepId;await this.activateSweepUnsafe({sweepId:t});const i=this.sweepData.currentSweep;this.beginSweepTransition({sweepId:t,transitionTime:0,internalProgress:!0,prevSweepId:i}),this.sweepData.currentSweep=t,this.endSweepTransition({sweepId:t,prevSweepId:i}),this.sweepData.commit()}catch(e){J.error(e)}else this.sweepData.currentSweep=void 0,this.sweepData.commit()})),o.onSave((()=>this.save()),{dataType:X.g.SWEEPS}),o.onRevert((()=>this.revert()),{dataType:X.g.SWEEPS}))}getStore(e){const{modelId:t,baseUrl:i,queue:n}=e,s=e.storageProvider||X.Xq.JSONSTORE,o=!("readonly"in e)||!!e.readonly;if(J.info(`Loading Sweeps from ${s}`),s===X.Xq.MDS)return new MdsSweepStore({readonly:o,baseUrl:i});const r=function(e){const{modelId:t,readonly:i}=e,n=e.baseUrl||"",s=e.queue||new C.gO,o={data:null};let r=`${n}/api/v2/models/${t}/sweeps`;if(i){r=`${r}?tag=showcase`;const e=new y.gh({queue:s,path:r,deserialize:O(!0),cachedData:o});return new b.iY({publishStores:[e]})}const a=new y.yh({queue:s,path:r,cachedData:o,httpMethod:y.w$.PATCH,deserialize:O(!0),serialize:P}),l=`${n}/api/v1/jsonstore/model/workshopSession/${t}`,c=new S.Z({queue:s,path:l,cachedData:{data:null},deserialize:w.S.sessionObjectExtract(S.j.WS3_Sweeps,O(!1)),serialize:P},S.j.WS3_Sweeps);return new b.iY({publishStores:[a],editStore:c,partialData:!0,safeKeys:["name","position","rotation","enabled","vrenabled","placementType"],editStoreKey:b.aw.SWEEPS})}({modelId:t,baseUrl:i,readonly:o,queue:n});return new g.N(r,{modelId:t,readonly:o,dataType:X.g.SWEEPS,engine:this.engine})}filterSweepData(e){for(const t in e){const i=e[t];i.neighbours=i.neighbours.filter((t=>t in e))}}onUpdate(e){this.internalProgress&&this.sweepData.transition.active&&this.sweepData.transition.progress.tick(e)}async save(){if(!this.store)throw Error("No store configured for saving sweep edits!");if(this.store instanceof g.N)return;const e=this.monitor.getDiffRecord();this.monitor.clearDiffRecord();const t=e.filter((e=>e.action===K.KI.updated)).map((e=>{const t=this.sweepData.getSweep(e.index),i=Object.assign({id:e.index},e.diff);return"position"in i&&(i.position=t.position),"rotation"in i&&(i.rotation=t.rotation),("enabled"in i||"vrenabled"in i)&&(i.enabled=t.enabled,i.vrenabled=t.vrenabled),i}));return this.store.update(t)}async revert(){if(this.store instanceof g.N)return this.store.revert()}}},81733:(e,t,i)=>{"use strict";i.d(t,{Dv:()=>l,TE:()=>c,o7:()=>h,l0:()=>d,Bv:()=>u});var n=i(2212);const s=-1,o=10,r=5,a=-5,l=(e,t=s)=>i=>e.distanceToSquared(i.position)*t,c=(e,t=s)=>i=>e.distanceTo(i.position)*t,h=(e,t,i=o)=>{const s=new n.Vector3;return n=>s.copy(n.position).sub(e).normalize().dot(t)*i},d=(e,t=s)=>i=>e.distanceToSquared(i.floorPosition)*t,u=(e,t=r,i=a)=>n=>e===n.floorId?t:i},19938:(e,t,i)=>{"use strict";var n;i.d(t,{v:()=>n}),function(e){e[e.CurrentView=0]="CurrentView",e[e.FullPanorama=1]="FullPanorama"}(n||(n={}))},50966:(e,t,i)=>{"use strict";var n;i.d(t,{Z:()=>s}),function(e){e[e.Center=0]="Center",e[e.UpperLeft=1]="UpperLeft",e[e.UpperRight=2]="UpperRight",e[e.LowerRight=3]="LowerRight",e[e.LowerLeft=4]="LowerLeft"}(n||(n={}));const s=n},84559:(e,t,i)=>{"use strict";i.d(t,{S:()=>c,Z:()=>PanoQualityManager});var n=i(87131),s=i(28281),o=i(67569),r=i(13338),a=i(44266);const l=new(i(25799).Z)("panoqualitymanager");var c;!function(e){e[e.Untested=0]="Untested",e[e.Testing=1]="Testing",e[e.Success=2]="Success",e[e.Fail=3]="Fail"}(c||(c={}));class PanoQualityManager{constructor(e,t,i,n){this.urls=e,this.maxCubemapSize=t,this.maxNavPanoSize=i,this.maxZoomPanoSize=n,this.overrideWindow=!1,this.devicePixelRatio=window.devicePixelRatio||1,this.navPanoSize=-1,this.zoomPanoSize=-1,this.windowHeight=window.innerHeight*this.devicePixelRatio,this.highQualityThreshold=s.Xd.windowHeightHighQualityThresholdOverride||s.Xd.windowHeightHighQualityThreshold,this.persistentStorage=new o.a,this.downloadTestResults={},this.updateMaximums()}setWindowSize(e,t){this.windowHeight=t*this.devicePixelRatio,this.updateMaximums()}overrideWindowMaximums(e){this.overrideWindow=e,this.updateMaximums()}updateNavPanoSize(e){this.maxNavPanoSize=e,this.updateMaximums()}getTestResults(e,t){const i=this.downloadTestResults[e];if(i){const e=i[t];if(e)return e}return c.Untested}ultraHighQualityModeEnabled(e){const t=n.Qf[this.getZoomPanoSize()],i=this.downloadTestResults[e];return!(!i||!i[t])&&i[t]===c.Success}updateMaximums(){this.windowHeight<this.highQualityThreshold&&!this.overrideWindow?(this.navPanoSize=Math.min(PanoQualityManager.getPanoSize(n.SL.STANDARD),this.maxNavPanoSize),this.zoomPanoSize=Math.min(PanoQualityManager.getPanoSize(n.SL.HIGH),this.maxZoomPanoSize)):(this.navPanoSize=this.maxNavPanoSize,this.zoomPanoSize=this.maxZoomPanoSize),this.zoomPanoSize<this.navPanoSize&&(this.navPanoSize=this.zoomPanoSize),this.zoomPanoSize=Math.min(this.maxCubemapSize,this.zoomPanoSize),this.navPanoSize=Math.min(this.maxCubemapSize,this.navPanoSize)}static getPanoSize(e){if(e in n.eE)return n.eE[e];throw new Error(`Not a panoSizeClass: ${e}`)}static getPanoSizeClass(e){if(e in n.Qf)return n.Qf[e];throw new Error(`Not a valid pano resolution: ${e}`)}getMaxPossiblePanoSize(){return PanoQualityManager.getPanoSize(n.SL.ULTRAHIGH)}getNavPanoSize(){return this.navPanoSize}getZoomPanoSize(){return this.zoomPanoSize}availableResolution(e,t){const i=new a.Q;if(!t)return i.reject(0);if(e.resolutions)return e.resolutions.includes(t)?i.resolve(t):this.availableResolution(e,this.getLowerResolution(t));switch(this.getTestResults(e.id,t)){case c.Success:i.resolve(t);break;case c.Fail:return this.availableResolution(e,this.getLowerResolution(t));case c.Untested:this.testDownload(e,t,r.I_).then((n=>{n?i.resolve(t):this.availableResolution(e,this.getLowerResolution(t)).then((e=>i.resolve(e)))}));break;case c.Testing:l.warn("resolution is already testing, do we need to handle this?")}return i}getLowerResolution(e){switch(e){case n.SL.ULTRAHIGH:return n.SL.HIGH;case n.SL.HIGH:return n.SL.STANDARD;case n.SL.STANDARD:return n.SL.BASE}return null}testDownload(e,t,i){if(!this.urls)throw new Error("Can't call testDownload without signed urls");const n=PanoQualityManager.getPanoSize(t),s=new a.Q,o=e.id;this.downloadTestResults[o]||(this.downloadTestResults[o]={});const r=this.downloadTestResults[o]&&this.downloadTestResults[o][t];if(r)r===c.Success?s.resolve(!0):r===c.Fail&&s.resolve(!1);else{this.downloadTestResults[o][t]=c.Testing;const r=e=>{this.downloadTestResults[o][t]=c.Success,s.resolve(!0)},a=()=>{this.downloadTestResults[o][t]=c.Fail,s.resolve(!1)};this.getTileUrl(e,n,i,0).then((e=>{this.urls.getImage(e,{maxRetries:0}).then(r,a)}))}return s}getTileUrl(e,t,i,n){const s=this.persistentStorage.get("getTileUrl:locationInfo",(()=>({face:-1,faceTileIndex:-1,tileX:-1,tileY:-1})));r.Tp(t,n,s);const o=Math.floor(t/i),a=o*o,l=Math.floor(n/a),c=PanoQualityManager.getPanoSizeClass(t);return e.getTileUrl(c,l,s.tileX,s.tileY)}}},7922:(e,t,i)=>{"use strict";i.d(t,{Z:()=>PanoRenderTargetResizedMessage});var n=i(93528);class PanoRenderTargetResizedMessage extends n.v{constructor(e,t,i){super(),this.size=e,this.sweepId=t,this.renderTarget=i}}},13338:(e,t,i)=>{"use strict";i.d(t,{I_:()=>l,Hq:()=>c,P6:()=>h,R5:()=>d,Tp:()=>u,Tu:()=>p,ym:()=>m,oU:()=>g,eO:()=>v});var n=i(64630),s=i(2212),o=i(50966),r=i(41446),a=i(97620);const l=512,c=6,h=(e,t,i,s,r,a,l,c)=>{const h=e/t,d=2*(t/e),u=d/2;let p=2*(s/h)-1+u,m=2*((r=h-1-r)/h)-1+u;switch(a=a||o.Z.Center){case o.Z.UpperLeft:p-=u,m+=u,p+=l*d;break;case o.Z.UpperRight:p+=u,m+=u,m-=l*d;break;case o.Z.LowerRight:p+=u,m-=u,p-=l*d;break;case o.Z.LowerLeft:p-=u,m-=u,m+=l*d;break;case o.Z.Center:}switch(i){case n.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_X:c.set(-1,m,-p);break;case n.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_X:c.set(1,m,p);break;case n.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_Y:c.set(-p,1,-m);break;case n.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_Y:c.set(-p,-1,m);break;case n.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_Z:c.set(-p,m,1);break;case n.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_Z:c.set(p,m,-1)}c.normalize()},d=(e,t)=>{let i=l;e<l&&(i=e);const n=Math.floor(e/i),s=n*n;return Math.floor(t/s)},u=(e,t,i)=>{let n=l;e<l&&(n=e);const s=d(e,t),o=Math.floor(e/n),r=t-s*(o*o);i.tileX=r%o,i.tileY=Math.floor(r/o),i.face=s,i.faceTileIndex=r},p=function(e){if(e<=l)return c;const t=Math.floor(e/l);return t*t*c},m=function(){const e=new s.Matrix4,t=new s.Quaternion;return(i,n)=>{t.copy(i),t.invert(),e.makeRotationFromQuaternion(t),n.applyMatrix4(e),n.normalize()}}(),g=function(){const e=new s.Vector3,t=new s.Vector3(0,0,-1),i=new s.Quaternion,n=function(e,t){e.push({face:t.face,faceTileIndex:t.faceTileIndex,tileX:t.tileX,tileY:t.tileY})},o=function(){const e={face:-1,faceTileIndex:-1,tileX:-1,tileY:-1};return(t,i,s)=>{const o=p(t);let r=0;for(let a=0;a<o;a++)u(t,a,e),i&&!i(e)||(r++,s&&n(s,e));return r}}();return(n,r,a,c,h=!1,d,u)=>{c.length=h?0:c.length;const p=r<l?r:l;if(!d&&!u)return o(r,null,c);const g=!!u;d=d||0,u=u||d,u=Math.max(0,Math.min(u,360)),d=Math.max(0,Math.min(d,360)),e.copy(a);const y=n.rotation||new s.Quaternion;if(m(y,e),g){i.setFromUnitVectors(e,t);return o(r,(function(e){return f(r,p,e.face,e.tileX,e.tileY,i,d||0,u||0)}),c)}return o(r,(function(t){return v(r,p,t.face,t.tileX,t.tileY,e,d||0)}),c)}}(),f=function(){const e=new s.Vector3;return(t,i,n,s,l,c,d,u)=>{const p=Math.tan(.5*u*a.Ue),m=-p,g=Math.tan(.5*d*a.Ue),f=-g,v=(0,r.m)(n);let y=0,b=0,w=0,S=0,E=0;for(let n=o.Z.Center;n<=o.Z.LowerLeft;n++){if(h(t,i,v,s,l,n,0,e),e.applyQuaternion(c),e.z>=-1e-5)continue;const o=-1/e.z,r=e.x*o,a=e.y*o;a>p?y++:a<m&&b++,r>g?w++:r<f&&S++,E++}return b!==E&&y!==E&&w!==E&&S!==E}}(),v=function(){const e=new s.Vector3,t=new s.Vector3(0,1,0),i=new s.Vector3(1,0,0);return(n,s,a,l,c,d,u)=>{const p=(0,r.m)(a);if(i.copy(d).cross(t),h(n,s,p,l,c,o.Z.Center,0,e),y(e,d,u))return!0;const m=u/360,g=Math.floor(1/m);let f=0;for(let t=0;t<g;t++){for(let t=o.Z.UpperLeft;t<=o.Z.LowerLeft;t++)if(h(n,s,p,l,c,t,f,e),y(e,d,u))return!0;f+=m}return!1}}(),y=function(){const e=new s.Vector3,t=new s.Vector3;return(i,n,s,o)=>{if(t.copy(i),o){e.copy(o),e.normalize();const n=e.dot(i);e.x*=n,e.y*=n,e.z*=n,t.sub(e)}const r=s/2*a.Ue,l=Math.cos(r);return t.dot(n)>=l}}()},47254:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});const n="cwf/src/modules/sweep-pano-tiling"},15253:(e,t,i)=>{"use strict";i.d(t,{o:()=>TileDownloadedMessage});var n=i(93528);class TileDownloadedMessage extends n.v{constructor(){super()}}},28281:(e,t,i)=>{"use strict";i.d(t,{YS:()=>s,Xd:()=>o,k4:()=>TilingSettings});var n=i(21265);const s="settings/tiling/preload_quality",o=Object.freeze({overlayStyle:n.hu("tileoverlay",0),uploadIntervalDelay:n.hu("tileupdelay",50),highResUploadsPerFrame:n.hu("maxnbtpf",2),maxHighResUploadsPerFrame:100,loadIndicatorDelay:300,uploadsPerFrame:n.hu("maxbtpf",6),maxUploadsPerFrame:100,windowHeightHighQualityThreshold:800,windowHeightHighQualityThresholdOverride:n.hu("threshold2k",void 0),concurrentDownloads:n.hu("tileconc",3),maxConcurrentDownloads:12,navigation:{directionFactor:10,distanceFactor:-1}});class TilingSettings{constructor(){this.reset()}reset(){this.downloadFullPano=!1,this.concurrentDownloads=o.concurrentDownloads,this.uploadsPerFrame=o.uploadsPerFrame,this.highResUploadsPerFrame=o.highResUploadsPerFrame}}},85381:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});const n="cwf/src/modules/sweep-pano"},96640:(e,t,i)=>{"use strict";i.d(t,{Z:()=>RestrictedSweepsClearedMessge});var n=i(93528);class RestrictedSweepsClearedMessge extends n.v{constructor(){super()}}},13453:(e,t,i)=>{"use strict";i.d(t,{Z:()=>RestrictedSweepsSetMessge});var n=i(93528);class RestrictedSweepsSetMessge extends n.v{constructor(e){super(),this.sweepIds=e}}},20949:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>SweepPathModule});var n,s=i(2212),o=i(54122),r=i(77956);class Heap{constructor(e){this.comparator=e,this.nodes=[]}push(e){return this.nodes.push(e),this.siftdown(0,this.nodes.length-1)}pop(){let e,t;return this.nodes.length&&(e=this.nodes.pop(),e)?(this.nodes.length?(t=this.nodes[0],this.nodes[0]=e,this.siftup(0)):t=e,t):null}peek(){return this.nodes[0]}contains(e){return-1!==this.nodes.indexOf(e)}replace(e){if(this.nodes.length){const t=this.nodes[0];return this.nodes[0]=e,this.siftup(0),t}return null}_pushpop(e,t,i){let n;const s=i||this.defaultCompare;return e.length&&s(e[0],t)<0&&(n=[e[0],t],t=n[0],e[0]=n[1],this._siftup(e,0,s)),t}pushpop(e){return this._pushpop(this.nodes,e,this.comparator)}_heapify(e,t){let i,n,s,o,r,a;const l=Math.floor(e.length/2),c=function(){for(a=[],s=0,r=l;0<=r?s<r:s>r;0<=r?s++:s--)a.push(s);return a}.apply(this).reverse(),h=[];for(n=0,o=c.length;n<o;n++)i=c[n],h.push(this._siftup(e,i,t));return h}heapify(){let e,t,i,n,s,o;const r=Math.floor(this.nodes.length/2),a=function(){for(o=[],i=0,s=r;0<=s?i<s:i>s;0<=s?i++:i--)o.push(i);return o}.apply(this).reverse(),l=[];for(t=0,n=a.length;t<n;t++)e=a[t],l.push(this.siftup(e));return l}updateItem(e){const t=this.nodes.indexOf(e);return-1===t?null:(this.siftdown(0,t),this.siftup(t))}clear(){return this.nodes=[]}empty(){return 0===this.nodes.length}size(){return this.nodes.length}clone(){const e=new Heap(this.comparator);return e.nodes=this.nodes.slice(0),e}toArray(){return this.nodes.slice(0)}insert(e){return this.push(e)}top(){return this.peek()}front(){return this.peek()}has(e){return this.contains(e)}copy(){return this.clone()}nlargest(e){let t,i,n;const s=this.nodes.slice(0,e);if(!s.length)return s;this._heapify(s,this.comparator);const o=this.nodes.slice(e);for(i=0,n=o.length;i<n;i++)t=o[i],this._pushpop(s,t,this.comparator);return s.sort(this.comparator).reverse()}defaultCompare(e,t){return e<t?-1:e>t?1:0}_siftdown(e,t,i,n){let s,o;const r=n||this.defaultCompare,a=e[i];for(;i>t&&(o=i-1>>1,s=e[o],r(a,s)<0);)e[i]=s,i=o;return e[i]=a}siftdown(e,t){return this._siftdown(this.nodes,e,t,this.comparator)}_siftup(e,t,i){let n,s;const o=i||this.defaultCompare,r=e.length,a=t,l=e[t];for(n=2*t+1;n<r;)s=n+1,s<r&&!(o(e[n],e[s])<0)&&(n=s),e[t]=e[n],n=2*(t=n)+1;return e[t]=l,this._siftdown(e,a,t,o)}siftup(e){return this._siftup(this.nodes,e,this.comparator)}}function a(e,t){for(const i of t)if(i===e)return!0;return!1}!function(e){e[e.Success=0]="Success",e[e.NoPath=1]="NoPath",e[e.Timeout=2]="Timeout"}(n||(n={}));function l(e){if(void 0!==e.parent){const t=l(e.parent);return t.push(e.data),t}return[e.data]}function c(e){return e.toString()}function h(e,t){if(e.f&&t.f)return e.f-t.f;throw new Error('heapComparator() -> Property "f" is undefined.')}const d=Object.freeze({sweeps:{maxNeighborDistance:50}});var u=i(13453),p=i(96640);class SweepPathModule extends o.Y{constructor(){super(...arguments),this.name="sweep-path"}async init(e,t){this.engine=t,this.sweepData=await t.market.waitForData(r.Z),this.validNeighbors={},this.maxNeighborDistance=e.maxNeighborDistance||d.sweeps.maxNeighborDistance,this.buildDistanceMap()}setRestrictedSweeps(e,t=0){if(this.restrictedSweeps=[],e){for(let i=t;i<e.length;i++)this.restrictedSweeps.push(e[i].id);this.engine.broadcast(new u.Z(this.restrictedSweeps))}else this.restrictedSweeps=void 0,this.engine.broadcast(new p.Z)}findShortestPath(e,t,i,s,o,r,d=5e3){const u=this.sweepData.getSweep(e),p=this.sweepData.getSweep(t),m=(e=>{void 0===e.timeout&&(e.timeout=1/0);const t=e.hash||c,i={data:e.start,g:0,h:e.heuristic(e.start)};let s=i;i.f=i.h;const o=[],r=new Heap(h),d={};r.push(i),d[t(i.data)]=i;const u=Date.now();for(;r.size();){if(Date.now()-u>e.timeout)return{status:n.Timeout,cost:s.g,path:l(s)};const i=r.pop();if(delete d[t(i.data)],i&&e.isEnd(i.data))return{status:n.Success,cost:i.g,path:l(i)};a(p=t(i.data),m=o)||m.push(p);const c=e.neighbor(i.data);for(const n of c){if(a(t(n),o))continue;const l=i.g+e.distance(i.data,n);let c=d[t(n)],h=!1;if(void 0===c)c={data:n,g:0,h:0,f:0},d[t(n)]=c;else{if(c.g<l)continue;h=!0}c.parent=i||void 0,c.g=l,c.h=e.heuristic(n),c.f=l+c.h,c.h<s.h&&(s=c),h?r.heapify():r.push(c)}}var p,m;return{status:n.NoPath,cost:s.g,path:l(s)}})({start:u,isEnd:e=>e===p,neighbor:e=>this.getValidNeighbors(e.id,r),distance:(e,t)=>this.getDistance(e.id,t.id),heuristic:(e,t)=>1,hash:e=>e.id,timeout:d});return m.status===n.Success&&m.path.length<o?(this.addSweepsNearPath(m.path,i),this.filterCloseSweepsFromPath(m.path,s)):null}addSweepsNearPath(e,t){const i=new s.Vector3,n=new s.Vector3,o=new s.Vector3,r=new s.Vector3,a=new s.Vector3,l=new s.Vector3,c=[],h=new s.Vector3,d=(e,t,i)=>(o.copy(t).sub(e),o.dot(i)),u=(e,t)=>d(h,e.position,i)-d(h,t.position,i);let p=0;for(;p<e.length-1;){const s=e[p].id,d=e[p+1].id,m=this.sweepData.getSweep(s),g=this.sweepData.getSweep(d);h.copy(m.position),c.length=0,i.copy(g.position).sub(h).normalize();const f=this.findConnectedSweeps(m,this.maxNeighborDistance),v=this.findConnectedSweeps(g,this.maxNeighborDistance),y=f.concat(v);for(const e of y){const s=o.copy(e.position).sub(h).dot(i);if(s>0){a.copy(i),a.multiplyScalar(s),r.copy(o),r.sub(a);if(r.length()<t){n.copy(i).negate(),l.copy(e.position).sub(g.position);l.dot(n)>0&&c.push(e)}}}if(c.length>0){c.sort(u);for(let t=e.length+c.length-1;t>=p+c.length;t--)e[t]=e[t-c.length];for(let t=0;t<c.length;t++)e[t+p+1]=c[t]}p+=c.length+1}}findConnectedSweeps(e,t,i=2){const n=[];return this._findConnectedSweeps(e,e,t,n,{},i,0),n}_findConnectedSweeps(e,t,i,n,s,o,r){const a=this.getValidNeighbors(e.id);for(const e of a)if(!s[e.id]){e.position.distanceTo(t.position)<i&&(n.push(e),s[e.id]=!0,r<o&&this._findConnectedSweeps(e,t,i,n,s,o,r+1))}}getValidNeighbors(e,t){let i=this.validNeighbors[e];if(!i){i=[],this.validNeighbors[e]=i;const n=this.sweepData.getSweep(e),s=n.neighbours;for(const o of s){const s=this.sweepData.getSweep(o),r=this.getDistance(e,o);if(!s.enabled)continue;if(r>this.maxNeighborDistance)continue;let a=!0;if(t){const e=s.position.clone().sub(n.position).normalize();a=0===t(n.position,e,r).length}a&&i.push(s)}}return i}filterCloseSweepsFromPath(e,t){const i=[];let n=null,s=!1;for(const o of e)s=n&&o.position.distanceTo(n.position)<t||!1,n&&s||(i.push(o),n=o);return i.length<2?e:(s&&e.length>1&&(i[i.length-1]=e[e.length-1]),i)}getCurveForPath(e){let t=0;const i=[0];for(let n=1;n<e.length;n++)t+=e[n-1].distanceTo(e[n]),i.push(t);const n=[0];for(let s=1;s<e.length;s++)n.push(i[s]/t);const o=new s.CatmullRomCurve3(e,!1);return{curve:new s.CatmullRomCurve3(o.getSpacedPoints(2*t).concat(e[e.length-1])),totalLength:t,sourceDistances:i,normalSourceDistances:n}}buildDistanceMap(){const e={},t=new s.Vector3(0,0,0);this.sweepData.iterate((i=>{const n={},s=i.neighbours;for(const e of s){const s=this.sweepData.getSweep(e);t.copy(i.position).sub(s.position);let o,r=Math.max(0,Math.abs(t.y)-.2),a=Math.sqrt(t.x*t.x+t.z*t.z);r>0?(r=Math.pow(4*r,2),a=Math.pow(a,2),o=Math.sqrt(r*r+a*a)):o=t.length(),n[s.id]=o}e[i.id]=n})),this.distanceMap=e}getDistance(e,t){return this.distanceMap[e][t]}}},54922:(e,t,i)=>{"use strict";i.d(t,{m1:()=>PinCollider,Vp:()=>PinMesh});var n=i(2212),s=i(97508),o=i.n(s),r=i(68458),a=i.n(r);class PinMaterial extends n.RawShaderMaterial{constructor(e,t){const i=n.UniformsUtils.clone(PinMaterial.uniforms);i.tMask.value=e,i.tPinHole.value=t,super({vertexShader:o(),fragmentShader:a(),uniforms:i,name:"PinMaterial",transparent:!0})}}PinMaterial.uniforms={tMask:{type:"t",value:null},tPinHole:{type:"t",value:null},pinColor:{type:"c",value:new n.Color},opacity:{type:"f",value:1}};var l=i(60778),c=i(67126),h=i(20599),d=i(61956),u=i(83974),p=i(48072);class PinCollider extends n.Mesh{}let m;const g=()=>m||(m=(0,l.p)(p),m);class PinMesh extends u.E{constructor(e,t,i,n){const s=new PinMaterial(g(),t);super(PinMesh.geometry,s),this.layers.mask=n.mask,this.name="PinMesh",this.cameraData=i,this._collider=new PinCollider(PinMesh.colliderGeometry,PinMesh.colliderMaterial),this._collider.material.visible=!1,this.add(this._collider),this.opacityProgress=0,this.shouldHide=!0,this.uniforms=s.uniforms,this.unhover(),this.selected=0,this.visible=!1,this.position.copy(e),this.renderOrder=h.z.pins360}updatePosition(e){this.position.copy(e)}get collider(){return this._collider}render(e){this.quaternion.copy(this.cameraData.pose.rotation),null===this.uniforms.tPinHole.value?this.opacityProgress=0:!this.shouldHide&&this.opacityProgress<1?this.opacityProgress+=e/PinMesh.FADE_DURATION:this.shouldHide&&this.opacityProgress>0&&(this.opacityProgress-=e/PinMesh.FADE_DURATION),this.opacityProgress=(0,c.uZ)(this.opacityProgress,0,1),this.uniforms.opacity.value=this.opacityProgress,this.visible=0!==this.opacityProgress}activate(){this.shouldHide=!1}deactivate(){this.shouldHide=!0}dispose(){this.collider.geometry.dispose(),this.collider.material.dispose()}setPinHover(e,t=!0,i=!0){const n=Math.min(Math.max(e,0),1);this.selected!==n&&(i&&this.uniforms.pinColor.value.copy(d.I.WHITE).lerp(d.I.MP_BRAND,n),t&&n>0&&n<=1&&(this.material.depthTest=!1),0===n&&(this.material.depthTest=!0),this.selected=n)}unhover(){this.uniforms.pinColor.value.copy(d.I.WHITE)}}PinMesh.FADE_DURATION=500,PinMesh.geometry=new n.PlaneBufferGeometry(1.5,1.5),PinMesh.colliderGeometry=new n.SphereBufferGeometry(1.5*.65),PinMesh.colliderMaterial=new n.MeshBasicMaterial({transparent:!0,opacity:.5,depthWrite:!1,color:16724312})},179:(e,t,i)=>{"use strict";i.d(t,{O:()=>PinUnselectCommand});var n=i(99681);class PinUnselectCommand extends n.m{constructor(e){super(),this.id="PIN_UNSELECT",this.payload={id:e}}}},29821:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>SweepPinMesh});var n=i(54122),s=i(2212),o=i(54922),r=i(6667),a=i(91542),l=i(57369),c=i(87131),h=i(17321),d=i(73706),u=i(25799),p=i(85995),m=i(75712);const g=new u.Z("pin-mesh");class PinMeshRenderer{constructor(e,t,i,n,o,a){this.sweepViewData=e,this.scene=t,this.sweepTextureLoader=i,this.input=n,this.layer=a,this.container=new s.Object3D,this.bindings=[],this.visibilityFilter=()=>!0,this.updatePlacementType=(e,t)=>{this.dataToMeshMap[e.id]||e.placementType!==l.hU.MANUAL?this.dataToMeshMap[e.id]&&e.placementType!==l.hU.MANUAL&&(this.removePinMesh(e),this.engine.broadcast(new r.h(e.id,t,!1))):(this.createPinMesh(e,this.cameraData),this.engine.broadcast(new r.h(e.id,t,!0)))},this.onSweepPlacedMessage=e=>{this.highlightPin(e.sweepId,!0)},this.hoverSweep=(e,t)=>{this.issueCommand(new p.kR(e,t,0));const i=this.sweepViewData.selectedSweep===e;this.highlightPin(e,t||i)},this.meshes=[],this.meshToDataMap={},this.dataToMeshMap={},this.cameraData=o,e.iterate((t=>{t.alignmentType!==l.z9.ALIGNED&&(t.placementType===l.hU.MANUAL&&this.createPinMesh(t,o),this.bindings.push(t.onChanged((()=>{const i=e.getIndexByAlignment(!1,t.id);this.updatePlacementType(t,i),h.H7(t)&&this.updatePinMeshPosition(t.id,t.position)}))))}))}updatePinMeshPosition(e,t){this.mapSweepToMesh(e).updatePosition(t)}mapSweepToMesh(e){return this.dataToMeshMap[e]}mapColliderToSweep(e){const t=e.hasOwnProperty("collider")?e:e.parent;if(t){const e=this.meshToDataMap[t.id];if(e)return e.sweep}return null}filter(e){this.visibilityFilter=e;for(const e of this.meshes)this.filterMesh(e)}init(){}dispose(){for(const e in this.meshToDataMap){const t=this.meshToDataMap[e];this.removePinMesh(t.sweep)}}render(e){for(const t of this.meshes)t.render(e)}activate(e){this.engine=e,this.issueCommand=e.commandBinder.issueCommand.bind(e.commandBinder),this.bindings.push(this.input.registerMeshHandler(d.z,m.s.isType(o.m1),((e,t)=>this.onHoverEvent(t,!0)))),this.bindings.push(this.input.registerMeshHandler(d.A,m.s.isType(o.m1),((e,t)=>this.onHoverEvent(t,!1)))),this.bindings.push(e.subscribe(a.om,this.onSweepPlacedMessage)),this.scene.add(this.container)}deactivate(e){for(const e of this.bindings)e.cancel();this.bindings.length=0,this.scene.remove(this.container)}getMeshes(){return this.meshToDataMap}highlightPin(e,t){this.dataToMeshMap[e]&&this.dataToMeshMap[e].setPinHover(t?1:0,!1)}lockSelection(e,t){return t&&(this.engine.broadcast(new r.c(e.id,!0)),this.hoverSweep(e.id,!0)),!0}createPinMesh(e,t){const i=new o.Vp(e.position,null,t,this.layer);this.meshes.push(i),this.dataToMeshMap[e.id]=i,this.meshToDataMap[i.id]={id:i.id,sweep:e},this.container.add(i),this.filterMesh(i),this.sweepTextureLoader.loadFace(e,c.SL.BASE,1,{flipY:!0}).then((e=>{i.material.uniforms.tPinHole.value=e})).catch((t=>{g.error(`${e.id} failed to load texture: ${t}`)}))}removePinMesh(e){const t=this.dataToMeshMap[e.id],i=this.meshes.findIndex((e=>e.id===t.id));this.meshes.splice(i,1),this.container.remove(t),this.deactivateMesh(t),delete this.meshToDataMap[t.id],delete this.dataToMeshMap[e.id],t.dispose()}filterMesh(e){const t=this.meshToDataMap[e.id];if(t){const i=t.sweep;this.visibilityFilter(i)?this.activateMesh(e):this.deactivateMesh(e)}}onHoverEvent(e,t){const i=this.mapColliderToSweep(e);i&&this.hoverSweep(i.id,t)}activateMesh(e){this.input.registerMesh(e.collider,!1),e.activate()}deactivateMesh(e){this.input.unregisterMesh(e.collider);const t=this.meshToDataMap[e.id];t&&(this.hoverSweep(t.sweep.id,!1),e.deactivate())}}PinMeshRenderer.MENU_CLEAR_DEBOUNCE=100;var f=i(50101),v=i(30963),y=i(5587),b=i(179),w=i(53944),S=i(22423),E=i(89155),T=i(12775),M=i(39936),_=i(71208),x=i(22729),A=i(69275),O=i(2048),P=i(41479),C=i(42885);class SweepPinMesh extends n.Y{constructor(){super(...arguments),this.name="sweep-pin-mesh",this.onChange=()=>{const e=this.sweepViewData,t=e.selectedSweep,i=e.toolState===O._.ROTATING||e.toolState===O._.ROTATED;this.pinRenderer.filter((e=>{if(!this.settingsData.tryGetProperty(C.s,!0))return!1;if(i&&t===e.id)return!1;if(this.viewmodeData.transition.active&&this.viewmodeData.transition.to===_.Ey.Panorama)return!1;const n=this.floorsViewData.isCurrentOrAllFloors(e.floorId),s=this.viewmodeData.closestMode===_.Ey.Dollhouse||this.viewmodeData.closestMode===_.Ey.Floorplan;return n&&s}))},this.onSelectedPinChange=()=>{const e=this.sweepViewData.selectedSweep;e&&(this.engine.commandBinder.issueCommand(new p.iF(e,!0,0)),this.pinRenderer.highlightPin(e,!0))}}async init(e,t){[this.model,this.webglRenderer,this.input,this.sweepViewData,this.cameraData,this.settingsData,this.viewmodeData,this.floorsViewData]=await Promise.all([t.getModule(S.default),t.getModule(f.default),t.getModule(v.default),t.market.waitForData(A.D),t.market.waitForData(E.M_),t.market.waitForData(M.e),t.market.waitForData(T.O),t.market.waitForData(x.c)]);const i=t.claimRenderLayer(this.name),n=this.webglRenderer.getScene().scene;this.engine=t;const s=new y.Z(this.model.getSignedUrls());this.pinRenderer=new PinMeshRenderer(this.sweepViewData,n,s,this.input,this.cameraData,i),t.addComponent(this,this.pinRenderer),this.bindings.push(this.settingsData.onPropertyChanged(C.s,this.onChange),this.viewmodeData.onChanged(this.onChange),this.sweepViewData.onSelectedSweepChanged(this.onSelectedPinChange),t.subscribe(P.P,this.onChange),t.subscribe(w.WY,this.onChange),t.subscribe(w._G,this.onChange),t.commandBinder.addBinding(b.O,(async e=>{this.pinRenderer.highlightPin(e.id,!1)}))),this.onChange()}mapColliderToSweep(e){return this.pinRenderer.mapColliderToSweep(e)}selectPinMesh(e,t){return this.pinRenderer.lockSelection(e,t)}highlightPinMesh(e,t){this.pinRenderer.highlightPin(e,t)}mapSweepToMesh(e){return this.pinRenderer.mapSweepToMesh(e)}updatePosition(e,t){this.pinRenderer.updatePinMeshPosition(e,t)}}},6667:(e,t,i)=>{"use strict";i.d(t,{c:()=>PinSelectMessage,h:()=>PinPlacementMessage});var n=i(93528);class PinSelectMessage extends n.v{constructor(e,t){super(),this.sweepId=e,this.selected=t}}class PinPlacementMessage extends n.v{constructor(e,t,i){super(),this.sweepId=e,this.pinIndex=t,this.placed=i}}},42885:(e,t,i)=>{"use strict";i.d(t,{s:()=>n});const n="features/360_views"},16031:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>SweepPinNavigation});var n=i(54122),s=i(29821),o=i(54922),r=i(76258),a=i(7065),l=i(71208),c=i(47924),h=i(89997),d=i(12775),u=i(2212),p=i(30963),m=i(75158),g=i(73706),f=i(75712);class SweepPinNavigation extends n.Y{constructor(){super(...arguments),this.name="sweep-pin-navigation"}async init(e,t){const[i,n,v,y]=await Promise.all([t.getModule(s.default),t.getModule(h.default),t.market.waitForData(d.O),t.getModule(p.default)]),b=new u.Quaternion;this.bindings.push(y.registerMeshHandler(m.R,f.s.isType(o.m1),((e,t,s)=>{const o=i.mapColliderToSweep(t);return!(!o||v.transition.active)&&(b.set(0,0,0,1).multiply(o.rotation),r=o.id,a=b,v.currentMode&&v.currentMode!==l.Ey.Panorama&&n.switchToMode(l.Ey.Panorama,c.n.FadeToBlack,{sweepID:r,rotation:a}),!0);var r,a})),y.registerMeshHandler(g.z,f.s.isType(o.m1),((e,n)=>{i.mapColliderToSweep(n)&&t.commandBinder.issueCommand(new r.u(a.C.FINGER))})),y.registerMeshHandler(g.A,f.s.isType(o.m1),((e,n)=>{i.mapColliderToSweep(n)&&t.commandBinder.issueCommand(new r.u(null))})))}}},67906:(e,t,i)=>{"use strict";i.d(t,{p:()=>PortalPuckMesh,Y:()=>l});var n=i(2212),s=i(7206),o=i.n(s),r=i(34382),a=i.n(r);class PortalMaterial extends n.RawShaderMaterial{constructor(e,t){const i=n.UniformsUtils.clone(PortalMaterial.uniforms);i.tNoHover.value=e,i.tHover.value=t,i.tPortal.value=null,super({vertexShader:o(),fragmentShader:a(),uniforms:i,name:"PortalMaterial",transparent:!0})}}PortalMaterial.uniforms={tNoHover:{type:"t",value:null},tHover:{type:"t",value:null},tPortal:{type:"t",vlaue:null},progress:{type:"f",value:1},opacity:{type:"f",value:1}};var l,c=i(38429),h=i(67126),d=i(20599);!function(e){e[e.HIDE=0]="HIDE",e[e.SHOW=1]="SHOW",e[e.ONTOP=2]="ONTOP"}(l||(l={}));class PortalPuckMesh extends n.Mesh{constructor(e,t){const i=new PortalMaterial(c.P.get().toInteriorTexture,c.P.get().toInteriorHoverTexture);super(PortalPuckMesh.geometry,i),this.layers.mask=t.mask,this.uniforms=i.uniforms,this.renderOrder=d.z.portals,this.setState(l.HIDE),this.update(e)}update(e){const t=e.lookDirection.clone().add(e.position);this.position.copy(e.position),this.lookAt(t),this.hoverProgress=0,this.hovered=!1,e.toExterior?(this.uniforms.tNoHover.value=c.P.get().toExteriorTexture,this.uniforms.tHover.value=c.P.get().toExteriorHoverTexture):(this.uniforms.tNoHover.value=c.P.get().toInteriorTexture,this.uniforms.tHover.value=c.P.get().toInteriorHoverTexture)}resetMesh(e=0,t=!1,i=!1){this.uniforms.opacity.value=e,this.material.depthTest=t,this.material.depthWrite=i}setHover(e){this.hovered=e}setState(e){switch(e){case l.HIDE:this.resetMesh(0,!0,!0);break;case l.SHOW:this.resetMesh(1,!0,!0);break;case l.ONTOP:this.resetMesh(1)}}render(e){this.hovered&&this.hoverProgress<1?this.hoverProgress+=e/300:!this.hovered&&this.hoverProgress>0&&(this.hoverProgress-=e/300),this.hoverProgress=(0,h.uZ)(this.hoverProgress,0,1),this.uniforms.progress.value=this.hoverProgress}updatePortalTexture(e){this.uniforms.tPortal.value=e}}PortalPuckMesh.geometry=new n.PlaneGeometry(.3,.3)},75252:(e,t,i)=>{"use strict";i.d(t,{K$:()=>PortalClickMessage,Sk:()=>PortalPuckRenderer});var n=i(93528),s=i(67906),o=i(2212),r=i(99774),a=i(73706),l=i(75158),c=i(75712);class PortalClickMessage extends n.v{constructor(e){super(),this.toSweep=e.toSweep,this.toExterior=e.toExterior,this.fromInterior=e.fromInterior,this.meshPosition=e.position}}class PortalPuckRenderer{constructor(e,t,i,n){this.container=new o.Object3D,this.bindings=[],this.visibilityFilter=e=>s.Y.HIDE,this.scene=e,this.input=t,this.layer=n,this.viewportLoader=i,this.meshes=[],this.activeMeshes={},this.meshToDataMap={},this.dataToMeshMap={},this.activeTexturePromises={},this.meshPool=new r.L}addPortal(e){let t;const i=this.meshPool.get();i?(t=i.object,t.update(e)):t=this.meshPool.add(new s.p(e,this.layer)).object,this.meshes.push(t),this.container.add(t),this.meshToDataMap[t.id]=e,this.dataToMeshMap[e.index]=t,this.activateMesh(t,this.visibilityFilter(e))}removePortal(e){const t=this.dataToMeshMap[e.index];if(t){this.meshPool.free(t);const i=this.meshes.findIndex((e=>e.id===t.id));this.meshes.splice(i,1),this.container.remove(t),this.deactivateMesh(t),delete this.meshToDataMap[t.id],delete this.dataToMeshMap[e.index]}}init(){}activate(e){this.broadcast=e.broadcast.bind(e),this.bindings.push(this.input.registerMeshHandler(a.z,c.s.isType(s.p),((e,t)=>{this.onPuckSelect(t)}))),this.bindings.push(this.input.registerMeshHandler(a.A,c.s.isType(s.p),((e,t)=>{this.onPuckDeselect(t)}))),this.bindings.push(this.input.registerMeshHandler(l.R,c.s.isType(s.p),((e,t)=>{this.onPuckClick(t)}))),this.scene.add(this.container)}dispose(){for(const e of Object.keys(this.meshToDataMap)){const t=this.meshToDataMap[e],i=this.dataToMeshMap[t.index];this.removePortal(t),i.material.dispose(),i.geometry.dispose()}}deactivate(e){for(const e of this.bindings)e.cancel();this.bindings.length=0,this.scene.remove(this.container)}render(e){for(const t of this.meshes)t.render(e)}filter(e){this.visibilityFilter=e;for(const t of this.meshes){const i=e(this.meshToDataMap[t.id]);i===s.Y.HIDE?this.deactivateMesh(t):this.activateMesh(t,i)}}mapSweepToMesh(e){for(const t in this.meshToDataMap){const i=this.meshToDataMap[t];if(i.toSweep.id===e&&i.toExterior&&i.fromInterior)return this.dataToMeshMap[i.index]}return null}activateMesh(e,t=0){this.activeMeshes[e.id]||(this.input.registerMesh(e,!1),this.activeMeshes[e.id]=!0),e.setState(t)}deactivateMesh(e){this.input.unregisterMesh(e),this.activeMeshes[e.id]=!1,this.onPuckDeselect(e),e.setState(s.Y.HIDE)}onPuckClick(e){this.broadcast(new PortalClickMessage(this.meshToDataMap[e.id]))}onPuckSelect(e){const t=this.meshToDataMap[e.id].toSweep,i=this.viewportLoader.getPortalTexture(t,t.rotation,e.position);this.activeTexturePromises[e.id]=i,i.then((t=>{this.activeTexturePromises.hasOwnProperty(e.id)&&i===this.activeTexturePromises[e.id]&&(e.updatePortalTexture(t),e.setHover(!0))}))}onPuckDeselect(e){e.setHover(!1),this.viewportLoader.releasePortalTexture(this.meshToDataMap[e.id].toSweep.id),delete this.activeTexturePromises[e.id]}}},38429:(e,t,i)=>{"use strict";i.d(t,{P:()=>c});var n=i(60778),s=i(68444),o=i(85089),r=i(45545),a=i(64293);let l;const c={get:()=>l||(l={toExteriorTexture:(0,n.p)(s),toExteriorHoverTexture:(0,n.p)(o),toInteriorTexture:(0,n.p)(r),toInteriorHoverTexture:(0,n.p)(a)},l)}},17476:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>PortalPuckMeshModule});var n=i(54122),s=i(87131),o=i(2212),r=i(41693),a=i.n(r),l=i(1858),c=i.n(l);class PortalViewportMaterial extends o.RawShaderMaterial{constructor(){const e=o.UniformsUtils.clone(PortalViewportMaterial.uniforms);super({vertexShader:a(),fragmentShader:c(),uniforms:e,name:"PortalViewportMaterial",side:o.BackSide})}updateTexture(e){this.uniforms.tMap.value=e}}PortalViewportMaterial.uniforms={tMap:{type:"t",value:null}};class PortalViewportLoader{constructor(e,t,i,n){this.tempLookDirection=new o.Vector3,this.worldCamera=n,this.camera=new o.Camera,this.renderSize=i,this.sweepTextureLoader=e,this.textureRenderer=t,this.renderTargets={},this.renderCube=new o.Mesh(new o.BoxGeometry(4,4,4),new PortalViewportMaterial)}async getPortalTexture(e,t,i){const n=this.renderTargets[e.id]||this.textureRenderer.createRenderTarget2D(this.renderSize,this.renderSize),o=await this.sweepTextureLoader.load(e,s.SL.BASE);return this.renderCube.material.updateTexture(o),this.renderCube.quaternion.copy(t),this.camera.projectionMatrix.copy(this.worldCamera.projectionMatrix),this.worldCamera.getWorldPosition(this.tempLookDirection),this.camera.lookAt(this.tempLookDirection.sub(i).negate()),this.textureRenderer.render(n,this.renderCube,this.camera),n.texture}releasePortalTexture(e){const t=this.renderTargets[e];t&&this.textureRenderer.disposeRenderTarget2D(t)}}var h=i(75252),d=i(21265);const u=(0,d.hu)("geond",15),p=(0,d.hu)("geowo",.1);var m=i(22423),g=i(62513),f=i(24975),v=i(30963),y=i(73354),b=i(50101),w=i(67940),S=i(77956),E=i(57369),T=i(5587),M=i(17321),_=i(81733);const x=new(i(25799).Z)("sweep-portal-mesh");class PortalPuckMeshModule extends n.Y{constructor(){super(...arguments),this.name="sweep-portal-mesh",this.portalCount=0}async init(e,t){const[i,n,s,o,r,a]=await Promise.all([t.getModule(m.default),t.getModule(g.default),t.getModule(v.default),t.getModule(y.default),t.getModule(b.default),t.market.waitForData(S.Z),t.getModule(w.default)]),l=t.claimRenderLayer(this.name);this.portalData={};const c=r.getScene().camera,d=new T.Z(i.getSignedUrls());this.raycaster=n;const u=new PortalViewportLoader(d,o,256,c),p=r.getScene().scene;this.portalRenderer=new h.Sk(p,s,u,l);const f=E.hU.MANUAL,_=a.filter((e=>M.H7(e)));a.iterate((e=>{this.portalData[e.id]||(this.portalData[e.id]=[]),M.H7(e)&&this.addPortals(e,this.portalRenderer,a,_);let t=e.placementType;this.bindings.push(e.onPropertyChanged("placementType",(i=>{t!==f&&i===f&&this.addPortals(e,this.portalRenderer,a,_),t===f&&i!==f&&this.removePortals(e.id,this.portalRenderer),t=i}))),this.bindings.push(e.onChanged((()=>{M.H7(e)&&(this.removePortals(e.id,this.portalRenderer),this.addPortals(e,this.portalRenderer,a,_))})))})),t.addComponent(this,this.portalRenderer)}filter(e){this.portalRenderer.filter(e)}getPortalToExterior(e){return this.portalRenderer.mapSweepToMesh(e)}removePortals(e,t){for(const i of this.portalData[e])t.removePortal(i);this.portalData[e]=[]}addPortals(e,t,i,n){const s=this.nearestAlignedSweep(e,i);if(s){const i=this.entryLinks(e,s),o=this.neighborLinks(e,n);this.portalData[e.id]=i.concat(o);for(const i of this.portalData[e.id])t.addPortal(i)}else x.debug(`Couldn't find the nearest sweep for a 360 on floor ${e.floorId}; not adding portals`)}nearestAlignedSweep(e,t){const i=[M.ff(e),M._k(),M._T(),M.b1(e)],n=[_.TE(e.position)],s=t.sortByScore(i,n)[0];return s?s.sweep:null}modelIntersection(e,t){const i=(new o.Vector3).copy(e.position).sub(t.position).setY(0).normalize();return{intersect:this.raycaster.picking.pick(t.position,i,f.T0),rayDirection:i}}entryLinks(e,t){const i=[],n=this.modelIntersection(e,t);let s=new o.Vector3,r=new o.Vector3;return n.intersect&&n.intersect.face?(s=n.intersect.face.normal.clone().setY(0).normalize(),r=n.intersect.point.clone().addScaledVector(s,p).setY(t.position.y)):(s=n.rayDirection.clone().negate(),r=t.position.clone().addScaledVector(n.rayDirection,2)),i.push({index:this.portalCount++,toSweep:e,fromSweep:t,position:r,lookDirection:s,toExterior:!0,fromInterior:!0}),i.push({index:this.portalCount++,toSweep:t,fromSweep:e,position:e.position.clone().addScaledVector(s,2).setY(e.position.y),lookDirection:s.clone().negate(),toExterior:!1,fromInterior:!1}),i}neighborLinks(e,t){const i=[];for(const n of t)if(n.floorId===e.floorId&&e.position.distanceTo(n.position)<u){const t=n.position.clone().sub(e.position).setY(0).normalize(),s=e.position.clone().addScaledVector(t,2);t.negate(),i.push({index:this.portalCount++,toSweep:n,fromSweep:e,position:s,lookDirection:t,toExterior:!0,fromInterior:!1})}return i}}},10816:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>SweepPortalNavigation});var n=i(21265),s=i(90709);const o=(0,n.hu)("geodist",(0,s._F)((0,n.hu)("geodistft",20)));var r=i(54122),a=i(17476),l=i(57369),c=i(71208),h=i(47924),d=i(89155),u=i(77956),p=i(89997),m=i(12775),g=i(75252),f=i(67906),v=i(55525),y=i(39936),b=i(42885);class SweepPortalNavigation extends r.Y{constructor(){super(...arguments),this.name="sweep-portal-navigation",this.onChange=()=>{this.portalRenderer.filter((e=>{if(!this.settingsData.tryGetProperty(b.s,!0))return f.Y.HIDE;if(this.viewmodeData.closestMode!==c.Ey.Panorama)return f.Y.HIDE;const t=this.sweepData.getSweep(this.sweepData.currentSweep||"");if(t)if(t.alignmentType===l.z9.ALIGNED){if(e.fromInterior&&e.toExterior&&e.position.distanceTo(t.position)<o)return f.Y.SHOW}else if(t.placementType===l.hU.MANUAL&&e.fromSweep.id===t.id)return f.Y.ONTOP;return f.Y.HIDE}))}}async init(e,t){[this.portalRenderer,this.cameraData,this.viewmodeModule,this.viewmodeData,this.sweepData,this.settingsData]=await Promise.all([t.getModule(a.default),t.market.waitForData(d.M_),t.getModule(p.default),t.market.waitForData(m.O),t.market.waitForData(u.Z),t.market.waitForData(y.e)]);const i=(e,i)=>{this.viewmodeData.currentMode&&this.cameraData.canTransition()&&(this.viewmodeData.currentMode!==c.Ey.Panorama?this.viewmodeModule.switchToMode(c.Ey.Panorama,h.n.FadeToBlack,{sweepID:e,rotation:i}):t.commandBinder.issueCommand(new v.ju({sweep:e,rotation:i,transition:h.n.FadeToBlack})))};this.settingsData.onPropertyChanged(b.s,this.onChange),this.bindings.push(t.subscribe(g.K$,(e=>{i(e.toSweep.id)})),this.viewmodeData.onChanged(this.onChange),this.sweepData.onChanged(this.onChange)),this.onChange()}}},79979:(e,t,i)=>{"use strict";i.d(t,{Z:()=>PuckClickedMessage});var n=i(93528);class PuckClickedMessage extends n.v{constructor(e,t,i){super(),this.sweepId=e,this.sweepIndex=t,this.totalSweeps=i}}},81660:(e,t,i)=>{"use strict";i.d(t,{Z:()=>PuckHoverMessage});var n=i(93528);class PuckHoverMessage extends n.v{constructor(e,t){super(),this.sweepId=e,this.hovered=t}}},74958:(e,t,i)=>{"use strict";i.d(t,{YY:()=>PuckCollider,C$:()=>PuckRenderer});var n=i(2212),s=i(85995),o=i(73706),r=i(75158),a=i(79979),l=i(2779),c=i(20599),h=i(57369),d=i(98809),u=i(81660);class PuckMesh extends n.Mesh{}class PuckCollider extends n.Mesh{}class PuckRenderer{constructor(e,t,i,s,o,r,a,c=new n.Color(16724312),h=new n.Color(16724312),d=.8,u=.8,p=300,m=.4,g=l.o.ALL){this.scene=e,this.input=t,this.settingsData=i,this.sweepViewData=s,this.puckImagery=o,this.onFloor=r,this.checkRenderModes=a,this.idleColor=c,this.selectionColor=h,this.idleOpacity=d,this.editingOpacity=u,this.selectionDuration=p,this.puckSize=m,this.layer=g,this.sweepToMesh={},this.colliderToSweep={},this.editingEnabled=!1,this.dummyMat=new n.MeshBasicMaterial,this.puckOffset=new n.Vector3(0,.05,0),this.bindings=[],this.wasDrawing=!1,this.renderPuckHighlight=(e,t)=>{if(!this.sweepViewData.isSweepAligned(e))return;const i=this.sweepToMesh[e].material.color;t?i.copy(this.selectionColor):i.copy(this.idleColor)},this.updateLookAt=e=>{this.sweepViewData.iterate((t=>{const i=this.sweepToMesh[t.id];i&&i.visible&&i.lookAt(e)}))}}init(){if(this.puckGeometry=new n.PlaneBufferGeometry(this.puckSize,this.puckSize),this.onFloor){const e=new n.Matrix4;e.makeRotationFromEuler(new n.Euler(-Math.PI/2,0,0,"XYZ")),this.puckGeometry.applyMatrix4(e)}this.sphereColliderGeometry=new n.SphereBufferGeometry(.5*this.puckSize,10,10),this.matParamsEnabled={color:this.idleColor.getHex(),opacity:this.idleOpacity,transparent:!0,depthWrite:!1,map:this.puckImagery.enabled},this.sweepViewData.iterate(this.createPuck.bind(this))}get displayDisabled(){return void 0!==this.puckImagery.disabled}onSweepStateAnimationChanged(e,t,i){const n=i.value,s=e.enabled?this.puckImagery.enabled:this.puckImagery.disabled,o=e.enabled?this.puckImagery.enabledHover:this.puckImagery.disabledHover,r=n>0&&this.editingEnabled,a=e.id===this.sweepViewData.selectedSweep,l=this.editingEnabled&&a?this.selectionColor:this.idleColor,c=this.editingEnabled?this.editingOpacity:this.idleOpacity;t.setValues({map:r?o:s}),t.color.copy(l),t.opacity=c*(1-n)+1*n}createMaterial(e){const t=new n.MeshBasicMaterial(this.matParamsEnabled);return this.puckImagery.disabled&&!e.enabled&&t.setValues({map:this.puckImagery.disabled}),this.bindings.push(e.onPropertyChanged("enabled",(()=>{t.setValues({map:e.enabled?this.puckImagery.enabled:this.puckImagery.disabled})}))),t}createMesh(e,t){const i=new PuckMesh(this.puckGeometry,t);this.onFloor?i.position.copy(e.floorPosition).add(this.puckOffset):(i.position.copy(e.position),i.rotation.setFromQuaternion(e.rotation)),i.name=e.id,i.updateMatrixWorld(!1),i.renderOrder=c.z.panoMarker;const n=this.sweepViewData.getState(e.id);return i.visible=n.visible,this.bindings.push(n.onPropertyChanged("visible",(e=>{i.visible=e}))),this.bindings.push(n.onPropertyChanged("animation",(i=>this.onSweepStateAnimationChanged(e,t,i)))),i.layers.mask=this.layer.mask,i}createCollider(e,t){let i;return i=this.onFloor?new PuckCollider(this.puckGeometry,this.dummyMat):new PuckCollider(this.sphereColliderGeometry,this.dummyMat),i.userData.sid=e.id,i.position.copy(t.position),i.rotation.copy(t.rotation),i.name=e.id,i.updateMatrixWorld(!1),i}createPuck(e){if(e.alignmentType!==h.z9.ALIGNED)return;const t=this.createMaterial(e),i=this.createMesh(e,t),n=this.createCollider(e,i);i.collider=n,this.sweepToMesh[e.id]=i,this.colliderToSweep[n.id]=e.id}toggleEditingEnabled(e){this.editingEnabled=e;for(const t in this.sweepToMesh){this.sweepToMesh[t].material.opacity=e?this.editingOpacity:this.idleOpacity}}getSweepId(e){return this.colliderToSweep[e]}updatePuckImagery(e){let t;this.displayDisabled||void 0===e.disabled?this.displayDisabled&&void 0===e.disabled&&(t=!1):t=!0,this.puckImagery=e,this.sweepViewData.iterate((e=>{if(e.alignmentType!==h.z9.ALIGNED)return;const i=this.sweepToMesh[e.id],n=this.sweepViewData.getState(e.id);i.visible=n.visible;let s=this.puckImagery.enabled;if(!e.enabled&&this.puckImagery.disabled&&(s=this.puckImagery.disabled),this.sweepToMesh[e.id].material.setValues({map:s}),void 0!==t){if(e.enabled)return;t?this.addSweepToScene(e.id):this.removeSweepFromScene(e.id)}}))}updateCheckRenderModes(e){this.checkRenderModes=e}removeSweepFromScene(e){const t=this.sweepToMesh[e];this.scene.remove(t),this.input.unregisterMesh(t.collider)}addSweepToScene(e){if(!this.sweepViewData.getSweep(e).enabled&&!this.displayDisabled)return;const t=this.sweepToMesh[e];this.scene.add(t),this.input.registerMesh(t.collider,!0)}render(){const e=this.checkRenderModes(),t=this.settingsData.tryGetProperty(d.U,!0);if(e&&t){if(!this.wasDrawing){for(const e in this.sweepToMesh)this.addSweepToScene(e);this.wasDrawing=!0}}else if(this.wasDrawing){for(const e in this.sweepToMesh)this.removeSweepFromScene(e);this.wasDrawing=!1}}dispose(){for(const e in this.sweepToMesh){const t=this.sweepToMesh[e];t.material.dispose(),t.geometry.dispose()}}activate(e){this.wasDrawing=!1;const t=new PuckComparator(this.sweepViewData);this.bindings.push(this.input.registerMeshHandler(o.z,t,((t,i)=>{e.commandBinder.issueCommand(new s.kR(this.getSweepId(i.id),!0,this.selectionDuration)),e.broadcast(new u.Z(this.getSweepId(i.id),!0))}))),this.bindings.push(this.input.registerMeshHandler(o.A,t,((t,i)=>{e.commandBinder.issueCommand(new s.kR(this.getSweepId(i.id),!1,this.selectionDuration)),e.broadcast(new u.Z(this.getSweepId(i.id),!1))}))),this.bindings.push(this.input.registerMeshHandler(r.R,t,((t,i)=>{const n=this.sweepViewData.getSweep(this.colliderToSweep[i.id]).index,s=this.sweepViewData.getAlignedSweeps(!0).length;e.broadcast(new a.Z(this.colliderToSweep[i.id],n,s))})))}deactivate(e){for(const e in this.sweepToMesh)this.removeSweepFromScene(e);for(const e of this.bindings)e.cancel();this.bindings.length=0}}class PuckComparator{constructor(e){this.sweepViewData=e}compare(e){if(e instanceof PuckCollider){return this.sweepViewData.getSweepVisibility(this.sweepViewData.getSweep(e.userData.sid))}return!1}}},83981:(e,t,i)=>{"use strict";i.d(t,{k:()=>o});var n=i(60778),s=i(29480);const o=(0,n.p)(s)},80909:(e,t,i)=>{"use strict";i.d(t,{s:()=>TogglePuckEditingCommand});var n=i(99681);class TogglePuckEditingCommand extends n.m{constructor(e){super(),this.id="TOGGLE_PUCK_EDITING",this.payload={enabled:e}}}},82611:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>SweepPucks});var n=i(54122),s=i(2212),o=i(75712),r=i(12505),a=i(61718),l=i(74958),c=i(79979),h=i(80909),d=i(39869),u=i(40582),p=i(36073),m=i(75158),g=i(50101),f=i(30963),v=i(39936),y=i(89155),b=i(69275),w=i(12775),S=i(71208),E=i(83981),T=i(55525),M=i(75711),_=i(73029);const x={enabled:E.k,enabledHover:E.k};class SweepPucks extends n.Y{constructor(){super(...arguments),this.name="sweep-pucks",this.IDLE_OPACITY=.3,this.EDITING_OPACITY=.9,this.IDLE_COLOR=new s.Color("white"),this.SELECTION_COLOR=new s.Color(16724312),this.defaultCheckRenderModes=()=>!0,this.unselectingSweep=null,this.editingEnabled=!1,this.selectionBindings=[],this.unselectionBindings=[],this.selectionHandled=!0,this.unselectionHandled=!0,this.handlePuckClickedMessage=e=>{if(!e)throw new Error("SweepPucks -> on PuckClickedMessage: Tried to move to invalid sweep id.");this.canSelectPuck()||this.sweepViewData.data.canTransition()&&this.cameraData.canTransition()&&this.engine.commandBinder.issueCommand(new T.ju({transition:_.y[this.interactionmodeData.mode],sweep:e}))},this.handleSweepSelectionChange=()=>{this.updateHighlightOnSelectedPuck(!1),this.selectedSweep=this.sweepViewData.selectedSweep,this.updateHighlightOnSelectedPuck(!0),this.updateHandlers()},this.updateViewmode=()=>{this.viewmode=this.viewmodeData.currentMode,this.updateHighlightOnSelectedPuck(this.editingEnabled),this.updateHandlers()},this.updateHandlers=()=>{this.selectionHandled=this.toggleHandlers(this.canSelectPuck(),this.selectionBindings,this.selectionHandled),this.unselectionHandled=this.toggleHandlers(this.canUnselectPuck(),this.unselectionBindings,this.unselectionHandled)},this.unselectPuck=()=>{this.unselectingSweep=null,this.sweepViewData.setSelectedSweep(null)},this.onUnselectPuck=e=>{const t=this.sweepViewData.selectedSweep;return t&&(e.down?this.unselectingSweep=t:this.unselectingSweep&&this.unselectPuck()),!0},this.onPointerOnPuck=(e,t)=>{if(e.button!==u.MP.PRIMARY)return;const i=this.renderer.getSweepId(t.id);i&&(e.down?i===this.selectedSweep?this.unselectingSweep=i:(this.unselectingSweep=null,this.sweepViewData.setSelectedSweep(i)):(i===this.unselectingSweep&&this.unselectPuck(),this.unselectingSweep=null))}}async init(e,t){this.engine=t,void 0!==e.checkRenderModes&&(this.defaultCheckRenderModes=e.checkRenderModes);const i=(await t.getModule(g.default)).getScene(),n=await t.getModule(f.default),[s,d,u,S,E]=await Promise.all([t.market.waitForData(v.e),t.market.waitForData(y.M_),t.market.waitForData(b.D),t.market.waitForData(w.O),t.market.waitForData(M.Z)]);this.viewmodeData=S,this.viewmode=S.currentMode,this.sweepViewData=u,this.cameraData=d,this.interactionmodeData=E;this.renderer=new l.C$(i.scene,n,s,u,x,!0,this.defaultCheckRenderModes,this.IDLE_COLOR,this.SELECTION_COLOR,this.IDLE_OPACITY,this.EDITING_OPACITY,void 0,void 0,t.claimRenderLayer(this.name)),t.addComponent(this,this.renderer),this.bindings.push(t.commandBinder.addBinding(h.s,(async e=>this.togglePuckEditing(e.enabled))),t.subscribe(c.Z,(e=>this.handlePuckClickedMessage(e.sweepId)))),this.selectionBindings.push(n.registerMeshHandler(p.er,o.s.isType(l.YY),this.onPointerOnPuck),n.registerHandler(p.mE,(()=>{this.unselectingSweep=null}))),this.selectionHandled=this.toggleHandlers(!1,this.selectionBindings,this.selectionHandled),this.selectionSub=this.sweepViewData.onSelectedSweepChanged(this.handleSweepSelectionChange),this.selectionSub.cancel(),this.unselectionBindings.push(n.registerPriorityHandler(m.R,a.S,(()=>!0)),n.registerPriorityHandler(p.er,a.S,this.onUnselectPuck),n.registerPriorityHandler(p.er,r.i,this.onUnselectPuck)),this.unselectionHandled=this.toggleHandlers(!1,this.unselectionBindings,this.unselectionHandled)}dispose(e){for(const e of this.bindings)e.cancel();this.bindings=[],this.togglePuckEditing(!1),super.dispose(e)}updatePuckImagery(e={}){const t=Object.assign(Object.assign({},x),e);t.disabled&&!t.disabledHover&&(t.disabledHover=t.disabled),this.renderer.updatePuckImagery(t)}updateCheckRenderModes(e){this.renderer.updateCheckRenderModes(e||this.defaultCheckRenderModes)}updateHighlightOnSelectedPuck(e){const t=this.selectedSweep;if(t){if(!this.sweepViewData.isSweepAligned(t))return;const i=this.viewmode===S.Ey.Dollhouse||this.viewmode===S.Ey.Floorplan;this.renderer.renderPuckHighlight(t,this.editingEnabled&&i&&e)}}togglePuckEditing(e){this.editingEnabled=e,this.selectedSweep=this.sweepViewData.selectedSweep,this.updateViewmode(),this.renderer.toggleEditingEnabled(e),e?(this.engine.subscribe(d.Z,this.updateViewmode),this.selectionSub.renew()):(this.engine.unsubscribe(d.Z,this.updateViewmode),this.selectionSub.cancel())}canUnselectPuck(){const e=this.viewmode===S.Ey.Dollhouse||this.viewmode===S.Ey.Floorplan;return this.editingEnabled&&!!this.selectedSweep&&e}canSelectPuck(){const e=this.viewmode===S.Ey.Dollhouse||this.viewmode===S.Ey.Floorplan;return this.editingEnabled&&e}toggleHandlers(e,t,i){if(e!==i)for(const i of t)e?i.renew():i.cancel();return e}}},98809:(e,t,i)=>{"use strict";i.d(t,{U:()=>n});const n="features/sweep_pucks"},69275:(e,t,i)=>{"use strict";i.d(t,{D:()=>SweepViewData});var n=i(19413),s=i(5442),o=i(57369),r=i(17321),a=i(71229),l=i(78909),c=i(290);class SweepState extends l.T{constructor(){super(...arguments),this.visible=!0,this.animation=new c.z(0)}}var h=i(2048);class SweepViewData extends n.V{constructor(e){super(),this.data=e,this.name="sweeps-view",this.states=new a.v,this.toolStateObservable=(0,s.Y)(h._.CLOSED),this.defaultSweepVisibilityRule=e=>e.enabled,this.sweepVisibilityRule=this.defaultSweepVisibilityRule,this.selectCurrentSweep=()=>{this.setSelectedSweep(this.data.currentSweep||null)},this.derivedData={},this.selectedSweepObservable=new s.f(null);const t=[h._.MOVING,h._.PLACING,h._.PRESSING,h._.ROTATING];e.makeSweepChangeSubscription((()=>{t.includes(this.toolState)||this.selectCurrentSweep()})),e.iterate((e=>{const t=new SweepState;this.states.set(e.id,t),t.commit()})),this.updateViewData()}updateViewData(){this.data.iterate(((e,t)=>{this.derivedData[e.id]=this.makeViewDataForSweep(e,t)})),this.commit()}updateSweepVisibilityRule(e){this.sweepVisibilityRule=e||this.defaultSweepVisibilityRule}getSweepVisibility(e){return this.sweepVisibilityRule(e)}get selectedSweep(){return this.selectedSweepObservable.value}setSelectedSweep(e){this.selectedSweepObservable.value=e}onSelectedSweepChanged(e){return this.selectedSweepObservable.onChanged(e)}setToolState(e){e===h._.PLACING&&this.selectedSweep&&this.setSelectedSweep(null),this.toolStateObservable.value=e}get toolState(){return this.toolStateObservable.value}onToolStateChanged(e,t=!1){const i=this.toolStateObservable.onChanged(e);return t&&i.renew(),i}getSweep(e){return this.data.getSweep(e)}makeViewDataForSweep(e,t){const i=this.derivedData[e.id];return i?(i.floorId=e.floorId,i.position=e.position,i.alignmentType=e.alignmentType,i.placed=e.placementType===o.hU.MANUAL,i.enabled=e.enabled,i.name=e.name,i):{id:e.id,floorId:e.floorId,position:e.position,index:e.index,alignmentType:e.alignmentType,dataIndex:t,placed:e.placementType===o.hU.MANUAL,enabled:e.enabled,name:e.name}}getViewData(e){const t=this.data.getSweep(e),i=this.derivedData[e];return t&&!i&&(this.derivedData[e]=this.makeViewDataForSweep(t,t.index)),this.derivedData[e]}isSweepAligned(e){return this.data.isSweepAligned(e)}iterate(e){this.data.iterate(e)}getState(e){return this.states.get(e)}isVisible(e){return this.states.get(e).visible}setVisible(e,t){const i=this.getState(e);i.visible!==t&&(i.visible=t,i.commit())}updateAnimations(e){for(const t of this.states)t.animation.tick(e)}modifySelectAnimation(e,t,i){const n=this.getState(e).animation,s=1===n.endValue;t!==s&&(s?n.modifyAnimation(n.value,0,i):n.modifyAnimation(0,1,i))}getIndexByAlignment(e,t){return this.getAlignedSweeps(e).findIndex((e=>e.id===t))}getAlignedSweeps(e){const t=Object.values(this.derivedData);return e?t.filter((0,r._T)()):t.filter((0,r.WO)())}}},2048:(e,t,i)=>{"use strict";var n;i.d(t,{_:()=>n}),function(e){e.CLOSED="closed",e.IDLE="idle",e.PRESSING="pressing",e.PLACING="placing",e.MOVING="moving",e.ROTATING="rotating",e.ROTATED="rotated"}(n||(n={}))},73986:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>SweepViewDataModule});var n=i(54122),s=i(77956),o=i(69275),r=i(85995),a=i(12775),l=i(41479),c=i(22729),h=i(3471),d=i(53339);class SweepViewDataModule extends n.Y{constructor(){super(...arguments),this.name="sweep-viewdata",this.selectionEnabled=!0,this.nonPanoCurrentPuckVisible=!1,this.sweepMap={},this.sweepIdList=[],this.enableSweepSelection=async e=>{this.selectionEnabled=!0},this.disableSweepSelection=async e=>{this.selectionEnabled=!1},this.toggleCurrentPuck=async e=>{this.nonPanoCurrentPuckVisible=e.visible,this.updateVisibility(this.viewData.data.currentSweep)},this.onSweepSelectCommand=async e=>{this.selectionEnabled&&this.viewData.modifySelectAnimation(e.id,e.selected,e.duration)},this.onSweepHoverCommand=async e=>{this.viewData.modifySelectAnimation(e.id,e.hovered,e.duration)},this.updateVisibility=async e=>{if(this.viewmodeData.isPano()){if(e){const t=this.viewData.getSweep(e).neighbours;this.viewData.iterate((e=>{const i=this.viewData.getSweepVisibility(e)&&-1!==t.indexOf(e.id);this.viewData.setVisible(e.id,i)})),this.viewData.setVisible(e,!1)}}else this.viewData.iterate((e=>{this.viewData.setVisible(e.id,this.floorsViewData.isCurrentOrAllFloors(e.floorId))})),e&&this.viewData.setVisible(e,this.nonPanoCurrentPuckVisible)}}async init(e,t){this.data=await t.market.waitForData(s.Z),this.viewData=t.market.tryGetData(o.D)||new o.D(this.data),t.market.register(this,o.D,this.viewData),this.bindings.push(t.commandBinder.addBinding(r.iF,this.onSweepSelectCommand),t.commandBinder.addBinding(r.kR,this.onSweepHoverCommand),t.commandBinder.addBinding(r.zd,this.enableSweepSelection),t.commandBinder.addBinding(r.ZD,this.disableSweepSelection),t.commandBinder.addBinding(r.e9,this.toggleCurrentPuck),this.data.onChanged((()=>this.viewData.updateViewData())),t.msgBus.subscribe(d.sY,(()=>this.viewData.updateViewData()))),this.viewmodeData=await t.market.waitForData(a.O),this.floorsViewData=await t.market.waitForData(c.c),this.bindings.push(this.data.onPropertyChanged("currentSweep",this.updateVisibility),t.subscribe(l.P,(()=>this.updateVisibility(this.viewData.data.currentSweep))),t.subscribe(h.bS,(()=>this.updateVisibility(this.viewData.data.currentSweep))),this.viewmodeData.makeModeChangeSubscription((()=>this.updateVisibility(this.viewData.data.currentSweep)))),this.updateVisibility(this.viewData.data.currentSweep)}onUpdate(e){this.viewData.updateAnimations(e)}}},85282:(e,t,i)=>{"use strict";i.d(t,{n:()=>TagsViewData});var n=i(19413),s=i(5442),o=i(90134),r=i(51090),a=i(6999);class TagsViewData extends n.V{constructor(e,t,i,n){super(),this.data=e,this.attachmentsData=t,this.backgroundTexture=i,this.maskTexture=n,this.name="tags-view-data",this.tagCreation=!1,this.tagSelectedOnly=!1,this.allTagViews=(0,o.C)([]),this.enabledTagViews=(0,o.C)([]),this.openTagViewObservable=(0,s.Y)(null),this.tagToolStateObservable=(0,s.Y)(a.p.CLOSED),this.listIndexObservable=(0,s.Y)(-1),this.updateViewData()}getData(){return this.data}getEnabledTagViews(){return this.enabledTagViews}getAllTagViews(){return this.allTagViews}getTagCount(){return this.data.collection.length}getTagView(e){const t=this.allTagViews.findIndex((t=>t.id===e));return-1!==t?this.allTagViews.get(t):null}getCurrentTagViewByIndex(e){return-1!==e?this.enabledTagViews.get(e):null}updateViewData(){const e=[];this.data.iterate((t=>{const i=this.createTagView(t);e.push(i)})),this.allTagViews.replace(e),this.updateEnabledTagViews()}getFilteredTags(){const e=[];return this.allTagViews.forEach((t=>{t.enabled&&e.push(t)})),e}updateEnabledTagViews(){const e=this.getFilteredTags().sort(((e,t)=>t.created.getTime()-e.created.getTime()));this.enabledTagViews.replace(e)}createTagView(e){return{id:e.sid,created:e.created,modified:e.modified,label:e.label,description:e.description,enabled:e.enabled,color:`#${e.color.getHexString()}`,anchorPosition:e.anchorPosition,floorId:e.floorId,roomId:e.roomId,stemNormal:e.stemVector,stemLength:e.stemHeight,stemEnabled:e.stemVisible,widgetFrame:e.widgetFrame,attachments:this.attachmentsData.getAttachmentsForAsset(e.sid,r.h.MATTERTAG),backgroundTexture:this.backgroundTexture,maskTexture:this.maskTexture}}get creatingTag(){return this.tagCreation}setCreatingTag(e){this.tagCreation=e}get selectedPreview(){return this.tagSelectedOnly}setTagsToolState(e){this.tagToolStateObservable.value=e}get tagsToolState(){return this.tagToolStateObservable.value}onTagsToolStateChanged(e){return this.tagToolStateObservable.onChanged(e)}setListIndex(e){this.listIndexObservable.value=e}get listIndex(){return this.listIndexObservable.value}onListIndexChanged(e){return this.listIndexObservable.onChanged(e)}setOpenTagView(e,t=!1){e===this.openTagViewObservable.value&&this.tagSelectedOnly!==t?(this.tagSelectedOnly=t,this.openTagViewObservable.setDirty()):(this.tagSelectedOnly=t,this.openTagViewObservable.value=e)}get openTagView(){return this.openTagViewObservable.value}onOpenTagViewChanged(e){return this.openTagViewObservable.onChanged(e)}updateOpenTagView(e){const t=this.openTagView;if(t){const i=Object.assign(Object.assign({},t),e);this.setOpenTagView(i)}}}},87493:(e,t,i)=>{"use strict";i.d(t,{bF:()=>TagsToggleCommand,lt:()=>OpenTagCommand,YC:()=>SelectTagCommand,X8:()=>PreviewTagCommand,xb:()=>CloseTagCommand,P3:()=>ToggleTagVisibilityCommand,mt:()=>ToggleTagToolEditorCommand,wZ:()=>SaveTagAppearanceCommand});var n=i(99681),s=i(47924);class TagsToggleCommand extends n.m{constructor(e){super(),this.payload={opened:e}}}class OpenTagCommand extends n.m{constructor(e,t,i,n=-1){super(),this.payload={id:e,listIndex:n,transition:t,attachmentId:i}}}class SelectTagCommand extends n.m{constructor(e,t=s.n.Instant){super(),this.payload={id:e,transition:t}}}class PreviewTagCommand extends n.m{constructor(e){super(),this.payload={id:e}}}class CloseTagCommand extends n.m{constructor(){super()}}class ToggleTagVisibilityCommand extends n.m{constructor(e,t){super(),this.payload={id:e,visible:t}}}class ToggleTagToolEditorCommand extends n.m{constructor(e){super(),this.payload={opened:e}}}class SaveTagAppearanceCommand extends n.m{constructor(e,t){super(),this.payload={id:e,properties:t}}}},6999:(e,t,i)=>{"use strict";var n;i.d(t,{p:()=>n}),function(e){e.CLOSED="closed",e.IDLE="idle",e.CREATING="creating",e.OPENING="opening",e.VIEWING="viewing",e.ANNOTATING="annotating",e.EDITING="editing"}(n||(n={}))},95552:(e,t,i)=>{"use strict";i.r(t),i.d(t,{CloseTagCommand:()=>T.xb,OpenTagCommand:()=>T.lt,PreviewTagCommand:()=>T.X8,SaveTagAppearanceCommand:()=>T.wZ,SelectTagCommand:()=>T.YC,TagDeletedMessage:()=>TagDeletedMessage,TagsToggleCommand:()=>T.bF,TagsToolState:()=>S.p,TagsViewData:()=>E.n,ToggleTagToolEditorCommand:()=>T.mt,ToggleTagVisibilityCommand:()=>T.P3,default:()=>C});var n=i(54122),s=i(60778),o=i(80517),r=i(89411),a=i(47924),l=i(51090),c=i(28615),h=i(55525),d=i(61155),u=i(90926),p=i(68611),m=i(43770),g=i(43711),f=i(90601),v=i(6201),y=i(71583),b=i(91172),w=i(20983),S=i(6999),E=i(85282),T=i(87493),M=i(36520),_=i(73305),x=i(77956),A=i(39936),O=i(12775);class TagsModule extends n.Y{constructor(){super(...arguments),this.name="tags-module",this.activated=!1,this.registered=!1,this.activeBindings=[],this.updatePerSettings=()=>{const e=this.settingsData.tryGetProperty(b.re,!1),t=!this.in360View();this.pinRenderer.setPinTypeVisible(u.Er.MATTERTAG,t&&e)},this.togglePinAssetEditor=async e=>{e.opened?this.viewData.setTagsToolState(S.p.EDITING):this.viewData.tagsToolState===S.p.EDITING&&this.viewData.setTagsToolState(S.p.VIEWING)},this.onCloseTag=async()=>{this.closeTag()},this.tagsWereChanged=()=>{this.viewData.updateViewData()},this.onOpenTagViewChanged=()=>{const e=this.viewData.openTagView;e&&this.updateTag(e)},this.onDeselectTag=e=>{e.pinType===u.Er.MATTERTAG&&this.closeTag()},this.onPreviewTag=async e=>{const t=this.viewData.getTagView(e.id);t&&this.engine.commandBinder.issueCommand(new p._l(t,u.Er.MATTERTAG))},this.onSelectTag=async e=>{const{viewData:t,engine:i,log:n,pinRenderer:s}=this,{id:o,transition:r}=e,a=t.getTagView(o);if(a){await i.commandBinder.issueCommand(new g.tT(f.w1.TAGS,!0,!1)),s.hideSelectedMesh(),await i.commandBinder.issueCommand(new h.OR({pinPosition:a,transition:r})),s.showSelectedMesh(u.Er.MATTERTAG,a.id),i.broadcast(new m.Q4(a,u.Er.MATTERTAG));const e=t.getEnabledTagViews().values().findIndex((e=>e.id===a.id));t.setListIndex(e),t.setOpenTagView(a,!0)}else n.debug("Cannot select a non-existent tag")},this.onOpenTag=async e=>this.openTag(e.id,e.transition,e.attachmentId,e.listIndex),this.saveTagAppearance=async e=>{const t=this.tagsData,i=this.viewData;if(t.getTag(e.id)){const t=e.properties;if(Object.keys(t)){i.updateOpenTagView(t);const e=i.openTagView;e&&this.engine.broadcast(new m.KR(e,u.Er.MATTERTAG))}}else this.log.debug("Cannot update a non-existent tag")},this.tagsToolToggled=async e=>{e.opened?this.activateTool():this.deactivateTool()}}async init(e,t){const[i,n,a,l,c,h]=await Promise.all([t.getModule(d.default),t.market.waitForData(M.b),t.market.waitForData(w.n),t.market.waitForData(x.Z),t.market.waitForData(A.e),t.market.waitForData(O.O)]);this.pinRenderer=i.pinRenderer,this.attachmentsData=n,this.tagsData=a,this.sweepData=l,this.settingsData=c,this.viewmodeData=h,this.engine=t,this.maskTexture=(0,s.p)(r),this.backgroundTexture=(0,s.p)(o),this.viewData=new E.n(this.tagsData,this.attachmentsData,this.backgroundTexture,this.maskTexture),this.bindings.push(c.onPropertyChanged(b.re,this.updatePerSettings),t.commandBinder.addBinding(T.bF,this.tagsToolToggled),t.commandBinder.addBinding(T.lt,this.onOpenTag),t.commandBinder.addBinding(T.xb,this.onCloseTag),t.commandBinder.addBinding(T.YC,this.onSelectTag),t.commandBinder.addBinding(T.X8,this.onPreviewTag),t.subscribe(m.Fe,this.onDeselectTag),this.tagsData.onChanged(this.tagsWereChanged)),this.createMediaEmbedTempAttachments(),t.market.register(this,E.n,this.viewData),this.updatePerSettings(),this.displayTags()}dispose(e){this.deactivateTool(),this.bindings.forEach((e=>{e.cancel()})),this.bindings=[],this.activeBindings=[],this.pinRenderer.removePinsByType(u.Er.MATTERTAG),this.maskTexture.dispose(),this.backgroundTexture.dispose(),super.dispose(e)}activateTool(){this.activated||(this.viewData.setTagsToolState(S.p.CLOSED),this.registered?this.activeBindings.forEach((e=>{e.renew()})):this.registerHandlers(),this.activated=!0)}deactivateTool(){if(!this.activated)return;const{openTagView:e}=this.viewData;e&&this.closeTag(!0),this.viewData.setTagsToolState(S.p.CLOSED),this.activeBindings.forEach((e=>{e.cancel()})),this.activated=!1}onUpdate(){}registerHandlers(){const e=this.engine.commandBinder;this.activeBindings.push(this.viewData.onOpenTagViewChanged(this.onOpenTagViewChanged),e.addBinding(T.wZ,this.saveTagAppearance),e.addBinding(T.mt,this.togglePinAssetEditor)),this.registered=!0}in360View(){const e=this.sweepData.currentSweep?this.sweepData.currentSweep:"";return this.viewmodeData.isPano()&&this.sweepData.isSweepUnaligned(e)}async createMediaEmbedTempAttachments(){const e=[];this.tagsData.iterate((t=>{e.push(this.makeViewingAttachment(t))})),Promise.all(e).then((()=>this.viewData.updateViewData()))}async makeViewingAttachment(e){if(e.mediaSrc&&e.mediaType!==c.z.none&&e.mediaType!==c.z.error){const t=e.mediaType;this.engine.commandBinder.issueCommand(new _.iF(e.sid,t,e.mediaSrc))}}closeTag(e=!1){const t=this.viewData,i=t.openTagView;i&&(this.engine.broadcast(new m.A(i.id,u.Er.MATTERTAG)),this.engine.broadcast(new v.Ur)),t.setTagsToolState(S.p.IDLE),t.setOpenTagView(null),e||this.engine.commandBinder.issueCommand(new g.tT(f.w1.TAGS,!1))}displayTags(){this.viewData.getEnabledTagViews().forEach((e=>{this.updateTag(e)}))}updateTag(e){this.pinRenderer.updatePin(e.id,u.Er.MATTERTAG,e,this.backgroundTexture,this.maskTexture)}async openTag(e,t,i,n=-1){const{viewData:s,engine:o,log:r,pinRenderer:c}=this;await o.commandBinder.issueCommand(new g.tT(f.w1.TAGS,!0,!0));const d=s.getTagView(e);if(d){const r=s.openTagView,p=d.id===(null==r?void 0:r.id)&&s.selectedPreview;if(!r||r.id!==e||p){if(o.broadcast(new m.sD(d,u.Er.MATTERTAG,!1)),s.setOpenTagView(d,!1),!p){const e=null!==t?t:a.n.Instant;null!==e&&(c.hideSelectedMesh(),await o.commandBinder.issueCommand(new h.OR({pinPosition:d,transition:e})),c.showSelectedMesh(u.Er.MATTERTAG,d.id))}o.broadcast(new v.ZL(l.h.MATTERTAG,d.id))}let g=n;-1===g&&(g=s.getEnabledTagViews().values().findIndex((t=>t.id===e))),s.setListIndex(g),i?await o.commandBinder.issueCommand(new _.ms(e,l.h.MATTERTAG,i)):o.commandBinder.issueCommand(new y.rE)}else r.debug("Cannot open a non-existent tag")}}var P=i(93528);class TagDeletedMessage extends P.v{constructor(e){super(),this.id=e}}const C=TagsModule},21685:(e,t,i)=>{"use strict";i.d(t,{R:()=>n});const n="features/tag-annotations";Object.freeze({colors:["#d44441","#f44336","#e91e63","#f78da7","#9c4b92","#673ab7","#03687d","#03a9f4","#00bcd4","#417505","#51a868","#37d67a","#cddc39","#fbcd00","#ffac17","#ff6900","#abb8c3","#607d8b"]})},27691:(e,t,i)=>{"use strict";i.d(t,{U:()=>Tool});var n=i(78909);class Tool extends n.T{constructor(e){super(),e&&Object.assign(this,e)}}},48769:(e,t,i)=>{"use strict";i.d(t,{t:()=>ToolsData});var n=i(19413),s=i(5442),o=i(71229),r=i(90601);class ToolsData extends n.V{constructor(){super(),this.name="tools-data",this.tools=(0,o.q)(),this.toolsLoadedObservable=(0,s.Y)(!1),this.openAssetObservable=(0,s.Y)(null),this.activeToolOpen=!1,this.activeToolNameObservable=(0,s.Y)(null),this.openModalObservable=(0,s.Y)(null),this.toolAccessObservable=(0,s.Y)(r.X$.SCENE),this.panelLayoutObservable=(0,s.Y)(r.wS.NONE),this.panelCollapsedObservable=(0,s.Y)(!1)}addTools(e){e.forEach((e=>{this.addTool(e)})),this.toolsLoadedObservable.value=!0}iterate(e){for(const t of this.tools)e(t)}get toolsMap(){return this.tools}getTool(e){return this.tools.get(e)}addTool(e){this.tools.set(e.id,e)}removeTool(e){this.tools.delete(e)}removeAllTools(){this.tools=(0,o.q)(),this.toolsLoadedObservable.value=!1}get openAsset(){return this.openAssetObservable.value}setOpenAsset(e){this.openAssetObservable.value=e}onOpenAssetChanged(e){return this.openAssetObservable.onChanged(e)}getActiveTool(){return this.activeToolName?this.getTool(this.activeToolName):null}get activeToolName(){return this.activeToolNameObservable.value}get toolOpen(){return this.activeToolOpen}setActiveTool(e,t=!1){e===this.activeToolNameObservable.value&&this.activeToolOpen!==t?(this.activeToolOpen=t,this.activeToolNameObservable.setDirty()):(this.activeToolOpen=t,this.activeToolNameObservable.value=e)}onToolChanged(e){return this.activeToolNameObservable.onChanged(e)}get openModal(){return this.openModalObservable.value}setOpenModal(e){this.openModalObservable.value=e}onOpenModalChanged(e){return this.openModalObservable.onChanged(e)}onToolsLoadedChanged(e){return this.toolsLoadedObservable.onChanged(e)}get toolsLoaded(){return this.toolsLoadedObservable.value}get toolAccess(){return this.toolAccessObservable.value}setToolAccess(e){this.toolAccessObservable.value=e}onToolAssetAccessChanged(e){return this.toolAccessObservable.onChanged(e)}setToolPanelLayout(e){this.panelLayoutObservable.value=e}get toolPanelLayout(){return this.panelLayoutObservable.value}onToolPanelLayoutChanged(e){return this.panelLayoutObservable.onChanged(e)}onPanelCollapsedChanged(e){return this.panelCollapsedObservable.onChanged(e)}setPanelCollapsed(e){this.panelCollapsedObservable.value=e}get panelCollapsed(){return this.panelCollapsedObservable.value}}},43711:(e,t,i)=>{"use strict";i.d(t,{EI:()=>OpenDrawerCommand,$M:()=>CloseDrawerCommand,zK:()=>PanelToggleCollapseCommand,$K:()=>OpenHighlightReelCommand,Cc:()=>OpenHlrSettingsCommand,tT:()=>ToggleToolCommand,Ln:()=>PanelCanvasAdjustmentCommand,Ye:()=>CloseAndRemoveToolsCommand,MV:()=>RegisterToolsCommand});var n=i(99681);class OpenDrawerCommand extends n.m{}OpenDrawerCommand.id="OPEN_DRAWER";class CloseDrawerCommand extends n.m{}CloseDrawerCommand.id="CLOSE_DRAWER";class PanelToggleCollapseCommand extends n.m{constructor(e){super(),this.payload={collapsed:e}}}PanelToggleCollapseCommand.id="TOOL_PANEL_TOGGLE_COLLAPSE";class OpenHighlightReelCommand extends n.m{}OpenHighlightReelCommand.id="OPEN_HIGHLIGHT_REEL";class OpenHlrSettingsCommand extends n.m{constructor(){super(...arguments),this.id="OPEN_HLR_SETTINGS"}}class ToggleToolCommand extends n.m{constructor(e,t,i){super(),this.payload={tool:e,active:t,open:void 0===i?t:i}}}ToggleToolCommand.id="TOGGLE_TOOL";class PanelCanvasAdjustmentCommand extends n.m{constructor(e){super(),this.payload={heightPercentAdjustment:e}}}PanelCanvasAdjustmentCommand.id="TOOL_PANEL_ADJUST_CANVAS";class CloseAndRemoveToolsCommand extends n.m{}CloseAndRemoveToolsCommand.id="CLOSE_REMOVE_TOOLS";class RegisterToolsCommand extends n.m{constructor(e){super(),this.payload={tools:e}}}RegisterToolsCommand.id="REGISTER_TOOLS"},90601:(e,t,i)=>{"use strict";var n,s,o;i.d(t,{w1:()=>n,wS:()=>s,X$:()=>o}),function(e){e.START_LOCATION="START_LOCATION",e.SCANS_3D="SCANS_3D",e.VIEW_360="VIEW_360",e.PHOTOS="PHOTOS",e.LABELS="LABELS",e.MEASUREMENTS="MEASUREMENTS",e.MATTERTAGS="MATTERTAGS",e.HLR="HLR",e.VR_PATH="VR_PATH",e.SETTINGS_PANEL="SETTINGS_PANEL",e.NOTES="NOTES",e.TAGS="TAGS",e.BLUR="BLUR"}(n||(n={})),function(e){e.NONE="none",e.SIDE_PANEL="side-panel",e.BOTTOM_PANEL="bottom-panel"}(s||(s={})),function(e){e.SCENE="scene",e.TOOL="tool",e.LIST="list"}(o||(o={}))},65213:(e,t,i)=>{"use strict";i.r(t),i.d(t,{CloseAndRemoveToolsCommand:()=>h.Ye,CloseDrawerCommand:()=>h.$M,OpenDrawerCommand:()=>h.EI,OpenHighlightReelCommand:()=>h.$K,OpenHlrSettingsCommand:()=>h.Cc,PanelCanvasAdjustmentCommand:()=>h.Ln,PanelToggleCollapseCommand:()=>h.zK,RegisterToolsCommand:()=>h.MV,ToggleToolCommand:()=>h.tT,Tool:()=>b.U,ToolAccess:()=>l.X$,ToolAssetClosedMessage:()=>d.Ur,ToolAssetOpenedMessage:()=>d.ZL,ToolPanelLayout:()=>l.wS,ToolToggledMessage:()=>d.Oj,Tools:()=>l.w1,ToolsData:()=>c.t,default:()=>w});var n=i(54122),s=i(13931),o=i(23338),r=i(25799),a=i(29675),l=i(90601),c=i(48769);var h=i(43711),d=i(6201),u=i(71583),p=i(82209),m=i(12856),g=i(29677),f=i(88069),v=i(24779),y=i(39936);class ToolsModule extends n.Y{constructor(){super(...arguments),this.name="tools-module",this.log=new r.Z(this.name),this.heightPercentAdjustment=0,this.activeToolDurationMap={},this.classNameTimeout=0,this.closeAndRemoveTools=async()=>{await this.closeActiveTool(!0),this.toolsData.removeAllTools()},this.onPanelLayoutChanged=()=>{const{toolPanelLayout:e,openModal:t,openAsset:i}=this.toolsData,n=this.mainDiv.classList;switch(window.clearTimeout(this.classNameTimeout),e===l.wS.BOTTOM_PANEL&&!t&&i?this.heightPercentAdjustment=50:this.heightPercentAdjustment=0,this.adjustCanvasForPanel(),e){case l.wS.SIDE_PANEL:n.add("side-panel-layout"),n.remove("bottom-panel-layout");break;case l.wS.BOTTOM_PANEL:if(t!==m.P.ATTACHMENT){n.add("bottom-panel-layout"),n.remove("side-panel-layout");break}case l.wS.NONE:n.contains("side-panel-layout")?this.classNameTimeout=window.setTimeout((()=>{n.remove("side-panel-layout","bottom-panel-layout")}),600):n.remove("side-panel-layout","bottom-panel-layout")}},this.onAssetOpened=e=>{this.toolsData.openAsset||this.toolsData.toolPanelLayout!==l.wS.BOTTOM_PANEL||(this.heightPercentAdjustment=50,this.adjustCanvasForPanel()),this.toolsData.setOpenAsset(e.assetType)},this.onAssetClosed=()=>{this.toolsData.toolPanelLayout===l.wS.BOTTOM_PANEL&&(this.heightPercentAdjustment=0,this.adjustCanvasForPanel()),this.toolsData.setOpenAsset(null)},this.onToggleModal=async e=>{this.toggleModal(e.modal,e.open)},this.closeModal=async()=>{this.toolsData.openModal&&this.toggleModal(this.toolsData.openModal,!1)},this.onToggleTool=async e=>{const{tool:t,active:i,open:n}=e,s=this.toolsData,{activeToolName:o,openModal:r,toolPanelLayout:a,toolOpen:c}=s;if(!i&&t!==o)return;n&&i?this.mainDiv.classList.add("tool-open"):n||(this.mainDiv.classList.remove("tool-open"),a===l.wS.SIDE_PANEL&&this.closePanel());const h=s.getActiveTool(),u=s.getTool(t);if(i&&t===o)return void(c&&!n?s.setActiveTool(t,!1):n&&u&&u.panel&&a===l.wS.NONE&&this.openPanel());r&&this.toggleModal(r,!1);let p=null;h&&(p=h.analytic,await this.closeActiveTool(!i));let m=p;if(i)if(u){u.panel&&n&&this.openPanel(),m=u.analytic;const{manager:e}=u;await e.activate(n),s.setActiveTool(t,n)}else this.log.error(`Tool not loaded: ${t}`);this.trackToolTime(p,m),this.engine.broadcast(new d.Oj(i,n))},this.handleResize=()=>{const e=this.toolsData.toolPanelLayout;e!==l.wS.SIDE_PANEL&&e!==l.wS.BOTTOM_PANEL||this.updateToolPanelLayout()},this.updateToolPanelLayout=()=>{const e=this.toolsData.toolPanelLayout,t=(0,g.OR)();(t&&e!==l.wS.SIDE_PANEL||!t&&e!==l.wS.BOTTOM_PANEL)&&this.toolsData.setToolPanelLayout(t?l.wS.SIDE_PANEL:l.wS.BOTTOM_PANEL)},this.handlePanelCollapse=async e=>{this.toolsData.setPanelCollapsed(e.collapsed),this.toolsData.toolPanelLayout===l.wS.SIDE_PANEL&&this.adjustCanvasForPanel()},this.handleCanvasAdjustment=async e=>{this.toolsData.toolPanelLayout===l.wS.BOTTOM_PANEL?this.heightPercentAdjustment=e.heightPercentAdjustment:this.heightPercentAdjustment=0,this.adjustCanvasForPanel()},this.resizeCanvas=async e=>{this.engine.commandBinder.issueCommand(new v.M(e))}}async init(e,t){this.engine=t,this.mainDiv=e.mainDiv,await t.getModule(o.default),this.analytics=await t.getModule(s.default),[this.settingsData,this.appData]=await Promise.all([t.market.waitForData(y.e),t.market.waitForData(a.pu)]),this.toolsData=new c.t,this.toolsData.setToolPanelLayout(l.wS.NONE),this.bindings.push(t.commandBinder.addBinding(h.tT,this.onToggleTool),t.commandBinder.addBinding(u.Bz,this.onToggleModal),t.commandBinder.addBinding(u.rE,this.closeModal),t.subscribe(d.ZL,this.onAssetOpened),t.subscribe(d.Ur,this.onAssetClosed),this.toolsData.onToolPanelLayoutChanged(this.onPanelLayoutChanged),t.commandBinder.addBinding(h.zK,this.handlePanelCollapse),t.commandBinder.addBinding(h.Ln,this.handleCanvasAdjustment),t.commandBinder.addBinding(h.Ye,this.closeAndRemoveTools),t.commandBinder.addBinding(h.MV,(async({tools:e})=>this.registerTools(...e)))),t.market.register(this,c.t,this.toolsData)}dispose(e){e.market.unregister(this,c.t),this.closeActiveTool(!0)}registerTools(...e){e.forEach((e=>{e.featureFlag&&this.bindings.push(this.settingsData.onPropertyChanged(e.featureFlag,(()=>this.updateEnabledTools())))})),this.toolsData.addTools(e)}async closeActiveTool(e){const t=this.toolsData,i=t.getActiveTool();if(i){const{manager:n}=i;await n.deactivate(),t.toolOpen&&i.panel&&this.closePanel(),this.closeModal(),e&&t.setActiveTool(null)}}closePanel(){window.removeEventListener("resize",this.handleResize),this.toolsData.setToolPanelLayout(l.wS.NONE),this.resizeCanvas((0,f.hf)(0,0,0))}openPanel(){window.addEventListener("resize",this.handleResize),this.updateToolPanelLayout()}toggleModal(e,t){const i=this.toolsData.openModal;if(t&&i===e||!t&&e!==i)return;const n=e.toLowerCase(),s=this.appData.application===a.Mx.WORKSHOP?"workshop_gui":"showcase_gui";this.analytics.track(s,{gui_action:`open_${n}`,opened:t}),e&&this.analytics.track("modal_shown",{modal:e}),this.toolsData.setOpenModal(t?e:null),t?this.mainDiv.classList.add("modal-open"):this.mainDiv.classList.remove("modal-open"),this.engine.broadcast(new p.nV(e,t)),e===m.P.ATTACHMENT&&this.toolsData.toolPanelLayout===l.wS.BOTTOM_PANEL&&(t?(this.heightPercentAdjustment=0,this.adjustCanvasForPanel()):window.setTimeout((()=>{this.heightPercentAdjustment=50,this.adjustCanvasForPanel()}),200))}trackToolTime(e,t){if(t&&e!==t&&(this.activeToolDurationMap[t]=Date.now()),e){this.activeToolDurationMap[e]=Date.now()-this.activeToolDurationMap[e];const t={tool:`${e}_session_time`,duration:this.activeToolDurationMap[e]};this.analytics.track("tool_session_time",t)}}adjustCanvasForPanel(){const{toolPanelLayout:e,panelCollapsed:t}=this.toolsData;if(e!==l.wS.SIDE_PANEL||t)if(e===l.wS.BOTTOM_PANEL){const e=Math.floor(window.innerHeight*this.heightPercentAdjustment/100);window.setTimeout((()=>{this.resizeCanvas((0,f.hf)(0,-e,g.O8))}),250)}else this.resizeCanvas((0,f.hf)(0,0,0));else this.resizeCanvas((0,f.hf)(-g.LH,0,g.O8))}updateEnabledTools(){const e=this.toolsData.toolsMap;e.atomic((()=>{for(const t of e)if(t.featureFlag){const e=this.settingsData.tryGetProperty(t.featureFlag,!1);t.enabled!==e&&(t.enabled=e,t.commit())}}))}}var b=i(27691);const w=ToolsModule},6201:(e,t,i)=>{"use strict";i.d(t,{Oj:()=>ToolToggledMessage,ZL:()=>ToolAssetOpenedMessage,Ur:()=>ToolAssetClosedMessage});var n=i(93528);class ToolToggledMessage extends n.v{constructor(e,t){super(),this.active=e,this.open=t}}class ToolAssetOpenedMessage extends n.v{constructor(e,t){super(),this.assetType=e,this.assetId=t}}class ToolAssetClosedMessage extends n.v{}},19417:(e,t,i)=>{"use strict";i.d(t,{TH:()=>TourStartCommand,vy:()=>TourStopCommand,rU:()=>TourStepCommand,HW:()=>TourRelativeCommand});var n=i(99681);class TourStartCommand extends n.m{constructor(e,t,i){super(),this.id="TOUR_START",this.payload={index:e,loop:t,steps:i}}}class TourStopCommand extends n.m{constructor(){super(...arguments),this.id="TOUR_STOP"}}class TourStepCommand extends n.m{constructor(e,t=!1){super(),this.id="TOUR_STEP",this.payload={index:e,instant:t}}}class TourRelativeCommand extends n.m{constructor(e,t=!1){super(),this.id="TOUR_RELATIVE",this.payload={forward:e,instant:t}}}},23549:(e,t,i)=>{"use strict";i.d(t,{z:()=>TourTransitionError,Y:()=>TourStartError});var n=i(17617);class TourTransitionError extends n.y{constructor(e="Invalid tour transition"){super(e),this.name="TourTransition"}}class TourStartError extends n.y{constructor(e="Cannot start tour"){super(e),this.name="TourStart"}}},44228:(e,t,i)=>{"use strict";var n,s,o;i.d(t,{BZ:()=>n,kw:()=>s,Aq:()=>o}),function(e){e[e.Pan=0]="Pan",e[e.PanDollhouse=1]="PanDollhouse",e[e.Zoom=2]="Zoom",e[e.Delay=3]="Delay",e[e.None=4]="None"}(n||(n={})),function(e){e[e.Left=1]="Left",e[e.Auto=0]="Auto",e[e.Right=-1]="Right"}(s||(s={})),function(e){e[e.Move=0]="Move",e[e.Burns=1]="Burns",e[e.Zoom=2]="Zoom",e[e.Path=3]="Path",e[e.FloorChange=4]="FloorChange",e[e.Delay=5]="Delay",e[e.Nop=6]="Nop"}(o||(o={}))},64309:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});const n="cwf/src/modules/tours-controls"},53339:(e,t,i)=>{"use strict";i.d(t,{oR:()=>TourStartedMessage,Vx:()=>TourSteppedMessage,NR:()=>TourStoppedMessage,Mt:()=>TourEndedMessage,sY:()=>TourStopAddedMessage,dW:()=>TourStartTransitionMessage});var n=i(93528);class TourStartedMessage extends n.v{}class TourSteppedMessage extends n.v{constructor(e){super(),this.index=e}}class TourStoppedMessage extends n.v{}class TourEndedMessage extends n.v{}class TourStopAddedMessage extends n.v{}class TourStartTransitionMessage extends n.v{}},27545:(e,t,i)=>{"use strict";i.d(t,{WQ:()=>o,EU:()=>r,OJ:()=>a,BY:()=>l,Im:()=>c,LO:()=>h,N5:()=>d,Qo:()=>u,Pv:()=>p,Mk:()=>m,mL:()=>g,eu:()=>f,NY:()=>v,gS:()=>y,O2:()=>b,rM:()=>w,z8:()=>S,f7:()=>E,Cp:()=>T,_D:()=>M,HJ:()=>_,BA:()=>x,pn:()=>A,z$:()=>O,b_:()=>P,mS:()=>C,su:()=>D,_c:()=>I,Xd:()=>R});var n=i(21265),s=i(89997);const o="TourSpeed &wts",r="ToursMetersPerSecond",a=.4,l=10,c=1.25,h=.8,d=6,u=3,p=1e3*h,m=1e3*c,g=600,f=400,v=1200,y=1200,b=35,w=15,S=120,E=1200,T=75,M=400,_=s.DEFAULT_TRANSITION_TIME-g,x=35,A=x/3500*1e3,O=2,P=52,C=0,D=.2*A,I=3500,R=Object.freeze({panAtSnapshot:n.hu("kb",1),snapshotPanZoomDuration:n.hu("st",3500),snapshotPanAngle:n.hu("sspa",x),walkingTourIncludeExtraPanosDistance:.4,walkingStageMinimumDistance:.8,maxWalkingSweepsBetweenSnapshots:40,autoStartDelay:n.hu("ts",-1)})},17694:(e,t,i)=>{"use strict";i.d(t,{HG:()=>r,JG:()=>a,mf:()=>l,DA:()=>c});var n=i(2212),s=i(97620),o=i(27545);const r=e=>{let t=o.Im;if(!isNaN(e)){const i=Math.min(Math.max(o.OJ,e),o.BY);t=(0,s.et)(i,o.OJ,o.BY,o.LO,o.Qo)}return t},a=e=>(0,s.et)(e,o.LO,o.N5,o.OJ,o.BY),l=e=>Math.min(Math.max(o.LO,e),o.N5),c=e=>n.MathUtils.degToRad(e)/1e3},98728:(e,t,i)=>{"use strict";i.d(t,{Vs:()=>n,k3:()=>TourData});var n,s,o=i(19413),r=i(44228);!function(e){e[e.Inactive=0]="Inactive",e[e.Active=1]="Active",e[e.StopScheduled=2]="StopScheduled"}(n||(n={})),function(e){e[e.Beginning=0]="Beginning",e[e.Current=1]="Current",e[e.End=2]="End"}(s||(s={}));class TourData extends o.V{constructor(e={},t,i,s,o){super(),this.snapshots=e,this.activeReel=t,this.allowedModes=i,this.modelSweeps=s,this.looping=o,this.name="tour",this.enabledTourStops=[],this.tourPlaying=!1,this.tourEnded=!1,this.updateEnabledStops=e=>{if(this.enabledTourStops=[],this.activeReel&&this.activeReel.reel)for(const t of this.activeReel.reel)if(t&&t.sid in this.snapshots){const i=this.snapshots[t.sid],n=i.metadata.cameraMode,s=i.metadata.scanId,o=-1!==e.indexOf(n),r=this.modelSweeps.findIndex((e=>e.id===s)),a=void 0!==s&&-1!==r&&this.modelSweeps[r].enabled,l=!s;o&&(l||a)&&this.enabledTourStops.push(t.sid)}},this.updateEnabledStops(i),this.tourState=n.Inactive,this.tourCurrentSnapshot=-1,this.transition={active:!1,type:r.Aq.Move,promise:Promise.resolve(),stop:()=>Promise.resolve(),toIndex:-1},this.looping=o,this.commit()}addSnapshotToTour(e,t=s.Current){this.snapshots[e.sid]=e;this.allowedModes.includes(e.metadata.cameraMode)&&this.enabledTourStops.push(e.sid);const i=this.tourCurrentSnapshotSid;switch(this.tourCurrentSnapshotSid=e.sid,t){case s.Beginning:this.tourCurrentSnapshot=0,this.activeReel.reel.insert(0,{sid:e.sid});break;case s.End:this.tourCurrentSnapshot=this.enabledTourStops.length-1,this.activeReel.reel.push({sid:e.sid});break;case s.Current:if(void 0===i)this.tourCurrentSnapshot=this.enabledTourStops.length-1,this.activeReel.reel.push({sid:e.sid});else{let t=this.activeReel.reel.findIndex((e=>!!e&&e.sid===i))+1;(t<=0||t>this.activeReel.reel.length)&&(t=this.activeReel.reel.length-1),this.tourCurrentSnapshot=this.tourCurrentSnapshot+1,this.activeReel.reel.insert(t,{sid:e.sid})}break;default:throw new Error(`Tours.addSnapshotToTour not implemented: ${t}`)}this.commit()}clearHighlightOverrides(e,t,i){if(!t&&!i)return;const n={};t&&(n.transitionType=void 0),i&&(n.panDirection=void 0,n.panAngle=void 0),this.applyHighlightOverrides(e,n)}clearAllHighlightOverrides(){this.getReel().reel.forEach((e=>{e&&this.clearHighlightOverrides(e.sid,!0,!0)}))}resetAllTransitionTypeOverrides(){if(this.activeReel&&this.activeReel.reel){let e=!1;this.activeReel.reel.forEach(((t,i)=>{t&&t.overrides&&t.overrides.transitionType&&(delete t.overrides.transitionType,this.activeReel.reel.update(i,t),e=!0)})),e&&this.activeReel.setDirty()}}resetAllPanSettingOverrides(){if(this.activeReel&&this.activeReel.reel){let e=!1;this.activeReel.reel.forEach(((t,i)=>{t&&t.overrides&&(void 0===t.overrides.panAngle&&void 0===t.overrides.panDirection||(delete t.overrides.panAngle,delete t.overrides.panDirection,e=!0,this.activeReel.reel.update(i,t)))})),e&&this.activeReel.setDirty()}}applyHighlightOverrides(e,t){const i=this.activeReel.reel.findIndex((t=>!!t&&t.sid===e));this.setHighlightOverrides(i,t)}setHighlightOverrides(e,t){const i=this.activeReel.reel.get(e);if(!i)throw Error(`Highlight not found for ${e}`);const n={sid:i.sid};i.overrides?(n.overrides=Object.assign({},i.overrides),t.hasOwnProperty("panDirection")&&(n.overrides.panDirection=t.panDirection),t.hasOwnProperty("transitionType")&&(n.overrides.transitionType=t.transitionType),t.hasOwnProperty("panAngle")&&(n.overrides.panAngle=t.panAngle)):n.overrides={transitionType:t.transitionType,panDirection:t.panDirection,panAngle:t.panAngle},this.activeReel.reel.update(e,n)}moveTourStop(e,t){const i=this.activeReel.reel.findIndex((t=>!!t&&t.sid===e)),n=this.activeReel.reel.findIndex((e=>!!e&&e.sid===t));this.activeReel.reel.move(i,n)}clear(){this.resetEmptyReel(),this.enabledTourStops.length=0,this.activeReel.reel.length=0,this.commit()}removeTourStop(e){const t=this.enabledTourStops.indexOf(e),i=this.activeReel.reel.findIndex((t=>!!t&&t.sid===e)),n=this.getTourIndexBySid(e);if(-1!==t&&this.enabledTourStops.splice(t,1),this.enabledTourStops.length>0){const e=n<=this.tourCurrentSnapshot?this.tourCurrentSnapshot-1:this.tourCurrentSnapshot;this.setTourCurrentSnapshotByIndex(Math.max(e,0))}else this.resetEmptyReel();this.activeReel.reel.remove(i)}getReel(){return this.activeReel}clone(){const e=new TourData({},this.activeReel,this.allowedModes,this.modelSweeps,this.looping);for(const t of Object.keys(this.snapshots)){const i=this.snapshots[t];e.snapshots[t]=i.clone()}return e}copy(e){for(const t in e.snapshots)this.snapshots[t]=e.snapshots[t];this.activeReel=e.activeReel,this.allowedModes=e.allowedModes,this.tourState=e.tourState,this.tourPlaying=e.tourPlaying,this.tourEnded=e.tourEnded,this.tourCurrentSnapshot=e.tourCurrentSnapshot,this.tourCurrentSnapshotSid=e.tourCurrentSnapshotSid,this.modelSweeps=e.modelSweeps,this.looping=e.looping,this.updateEnabledStops(this.allowedModes)}isLooping(){return this.looping}isTourActive(){return this.tourState!==n.Inactive}getCurrentTourState(){return{currentStep:this.getTourCurrentSnapshotIndex(),tourPlaying:this.tourPlaying,totalSteps:this.getSnapshotCount(),tourEnded:this.tourEnded,activeStep:this.transition&&-1!==this.transition.toIndex?this.transition.toIndex:this.getTourCurrentSnapshotIndex(),highlights:this.getReelHighlights(),transition:this.transition}}isTourTransitionActive(){return this.transition.active}getTourTransitionType(){return this.transition.type}useTransition(e){this.transition=e}setTourTransitionToIndex(e){this.transition.toIndex=e}async stopTourTransition(){await this.transition.stop()}iterateSnapshots(e){let t=0;this.activeReel.reel.forEach((i=>{if(i&&this.isEnabled(i.sid)){const n=this.snapshots[i.sid];e(n,t++)}}))}isSnapshotInTour(e){return-1!==this.activeReel.reel.findIndex((t=>!!t&&t.sid===e))}getEnabledSnapshots(){const e=[];return this.iterateSnapshots(((t,i)=>{e.push(t)})),e}updateSnapshots(e){this.snapshots=e}async getPhotosForTour(){const e=[];for(const t in this.snapshots){const i=this.snapshots[t];"tour"!==i.category&&"panorama"!==i.category&&e.push({name:i.name,sid:i.sid,thumbnailUrl:await i.thumbnailUrl.get(),inReel:-1!==this.activeReel.reel.findIndex((e=>!!e&&e.sid===t)),created:i.created})}return e.sort(((e,t)=>t.created.getTime()-e.created.getTime())),e}getSnapshot(e){return this.snapshots[e]}getHighlightDescription(e){const t=this.activeReel.reel.findIndex((t=>!!t&&t.sid===e)),i=this.activeReel.reel.get(t);return{snapshot:this.getSnapshot(e),reelEntry:i}}getReelHighlights(){const e=[];return this.activeReel.reel.forEach((t=>{if(t&&this.isEnabled(t.sid)){const i=this.snapshots[t.sid];e.push({sid:i.sid,snapshot:i,panDirection:t.overrides&&t.overrides.panDirection,panAngle:t.overrides&&t.overrides.panAngle,transitionType:t.overrides&&t.overrides.transitionType})}})),e}getSnapshotCount(){return this.enabledTourStops.length}getTourState(){return this.tourState}setTourState(e){this.tourState=e}getTourCurrentSnapshotIndex(){return this.tourCurrentSnapshot}getTourCurrentSnapshotSid(){return this.tourCurrentSnapshotSid}getTourSnapshotSid(e){let t=0;for(const i of this.activeReel.reel)if(i&&this.isEnabled(i.sid)){if(t===e)return i.sid;t++}throw new Error("getTourSnapshotSid() -> Invalid snapshot index.")}getTourSnapshotsWithSweepId(e){const t=[];for(const i of this.activeReel.reel)i&&i.sid in this.snapshots&&this.snapshots[i.sid].metadata.scanId===e&&t.push(i.sid);return t}setTourCurrentSnapshotByIndex(e){if(e<0||e>this.getSnapshotCount())throw new Error("setTourCurrentSnapshotByIndex() -> Invalid tour index.");let t=-1;for(const i of this.activeReel.reel)if(i&&this.isEnabled(i.sid)&&(t++,t===e)){this.tourCurrentSnapshot=e,this.tourCurrentSnapshotSid=i.sid;break}-1===t&&this.resetEmptyReel(),this.setTourTransitionToIndex(-1),this.commit()}getTourIndexBySid(e){let t=-1;for(const i of this.activeReel.reel)if(i&&this.isEnabled(i.sid)&&(t++,i.sid===e))return t;return-1}isEnabled(e){return-1!==this.enabledTourStops.indexOf(e)}resetEmptyReel(){this.tourCurrentSnapshot=-1,this.tourCurrentSnapshotSid=void 0,this.setTourTransitionToIndex(-1),this.commit()}}},63838:(e,t,i)=>{"use strict";i.d(t,{m:()=>UserData});var n=i(19413),s=i(71229),o=i(31305),r=i(21517),a=i(80807);class UserData extends n.V{constructor(e){super(),this.name="users-data",this.users=(0,s.q)(),e&&(this.currentUser=new o.a(e,e.modelAccess),this.addUser(this.currentUser))}load(e){e.forEach((e=>{this.loadUser(e,e.modelAccess)}))}loadUser(e,t){let i=this.users.get(e.id);return i?t&&(i.modelAccess=t):(i=new o.a(e,t),this.addUser(i)),i}getUserInfo(e){return this.users.has(e)?this.users.get(e):null}getUserInfoByEmail(e){return this.users.values.find((t=>t.email===e))||null}getUserInfoDisplayByEmail(e){let t=this.getUserInfoByEmail(e);return t||(t=(0,a.Q)(""),t.email=e),t}getUserInfoDisplay(e){return this.users.has(e)?this.users.get(e):(0,a.Q)(e)}get collection(){return this.users}iterate(e){for(const t of this.users)e(t)}clone(){return(new UserData).copy(this)}copy(e){for(const t of e.users)this.addUser(t);return this}addUser(e){this.users.has(e.id)||this.users.set(e.id,e)}getCurrentUser(){return this.currentUser}isLoggedIn(){return!!this.currentUser.id}isEditor(){return this.currentUser.modelAccess===r.x.FULL}isCommenter(){const{modelAccess:e}=this.currentUser;return e===r.x.FULL||e===r.x.VIEWER}getCurrentUserId(){return this.currentUser.id}}},31305:(e,t,i)=>{"use strict";i.d(t,{a:()=>UserInfo});var n=i(80807),s=i(21517);class UserInfo{constructor(e,t){this.id="",this.email="",this.firstName="",this.lastName="",this.modelAccess=s.x.PUBLIC,this.name="",this.initials="",this.color="",e&&Object.assign(this,e);const i=this.id?this.getFullName(this.firstName,this.lastName):"";this.name=i||this.email||"",this.initials=this.getInitials(this.name),this.color=(0,n._)(this.id),t&&(this.modelAccess=t)}getFullName(e,t){return e&&t?`${e} ${t}`:e||t}getInitials(e){const t=e?e.split(" ").map((e=>e[0])).join(""):"?";return t.length<3?t:`${t[0]}${t[t.length-1]}`}}},72386:(e,t,i)=>{"use strict";i.d(t,{P:()=>UserSearchCommand,J:()=>InviteUsersCommand});var n=i(99681);class UserSearchCommand extends n.m{constructor(e,t,i){super(),this.payload={search:e,ids:t,emails:i}}}class InviteUsersCommand extends n.m{constructor(e,t,i,n,s){super(),this.payload={emails:e,message:t,modelAccess:i,noteId:n,commentId:s}}}},21517:(e,t,i)=>{"use strict";var n;i.d(t,{x:()=>n}),function(e){e.FULL="full",e.VIEWER="viewer",e.PUBLIC="public"}(n||(n={}))},92596:(e,t,i)=>{"use strict";i.r(t),i.d(t,{InviteUsersCommand:()=>u.J,ModelAccess:()=>a.x,OrgUser:()=>OrgUser,UserData:()=>d.m,UserInfo:()=>f.a,UserSearchCommand:()=>u.P,default:()=>v,getUnknownUserInfo:()=>g.Q});var n=i(54122),s=i(25799),o=i(32400),r=i(51770),a=i(21517);class OrgUser{constructor(e){this.id="",this.email="",this.firstName="",this.lastName="",this.modelAccess=a.x.PUBLIC,e&&Object.assign(this,e)}copy(e){return this.id=e.id,this.email=e.email,e.firstName&&(this.firstName=e.firstName),e.lastName&&(this.lastName=e.lastName),e.modelAccess&&(this.modelAccess=e.modelAccess),this}}const l=new s.Z("mds-user-deserializer");class MdsUserDeserializer{constructor(){this.validate=e=>{if(!e)return!1;const t=["id","email"].filter((t=>!(t in e))),i=0===t.length;return i||l.debug("OrgUserMetadata invalid:",{missingFields:t}),i}}deserialize(e){return e&&this.validate(e)?new OrgUser(e):(l.debug("Deserialized invalid OrgUserMetadata from MDS",e),null)}}var c=i(8260);class MdsUserStore extends o.u{constructor(e){super(e),this.deserializer=new MdsUserDeserializer}async search(e,t,i){const n=this.getViewId();return this.query(c.GetUsers,{modelId:n,search:e,ids:t,emails:i}).then((e=>{const t=(0,r.qw)(e,"data.model.users.results");if(!t||!Array.isArray(t))return[];const i=[];for(const e of t){const t=this.deserializer.deserialize(e);t&&i.push(t)}return i}))}}var h=i(17256),d=i(63838),u=i(72386),p=i(55580);const m=new s.Z("users-module");class Users extends n.Y{constructor(){super(...arguments),this.name="users-module",this.store=null,this.searchUsers=async e=>{if(!e.ids&&!e.emails&&!e.search)return void m.warn("No user search criteria");if(!this.store)return;const t=await this.store.search(e.search||void 0,e.ids?Array.from(e.ids):void 0,e.emails?Array.from(e.emails):void 0)||{};this.userData.load(t)},this.inviteUsers=async e=>{const{emails:t,modelAccess:i,message:n,noteId:s}=e;if(0===t.length)return;const{baseUrl:o,modelId:r,queue:a}=this.config,l=`${o}/api/v2/shares/`,c=s?{note:s}:{},h={object_type:"model",object_id:r,role:i,inviter_message:n};return Promise.all(e.emails.map((e=>a.post(l,{responseType:"json",body:Object.assign(h,c,{email:e})}).then((e=>{const t=e.user;this.userData.loadUser({id:t.sid,email:t.email,firstName:t.first_name,lastName:t.last_name},e.role)})).catch((e=>{m.error("User Invite failed",e)})))))}}async init(e,t){const i=await t.market.waitForData(p.T);this.config=e;const n=e.api.user;e.storageProvider===h.Xq.MDS&&(this.store=new MdsUserStore({readonly:!0,baseUrl:e.baseUrl,viewId:e.modelId}));let s=a.x.PUBLIC;n.loggedIn&&n.id&&i.model.editable&&(s=a.x.FULL),this.userData=new d.m({id:n.id,firstName:n.firstName,lastName:n.lastName,email:n.email,modelAccess:s}),this.bindings.push(t.commandBinder.addBinding(u.P,this.searchUsers),t.commandBinder.addBinding(u.J,this.inviteUsers)),t.market.register(this,d.m,this.userData)}}var g=i(80807),f=i(31305);const v=Users},80807:(e,t,i)=>{"use strict";i.d(t,{_:()=>r,Q:()=>a});var n=i(67125),s=i(21517);const o=["#d44441","#f44336","#e91e63","#f78da7","#9c4b92","#673ab7","#5c7fff","#03a9f4","#417505","#00bcd4","#51a868","#37d67a","#cddc39","#fbcd00","#ffac17","#ff6900","#abb8c3","#607d8b"];function r(e){const t=o.length;return o[(0,n.W)(e||"",t)]}function a(e){return{id:e,email:"",firstName:"",lastName:"",name:"Unknown",initials:"?",color:r(e),modelAccess:s.x.PUBLIC}}},72942:(e,t,i)=>{"use strict";i.d(t,{BD:()=>n,g:()=>a,KP:()=>l,ty:()=>c,_i:()=>ChangeViewmodeCommand});var n,s=i(99681),o=i(71208),r=i(47924);!function(e){e.INSIDE="mode.inside",e.OUTSIDE="mode.outside",e.DOLLHOUSE="mode.dollhouse",e.FLOORPLAN="mode.floorplan",e.TRANSITIONING="mode.transitioning"}(n||(n={}));const a=n.INSIDE,l=(n.INSIDE,o.Ey.Panorama,n.DOLLHOUSE,o.Ey.Dollhouse,n.FLOORPLAN,o.Ey.Floorplan,n.TRANSITIONING,o.Ey.Transition,n.OUTSIDE,o.Ey.Outdoor,{[o.Ey.Panorama]:n.INSIDE,[o.Ey.Dollhouse]:n.DOLLHOUSE,[o.Ey.Floorplan]:n.FLOORPLAN,[o.Ey.Transition]:n.TRANSITIONING,[o.Ey.Outdoor]:n.OUTSIDE}),c=e=>{const t=l[e];return void 0!==t?t:n.OUTSIDE};class ChangeViewmodeCommand extends s.m{constructor(e,t=r.n.Interpolate,i={}){super(),this.payload={mode:e,transitionType:t,pose:i}}}ChangeViewmodeCommand.id="CHANGE_VIEWMODE"},43339:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ViewmodeChange});var n=i(62431),s=i(54122),o=i(72942),r=i(89997),a=i(39936),l=i(71208),c=i(47924),h=i(27871),d=i(27829),u=i(2212),p=i(91055),m=i(77956),g=i(17321),f=i(81733),v=i(89155),y=i(55525),b=i(29675),w=i(3471),S=i(12775),E=i(37018),T=i(22729),M=i(32818);class ViewmodeChange extends s.Y{constructor(){super(...arguments),this.name="viewmode-change",this.dhDisabled=()=>!1,this.fpDisabled=()=>!1}async init(e,t){this.engine=t,this.viewmodesModule=await t.getModule(r.default),this.bindings.push(t.subscribe(w.bS,(e=>this.setEnabledModes(e.application))),t.commandBinder.addBinding(o._i,this.onChangeViewmodeCommand.bind(this))),Promise.all([t.market.waitForData(b.pu),t.market.waitForData(a.e)]).then((([e,t])=>{this.settings=t,this.setEnabledModes(e.application)}))}async setEnabledModes(e){if(e===b.Mx.SHOWCASE){if(this.dhDisabled=()=>this.settings.checkUrlParam("dh",0,1)||!this.settings.tryGetProperty(n.gx.Dollhouse,!1),this.fpDisabled=()=>this.settings.checkUrlParam("fp",0,1)||!this.settings.tryGetProperty(n.gx.FloorPlan,!1),!this.previousApp)return;const e=(await this.engine.market.waitForData(S.O)).currentMode;if(e===l.Ey.Dollhouse&&this.dhDisabled()||e===l.Ey.Floorplan&&this.fpDisabled()){const e=(await this.engine.market.waitForData(E.O)).pose;if(e&&e.mode===l.Ey.Panorama)this.goToInsideMode(c.n.Interpolate,{position:e.camera.position});else{const e=(await this.engine.market.waitForData(v.M_)).pose,t=(await this.engine.market.waitForData(m.Z)).getClosestSweep(e.position,!0),i=t?{position:t.position}:void 0;this.goToInsideMode(c.n.Interpolate,i)}}}else e===b.Mx.WORKSHOP&&(this.dhDisabled=()=>!1,this.fpDisabled=()=>!1);this.previousApp=e}async onChangeViewmodeCommand(e){switch(e.mode){case o.BD.INSIDE:return this.goToInsideMode(e.transitionType,e.pose);case o.BD.DOLLHOUSE:return this.goToDollhouse(e.transitionType,e.pose);case o.BD.FLOORPLAN:return this.goToFloorplan(e.transitionType,e.pose)}return Promise.reject(`viewmode-change => Could not move to ${e.mode}`)}async goToInsideMode(e=c.n.Interpolate,t={}){const i=this.engine.market.tryGetData(m.Z);if(!i)return Promise.reject("Cannot go to inside mode");let n=t.sweepID||i.currentSweep;if(n||(n=await this.getLookAtSweep(i)),i.isSweepUnaligned(n)){n=(i.getFirstAlignedSweep()||i.getFirstSweep()).id}return this.viewmodesModule.currentMode===l.Ey.Panorama&&i.isSweepUnaligned(i.currentSweep)?this.engine.commandBinder.issueCommand(new y.ju({sweep:n,rotation:t.rotation,transition:c.n.FadeToBlack})):this.viewmodesModule.switchToMode(l.Ey.Panorama,e,{sweepID:n,rotation:t.rotation},r.DEFAULT_TRANSITION_TIME)}async getLookAtSweep(e){const t=this.engine.market.tryGetData(v.M_);if(!t)return e.getFirstSweep().id;const i=this.engine.market.tryGetData(T.c),n=(null==i?void 0:i.getFloorMin())||this.getModelMinHeight(),s=new u.Plane(d.f.DOWN,n),o=(0,p.Fe)(t.pose.position,t.pose.rotation,s);if(!o)return e.getFirstSweep().id;const r=[g._T(),g._k(),e=>!i||i.isCurrentOrAllFloors(e.floorId)],a=[f.l0(o)],l=e.sortByScore(r,a).shift();if(l)return l.sweep.id;let c=e.getClosestSweep(o,!0);return c||(c=e.getFirstSweep()),c.id}getModelMinHeight(){return this.meshData||(this.meshData=this.engine.market.tryGetData(h._)),this.meshData?this.meshData.bounds.min.y:0}async goToDollhouse(e=c.n.Interpolate,t={}){return this.dhDisabled()?Promise.reject("Cannot go to dollhouse mode"):this.viewmodesModule.switchToMode(l.Ey.Dollhouse,e,t)}async goToFloorplan(e=c.n.Interpolate,t={}){if(this.fpDisabled())return Promise.reject("Cannot go to floorplan mode");const i=await this.engine.getModule(M.default);return i&&await i.getTransitionPromise(),this.viewmodesModule.switchToMode(l.Ey.Floorplan,e,t)}}},48840:(e,t,i)=>{"use strict";i.d(t,{Z:()=>BeginSwitchViewmodeMessage});var n=i(13402);class BeginSwitchViewmodeMessage extends n.a{}},39869:(e,t,i)=>{"use strict";i.d(t,{Z:()=>EndSwitchViewmodeMessage});var n=i(13402);class EndSwitchViewmodeMessage extends n.a{}},13402:(e,t,i)=>{"use strict";i.d(t,{a:()=>SwitchViewmodeMessage});var n=i(93528);class SwitchViewmodeMessage extends n.v{constructor(e,t){super(),this.fromMode=t,this.toMode=e,this.timestamp=Date.now()}}},71208:(e,t,i)=>{"use strict";i.d(t,{Ey:()=>n,tU:()=>a,Lm:()=>r,Ae:()=>o});var n,s=i(17617);class ViewmodeConvertException extends s.y{constructor(e,t){super(e),this.mode=t}}!function(e){e[e.Panorama=1]="Panorama",e[e.Dollhouse=2]="Dollhouse",e[e.Floorplan=3]="Floorplan",e[e.Outdoor=4]="Outdoor",e[e.Transition=-1]="Transition"}(n||(n={}));const o=e=>{switch(e){case n.Panorama:return"Panorama";case n.Floorplan:return"Floorplan";case n.Dollhouse:return"Dollhouse";case n.Transition:return"Transition"}return"Unknown"},r=e=>{switch(e){case"0":case 0:return n.Panorama;case"1":case 1:return n.Floorplan;case"2":case 2:return n.Dollhouse;case"3":case 3:return n.Transition}throw new ViewmodeConvertException("No known conversion for Workshop int to viewmode for int: "+e,e)};function a(e){switch(e){case n.Panorama:return 0;case n.Floorplan:return 1;case n.Dollhouse:return 2;case n.Transition:return 3}throw new ViewmodeConvertException("No known conversion for Viewmode to Workshop int",e)}},12775:(e,t,i)=>{"use strict";i.d(t,{O:()=>ViewmodeData});var n=i(19413),s=i(71208),o=i(5442);class ViewmodeData extends n.V{constructor(){super(),this.name="viewmode",this.currentModeObservable=(0,o.Y)(null),this.transition={active:!1,progress:0,from:null,to:null,startTime:0,transitionTime:0},this.isFloorplan=this.isFloorplan.bind(this),this.isPano=this.isPano.bind(this),this.isDollhouse=this.isDollhouse.bind(this)}get currentMode(){return this.currentModeObservable.value}set currentMode(e){e!==this.currentModeObservable.value&&(this.currentModeObservable.value=e)}get closestMode(){return this.currentMode===s.Ey.Transition?this.transition.progress<.5?this.transition.from:this.transition.to:this.currentMode}makeModeChangeSubscription(e){return this.currentModeObservable.onChanged(e)}copyTransition(e){this.transition.active=e.active,this.transition.progress=e.progress,this.transition.from=e.from,this.transition.to=e.to,this.transition.startTime=e.startTime,this.transition.transitionTime=e.transitionTime}activateTransition(e,t,i){this.transition.active=!0,this.transition.progress=0,this.transition.startTime=Date.now(),this.transition.transitionTime=i,this.transition.to=t,this.transition.from=e}deactivateTransition(){this.transition.active=!1}clone(){const e=new ViewmodeData;return e.copy(this),e}copy(e){this.currentMode=e.currentMode,this.copyTransition(e.transition)}isPano(){return this.currentMode===s.Ey.Panorama}isFloorplan(){return this.currentMode===s.Ey.Floorplan}isDollhouse(){return this.currentMode===s.Ey.Dollhouse}canStartTransition(){const e=this.transition.active,t=this.currentMode===s.Ey.Transition;return!e&&!t}transitionActive(){return!this.canStartTransition()}isAlreadyInMode(e){const t=this.transition.from===this.transition.to,i=this.currentMode===e;return this.transition.active&&t||i}canSwitchViewMode(e){return this.canStartTransition()&&!this.isAlreadyInMode(e)}}},89997:(e,t,i)=>{"use strict";i.r(t),i.d(t,{DEFAULT_TRANSITION_TIME:()=>O,default:()=>ViewmodeModule});var n=i(71208),s=i(47924),o=i(2212),r=i(27829),a=i(64279),l=i(54122),c=i(85197),h=i(12775),d=i(89895),u=i(89155),p=i(94210),m=i(77956),g=i(39869),f=i(48840),v=i(13402),y=i(17617);class ViewmodeActiveTransitionError extends y.y{constructor(e="Tried to start view-mode transition while another transition was active"){super(e),this.name="ViewmodeActiveTransition"}}var b=i(91055);var w=i(99169),S=i(56040),E=i(1799);const T={rotationDuration:1,rotationDelay:0,matrixDelay:0,matrixDuration:.5},M={[n.Ey.Dollhouse]:{matrixDelay:.5,matrixDuration:1},[n.Ey.Panorama]:{rotationDuration:.5}};var _=i(25799),x=i(27871);const A=new _.Z("viewmodes-data"),O=1e3,P=Math.PI/2+Number.EPSILON,C=Math.PI-Number.EPSILON,D={[n.Ey.Panorama]:O,[n.Ey.Dollhouse]:O,[n.Ey.Floorplan]:O};class ViewmodeModule extends l.Y{constructor(){super(...arguments),this.viewmodeData=new h.O,this.name="viewmode",this.minDollhouseDistance=15,this.maxDollhouseDistance=50,this.getFlyinStartPose=(e,t)=>{const i=t||this.cameraData.pose.position,n=e.position.y-i.y,s=(0,b.Ll)(e.position,i,this.meshData.center),o=r.f.FORWARD.clone().applyQuaternion(s);return{position:(0,b.D7)(e.position,i,Math.sign(o.y)*Math.PI/4,!0).setY(1.5*n)}},this.getFlyinEndPose=e=>{const t=e.position||this.sweepData.getSweep(e.sweepID).position,i=e.rotation||new o.Quaternion,n=Math.PI/180*a.oR.fov;return(0,b.YN)(t,i,-Math.PI/6,this.meshData.bounds,n,this.canvas.aspectRatio)}}async init(e,t){this.engine=t,this.market=t.market,null!==e.startingMode&&(this.viewmodeData.currentMode=e.startingMode),this.market.register(this,h.O,this.viewmodeData),t.market.waitForData(x._).then((e=>{this.meshData=e,this.setDollhouseBounds()}));const[i,n,s,o,r]=await Promise.all([t.getModule(d.default),t.getModule(p.default),t.market.waitForData(m.Z),t.market.waitForData(w.W),t.market.waitForData(u.M_)]);this.cameraModule=i,this.sweepModule=n,this.sweepData=s,this.canvas=o,this.cameraData=r}get currentMode(){return this.viewmodeData.currentMode}async switchToMode(e,t=s.n.FadeToBlack,i,o){if(A.info(`switchToMode mode:${e} type:${t}`),this.meshData||e!==n.Ey.Floorplan&&e!==n.Ey.Dollhouse||await this.engine.getModule(c.default),t===s.n.Instant&&(o=0),o=void 0!==o?o:D[e],!this.viewmodeData.canStartTransition()||!this.cameraData.canTransition())throw new ViewmodeActiveTransitionError;const r=this.isAlreadyInMode(this.viewmodeData,e),a=i&&!ViewmodeModule.willPoseChange(this.cameraData,i);if(r&&a)return Promise.resolve();this.sweepData.currentSweep&&this.sweepData.isSweepUnaligned(this.sweepData.currentSweep)&&e!==n.Ey.Panorama&&(t=s.n.FadeToBlack);const l=null!==this.viewmodeData.currentMode?this.viewmodeData.currentMode:void 0;this.viewmodeData.activateTransition(this.viewmodeData.currentMode,e,o),this.viewmodeData.currentMode=n.Ey.Transition,this.viewmodeData.commit(),this.engine.broadcast(new f.Z(e,l));const h=this.moveCameraToViewmode(e,l,t,o,i);let d=!1;return h.progress((t=>{this.viewmodeData.transition.progress=t,this.viewmodeData.commit(),t>=.5&&!d&&(d=!0,this.engine.broadcast(new v.a(e,l)))})),h.then((()=>{this.viewmodeData.transition.progress=1,this.viewmodeData.currentMode=e,this.viewmodeData.deactivateTransition(),this.viewmodeData.commit(),this.engine.broadcast(new g.Z(e,l))})),h.nativePromise()}isAlreadyInMode(e,t){const i=e.transition.from===e.transition.to,n=e.currentMode===t;return e.transition.active&&i||n}static willPoseChange(e,t){return void 0!==t.position&&!e.pose.position.equals(t.position)||void 0!==t.rotation&&!e.pose.rotation.equals(t.rotation)||void 0!==t.zoom&&e.zoom()!==t.zoom}moveCameraToViewmode(e,t,i,s,o){switch(e){case n.Ey.Panorama:return this.moveCameraToPanorama(i,s,o);case n.Ey.Dollhouse:return this.moveCameraToDollhouse(t,i,s,o);case n.Ey.Floorplan:return this.moveCameraToFloorplan(t,i,s,o);default:throw Error(`moveCameraToViewmode(): Invalid view-mode to go to: ${e}`)}}moveCameraToPanorama(e,t,i){if(this.sweepData.canTransition()||this.cameraData.canTransition()){let a;if(i&&i.sweepID)a=i.sweepID;else{const e=this.sweepData.getFirstSweep();a=this.sweepData.currentSweep,!a&&e&&(a=e.id)}if(!a)throw new Error("moveCameraToPanorama(): Invalid target sweep!");this.sweepData.isSweepUnaligned(a)&&(e=s.n.FadeToBlack);let l=i&&i.rotation?i.rotation:void 0;if(!l){const e=(this.viewmodeData.transition.from===n.Ey.Floorplan?r.f.UP:r.f.FORWARD).clone().applyQuaternion(this.cameraData.pose.rotation).setY(0).normalize();l=(new o.Quaternion).setFromUnitVectors(r.f.FORWARD,e)}return this.sweepModule.moveToSweep({transitionType:e,sweepId:a,rotation:l,transitionTime:t,rotationDelay:.5})}throw new Error("Could not move to panorama mode because another transition was active")}moveCameraToDollhouse(e,t,i,s){const l=this.meshData.bounds,c={};let h;if(s&&(s.position||s.rotation)){if(s.position&&s.rotation){c.position=s.position,c.rotation=s.rotation;const e=new o.Plane(r.f.UP.clone(),this.meshData.center.y);let t=(0,b.Fe)(c.position,c.rotation,e);t||(t=new o.Vector3,t.copy(this.meshData.center)),l.containsPoint(t)&&(h=c.position.distanceTo(t))}else if(s.position)c.position=s.position,c.rotation=(0,b.n0)(s.position,this.meshData.center);else{c.rotation=s.rotation;const e=l.min.distanceTo(l.max);c.position=(0,b.fd)(c.rotation,this.meshData.center,e)}h||(h=this.meshData.center.clone().distanceTo(c.position))}else{let e,t;const i=this.sweepData.isSweepUnaligned(this.sweepData.currentSweep),s=i||this.viewmodeData.transition.from===n.Ey.Floorplan?this.meshData.center:this.cameraData.pose.position;if(i)t=new o.Vector3(0,0,0),e=new o.Vector3(15,10,15);else if(this.viewmodeData.transition.from!==n.Ey.Floorplan){const i=1.5,n=(0,b.YN)(this.cameraData.pose.position,this.cameraData.pose.rotation,-Math.PI/6,this.meshData.bounds,this.cameraData.fovY()*i,this.cameraData.pose.aspect()),a=((e,t)=>{const i=e.clone().add(new o.Vector3(0,6,0)),n=r.f.FORWARD.clone().applyQuaternion(t);return n.y>=.01&&(n.y=.01),{position:i.clone().add(n.clone().multiplyScalar(-10)),direction:n}})(s,this.cameraData.pose.rotation);[e,t]=[n.position,a.direction]}else{const i=((e,t)=>{const i=e.clone(),n=r.f.DOWN.clone().applyQuaternion(t).multiplyScalar(6),s=i.clone().add(n).setY(6),o=r.f.UP.clone().applyQuaternion(t);return o.setY(-.5).normalize(),{position:s,direction:o}})(s,this.cameraData.pose.rotation);[e,t]=[i.position,i.direction]}const a=s.clone().add(t).setY(this.meshData.center.y);c.position=(0,b.r0)(e,a,this.minDollhouseDistance,this.maxDollhouseDistance),c.position=(0,b.m$)(c.position,a,P,C),c.rotation=(0,b.n0)(c.position,a),h=a.distanceTo(c.position)}return this.cameraModule.moveTo({transitionType:t,pose:c,transitionTime:i,projection:(0,a.AN)(this.cameraData.aspect()),focalDistance:h,rotationDuration:.5})}setDollhouseBounds(){const e=this.meshData.bounds,t=e.min.distanceTo(e.max);this.minDollhouseDistance=Math.min(t/2,this.minDollhouseDistance),this.maxDollhouseDistance=Math.max(t,this.maxDollhouseDistance)}moveCameraToFloorplan(e,t,i,n){const s={},l=this.meshData.center,c=this.meshData.size,h=Math.max(c.x,c.z),d=Math.min(c.x,c.z),u=this.canvas.aspectRatio,p=Math.max(h,d/u),m=Math.max(d,h/u),g=u<1?p:m,f=this.canvas.height/(1.2*g),v=n&&n.zoom?this.canvas.height/(2*n.zoom):f,y=(0,a.aH)(this.canvas.width,this.canvas.height,v),b=(0,a.aH)(this.canvas.width,this.canvas.height,f);if(this.cameraModule.setBaseProjection(b),n&&n.position)s.position=n.position;else{const e=r.f.UP.clone().multiplyScalar(h);s.position=l.clone().add(e)}if(n&&n.rotation)s.rotation=n.rotation;else{const e=(new S.M).setPosition(s.position);e.lookAt(s.position,l,r.f.FORWARD),s.rotation=(new o.Quaternion).setFromRotationMatrix(e.asThreeMatrix4());if(u<1!==c.x/c.z<1){const e=(new o.Quaternion).setFromUnitVectors(r.f.UP,r.f.LEFT);s.rotation.multiply(e)}}const w=s.position.y-this.meshData.center.y;let _=Object.assign(Object.assign({},T),{easing:E.hl,transitionType:t,pose:s,transitionTime:i,projection:y,focalDistance:w});return e&&e in M&&(_=Object.assign(Object.assign({},M[e]),_)),this.cameraModule.moveTo(_)}}},44693:(e,t,i)=>{"use strict";function n(e){try{const t=e.getExtension("WEBGL_debug_renderer_info");if(t)return{vendor:e.getParameter(t.UNMASKED_VENDOR_WEBGL),renderer:e.getParameter(t.UNMASKED_RENDERER_WEBGL)}}catch(e){}return{vendor:"Unknown",renderer:"Unknown"}}function s(e){return/Apple A(9|1\d)/.test(e.renderer)||/Adreno \(TM\) (512|530|540|[6-9]\d\d)/.test(e.renderer)||/Mali-G(7[1-9]|[8-9]\d)/.test(e.renderer)}i.d(t,{t:()=>n,W:()=>s})},60303:(e,t,i)=>{"use strict";i.d(t,{a:()=>n,Z:()=>WebGLScene});var n,s=i(2212),o=i(64279),r=i(2779);class CameraRig extends s.Object3D{constructor(e){super(),this.anchor=this,this.update=e=>{this.anchor.position.copy(e.position),this.camera.quaternion.copy(e.rotation),this.camera.projectionMatrix.copy(e.projection.asThreeMatrix4()),this.camera.projectionMatrixInverse.copy(e.projection.asThreeMatrix4()),this.camera.projectionMatrixInverse.invert(),this.updateMatrixWorld(!0)},this.camera=new s.PerspectiveCamera(o.oR.fov,e,o.oR.near,o.oR.far),this.add(this.camera),this.camera.layers.mask=r.o.ALL.mask,this.name="CameraRig"}dispose(){this.remove(this.camera)}}!function(e){e[e.Root=0]="Root",e[e.CameraRig=1]="CameraRig"}(n||(n={}));class WebGLScene{constructor(e,t,i,o){this.scene=e,this.threeRenderer=t,this.cameraData=i,this.useEffectComposer=o,this.ids=n,this.rendering=!1,this.composer=null,this.cameraRigStale=!0,this.canvasSizeChanged=!0,this.updateComposer=(()=>{const e=new s.Vector2;return()=>{this.canvasSizeChanged&&this.composer&&(this.composer.setPixelRatio(this.composer.renderer.getPixelRatio()),this.composer.renderer.getSize(e),this.composer.setSize(e.x,e.y),this.canvasSizeChanged=!1)}})()}add(...e){for(const t of e)this.addChild(n.Root,t)}remove(...e){for(const t of e)this.removeChild(n.Root,t)}addChild(e,t){switch(e){case n.Root:this.scene.add(t);break;case n.CameraRig:this.cameraRig.add(t);break;default:return!1}return!0}removeChild(e,t){switch(e){case n.Root:this.scene.remove(t);break;case n.CameraRig:this.cameraRig.remove(t);break;default:return!1}return!0}get camera(){return this.updateCameraRig(),this.cameraRig.camera}get effectComposer(){return this.composer}init(){this.cameraRig=new CameraRig(this.cameraData.aspect()),this.useEffectComposer&&Promise.all([i.e(525).then(i.bind(i,90446)),i.e(525).then(i.bind(i,86426))]).then((([e,t])=>{this.composer=new e.EffectComposer(this.threeRenderer),this.composer.addPass(new t.RenderPass(this.scene,this.cameraRig.camera)),this.cameraRigStale=!0})),this.cameraRigStale=!0}dispose(){this.cameraRig.dispose()}startRender(e){this.rendering=e}activate(e){this.scene.add(this.cameraRig),this.cameraDataCallback=()=>this.cameraRigStale=!0,this.cameraData.pose.onChanged(this.cameraDataCallback)}deactivate(e){this.scene.remove(this.cameraRig),this.cameraData.pose.removeOnChanged(this.cameraDataCallback)}beforeRender(){this.updateCameraRig(),this.updateComposer()}updateCameraRig(){this.cameraRigStale&&(this.cameraRig.update(this.cameraData.pose),this.cameraRigStale=!1)}render(e){this.rendering&&(this.composer?this.composer.render(e):(this.threeRenderer.clear(),this.threeRenderer.render(this.scene,this.cameraRig.camera)))}setCameraDirty(){this.cameraRigStale=!0,this.cameraRig.camera.updateProjectionMatrix()}onCanvasSizeChanged(){this.canvasSizeChanged=!0}}},24550:(e,t,i)=>{"use strict";i.d(t,{b:()=>GetScreenPositionCommand});var n=i(99681);class GetScreenPositionCommand extends n.m{constructor(e){super(),this.payload=Object.assign({},e)}}},93220:(e,t,i)=>{"use strict";i.d(t,{vx:()=>WebGLSupportException,Rg:()=>ContextLostException,Gw:()=>RendererCreationException});var n=i(17617);class WebGLSupportException extends n.y{constructor(e){super(e)}}class ContextLostException extends n.y{constructor(e){super(e)}}class RendererCreationException extends n.y{constructor(e){super(e)}}},50101:(e,t,i)=>{"use strict";i.r(t),i.d(t,{MAX_RESOLUTION:()=>C,default:()=>WebGLRendererModule});var n=i(54122),s=i(99169),o=i(60303),r=i(2212),a=i(13441),l=i(81047),c=i(48101);const h={basicTextured:{uniforms:{tDiffuse:{type:"t",value:null},alpha:{type:"f",value:1}},vertexShader:(0,c.m)(l,i(82334)),fragmentShader:(0,c.m)(a,i(52857))},screenSpaceColored:{uniforms:{color:{type:"v3",value:new r.Vector3(0,0,0)},opacity:{type:"f",value:1}},vertexShader:(0,c.m)(l,i(41334)),fragmentShader:(0,c.m)(a,i(46846))}};var d=i(93220),u=i(44693),p=i(64630);const m=(e,t)=>{switch(e){case p.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_X:t.set(0,-Math.PI/2,0);break;case p.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_X:t.set(0,Math.PI/2,0);break;case p.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_Y:t.set(Math.PI/2,Math.PI,0);break;case p.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_Y:t.set(-Math.PI/2,Math.PI,0);break;case p.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_Z:t.set(0,-Math.PI,0);break;case p.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_Z:t.set(0,0,0)}},g=(e,t)=>{const i=t.extensions,n=t.getContext();let s;switch(e){case r.RepeatWrapping:return n.REPEAT;case r.ClampToEdgeWrapping:return n.CLAMP_TO_EDGE;case r.MirroredRepeatWrapping:return n.MIRRORED_REPEAT;case r.NearestFilter:return n.NEAREST;case r.NearestMipMapNearestFilter:return n.NEAREST_MIPMAP_NEAREST;case r.NearestMipMapLinearFilter:return n.NEAREST_MIPMAP_LINEAR;case r.LinearFilter:return n.LINEAR;case r.LinearMipMapNearestFilter:return n.LINEAR_MIPMAP_NEAREST;case r.LinearMipMapLinearFilter:return n.LINEAR_MIPMAP_LINEAR;case r.UnsignedByteType:return n.UNSIGNED_BYTE;case r.UnsignedShort4444Type:return n.UNSIGNED_SHORT_4_4_4_4;case r.UnsignedShort5551Type:return n.UNSIGNED_SHORT_5_5_5_1;case r.UnsignedShort565Type:return n.UNSIGNED_SHORT_5_6_5;case r.ByteType:return n.BYTE;case r.ShortType:return n.SHORT;case r.UnsignedShortType:return n.UNSIGNED_SHORT;case r.IntType:return n.INT;case r.UnsignedIntType:return n.UNSIGNED_INT;case r.FloatType:return n.FLOAT}switch(e){case r.AlphaFormat:return n.ALPHA;case r.RGBFormat:return n.RGB;case r.RGBAFormat:return n.RGBA;case r.LuminanceFormat:return n.LUMINANCE;case r.LuminanceAlphaFormat:return n.LUMINANCE_ALPHA;case r.AddEquation:return n.FUNC_ADD;case r.SubtractEquation:return n.FUNC_SUBTRACT;case r.ReverseSubtractEquation:return n.FUNC_REVERSE_SUBTRACT;case r.ZeroFactor:return n.ZERO;case r.OneFactor:return n.ONE;case r.SrcColorFactor:return n.SRC_COLOR;case r.OneMinusSrcColorFactor:return n.ONE_MINUS_SRC_COLOR;case r.SrcAlphaFactor:return n.SRC_ALPHA;case r.OneMinusSrcAlphaFactor:return n.ONE_MINUS_SRC_ALPHA;case r.DstAlphaFactor:return n.DST_ALPHA;case r.OneMinusDstAlphaFactor:return n.ONE_MINUS_DST_ALPHA;case r.DstColorFactor:return n.DST_COLOR;case r.OneMinusDstColorFactor:return n.ONE_MINUS_DST_COLOR;case r.SrcAlphaSaturateFactor:return n.SRC_ALPHA_SATURATE}if(e===r.HalfFloatType){if(t.capabilities.isWebGL2)return n.HALF_FLOAT;if(s=i.get("OES_texture_half_float"),null!==s)return s.HALF_FLOAT_OES}if(s=i.get("WEBGL_compressed_texture_s3tc"),null!==s){if(e===r.RGB_S3TC_DXT1_Format)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===r.RGBA_S3TC_DXT1_Format)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===r.RGBA_S3TC_DXT3_Format)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===r.RGBA_S3TC_DXT5_Format)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(s=i.get("WEBGL_compressed_texture_pvrtc"),null!==s){if(e===r.RGB_PVRTC_4BPPV1_Format)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===r.RGB_PVRTC_2BPPV1_Format)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===r.RGBA_PVRTC_4BPPV1_Format)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===r.RGBA_PVRTC_2BPPV1_Format)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(s=i.get("WEBGL_compressed_texture_etc1"),null!==s&&e===r.RGB_ETC1_Format)return s.COMPRESSED_RGB_ETC1_WEBGL;if(s=i.get("EXT_blend_minmax"),null!==s){if(e===r.MinEquation)return s.MIN_EXT;if(e===r.MaxEquation)return s.MAX_EXT}if(e===r.UnsignedInt248Type){if(t.capabilities.isWebGL2)return n.UNSIGNED_INT_24_8;if(s=i.get("WEBGL_depth_texture"),null!==s)return s.UNSIGNED_INT_24_8_WEBGL}return 0},f={copyCubeMap:{uniforms:{tDiffuse:{type:"t",value:null},alpha:{type:"f",value:1}},vertexShader:(0,c.m)(l,i(51799)),fragmentShader:(0,c.m)(a,i(92566))}};var v=i(97982);const y={0:[0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0],1:[0,0,0,0,0,0,0,3e-6,229e-6,.005977,.060598,.24173,.382925,.24173,.060598,.005977,229e-6,3e-6,0,0,0,0,0,0,0],2:[0,0,1e-6,1e-5,78e-6,489e-6,.002403,.009245,.027835,.065591,.120978,.174666,.197413,.174666,.120978,.065591,.027835,.009245,.002403,489e-6,78e-6,1e-5,1e-6,0,0],3:[48e-6,169e-6,538e-6,.001532,.003907,.008921,.018247,.033432,.054867,.080658,.106212,.125283,.132372,.125283,.106212,.080658,.054867,.033432,.018247,.008921,.003907,.001532,538e-6,169e-6,48e-6],4:[.001133,.002316,.00445,.008033,.013627,.021724,.032542,.04581,.0606,.075333,.088001,.096603,.099654,.096603,.088001,.075333,.0606,.04581,.032542,.021724,.013627,.008033,.00445,.002316,.001133],5:[.004571,.00723,.010989,.016048,.022521,.03037,.039354,.049003,.058632,.067411,.074476,.079066,.080657,.079066,.074476,.067411,.058632,.049003,.039354,.03037,.022521,.016048,.010989,.00723,.004571],6:[.009379,.012899,.017256,.022453,.028417,.034983,.041888,.048784,.055264,.060893,.065262,.068032,.068981,.068032,.065262,.060893,.055264,.048784,.041888,.034983,.028417,.022453,.017256,.012899,.009379],7:[.014185,.01793,.022207,.02695,.032045,.037335,.042622,.047676,.052254,.056116,.059048,.06088,.061504,.06088,.059048,.056116,.052254,.047676,.042622,.037335,.032045,.02695,.022207,.01793,.014185]};class CWFWebGLRenderer{constructor(e){this.threeRenderer=e,this.cachedSize=new r.Vector2,this.renderToCubeMap=(()=>{let e,t,i,n,s,o=!1;const a=.5;return(l,c,d,u,p,m,g,f,v,y,b,w,S,E,T,M)=>{o||(t=new r.OrthographicCamera(-.5,a,a,-.5,-200,200),t.position.z=150,e=new r.Scene,e.name="rttCube",e.add(t),i=new r.RawShaderMaterial({uniforms:{tDiffuse:{value:null},alpha:{value:1}},vertexShader:h.basicTextured.vertexShader,fragmentShader:h.basicTextured.fragmentShader,depthWrite:!1,depthTest:!1,side:r.DoubleSide}),n=new r.PlaneBufferGeometry(1,1),s=new r.Mesh(n,i),s.position.z=0,e.add(s),o=!0);const _=n.getAttribute("uv");_.setUsage(r.DynamicDrawUsage),_.needsUpdate=!0;const x=_.array,A=p/d,O=m/u,P=g/d,C=f/u;x[0]=A,x[1]=O+C,x[2]=A+P,x[3]=O+C,x[4]=A,x[5]=O,x[6]=A+P,x[7]=O;const D=n.getAttribute("position");D.setUsage(r.DynamicDrawUsage),D.needsUpdate=!0;const I=D.array,R=v/c.width-a,L=y/c.height-a,N=b/c.width,k=w/c.height;I[0]=R,I[1]=L+k,I[3]=R+N,I[4]=L+k,I[6]=R,I[7]=L,I[9]=R+N,I[10]=L,i.uniforms.tDiffuse.value=l,i.blending=E||r.NoBlending,i.transparent=!!T,null==M&&(M=1),i.uniforms.alpha.value=M,i.needsUpdate=!0,c.viewport.set(0,0,c.width,c.height);const B=this.threeRenderer.getRenderTarget(),F=this.threeRenderer.autoClear,U=this.threeRenderer.xr.enabled;this.threeRenderer.xr.enabled=!1,this.threeRenderer.autoClear=!1,this.threeRenderer.setRenderTarget(c,S),this.threeRenderer.render(e,t),this.threeRenderer.setRenderTarget(B),this.threeRenderer.autoClear=F,this.threeRenderer.xr.enabled=U}})(),this.copyCubemap=(()=>{let e,t,i,n,s,o=!1;const a=new r.Euler,l=this;return(c,h,d,u,p)=>{if(!o){const a=2,l=a/2;t=new r.OrthographicCamera(-l,l,l,-l,0,200),t.position.set(0,0,0),e=new r.Scene,e.name="copyCube",e.add(t),i=new r.RawShaderMaterial({uniforms:{tDiffuse:{value:null},alpha:{value:1}},vertexShader:f.copyCubeMap.vertexShader,fragmentShader:f.copyCubeMap.fragmentShader,depthWrite:!1,depthTest:!1,side:r.DoubleSide}),n=new r.BoxGeometry(a,a,a),s=new r.Mesh(n,i),e.add(s),o=!0}const g=l.threeRenderer.getRenderTarget(),v=l.threeRenderer.autoClear,y=l.threeRenderer.xr.enabled;l.threeRenderer.xr.enabled=!1,l.threeRenderer.autoClear=!1;for(let n=0;n<6;n++)m(n,a),s.rotation.copy(a),s.matrixWorldNeedsUpdate=!0,s.updateMatrixWorld(!0),i.uniforms.tDiffuse.value=c,i.blending=d||r.NoBlending,i.transparent=!!u,null==p&&(p=1),i.uniforms.alpha.value=p,i.needsUpdate=!0,h.viewport.set(0,0,h.width,h.height),l.threeRenderer.setRenderTarget(h,n),l.threeRenderer.render(e,t);l.threeRenderer.setRenderTarget(g),l.threeRenderer.autoClear=v,l.threeRenderer.xr.enabled=y}})(),this.blurCubemap=(()=>{const e=e=>{const t=new r.WebGLCubeRenderTarget(e);return t.texture.image={},t.texture.image.width=e,t.texture.image.height=e,{renderTarget:t,cubeCamera:new r.CubeCamera(.1,1e3,t)}};class BlurCubeMesh extends r.Mesh{}const t={512:e(512)},i=new r.Scene,n=new BlurCubeMesh(new r.BoxGeometry(1,1,1));i.add(n);const s={};return(o,a,l=3,c=.005)=>{const h=a.renderTarget;t[h.width]||(t[h.width]=e(h.width)),n.material=function(e){if(!s[e]){const t=new r.RawShaderMaterial({uniforms:r.UniformsUtils.clone(v.Z.blurCube.uniforms),vertexShader:v.Z.blurCube.vertexShader,fragmentShader:v.Z.blurCube.fragmentShader,side:r.BackSide});t.defines={};const i=y[`${e}`];for(const[e,n]of i.entries())t.defines[`KERNEL_${e+1}`]=0===n||1===n?n.toFixed(1):n;s[e]=t}return s[e]}(l);const d=t[h.width];n.material.uniforms.map.value=o,n.material.uniforms.dir.value.set(c,0),d.cubeCamera.update(this.renderer,i),n.material.uniforms.map.value=d.renderTarget.texture,n.material.uniforms.dir.value.set(0,c),a.update(this.renderer,i)}})();try{const e=this.threeRenderer.getContext();this._maxCubemapSize=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),this._maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this._gpuInfo=(0,u.t)(e)}catch(e){throw new d.Gw("Unable to create a WebGL rendering context")}}get renderer(){return this.threeRenderer}get maxCubemapSize(){return this._maxCubemapSize}get maxTextureSize(){return this._maxTextureSize}get gpuInfo(){return this._gpuInfo}getSize(){return this.threeRenderer.getSize(this.cachedSize)}getPixelRatio(){return this.threeRenderer.getPixelRatio()}dispose(){this.threeRenderer.dispose()}initSizedTexture2D(e,t){const i=this.threeRenderer.getContext(),n=this.threeRenderer.state;(t=t||new r.Texture).addEventListener("dispose",(()=>i.deleteTexture(a.__webglTexture)));const s=g(t.format,this.threeRenderer),o=g(t.type,this.threeRenderer),a=this.threeRenderer.properties.get(t),l=i.createTexture();n.bindTexture(i.TEXTURE_2D,l),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,t.flipY),i.texImage2D(i.TEXTURE_2D,0,s,e,e,0,s,o,null);const c=g(t.wrapS,this.threeRenderer),h=g(t.wrapT,this.threeRenderer);return i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,c),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,h),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,g(t.magFilter,this.threeRenderer)),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,g(t.minFilter,this.threeRenderer)),t.generateMipmaps&&i.generateMipmap(i.TEXTURE_2D),n.bindTexture(i.TEXTURE_2D,null),a.__webglTexture=l,t}initSizedCubeMap(e,t){const i=this.threeRenderer.getContext(),n=this.threeRenderer.state,s=new r.CubeTexture([null,null,null,null,null,null]);s.flipY=!1,s.generateMipmaps=t;const o=g(s.format,this.threeRenderer),a=g(s.type,this.threeRenderer),l=this.threeRenderer.properties.get(s),c=i.createTexture();n.bindTexture(i.TEXTURE_CUBE_MAP,c),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,s.flipY);for(let t=0;t<6;t++)i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,o,e,e,0,o,a,null);return t?(s.magFilter=r.LinearFilter,s.minFilter=r.LinearMipMapLinearFilter,i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MIN_FILTER,i.LINEAR_MIPMAP_LINEAR),i.generateMipmap(i.TEXTURE_CUBE_MAP)):(s.magFilter=r.LinearFilter,s.minFilter=r.LinearFilter,i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MIN_FILTER,i.LINEAR)),n.bindTexture(i.TEXTURE_CUBE_MAP,null),l.__image__webglTextureCube=c,s}initRenderTargetCube(e){const t=new r.WebGLCubeRenderTarget(e,{stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1});return t.texture.image={},t.texture.image.width=e,t.texture.image.height=e,t}deallocateCubeTexture(e){const t=this.threeRenderer.getContext(),i=this.threeRenderer.properties.get(e);t.deleteTexture(i.__image__webglTextureCube)}uploadTexture2D(e,t,i,n){const s=this.threeRenderer.getContext(),o=this.threeRenderer.state,r=s.getParameter(s.TEXTURE_BINDING_2D),a=this.threeRenderer.properties.get(t);o.bindTexture(s.TEXTURE_2D,a.__webglTexture),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t.flipY),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),s.pixelStorei(s.UNPACK_ALIGNMENT,t.unpackAlignment),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,g(t.wrapS,this.threeRenderer)),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,g(t.wrapT,this.threeRenderer)),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,g(t.magFilter,this.threeRenderer)),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,g(t.minFilter,this.threeRenderer));const l=g(t.format,this.threeRenderer),c=g(t.type,this.threeRenderer);s.texSubImage2D(s.TEXTURE_2D,0,i,n,l,c,e),t.generateMipmaps&&s.generateMipmap(s.TEXTURE_2D),o.bindTexture(s.TEXTURE_2D,r)}fence(e){return new Promise((function(t,i){const n=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);if(null===n)return i();e.flush();const s=()=>{switch(e.getSyncParameter(n,e.SYNC_STATUS)){case e.TIMEOUT_EXPIRED:return void setTimeout(s,0);case e.WAIT_FAILED:return void i();case e.SIGNALED:return e.deleteSync(n),void t();default:return void setTimeout(s,0)}};setTimeout(s,0)}))}}var b=i(89155),w=i(80384),S=i(70785),E=i(44106),T=i(25799),M=i(20599);class ScreenOverlayMesh extends r.Mesh{constructor(e){super(new r.PlaneBufferGeometry(2,2,1,1),new r.RawShaderMaterial({uniforms:r.UniformsUtils.clone(h.screenSpaceColored.uniforms),vertexShader:h.screenSpaceColored.vertexShader,fragmentShader:h.screenSpaceColored.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1})),this._opacity=1,this.material.uniforms.color.value=new r.Color(e),this.renderOrder=M.z.colorOverlay,this.name="ScreenOverlayMesh"}set opacity(e){this.visible=e>0,this._opacity=e,this.material.uniforms.opacity.value=e}get opacity(){return this._opacity}dispose(){this.material.dispose(),this.geometry.dispose()}}class ScreenOverlayComponent{constructor(e,t){this.scene=e,this.cameraData=t}init(){this.blackoutOverlayMesh=new ScreenOverlayMesh(0)}dispose(){this.blackoutOverlayMesh.dispose()}render(e){this.blackoutOverlayMesh.opacity=this.cameraData.transition.blackoutProgress.value}activate(e){this.scene.addChild(this.scene.ids.CameraRig,this.blackoutOverlayMesh)}deactivate(e){this.scene.removeChild(this.scene.ids.CameraRig,this.blackoutOverlayMesh)}}var _=i(75195),x=i(39936);class TextureTracker{constructor(){this.stacks=new Map,this.texInfo=new Map}hookCalls(e){let t=1;const i=e.createTexture.bind(e);e.createTexture=()=>{const e=i();e.mpTexId=t++;const n=(new Error).stack;if(n){const t=this.stacks.get(n)||new Set;t.add(e.mpTexId),this.stacks.set(n,t)}return e};const n=e.deleteTexture.bind(e);e.deleteTexture=e=>{if(null!==e){const t=e.mpTexId;this.stacks.forEach((e=>e.delete(t))),this.texInfo.delete(t)}n(e)};const s=e.bindTexture.bind(e);let o;e.bindTexture=(...e)=>{const t=e[1];o=null!==t?t.mpTexId:null,s(...e)};const r=e.texImage2D.bind(e);e.texImage2D=(...e)=>{if(r(...e),o){const t=4;if(e.length>=7)this.texInfo.set(o,{width:e[3],height:e[4],size:e[8]?e[8].length:e[3]*e[4]*t});else{const i=e[5];i instanceof ImageData&&this.texInfo.set(o,{width:i.width,height:i.height,size:i.data.length}),(i instanceof HTMLImageElement||i instanceof HTMLVideoElement||i instanceof HTMLCanvasElement||i instanceof ImageBitmap)&&this.texInfo.set(o,{width:i.width,height:i.height,size:i.width*i.height*t})}}}}dumpTextureInfo(){console.log(this.texInfo);const e=Array.from(this.texInfo.values()).reduce(((e,t)=>e+t.size),0)/1024;console.log(`Currently active textures: ${this.texInfo.size}, total allocated: ${e}k`);let t=0;this.stacks.forEach(((e,i)=>{const n=Array.from(e.values()),s=n.map((e=>this.texInfo.get(e))).reduce(((e,t)=>t?e+t.size:e),0)/1024;console.groupCollapsed(`Call site ${t}: ${n.length}, allocated: ${s}k`),console.log(i),n.forEach((e=>{const t=this.texInfo.get(e);t&&console.log(`width: ${t.width}, height: ${t.height}, size: ${t.size/1024}k`)})),console.groupEnd(),t++}))}}var A=i(30853),O=i(24550);const P=new T.Z("webgl-renderer"),C=3686400;class WebGLRendererModule extends n.Y{constructor(){super(...arguments),this.name="webgl-renderer",this.contextLostError=null,this.setContextLostError=e=>{this.contextLostError=e},this.getPixelRatioFor=(e,t)=>{const i=window.devicePixelRatio||1;return e*t*i<=C?i:1}}async init(e,t){if(!("WebGLRenderingContext"in window))throw new d.vx("WebGL not supported");let i;this.canvas=e.canvas,this.engine=t;try{i=e.useWebGL2?new r.WebGLRenderer({canvas:this.canvas,antialias:e.antialias,alpha:!0}):new r.WebGL1Renderer({canvas:this.canvas,antialias:e.antialias,alpha:!0}),i.autoClear=!1,i.xr.enabled=!0}catch(e){throw new d.Gw("Unable to create a WebGL rendering context")}this._cwfRenderer=new CWFWebGLRenderer(i),[this.cameraData,this.settingsData]=await Promise.all([t.market.waitForData(b.M_),t.market.waitForData(x.e)]);const n=new r.Scene;n.name="main",this.scene=new o.Z(n,i,this.cameraData,e.useEffectComposer),t.addComponent(this,this.scene),t.addComponent(this,new ScreenOverlayComponent(this.scene,this.cameraData));const a=await t.market.waitForData(s.W);if(this.setSize(a.width,a.height),this.bindings.push(t.subscribe(w.a,(e=>this.setSize(e.width,e.height))),t.commandBinder.addBinding(O.b,(async e=>(0,_.q9)(this.cameraData,e.worldPosition).screenPosition))),e.trackTextureUsage)if(e.useWebGL2)P.error("Texture tracking for WebGL2 is not supported at the moment.");else{this.textureTracker=new TextureTracker,this.textureTracker.hookCalls(i.getContext());(await t.getModule(A.default)).registerButton("Texture Usage","Dump to console",(()=>{this.textureTracker.dumpTextureInfo()}))}this.canvas.addEventListener("webglcontextlost",this.setContextLostError)}dispose(e){super.dispose(e),this.canvas.removeEventListener("webglcontextlost",this.setContextLostError)}onUpdate(e){if(this.contextLostError)throw new d.Rg(`WebGL context lost: ${this.contextLostError.statusMessage||"no status given"}`)}get gpuInfo(){return this._cwfRenderer.gpuInfo}get maxCubemapSize(){return this._cwfRenderer.maxCubemapSize}get maxTextureSize(){return this._cwfRenderer.maxTextureSize}getScene(){return this.scene}getCamera(){return this.scene.camera}get cwfRenderer(){return this._cwfRenderer}get textureManager(){return this._cwfRenderer}get threeRenderer(){return this.cwfRenderer.renderer}async renderOnce(){return this.scene.startRender(!0),this.engine.after(S.A.Render).then((()=>this.scene.startRender(!1)))}startRender(e=!0){this.scene.startRender(e),this.engine.broadcast(new E.V(this.cwfRenderer.getPixelRatio()))}setSize(e,t){const i=this.getPixelRatioFor(e,t);i!==this.cwfRenderer.getPixelRatio()&&(P.debug(`Setting pixel ratio to ${i}`),this.engine.broadcast(new E.V(i))),this.threeRenderer.xr.isPresenting&&P.error("setting size while in xr is a no no, it resets the viewport",e,t),this.threeRenderer.setPixelRatio(i),this.threeRenderer.setSize(e,t,!1),this.scene.setCameraDirty()}supportsInstancing(){const{threeRenderer:e,settingsData:t}=this;return!t.checkUrlParam("noInstancing",1,0)&&(e.capabilities.isWebGL2||e.extensions.has("ANGLE_instanced_arrays"))}getCapabilities(){const{capabilities:e,extensions:t}=this.threeRenderer,i=e.isWebGL2;let n=!1;try{n=!!document.createElement("canvas").getContext("webgl2")}catch(e){}return{gl_v2:n,gl_max_textures:e.maxTextures,gl_max_texture_size:e.maxTextureSize,gl_max_cubemap_size:e.maxCubemapSize,gl_instancing:this.supportsInstancing(),gl_oes_texture_float:i||t.has("OES_texture_float"),gl_oes_texture_half_float:i||t.has("OES_texture_half_float"),gl_depth_texture:i||t.has("WEBGL_depth_texture"),gl_draw_buffers:i||t.has("WEBGL_draw_buffers"),gl_oes_fbo_render_mip_map:i||t.has("OES_fbo_render_mipmap"),gl_shader_texture_lod:i||t.has("EXT_shader_texture_lod"),gl_oes_vertex_array_obj:i||t.has("OES_vertex_array_object"),gl_ovr_multi_view:i&&t.has("OVR_multiview2"),gl_color_buffer_float:i&&t.has("EXT_color_buffer_float"),gl_astc_supported:t.has("WEBGL_compressed_texture_astc"),gl_etc1_supported:t.has("WEBGL_compressed_texture_etc1"),gl_etc2_supported:t.has("WEBGL_compressed_texture_etc"),gl_dxt_supported:t.has("WEBGL_compressed_texture_s3tc"),gl_bptc_supported:t.has("EXT_texture_compression_bptc"),gl_pvrtc_supported:t.has("WEBGL_compressed_texture_pvrtc")||t.has("WEBKIT_WEBGL_compressed_texture_pvrtc")}}}},44106:(e,t,i)=>{"use strict";i.d(t,{V:()=>PixelRatioChangedMessage});var n=i(93528);class PixelRatioChangedMessage extends n.v{constructor(e){super(),this.pixelRatio=e}}},35539:(e,t,i)=>{"use strict";i.d(t,{j:()=>XRSessionRequestCommand});var n=i(99681);class XRSessionRequestCommand extends n.m{constructor(e){super(),this.id="XR_PRESENT",this.payload=Object.assign({},e)}}},38593:(e,t,i)=>{"use strict";i.d(t,{hX:()=>a,pl:()=>l,bk:()=>n});var n,s=i(21265),o=i(18317),r=i(25903);!function(e){e.webvr="webvr",e.webxr="webxr",e.unsupported="unsupported"}(n||(n={}));const a=e=>{const t=e.tryGetProperty("is_vr",!1),i=e.tryGetProperty("mls",0),n=e.tryGetProperty("vr",1);return t&&!(!n||2===n&&!(0,s.Dt)())&&0===i},l=async()=>{const e=await o.Z.isSessionSupported("immersive-vr");if(o.Z.likelySupportsControllers()&&e)return n.webxr;if(await r.H())return n.webvr;return n.unsupported}},18317:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var n=i(25799),s=i(21265);const o=new n.Z("vr-platform-select"),r=()=>{const e="xr"in navigator&&"isSessionSupported"in navigator.xr&&"requestSession"in navigator.xr;return window.isSecureContext&&e},a={isSessionSupported:async(e="immersive-vr")=>{let t=!1;if(r())try{t=await navigator.xr.isSessionSupported(e)}catch(e){o.info("WebXR disabled",e)}return o.debug(`WebXR session type: ${e} supported: ${t}`),t},likelySupportsControllers:()=>window.isSecureContext&&((0,s.Ot)()||!(0,s.tq)()),apiExists:r}},85563:(e,t,i)=>{"use strict";i.d(t,{Z:()=>ZoomMessage});var n=i(93528);class ZoomMessage extends n.v{constructor(e){super(),this.zoomLevel=e}}},75297:(e,t,i)=>{"use strict";i.d(t,{bj:()=>ZoomInCommand,KB:()=>ZoomOutCommand,ob:()=>ZoomResetCommand,_N:()=>ZoomGetMaxCommand,ts:()=>ZoomSetCommand});var n=i(99681);class ZoomInCommand extends n.m{constructor(e){super(),this.payload={step:e}}}ZoomInCommand.id="ZOOM_IN";class ZoomOutCommand extends n.m{constructor(e){super(),this.payload={step:e}}}ZoomOutCommand.id="ZOOM_OUT";class ZoomResetCommand extends n.m{}ZoomResetCommand.id="ZOOM_RESET";class ZoomGetMaxCommand extends n.m{}ZoomGetMaxCommand.id="ZOOM_MAX_VALUE";class ZoomSetCommand extends n.m{constructor(e){super(),this.payload={value:e}}}ZoomSetCommand.id="ZOOM_SET"},9841:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ZoomControls});var n=i(54122),s=i(30963),o=i(30604),r=i(93735),a=i(78626),l=i(35825),c=i(22767),h=i(89895),d=i(89155),u=i(64279),p=i(12775),m=i(71208),g=i(47254),f=i(77956),v=i(2212),y=i(56040),b=i(67126),w=i(78301),S=i(75297),E=i(25799),T=i(85563),M=i(87131);const _=new E.Z("Showcase Zoom Controls");class ZoomControls extends n.Y{constructor(){super(...arguments),this.name="zoom-controls",this.uhQuality={},this.config={enabled:!0,tiles:!0}}async init(e,t){if(this.config.enabled=!!e.enabled,this.config.tiles=!!e.tiles,this.config.tiles)try{this.sweepTilingModule=await t.getModule(g.Z)}catch(e){_.debug(`Tiling not enabled for zoom controls - ${e}`)}this.config.enabled&&await this.registerControls(t),this.engine=t,this.cameraModule=await t.getModule(h.default),this.cameraData=await t.market.waitForData(d.M_),this.viewmodeData=await t.market.waitForData(p.O),this.sweepData=await t.market.waitForData(f.Z),this.bindings.push(t.commandBinder.addBinding(S.bj,(async e=>this.zoomBy(e.step))),t.commandBinder.addBinding(S.KB,(async e=>this.zoomBy(-e.step))),t.commandBinder.addBinding(S.ob,(async()=>this.zoomTo(1))),t.commandBinder.addBinding(S.ts,(async e=>this.zoomTo(e.value))),t.commandBinder.addBinding(S._N,this.getMaxZoomAvailable.bind(this)))}async registerControls(e){e.getModule(s.default).then((e=>{this.bindings.push(e.registerHandler(o.a,(e=>this.zoomByInput(this.scrollToZoomDelta(e))))),this.bindings.push(e.registerHandler(r.G,(e=>this.zoomByInput(this.pinchToZoomDelta(e))))),this.bindings.push(e.registerHandler(a.e,(e=>this.keyHandler(e))))}))}zoomTo(e){const t=this.cameraData.zoom();if(!this.validateViewmode())return t;const i=this.sweepData.currentSweepObject;if(this.config.tiles&&this.checkTilingZoomLevels(e,i),(e=(0,b.uZ)(e,w.X.minZoom,w.X.maxHighResZoom))!==t){const t=v.MathUtils.radToDeg(this.cameraData.baseFovY/e),i=u.oR.near,n=u.oR.far;this.cameraModule.updateCameraProjection((new y.M).makePerspectiveFov(t,this.cameraData.aspect(),i,n))}return this.engine.broadcast(new T.Z(e)),e}checkTilingZoomLevels(e,t){e>=w.X.highResThreshold&&this.zoomedSweep!==t?(this.zoomedSweep=t,this.sweepTilingModule.enableZooming(!0,t).then((e=>{e?this.uhQuality[t.id]=!0:(this.uhQuality[t.id]=!1,this.zoomedSweep=void 0)}))):e<w.X.highResThreshold&&this.zoomedSweep&&this.zoomedSweep===t&&(this.sweepTilingModule.enableZooming(!1,this.zoomedSweep),this.zoomedSweep=void 0)}getMaxZoom(e){return this.uhQuality[e]?w.X.maxHighResZoom:w.X.maxZoom}zoomBy(e){const t=this.cameraData.zoom();return this.validateViewmode()?this.zoomTo(t+e):t}validateViewmode(){return this.viewmodeData.currentMode===m.Ey.Panorama&&this.cameraData.canTransition()}scrollToZoomDelta(e){return-Math.sign(e.delta.y)*w.X.zoomStep}pinchToZoomDelta(e){return e.pinchDelta*(w.X.maxZoom-w.X.minZoom)}zoomByInput(e){const t=this.cameraData.zoom();if(!this.validateViewmode())return t;const i=this.sweepData.currentSweep,n=(0,b.uZ)(t+e,w.X.minZoom,this.getMaxZoom(i));return this.zoomTo(n)}keyHandler(e){if(e.state===c.M.DOWN)switch(e.key){case l.R.PLUSEQUALS:this.zoomByInput(w.X.zoomStep);break;case l.R.DASHUNDERSCORE:this.zoomByInput(-w.X.zoomStep);break;case l.R.OPENBRACKET:this.zoomTo(1)}}async getMaxZoomAvailable(){if(!this.sweepData.currentSweepObject)return w.X.maxZoom;const e=this.sweepData.currentSweepObject;return await this.sweepTilingModule.availableResolution(e,M.SL.ULTRAHIGH)>=M.SL.ULTRAHIGH?w.X.maxHighResZoom:w.X.maxZoom}}},78301:(e,t,i)=>{"use strict";i.d(t,{X:()=>n});const n={zoomStep:.1,minZoom:.7,maxZoom:2,maxHighResZoom:3,highResThreshold:1.1}},48101:(e,t,i)=>{"use strict";function n(...e){return e.join("\n")}i.d(t,{m:()=>n})},36168:(e,t,i)=>{"use strict";i.d(t,{$:()=>Label3D,N:()=>O});var n=i(2212);window.THREE=Object.assign(Object.assign({},window.THREE),{BufferGeometry:n.BufferGeometry,Sphere:n.Sphere,Box3:n.Box3,Texture:n.Texture,Color:n.Color,BufferAttribute:n.BufferAttribute});var s=i(11385);var o,r=i(27829),a=i(97620),l=i(67126),c=i(75195),h=i(21265),d=i(25799);!function(e){e[e.NONE=0]="NONE",e[e.NUMERIC=1]="NUMERIC",e[e.ASCII=2]="ASCII"}(o||(o={}));const u={pages:[],chars:[],info:{face:"Loading",size:0,bold:0,italic:0,charset:[],unicode:1,stretchH:100,smooth:1,aa:1,padding:[0,0,0,0],spacing:[0,0],os2version:1},common:{lineHeight:0,base:0,scaleW:1,scaleH:1,pages:0,packed:0,alphaChnl:0,redChnl:0,greenChnl:0,blueChnl:0},kernings:[]};var p=i(60778),m=i(94085),g=i(78909);class BitmapFontAtlas extends g.T{constructor(e){super(),this.packer=e,this.fontData=u,this.textures=[]}update(e,t){this.fontData=t,this.textures.forEach((e=>e.dispose())),this.textures.length=0,this.textures.push(...e),this.commit()}addCharsIfNeeded(e){this.packer.addChars(e)}}const f=new d.Z("FontManager");class BitmapFontPackerStatic{constructor(){this.name="roboto-700-42-static",this._atlas=new BitmapFontAtlas(this),this.mWidth=0}async loadFont(){const[e,t]=await Promise.all([(0,p.p)(m),i.e(386).then(i.t.bind(i,60386,19))]),n=t.default;return this.estimateWidth(n),this._atlas.update([e],n),Promise.resolve({fontPath:this.name,font:this.name,packer:this})}addChars(e){f.debug(this.name,"does not support dynamic char adding")}measureText(e){if(this.mWidth)return e.length*this.mWidth}atlas(){return this._atlas}estimateWidth(e){const t=e.chars.find((e=>e.id==="m".charCodeAt(0)));t&&(this.mWidth=t.width)}}const v=(()=>{let e=null;return function(){return e||(e=Promise.all([i.e(764),i.e(422),i.e(143)]).then(i.bind(i,44422)).then((e=>e.load))),e}})();class Rectangle{constructor(e=0,t=0,i=0,n=0,s=!1,o){this.oversized=!1,this._rot=!1,this._allowRotation=void 0,this._dirty=0,this._width=e,this._height=t,this._x=i,this._y=n,this._data={},this._rot=s,this._allowRotation=o}static Collide(e,t){return e.collide(t)}static Contain(e,t){return e.contain(t)}area(){return this.width*this.height}collide(e){return e.x<this.x+this.width&&e.x+e.width>this.x&&e.y<this.y+this.height&&e.y+e.height>this.y}contain(e){return e.x>=this.x&&e.y>=this.y&&e.x+e.width<=this.x+this.width&&e.y+e.height<=this.y+this.height}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._dirty++)}get height(){return this._height}set height(e){e!==this._height&&(this._height=e,this._dirty++)}get x(){return this._x}set x(e){e!==this._x&&(this._x=e,this._dirty++)}get y(){return this._y}set y(e){e!==this._y&&(this._y=e,this._dirty++)}get rot(){return this._rot}set rot(e){if(!1!==this._allowRotation&&this._rot!==e){const t=this.width;this.width=this.height,this.height=t,this._rot=e,this._dirty++}}get allowRotation(){return this._allowRotation}set allowRotation(e){this._allowRotation!==e&&(this._allowRotation=e,this._dirty++)}get data(){return this._data}set data(e){null!==e&&e!==this._data&&(this._data=e,"object"==typeof e&&e.hasOwnProperty("allowRotation")&&(this._allowRotation=e.allowRotation),this._dirty++)}get dirty(){return this._dirty>0}setDirty(e=!0){this._dirty=e?this._dirty+1:0}}class Bin{constructor(){this._dirty=0}get dirty(){return this._dirty>0||this.rects.some((e=>e.dirty))}setDirty(e=!0){if(this._dirty=e?this._dirty+1:0,!e)for(let e of this.rects)e.setDirty&&e.setDirty(!1)}}class MaxRectsBin extends Bin{constructor(e=y,t=y,i=0,n={}){super(),this.maxWidth=e,this.maxHeight=t,this.padding=i,this.freeRects=[],this.rects=[],this.verticalExpand=!1,this.options={smart:!0,pot:!0,square:!0,allowRotation:!1,tag:!1,exclusiveTag:!0,border:0,logic:b.MAX_EDGE},this.options=Object.assign(Object.assign({},this.options),n),this.width=this.options.smart?0:e,this.height=this.options.smart?0:t,this.border=this.options.border?this.options.border:0,this.freeRects.push(new Rectangle(this.maxWidth+this.padding-2*this.border,this.maxHeight+this.padding-2*this.border,this.border,this.border)),this.stage=new Rectangle(this.width,this.height)}add(...e){let t,i;if(1===e.length){if("object"!=typeof e[0])throw new Error("MacrectsBin.add(): Wrong parameters");i=e[0];let t=i.data&&i.data.tag?i.data.tag:i.tag?i.tag:void 0;if(this.options.tag&&this.options.exclusiveTag&&this.tag!==t)return}else{if(t=e.length>2?e[2]:null,this.options.tag&&this.options.exclusiveTag){if(t&&this.tag!==t.tag)return;if(!t&&this.tag)return}i=new Rectangle(e[0],e[1]),i.data=t,i.setDirty(!1)}const n=this.place(i);return n&&this.rects.push(n),n}repack(){let e=[];this.reset(),this.rects.sort(((e,t)=>{const i=Math.max(t.width,t.height)-Math.max(e.width,e.height);return 0===i&&e.hash&&t.hash?e.hash>t.hash?-1:1:i}));for(let t of this.rects)this.place(t)||e.push(t);for(let t of e)this.rects.splice(this.rects.indexOf(t),1);return e.length>0?e:void 0}reset(e=!1,t=!1){e&&(this.data&&delete this.data,this.tag&&delete this.tag,this.rects=[],t&&(this.options={smart:!0,pot:!0,square:!0,allowRotation:!1,tag:!1,border:0})),this.width=this.options.smart?0:this.maxWidth,this.height=this.options.smart?0:this.maxHeight,this.border=this.options.border?this.options.border:0,this.freeRects=[new Rectangle(this.maxWidth+this.padding-2*this.border,this.maxHeight+this.padding-2*this.border,this.border,this.border)],this.stage=new Rectangle(this.width,this.height),this._dirty=0}clone(){let e=new MaxRectsBin(this.maxWidth,this.maxHeight,this.padding,this.options);for(let t of this.rects)e.add(t);return e}place(e){let t,i,n=e.data&&e.data.tag?e.data.tag:e.tag?e.tag:void 0;if(!this.options.tag||!this.options.exclusiveTag||this.tag===n){if(i=e.hasOwnProperty("_allowRotation")&&void 0!==e.allowRotation?e.allowRotation:this.options.allowRotation,t=this.findNode(e.width+this.padding,e.height+this.padding,i),t){this.updateBinSize(t);let i=this.freeRects.length,n=0;for(;n<i;)this.splitNode(this.freeRects[n],t)&&(this.freeRects.splice(n,1),i--,n--),n++;return this.pruneFreeList(),this.verticalExpand=this.width>this.height,e.x=t.x,e.y=t.y,void 0===e.rot&&(e.rot=!1),e.rot=t.rot?!e.rot:e.rot,this._dirty++,e}if(this.verticalExpand){if(this.updateBinSize(new Rectangle(e.width+this.padding,e.height+this.padding,this.border,this.height+this.padding-this.border))||this.updateBinSize(new Rectangle(e.width+this.padding,e.height+this.padding,this.width+this.padding-this.border,this.border)))return this.place(e)}else if(this.updateBinSize(new Rectangle(e.width+this.padding,e.height+this.padding,this.width+this.padding-this.border,this.border))||this.updateBinSize(new Rectangle(e.width+this.padding,e.height+this.padding,this.border,this.height+this.padding-this.border)))return this.place(e)}}findNode(e,t,i){let n,s,o,r=Number.MAX_VALUE;for(let a in this.freeRects)s=this.freeRects[a],s.width>=e&&s.height>=t&&(n=this.options.logic===b.MAX_AREA?s.width*s.height-e*t:Math.min(s.width-e,s.height-t),n<r&&(o=new Rectangle(e,t,s.x,s.y),r=n)),i&&s.width>=t&&s.height>=e&&(n=this.options.logic===b.MAX_AREA?s.width*s.height-t*e:Math.min(s.height-e,s.width-t),n<r&&(o=new Rectangle(t,e,s.x,s.y,!0),r=n));return o}splitNode(e,t){if(!e.collide(t))return!1;if(t.x<e.x+e.width&&t.x+t.width>e.x){if(t.y>e.y&&t.y<e.y+e.height){let i=new Rectangle(e.width,t.y-e.y,e.x,e.y);this.freeRects.push(i)}if(t.y+t.height<e.y+e.height){let i=new Rectangle(e.width,e.y+e.height-(t.y+t.height),e.x,t.y+t.height);this.freeRects.push(i)}}if(t.y<e.y+e.height&&t.y+t.height>e.y){if(t.x>e.x&&t.x<e.x+e.width){let i=new Rectangle(t.x-e.x,e.height,e.x,e.y);this.freeRects.push(i)}if(t.x+t.width<e.x+e.width){let i=new Rectangle(e.x+e.width-(t.x+t.width),e.height,t.x+t.width,e.y);this.freeRects.push(i)}}return!0}pruneFreeList(){let e=0,t=0,i=this.freeRects.length;for(;e<i;){t=e+1;let n=this.freeRects[e];for(;t<i;){let s=this.freeRects[t];if(s.contain(n)){this.freeRects.splice(e,1),e--,i--;break}n.contain(s)&&(this.freeRects.splice(t,1),t--,i--),t++}e++}}updateBinSize(e){if(!this.options.smart)return!1;if(this.stage.contain(e))return!1;let t=Math.max(this.width,e.x+e.width-this.padding+this.border),i=Math.max(this.height,e.y+e.height-this.padding+this.border);if(this.options.allowRotation){const n=Math.max(this.width,e.x+e.height-this.padding+this.border),s=Math.max(this.height,e.y+e.width-this.padding+this.border);n*s<t*i&&(t=n,i=s)}return this.options.pot&&(t=Math.pow(2,Math.ceil(Math.log(t)*Math.LOG2E)),i=Math.pow(2,Math.ceil(Math.log(i)*Math.LOG2E))),this.options.square&&(t=i=Math.max(t,i)),!(t>this.maxWidth+this.padding||i>this.maxHeight+this.padding)&&(this.expandFreeRects(t+this.padding,i+this.padding),this.width=this.stage.width=t,this.height=this.stage.height=i,!0)}expandFreeRects(e,t){this.freeRects.forEach(((i,n)=>{i.x+i.width>=Math.min(this.width+this.padding-this.border,e)&&(i.width=e-i.x-this.border),i.y+i.height>=Math.min(this.height+this.padding-this.border,t)&&(i.height=t-i.y-this.border)}),this),this.freeRects.push(new Rectangle(e-this.width-this.padding,t-2*this.border,this.width+this.padding-this.border,this.border)),this.freeRects.push(new Rectangle(e-2*this.border,t-this.height-this.padding,this.border,this.height+this.padding-this.border)),this.freeRects=this.freeRects.filter((e=>!(e.width<=0||e.height<=0||e.x<this.border||e.y<this.border))),this.pruneFreeList()}}class OversizedElementBin extends Bin{constructor(...e){if(super(),this.rects=[],1===e.length){if("object"!=typeof e[0])throw new Error("OversizedElementBin: Wrong parameters");const t=e[0];this.rects=[t],this.width=t.width,this.height=t.height,this.data=t.data,t.oversized=!0}else{this.width=e[0],this.height=e[1],this.data=e.length>2?e[2]:null;const t=new Rectangle(this.width,this.height);t.oversized=!0,t.data=this.data,this.rects.push(t)}this.freeRects=[],this.maxWidth=this.width,this.maxHeight=this.height,this.options={smart:!1,pot:!1,square:!1}}add(){}reset(e=!1){}repack(){}clone(){return new OversizedElementBin(this.rects[0])}}const y=4096;var b;!function(e){e[e.MAX_AREA=0]="MAX_AREA",e[e.MAX_EDGE=1]="MAX_EDGE"}(b||(b={}));class MaxRectsPacker{constructor(e=y,t=y,i=0,n={}){this.width=e,this.height=t,this.padding=i,this.options={smart:!0,pot:!0,square:!1,allowRotation:!1,tag:!1,exclusiveTag:!0,border:0,logic:b.MAX_EDGE},this._currentBinIndex=0,this.bins=[],this.options=Object.assign(Object.assign({},this.options),n)}add(...e){if(1===e.length){if("object"!=typeof e[0])throw new Error("MacrectsPacker.add(): Wrong parameters");const t=e[0];if(t.width>this.width||t.height>this.height)this.bins.push(new OversizedElementBin(t));else{if(!this.bins.slice(this._currentBinIndex).find((e=>void 0!==e.add(t)))){let e=new MaxRectsBin(this.width,this.height,this.padding,this.options),i=t.data&&t.data.tag?t.data.tag:t.tag?t.tag:void 0;this.options.tag&&i&&(e.tag=i),e.add(t),this.bins.push(e)}}return t}{const t=new Rectangle(e[0],e[1]);if(e.length>2&&(t.data=e[2]),t.width>this.width||t.height>this.height)this.bins.push(new OversizedElementBin(t));else{if(!this.bins.slice(this._currentBinIndex).find((e=>void 0!==e.add(t)))){let e=new MaxRectsBin(this.width,this.height,this.padding,this.options);this.options.tag&&t.data.tag&&(e.tag=t.data.tag),e.add(t),this.bins.push(e)}}return t}}addArray(e){if(!this.options.tag||this.options.exclusiveTag)this.sort(e,this.options.logic).forEach((e=>this.add(e)));else{if(0===e.length)return;let t;e.sort(((e,t)=>{const i=e.data&&e.data.tag?e.data.tag:e.tag?e.tag:void 0,n=t.data&&t.data.tag?t.data.tag:t.tag?t.tag:void 0;return void 0===n?-1:void 0===i?1:n>i?-1:1}));let i=0;if(!this.bins.slice(this._currentBinIndex).find((n=>{let s=n.clone();for(let o=i;o<e.length;o++){const r=e[o],a=r.data&&r.data.tag?r.data.tag:r.tag?r.tag:void 0;if(0===o&&(t=a),a!==t)return t=a,this.sort(e.slice(i,o),this.options.logic).forEach((e=>n.add(e))),i=o,this.addArray(e.slice(o)),!0;if(void 0===a)return this.sort(e.slice(o),this.options.logic).forEach((e=>this.add(e))),i=e.length,!0;if(void 0===s.add(r))return!1}return this.sort(e.slice(i),this.options.logic).forEach((e=>n.add(e))),!0}))){const t=e[i],n=new MaxRectsBin(this.width,this.height,this.padding,this.options),s=t.data&&t.data.tag?t.data.tag:t.tag?t.tag:void 0;this.options.tag&&this.options.exclusiveTag&&s&&(n.tag=s),this.bins.push(n),this.addArray(e.slice(i))}}}reset(){this.bins=[],this._currentBinIndex=0}repack(e=!0){if(e){let e=[];for(let t of this.bins)if(t.dirty){let i=t.repack();i&&e.push(...i)}return void this.addArray(e)}if(!this.dirty)return;const t=this.rects;this.reset(),this.addArray(t)}next(){return this._currentBinIndex=this.bins.length,this._currentBinIndex}load(e){e.forEach(((e,t)=>{if(e.maxWidth>this.width||e.maxHeight>this.height)this.bins.push(new OversizedElementBin(e.width,e.height,{}));else{let i=new MaxRectsBin(this.width,this.height,this.padding,e.options);i.freeRects.splice(0),e.freeRects.forEach(((e,t)=>{i.freeRects.push(new Rectangle(e.width,e.height,e.x,e.y))})),i.width=e.width,i.height=e.height,e.tag&&(i.tag=e.tag),this.bins[t]=i}}),this)}save(){let e=[];return this.bins.forEach((t=>{let i={width:t.width,height:t.height,maxWidth:t.maxWidth,maxHeight:t.maxHeight,freeRects:[],rects:[],options:t.options};t.tag&&(i=Object.assign(Object.assign({},i),{tag:t.tag})),t.freeRects.forEach((e=>{i.freeRects.push({x:e.x,y:e.y,width:e.width,height:e.height})})),e.push(i)})),e}sort(e,t=b.MAX_EDGE){return e.slice().sort(((e,i)=>{const n=t===b.MAX_EDGE?Math.max(i.width,i.height)-Math.max(e.width,e.height):i.width*i.height-e.width*e.height;return 0===n&&e.hash&&i.hash?e.hash>i.hash?-1:1:n}))}get currentBinIndex(){return this._currentBinIndex}get dirty(){return this.bins.some((e=>e.dirty))}get rects(){let e=[];for(let t of this.bins)e.push(...t.rects);return e}}const w=function(){const e=document.createElement("a");return document.body.appendChild(e),e.style.display="none",(t,i)=>{const n=t.toDataURL();e.href=n,e.download=i,e.click()}}(),S=(e,t)=>{const i=document.createElement("a");i.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),i.setAttribute("download",t),i.click()};var E=i(5368);const T=new d.Z("font-packer"),M={outlineOffset:Number((0,h.hu)("outlineOffset",.2)),save:"1"===(0,h.hu)("exportfont","0"),saveDefaultFont:"1"===(0,h.hu)("exportdefault","0"),verboseChars:!0,verboseFont:!0,perf:{log:!1,marks:{rebuild:"rebuild",kern:"kerning",metrics:"metrics",pack:"pack",texture:"texture",bmfont:"load-bmfont"}}};class BitmapFontPacker{constructor(e,t){this.needsRebuild=!1,this._atlas=new BitmapFontAtlas(this),this._loading=!1,this._loaded=!1,this._addedChars=[],this.charSet=new Set,this.kerningsMap={},this.measureMap={},this.metricsMap={},this.scale=1,this.throttledRebuild=(0,E.P)((()=>{setTimeout((()=>this.rebuild()),0)}),1500),this.options=e,t&&(this.font=t);try{this.canvas=document.createElement("canvas"),this.canvas.width=this.options.width,this.canvas.height=this.options.height;const e=this.canvas&&this.canvas.getContext("2d");if(!e)throw Error("Unable to create canvas context for font-packer");this.ctx=e,this.ctx.fillStyle="white",this.ctx.textBaseline="alphabetic",this.ctx.textAlign="center"}catch(e){T.error("Failed to create canvas rendering context",e)}if(this.packer=new MaxRectsPacker(this.options.width,this.options.height,2*this.options.texturePadding),this.options.defaultCharset){(function(e=!1){const t=new Set(Array.from("m0123456789_-+'\"` \t")),i=[];e&&i.push([32,127]);for(const e of i)for(let i=e[0];i<e[1];i++)t.add(String.fromCharCode(i));return t})(this.options.defaultCharset===o.ASCII||M.saveDefaultFont).forEach((e=>this.charSet.add(e)))}}get loaded(){return!this._loading&&this._loaded}async loadFont(){let e;if(M.perf.log&&performance.mark(M.perf.marks.bmfont),!this.font){this._loading=!0,e=new FontFace(`${this.options.fontFamily}`,`url("${this.options.fontPath}") format("woff")`,{family:`${this.options.fontFamily}`,style:`${this.options.fontStyle}`,weight:`${this.options.fontWeight}`}),e.load();const t=e.loaded,i=(await v())(this.options.fontPath),[n]=await Promise.all([i,t]);this.font=n}M.perf.log&&performance.measure(M.perf.marks.bmfont,M.perf.marks.bmfont),this.scale=this.options.fontSize/this.font.unitsPerEm;const t=`${this.options.fontWeight} ${this.options.fontSize}px ${this.options.fontFamily}`;return this.ctx.font=t,M.verboseFont&&T.debug({contextFontFace:t,bmfont:this.font,charset:this.charSet}),this._loading=!1,this.fontFilename=`${this.options.fontFamily.toLowerCase()}-${this.options.fontWeight}-${this.options.fontSize}`+(this.options.outline?"-outline-"+this.options.outlineWidth:""),this.needsRebuild=!0,this.throttledRebuild(),{fontPath:this.options.fontPath,font:this.font,packer:this}}addChars(e){const t=this.charSet.size;return Array.from(e).forEach((e=>{this.charSet.has(e)||this._addedChars.push(e),this.charSet.add(e)})),t!==this.charSet.size&&(this.needsRebuild=!0,this.throttledRebuild()),this.needsRebuild}atlas(){return this._atlas}rebuild(){if(!this.font)return;if(this.loaded&&this._addedChars.length<1)return void(this.needsRebuild=!1);M.verboseChars&&(T.debug(`Added ${this._addedChars.length} glyphs: \n${this._addedChars}`),this._addedChars.length=0),performance.mark(M.perf.marks.rebuild),M.perf.log&&performance.mark(M.perf.marks.metrics);const e=this.getAllGlyphMetrics();M.perf.log&&performance.measure(M.perf.marks.metrics,M.perf.marks.metrics),M.perf.log&&performance.mark(M.perf.marks.pack);const t=this.pack(e);M.perf.log&&performance.measure(M.perf.marks.pack,M.perf.marks.pack),M.perf.log&&performance.mark(M.perf.marks.texture);const{chars:i,textures:n}=this.assembleTexture(t);M.perf.log&&performance.measure(M.perf.marks.texture,M.perf.marks.texture),M.perf.log&&performance.mark(M.perf.marks.kern);const s=this.getKerningPairs();M.perf.log&&performance.measure(M.perf.marks.kern,M.perf.marks.kern);const o=this.assembleFont(i,s,n);performance.measure(M.perf.marks.rebuild,M.perf.marks.rebuild),this._loaded=!0,this._atlas.update(n,o);const r=`Rebuilt atlas for ${this.charSet.size} chars with ${o.kernings.length} kerning pairs`;M.perf.log?(T.debug(r,performance.getEntriesByName(M.perf.marks.rebuild,"measure")[0],performance.getEntriesByType("measure").map((e=>({name:e.name,duration:e.duration}))),this.options),Object.values(M.perf.marks).forEach((e=>{performance.clearMarks(e),performance.clearMeasures(e)}))):(T.debug(r,performance.getEntriesByName(M.perf.marks.rebuild,"measure")[0]),performance.clearMarks(M.perf.marks.rebuild),performance.clearMeasures(M.perf.marks.rebuild))}pack(e){return this.packer.bins.length=0,this.packer.addArray(e),this.packer.bins.reverse()}assembleTexture(e){const t=[],i=e.map(((e,i)=>(this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.options.transparent&&this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),e.rects.forEach((e=>{const n=e.data.charData,s=e.x+n.width/2-this.options.texturePadding/2,o=e.y+n.height+n.ymin-this.options.texturePadding;this.options.outline&&this.options.outlineWidth>0?function(e,t,i,n,s){const o=e.strokeStyle,r=e.fillStyle,a=e.lineJoin,l=e.miterLimit;e.lineJoin="miter",e.miterLimit=2,e.beginPath(),e.strokeStyle="black",e.lineWidth=s,e.strokeText(t,i,n),e.beginPath(),e.fillStyle="white",e.fillText(t,i,n),e.strokeStyle=o,e.fillStyle=r,e.lineJoin=a,e.miterLimit=l}(this.ctx,e.data.charData.char,s,o,this.options.outlineWidth):this.ctx.fillText(e.data.charData.char,s,o),n.x=e.x,n.y=e.y,n.page=i,t.push(e.data.charData)})),M.save&&w(this.ctx.canvas,`${this.fontFilename}_${i}.png`),this.makeCanvasTexture(i,!1))));return{chars:t,textures:i}}getKerningPairs(){const e=[],t=[...this.charSet.values()].map((e=>this.font.charToGlyphIndex(e))).filter((e=>e>0));for(const i of t)for(const n of t){const t=`${i},${n}`;let s=this.kerningsMap[t];if(!s){s={first:i,second:n,amount:this.font.getKerningValue(i,n)*this.scale},this.kerningsMap[t]=s}s&&0!==s.amount&&e.push(s)}return e}assembleFont(e,t,i){const n=this.font.tables.os2,s=this.font.tables.name.fullName,o=s[Object.getOwnPropertyNames(s)[0]],r={pages:i.map(((e,t)=>`${this.fontFilename}_${t}.png`)),chars:e,info:{face:o,size:this.options.fontSize,bold:0,italic:0,charset:[...this.charSet.values()],unicode:1,stretchH:100,smooth:1,aa:1,padding:[0,0,0,0],spacing:[this.options.texturePadding,this.options.texturePadding],os2version:n.version},common:{lineHeight:(n.sTypoAscender-n.sTypoDescender+n.sTypoLineGap)*this.scale,base:this.font.ascender*this.scale,scaleW:this.options.width,scaleH:this.options.height,pages:this.packer.bins.length,packed:0,alphaChnl:0,redChnl:0,greenChnl:0,blueChnl:0},kernings:t};return M.verboseFont&&T.debug({bmFontOutput:r,kerningPairCount:t.length}),M.save&&(S(JSON.stringify(r),`${this.fontFilename}.json`),S(JSON.stringify(this.options,void 0,2),`${this.fontFilename}-pack-options.json`)),r}getMetrics(e){const t=this.font.charToGlyph(e);let i=this.measureMap[e];i||(i=t.getMetrics(),this.measureMap[e]=i);const{width:n,height:s}=this.measureChar(e),o=2*this.options.texturePadding,r=s+o,a=-i.yMax*this.scale-this.options.texturePadding,l=t.advanceWidth*this.scale,c=l>=n,h=c?l:n;return{char:e,width:n+o,height:r,ymin:i.yMin*this.scale-(c?0:s+a+this.options.texturePadding),bottom:a,xadvance:h+(this.options.outline?this.options.outlineWidth*M.outlineOffset:0),supported:c}}measureText(e){if(!this.loaded)return;let t=0;for(const i of Array.from(e)){const{width:e}=this.measureChar(i);t+=e}return t}measureChar(e){let t=this.metricsMap[e];t||(t=this.ctx.measureText(e),this.metricsMap[e]=t);const i=t.actualBoundingBoxLeft+t.actualBoundingBoxRight;return{width:t.width||i,height:t.actualBoundingBoxAscent+t.actualBoundingBoxDescent}}getAllGlyphMetrics(){const e=[],t=this.font.ascender*this.scale;for(const i of this.charSet.values()){const n=this.getMetrics(i),s={data:{charData:{char:i,id:i.charCodeAt(0),width:n.width,height:n.height,xoffset:0,yoffset:n.bottom+t,xadvance:n.xadvance,chnl:15,ymin:n.ymin}},width:n.width,height:n.height};e.push(s)}return e}makeCanvasTexture(e,t){if(t){const e=new Uint8Array(this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height).data),t=new n.DataTexture(e,this.canvas.width,this.canvas.height,n.RGBAFormat);return t.flipY=!0,t}const i=new n.Texture(this.ctx.canvas);return i.name=`${this.ctx.font}_${e}`,i.format=n.RGBAFormat,i.needsUpdate=!0,i}}const _=new d.Z("FontManager"),x={fontPath:"fonts/roboto-700.woff",fontWeight:700,fontFamily:"Roboto",fontStyle:"normal",fontSize:60,width:2048,height:2048,transparent:!0,defaultCharset:o.ASCII,outline:!1,outlineWidth:4,texturePadding:6},A="1"===(0,h.hu)("staticfont","0");class FontManager{constructor(){this.defaultFontOptions=x,this.packerMap=new Map,this.optionsMap=new Map,this.parsedFontMap=new Map}static get instance(){return FontManager._instance||(FontManager._instance=new FontManager),FontManager._instance}getFontId(e=this.defaultFontOptions){const t=Object.assign(Object.assign({},this.defaultFontOptions),e),i=JSON.stringify(t);return this.optionsMap.set(i,t),i}getFont(e){let t=this.packerMap.get(e);if(!t&&A&&(t=new BitmapFontPackerStatic,t.loadFont(),this.packerMap.set(e,t)),!t){const i=this.optionsMap.get(e)||JSON.parse(e),n=this.parsedFontMap.get(i.fontPath);t=new BitmapFontPacker(i,n),this.packerMap.set(e,t),t.loadFont().then((t=>{_.debug("font loaded",e,t.fontPath),this.parsedFontMap.set(t.fontPath,t.font)}))}return t.atlas()}measureText(e,t){const i=this.packerMap.get(e);if(i)return i.measureText(t)}}var O,P=i(91055),C=i(53628);class Label3DMesh extends n.Mesh{}!function(e){e.WORLD="world",e.NDC="ndc"}(O||(O={}));class Label3D extends n.Object3D{constructor(e,t=FontManager.instance,o=O.WORLD){super(),this.config=e,this.fontManager=t,this.scaleType=o,this.update=()=>{const e=this.resolvedConfig;this.textGeometry.update(e),this.textGeometry.computeBoundingBox();const t=this.textGeometry.layout.lineHeight-this.textGeometry.layout.baseline;this.labelTextMesh.position.x=-.5*this.textGeometry.layout.width+t,this.labelTextMesh.position.y=-.5*this.textGeometry.layout.height+t,this.labelTextMesh.position.z=.25,this.unscaledWidth=this.textGeometry.layout.width+this.config.backgroundBorderWidth,this.unscaledHeight=this.textGeometry.layout.height+this.config.backgroundBorderHeight,(this.labelBackgroundMesh||this.config.backgroundAsCollider)&&this.labelBackgroundMesh.scale.set(this.unscaledWidth,this.unscaledHeight,.01),this.aspect=this.unscaledWidth/Math.max(this.unscaledHeight,.001),this.fontHeightToMeters=1/e.font.info.size,this.updateScale()};const a=void 0!==this.config.opacity?this.config.opacity:1;if(this.config.background||this.config.backgroundAsCollider){this.config.backgroundOpacity=void 0!==this.config.backgroundOpacity?this.config.backgroundOpacity:1,this.config.backgroundOpacity=this.config.background?this.config.backgroundOpacity:0;const t=new n.BoxGeometry(1,1,.01),i=new n.MeshBasicMaterial({color:e.backgroundColor,transparent:!0,depthTest:this.config.backgroundOpacity>0&&!e.disableDepth,depthWrite:this.config.backgroundOpacity>0&&!e.disableDepth,opacity:this.config.backgroundOpacity,stencilRef:1,stencilFail:n.KeepStencilOp,stencilZFail:n.KeepStencilOp,stencilZPass:n.ReplaceStencilOp,stencilFunc:n.AlwaysStencilFunc,stencilWrite:!0});this.labelBackgroundMesh=new this.config.backgroundColliderType(t,i),this.labelBackgroundMesh.position.z=-.25,this.labelBackgroundMesh.name="Label Background",this.collider=this.labelBackgroundMesh,this.add(this.labelBackgroundMesh)}const l={outline:this.config.outline,outlineWidth:this.config.outlineWidth},c={uniforms:{map:{type:"t",value:(h=Object.assign(Object.assign({},l),{color:e.color,opacity:a})).map},color:{type:"c",value:new n.Color(h.color)},opacity:{type:"f",value:h.opacity}},vertexShader:i(35850),fragmentShader:i(51712)};var h;const d=new n.RawShaderMaterial({uniforms:c.uniforms,fragmentShader:c.fragmentShader,vertexShader:c.vertexShader,side:n.DoubleSide,transparent:!0,depthTest:!1,depthWrite:!1,opacity:a});d.name="Label Text",this.fontId=this.fontManager.getFontId(l);const u=this.fontManager.getFont(this.fontId);d.uniforms.map.value=u.textures[0],u.onChanged((()=>{d.uniforms.map.value=u.textures[0],this.update()}));const p=this.resolvedConfig,m=p.font;this.textGeometry=s(p),this.labelTextMesh=new Label3DMesh(this.textGeometry,d),this.labelTextMesh.name="Label Text",this.labelTextMesh.renderOrder=10;const g=(new n.Quaternion).setFromAxisAngle(r.f.FORWARD,n.MathUtils.degToRad(180)),f=(new n.Quaternion).setFromAxisAngle(r.f.UP,n.MathUtils.degToRad(180));this.labelTextMesh.quaternion.multiply(g).multiply(f),this.add(this.labelTextMesh),this.name="Label Container",this.fontHeightToMeters=1/m.info.size,this.scaleFactor=e.scale||this.fontHeightToMeters,this.update()}get resolvedConfig(){let e;if(void 0!==this.config.wordWrapWidth){const t=this.fontManager.measureText(this.fontId,this.config.text);void 0!==t&&t>this.config.wordWrapWidth&&(e=this.config.wordWrapWidth)}const t=this.fontManager.getFont(this.fontId);return Object.assign(Object.assign({},this.config),{font:t.fontData,texture:t.textures[0],width:e})}updateScale(){const e=this.config.scale*this.fontHeightToMeters;this.scale.set(e,e,e)}get text(){return this.config.text}set text(e){e!==this.name&&(this.config.text=e,this.name=e,this.fontManager.getFont(this.fontId).addCharsIfNeeded(e),this.update())}get mesh(){return this.labelTextMesh}get scaleFactor(){return this.config.scale}set scaleFactor(e){this.scaleFactor!==e&&(this.config.scale=e,this.updateScale())}get opacity(){return void 0!==this.config.opacity?this.config.opacity:1}set opacity(e){if(e!==this.config.opacity){this.config.opacity=e;const t=e>0&&!this.config.disableDepth;if(this.config.background){const i=this.labelBackgroundMesh.material;i.opacity=Math.min(this.config.backgroundOpacity||1,e),i.depthWrite=e>C.iV.DEPTH_WRITE_THRESHOD,i.depthTest=t}const i=this.labelTextMesh.material;i.uniforms.opacity.value=e,i.depthTest=t,this.visible=e>0}}setColorHex(e){const t=this.labelTextMesh.material.uniforms.color;t.value.getHex()!==e&&t.value.setHex(e)}setRenderLayer(e){this.labelTextMesh.layers.mask=e.mask,this.labelBackgroundMesh&&(this.labelBackgroundMesh.layers.mask=e.mask)}setRenderOrder(e){this.renderOrder=e,this.labelTextMesh.renderOrder=e,this.labelBackgroundMesh&&(this.labelBackgroundMesh.renderOrder=e)}setPosition(e,t=(e=>e)){this.position.copy(t(e))}setOrientation(e,t=0){this.quaternion.copy(e),0!==t&&this.rotateZ(-t*a.Ue)}scaleBillboard(e,t,i,n,s,o,r=D.SCALE_DEFAULT){if(0!==i.elements[15])this.scaleFactor=.2*r*n*(D.ORTHO_IDEAL_HEIGHT/s);else{const a=(0,c.D_)(this.position,e,t,i.asThreeMatrix4()),h=Math.abs(a.x);if(h<1){const t=(0,P.mY)(i,e,this.position,s,r),a=((0,l.uZ)(o,1,2.5)+n)*D.SCALE_ASPECT,c=1+D.SCALE_NDC-h*D.SCALE_NDC-a,d=Math.max(Math.min(1/t*c,3),.001);this.scaleType===O.NDC?this.scaleFactor=d:this.scaleFactor=Math.min(d*D.NDC_MULT,r*D.SCALE_WORLD)}else this.scaleFactor=.001}this.updateScale()}}const D={SCALE_DEFAULT:.1,SCALE_WORLD:Number((0,h.hu)("scale_world",4)),SCALE_NDC:.5,SCALE_ASPECT:.035,DEPTH_WRITE_THRESHOD:.15,ORTHO_IDEAL_HEIGHT:1500,NDC_MULT:1.15}},30041:(e,t,i)=>{"use strict";i.d(t,{u:()=>Label3DFactory});var n=i(36168),s=i(2212);class Label3DFactory{constructor(e){this.currentTextConfig=Label3DFactory.defaultTextConfig,e?this.updateTextStyle(e):this.updateTextStyle(Label3DFactory.defaultTextConfig)}updateTextStyle(e){this.currentTextConfig=Object.assign(Object.assign({},this.currentTextConfig),e)}createLabel(e={text:""}){return new n.$(Object.assign(Object.assign({},this.currentTextConfig),e))}static makeConfig(e){return Object.assign(Object.assign({},this.defaultTextConfig),e)}}Label3DFactory.defaultTextConfig={text:"",align:"center",wordWrapWidth:void 0,color:"black",backgroundColor:"white",backgroundBorderWidth:50,backgroundBorderHeight:30,background:!0,backgroundAsCollider:!0,backgroundColliderType:s.Mesh,scale:1,outline:!1,outlineWidth:4}},2124:(e,t,i)=>{"use strict";i.d(t,{P:()=>CircularBuffer});class CircularBuffer{constructor(e){this.size=e,this.index=0,this.buffer=[]}push(e){this.index>=this.size&&(this.index=0),this.buffer[this.index]=e,this.index++}peek(){return this.buffer[this.index<=this.buffer.length?this.index-1:0]||null}getList(){return this.buffer}*[Symbol.iterator](){yield*this.buffer}clear(){this.buffer=[],this.index=0}}},75712:(e,t,i)=>{"use strict";i.d(t,{s:()=>Comparator});class Comparator{constructor(e){this.matcher=e}static isValue(e){return new Comparator(new ValueMatcher(e))}static isType(e){return new Comparator(new TypeMatcher(e))}static isInstanceOf(e){return new Comparator(new InstanceMatcher(e))}static is(e){return new Comparator(new PredicateMatcher(e))}static isAny(){return new Comparator(new AnyMatcher)}compare(e){return this.matcher.matches(e)}}class ValueMatcher{constructor(e){this.value=e}matches(e){return this.value===e}}class TypeMatcher{constructor(e){this.type=e}matches(e){return Object.getPrototypeOf(e).constructor===this.type}}class InstanceMatcher{constructor(e){this.type=e}matches(e){if("object"==typeof e)return e instanceof this.type;const t=this.type;switch(typeof e){case"number":return t===Number;case"string":return t===String;case"boolean":return t===Boolean;case"function":return t===Function}return!1}}class PredicateMatcher{constructor(e){this.predicate=e}matches(e){return this.predicate(e)}}class AnyMatcher{constructor(){}matches(){return!0}}},90384:(e,t,i)=>{"use strict";i.d(t,{l1:()=>o,r2:()=>l});var n=i(2212),s=i(27829);var o;!function(e){e[e.Axes=1]="Axes",e[e.PlanarAxes=2]="PlanarAxes",e[e.EdgesAndPlanarAxes=3]="EdgesAndPlanarAxes",e[e.Edges=4]="Edges",e[e.Free=5]="Free",e[e.Locked=6]="Locked"}(o||(o={}));const r={[s.e.UP]:{dir:Object.freeze(s.f.UP.clone())},[s.e.DOWN]:{dir:Object.freeze(s.f.DOWN.clone())},[s.e.BACK]:{dir:Object.freeze(s.f.BACK.clone())},[s.e.LEFT]:{dir:Object.freeze(s.f.LEFT.clone())},[s.e.RIGHT]:{dir:Object.freeze(s.f.RIGHT.clone())},[s.e.FORWARD]:{dir:Object.freeze(s.f.FORWARD.clone())}},a={[s.e.HORIZONTAL_PLANE]:{dir:Object.freeze(s.f.HORIZONTAL_PLANE.clone())}},l=(()=>{let e=0;const t=new n.Vector3,i=new n.Vector3,l=new n.Vector3,c=new n.Vector3,h=999,d=Object.freeze(s.f.ZERO.clone()),u=Object.keys(r).map((e=>Object.assign(Object.assign({},r[e]),{name:e,angleTo:h}))),p=Object.keys(a).map((e=>Object.assign(Object.assign({},a[e]),{name:e,angleTo:h}))),m=e=>(e+3)%2;let g=u[0];return(r,a,f=o.Axes)=>{if(f===o.Free)return{position:a.clone(),constrainedAxis:d,axisName:s.e.NONE};if(u.forEach((e=>e.angleTo=h)),p.forEach((e=>e.angleTo=h)),l.copy(a).sub(r),e=l.length(),e<.05)return{position:a.clone(),constrainedAxis:d,axisName:s.e.NONE};c.copy(l).normalize();const v=.05*Math.min(e,1);if(f!==o.Locked){for(const e of u){const t=n.MathUtils.radToDeg(c.angleTo(e.dir));t<g.angleTo&&(g=e),e.angleTo=t}if(g.angleTo>20){const e=Math.abs(l.y);e*e<v&&(g=p[0])}}t.set(r.x*m(g.dir.x),r.y*m(g.dir.y),r.z*m(g.dir.z)),i.set(a.x*Math.abs(g.dir.x),a.y*Math.abs(g.dir.y),a.z*Math.abs(g.dir.z)).add(t);return f===o.Locked||i.distanceToSquared(a)<v?{position:i.clone(),constrainedAxis:g.dir,axisName:g.name}:{position:a.clone(),constrainedAxis:d,axisName:s.e.NONE}}})()},68519:(e,t,i)=>{"use strict";i.d(t,{s:()=>l,n:()=>ExpiringResource});var n=i(62367),s=i(25799),o=i(51770),r=i(44266);const a=new s.Z("expiring-resource");function l(e,t){(0,o.yW)(e,(e=>{e instanceof ExpiringResource&&(e.onStale=t)}))}class ExpiringResource{constructor(e,t){this.value=e,this.validUntil=t}refreshFrom(e){this.value=e.value,this.validUntil=e.validUntil,this.refreshPromise&&(this.refreshPromise.resolve(),this.refreshPromise=void 0)}waitForRefresh(e=1e4){this.refreshPromise||(this.refreshPromise=new r.Q);const t=(0,n.gw)(e).then((()=>{throw new Error("Waiting for resource url refresh timed out")}));return Promise.race([this.refreshPromise.nativePromise(),t])}async get(){if(this.validUntil&&this.onStale){const e=Date.now();e+6e4+1e4>this.validUntil.getTime()&&this.onStale(),e+6e4+1e3>this.validUntil.getTime()&&(a.warn("Stale resource, waiting for refresh"),await this.waitForRefresh(),a.info("Refreshed resource"))}return this.value}}},70691:(e,t,i)=>{"use strict";i.d(t,{ZP:()=>LineOctree,FM:()=>SnapLine3,UQ:()=>SnapVector3});var n=i(2212);class LineOctreeNode{constructor(e,t){this.raycast=(()=>{const e=new n.Vector3,t=new n.Box3;return(i,n,s)=>{const o=t.copy(this.bounds).expandByScalar(n);if(i.ray.intersectsBox(o))for(const t of this.children)if(t instanceof LineOctreeNode)t.raycast(i,n,s);else if(t instanceof SnapLine3){const o=e,r=i.ray.distanceSqToSegment(t.start,t.end,void 0,e),a=Math.sqrt(r);a<n&&s.push({distance:i.ray.origin.distanceTo(o),object:t,distanceToRay:a,point:o.clone(),isLineOctreeIntersection:!0})}else if(t instanceof SnapVector3){const e=i.ray.distanceToPoint(t);e<n&&s.push({distance:i.ray.origin.distanceTo(t),object:t,distanceToRay:e,point:t.clone(),isLineOctreeIntersection:!0})}}})(),this.level=t,this.bounds=e.clone(),this.childNodes=[],this.children=[]}add(e){let t=!1;const i=e instanceof n.Line3?[e.start,e.end]:[e];if(this.level<4){0===this.childNodes.length&&this.buildChildNodes();for(const n of this.childNodes)i.every((e=>n.bounds.containsPoint(e)))&&(t=!0,n.add(e))}t||this.children.push(e)}remove(e){const t=e instanceof n.Line3?[e.start,e.end]:[e];for(let i=0;i<this.children.length;i++){const n=this.children[i];if(n instanceof LineOctreeNode){if(t.every((e=>n.bounds.containsPoint(e)))&&n.remove(e))return!0}else if(n===e)return this.children.splice(i,1),!0}return!1}buildChildNodes(){const e=this.bounds.max.clone().sub(this.bounds.min).clone().multiplyScalar(.5);for(let t=0;t<2;t++)for(let i=0;i<2;i++)for(let s=0;s<2;s++){const o=this.bounds.min.x+e.x*s,r=o+e.x,a=this.bounds.min.y+e.y*t,l=a+e.y,c=this.bounds.min.z+e.z*i,h=c+e.z,d=new n.Box3(new n.Vector3(o,a,c),new n.Vector3(r,l,h)),u=new LineOctreeNode(d,this.level+1);this.childNodes.push(u),this.children.push(u)}}spherecast(e,t){if(e.intersectsBox(this.bounds))for(const i of this.children)if(i instanceof LineOctreeNode)i.spherecast(e,t);else if(i instanceof SnapLine3){const s=i.closestPointToPoint(e.center,!0,new n.Vector3);s.distanceTo(e.center)<e.radius&&t.push(new SnapVector3(s,i.floorId,i.roomId))}else i instanceof n.Vector3&&i.distanceTo(e.center)<e.radius&&t.push(i)}traverse(e){for(const t of this.children)t instanceof LineOctreeNode?t.traverse(e):e(t)}}class LineOctree{constructor(e){this.pointCount=0,this.lineCount=0,this.root=new LineOctreeNode(e,0)}add(e){e instanceof n.Line3?this.lineCount++:e instanceof n.Vector3&&this.pointCount++,this.root.add(e)}remove(e){e instanceof SnapLine3?this.lineCount--:e instanceof SnapVector3&&this.pointCount--,this.root.remove(e)}traverse(e){this.root.traverse(e)}raycast(e,t){const i=[];return this.root.raycast(e,t,i),i}}class SnapLine3 extends n.Line3{constructor(e,t,i,n){super(e,t),this.start=e,this.end=t,this.floorId=i,this.roomId=n,this.isSnapLine3=!0}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this.roomId=e.roomId,this.floorId=e.floorId,this}clone(){return new SnapLine3(this.start,this.end,this.floorId,this.roomId)}}class SnapVector3 extends n.Vector3{constructor(e,t,i){super(),this.point=e,this.floorId=t,this.roomId=i,this.isSnapVector3=!0,super.copy(e)}copy(e){return this.point.copy(e.point),this.roomId=e.roomId,this.floorId=e.floorId,this}clone(){return new SnapVector3(this.point,this.floorId,this.roomId)}}},96041:(e,t,i)=>{"use strict";i.d(t,{H:()=>Lock});class Lock{constructor(){this.activePromise=Promise.resolve(new Key)}async lock(){const e=new Promise((async e=>{(await this.activePromise).onUnlock((()=>e(new Key)))})),t=this.activePromise;return this.activePromise=e,t}}class Key{onUnlock(e){this.unlockCB=e}unlock(){this.unlockCB()}}},91055:(e,t,i)=>{"use strict";i.d(t,{Pp:()=>l,s1:()=>c,r0:()=>h,m$:()=>d,D7:()=>u,Ll:()=>p,n0:()=>m,fd:()=>g,Fe:()=>f,YN:()=>v,k2:()=>y,mY:()=>b,_U:()=>w,S3:()=>S,J2:()=>E});var n=i(2212),s=i(56040),o=i(27829),r=i(76807),a=i(45805);const l=e=>!!e&&1===e.elements[15],c=e=>!!e&&(e.elements[15]>0&&e.elements[15]<1),h=((()=>{const e=new n.Object3D,t=new n.Vector3})(),(()=>{const e=new n.Vector3;return(t,i,n,s)=>(e.copy(t).sub(i),e.clampLength(n,s),i.clone().add(e))})()),d=(()=>{const e=new n.Vector3;return(t,i,n,s)=>{e.copy(i).sub(t);const o=Math.atan2(Math.sqrt(Math.pow(e.x,2)+Math.pow(e.z,2)),e.y),r=Math.min(Math.max(n,o),s);return Math.abs(o-r)>Number.EPSILON?u(t,i,o-r,!1):t}})(),u=(()=>{const e=new n.Vector3,t=new n.Vector3;return(i,n,s,r)=>(e.copy(n).sub(i),r?t.copy(o.f.UP):t.copy(e).applyAxisAngle(o.f.UP,-1*Math.PI/2).setY(0).normalize(),e.applyAxisAngle(t,s),n.clone().sub(e))})(),p=(()=>{const e=new n.Vector3,t=new n.Vector3;return(i,s,o)=>(e.copy(i).sub(s).normalize(),t.copy(i).sub(o).normalize(),(new n.Quaternion).setFromUnitVectors(e,t))})(),m=(()=>{const e=new s.M;return(t,i)=>(e.setPosition(t),e.lookAt(t,i,o.f.UP),(new n.Quaternion).setFromRotationMatrix(e.asThreeMatrix4()))})(),g=(()=>{const e=new n.Vector3;return(t,i,n)=>(e.copy(o.f.FORWARD).applyQuaternion(t).normalize(),e.clone().multiplyScalar(-1*n).add(i))})(),f=(()=>{const e=new n.Ray,t=new n.Vector3,i=new n.Vector3;return(n,s,r)=>(i.set(0,0,0),t.copy(o.f.FORWARD).applyQuaternion(s),e.set(n,t),e.intersectPlane(r,i))})(),v=(()=>{const e=new n.Vector3,t=new n.Vector3,i=new n.Vector3,s=new n.Vector3,r=[new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3],a=new n.Vector3,l=new n.Vector3,c=new n.Vector3,h=new n.Vector3,d=new n.Plane,u=new n.Vector3,p=new n.Ray,g=new n.Vector3,f=new n.Vector3;return(n,v,y,b,w,S)=>{e.copy(o.f.FORWARD).applyQuaternion(v).setY(0),t.copy(e).setY(y).normalize(),s.copy(t).applyAxisAngle(o.f.UP,-Math.PI/2).setY(0).normalize(),i.copy(s).cross(t).normalize();let E=0;const T=b.max,M=b.min,_=[T,M];for(let e=0;e<2;e++){const t=_[e].x;for(let e=0;e<2;e++){const i=_[e].y;for(let e=0;e<2;e++){const n=_[e].z;r[E].set(t,i,n),E++}}}a.copy(M),c.copy(n).setY(M.y);let x=l.copy(a).sub(c).dot(t);r.forEach((e=>{if(e.y===T.y)return;const i=l.copy(e).sub(c).dot(t);i<x&&(a.copy(e),x=i)}));const A=Math.sign(a.dot(s));h.copy(a).setX(a.x===T.x?M.x:T.x),Math.sign(h.dot(s))!==A?d.set(u.set(0,0,-1*Math.sign(a.z)),Math.abs(a.z)):(h.copy(a).setZ(a.z===T.z?M.z:T.z),d.set(u.set(-1*Math.sign(a.x),0,0),Math.abs(a.x))),p.set(n,g.copy(t).multiplyScalar(-1)),p.intersectPlane(d,f);const O=Math.min(Math.abs(f&&f.dot(t)),x);let P=0,C=0;r.forEach((function(e){l.copy(e).sub(n);const t=Math.abs(l.dot(s)),o=Math.abs(l.dot(i));t>P&&(P=t),o>C&&(C=o)}));const D=P/Math.tan(w*S/2),I=C/Math.tan(w/2),R=Math.max(D,I)+Math.abs(O),L=n.clone().add(t.clone().multiplyScalar(1.1*-R));return{position:L,rotation:m(L,n)}}})(),y=((()=>{const e=new n.Matrix4})(),(()=>{const e=new n.Matrix4,t=new n.Vector4})(),(()=>{const e=new n.Vector3;return(t,i,n=o.f.UP)=>{const s=t.angleTo(i);return Math.sign(e.crossVectors(t,i).dot(n))*s}})()),b=((()=>{const e=new s.M,t=new n.Vector3})(),(e,t,i,n,s=1.5)=>{const o=1/e.elements[5];if(l(e))return s*n/(2*o);const r=t.distanceTo(i),a=Math.atan(o);return n*(s/(2*Math.tan(a)*r))}),w=function(){const e=new n.Vector3,t=new n.Matrix4;return(i,n,s)=>{const o=e.set(0,0,-i).applyMatrix4(n).z;return t.copy(n),t.invert(),e.set(2/s,0,o).applyMatrix4(t),e.x}}(),S=e=>1/e.elements[5],E=(()=>{const e=new n.Vector3;return(t,i,n)=>{const s=n.angleTo(o.f.UP),r=Math.abs(s-Math.PI);return s<.2||r<.2?(t.quaternion.setFromUnitVectors(o.f.FORWARD,n),!0):(t.lookAt(e.copy(i).add(n)),!1)}})();(()=>{const e=new n.Vector3,t=new n.Vector3(1e4,1e4,1e4),i=[new n.Line3,new n.Line3,new n.Line3,new n.Line3],s=[new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3]})()},60982:(e,t,i)=>{"use strict";i.d(t,{mB:()=>n,uU:()=>s});i(2212);const n=e=>!e||!Object.values(e).filter((e=>0!==e)).length,s=e=>(e=>"object"==typeof e&&"x"in e&&"y"in e)(e)&&"z"in e},67126:(e,t,i)=>{"use strict";i.d(t,{uZ:()=>n});const n=function(e,t,i){return Math.max(t,Math.min(e,i))}},76807:(e,t,i)=>{"use strict";i.d(t,{r6:()=>n});const n=(e,t,i=1e-5)=>Math.abs(e-t)<=i},97620:(e,t,i)=>{"use strict";i.d(t,{Ue:()=>c,MN:()=>h,ep:()=>d,gj:()=>u,EV:()=>p,tf:()=>m,zW:()=>g,cb:()=>f,rj:()=>v,jB:()=>y,et:()=>b,dS:()=>w,Z:()=>E,Rq:()=>T,Xe:()=>M,Xv:()=>_});var n=i(2212),s=i(56040),o=i(27829),r=i(67126);const a=new n.Frustum,l=new s.M,c=(new n.Sphere,Math.PI/180),h=180/Math.PI;var d;!function(e){e.fromVisionVector=function(e){return new n.Vector3(e.x,e.z,-e.y)},e.toVisionVector=function(e){return new n.Vector3(e.x,-e.z,e.y)},e.fromVisionQuaternion=function(e){return new n.Quaternion(e.x,e.z,-e.y,e.w).multiply((new n.Quaternion).setFromAxisAngle(new n.Vector3(0,1,0),n.MathUtils.degToRad(90)))},e.fromVisionCameraQuaternion=function(e){return new n.Quaternion(-e.x,-e.z,e.y,-e.w).multiply((new n.Quaternion).setFromAxisAngle(new n.Vector3(1,0,0),n.MathUtils.degToRad(90)))},e.toVisionQuaternion=function(e){const t=new n.Quaternion(e.x,e.y,e.z,e.w).multiply((new n.Quaternion).setFromAxisAngle(new n.Vector3(0,1,0),n.MathUtils.degToRad(-90)));return t.set(t.x,-t.z,t.y,t.w),t},e.toVisionCameraQuaternion=function(e){return new n.Quaternion(e.x,-e.z,e.y,e.w).multiply(new n.Quaternion(-.70710678118,0,0,.70710678118))}}(d||(d={}));const u=function(e){return new n.Vector3(-e.x,e.y,e.z)},p=function(e){return new n.Quaternion(e.z,e.w,e.x,e.y)},m=function(e){return Math.cos(n.MathUtils.degToRad(e/2))},g=function(e,t){const i=new n.Vector3(0,0,-1);return i.clone().applyQuaternion(e).angleTo(i.clone().applyQuaternion(t))},f=(e,t,i,n)=>(l.identity().makeRotationFromQuaternion(t).setPosition(e),l.getInverse(l),l.premultiply(i),a.setFromProjectionMatrix(l.asThreeMatrix4()),a.intersectsBox(n)),v=e=>{const t=e.getSize(new n.Vector3),i=Math.max(t.x,t.y,t.z);return(new n.Box3).setFromCenterAndSize(e.getCenter(new n.Vector3),new n.Vector3(i,i,i))},y=(e,t)=>{if(t.length<8)throw new Error("getPointsFromBox3: Result array to small!");t[0].copy(e.min),t[1].copy(e.min),t[1].x=e.max.x,t[2].copy(e.min),t[2].y=e.max.y,t[3].copy(e.min),t[3].z=e.max.z,t[4].copy(e.max),t[5].copy(e.max),t[5].x=e.min.x,t[6].copy(e.max),t[6].y=e.min.y,t[7].copy(e.max),t[7].z=e.min.z},b=(e,t,i,n,s)=>(s-n)*((e-t)/(i-t))+n,w=(e,t,i,n,s)=>{const o=b(e,t,i,n,s);return(0,r.uZ)(o,n,s)};function S(e){return 0===e.x&&0===e.y&&0===e.z}const E=(()=>{const e=new n.Vector3,t=new n.Matrix4;return i=>S(i)?i.clone():(e.copy(o.f.FORWARD).applyQuaternion(i),t.lookAt(o.f.ZERO,e,o.f.UP),(new n.Quaternion).setFromRotationMatrix(t))})(),T=(()=>{const e=new n.Vector3,t=new n.Matrix4;return(i,n)=>S(i)?n.copy(i):(e.copy(o.f.FORWARD).applyQuaternion(i).setY(0).normalize(),t.lookAt(o.f.ZERO,e,o.f.UP),n.setFromRotationMatrix(t))})(),M=(()=>{const e=new n.Vector3,t=new n.Ray;return(i,s,o,r)=>(r=r||new n.Vector3,t.origin.copy(i),t.lookAt(s),r.copy(t.at(o,e)))})(),_=(()=>{const e=new n.Vector3,t=new n.Ray;return(i,s,o,r)=>(r=r||new n.Vector3,t.set(i,s),r.copy(t.at(o,e)))})()},99774:(e,t,i)=>{"use strict";i.d(t,{L:()=>ObjectPool});class ObjectPool{constructor(e){this.comparer=e||this.defaultComparer,this.poolArray=[]}add(e){const t=this.createObjectDescriptor(e);return t.object=e,t.inUse=!0,this.addObjectDescriptorToPool(t),t}get(e){for(const t of this.poolArray)if(!t.inUse&&this.comparer(t,e))return t.inUse=!0,t;return null}free(e){for(const t of this.poolArray)if(t.object===e)return t.inUse=!1,!0;return!1}all(){return this.poolArray}remove(e){const t=this.poolArray.findIndex((t=>t.object===e));return-1!==t&&(this.poolArray.splice(t,1),!0)}defaultComparer(e,t){return!0}createObjectDescriptor(e){return{object:e,inUse:!1}}addObjectDescriptorToPool(e){this.poolArray.push(e)}}},44266:(e,t,i)=>{"use strict";i.d(t,{Q:()=>OpenDeferred});class OpenDeferred{constructor(){this.base=new Promise(((e,t)=>{this.resolver=e,this.rejecter=t})),this._promise=new OpenPromise(this.base,this),this.progressCallbacks=[]}then(e,t){return this.base.then(e,t)}catch(e){return this.base.catch(e)}resolve(e){return this.resolver(e),this}reject(e){return this.rejecter(e),this}notify(e){for(const t of this.progressCallbacks)t(e)}progress(e){return this.progressCallbacks.push(e),this}promise(){return this._promise}nativePromise(){return this.base}static resolve(){const e=new OpenDeferred;return e.resolve(),e.promise()}static reject(e){const t=new OpenDeferred;return t.reject(e),t.promise()}static all(e){const t=[];for(const i of e)i.nativePromise?t.push(i.nativePromise()):t.push(i);const i=new OpenDeferred;return Promise.all(t).then((e=>i.resolve(e)),(e=>i.reject(e))),i.promise()}}class OpenPromise{constructor(e,t){this.basePromise=e,this.baseDeferred=t}then(e,t){return this.baseDeferred.then(e,t),this}catch(e){return this.baseDeferred.catch(e),this}progress(e){return this.baseDeferred.progress(e),this}nativePromise(){return this.basePromise}}},86515:(e,t,i)=>{"use strict";i.d(t,{Z:()=>OrderedMap});const n=e=>""+e;class OrderedMap{constructor(e=n){this.mappingFunction=e,this.list=[],this.map={}}add(e){const t=this.mappingFunction(e);return!this.map[t]&&(this.list.push(e),this.map[t]=e,!0)}set(e){const t=this.mappingFunction(e);return this.map[t]?(this.map[t]=e,!0):(this.add(e),!0)}count(){return this.list.length}*[Symbol.iterator](){for(const e of this.list)yield e}getByIndex(e){return this.list[e]}get(e){return this.map[e]}copyToList(e){return e.push.apply(e,this.list),e}clear(){this.list=[],this.map={}}mapElements(e){return this.list.map(e)}}},67569:(e,t,i)=>{"use strict";i.d(t,{a:()=>PersistentStorage});class VariableContainer{constructor(e){this._value=e}value(){return this._value}set(e){this._value=e}}class PersistentStorage{constructor(){this.storage={}}get(e,t){let i=this.storage[e];return i||(i=t(),this.storage[e]=i),i}getNumber(e){return this.get(e,(()=>new VariableContainer(0)))}getString(e){return this.get(e,(()=>new VariableContainer("")))}getArray(e){return this.get(e,(()=>[]))}getNumberMap(e){return this.get(e,(()=>({})))}getStringMap(e){return this.get(e,(()=>({})))}}},40032:(e,t,i)=>{"use strict";i.d(t,{m:()=>s,J5:()=>o,Ex:()=>r});var n=i(62367);function s(e){return{x:e.x,y:e.y,z:e.z}}function o(e){return{x:e.x||e._x,y:e.y||e._y,z:e.z||e._z,w:e.w||e._w}}function r(e){return`#${(0,n.Q_)(255*e.r,2,"0",16)}${(0,n.Q_)(255*e.g,2,"0",16)}${(0,n.Q_)(255*e.b,2,"0",16)}`}},83974:(e,t,i)=>{"use strict";i.d(t,{E:()=>TypedMesh});var n=i(2212);class TypedMesh extends n.Mesh{constructor(e,t){super(e,t)}}},290:(e,t,i)=>{"use strict";i.d(t,{z:()=>AnimatedNumber});var n=i(1799),s=i(78909);const o=new(i(25799).Z)("animation");class AnimatedNumber extends s.T{constructor(e,t,i,s=n.vG,o=0){super(),this._easing=n.vG,void 0===t&&(t=e),void 0===i&&(this._active=!1,i=0,this._elapsed=0,this._duration=0),this.modifyAnimation(e,t,i,s,0,o)}get active(){return this._active}get duration(){return this._duration}get endValue(){return this._endValue}get easing(){return this._easing}get elapsed(){return this._elapsed}tick(e){if(!this._active)return this.endValue;if(this._delay>0)return this._delay-=e,this.startValue;const t=(this._elapsed+e)/Math.max(this._duration,1e-5);return this.updateProgress(t),this.value}updateProgress(e){if(isNaN(e))return void o.error(`Invalid progress value: ${e}`);const t=Math.max(0,Math.min(e,1)),i=this.active,n=this.value;if(t>=1)return this.activate(!1),this.value=this.endValue,this._elapsed=this.duration,this.commit(),void(this._onComplete&&this._onComplete());this.activate(!0),this.value=this._easing(t,this.startValue,this._endValue-this.startValue,1),this._elapsed=t*this.duration,n===this.value&&i===this.active||this.commit()}updateAbsolute(e){const t=e/Math.max(this._duration,1e-5);this.updateProgress(t)}modifyAnimation(e,t,i,s=n.vG,o=0,r=0){return this._easing=s,this._endValue=t,this._duration=i,this.activate(this._duration>=0&&e!==t),this._elapsed=o,this._delay=r,this.startValue=e,this.value=e,this.commit(),this}onComplete(e){return this._onComplete=e,this}activate(e){this._active=e}copy(e){this._endValue=e.endValue,this._duration=e.duration,this._active=e.active,this._easing=e.easing,this._elapsed=e.elapsed,this.startValue=e.startValue,this.value=e.value,this.commit()}clone(){const e=new AnimatedNumber(0);return e.copy(this),e}stop(e){this._active=!1,this._elapsed=this._duration,this.value=e,this._endValue=e,this.commit()}equals(e){return this._active===e._active&&this.duration===e.duration&&this.easing===e.easing&&this.elapsed===e.elapsed&&this.endValue===e.endValue&&this.startValue===e.startValue&&this.value===e.value}}},21307:(e,t,i)=>{"use strict";i.d(t,{b:()=>n});const n=(e,t)=>{if(0!==e.length)for(let i=0;i<e.length;i++){e[i]===t&&e.splice(i,1)}}},21746:(e,t,i)=>{"use strict";i.d(t,{g$:()=>n,LP:()=>s,yB:()=>o});const n=16/9,s=1/n,o=function(e,t){return Math.min(Math.max(t/e,s),1)*e}},21265:(e,t,i)=>{"use strict";i.d(t,{dy:()=>s,tq:()=>o,_1:()=>r,s:()=>a,V5:()=>l,Kr:()=>c,w1:()=>h,Dt:()=>d,Ot:()=>u,Jm:()=>p,J1:()=>m,yL:()=>g,hu:()=>f,$K:()=>v,fp:()=>y,m8:()=>b,AO:()=>w,UD:()=>S,Vf:()=>E,Hx:()=>T,mI:()=>M,rm:()=>_,O6:()=>x,Zx:()=>A,Qg:()=>O,PI:()=>P,ht:()=>C});const n=new(i(25799).Z)("util-browser"),s=()=>{const e=window.innerWidth/window.innerHeight;return isFinite(e)?e:1},o=function(){const e=navigator.userAgent||navigator.vendor,t=new RegExp("(android|bbd+|meego).+mobile|android|avantgo|bada/|blackberry|blazer|compal|elaine|fennec|\n    hiptop|iemobile|ip(hone|od|ad)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|\n    palm( os)?|phone|p(ixi|re)/|plucker|pocket|psp|series(4|6)0|symbian|treo|up.(browser|link)|vodafone|\n    wap|windows ce|xda|xiino","i"),i=new RegExp("1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|\n    amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|\n    br(e|v)w|bumb|bw-(n|u)|c55/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|\n    devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|\n    g560|gene|gf-5|g-mo|go(.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|\n    a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|\n    jemu|jigs|kddi|keji|kgt( |/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|/(k|l|u)|50|54|-[a-w])|libw|lynx|\n    m1-w|m3ga|m50/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|\n    zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|\n    nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|\n    po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55/|\n    sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|\n    sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|\n    tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|\n    vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|\n    zeto|zte-","i");return(t.test(e)||i.test(e.substr(0,4))||r())&&!u()},r=()=>{const e=window.navigator.userAgent;return/iPad/.test(e)||l()&&navigator.maxTouchPoints>1},a=()=>{const e=window.navigator.userAgent;return/iPod|iPhone|iPad/.test(e)},l=()=>{const e=window.navigator.platform;return/MAC/.test(e.toUpperCase())},c=()=>{const e=window.navigator.platform;return/WIN/.test(e.toUpperCase())},h=()=>{const e=window.navigator.userAgent;return/Trident\//.test(e)},d=()=>-1!==window.navigator.userAgent.indexOf("Android"),u=()=>-1!==window.navigator.userAgent.indexOf("OculusBrowser"),p=()=>"ontouchstart"in window,m=()=>"share"in navigator&&(o()||r()),g=()=>window.parent!==window,f=function(e,t){const i=new RegExp("[#&?]"+e+"=([^#&?]*)").exec(window.location.href);if(!i)return t;const n=i[1];return"boolean"==typeof t?"true"===n||"1"===n:"number"==typeof t?parseFloat(n):decodeURIComponent(n)},v=function(e,t){const i=new RegExp(e+"=([^;]+)|$").exec(document.cookie);if(!i)return t;const n=i[1];return"boolean"==typeof t?"true"===n||"1"===n:"number"==typeof t?parseFloat(n):n},y=function(e,t){if(!("localStorage"in window))return t;let i;try{i=window.localStorage.getItem(e)}catch(e){return n.debug(e),t}return null===i?t:"boolean"==typeof t?"true"===i:"number"==typeof t?parseFloat(i):i},b=function(e,t){try{window.localStorage.setItem(e,t)}catch(e){n.error(e)}},w=e=>{const t=/[#&?]([^=]+)=([^#&?]+)/g;e=e||window.location.href;const i={};let n;for(;null!==(n=t.exec(e));)i[n[1]]=decodeURIComponent(n[2]);return i},S=()=>window.location.search.substr(1).split("&"),E=(e,t=!1)=>{const i=Object.keys(e).map((t=>t+"="+e[t])).join("&"),n=`${window.location.origin}${window.location.pathname}?${i}`;t?window.history.pushState({},"",n):window.location.replace(n)},T=function(){const e=window.URL||window.webkitURL,t=document.createElement("a");return document.body.appendChild(t),t.style.display="none",(i,n)=>{const s=e.createObjectURL(i);t.href=s,t.download=n,t.click(),e.revokeObjectURL(s)}}(),M=()=>s()>1,_=function(){return!!(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement)},x=function(){return!o()&&!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled||document.msFullscreenEnabled)},A=function(e){e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()},O=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()};function P(e){try{return document.featurePolicy.allowsFeature(e)}catch(t){return n.warn(t),n.warn(`Feature Policy check failed, defaulting ${e} to false.`),!1}}const C=()=>(e=>{const t={language:"en",region:void 0,script:void 0,ext:void 0},i=new RegExp([/^([a-z]{2,3})/,/(?:[_-]([ut]{1}[_-][a-z\-\_]+))?/,/(?:[_-]([a-z]{4}))?/,/(?:[_-]([a-z]{2}))?$/].map((e=>e.source)).join(""),"i").exec(e);if(i){const[,e,n,s,o]=i;Object.assign(t,{language:e,ext:n,script:s,region:o})}return t})(navigator.language).language},69281:(e,t,i)=>{"use strict";i.d(t,{G1:()=>r,rn:()=>a,D5:()=>l,Ex:()=>c});var n=i(2212),s=i(62367);const o=()=>Math.random(),r=(e=.25)=>new n.Vector4(o(),o(),o(),e),a=()=>new n.Color(o(),o(),o()),l=e=>"object"==typeof e&&"r"in e&&"g"in e&&"b"in e;function c(e){return`#${(0,s.Q_)(255*e.r,2,"0",16)}${(0,s.Q_)(255*e.g,2,"0",16)}${(0,s.Q_)(255*e.b,2,"0",16)}`}},32020:(e,t,i)=>{"use strict";i.d(t,{U:()=>s,p:()=>o});const n=new Object,s=e=>{if(e){const t=e.valueOf();if(!isNaN(t))return e.toISOString()}return(new Date).toISOString()},o=(e,t=n)=>{if(e){const t=new Date(e);if(!isNaN(t.valueOf()))return t}return t===n?new Date:t}},39990:(e,t,i)=>{"use strict";i.d(t,{D:()=>n});const n=(e,t=250)=>{let i;return(...n)=>{clearTimeout(i),i=window.setTimeout((()=>e.apply(null,n)),t)}}},90709:(e,t,i)=>{"use strict";i.d(t,{_F:()=>s,zy:()=>o,XJ:()=>r});const n=.3048,s=e=>e*n,o=e=>e/n,r=e=>{const t=e/n;let i=Math.floor(t),s=12*t%12;return 12===Math.round(s)?(i+=1,s=0):s=Math.round(s),{feet:i,inches:s}}},1799:(e,t,i)=>{"use strict";i.d(t,{vG:()=>o,FG:()=>r,hl:()=>a,to:()=>l,Q9:()=>c,w2:()=>h,qb:()=>d,Fs:()=>u,e3:()=>p,tf:()=>m});var n=i(69436),s=i.n(n);const o=function(e,t,i,n){return i*e/n+t},r=function(e,t,i,n){return i*(e/=n)*e+t},a=function(e,t,i,n){return-i*(e/=n)*(e-2)+t},l=function(e,t,i,n){return(e/=n/2)<1?i/2*e*e+t:-i/2*(--e*(e-2)-1)+t},c=function(e,t,i,n){return i*(e/=n)*e*e+t},h=function(e,t,i,n){return e/=n,i*(--e*e*e+1)+t},d=function(e,t,i,n){return(e/=n/2)<1?i/2*e*e*e+t:i/2*((e-=2)*e*e+2)+t},u=function(e,t,i,n){return-i/2*(Math.cos(Math.PI*e/n)-1)+t},p=(e,t,i,n,s)=>{let o=t;if(s>0){const t=(1-Math.max(s,0))*Math.abs(n);o=i<=t?0:e(i-t,0,1,t)}return o};function m(e,t,i,n){const o=new(s())(e,t,i,n);return(e,t,i,n)=>{const s=e/n;return t+i*o.solve(s)}}},3159:(e,t,i)=>{"use strict";i.d(t,{bX:()=>n,z6:()=>s});const n=e=>void 0!==e.pointerId,s=e=>void 0!==e.changedTouches},46266:(e,t,i)=>{"use strict";i.d(t,{q:()=>o,A:()=>l});var n=i(2212),s=i(27829);function o(e){if(0===e.length)throw Error("Can't merge empty list of geometries");if(1===e.length)return e[0];let t=0,i=0,s=0,o=0;const a=new n.Box3;for(const n of e)n.index&&(t+=n.index.count,i+=n.getAttribute("position").count,n.getAttribute("uv")&&(s+=n.getAttribute("uv").count),n.boundingBox&&(a.union(n.boundingBox),o++));const c=new n.BufferGeometry;o!==e.length||a.isEmpty()?c.computeBoundingBox():c.boundingBox=a,a.copy(l(c)),c.boundingSphere=a.getBoundingSphere(new n.Sphere);const h=r(new Float32Array(3*i),"position",e);c.setAttribute("position",new n.BufferAttribute(h,3));const d=function(e,t){let i=0,n=0;for(const s of t){const t=s.index;for(let s=0;s<t.array.length;s++)e[i+s]=t.array[s]+n;i+=t.array.length,n+=s.getAttribute("position").count}return e}(new Uint32Array(t),e);if(c.setIndex(new n.BufferAttribute(d,1)),s){const t=r(new Float32Array(2*s),"uv",e);c.setAttribute("uv",new n.BufferAttribute(t,2))}return c}function r(e,t,i){let n=0;for(const s of i){const i=s.getAttribute(t);e.set(i.array,n),n+=i.array.length}return e}const a=new n.Box3(s.f.ZERO,s.f.UNIT);function l(e){return e.boundingBox||e.computeBoundingBox(),e.boundingBox||a}},62367:(e,t,i)=>{"use strict";i.d(t,{DM:()=>o,gw:()=>r,Ig:()=>a,XN:()=>l,VS:()=>c,Yv:()=>h,TH:()=>d,Jq:()=>u,Pe:()=>p,DZ:()=>m,Q_:()=>g,O1:()=>f,$B:()=>v,ow:()=>y,nr:()=>b,lY:()=>w});i(2212);var n=i(31260);const s=[];for(let e=0;e<256;e++)s[e]=(e<16?"0":"")+e.toString(16);function o(){let e;const t=window.crypto||window.msCrypto;return e=t?t.getRandomValues(new Uint8Array(16)):new Uint8Array(16).map((()=>255*Math.random())),e[6]=15&e[6]|64,e[8]=63&e[8]|128,s[e[0]]+s[e[1]]+s[e[2]]+s[e[3]]+"-"+s[e[4]]+s[e[5]]+"-"+s[e[6]]+s[e[7]]+"-"+s[e[8]]+s[e[9]]+"-"+s[e[10]]+s[e[11]]+s[e[12]]+s[e[13]]+s[e[14]]+s[e[15]]}const r=function(e){return new Promise(((t,i)=>{setTimeout(t,e)}))},a=e=>{let t,i=-1;return{promise:new Promise(((n,s)=>{t=n,i=window.setTimeout(n,e)})).then((()=>{i=-1})),cancel:()=>{-1!==i&&(window.clearTimeout(i),t())}}},l=function(e){const t={};for(const i of e)t[i]=i;return t},c=function(e,t){if(t.setLength(0),0===e.length)return t;let i=0;for(const n of e)t.add(n),i++;return t.divideScalar(i),t},h=function(e){return!e.replace(/\n/g,"").trim().length},d=function(e,t){if(e.size!==t.size)return!1;for(const i of e)if(!t.has(i))return!1;return!0},u=function(e,t){const i=Math.min(e.length,t.length);for(let n=0;n<i;n++)if(e[n]!==t[n])return!1;return!0},p=function(e,t,i=!0){if(0===e.length)return null;i&&e.sort((function(e,t){return e-t}));const n=t/100;return e[Math.floor(e.length*n)]},m=function(e){return[g(e.getMonth()+1),".",g(e.getDate()),".",e.getFullYear(),"_",g(e.getHours()),".",g(e.getMinutes()),".",g(e.getSeconds())].join("")},g=function(e,t=2,i="0",n=10){const s=e.toString(n),o=t-s.length+1;return o>0?new Array(o).join(i)+s:s},f=function(e){let t="";const i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let n=0;n<e;n++)t+=i.charAt(Math.floor(Math.random()*i.length));return t},v=e=>{const t=[];for(let i=0;i<e.length;i+=8192)t.push(String.fromCharCode.apply(null,e.subarray(i,i+8192)));return btoa(t.join(""))},y=(e=[])=>{const t={};for(const i of e)t[i]=!0;return t};function b(e,t){return e.hasOwnProperty(t)}const w=(e,t,i)=>{if(!(Math.abs(e)<4294967295)||!(t<32)||!(i<32))throw new n.Z("argument out of range");const s=1&(e>>>t^e>>>i);return(e^=s<<t|s<<i)>>>0};(()=>{const e={}})()},35175:(e,t,i)=>{"use strict";i.d(t,{h:()=>s});const n=new(i(25799).Z)("passive-support"),s=(()=>{let e=!1;try{const t=Object.defineProperty({},"passive",{get:()=>{e=!0}});return window.addEventListener("testPassive",(()=>{}),t),window.removeEventListener("testPassive",(()=>{}),t),e}catch(e){return n.warn(`Passive Option for addEventListener is not supported, Safari zoom may not perform as expected: ${e}`),!1}})()},25799:(e,t,i)=>{"use strict";i.d(t,{Z:()=>Logger});const n=window.navigationStart||Date.now();var s;!function(e){e[e.ERROR=0]="ERROR",e[e.WARN=1]="WARN",e[e.INFO=2]="INFO",e[e.DEBUG=3]="DEBUG"}(s||(s={}));class Logger{constructor(e){this.timers={},this.handlers={[s.DEBUG]:console.debug,[s.INFO]:console.info,[s.WARN]:console.warn,[s.ERROR]:console.error};const t=e.split(new RegExp("/|\\\\"));this.prefix="["+t[t.length-1].replace(".js","")+"]"}message(e){if(Logger.level>=e&&console){return(this.handlers[e]?this.handlers[e]:console.log).bind(console,this.getPrefix())}return()=>{}}get debug(){return this.message(s.DEBUG)}get debugWarn(){return this.message(Logger.level>=s.DEBUG?s.WARN:s.DEBUG)}get info(){return this.message(s.INFO)}get warn(){return this.message(s.WARN)}get error(){return this.message(s.ERROR)}time(e){Logger.level>=s.DEBUG&&(this.timers[e]=Date.now())}timeEnd(e){if(Logger.level>=s.DEBUG){const t=this.timers[e];if(!t)return;const i=(Date.now()-t)/1e3;this.debug(e,i+"s")}}getPrefix(){const e=(Date.now()-n)/1e3+"s";return`${this.prefix} ${e}`}}Logger.level=s.INFO},31017:(e,t,i)=>{"use strict";i.d(t,{M:()=>MeshesUtility});var n=i(27829),s=i(2212);class ThreeMesh{constructor(e,t,i){return this.thisType=e,this.container=t,this.mesh=i(),this.mesh.name=`${e.name}`,this.material=this.mesh.material,this.geometry=this.mesh.geometry,this}opacity(e){return this.material.opacity=e,this}}function o(e,t){t.forEach((t=>{Object.getOwnPropertyNames(t.prototype).forEach((i=>{e.prototype[i]=t.prototype[i]}))}))}class AnimatedMeshMixin{constructor(){this.animationInit=!1}initAnimationMixin(e,t){this.animState={scale:t?t.clone():new s.Vector3(1,1,1),position:e?e.clone():new s.Vector3,target:{scale:t?t.clone():new s.Vector3(1,1,1),position:e?e.clone():new s.Vector3},temp:{pos:new s.Vector3,scale:new s.Vector3,makeScale:new s.Vector3}},this.animationInit=!0}update(e,t){if(!this.animationInit)throw Error(`${AnimatedMeshMixin.name} call this.initAnimationMixin() in ${this.style} constructor to enable update, because I said so.`);this.mesh.position.copy(e);const i=this.vector3From(t);return i.equals(this.mesh.scale)||this.mesh.scale.copy(i),this.animState.scale.copy(this.mesh.scale),this.animState.position.copy(this.mesh.position),this.mesh.updateMatrixWorld(!0),this}animate(e,t,i){if(!this.animationInit)throw Error(`${AnimatedMeshMixin.name} call this.initAnimationMixin() in ${this.style} constructor to enable animations, because I said so.`);const n=this.vector3From(i);this.animState.target.scale.copy(n),this.animState.target.position.copy(t);const s=this.animState.temp.pos.copy(this.mesh.position).lerp(t,e),o=this.animState.temp.scale.copy(this.mesh.scale).lerp(n,e);return this.update(s,o),this}vector3From(e){if(e instanceof s.Vector3)return this.animState.temp.makeScale.copy(e).clamp(a,l);if("number"==typeof e)return this.animState.temp.makeScale.set(e,e,e).clamp(a,l);throw Error("Unexpected scale input")}}const r=.01,a=new s.Vector3(r,r,r),l=new s.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);class ToggleAddRemoveMixin{toggle(e){return e?this.container.add(this.mesh):this.container.remove(this.mesh),this.isVisible=e,this}}class BoxMesh extends ThreeMesh{constructor(e,t){super(BoxMesh,e,(()=>new s.Mesh(new s.BoxGeometry(1,1,1),new s.MeshBasicMaterial(t)))),this.container=e,this.style="Box",this.mesh.frustumCulled=!1,this.geometry.computeBoundingBox(),this.initAnimationMixin()}}o(BoxMesh,[AnimatedMeshMixin,ToggleAddRemoveMixin]);class BoxWireframeMesh extends ThreeMesh{constructor(e,t){super(BoxWireframeMesh,e,(()=>{const e=new s.Box3Helper((new s.Box3).setFromCenterAndSize(new s.Vector3,new s.Vector3(1,1,1)));return new s.LineSegments(e.geometry,e.material)})),this.container=e,this.style="BoxWireframeMesh",t&&this.material.setValues(t),this.mesh.frustumCulled=!1,this.initAnimationMixin()}}o(BoxWireframeMesh,[ToggleAddRemoveMixin,AnimatedMeshMixin]);class CameraHelperMesh extends ThreeMesh{constructor(e,t){super(CameraHelperMesh,e,(()=>new s.CameraHelper(t))),this.container=e,this.style="CameraHelper",this.updateCamera(t)}updateCamera(e){return this.mesh.camera.copy(this.camWithSaneFarDistance(e)),this.mesh.update(),this}camWithSaneFarDistance(e){const t=e.clone();return t.far=5,t}}o(CameraHelperMesh,[ToggleAddRemoveMixin]);class PlaneMesh extends ThreeMesh{constructor(e,t){super(PlaneMesh,e,(()=>new s.Mesh(new s.PlaneGeometry(1),new s.MeshBasicMaterial(t)))),this.container=e,this.style="PlaneMesh",this.radius=1;const i=new s.Matrix4;i.makeRotationFromEuler(new s.Euler(-Math.PI/2,0,0,"XYZ")),this.geometry.applyMatrix4(i),this.mesh.frustumCulled=!1,this.initAnimationMixin()}}o(PlaneMesh,[ToggleAddRemoveMixin,AnimatedMeshMixin]);class SphereMesh extends ThreeMesh{constructor(e,t){super(SphereMesh,e,(()=>new s.Mesh(new s.SphereGeometry(1),new s.MeshBasicMaterial(t)))),this.container=e,this.style="SphereMesh",this.radius=1,this.mesh.frustumCulled=!1,this.initAnimationMixin()}}o(SphereMesh,[ToggleAddRemoveMixin,AnimatedMeshMixin]);var c=i(61956);class SplineCurveMesh extends ThreeMesh{constructor(e,t){return super(SplineCurveMesh,e,(()=>new s.Line(new s.BufferGeometry,new s.LineBasicMaterial(Object.assign({color:c.I.MP_BRAND,opacity:1,transparent:!0},t))))),this.container=e,this.positionsBuffer=new s.BufferAttribute(new Float32Array(150),3),this.point=new s.Vector3,this.points={start:new s.Vector3,control:new s.Vector3,end:new s.Vector3},this.updatePoints=(e,t,i)=>{this.points.start.copy(this.curve.v0.copy(e)),this.points.control.copy(this.curve.v1.copy(t)),this.points.end.copy(this.curve.v2.copy(i));for(let e=0;e<50;e++){const t=e/49;this.curve.getPoint(t,this.point),this.positionsBuffer.setXYZ(e,this.point.x,this.point.y,this.point.z)}return this.positionsBuffer.needsUpdate=!0,this},this.animatePoints=(e,t,i,n)=>{const{start:s,control:o,end:r}=this.points;return s.equals(o)&&s.equals(r)?(this.updatePoints(t,i,n),this):(s.lerp(t,e),o.lerp(i,e),r.lerp(n,e),this.updatePoints(s,o,r),this)},this.mesh.frustumCulled=!1,this.curve=new s.QuadraticBezierCurve3(new s.Vector3,new s.Vector3,new s.Vector3),this.geometry.setAttribute("position",this.positionsBuffer),this.geometry.computeBoundingBox(),this}}o(SplineCurveMesh,[ToggleAddRemoveMixin]);var h=i(30041),d=i(50101),u=i(59120),p=i(74725);class MeshesUtility{constructor(e){this.cache={},this.helperCache={},this.toggle=e=>(this.options.scene&&(e?this.options.scene.add(this.options.container):this.options.scene.remove(this.options.container)),this),this.box=(e,t)=>(this.cache[f.box][e]||(this.cache[f.box][e]=new BoxMesh(this.options.container,t).toggle(!0)),this.cache[f.box][e]),this.boxWire=(e,t)=>(this.cache[f.boxWire][e]||(this.cache[f.boxWire][e]=new BoxWireframeMesh(this.options.container,t).toggle(!0)),this.cache[f.boxWire][e]),this.cam=(e,t)=>(this.cache[f.cameraHelper][e]||(this.cache[f.cameraHelper][e]=new CameraHelperMesh(this.options.container,t).toggle(!0)),this.cache[f.cameraHelper][e]),this.label=(e,t,i,n=.25)=>{if(!this.labelCreator){const{color:e,backgroundColor:t,backgroundOpacity:i,background:n}=this.options;this.labelCreator=new h.u({color:e,background:n,backgroundColor:t,backgroundOpacity:i})}if(!this.cache[f.label][e]){const s=this.labelCreator.createLabel();this.cache[f.label][e]=s,s.position.copy(i),s.text=t,s.scaleFactor=n,this.options.container.add(s)}return this.cache[f.label][e]},this.line=(e,t=this.options.lineColor,i=this.options.linewidth)=>{if(!this.cache[f.line][e]){const o=u.default.makeLineMaterial("string"==typeof t?new s.Color(t).getHex():t.getHex(),!1,{linewidth:i}),r={onShow:()=>this.options.container.add(...a.children),onHide:()=>this.options.container.remove(...a.children)},a=new p.c(n.f.ZERO.clone(),n.f.ZERO.clone(),o,r);a.updateResolution(window.innerWidth,window.innerHeight).opacity(1).toggle(!0),this.cache[f.line][e]=a}return this.cache[f.line][e]},this.plane=(e,t)=>(this.cache[f.plane][e]||(this.cache[f.plane][e]=new PlaneMesh(this.options.container,t).toggle(!0)),this.cache[f.plane][e]),this.sphere=(e,t)=>(this.cache[f.sphere][e]||(this.cache[f.sphere][e]=new SphereMesh(this.options.container,t).toggle(!0)),this.cache[f.sphere][e]),this.spline=(e,t)=>(this.cache[f.spline][e]||(this.cache[f.spline][e]=new SplineCurveMesh(this.options.container,t).toggle(!0)),this.cache[f.spline][e]),this.randomColor=e=>{if(void 0!==e){if(!this.helperCache[v.color][e]){const t=new s.Color(m(),m(),m());this.helperCache[v.color][e]=t}return this.helperCache[v.color][e]}return new s.Color(m(),m(),m())},this.randomVector3=e=>{if(void 0!==e){if(!this.helperCache[v.vector3][e]){const t=new s.Vector3(2*(.5-m()),2*(.5-m()),2*(.5-m()));this.helperCache[v.vector3][e]=t}return this.helperCache[v.vector3][e]}return new s.Vector3(2*(.5-m()),2*(.5-m()),2*(.5-m()))},this.toggleAll=e=>{for(const t of Object.values(f)){const i=Object.values(this.cache[t]);for(const t of i)"toggle"in t&&t.toggle(e)}return this},this.options=Object.assign(Object.assign({},g),e);for(const e of Object.values(f))this.cache[e]={};for(const e of Object.values(v))this.helperCache[e]={};this.options.scene&&this.toggle(!0)}async addToScene(e){return this.options.scene=(await e.getModule(d.default)).getScene(),this.toggle(!0),this}}const m=()=>Math.random(),g={lineColor:"white",linewidth:2,color:"white",background:!0,backgroundColor:"white",backgroundOpacity:.5,container:new s.Group};var f,v;!function(e){e.box="box",e.boxWire="boxWire",e.label="label",e.line="line",e.plane="plane",e.sphere="sphere",e.spline="spline",e.cameraHelper="cameraHelper"}(f||(f={})),function(e){e.color="color",e.vector3="vector3"}(v||(v={}))},51770:(e,t,i)=>{"use strict";function n(e={},t){return t.split(".").reduce(((e,t)=>e&&e[t]),e)}function s(e){const t={};for(const i in e)t[e[i]]=i;return t}function o(e,t){if(null!==e&&"object"==typeof e)for(const i in e)t(e[i],i,e),o(e[i],t)}i.d(t,{qw:()=>n,Sc:()=>s,yW:()=>o})},67125:(e,t,i)=>{"use strict";function n(e=11){let t="";const i="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let n=0;n<e;n++)t+=i.charAt(Math.floor(Math.random()*i.length));return t}function s(e,t){return function(e,t){return(e%t+t)%t}(function(e){let t,i=0;for(let n=0;n<e.length;n++)t=e.charCodeAt(n),i=(i<<5)-i+t,i|=0;return i}(e),t)}i.d(t,{f:()=>n,W:()=>s})},10396:(e,t,i)=>{"use strict";i.d(t,{g_:()=>s,i5:()=>o,iv:()=>c,T8:()=>u,kp:()=>g});var n=i(57501);var s,o;!function(e){e[e.RESIZE=1]="RESIZE",e[e.ORIENTATION_CHANGED=2]="ORIENTATION_CHANGED"}(s||(s={})),function(e){e[e.PORTRAIT=1]="PORTRAIT",e[e.LANDSCAPE=2]="LANDSCAPE"}(o||(o={}));let r=[],a=[];const l=window.visualViewport,c=()=>({w:l?l.width:window.innerWidth,h:l?l.height:window.innerHeight}),h=c(),d=new n.ne((()=>h),(e=>r.push(e)),(e=>{r=r.filter((t=>t!==e))})),u=()=>({orientation:window.innerWidth>window.innerHeight?o.LANDSCAPE:o.PORTRAIT});let p=u();const m=new n.ne((()=>p),(e=>a.push(e)),(e=>{a=a.filter((t=>t!==e))}));function g(e,t){switch(e){case s.RESIZE:return d.createSubscription(t);case s.ORIENTATION_CHANGED:return m.createSubscription(t)}}const f=(()=>{let e,t;return()=>{const i=c(),n=()=>{window.clearInterval(e),window.clearTimeout(t)};n();const s=()=>{h.w===i.w&&h.h===i.h||(h.w=i.w,h.h=i.h,(()=>{if(r.length>0&&r.forEach((e=>e(h))),a.length>0){const e=u();e!==p&&(p=e,a.forEach((t=>t(e))))}})())};e=window.setInterval(s,100),t=window.setTimeout(n,1e3),s()}})();l?l.addEventListener("resize",f):window.addEventListener("resize",f)},60778:(e,t,i)=>{"use strict";i.d(t,{p:()=>o});var n=i(2212);const s=new(i(25799).Z)("texture"),o=(e,t,i)=>{const o=new n.TextureLoader;return o.crossOrigin="anonymous",o.load(e,t,void 0,(t=>{s.error(`Failed to load ${e}`),i&&i(t)}))}},5368:(e,t,i)=>{"use strict";i.d(t,{P:()=>n});const n=(e,t)=>{let i,n=Date.now()-t;return(...s)=>{const o=Date.now()-n,r=()=>{e.apply(null,s),n=Date.now()};if(i&&clearTimeout(i),o>=t)r();else{const e=t-o;i=window.setTimeout(r,e)}}}},26986:(e,t,i)=>{"use strict";i.d(t,{sU:()=>o,uz:()=>r,bf:()=>a,JE:()=>c});var n=i(8575),s=i(21265);const o=function(e="",t){let i,s,o;if(e.match(/^https?/)){const t=(0,n.Qc)(e);i=t.protocol+"//"+t.host,s=e,o=e.match(/[^/]*$/)[0]}else{if(t.match(/^https?/)){const e=(0,n.Qc)(t);i=e.protocol+"//"+e.host}else i=window.location.protocol+"//"+t;s=i+"/api/player/models/"+e,o=e}return{sid:o,urlBase:i,urlModel:s,urlFiles:s+(s.match(/\/$/)?"files":"/files"),urlThumb:s+(s.match(/\/$/)?"thumb":"/thumb")}},r=function(){return(0,s.hu)("model")||(0,s.hu)("m")},a=function(e,t={}){for(const i in t){const n=t[i];e+=(-1===e.indexOf("?")?"?":"&")+`${i}=${n}`}return e},l=[/^[a-z0-9\-]+.matterport.com$/,/^localhost$/],c=e=>{let t;try{t=new URL(e)}catch(e){return null}const i=t.hostname;for(const e of l)if(i.match(e))return t.origin;return null}},25903:(e,t,i)=>{"use strict";i.d(t,{H:()=>r});var n=i(25799),s=i(21265);const o=new n.Z("vr-platform-select"),r=async()=>{try{if(await a(),!("getVRDisplays"in navigator))return null;const e=await navigator.getVRDisplays();if(e.length>0&&e[0].capabilities.canPresent)return e[0]}catch(e){o.warn("Getting VR display failed"),o.warn(e)}return null},a=(()=>{const e=(0,s.Dt)()&&!("getVRDisplays"in navigator)&&!(0,s.Ot)();let t=!1;return async()=>{if(e&&!t){const n=new((await i.e(376).then(i.t.bind(i,4260,23))).default);o.info(`Falling back to WebVR support, native:: ${n.hasNative}`,{webvrPolyfillNeeded:e,polyfill:n}),t=!0}}})()},70655:(e,t,i)=>{"use strict";i.d(t,{ZT:()=>s,pi:()=>o,_T:()=>r,mG:()=>a,Jh:()=>l,pr:()=>c});var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};function s(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}var o=function(){return(o=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var s in t=arguments[i])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)};function r(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(i[n[s]]=e[n[s]])}return i}function a(e,t,i,n){return new(i||(i=Promise))((function(s,o){function r(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,a)}l((n=n.apply(e,t||[])).next())}))}function l(e,t){var i,n,s,o,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(s=2&o[0]?n.return:o[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,o[1])).done)return s;switch(n=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,n=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(s=r.trys,(s=s.length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){r.label=o[1];break}if(6===o[0]&&r.label<s[1]){r.label=s[1],s=o;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(o);break}s[2]&&r.ops.pop(),r.trys.pop();continue}o=t.call(e,r)}catch(e){o=[6,e],n=0}finally{i=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function c(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;var n=Array(e),s=0;for(t=0;t<i;t++)for(var o=arguments[t],r=0,a=o.length;r<a;r++,s++)n[s]=o[r];return n}},42238:function(e,t,i){var n;!function(s,o){"use strict";var r="function",a="undefined",l="object",c="model",h="name",d="type",u="vendor",p="version",m="architecture",g="console",f="mobile",v="tablet",y="smarttv",b="wearable",w={extend:function(e,t){var i={};for(var n in e)t[n]&&t[n].length%2==0?i[n]=t[n].concat(e[n]):i[n]=e[n];return i},has:function(e,t){return"string"==typeof e&&-1!==t.toLowerCase().indexOf(e.toLowerCase())},lowerize:function(e){return e.toLowerCase()},major:function(e){return"string"==typeof e?e.replace(/[^\d\.]/g,"").split(".")[0]:o},trim:function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},S={rgx:function(e,t){for(var i,n,s,a,c,h,d=0;d<t.length&&!c;){var u=t[d],p=t[d+1];for(i=n=0;i<u.length&&!c;)if(c=u[i++].exec(e))for(s=0;s<p.length;s++)h=c[++n],typeof(a=p[s])===l&&a.length>0?2==a.length?typeof a[1]==r?this[a[0]]=a[1].call(this,h):this[a[0]]=a[1]:3==a.length?typeof a[1]!==r||a[1].exec&&a[1].test?this[a[0]]=h?h.replace(a[1],a[2]):o:this[a[0]]=h?a[1].call(this,h,a[2]):o:4==a.length&&(this[a[0]]=h?a[3].call(this,h.replace(a[1],a[2])):o):this[a]=h||o;d+=2}},str:function(e,t){for(var i in t)if(typeof t[i]===l&&t[i].length>0){for(var n=0;n<t[i].length;n++)if(w.has(t[i][n],e))return"?"===i?o:i}else if(w.has(t[i],e))return"?"===i?o:i;return e}},E={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},T={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]{3,6}).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[h,p],[/(opios)[\/\s]+([\w\.]+)/i],[[h,"Opera Mini"],p],[/\s(opr)\/([\w\.]+)/i],[[h,"Opera"],p],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]*)/i,/(avant\s|iemobile|slim)(?:browser)?[\/\s]?([\w\.]*)/i,/(bidubrowser|baidubrowser)[\/\s]?([\w\.]+)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]*)/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon)\/([\w\.-]+)/i],[h,p],[/(konqueror)\/([\w\.]+)/i],[[h,"Konqueror"],p],[/(trident).+rv[:\s]([\w\.]{1,9}).+like\sgecko/i],[[h,"IE"],p],[/(edge|edgios|edga|edg)\/((\d+)?[\w\.]+)/i],[[h,"Edge"],p],[/(yabrowser)\/([\w\.]+)/i],[[h,"Yandex"],p],[/(Avast)\/([\w\.]+)/i],[[h,"Avast Secure Browser"],p],[/(AVG)\/([\w\.]+)/i],[[h,"AVG Secure Browser"],p],[/(puffin)\/([\w\.]+)/i],[[h,"Puffin"],p],[/(focus)\/([\w\.]+)/i],[[h,"Firefox Focus"],p],[/(opt)\/([\w\.]+)/i],[[h,"Opera Touch"],p],[/((?:[\s\/])uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],[[h,"UCBrowser"],p],[/(comodo_dragon)\/([\w\.]+)/i],[[h,/_/g," "],p],[/(windowswechat qbcore)\/([\w\.]+)/i],[[h,"WeChat(Win) Desktop"],p],[/(micromessenger)\/([\w\.]+)/i],[[h,"WeChat"],p],[/(brave)\/([\w\.]+)/i],[[h,"Brave"],p],[/(whale)\/([\w\.]+)/i],[[h,"Whale"],p],[/(qqbrowserlite)\/([\w\.]+)/i],[h,p],[/(QQ)\/([\d\.]+)/i],[h,p],[/m?(qqbrowser)[\/\s]?([\w\.]+)/i],[h,p],[/(baiduboxapp)[\/\s]?([\w\.]+)/i],[h,p],[/(2345Explorer)[\/\s]?([\w\.]+)/i],[h,p],[/(MetaSr)[\/\s]?([\w\.]+)/i],[h],[/(LBBROWSER)/i],[h],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[p,[h,"MIUI Browser"]],[/;fbav\/([\w\.]+);/i],[p,[h,"Facebook"]],[/FBAN\/FBIOS|FB_IAB\/FB4A/i],[[h,"Facebook"]],[/safari\s(line)\/([\w\.]+)/i,/android.+(line)\/([\w\.]+)\/iab/i],[h,p],[/headlesschrome(?:\/([\w\.]+)|\s)/i],[p,[h,"Chrome Headless"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[h,/(.+)/,"$1 WebView"],p],[/((?:oculus|samsung)browser)\/([\w\.]+)/i],[[h,/(.+(?:g|us))(.+)/,"$1 $2"],p],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[p,[h,"Android Browser"]],[/(sailfishbrowser)\/([\w\.]+)/i],[[h,"Sailfish Browser"],p],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],[h,p],[/(dolfin)\/([\w\.]+)/i],[[h,"Dolphin"],p],[/(qihu|qhbrowser|qihoobrowser|360browser)/i],[[h,"360 Browser"]],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[h,"Chrome"],p],[/(coast)\/([\w\.]+)/i],[[h,"Opera Coast"],p],[/fxios\/([\w\.-]+)/i],[p,[h,"Firefox"]],[/version\/([\w\.]+)\s.*mobile\/\w+\s(safari)/i],[p,[h,"Mobile Safari"]],[/version\/([\w\.]+)\s.*(mobile\s?safari|safari)/i],[p,h],[/webkit.+?(gsa)\/([\w\.]+)\s.*(mobile\s?safari|safari)(\/[\w\.]+)/i],[[h,"GSA"],p],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[h,[p,S.str,E.browser.oldsafari.version]],[/(webkit|khtml)\/([\w\.]+)/i],[h,p],[/(navigator|netscape)\/([\w\.-]+)/i],[[h,"Netscape"],p],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([\w\.-]+)$/i,/(firefox)\/([\w\.]+)\s[\w\s\-]+\/[\w\.]+$/i,/(mozilla)\/([\w\.]+)\s.+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]*)/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[h,p]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[m,"amd64"]],[/(ia32(?=;))/i],[[m,w.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[m,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[m,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[m,/ower/,"",w.lowerize]],[/(sun4\w)[;\)]/i],[[m,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+[;l]))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[[m,w.lowerize]]],device:[[/\((ipad|playbook);[\w\s\),;-]+(rim|apple)/i],[c,u,[d,v]],[/applecoremedia\/[\w\.]+ \((ipad)/],[c,[u,"Apple"],[d,v]],[/(apple\s{0,1}tv)/i],[[c,"Apple TV"],[u,"Apple"],[d,y]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[u,c,[d,v]],[/(kf[A-z]+)(\sbuild\/|\)).+silk\//i],[c,[u,"Amazon"],[d,v]],[/(sd|kf)[0349hijorstuw]+(\sbuild\/|\)).+silk\//i],[[c,S.str,E.device.amazon.model],[u,"Amazon"],[d,f]],[/android.+aft([bms])\sbuild/i],[c,[u,"Amazon"],[d,y]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[c,u,[d,f]],[/\((ip[honed|\s\w*]+);/i],[c,[u,"Apple"],[d,f]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]*)/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[u,c,[d,f]],[/\(bb10;\s(\w+)/i],[c,[u,"BlackBerry"],[d,f]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone|p00c)/i],[c,[u,"Asus"],[d,v]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[u,"Sony"],[c,"Xperia Tablet"],[d,v]],[/android.+\s([c-g]\d{4}|so[-l]\w+)(?=\sbuild\/|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[c,[u,"Sony"],[d,f]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[u,c,[d,g]],[/android.+;\s(shield)\sbuild/i],[c,[u,"Nvidia"],[d,g]],[/(playstation\s[34portablevi]+)/i],[c,[u,"Sony"],[d,g]],[/(sprint\s(\w+))/i],[[u,S.str,E.device.sprint.vendor],[c,S.str,E.device.sprint.model],[d,f]],[/(htc)[;_\s-]{1,2}([\w\s]+(?=\)|\sbuild)|\w+)/i,/(zte)-(\w*)/i,/(alcatel|geeksphone|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]*)/i],[u,[c,/_/g," "],[d,f]],[/(nexus\s9)/i],[c,[u,"HTC"],[d,v]],[/d\/huawei([\w\s-]+)[;\)]/i,/android.+\s(nexus\s6p|vog-[at]?l\d\d|ane-[at]?l[x\d]\d|eml-a?l\d\da?|lya-[at]?l\d[\dc]|clt-a?l\d\di?)/i],[c,[u,"Huawei"],[d,f]],[/android.+(bah2?-a?[lw]\d{2})/i],[c,[u,"Huawei"],[d,v]],[/(microsoft);\s(lumia[\s\w]+)/i],[u,c,[d,f]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[c,[u,"Microsoft"],[d,g]],[/(kin\.[onetw]{3})/i],[[c,/\./g," "],[u,"Microsoft"],[d,f]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?:?(\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w*)/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[c,[u,"Motorola"],[d,f]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[c,[u,"Motorola"],[d,v]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[u,w.trim],[c,w.trim],[d,y]],[/hbbtv.+maple;(\d+)/i],[[c,/^/,"SmartTV"],[u,"Samsung"],[d,y]],[/\(dtv[\);].+(aquos)/i],[c,[u,"Sharp"],[d,y]],[/android.+((sch-i[89]0\d|shw-m380s|SM-P605|SM-P610|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[u,"Samsung"],c,[d,v]],[/smart-tv.+(samsung)/i],[u,[d,y],c],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)/i,/sec-((sgh\w+))/i],[[u,"Samsung"],c,[d,f]],[/sie-(\w*)/i],[c,[u,"Siemens"],[d,f]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]*)/i],[[u,"Nokia"],c,[d,f]],[/android[x\d\.\s;]+\s([ab][1-7]\-?[0178a]\d\d?)/i],[c,[u,"Acer"],[d,v]],[/android.+([vl]k\-?\d{3})\s+build/i],[c,[u,"LG"],[d,v]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[u,"LG"],c,[d,v]],[/linux;\snetcast.+smarttv/i,/lg\snetcast\.tv-201\d/i],[[u,"LG"],c,[d,y]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w*)/i,/android.+lg(\-?[\d\w]+)\s+build/i],[c,[u,"LG"],[d,f]],[/(lenovo)\s?(s(?:5000|6000)(?:[\w-]+)|tab(?:[\s\w]+))/i],[u,c,[d,v]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[c,[u,"Lenovo"],[d,v]],[/(lenovo)[_\s-]?([\w-]+)/i],[u,c,[d,f]],[/linux;.+((jolla));/i],[u,c,[d,f]],[/((pebble))app\/[\d\.]+\s/i],[u,c,[d,b]],[/android.+;\s(oppo)\s?([\w\s]+)\sbuild/i],[u,c,[d,f]],[/crkey/i],[[c,"Chromecast"],[u,"Google"],[d,y]],[/android.+;\s(glass)\s\d/i],[c,[u,"Google"],[d,b]],[/android.+;\s(pixel c)[\s)]/i],[c,[u,"Google"],[d,v]],[/android.+;\s(pixel( [2-9]a?)?( xl)?)[\s)]/i],[c,[u,"Google"],[d,f]],[/android.+;\s(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]?note?[\s_]?(?:\d\w)?)\sbuild/i,/android.+(redmi[\s\-_]?(?:note|k)?(?:[\s_]?[\w\s]+))(?:\sbuild|\))/i,/android.+(mi[\s\-_]?(?:a\d|one|one[\s_]plus|note lte)?[\s_]?(?:\d?\w?)[\s_]?(?:plus)?)\sbuild/i],[[c,/_/g," "],[u,"Xiaomi"],[d,f]],[/android.+(mi[\s\-_]?(?:pad)(?:[\s_]?[\w\s]+))(?:\sbuild|\))/i],[[c,/_/g," "],[u,"Xiaomi"],[d,v]],[/android.+;\s(m[1-5]\snote)\sbuild/i],[c,[u,"Meizu"],[d,f]],[/(mz)-([\w-]{2,})/i],[[u,"Meizu"],c,[d,f]],[/android.+a000(1)\s+build/i,/android.+oneplus\s(a\d{4})[\s)]/i],[c,[u,"OnePlus"],[d,f]],[/android.+[;\/]\s*(RCT[\d\w]+)\s+build/i],[c,[u,"RCA"],[d,v]],[/android.+[;\/\s](Venue[\d\s]{2,7})\s+build/i],[c,[u,"Dell"],[d,v]],[/android.+[;\/]\s*(Q[T|M][\d\w]+)\s+build/i],[c,[u,"Verizon"],[d,v]],[/android.+[;\/]\s+(Barnes[&\s]+Noble\s+|BN[RT])(V?.*)\s+build/i],[[u,"Barnes & Noble"],c,[d,v]],[/android.+[;\/]\s+(TM\d{3}.*\b)\s+build/i],[c,[u,"NuVision"],[d,v]],[/android.+;\s(k88)\sbuild/i],[c,[u,"ZTE"],[d,v]],[/android.+[;\/]\s*(gen\d{3})\s+build.*49h/i],[c,[u,"Swiss"],[d,f]],[/android.+[;\/]\s*(zur\d{3})\s+build/i],[c,[u,"Swiss"],[d,v]],[/android.+[;\/]\s*((Zeki)?TB.*\b)\s+build/i],[c,[u,"Zeki"],[d,v]],[/(android).+[;\/]\s+([YR]\d{2})\s+build/i,/android.+[;\/]\s+(Dragon[\-\s]+Touch\s+|DT)(\w{5})\sbuild/i],[[u,"Dragon Touch"],c,[d,v]],[/android.+[;\/]\s*(NS-?\w{0,9})\sbuild/i],[c,[u,"Insignia"],[d,v]],[/android.+[;\/]\s*((NX|Next)-?\w{0,9})\s+build/i],[c,[u,"NextBook"],[d,v]],[/android.+[;\/]\s*(Xtreme\_)?(V(1[045]|2[015]|30|40|60|7[05]|90))\s+build/i],[[u,"Voice"],c,[d,f]],[/android.+[;\/]\s*(LVTEL\-)?(V1[12])\s+build/i],[[u,"LvTel"],c,[d,f]],[/android.+;\s(PH-1)\s/i],[c,[u,"Essential"],[d,f]],[/android.+[;\/]\s*(V(100MD|700NA|7011|917G).*\b)\s+build/i],[c,[u,"Envizen"],[d,v]],[/android.+[;\/]\s*(Le[\s\-]+Pan)[\s\-]+(\w{1,9})\s+build/i],[u,c,[d,v]],[/android.+[;\/]\s*(Trio[\s\w\-\.]+)\s+build/i],[c,[u,"MachSpeed"],[d,v]],[/android.+[;\/]\s*(Trinity)[\-\s]*(T\d{3})\s+build/i],[u,c,[d,v]],[/android.+[;\/]\s*TU_(1491)\s+build/i],[c,[u,"Rotor"],[d,v]],[/android.+(Gigaset)[\s\-]+(Q\w{1,9})\s+build/i],[u,c,[d,v]],[/android .+?; ([^;]+?)(?: build|\) applewebkit).+? mobile safari/i],[c,[d,f]],[/android .+?;\s([^;]+?)(?: build|\) applewebkit).+?(?! mobile) safari/i],[c,[d,v]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[d,w.lowerize],u,c],[/[\s\/\(](smart-?tv)[;\)]/i],[[d,y]],[/(android[\w\.\s\-]{0,9});.+build/i],[c,[u,"Generic"]]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[p,[h,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[p,[h,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[h,p],[/rv\:([\w\.]{1,9}).+(gecko)/i],[p,h]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[h,p],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s\w]*)/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[h,[p,S.str,E.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[h,"Windows"],[p,S.str,E.os.windows.version]],[/\((bb)(10);/i],[[h,"BlackBerry"],p],[/(blackberry)\w*\/?([\w\.]*)/i,/(tizen|kaios)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|sailfish|contiki)[\/\s-]?([\w\.]*)/i],[h,p],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]*)/i],[[h,"Symbian"],p],[/\((series40);/i],[h],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[h,"Firefox OS"],p],[/crkey\/([\d\.]+)/i],[p,[h,"Chromecast"]],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w*)/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|suse|opensuse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]*)/i,/(hurd|linux)\s?([\w\.]*)/i,/(gnu)\s?([\w\.]*)/i],[h,p],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[h,"Chromium OS"],p],[/(sunos)\s?([\w\.\d]*)/i],[[h,"Solaris"],p],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]*)/i],[h,p],[/(haiku)\s(\w+)/i],[h,p],[/cfnetwork\/.+darwin/i,/ip[honead]{2,4}(?:.*os\s([\w]+)\slike\smac|;\sopera)/i],[[p,/_/g,"."],[h,"iOS"]],[/(mac\sos\sx)\s?([\w\s\.]*)/i,/(macintosh|mac(?=_powerpc)\s)/i],[[h,"Mac OS"],[p,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]*)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.])*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms|fuchsia)/i,/(unix)\s?([\w\.]*)/i],[h,p]]},M=function(e,t){if("object"==typeof e&&(t=e,e=o),!(this instanceof M))return new M(e,t).getResult();var i=e||(s&&s.navigator&&s.navigator.userAgent?s.navigator.userAgent:""),n=t?w.extend(T,t):T;return this.getBrowser=function(){var e={name:o,version:o};return S.rgx.call(e,i,n.browser),e.major=w.major(e.version),e},this.getCPU=function(){var e={architecture:o};return S.rgx.call(e,i,n.cpu),e},this.getDevice=function(){var e={vendor:o,model:o,type:o};return S.rgx.call(e,i,n.device),e},this.getEngine=function(){var e={name:o,version:o};return S.rgx.call(e,i,n.engine),e},this.getOS=function(){var e={name:o,version:o};return S.rgx.call(e,i,n.os),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return i},this.setUA=function(e){return i=e,this},this};M.VERSION="0.7.23",M.BROWSER={NAME:h,MAJOR:"major",VERSION:p},M.CPU={ARCHITECTURE:m},M.DEVICE={MODEL:c,VENDOR:u,TYPE:d,CONSOLE:g,MOBILE:f,SMARTTV:y,TABLET:v,WEARABLE:b,EMBEDDED:"embedded"},M.ENGINE={NAME:h,VERSION:p},M.OS={NAME:h,VERSION:p},typeof t!==a?(e.exports&&(t=e.exports=M),t.UAParser=M):(n=function(){return M}.call(t,i,t,e))===o||(e.exports=n);var _=s&&(s.jQuery||s.Zepto);if(_&&!_.ua){var x=new M;_.ua=x.getResult(),_.ua.get=function(){return x.getUA()},_.ua.set=function(e){x.setUA(e);var t=x.getResult();for(var i in t)_.ua[i]=t[i]}}}("object"==typeof window?window:this)},69436:e=>{function t(e,t,i,n){this.cx=3*e,this.bx=3*(i-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(n-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=i,this.p2y=n}e.exports=t,t.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},t.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},t.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},t.prototype.solveCurveX=function(e,t){var i,n,s,o,r;for(void 0===t&&(t=1e-6),s=e,r=0;r<8;r++){if(o=this.sampleCurveX(s)-e,Math.abs(o)<t)return s;var a=this.sampleCurveDerivativeX(s);if(Math.abs(a)<1e-6)break;s-=o/a}if((s=e)<(i=0))return i;if(s>(n=1))return n;for(;i<n;){if(o=this.sampleCurveX(s),Math.abs(o-e)<t)return s;e>o?i=s:n=s,s=.5*(n-i)+i}return s},t.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}},52511:function(e,t,i){var n;e=i.nmd(e),function(s){t&&t.nodeType,e&&e.nodeType;var o="object"==typeof i.g&&i.g;o.global!==o&&o.window!==o&&o.self;var r,a=2147483647,l=36,c=/^xn--/,h=/[^\x20-\x7E]/,d=/[\x2E\u3002\uFF0E\uFF61]/g,u={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},p=Math.floor,m=String.fromCharCode;function g(e){throw RangeError(u[e])}function f(e,t){for(var i=e.length,n=[];i--;)n[i]=t(e[i]);return n}function v(e,t){var i=e.split("@"),n="";return i.length>1&&(n=i[0]+"@",e=i[1]),n+f((e=e.replace(d,".")).split("."),t).join(".")}function y(e){for(var t,i,n=[],s=0,o=e.length;s<o;)(t=e.charCodeAt(s++))>=55296&&t<=56319&&s<o?56320==(64512&(i=e.charCodeAt(s++)))?n.push(((1023&t)<<10)+(1023&i)+65536):(n.push(t),s--):n.push(t);return n}function b(e){return f(e,(function(e){var t="";return e>65535&&(t+=m((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=m(e)})).join("")}function w(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function S(e,t,i){var n=0;for(e=i?p(e/700):e>>1,e+=p(e/t);e>455;n+=l)e=p(e/35);return p(n+36*e/(e+38))}function E(e){var t,i,n,s,o,r,c,h,d,u,m,f=[],v=e.length,y=0,w=128,E=72;for((i=e.lastIndexOf("-"))<0&&(i=0),n=0;n<i;++n)e.charCodeAt(n)>=128&&g("not-basic"),f.push(e.charCodeAt(n));for(s=i>0?i+1:0;s<v;){for(o=y,r=1,c=l;s>=v&&g("invalid-input"),((h=(m=e.charCodeAt(s++))-48<10?m-22:m-65<26?m-65:m-97<26?m-97:l)>=l||h>p((a-y)/r))&&g("overflow"),y+=h*r,!(h<(d=c<=E?1:c>=E+26?26:c-E));c+=l)r>p(a/(u=l-d))&&g("overflow"),r*=u;E=S(y-o,t=f.length+1,0==o),p(y/t)>a-w&&g("overflow"),w+=p(y/t),y%=t,f.splice(y++,0,w)}return b(f)}function T(e){var t,i,n,s,o,r,c,h,d,u,f,v,b,E,T,M=[];for(v=(e=y(e)).length,t=128,i=0,o=72,r=0;r<v;++r)(f=e[r])<128&&M.push(m(f));for(n=s=M.length,s&&M.push("-");n<v;){for(c=a,r=0;r<v;++r)(f=e[r])>=t&&f<c&&(c=f);for(c-t>p((a-i)/(b=n+1))&&g("overflow"),i+=(c-t)*b,t=c,r=0;r<v;++r)if((f=e[r])<t&&++i>a&&g("overflow"),f==t){for(h=i,d=l;!(h<(u=d<=o?1:d>=o+26?26:d-o));d+=l)T=h-u,E=l-u,M.push(m(w(u+T%E,0))),h=p(T/E);M.push(m(w(h,0))),o=S(i,b,n==s),i=0,++n}++i,++t}return M.join("")}r={version:"1.3.2",ucs2:{decode:y,encode:b},decode:E,encode:T,toASCII:function(e){return v(e,(function(e){return h.test(e)?"xn--"+T(e):e}))},toUnicode:function(e){return v(e,(function(e){return c.test(e)?E(e.slice(4).toLowerCase()):e}))}},void 0===(n=function(){return r}.call(t,i,t,e))||(e.exports=n)}()},8575:(e,t,i)=>{"use strict";var n=i(52511),s=i(62502);function o(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}t.Qc=b;var r=/^([a-z0-9.+-]+:)/i,a=/:[0-9]*$/,l=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,c=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),h=["'"].concat(c),d=["%","/","?",";","#"].concat(h),u=["/","?","#"],p=/^[+a-z0-9A-Z_-]{0,63}$/,m=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,g={javascript:!0,"javascript:":!0},f={javascript:!0,"javascript:":!0},v={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},y=i(17673);function b(e,t,i){if(e&&s.isObject(e)&&e instanceof o)return e;var n=new o;return n.parse(e,t,i),n}o.prototype.parse=function(e,t,i){if(!s.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var o=e.indexOf("?"),a=-1!==o&&o<e.indexOf("#")?"?":"#",c=e.split(a);c[0]=c[0].replace(/\\/g,"/");var b=e=c.join(a);if(b=b.trim(),!i&&1===e.split("#").length){var w=l.exec(b);if(w)return this.path=b,this.href=b,this.pathname=w[1],w[2]?(this.search=w[2],this.query=t?y.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var S=r.exec(b);if(S){var E=(S=S[0]).toLowerCase();this.protocol=E,b=b.substr(S.length)}if(i||S||b.match(/^\/\/[^@\/]+@[^@\/]+/)){var T="//"===b.substr(0,2);!T||S&&f[S]||(b=b.substr(2),this.slashes=!0)}if(!f[S]&&(T||S&&!v[S])){for(var M,_,x=-1,A=0;A<u.length;A++){-1!==(O=b.indexOf(u[A]))&&(-1===x||O<x)&&(x=O)}-1!==(_=-1===x?b.lastIndexOf("@"):b.lastIndexOf("@",x))&&(M=b.slice(0,_),b=b.slice(_+1),this.auth=decodeURIComponent(M)),x=-1;for(A=0;A<d.length;A++){var O;-1!==(O=b.indexOf(d[A]))&&(-1===x||O<x)&&(x=O)}-1===x&&(x=b.length),this.host=b.slice(0,x),b=b.slice(x),this.parseHost(),this.hostname=this.hostname||"";var P="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!P)for(var C=this.hostname.split(/\./),D=(A=0,C.length);A<D;A++){var I=C[A];if(I&&!I.match(p)){for(var R="",L=0,N=I.length;L<N;L++)I.charCodeAt(L)>127?R+="x":R+=I[L];if(!R.match(p)){var k=C.slice(0,A),B=C.slice(A+1),F=I.match(m);F&&(k.push(F[1]),B.unshift(F[2])),B.length&&(b="/"+B.join(".")+b),this.hostname=k.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),P||(this.hostname=n.toASCII(this.hostname));var U=this.port?":"+this.port:"",V=this.hostname||"";this.host=V+U,this.href+=this.host,P&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==b[0]&&(b="/"+b))}if(!g[E])for(A=0,D=h.length;A<D;A++){var H=h[A];if(-1!==b.indexOf(H)){var G=encodeURIComponent(H);G===H&&(G=escape(H)),b=b.split(H).join(G)}}var z=b.indexOf("#");-1!==z&&(this.hash=b.substr(z),b=b.slice(0,z));var j=b.indexOf("?");if(-1!==j?(this.search=b.substr(j),this.query=b.substr(j+1),t&&(this.query=y.parse(this.query)),b=b.slice(0,j)):t&&(this.search="",this.query={}),b&&(this.pathname=b),v[E]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){U=this.pathname||"";var W=this.search||"";this.path=U+W}return this.href=this.format(),this},o.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",i=this.pathname||"",n=this.hash||"",o=!1,r="";this.host?o=e+this.host:this.hostname&&(o=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&s.isObject(this.query)&&Object.keys(this.query).length&&(r=y.stringify(this.query));var a=this.search||r&&"?"+r||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||v[t])&&!1!==o?(o="//"+(o||""),i&&"/"!==i.charAt(0)&&(i="/"+i)):o||(o=""),n&&"#"!==n.charAt(0)&&(n="#"+n),a&&"?"!==a.charAt(0)&&(a="?"+a),t+o+(i=i.replace(/[?#]/g,(function(e){return encodeURIComponent(e)})))+(a=a.replace("#","%23"))+n},o.prototype.resolve=function(e){return this.resolveObject(b(e,!1,!0)).format()},o.prototype.resolveObject=function(e){if(s.isString(e)){var t=new o;t.parse(e,!1,!0),e=t}for(var i=new o,n=Object.keys(this),r=0;r<n.length;r++){var a=n[r];i[a]=this[a]}if(i.hash=e.hash,""===e.href)return i.href=i.format(),i;if(e.slashes&&!e.protocol){for(var l=Object.keys(e),c=0;c<l.length;c++){var h=l[c];"protocol"!==h&&(i[h]=e[h])}return v[i.protocol]&&i.hostname&&!i.pathname&&(i.path=i.pathname="/"),i.href=i.format(),i}if(e.protocol&&e.protocol!==i.protocol){if(!v[e.protocol]){for(var d=Object.keys(e),u=0;u<d.length;u++){var p=d[u];i[p]=e[p]}return i.href=i.format(),i}if(i.protocol=e.protocol,e.host||f[e.protocol])i.pathname=e.pathname;else{for(var m=(e.pathname||"").split("/");m.length&&!(e.host=m.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==m[0]&&m.unshift(""),m.length<2&&m.unshift(""),i.pathname=m.join("/")}if(i.search=e.search,i.query=e.query,i.host=e.host||"",i.auth=e.auth,i.hostname=e.hostname||e.host,i.port=e.port,i.pathname||i.search){var g=i.pathname||"",y=i.search||"";i.path=g+y}return i.slashes=i.slashes||e.slashes,i.href=i.format(),i}var b=i.pathname&&"/"===i.pathname.charAt(0),w=e.host||e.pathname&&"/"===e.pathname.charAt(0),S=w||b||i.host&&e.pathname,E=S,T=i.pathname&&i.pathname.split("/")||[],M=(m=e.pathname&&e.pathname.split("/")||[],i.protocol&&!v[i.protocol]);if(M&&(i.hostname="",i.port=null,i.host&&(""===T[0]?T[0]=i.host:T.unshift(i.host)),i.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===m[0]?m[0]=e.host:m.unshift(e.host)),e.host=null),S=S&&(""===m[0]||""===T[0])),w)i.host=e.host||""===e.host?e.host:i.host,i.hostname=e.hostname||""===e.hostname?e.hostname:i.hostname,i.search=e.search,i.query=e.query,T=m;else if(m.length)T||(T=[]),T.pop(),T=T.concat(m),i.search=e.search,i.query=e.query;else if(!s.isNullOrUndefined(e.search)){if(M)i.hostname=i.host=T.shift(),(P=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=P.shift(),i.host=i.hostname=P.shift());return i.search=e.search,i.query=e.query,s.isNull(i.pathname)&&s.isNull(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.href=i.format(),i}if(!T.length)return i.pathname=null,i.search?i.path="/"+i.search:i.path=null,i.href=i.format(),i;for(var _=T.slice(-1)[0],x=(i.host||e.host||T.length>1)&&("."===_||".."===_)||""===_,A=0,O=T.length;O>=0;O--)"."===(_=T[O])?T.splice(O,1):".."===_?(T.splice(O,1),A++):A&&(T.splice(O,1),A--);if(!S&&!E)for(;A--;A)T.unshift("..");!S||""===T[0]||T[0]&&"/"===T[0].charAt(0)||T.unshift(""),x&&"/"!==T.join("/").substr(-1)&&T.push("");var P,C=""===T[0]||T[0]&&"/"===T[0].charAt(0);M&&(i.hostname=i.host=C?"":T.length?T.shift():"",(P=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=P.shift(),i.host=i.hostname=P.shift()));return(S=S||i.host&&T.length)&&!C&&T.unshift(""),T.length?i.pathname=T.join("/"):(i.pathname=null,i.path=null),s.isNull(i.pathname)&&s.isNull(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.auth=e.auth||i.auth,i.slashes=i.slashes||e.slashes,i.href=i.format(),i},o.prototype.parseHost=function(){var e=this.host,t=a.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},62502:e=>{"use strict";e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},42473:e=>{"use strict";var t=function(){};e.exports=t},7281:e=>{e.exports="uniform float opacity;uniform vec3 color;uniform sampler2D bg;varying vec2 vUv;void main(){vec4 bgColor=texture2D(bg,vUv);gl_FragColor=vec4(bgColor.rgb,bgColor.a*opacity);}"},29966:e=>{e.exports="uniform vec3 diffuse;uniform float opacity;uniform sampler2D mask;\n#ifdef USE_DASH\nuniform float dashSize;uniform float gapSize;\n#endif\nvarying float vLineDistance;\n#include <common>\nvarying vec2 vUv;void main(){\n#ifdef USE_DASH\nif(vUv.y<-1.||vUv.y>1.)discard;if(mod(vLineDistance,dashSize+gapSize)>dashSize)discard;\n#endif\n#ifdef USE_MASK\nvec2 modUv=vec2(vUv);modUv*=2.;vec4 texelColor=texture2D(mask,modUv);gl_FragColor=vec4(texelColor.rgb,min(texelColor.a,opacity));\n#else\ngl_FragColor=vec4(diffuse,opacity);\n#endif\n}"},9391:e=>{e.exports="#include <common>\nuniform float linewidth;uniform vec2 resolution;attribute vec3 instanceStart;attribute vec3 instanceEnd;attribute vec3 instanceColorStart;attribute vec3 instanceColorEnd;varying vec2 vUv;\n#ifdef USE_DASH\nuniform float dashScale;attribute float instanceDistanceStart;attribute float instanceDistanceEnd;varying float vLineDistance;\n#endif\nvoid trimSegment(const in vec4 start,inout vec4 end){float a=projectionMatrix[2][2];float b=projectionMatrix[3][2];float nearEstimate=-0.5*b/a;float alpha=(nearEstimate-start.z)/(end.z-start.z);end.xyz=mix(start.xyz,end.xyz,alpha);}void main(){\n#ifdef USE_COLOR\nvColor.xyz=(position.y<0.5)?instanceColorStart:instanceColorEnd;\n#endif\n#ifdef USE_DASH\nvLineDistance=(position.y<0.5)?dashScale*instanceDistanceStart:dashScale*instanceDistanceEnd;\n#endif\nfloat aspect=resolution.x/resolution.y;vUv=uv;vec4 start=modelViewMatrix*vec4(instanceStart,1.);vec4 end=modelViewMatrix*vec4(instanceEnd,1.);bool perspective=(projectionMatrix[2][3]==-1.);if(perspective){if(start.z<0.&&end.z>=0.){trimSegment(start,end);}else if(end.z<0.&&start.z>=0.){trimSegment(end,start);}}vec4 clipStart=projectionMatrix*start;vec4 clipEnd=projectionMatrix*end;vec2 ndcStart=clipStart.xy/clipStart.w;vec2 ndcEnd=clipEnd.xy/clipEnd.w;vec2 dir=ndcEnd-ndcStart;dir.x*=aspect;dir=normalize(dir);vec2 offset=vec2(dir.y,-dir.x);dir.x/=aspect;offset.x/=aspect;if(position.x<0.)offset*=-1.;offset*=linewidth;offset/=resolution.y;vec4 clip=(position.y<0.5)?clipStart:clipEnd;\n#ifdef USE_MASK\noffset*=(clipEnd.w+clipStart.w)*0.5;\n#else\noffset*=clip.w;\n#endif\nclip.xy+=offset;gl_Position=clip;\n#include <worldpos_vertex>\n}"},15145:e=>{e.exports="uniform samplerCube map;uniform vec2 dir;varying vec3 vWorldPosition;vec3 sphereToUnit(float x,float y){return vec3(sin(x)*cos(y),cos(x),sin(x)*sin(y));}vec2 unitToSphere(vec3 unit){return vec2(atan(sqrt(pow(unit.x,2.)+pow(unit.z,2.)),unit.y),atan(unit.z,unit.x));}void main(){vec2 coord=unitToSphere(vWorldPosition);vec4 sum=textureCube(map,sphereToUnit(coord.x-12.*dir.x,coord.y-12.*dir.y))*KERNEL_1;sum+=textureCube(map,sphereToUnit(coord.x-11.*dir.x,coord.y-11.*dir.y))*KERNEL_2;sum+=textureCube(map,sphereToUnit(coord.x-10.*dir.x,coord.y-10.*dir.y))*KERNEL_3;sum+=textureCube(map,sphereToUnit(coord.x-9.*dir.x,coord.y-9.*dir.y))*KERNEL_4;sum+=textureCube(map,sphereToUnit(coord.x-8.*dir.x,coord.y-8.*dir.y))*KERNEL_5;sum+=textureCube(map,sphereToUnit(coord.x-7.*dir.x,coord.y-7.*dir.y))*KERNEL_6;sum+=textureCube(map,sphereToUnit(coord.x-6.*dir.x,coord.y-6.*dir.y))*KERNEL_7;sum+=textureCube(map,sphereToUnit(coord.x-5.*dir.x,coord.y-5.*dir.y))*KERNEL_8;sum+=textureCube(map,sphereToUnit(coord.x-4.*dir.x,coord.y-4.*dir.y))*KERNEL_9;sum+=textureCube(map,sphereToUnit(coord.x-3.*dir.x,coord.y-3.*dir.y))*KERNEL_10;sum+=textureCube(map,sphereToUnit(coord.x-2.*dir.x,coord.y-2.*dir.y))*KERNEL_11;sum+=textureCube(map,sphereToUnit(coord.x-1.*dir.x,coord.y-1.*dir.y))*KERNEL_12;sum+=textureCube(map,sphereToUnit(coord.x,coord.y))*KERNEL_13;sum+=textureCube(map,sphereToUnit(coord.x+1.*dir.x,coord.y+1.*dir.y))*KERNEL_14;sum+=textureCube(map,sphereToUnit(coord.x+2.*dir.x,coord.y+2.*dir.y))*KERNEL_15;sum+=textureCube(map,sphereToUnit(coord.x+3.*dir.x,coord.y+3.*dir.y))*KERNEL_16;sum+=textureCube(map,sphereToUnit(coord.x+4.*dir.x,coord.y+4.*dir.y))*KERNEL_17;sum+=textureCube(map,sphereToUnit(coord.x+5.*dir.x,coord.y+5.*dir.y))*KERNEL_18;sum+=textureCube(map,sphereToUnit(coord.x+6.*dir.x,coord.y+6.*dir.y))*KERNEL_19;sum+=textureCube(map,sphereToUnit(coord.x+7.*dir.x,coord.y+7.*dir.y))*KERNEL_20;sum+=textureCube(map,sphereToUnit(coord.x+8.*dir.x,coord.y+8.*dir.y))*KERNEL_21;sum+=textureCube(map,sphereToUnit(coord.x+9.*dir.x,coord.y+9.*dir.y))*KERNEL_22;sum+=textureCube(map,sphereToUnit(coord.x+10.*dir.x,coord.y+10.*dir.y))*KERNEL_23;sum+=textureCube(map,sphereToUnit(coord.x+11.*dir.x,coord.y+11.*dir.y))*KERNEL_24;sum+=textureCube(map,sphereToUnit(coord.x+12.*dir.x,coord.y+12.*dir.y))*KERNEL_25;gl_FragColor=sum;}"},56163:e=>{e.exports="varying vec3 vWorldPosition;void main(){vWorldPosition=position;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},36357:e=>{e.exports="uniform samplerCube map;uniform float opacity;varying vec3 vWorldPosition;void main(){vec4 color=textureCube(map,vec3(-vWorldPosition.x,vWorldPosition.yz));gl_FragColor=vec4(color.rgb,opacity);}"},49423:e=>{e.exports="varying vec3 vWorldPosition;void main(){vWorldPosition=position;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},43411:e=>{e.exports="uniform vec3 color;uniform float opacity;uniform float maxDistance;varying vec3 vWorldPosition;void main(){float distanceToCamera=distance(cameraPosition,vWorldPosition);float distanceBucketed=1.-clamp(distanceToCamera/maxDistance,0.,1.);if(opacity<1.){discard;}gl_FragColor=vec4(distanceBucketed,distanceBucketed,distanceBucketed,1.);}"},25928:e=>{e.exports="varying vec3 vWorldPosition;void main(){vWorldPosition=(modelMatrix*vec4(position,1.)).xyz;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},65635:e=>{e.exports="uniform sampler2D map;uniform float opacity;uniform vec4 colorOverlay;varying vec2 vUv;vec4 white=vec4(0.8,0.8,0.8,1.);vec4 black=vec4(0.,0.,0.,1.);void main(){vec4 colorFromTexture=texture2D(map,vUv);float whiteness=1.-smoothstep(0.1,0.2,opacity);colorFromTexture=mix(colorFromTexture,vec4(colorOverlay.rgb,1.),colorOverlay.a);colorFromTexture=mix(colorFromTexture,white,whiteness);gl_FragColor=vec4(colorFromTexture.rgb,opacity);}"},25256:e=>{e.exports="varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},43775:e=>{e.exports="#ifdef PANO_TEXTURE\nuniform vec3 pano0Position;uniform samplerCube pano0Map;varying vec3 pano0SweepDirection;uniform float panoOpacity;\n#endif\n#ifdef PANO_TEXTURE_TRANSITION\nuniform float progress;uniform vec3 pano1Position;uniform samplerCube pano1Map;varying vec3 pano1SweepDirection;\n#endif\n#ifdef PANO_OVERLAY\nuniform samplerCube overlay0Map;varying vec3 overlay0WorldPos;\n#endif\n#ifdef PANO_OVERLAY_TRANSITION\nuniform samplerCube overlay1Map;varying vec3 overlay1WorldPos;\n#endif\n#ifdef MESH_PREVIEW_SPHERE\nuniform vec3 meshPreviewCenter;uniform float meshPreviewSize;\n#endif\n#ifdef MESH_TEXTURE\nvarying vec2 vUv;uniform sampler2D map;uniform float meshOpacity;uniform float opacity;uniform float transparentDiscardDist;varying vec3 worldPos;\n#endif\n#ifdef COLOR_OVERLAY\nuniform vec4 colorOverlay;\n#endif\n#ifdef WIREFRAME\nvarying vec3 vBarycentric;uniform float time;uniform float thickness;uniform float secondThickness;uniform float dashRepeats;uniform float dashLength;uniform bool dashOverlap;uniform bool dashEnabled;uniform bool dashAnimate;uniform bool fillEnabled;uniform bool insideAltColor;uniform bool dualStroke;uniform bool squeeze;uniform float squeezeMin;uniform float squeezeMax;uniform float wireframeOpacity;uniform vec3 stroke;uniform vec3 fill;float aastep(float threshold,float dist){float afwidth=fwidth(dist)*0.5;return smoothstep(threshold-afwidth,threshold+afwidth,dist);}float computeScreenSpaceWireframe(vec3 barycentric,float lineWidth){vec3 dist=fwidth(barycentric);vec3 smoothed=smoothstep(dist*((lineWidth*0.5)-0.5),dist*((lineWidth*0.5)+0.5),barycentric);return 1.-min(min(smoothed.x,smoothed.y),smoothed.z);}vec4 getStyledWireframe(vec3 barycentric){float PI=3.14159265359;float d=min(min(barycentric.x,barycentric.y),barycentric.z);float positionAlong=max(barycentric.x,barycentric.y);if(barycentric.y<barycentric.x&&barycentric.y<barycentric.z){positionAlong=1.-positionAlong;}float computedThickness=thickness;if(squeeze){computedThickness*=mix(squeezeMin,squeezeMax,(1.-sin(positionAlong*PI)));}if(dashEnabled){float offset=1./dashRepeats*dashLength/2.;if(!dashOverlap){offset+=1./dashRepeats/2.;}if(dashAnimate){offset+=time*0.22;}float pattern=fract((positionAlong+offset)*dashRepeats);computedThickness*=1.-aastep(dashLength,pattern);}float edge=computeScreenSpaceWireframe(barycentric,computedThickness);vec4 outColor=vec4(0.,0.,0.,0.);if(!fillEnabled){outColor=vec4(stroke,edge);if(insideAltColor&&!gl_FrontFacing){outColor.rgb=fill;}}else{outColor.a=1.;if(dualStroke){float inner=1.-aastep(secondThickness,d);vec3 wireColor=mix(fill,stroke,abs(inner-edge));outColor.rgb=wireColor;}else{outColor.rgb=mix(fill,stroke,edge);}}outColor.a*=wireframeOpacity;return outColor;}\n#endif\n#ifdef FLAT_SHADING\nvarying vec3 vNormal;\n#endif\nvoid main(){\n#ifdef PANO_TEXTURE_TRANSITION\nvec4 colorFromPano0=textureCube(pano0Map,pano0SweepDirection.xyz);vec4 colorFromPano1=textureCube(pano1Map,pano1SweepDirection.xyz);\n#ifdef PANO_OVERLAY_TRANSITION\nvec4 colorFromOverlay0=textureCube(overlay0Map,overlay0WorldPos.xyz);vec4 colorFromOverlay1=textureCube(overlay1Map,overlay1WorldPos.xyz);colorFromPano0.rgb=mix(colorFromPano0.rgb,colorFromOverlay0.rgb,colorFromOverlay0.a);colorFromPano1.rgb=mix(colorFromPano1.rgb,colorFromOverlay1.rgb,colorFromOverlay1.a);\n#endif\nvec4 color=mix(colorFromPano0,colorFromPano1,progress);color.a=panoOpacity;\n#elif defined(PANO_TEXTURE)\nvec4 color=textureCube(pano0Map,pano0SweepDirection.xyz);\n#ifdef PANO_OVERLAY\nvec4 colorFromOverlay0=textureCube(overlay0Map,overlay0WorldPos.xyz);color.rgb=mix(color.rgb,colorFromOverlay0.rgb,colorFromOverlay0.a);\n#endif\ncolor.a=panoOpacity;\n#else\nvec4 color=vec4(0.,0.,0.,0.);\n#endif\n#ifdef MESH_TEXTURE\nvec4 colorFromTexture=texture2D(map,vUv);float depth=distance(cameraPosition,worldPos.xyz);if(opacity<1.&&depth<transparentDiscardDist){discard;}\n#endif\n#ifdef MESH_PREVIEW_SPHERE\nfloat previewDistance=distance(worldPos.xyz,meshPreviewCenter.xyz);float inSphere=step(previewDistance,meshPreviewSize);colorFromTexture+=colorFromTexture*(0.2*inSphere);color=mix(color,colorFromTexture,max(meshOpacity,inSphere));\n#elif defined(MESH_TEXTURE)\ncolor=mix(color,colorFromTexture,meshOpacity);\n#endif\n#ifdef FLAT_SHADING\nfloat ao=0.9-abs(vNormal.y)*0.1-abs(vNormal.x)*0.05+abs(vNormal.z)*0.05;color.rgb=vec3(ao,ao*1.025,ao*1.05);\n#endif\n#ifdef COLOR_OVERLAY\ncolor=mix(color,vec4(colorOverlay.rgb,1.),colorOverlay.a);\n#endif\n#ifdef WIREFRAME\nvec4 colorFromWireframe=getStyledWireframe(vBarycentric);color=mix(color,vec4(colorFromWireframe.rgb,1.),colorFromWireframe.a);\n#endif\n#ifdef MESH_TEXTURE\ncolor.a=opacity;\n#endif\ngl_FragColor=color;}"},73291:e=>{e.exports="#ifdef PANO_TEXTURE\nuniform vec3 pano0Position;uniform mat4 pano0Matrix1;uniform mat4 pano0Matrix2;varying vec3 pano0SweepDirection;\n#endif\n#ifdef PANO_TEXTURE_TRANSITION\nuniform vec3 pano1Position;uniform mat4 pano1Matrix1;uniform mat4 pano1Matrix2;varying vec3 pano1SweepDirection;\n#endif\n#ifdef PANO_OVERLAY\nvarying vec3 overlay0WorldPos;uniform mat4 overlay0Matrix;\n#endif\n#ifdef PANO_OVERLAY_TRANSITION\nvarying vec3 overlay1WorldPos;uniform mat4 overlay1Matrix;\n#endif\n#ifdef MESH_PREVIEW_SPHERE\n#endif\n#ifdef MESH_TEXTURE\nvarying vec2 vUv;varying vec3 worldPos;\n#endif\n#ifdef WIREFRAME\nattribute vec3 barycentric;varying vec3 vBarycentric;\n#endif\n#ifdef FLAT_SHADING\nvarying vec3 vNormal;\n#endif\nvoid main(){vec4 worldPosition=modelMatrix*vec4(position,1.);\n#ifdef MESH_TEXTURE\nvUv=uv;worldPos=worldPosition.xyz;\n#endif\n#ifdef WIREFRAME\nvBarycentric=barycentric;\n#endif\n#ifdef FLAT_SHADING\nvNormal=normal;\n#endif\n#ifdef PANO_TEXTURE\nvec3 positionLocalToPanoCenter0=worldPosition.xyz-pano0Position;pano0SweepDirection=(pano0Matrix2*pano0Matrix1*vec4(positionLocalToPanoCenter0,1.)).xyz;\n#ifdef PANO_OVERLAY\noverlay0WorldPos=(overlay0Matrix*vec4(positionLocalToPanoCenter0,1.)).xyz;\n#endif\n#endif\n#ifdef PANO_TEXTURE_TRANSITION\nvec3 positionLocalToPanoCenter1=worldPosition.xyz-pano1Position;pano1SweepDirection=(pano1Matrix2*pano1Matrix1*vec4(positionLocalToPanoCenter1,1.)).xyz;\n#ifdef PANO_OVERLAY_TRANSITION\noverlay1WorldPos=(overlay1Matrix*vec4(positionLocalToPanoCenter1,1.)).xyz;\n#endif\n#endif\nvec4 projectedPosition=projectionMatrix*modelViewMatrix*vec4(position,1.);gl_Position=projectedPosition;}"},43655:e=>{e.exports="#ifdef INSTANCED\nvarying float alpha;varying vec3 color;\n#else\nuniform float alpha;uniform vec3 color;\n#endif\nuniform sampler2D bg;uniform sampler2D mask;varying vec2 vUv;void main(){vec4 bgColor=texture2D(bg,vUv);if(bgColor.a*alpha<0.1){discard;}vec4 maskColor=texture2D(mask,vUv);vec3 mappedColor=mix(color,maskColor.rgb,maskColor.a);gl_FragColor=vec4(mappedColor,bgColor.a*alpha);}"},23482:e=>{e.exports="varying vec2 vUv;\n#ifdef INSTANCED\nattribute mat4 instanceMatrix;attribute float instanceAlpha;attribute vec3 instanceColor;varying float alpha;varying vec3 color;\n#endif\nvoid main(){vUv=uv;\n#ifdef INSTANCED\nalpha=instanceAlpha;color=instanceColor;gl_Position=projectionMatrix*modelViewMatrix*instanceMatrix*vec4(position,1.);\n#else\ngl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);\n#endif\n}"},51953:e=>{e.exports="varying vec2 vUv;void main(){float dist=length(vUv);float alpha=(1.-smoothstep(0.95,1.,dist))*0.3;gl_FragColor=vec4(1.,1.,1.,alpha);}"},60264:e=>{e.exports="varying vec2 vUv;void main(){vUv=(uv*2.)-1.;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);gl_Position.z*=1.00001;}"},92712:e=>{e.exports="#ifdef INSTANCED\nvarying float alpha;\n#else\nuniform float alpha;\n#endif\nvoid main(){gl_FragColor=vec4(1.,1.,1.,alpha);}"},53496:e=>{e.exports="uniform vec2 resolution;\n#ifdef INSTANCED\nattribute mat4 instanceMatrix;attribute vec3 stemVector;attribute vec4 pinHeadMatrixCol0;attribute vec4 pinHeadMatrixCol1;attribute vec4 pinHeadMatrixCol2;attribute vec4 pinHeadMatrixCol3;attribute float instanceAlpha;varying float alpha;\n#else\nuniform mat4 pinHeadMatrix;\n#endif\n#define PI 3.1415926538\nvoid main(){\n#ifdef INSTANCED\nvec3 pos=position*stemVector;mat4 modelViewProjMatrix=projectionMatrix*modelViewMatrix*instanceMatrix;mat4 pinHeadMatrix=mat4(pinHeadMatrixCol0,pinHeadMatrixCol1,pinHeadMatrixCol2,pinHeadMatrixCol3);alpha=instanceAlpha;\n#else\nvec3 pos=position;mat4 modelViewProjMatrix=projectionMatrix*modelViewMatrix;\n#endif\nvec3 fromOrigin=(vec3(0.,0.,0.)-pos);if(length(fromOrigin)<1e-6){gl_Position=modelViewProjMatrix*vec4(pos,1.);}else{mat4 noteViewProj=projectionMatrix*viewMatrix*pinHeadMatrix;vec4 noteNDC=noteViewProj*vec4(0.,0.,0.,1.);noteNDC.xyz/=abs(noteNDC.w);vec4 discEdgeNDC=noteViewProj*vec4(0.5,0.,0.,1.);discEdgeNDC.xyz/=abs(discEdgeNDC.w);float noteSizeNDC=length(discEdgeNDC.xy-noteNDC.xy);vec4 anchorNDC=modelViewProjMatrix*vec4(0.,0.,0.,1.);anchorNDC.xyz/=abs(anchorNDC.w);vec4 vectorNDC=modelViewProjMatrix*vec4(pos,1.);vectorNDC.xyz/=abs(vectorNDC.w);vectorNDC-=anchorNDC;float lineLengthNDC=length(vectorNDC.xy);float vertDot=abs(dot(normalize(vectorNDC.xy),vec2(0,1)));float angle=acos(vertDot)/(PI/2.);float aspect=mix(resolution.x/resolution.y,1.,angle);vec2 vector2d=normalize(vectorNDC.xy)*max(lineLengthNDC-noteSizeNDC*aspect,0.);vectorNDC.xy=vector2d.xy;vectorNDC+=anchorNDC;gl_Position=vec4(vectorNDC.xyz,1.);}}"},89641:e=>{e.exports="uniform float borderSize;uniform float textureSampleScale;uniform samplerCube panoTexture;uniform vec4 borderColor;varying vec2 vUv;const vec4 transparent=vec4(0.,0.,0.,0.);const float PI=3.14159265359;const float HALF_PI=PI/2.;void main(){float fadeDist=0.1;float r=1.;vec2 uv=(vUv*2.)-vec2(1.,1.);float d=length(uv);float p=d*PI-HALF_PI;float y=sin(p);float h=cos(p)*textureSampleScale;vec3 sampleVec=vec3(uv.x*h,y,uv.y*h);vec4 panoColor=textureCube(panoTexture,sampleVec);panoColor.a=clamp(((1.-d)/d)/fadeDist,0.,1.);vec4 outColor=mix(panoColor,transparent,step(1.,d));float isBorder=max(sign(borderSize),0.)*step(1.-borderSize,d)*step(d,1.);gl_FragColor=mix(outColor,borderColor,isBorder);}"},69242:e=>{e.exports="varying vec2 vUv;void main(){vUv=uv;vec4 projectedPosition=projectionMatrix*viewMatrix*modelMatrix*vec4(position,1.);gl_Position=projectedPosition;}"},4035:e=>{e.exports="uniform sampler2D bg;uniform sampler2D mask;varying vec2 vUv;void main(){vec4 existingColor=texture2D(bg,vUv);vec4 maskColor=texture2D(mask,vUv);gl_FragColor=vec4(existingColor.rgb*maskColor.rgb,maskColor.a);}"},20672:e=>{e.exports="varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*vec4(position,1.);}"},38251:e=>{e.exports="uniform sampler2D texture;varying vec2 vUv;void main(){vec4 color=texture2D(texture,vUv);gl_FragColor=vec4(color.rgb,1.);}"},49749:e=>{e.exports="varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*vec4(position,1.);}"},16723:e=>{e.exports="#define M_PI 3.14159265359\nuniform samplerCube cubemap;uniform float yaw;varying vec2 vUv;void main(){vec2 uv=vUv;float theta=uv.x*2.*M_PI+yaw;float phi=uv.y*M_PI;vec3 longitude=vec3(sin(theta),1.,-cos(theta));vec3 latitude=vec3(sin(phi),-cos(phi),sin(phi));vec3 dir=longitude*latitude;normalize(dir);gl_FragColor=vec4(textureCube(cubemap,dir).rgb,1.);}"},58295:e=>{e.exports="varying vec2 vUv;void main(){vUv=vec2(1.-uv.x,uv.y);gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},451:e=>{e.exports="uniform vec3 topColor;uniform vec3 bottomColor;uniform float radius;varying vec4 worldPosition;\n#define SRGB_TO_LINEAR(c) pow((c), vec3(2.2))\n#define LINEAR_TO_SRGB(c) pow((c), vec3(1.0 / 2.2))\n#define USE_DITHER\nfloat gradientNoise(in vec2 uv){const vec3 magic=vec3(0.06711056,0.00583715,52.9829189);return fract(magic.z*fract(dot(uv,magic.xy)));}void main(){float normalizedHeight=(worldPosition.y+radius)/(radius*2.);float ratio=smoothstep(0.,0.5,normalizedHeight);vec3 colorFromGradient=mix(SRGB_TO_LINEAR(bottomColor),SRGB_TO_LINEAR(topColor),ratio);vec3 color=LINEAR_TO_SRGB(colorFromGradient);\n#if defined (USE_DITHER)\ncolor+=(1./255.)*gradientNoise(gl_FragCoord.xy)-(0.5/255.);\n#endif\ngl_FragColor=vec4(color,1.);}"},91411:e=>{e.exports="varying vec4 worldPosition;void main(){worldPosition=modelMatrix*vec4(position,1.);gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},68458:e=>{e.exports="precision highp float;precision highp int;varying vec2 vUv;uniform sampler2D tMask;uniform sampler2D tPinHole;uniform vec3 pinColor;uniform float opacity;\n#define COLOR_TOLERANCE 0.9\nvoid main(){vec4 maskColor=texture2D(tMask,vUv);vec4 pinHoleColor=vec4(texture2D(tPinHole,vec2(vUv.x,vUv.y-0.11)).xyz,1.);float maskHasRed=step(COLOR_TOLERANCE,maskColor.r);float maskHasntBlue=step(maskColor.b,1.-COLOR_TOLERANCE);vec4 mixedPinColor=mix(vec4(pinColor,1.),pinHoleColor,maskHasRed*maskHasntBlue);mixedPinColor.a=min(mixedPinColor.a,maskColor.a)*opacity;gl_FragColor=mixedPinColor;}"},97508:e=>{e.exports="precision highp float;precision highp int;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;attribute vec3 position;attribute vec2 uv;varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},1858:e=>{e.exports="precision highp float;precision highp int;uniform samplerCube tMap;varying vec3 vUvw;void main(){vec4 color=textureCube(tMap,vec3(-vUvw.x,vUvw.yz));gl_FragColor=vec4(color.rgb,1.);}"},41693:e=>{e.exports="precision highp float;precision highp int;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;attribute vec3 position;varying vec3 vUvw;void main(){vUvw=position;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},34382:e=>{e.exports="precision highp float;precision highp int;varying vec2 vUv;uniform float progress;uniform float opacity;uniform sampler2D tNoHover;uniform sampler2D tHover;uniform sampler2D tPortal;void main(){vec4 noHoverColor=texture2D(tNoHover,vUv);vec4 hoverColor=texture2D(tHover,vUv);vec4 portalColor=texture2D(tPortal,vUv);float xToCtr=2.*vUv.x-1.;float yToCtr=2.*vUv.y-1.;float withinRadius=step(xToCtr*xToCtr+yToCtr*yToCtr,0.9);vec4 mixedPortalColor=mix(hoverColor,portalColor,withinRadius);mixedPortalColor=mix(mixedPortalColor,hoverColor,hoverColor.a);mixedPortalColor=mix(noHoverColor,mixedPortalColor,progress);mixedPortalColor.a=min(mixedPortalColor.a,opacity);gl_FragColor=mixedPortalColor;}"},7206:e=>{e.exports="precision highp float;precision highp int;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;attribute vec3 position;attribute vec2 uv;varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},92566:e=>{e.exports="varying vec3 vWorldPos;uniform float alpha;uniform samplerCube tDiffuse;void main(){vec4 texColor=textureCube(tDiffuse,vWorldPos);gl_FragColor=vec4(texColor.rgb,texColor.a*alpha);}"},51799:e=>{e.exports="varying vec3 vWorldPos;void main(){vWorldPos=vec3(-position.x,-position.y,position.z);gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},52857:e=>{e.exports="varying vec2 vUv;uniform sampler2D tDiffuse;\n#ifdef INSTANCED\nvarying float alpha;\n#else\nuniform float alpha;\n#endif\nvoid main(){vec4 texColor=texture2D(tDiffuse,vUv);gl_FragColor=vec4(texColor.rgb,texColor.a*alpha);}"},82334:e=>{e.exports="#ifdef INSTANCED\nattribute mat4 instanceMatrix;attribute float instanceAlpha;varying float alpha;\n#endif\nvarying vec2 vUv;void main(){vUv=uv;\n#ifdef INSTANCED\nmat4 mvp=projectionMatrix*modelViewMatrix*instanceMatrix;alpha=instanceAlpha;\n#else\nmat4 mvp=projectionMatrix*modelViewMatrix;\n#endif\ngl_Position=mvp*vec4(position,1.);}"},13441:e=>{e.exports="precision highp float;precision highp int;uniform mat4 viewMatrix;uniform vec3 cameraPosition;"},81047:e=>{e.exports="precision highp float;precision highp int;uniform mat4 modelMatrix;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;uniform mat4 viewMatrix;uniform mat3 normalMatrix;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;"},46846:e=>{e.exports="uniform vec3 color;uniform float opacity;void main(){gl_FragColor=vec4(color,opacity);}"},41334:e=>{e.exports="void main(){gl_Position=vec4(position,1.);}"},51712:e=>{e.exports="precision highp float;precision highp int;uniform sampler2D map;uniform vec3 color;uniform float opacity;varying vec2 vUv;void main(){vec4 sample=texture2D(map,vUv).rgba;gl_FragColor=vec4(sample.rgb*color.rgb,clamp(sample.a*opacity,0.,1.));}"},35850:e=>{e.exports="precision highp float;precision highp int;attribute vec2 uv;attribute vec4 position;uniform mat4 projectionMatrix;uniform mat4 modelViewMatrix;varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*position;}"},12739:e=>{var t=/\n/,i="\n",n=/\s/;function s(e,t,i,n){var s=e.indexOf(t,i);return-1===s||s>n?n:s}function o(e){return n.test(e)}function r(e,t,i,n){return{start:t,end:t+Math.min(n,i-t)}}e.exports=function(t,i){return e.exports.lines(t,i).map((function(e){return t.substring(e.start,e.end)})).join("\n")},e.exports.lines=function(e,n){if(0===(n=n||{}).width&&"nowrap"!==n.mode)return[];e=e||"";var a="number"==typeof n.width?n.width:Number.MAX_VALUE,l=Math.max(0,n.start||0),c="number"==typeof n.end?n.end:e.length,h=n.mode,d=n.measure||r;return"pre"===h?function(e,i,n,s,o){for(var r=[],a=n,l=n;l<s&&l<i.length;l++){var c=i.charAt(l),h=t.test(c);if(h||l===s-1){var d=e(i,a,h?l:l+1,o);r.push(d),a=l+1}}return r}(d,e,l,c,a):function(e,t,n,r,a,l){var c=[],h=a;"nowrap"===l&&(h=Number.MAX_VALUE);for(;n<r&&n<t.length;){for(var d=s(t,i,n,r);n<d&&o(t.charAt(n));)n++;var u=e(t,n,d,h),p=n+(u.end-u.start),m=p+i.length;if(p<d){for(;p>n&&!o(t.charAt(p));)p--;if(p===n)m>n+i.length&&m--,p=m;else for(m=p;p>n&&o(t.charAt(p-i.length));)p--}if(p>=n){var g=e(t,n,p,h);c.push(g)}n=m}return c}(d,e,l,c,a,h)}},47529:e=>{e.exports=function(){for(var e={},i=0;i<arguments.length;i++){var n=arguments[i];for(var s in n)t.call(n,s)&&(e[s]=n[s])}return e};var t=Object.prototype.hasOwnProperty},49329:(e,t,i)=>{e.exports=i(60516).Observable},60516:(e,t)=>{"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}t.Observable=void 0;var o=function(){return"function"==typeof Symbol},r=function(e){return o()&&Boolean(Symbol[e])},a=function(e){return r(e)?Symbol[e]:"@@"+e};o()&&!r("observable")&&(Symbol.observable=Symbol("observable"));var l=a("iterator"),c=a("observable"),h=a("species");function d(e,t){var i=e[t];if(null!=i){if("function"!=typeof i)throw new TypeError(i+" is not a function");return i}}function u(e){var t=e.constructor;return void 0!==t&&null===(t=t[h])&&(t=void 0),void 0!==t?t:E}function p(e){return e instanceof E}function m(e){m.log?m.log(e):setTimeout((function(){throw e}))}function g(e){Promise.resolve().then((function(){try{e()}catch(e){m(e)}}))}function f(e){var t=e._cleanup;if(void 0!==t&&(e._cleanup=void 0,t))try{if("function"==typeof t)t();else{var i=d(t,"unsubscribe");i&&i.call(t)}}catch(e){m(e)}}function v(e){e._observer=void 0,e._queue=void 0,e._state="closed"}function y(e,t,i){e._state="running";var n=e._observer;try{var s=d(n,t);switch(t){case"next":s&&s.call(n,i);break;case"error":if(v(e),!s)throw i;s.call(n,i);break;case"complete":v(e),s&&s.call(n)}}catch(e){m(e)}"closed"===e._state?f(e):"running"===e._state&&(e._state="ready")}function b(e,t,i){if("closed"!==e._state){if("buffering"!==e._state)return"ready"!==e._state?(e._state="buffering",e._queue=[{type:t,value:i}],void g((function(){return function(e){var t=e._queue;if(t){e._queue=void 0,e._state="ready";for(var i=0;i<t.length&&(y(e,t[i].type,t[i].value),"closed"!==e._state);++i);}}(e)}))):void y(e,t,i);e._queue.push({type:t,value:i})}}var w=function(){function e(t,n){i(this,e),this._cleanup=void 0,this._observer=t,this._queue=void 0,this._state="initializing";var s=new S(this);try{this._cleanup=n.call(void 0,s)}catch(e){s.error(e)}"initializing"===this._state&&(this._state="ready")}return s(e,[{key:"unsubscribe",value:function(){"closed"!==this._state&&(v(this),f(this))}},{key:"closed",get:function(){return"closed"===this._state}}]),e}(),S=function(){function e(t){i(this,e),this._subscription=t}return s(e,[{key:"next",value:function(e){b(this._subscription,"next",e)}},{key:"error",value:function(e){b(this._subscription,"error",e)}},{key:"complete",value:function(){b(this._subscription,"complete")}},{key:"closed",get:function(){return"closed"===this._subscription._state}}]),e}(),E=function(){function e(t){if(i(this,e),!(this instanceof e))throw new TypeError("Observable cannot be called as a function");if("function"!=typeof t)throw new TypeError("Observable initializer must be a function");this._subscriber=t}return s(e,[{key:"subscribe",value:function(e){return"object"==typeof e&&null!==e||(e={next:e,error:arguments[1],complete:arguments[2]}),new w(e,this._subscriber)}},{key:"forEach",value:function(e){var t=this;return new Promise((function(i,n){if("function"==typeof e)var s=t.subscribe({next:function(t){try{e(t,o)}catch(e){n(e),s.unsubscribe()}},error:n,complete:i});else n(new TypeError(e+" is not a function"));function o(){s.unsubscribe(),i()}}))}},{key:"map",value:function(e){var t=this;if("function"!=typeof e)throw new TypeError(e+" is not a function");return new(u(this))((function(i){return t.subscribe({next:function(t){try{t=e(t)}catch(e){return i.error(e)}i.next(t)},error:function(e){i.error(e)},complete:function(){i.complete()}})}))}},{key:"filter",value:function(e){var t=this;if("function"!=typeof e)throw new TypeError(e+" is not a function");return new(u(this))((function(i){return t.subscribe({next:function(t){try{if(!e(t))return}catch(e){return i.error(e)}i.next(t)},error:function(e){i.error(e)},complete:function(){i.complete()}})}))}},{key:"reduce",value:function(e){var t=this;if("function"!=typeof e)throw new TypeError(e+" is not a function");var i=u(this),n=arguments.length>1,s=!1,o=arguments[1],r=o;return new i((function(i){return t.subscribe({next:function(t){var o=!s;if(s=!0,!o||n)try{r=e(r,t)}catch(e){return i.error(e)}else r=t},error:function(e){i.error(e)},complete:function(){if(!s&&!n)return i.error(new TypeError("Cannot reduce an empty sequence"));i.next(r),i.complete()}})}))}},{key:"concat",value:function(){for(var e=this,t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];var s=u(this);return new s((function(t){var n,o=0;return function e(r){n=r.subscribe({next:function(e){t.next(e)},error:function(e){t.error(e)},complete:function(){o===i.length?(n=void 0,t.complete()):e(s.from(i[o++]))}})}(e),function(){n&&(n.unsubscribe(),n=void 0)}}))}},{key:"flatMap",value:function(e){var t=this;if("function"!=typeof e)throw new TypeError(e+" is not a function");var i=u(this);return new i((function(n){var s=[],o=t.subscribe({next:function(t){if(e)try{t=e(t)}catch(e){return n.error(e)}var o=i.from(t).subscribe({next:function(e){n.next(e)},error:function(e){n.error(e)},complete:function(){var e=s.indexOf(o);e>=0&&s.splice(e,1),r()}});s.push(o)},error:function(e){n.error(e)},complete:function(){r()}});function r(){o.closed&&0===s.length&&n.complete()}return function(){s.forEach((function(e){return e.unsubscribe()})),o.unsubscribe()}}))}},{key:c,value:function(){return this}}],[{key:"from",value:function(t){var i="function"==typeof this?this:e;if(null==t)throw new TypeError(t+" is not an object");var n=d(t,c);if(n){var s=n.call(t);if(Object(s)!==s)throw new TypeError(s+" is not an object");return p(s)&&s.constructor===i?s:new i((function(e){return s.subscribe(e)}))}if(r("iterator")&&(n=d(t,l)))return new i((function(e){g((function(){if(!e.closed){var i=!0,s=!1,o=void 0;try{for(var r,a=n.call(t)[Symbol.iterator]();!(i=(r=a.next()).done);i=!0){var l=r.value;if(e.next(l),e.closed)return}}catch(e){s=!0,o=e}finally{try{i||null==a.return||a.return()}finally{if(s)throw o}}e.complete()}}))}));if(Array.isArray(t))return new i((function(e){g((function(){if(!e.closed){for(var i=0;i<t.length;++i)if(e.next(t[i]),e.closed)return;e.complete()}}))}));throw new TypeError(t+" is not observable")}},{key:"of",value:function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];var s="function"==typeof this?this:e;return new s((function(e){g((function(){if(!e.closed){for(var t=0;t<i.length;++t)if(e.next(i[t]),e.closed)return;e.complete()}}))}))}},{key:h,get:function(){return this}}]),e}();t.Observable=E,o()&&Object.defineProperty(E,Symbol("extensions"),{value:{symbol:c,hostReportError:m},configurable:!0})},20331:(e,t)=>{"use strict";var i,n;t.gO=t.eE=t.ru=void 0,function(e){e[e.LOW=0]="LOW",e[e.MEDIUM=1]="MEDIUM",e[e.HIGH=2]="HIGH",e[e.HIGHEST=3]="HIGHEST"}(i=t.ru||(t.ru={})),function(e){e[e.PENDING=0]="PENDING",e[e.SENDING=1]="SENDING",e[e.FAILED=2]="FAILED",e[e.DONE=3]="DONE"}(n=t.eE||(t.eE={}));var s=function(){function e(e){var t=void 0===e?{}:e,i=t.retries,n=void 0===i?3:i,s=t.concurrency,o=void 0===s?6:s;this.totalBytesDownloaded=0,this.queue=[],this.retries=n,this.concurrency=o}return e.prototype.get=function(e,t){return this.request("GET",e,t)},e.prototype.head=function(e,t){return this.request("HEAD",e,t)},e.prototype.options=function(e,t){return this.request("OPTIONS",e,t)},e.prototype.post=function(e,t){return this.request("POST",e,t)},e.prototype.put=function(e,t){return this.request("PUT",e,t)},e.prototype.patch=function(e,t){return this.request("PATCH",e,t)},e.prototype.delete=function(e,t){return this.request("DELETE",e,t)},e.prototype.request=function(e,t,i){var n=new o(e,t,i);return this.enqueue(n),n.promise},e.prototype.update=function(){for(var e;e=this.getNextPendingRequest();)this.sendRequest(e);for(;e=this.getNextOverflowingGet();)e.abort(),e.status=n.PENDING;this.updateTimeout=null},e.prototype.enqueue=function(e){var t=this,i=0;for(i=0;i<this.queue.length;i++){if(this.queue[i].priority<e.priority)break}this.queue.splice(i,0,e),this.updateTimeout||(this.updateTimeout=window.setTimeout((function(){t.update()}),1))},e.prototype.dequeue=function(e){var t=this.queue.indexOf(e);if(-1===t)throw new Error("Can't dequeue request not in queue");this.queue.splice(t,1),this.update()},e.prototype.getNextPendingRequest=function(){for(var e=0;e<this.queue.length&&e<this.concurrency;e++){var t=this.queue[e];if(t.status===n.PENDING)return t}return null},e.prototype.getNextOverflowingGet=function(){for(var e=this.concurrency;e<this.queue.length;e++){var t=this.queue[e];if(t.status===n.SENDING&&t.priority!==i.HIGHEST&&"GET"===t.method)return t}return null},e.prototype.shouldRetryStatusCode=function(t){return!e.doNotRetryStatusCodes[t]},e.prototype.sendRequest=function(e){var t=this;e.status=n.SENDING,e.send().then((function(i){e.status=n.DONE,t.dequeue(e),e.contentLength&&e.contentLength>0&&(t.totalBytesDownloaded+=Number(e.contentLength)),e.onDone(i)})).catch((function(i){var s=null!==e.maxRetries?e.maxRetries:t.retries,o=e.sendAttempts<s;if("object"==typeof i){var r=i.status_code||0;o=o&&t.shouldRetryStatusCode(r)}o?(e.status=n.PENDING,t.update(),console.warn("Retried "+e.url),console.warn(i)):(e.status=n.FAILED,t.dequeue(e),console.warn("Failed "+e.url),e.onFail(i))}))},e.doNotRetryStatusCodes={400:!0,401:!0,403:!0,404:!0,405:!0,406:!0,410:!0,411:!0,414:!0,415:!0,421:!0,431:!0,451:!0},e}();t.gO=s;var o=function(){function e(e,t,s){var o=this;void 0===s&&(s={}),this.sendAttempts=0,this.status=n.PENDING,this.contentLength=0,this.url=t,this.method=e,this.auth=s.auth||null,this.withCredentials=s.withCredentials||!1,this.priority=s.priority||i.MEDIUM,this.responseType=s.responseType||null,this.body=s.body||null,this.headers=s.headers||{},this.maxRetries=s.maxRetries||null,this.onProgress=s.onProgress,this.promise=new Promise((function(e,t){o.onDone=e,o.onFail=t}))}return e.prototype.send=function(){var e=this,t=this.xhr=function(e,t,i){var n;if("undefined"!=typeof XMLHttpRequest)(n=new XMLHttpRequest).withCredentials=i;else{if("undefined"==typeof XDomainRequest)throw new Error("No XMLHTTPRequest or XDomainRequest... are you trying to run me in node? :(");n=new XDomainRequest}return n.open(e,t,!0),n}(this.method,this.url,this.withCredentials);if(this.responseType)if("arraybuffer"===this.responseType||"text"===this.responseType||"json"===this.responseType||"blob"===this.responseType)t.responseType=this.responseType;else{if("image"!==this.responseType)throw new Error('reponseType can only be one of "arraybuffer", "text", "json", "blob", "image"');t.responseType="blob"}for(var i in"json"===this.responseType&&t.setRequestHeader("Accept","application/json"),this.auth&&"string"==typeof this.auth&&t.setRequestHeader("Authorization",this.auth),this.headers)t.setRequestHeader(i,this.headers[i]);return this.body&&"object"==typeof this.body&&(this.body instanceof FormData||(this.body=JSON.stringify(this.body),t.setRequestHeader("Content-Type","application/json"))),this.onProgress&&(t.onprogress=this.onProgress),new Promise((function(i,n){t.onreadystatechange=function(s){if(4===t.readyState){if(200===t.status||201===t.status||204===t.status)return e.parseResponse(e.xhr).then((function(e){i(e)}));0!==t.status&&n({status_code:t.status})}},t.onerror=function(e){n(e)},t.send(e.body),e.sendAttempts++}))},e.prototype.parseResponse=function(e){var t=this;return new Promise((function(i,n){try{var s=e.response;if(t.contentLength=e.getResponseHeader("Content-Length"),"json"===t.responseType&&"object"!=typeof s)i(JSON.parse(e.responseText));else if("image"===t.responseType){var o=URL.createObjectURL(s);(s=new Image).src=o,s.crossOrigin="Anonymous",s.onload=function(){URL.revokeObjectURL(o),i(s)}}else i(s)}catch(e){n({error:"Payload was not valid JSON"})}}))},e.prototype.abort=function(){if(null===this.xhr)throw new Error("Cannot abort unsent Request");this.xhr.abort()},e}()}},o={};function r(e){if(o[e])return o[e].exports;var t=o[e]={id:e,loaded:!1,exports:{}};return s[e].call(t.exports,t,t.exports,r),t.loaded=!0,t.exports}r.m=s,r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,r.t=function(i,n){if(1&n&&(i=this(i)),8&n)return i;if("object"==typeof i&&i){if(4&n&&i.__esModule)return i;if(16&n&&"function"==typeof i.then)return i}var s=Object.create(null);r.r(s);var o={};e=e||[null,t({}),t([]),t(t)];for(var a=2&n&&i;"object"==typeof a&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach((e=>o[e]=()=>i[e]));return o.default=()=>i,r.d(s,o),s},r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.f={},r.e=e=>Promise.all(Object.keys(r.f).reduce(((t,i)=>(r.f[i](e,t),t)),[])),r.u=e=>"js/"+e+".js",r.miniCssF=e=>"css/"+({66:"control-kit",143:"font",223:"whatwg-fetch",233:"core-js",376:"vr",383:"helpers",458:"showcase",525:"sdk-bundle",718:"encoders",833:"split",838:"externalSdkLoader"}[e]||e)+".css",r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i={},n="mp_webgl:",r.l=(e,t,s,o)=>{if(i[e])i[e].push(t);else{var a,l;if(void 0!==s)for(var c=document.getElementsByTagName("script"),h=0;h<c.length;h++){var d=c[h];if(d.getAttribute("src")==e||d.getAttribute("data-webpack")==n+s){a=d;break}}a||(l=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,r.nc&&a.setAttribute("nonce",r.nc),a.setAttribute("data-webpack",n+s),a.src=e),i[e]=[t];var u=(t,n)=>{a.onerror=a.onload=null,clearTimeout(p);var s=i[e];if(delete i[e],a.parentNode&&a.parentNode.removeChild(a),s&&s.forEach((e=>e(n))),t)return t(n)},p=setTimeout(u.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=u.bind(null,a.onerror),a.onload=u.bind(null,a.onload),l&&document.head.appendChild(a)}},r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),r.j=458,r.p="",(()=>{var e={458:0};r.f.j=(t,i)=>{var n=r.o(e,t)?e[t]:void 0;if(0!==n)if(n)i.push(n[2]);else{var s=new Promise(((i,s)=>{n=e[t]=[i,s]}));i.push(n[2]=s);var o=r.p+r.u(t),a=new Error;r.l(o,(i=>{if(r.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var s=i&&("load"===i.type?"missing":i.type),o=i&&i.target&&i.target.src;a.message="Loading chunk "+t+" failed.\n("+s+": "+o+")",a.name="ChunkLoadError",a.type=s,a.request=o,n[1](a)}}),"chunk-"+t,t)}};var t=(t,i)=>{for(var n,s,[o,a,l]=i,c=0,h=[];c<o.length;c++)s=o[c],r.o(e,s)&&e[s]&&h.push(e[s][0]),e[s]=0;for(n in a)r.o(a,n)&&(r.m[n]=a[n]);for(l&&l(r),t&&t(i);h.length;)h.shift()()},i=self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})(),(()=>{"use strict";r(32545),r(3058),r(72864),r(8848);var e=r(25799);const t=new e.Z("polyfills"),i=[];window.fetch||(t.debug("Loading polyfill for fetch()"),i.push(r.e(223).then(r.bind(r,57147))));const n=i,s=new e.Z("polyfills"),o=[];Array.from||(s.debug("Loading polyfill for Array.from()"),o.push(r.e(233).then(r.t.bind(r,70404,23)))),Array.prototype.fill||(s.debug("Loading polyfill for Array.prototype.fill()"),o.push(r.e(233).then(r.t.bind(r,50676,23)))),Array.prototype.find||(s.debug("Loading polyfill for Array.prototype.find()"),o.push(r.e(233).then(r.t.bind(r,73200,23)))),Array.prototype.findIndex||(s.debug("Loading polyfill for Array.prototype.findIndex()"),o.push(r.e(233).then(r.t.bind(r,48719,23)))),Array.prototype.includes||(s.debug("Loading polyfill for Array.prototype.includes()"),o.push(r.e(233).then(r.t.bind(r,96575,23))));const a=o,l=new e.Z("polyfills"),c=[];Object.assign||(l.debug("Loading polyfill for Object.assign()"),c.push(r.e(233).then(r.t.bind(r,4977,23)))),Object.values||(l.debug("Loading polyfill for Object.values()"),c.push(r.e(233).then(r.t.bind(r,36583,23)))),Object.keys||(l.debug("Loading polyfill for Object.keys()"),c.push(r.e(233).then(r.t.bind(r,9482,23))));const h=[...c,...a,...n];var d=r(41307);class EngineContext{constructor(e){this.fetchedModules=[],this.engine=e,this.messageBus=e.msgBus,this.market=new MarketContext(e.market),this.commandBinder=e.commandBinder,this.getModuleSync=e.getModuleSync.bind(e),this.addComponent=e.addComponent.bind(e),this.getComponentByType=e.getComponentByType.bind(e),this.getComponents=e.getComponents.bind(e),this.removeComponent=e.removeComponent.bind(e),this.subscribe=e.subscribe.bind(e),this.unsubscribe=e.unsubscribe.bind(e),this.broadcast=e.broadcast.bind(e),this.claimRenderLayer=e.claimRenderLayer.bind(e),this.getRenderLayer=e.getRenderLayer.bind(e),this.disposeRenderLayer=e.disposeRenderLayer.bind(e),this.startGenerator=e.startGenerator.bind(e),this.stopGenerator=e.stopGenerator.bind(e),this.after=e.after.bind(e),this.deactivate=e.deactivate.bind(e),this.toggleRendering=e.toggleRendering.bind(e),this.getXrFrame=e.getXrFrame.bind(e)}getModule(e){const t=Date.now();return this.engine.getModule(e).then((e=>{const i=Date.now();return this.fetchedModules.push({moduleName:e.name,isModule:!0,startAwait:t,finishAwait:i}),e}))}getLoadedDependencies(){return[...this.fetchedModules,...this.market.getLoadedDependencies()]}get msgBus(){return this.messageBus}}class MarketContext{constructor(e){this.fetchedData=[],this.market=e,this.register=e.register.bind(e),this.unregister=e.unregister.bind(e),this.tryGetData=e.tryGetData.bind(e),this.getModuleNameFromData=e.getModuleNameFromData.bind(e)}waitForData(e){const t=Date.now();return this.market.waitForData(e).then((e=>{const i=Date.now();return this.fetchedData.push({moduleName:this.getModuleNameFromData((0,d.oL)(e)),isModule:!1,startAwait:t,finishAwait:i}),e}))}getLoadedDependencies(){return this.fetchedData}}var u=r(44266);const p=new e.Z("module-loader");var m;!function(e){e[e.Registered=0]="Registered",e[e.Loading=1]="Loading",e[e.Initialized=2]="Initialized",e[e.Unloaded=3]="Unloaded"}(m||(m={}));class ModuleLoader{constructor(){this.registeredModules={},this.typeLookup=new d.cj}registerModule(e,t){const i=this.typeLookup.addType(e),n={es6ModulePromise:t,ctorPromise:new u.Q,initPromise:new u.Q,state:m.Registered};this.registeredModules[i]=n}aliasModule(e,t){const i=this.getTypeID(e),n=this.typeLookup.addType(t),s=this.registeredModules[i];this.registeredModules[n]=s}getTypeID(e){const t=this.typeLookup.getKeyByType(e);if(!t)throw Error("Trying to access unregistered Module");return t}getTypeFromTypeID(e){return this.typeLookup.getTypeByKey(e)}moduleRegistered(e){return!!this.typeLookup.getKeyByType(e)}moduleLoaded(e){if(!this.moduleRegistered(e))return!1;const t=this.typeLookup.getKeyByType(e),i=this.registeredModules[t].state;return![m.Registered,m.Unloaded].includes(i)}getModule(e){const t=this.typeLookup.getKeyByType(e);if(!t)throw Error(`Trying to get ${(0,d.HS)(e)} before it was registered!`);if(this.registeredModules[t].state===m.Unloaded)throw Error(`${(0,d.HS)(e)} module unloaded`);return this.registeredModules[t].initPromise.nativePromise()}getModuleSync(e){const t=this.typeLookup.getKeyByType(e);if(!t)throw new Error(`Trying to get ${(0,d.HS)(e)} before it was registered!`);const i=this.registeredModules[t];if(i.state!==m.Initialized||void 0===i.module)throw Error(`${(0,d.HS)(e)} module not loaded!`);return i.module}loadModule(e,t,i={}){const n=this.typeLookup.getKeyByType(t);if(!n)throw Error(`Attempting to load an unregistered module ${(0,d.HS)(t)}`);const s=this.registeredModules[n];if(s.state===m.Initialized)return s;if(s.state!==m.Registered&&s.state!==m.Unloaded)throw Error(`${(0,d.HS)(t)} already loading`);s.state=m.Loading;const o=(0,d.HS)(t);return s.es6ModulePromise(o).then((n=>{if(!n.default)throw new Error(`${(0,d.HS)(t)} has no default export during module loading`);const o=new n.default;s.ctorPromise.resolve(o).then((()=>{const t=Date.now();let n=!1;setTimeout((()=>{n||p.debug(`${o.name} init took over 2 seconds`)}),2e3),o.init(i,e).then((()=>{p.debug(`${o.name} init took ${(Date.now()-t)/1e3} secs.`),n=!0,s.state=m.Initialized,s.module=o,s.initPromise.resolve(o)})).catch((e=>{s.initPromise.reject(e)}))}))})).catch((e=>{p.error(`Failed to load es6Module for ${(0,d.HS)(t)}: ${e}`),s.initPromise.reject(e)})),s}whenQueueEmpties(){const e=[];for(const t in this.registeredModules){const i=this.registeredModules[t];i.state===m.Loading&&e.push(i.initPromise)}return u.Q.all(e).nativePromise()}unloadModule(e){const t=this.typeLookup.getKeyByType(e);if(!t)throw Error("Attempting to unload unregistered module");const i=this.registeredModules[t];if(i.state===m.Unloaded||i.state===m.Registered)throw Error("Attempting to unload not-loaded module");i.state=m.Unloaded,i.ctorPromise=new u.Q,i.initPromise=new u.Q,i.module=void 0}}const g="Data not present.",f=new e.Z("market");class Market{constructor(){this.typeLookup=new d.cj,this.store={},this.moduleRegistry={},this.firstUpdatePromises={}}register(e,t,i){const n=this.typeLookup.getKeyByType(t,!0);if(this.moduleRegistry[n])throw Error("Data can only be registered to one Module");this.moduleRegistry[n]=e,this.store[n]=i,i.commit(),this.firstUpdatePromises[n]&&(this.firstUpdatePromises[n].resolve(this.store[n]),delete this.firstUpdatePromises[n])}unregister(e,t){const i=this.typeLookup.getKeyByType(t,!0);if(!this.moduleRegistry[i])throw Error("No Data was registered to the Module");delete this.moduleRegistry[i],delete this.store[i]}getData(e){const t=this.typeLookup.getKeyByType(e);if(t in this.store)return this.store[t];throw Error(g)}waitForData(t){const i=this.typeLookup.getKeyByType(t,!0);return i in this.store?Promise.resolve(this.store[i]):(this.firstUpdatePromises[i]||(this.firstUpdatePromises[i]=new u.Q,setTimeout((()=>{e.Z.level>=3&&!(i in this.store)&&f.debug(`still waiting for ${t.name}-data after 5 seconds`)}),5e3)),this.firstUpdatePromises[i].nativePromise())}tryGetData(e){try{return this.getData(e)}catch(e){if(e.message!==g)throw f.error("tryGetData",e.message),e}return null}debugData(){const e={};for(const t in this.moduleRegistry){const i=this.moduleRegistry[t];i&&(e[i.name]||(e[i.name]=[]),e[i.name].push(this.store[t]))}return Object.freeze(e)}getModuleNameFromData(e){const t=this.typeLookup.getKeyByType(e);if(t){const e=this.moduleRegistry[t];if(e)return e.name}throw Error(g)}}var v=r(59309);const y=new e.Z("command-binder");class CommandBinder{constructor(){this.typeLookup=new d.cj,this.bindings={},this.queuedCommands={},this.hookedCommands={},this.resetHooks=()=>{this.hookedCommands={}},this.issueCommand=this.issueCommand.bind(this),this.issueCommandWhenBound=this.issueCommandWhenBound.bind(this)}addBinding(e,t){const i=this.typeLookup.getKeyByType(e,!0);if(this.bindings[i])throw Error(`Command ${i} already bound to a callback`);this.bindings[i]=t,this.callQueuedCommands(i);return{renew:()=>{this.bindings[i]!==t&&this.addBinding(e,t)},cancel:()=>this.removeBinding(e,t),active:this.bindings[i]===t}}removeBinding(e,t){const i=this.typeLookup.getKeyByType(e);if(!i)return void y.debug("Trying to unbind unbound command");this.bindings[i]===t?delete this.bindings[i]:y.debug("Trying to unbind unbound callback")}issueCommand(e,t=!0){const i=this.typeLookup.getKeyByInstance(e),n=this.bindings[i];return n?this.issueCommandHelper(e,i,n,t):Promise.reject("Command not bound: "+e.id)}issueCommandHelper(e,t,i,n=!0){return this.hookedCommands[t]&&!this.hookedCommands[t].resolving?this.issueHookCommand(e,t):i(e.payload)}issueCommandWhenBound(e){const t=new u.Q;return this.issueCommand(e).then((e=>t.resolve(e))).catch((i=>{const n=this.typeLookup.getKeyByInstance(e,!0);this.queuedCommands[n]||(this.queuedCommands[n]=[]),this.queuedCommands[n].push({command:e,deferred:t})})),t.nativePromise()}callQueuedCommands(e){const t=[];this.queuedCommands[e]&&(this.queuedCommands[e].forEach((e=>{t.push(this.issueCommand(e.command).then((t=>e.deferred.resolve(t))))})),Promise.all(t).then((()=>{delete this.queuedCommands[e]})))}hookCommand(e,t,i){const n=this.typeLookup.getKeyByType(e,!0);if(this.hookedCommands[n]){if(t&&null!==this.hookedCommands[n].preCommandCallback)throw Error(`Command ${e.name} has already been pre hooked`);if(!t&&null!==this.hookedCommands[n].postCommandCallback)throw Error(`Command ${e.name} has already been post hooked`)}else this.hookedCommands[n]={preCommandCallback:null,postCommandCallback:null,resolving:!1};t?this.hookedCommands[n].preCommandCallback=i:this.hookedCommands[n].postCommandCallback=i}async issueHookCommand(e,t){const i=this.hookedCommands[t],n=this.bindings[t],s=e.payload,o=i.preCommandCallback,r=i.postCommandCallback;try{o&&await o(s),i.resolving=!0;const a=await this.issueCommandHelper(e,t,n,!0);return i.resolving=!1,r&&await r(s),a}catch(e){throw Error(`Could not completely issueHookCommand - ${e}`)}}}var b=r(70785),w=r(28247),S=r(2779),E=r(51431),T=r(29675);class Profiler{constructor(){this.phaseTimes=[],this.modules={},this.addAppPhase(T.nh.UNINITIALIZED),window.profilingData={phaseTimes:this.phaseTimes,modules:this.modules}}addAppPhase(e){this.phaseTimes[e]=Date.now()}addModuleLoadTime(e,t,i,n){const s=n.map((e=>e.moduleName)).join(","),o=n.reduce(((e,t)=>e+t.finishAwait-t.startAwait),0)/(i-t)*100;this.modules[e]=[e,e,null,t,i,null,o,s]}}var M=r(3471);const _=new e.Z("engine");let x=b.A.End;class Engine{constructor(e=!1){this.moduleLookup={},this.componentLookup={},this.deactivatedHack=!1,this.currentApplication=null,this.moduleProfiler=new Profiler,this.commandBinder=new CommandBinder,this.market=new Market,this.messageBus=new v.Y,this.engineGenerators=new w.ZP,this.layers=new S.o,this.moduleLoader=new ModuleLoader,this.afterPhasePromises=[],this.afterPhaseListenerCount=[],this.resetPromises(),this.subscribe(M.LZ,(e=>this.moduleProfiler.addAppPhase(e.phase)))}async loadApplication(e,t,i){if(e===this.currentApplication)throw Error("Application already loaded");const n=(this.currentApplication?this.currentApplication.getManifest():[]).map((e=>e.type)),s=e.getManifest(),o=s.map((e=>e.type)),r=this.currentApplication;this.currentApplication=null;const a=n.filter((e=>-1===o.indexOf(e))).map((e=>this.unloadModule(e)));r&&a.push(r.unload(this));const l=s.filter((e=>-1===n.indexOf(e.type)));for(const e of l)this.moduleLoader.moduleRegistered(e.type)||this.registerModule(e);if(a.length)try{await Promise.all(a)}catch(e){_.error(e),t&&t(e)}try{this.currentApplication=e,await e.load(this,{coldStart:null===r,autoPlay:i})}catch(e){_.error(e),t&&t(e)}}registerModule(e){if(this.currentApplication)throw Error("Cannot register modules while application is running");this.moduleLoader.registerModule(e.type,e.promise)}loadModule(e){const t=e;this.moduleLoadInjectionHook&&(t.config=this.moduleLoadInjectionHook(t.type,t.config||{}));const i=new EngineContext(this),n=Date.now(),s=this.moduleLoader.loadModule(i,t.type,t.config);return s.ctorPromise.then((e=>this.moduleLookup[this.moduleLoader.getTypeID(t.type)]={module:e,initialized:!1})),s.initPromise.then((e=>{this.moduleProfiler.addModuleLoadTime(e.name,n,Date.now(),i.getLoadedDependencies()),this.moduleLookup[this.moduleLoader.getTypeID(t.type)].initialized=!0})),s.initPromise.nativePromise()}setLoadInjection(e){if(void 0!==this.moduleLoadInjectionHook)throw Error("Hook already registered");this.moduleLoadInjectionHook=e}async unloadModule(e){if(!this.moduleLoader.moduleLoaded(e))return void _.debug(`${(0,d.HS)(e)} module already unloaded`);_.debug(`Unloading ${(0,d.HS)(e)} module`);const t=await this.getModule(e),i=this.getModuleIndex(t);this.componentLookup[i]&&(await Promise.all(this.componentLookup[i].map((async e=>{await this.removeComponent(t,e.component),e.component.dispose()}))),this.componentLookup[i]=[]),this.moduleLoader.unloadModule(e),t.dispose(this)}waitForLoadingModules(){return this.moduleLoader.whenQueueEmpties()}aliasModule(e,t){this.moduleLoader.aliasModule(e,t)}async getModule(e){return this.moduleLoader.getModule(e)}getModuleSync(e){return this.moduleLoader.getModuleSync(e)}getComponentByType(e){for(const t in this.moduleLookup){const i=this.moduleLookup[t].module,n=this.getModuleIndex(i),s=this.componentLookup[n]||[];for(const t of s)if(t.component instanceof e)return t.component}return null}async addComponent(e,t){const i=this.getModuleIndex(e);let n=this.componentLookup[i];n||(this.componentLookup[i]=n=[]);let s=-1;for(let e=0;e<n.length;e++)if(n[e].component===t){s=e;break}if(-1===s&&(s=n.push({component:t,active:!1})-1,t.init()),n[s].active)throw Error("Tried to add already active component: "+typeof t);await t.activate(this),n[s].active=!0}async removeComponent(e,t){const i=this.getModuleIndex(e),n=this.componentLookup[i];if(n){let e=null;for(const i of n)if(i.component===t){e=i;break}e&&e.active&&(await t.deactivate(this),e.active=!1)}}tick(){if(this.deactivatedHack)return;if(x!==b.A.End)throw Error("Engine.tick called outside of waiting. Did the engine get called recursively?!");x=b.A.Begin,this.resolveAfterPhase(b.A.Begin);const e=performance.now(),t=this.lastTick?e-this.lastTick:16;this.lastTick=e,x=b.A.Logic;try{for(const e in this.moduleLookup){const i=this.moduleLookup[e];i&&i.initialized&&i.module.onUpdate(t)}}catch(e){throw _.error(e),e}this.resolveAfterPhase(b.A.Logic),this.engineGenerators.processGenerators(w.p3.Phase,b.A.Logic);try{this.renderComponents(t)}catch(e){throw _.error(e),e}try{x=b.A.Render,this.resolveAfterPhase(b.A.Render),this.engineGenerators.processGenerators(w.p3.Phase,b.A.Render),x=b.A.End,this.resolveAfterPhase(b.A.End),this.engineGenerators.processGenerators(w.p3.None),this.engineGenerators.processGenerators(w.p3.Promise),this.engineGenerators.processGenerators(w.p3.Duration)}catch(e){throw _.error(e),e}}subscribe(e,t,i=v.Q.PERMANENT){return this.messageBus.subscribe(e,t,i)}unsubscribe(e,t){this.messageBus.unsubscribe(e,t)}broadcast(e){this.messageBus.broadcast(e)}claimRenderLayer(e){return this.layers.claimLayer(e)}getRenderLayer(e){return this.layers.getLayer(e)}disposeRenderLayer(e){this.layers.disposeLayer(e)}startGenerator(e){this.engineGenerators.startGenerator(e)}stopGenerator(e){this.engineGenerators.stopGenerator(e)}after(e){return this.afterPhaseListenerCount[e]++,this.afterPhasePromises[e].nativePromise()}getModuleIndex(e){for(const t in this.moduleLookup)if(this.moduleLookup[t]&&this.moduleLookup[t].module===e)return t;return""}*getComponents(){for(const e in this.moduleLookup){const t=this.componentLookup[e];if(t)for(const e of t)yield e}}toggleRendering(e,t){const i=this.getModuleIndex(e),n=this.componentLookup[i];if(n)for(const e of n)e.active=t}renderComponents(e){for(const t in this.moduleLookup){const i=this.componentLookup[t];if(i)for(const t of i)t.active&&t.component.beforeRender&&t.component.beforeRender(e)}for(const t in this.moduleLookup){if(!t)continue;const i=this.componentLookup[t];if(i)for(const t of i)t.active&&t.component.render(e)}}resetPromises(){this.resetAfterPhasePromises()}resetAfterPhasePromises(){this.resetAfterPhasePromise(b.A.Logic),this.resetAfterPhasePromise(b.A.Render),this.resetAfterPhasePromise(b.A.Begin),this.resetAfterPhasePromise(b.A.End)}resetAfterPhasePromise(e){this.afterPhasePromises[e]=new u.Q,this.afterPhaseListenerCount[e]=0}resolveAfterPhase(e){this.afterPhaseListenerCount[e]>0&&(this.afterPhasePromises[e].resolve(),this.resetAfterPhasePromise(e))}deactivate(){this.getModuleSync(E.default).clearInterface();for(const e in this.moduleLookup){const t=this.moduleLookup[e];if(t&&t.initialized){const e=this.getModuleType(t.module);e&&this.unloadModule(e)}}this.deactivatedHack=!0}setXrFrame(e){this.xrFrame=e}getXrFrame(){return this.xrFrame}getModuleType(e){for(const t in this.moduleLookup){const i=this.moduleLookup[t];if(i&&i.module===e)return this.moduleLoader.getTypeFromTypeID(t)}return null}get msgBus(){return this.messageBus}}var A=r(16925),O=r(21636),P=r(32818),C=r(21265),D=r(22423),I=r(55580),R=r(92596),L=r(37018),N=r(66997),k=r(88635),B=r(58797),F=r(72316),U=r(84496),V=r(25290),H=r(20331),G=r(30963),z=r(89895),j=r(94210),W=r(73986),Z=r(20949),q=r(50101),K=r(23338),Y=r(49415),$=r(64506),X=r(44100),Q=r(40562),J=r(14600),ee=r(30853),te=r(98728),ie=r(85197),ne=r(79234),se=r(89997),oe=r(62513),re=r(67940),ae=r(92576),le=r(70389),ce=r(75752),he=r(60484),de=r(77518),ue=r(82611),pe=r(55530),me=r(23113),ge=r(43344),fe=r(39668),ve=r(31640),ye=r(17282),be=r(66872),we=r(94052),Se=r(59120),Ee=r(60959),Te=r(61597),Me=r(9351),_e=r(9841);const xe=r(73920).default;var Ae=r(51091),Oe=r(79994),Pe=r(55656),Ce=r(26986),De=r(5002),Ie=r(71208),Re=r(65976),Le=r(50004),Ne=r(28134),ke=r(29122),Be=r(10816),Fe=r(17476),Ue=r(16031),Ve=r(29821),He=r(26451),Ge=r(73354),ze=r(43339),je=r(63073),We=r(72075),Ze=r(12775),qe=r(65213),Ke=r(26430),Ye=r(32052),$e=r(95552),Xe=r(61155),Qe=r(26956),Je=r(43232),et=r(62431),tt=r(35739),it=r(93220);const nt=new e.Z("AB");class AB{constructor(e){this.values={};for(const t in e){const i=e[t];if(i&&i.ab)try{this.values[t]=st(i.ab)}catch(e){nt.warn(`Skipping key ${t}, could not pick: ${e}`)}}}get(e){return this.values[e]}serialize(){return Object.keys(this.values).map((e=>`${e}:${this.values[e]}`))}}function st(e){if(0===e.length)throw Error("A/B cannot choose from an empty choice array");let t=0;for(const i of e){if(void 0===i.value||void 0===i.weight||i.weight<0)throw Error(`Malformed AB choice: ${i}`);t+=i.weight}const i=Math.random()*t;let n=0;for(const t of e)if(n+=t.weight,i<=n)return t.value}var ot=r(15782),rt=r(91172),at=r(57155),lt=r(21685),ct=r(83455),ht=r(75638),dt=r(42885),ut=r(98809),pt=r(27545),mt=r(47173),gt=r(17694),ft=r(40440),vt=r(44693),yt=r(87131);const bt=new e.Z("showcase-settings/quality");var wt=r(48912),St=r(28281),Et=r(19417),Tt=r(55525),Mt=r(62367),_t=r(13931);const xt="cwf/src/modules/dwell-analytics";const At="cwf/src/modules/measurement-mode";var Ot=r(81303),Pt=r(85381),Ct=r(47254);const Dt="SweepPanoSolid";var It=r(64309);const Rt="cwf/src/modules/tours-data";const Lt="cwf/src/modules/video-recorder";const Nt="apps/showcase/src/modules/webvr-loader";const kt="cwf/src/modules/webxr";var Bt=r(38124),Ft=r(76598),Ut=r(68345);class EngineTick{constructor(e,t,i){this.engine=e,this.onErrorCallback=i,this.ticking=!1,this.start=()=>{this.ticking=!0},this.stop=()=>{this.ticking=!1},this.tick=(e,t)=>{if(this.ticking)try{this.engine.setXrFrame(t),this.engine.tick()}catch(e){this.stop(),this.onErrorCallback(e)}},t.setAnimationLoop(this.tick)}}var Vt=r(43894),Ht=r(17256),Gt=r(44333),zt=r(57501);class ControllerProxy{constructor(e,t){this.proxy=e,this.target=t}beginExternalTransition(){this.proxy.activeSession(this)&&this.target.beginExternalTransition()}endExternalTransition(){this.proxy.activeSession(this)&&this.target.endExternalTransition()}updateCameraPosition(e){this.proxy.activeSession(this)&&this.target.updateCameraPosition(e)}updateCameraRotation(e){this.proxy.activeSession(this)&&this.target.updateCameraRotation(e)}updateCameraFocus(e){this.proxy.activeSession(this)&&this.target.updateCameraFocus(e)}moveTo(e){return this.proxy.activeSession(this)?this.target.moveTo(e):u.Q.resolve()}}class CameraPoseProxy{constructor(e,t){this.controller=e,this.data=t,this.proxies=[]}get pose(){return this.data}activeSession(e){if(0===this.proxies.length)return!1;return this.proxies[this.proxies.length-1].controller===e}newSession(e){let t=null;if(-1!==this.proxies.findIndex((t=>t.requester===e)))throw new Error("Cannot create two sessions with the same requester");return(0,zt.k1)((()=>{if(!t){if(this.proxies.length>0){const e=this.proxies[this.proxies.length-1];e.requester.onAccessRevoked(e.controller)}t=new ControllerProxy(this,this.controller),this.proxies.push({controller:t,requester:e}),e.onAccessGranted(t)}}),(()=>{if(t){const e=this.proxies.findIndex((e=>e.controller===t));if(-1!==e){const t=this.proxies[e],i=e===this.proxies.length-1;if(i&&t.requester.onAccessRevoked(t.controller),this.proxies.splice(e,1),this.proxies.length>0&&i){const e=this.proxies[this.proxies.length-1];e.requester.onAccessGranted(e.controller)}}}}))}}var jt=r(89155),Wt=r(1143);var Zt=r(50301);const qt=new e.Z("showcase"),Kt=window.MP_PREFETCHED_MODELDATA;class Showcase{constructor(e,t={},i=!1){this.inWorkshop=e,this.settingOverrides=t,this.editModeStart=i,this.urlValues=C.AO(),this.storeQueue=new H.gO({retries:0}),this.errorPromise=new u.Q,this.quickstart="1"===this.urlValues.qs||void 0!==this.urlValues.note,this.stopTourHook=async e=>{const t=e.market.tryGetData(te.k3);t&&t.tourPlaying&&(await e.commandBinder.issueCommand(new Et.vy),await(0,Mt.gw)(10))};const{container:n}=this.settingOverrides;(0,Wt.Ad)(this.urlValues),this.apiHost=((e,t)=>{const i=e.apiHost||t.apiHost;if(i){const e=(0,Ce.JE)(i);if(e)return e}return window.location.origin})(this.urlValues,this.settingOverrides),this.container=n||document.body,this.modelUrls=(0,Ce.sU)(this.urlValues.m||this.urlValues.model,this.apiHost),this.modelUrl=`${this.modelUrls.urlBase}/api/v1/player/models/${this.modelUrls.sid}`,this.modelId=this.modelUrls.sid}getManifest(){const e=[{type:A.default,promise:()=>Promise.resolve().then(r.bind(r,16925))},{type:ee.default,promise:()=>Promise.resolve().then(r.bind(r,30853))},{type:_t.default,promise:()=>Promise.resolve().then(r.bind(r,13931))},{type:E.default,promise:()=>Promise.resolve().then(r.bind(r,51431))},{type:Y.default,promise:()=>Promise.resolve().then(r.bind(r,49415))},{type:Re.default,promise:()=>Promise.resolve().then(r.bind(r,65976))},{type:V.default,promise:()=>Promise.resolve().then(r.bind(r,25290))},{type:D.default,promise:()=>Promise.resolve().then(r.bind(r,22423))},{type:oe.default,promise:()=>Promise.resolve().then(r.bind(r,62513))},{type:N.default,promise:()=>Promise.resolve().then(r.bind(r,66997))},{type:k.default,promise:()=>Promise.resolve().then(r.bind(r,88635))},{type:Oe.default,promise:()=>Promise.resolve().then(r.bind(r,79994))},{type:j.default,promise:()=>Promise.resolve().then(r.bind(r,94210))},{type:K.default,promise:()=>Promise.resolve().then(r.bind(r,23338))},{type:q.default,promise:()=>Promise.resolve().then(r.bind(r,50101))},{type:O.default,promise:()=>Promise.resolve().then(r.bind(r,21636))},{type:P.default,promise:()=>Promise.resolve().then(r.bind(r,32818))},{type:G.default,promise:()=>Promise.resolve().then(r.bind(r,30963))},{type:Ne.default,promise:()=>Promise.resolve().then(r.bind(r,28134))},{type:z.default,promise:()=>Promise.resolve().then(r.bind(r,89895))},{type:Ut.default,promise:()=>Promise.resolve().then(r.bind(r,68345))},{type:Vt.F,promise:()=>Promise.resolve().then(r.bind(r,52721))},{type:Me.default,promise:()=>Promise.resolve().then(r.bind(r,9351))},{type:R.default,promise:()=>Promise.resolve().then(r.bind(r,92596))},{type:W.default,promise:()=>Promise.resolve().then(r.bind(r,73986))},{type:ne.default,promise:()=>Promise.resolve().then(r.bind(r,79234))},{type:ie.default,promise:()=>Promise.resolve().then(r.bind(r,85197))},{type:se.default,promise:()=>Promise.resolve().then(r.bind(r,89997))},{type:ze.default,promise:()=>Promise.resolve().then(r.bind(r,43339))},{type:re.default,promise:()=>Promise.resolve().then(r.bind(r,67940))},{type:Ge.default,promise:()=>Promise.resolve().then(r.bind(r,73354))},{type:Te.default,promise:()=>Promise.resolve().then(r.bind(r,61597))},{type:qe.default,promise:()=>Promise.resolve().then(r.bind(r,65213))},{type:xe,promise:()=>Promise.resolve().then(r.bind(r,73920))},{type:Ee.default,promise:()=>Promise.resolve().then(r.bind(r,60959))},{type:pe.default,promise:()=>Promise.resolve().then(r.bind(r,55530))},{type:tt.default,promise:()=>Promise.resolve().then(r.bind(r,35739))},{type:ae.default,promise:()=>Promise.resolve().then(r.bind(r,92576))},{type:le.default,promise:()=>Promise.resolve().then(r.bind(r,70389))},{type:ce.default,promise:()=>Promise.resolve().then(r.bind(r,75752))},{type:me.default,promise:()=>Promise.resolve().then(r.bind(r,23113))},{type:ge.default,promise:()=>Promise.resolve().then(r.bind(r,43344))},{type:_e.default,promise:()=>Promise.resolve().then(r.bind(r,9841))},{type:He.default,promise:()=>Promise.resolve().then(r.bind(r,26451))},{type:X.default,promise:()=>Promise.resolve().then(r.bind(r,44100))},{type:Q.default,promise:()=>Promise.resolve().then(r.bind(r,40562))},{type:U.default,promise:()=>Promise.resolve().then(r.bind(r,84496))},{type:Je.default,promise:()=>Promise.resolve().then(r.bind(r,43232))},{type:ue.default,promise:()=>Promise.resolve().then(r.bind(r,82611))},{type:he.default,promise:()=>Promise.resolve().then(r.bind(r,60484))},{type:de.default,promise:()=>Promise.resolve().then(r.bind(r,77518))},{type:De.default,promise:()=>Promise.resolve().then(r.bind(r,5002))},{type:be.default,promise:()=>Promise.resolve().then(r.bind(r,66872))},{type:we.default,promise:()=>Promise.resolve().then(r.bind(r,94052))},{type:fe.default,promise:()=>Promise.resolve().then(r.bind(r,39668))},{type:Ae.default,promise:()=>Promise.resolve().then(r.bind(r,51091))},{type:Xe.default,promise:()=>Promise.resolve().then(r.bind(r,61155))},{type:ve.default,promise:()=>Promise.resolve().then(r.bind(r,31640))},{type:ye.default,promise:()=>Promise.resolve().then(r.bind(r,17282))},{type:Z.default,promise:()=>Promise.resolve().then(r.bind(r,20949))},{type:Le.default,promise:()=>Promise.resolve().then(r.bind(r,50004))},{type:ke.default,promise:()=>Promise.resolve().then(r.bind(r,29122))},{type:B.default,promise:()=>Promise.resolve().then(r.bind(r,58797))},{type:je.default,promise:()=>Promise.resolve().then(r.bind(r,63073))},{type:We.default,promise:()=>Promise.resolve().then(r.bind(r,72075))},{type:Se.default,promise:()=>Promise.resolve().then(r.bind(r,59120))},{type:wt.default,promise:()=>Promise.resolve().then(r.bind(r,48912))},{type:Qe.default,promise:()=>Promise.resolve().then(r.bind(r,26956))},{type:F.default,promise:()=>Promise.resolve().then(r.bind(r,72316))},{type:Ye.default,promise:()=>Promise.resolve().then(r.bind(r,32052))},{type:Ke.default,promise:()=>Promise.resolve().then(r.bind(r,26430))},{type:$e.default,promise:()=>Promise.resolve().then(r.bind(r,95552))},{type:Be.default,promise:()=>Promise.resolve().then(r.bind(r,10816))},{type:Fe.default,promise:()=>Promise.resolve().then(r.bind(r,17476))},{type:Ue.default,promise:()=>Promise.resolve().then(r.bind(r,16031))},{type:Ve.default,promise:()=>Promise.resolve().then(r.bind(r,29821))},{type:Ct.Z,promise:()=>Promise.all([r.e(164),r.e(833)]).then(r.bind(r,84564))},{type:Dt,promise:()=>Promise.all([r.e(164),r.e(833)]).then(r.bind(r,12371))},{type:xt,promise:()=>Promise.all([r.e(164),r.e(833)]).then(r.bind(r,21362))},{type:Ot.Z,promise:()=>Promise.all([r.e(164),r.e(833)]).then(r.bind(r,10594))},{type:At,promise:()=>Promise.all([r.e(164),r.e(833)]).then(r.bind(r,59886))},{type:It.Z,promise:()=>Promise.all([r.e(164),r.e(833)]).then(r.bind(r,65619))},{type:Rt,promise:()=>Promise.all([r.e(164),r.e(833)]).then(r.bind(r,62110))},{type:Lt,promise:()=>Promise.all([r.e(164),r.e(833)]).then(r.bind(r,8473))},{type:Nt,promise:()=>Promise.all([r.e(164),r.e(833)]).then(r.bind(r,23444))},{type:kt,promise:()=>Promise.all([r.e(164),r.e(833)]).then(r.bind(r,79467))}],t=(0,Bt.LG)();return t&&e.push(t),e}getAppPhases(e){return{[T.nh.UNINITIALIZED]:[],[T.nh.WAITING]:[(async()=>{await e.getModule(Re.default)})()],[T.nh.LOADING]:[(async()=>(await e.getModule(Re.default)).waitForPlaying)()],[T.nh.STARTING]:[(async()=>(await e.getModule(X.default)).waitForFirstRender)()],[T.nh.PLAYING]:[(async()=>(await e.getModule(X.default)).waitForFlyin)()],[T.nh.ERROR]:[this.errorPromise.nativePromise()]}}getStorageProvider(){let e=!(!this.apiConfig||!this.apiConfig.mds);return"mds"in this.urlValues&&(e="1"===this.urlValues.mds),e?Ht.Xq.MDS:Ht.Xq.JSONSTORE}setError(e){this.errorPromise.reject(e),this.engineTick.stop()}async load(t,i){if(this.engine=t,this.engine.loadModule({type:A.default,config:{tasks:this.getAppPhases(t)}}),this.engine.loadModule({type:ee.default,config:{useGUI:!0}}),this.engine.loadModule({type:_t.default}),t.getModule(A.default).then((e=>{e.updateActiveApp(T.Mx.SHOWCASE),i.coldStart||t.broadcast(new M.pB(T.Mx.SHOWCASE))})),t.market.waitForData(T.pu).then((e=>{e.onChanged((async()=>{if(e.phase===T.nh.ERROR){const i=e.error,n=await t.getModule(Ne.default);throw i instanceof it.vx?n.showError(Ne.ErrorType.UNSUPPORTED):i instanceof it.Gw?n.showError(Ne.ErrorType.WEBGL):n.showError(Ne.ErrorType.GENERIC),i}}))})),!i.coldStart)return void this.loadUI(!1);qt.info("Showcase app version: 3.1.44.22-0-g33607d0d2"),this.canvas=document.createElement("canvas"),this.canvas.className="webgl-canvas";const n=document.querySelector("#app-container"),s=document.querySelector("#canvas-container"),o=document.querySelector("main")||document.body,r=parseInt(this.urlValues.log,10);this.urlValues.hasOwnProperty("log")&&!isNaN(r)&&(e.Z.level=r),this.quickstart&&qt.info("Quickstart engaged. Hold on to your knickers. "+performance.now()),this.engine.loadModule({type:V.default,config:{queue:this.storeQueue,prefetchedData:Kt,baseUrl:this.modelUrls.urlBase,preloadConfig:"showcase"}}),this.engine.loadModule({type:q.default,config:{canvas:this.canvas,useWebGL2:"1"===this.urlValues.gl2,antialias:"1"===this.urlValues.aa,useEffectComposer:!(!this.settingOverrides||!this.settingOverrides.hasOwnProperty("useEffectComposer"))&&!!this.settingOverrides.useEffectComposer,trackTextureUsage:"1"===this.urlValues.trackTextureUsage}}),this.engine.loadModule({type:z.default}),this.engine.loadModule({type:O.default,config:{container:n}}),this.engine.loadModule({type:P.default,config:{canvas:this.canvas,container:s}}),this.engine.loadModule({type:Ut.default}),this.engine.loadModule({type:Me.default});const[a,l,c,h]=await Promise.all([t.getModule(V.default),t.getModule(q.default),t.getModule(ee.default),t.getModule(z.default)]);this.engineTick=new EngineTick(this.engine,l.threeRenderer,(e=>{this.engine.getModule(Ne.default).then((t=>{this.setError(e),t.showError(Ne.ErrorType.GENERIC)}))}));const d=a.getApi(),u=d.user.getFlags("showcase/"),p=(0,gt.HG)(parseFloat(this.urlValues.wts)),{labels:m,mt:g,roomnav:f}=this.urlValues,v=d.user.loggedIn,y=!(!(b=this.modelId)||11!==b.length);var b;const w=this.inWorkshop&&y&&v&&u.has(ct.IA),S=y&&v&&("1"===this.urlValues.newtags||u.has(lt.R)&&"0"!==this.urlValues.newtags),E=u.has(ht.b),_=navigator.language===Pe.a?et.Mc.USFractional:et.Mc.Metric,x={Features:{[ut.U]:!0,[ot.AN]:!0,[dt.s]:!0,[at.Nj]:"0"!==m,[rt.re]:"0"!==g,[mt.w]:"0"!==this.urlValues.f,[mt.Q]:void 0===f&&u.has(mt.Q)||void 0!==f&&"0"!==f,[pt.EU]:p,[ht.b]:E,[ct.IA]:w,[ct.Mp]:w,[ct.pE]:w&&u.has(ct.pE),[lt.R]:S,[Zt.A]:u.has(Zt.A)},"User Preferences":{[J.F.UnitType]:_,[J.F.MeasurementSnapping]:!0,[J.F.MeasurementContinuousLines]:!0,[J.F.MeasurementUserNudgeSeen]:!1,[J.F.NotesModeNudgeSeen]:!1}};for(const e in x)for(const t in x[e]){if(void 0===x[e][t])continue;const i="User Preferences"===e?ee.SettingPersistence.LOCAL_STORAGE:ee.SettingPersistence.NONE;c.registerSetting(e,t,x[e][t],!0,i)}const D={[St.YS]:null,sid:this.modelId,quickstart:this.quickstart,lang:this.urlValues.lang,perf:this.urlValues.perf,perfInterval:this.urlValues.perfInterval};for(const e in D)c.updateSetting(e,D[e]);if(this.settingOverrides)for(const e in this.settingOverrides)c.updateSetting(e,this.settingOverrides[e]);this.apiConfig=await d.getConfigs("showcase");const N=new AB(this.apiConfig);this.loadInitialAppModules(N,l.gpuInfo,x),c.hasProperty(rt.lc)||c.updateSetting(rt.lc,this.apiConfig.embedly_key),await this.loadModel(this.modelId,i,d).catch((e=>{this.setError(e)})),this.loadSdkModule(t,d),t.commandBinder.hookCommand(Tt.ju,!0,(()=>this.stopTourHook(t))),t.commandBinder.hookCommand(Et.rU,!0,(()=>this.stopTourHook(t)));try{await t.waitForLoadingModules()}catch(e){this.setError(e),t.tick()}const[k,H]=await Promise.all([t.market.waitForData(I.T),t.market.waitForData(L.O)]);document.title=k.model.details.name;const G=H.pose;!this.quickstart||G&&G.mode===Ie.Ey.Panorama||(qt.warn("Disabling quickstart. No panorama start position."),this.quickstart=!1,c.updateSetting("quickstart",!1));const{maxMeshQuality:j,navPanoSize:K,zoomPanoSize:Y,textureLODThreshold:$}=((e,t)=>{let i,n,s,o;(0,C.tq)()||(0,C.w1)()?(0,C.tq)()&&(0,vt.W)(t)?(i=ft.S7.ULTRA,n=yt.eE[yt.SL.STANDARD],s=yt.eE[yt.SL.HIGH],o=10):(i=ft.S7.MEDIUM,n=yt.eE[yt.SL.STANDARD],s=yt.eE[yt.SL.HIGH],o=6):(i=ft.S7.ULTRA,n=yt.eE[yt.SL.HIGH],s=yt.eE[yt.SL.ULTRAHIGH],o=20);try{i=e.maxmeshq?(0,ft.Pm)(parseInt(e.maxmeshq,10)):i}catch(t){bt.warn(`Not a valid texture size: ${e.maxmeshq}`)}return n=e.maxtileq?parseInt(e.maxtileq,10):n,s=e.maxztileq?parseInt(e.maxztileq,10):s,o=e.lodtexth?parseInt(e.lodtexth,10):o,{maxMeshQuality:i,navPanoSize:n,zoomPanoSize:s,textureLODThreshold:o}})(this.urlValues,l.gpuInfo);qt.info({maxMeshQuality:j,navPanoSize:K,zoomPanoSize:Y,textureLODThreshold:$,gpuInfo:l.gpuInfo}),"0"!==this.urlValues.tiles?(this.engine.aliasModule(Ct.Z,Pt.Z),await this.engine.loadModule({type:Ct.Z,config:{navPanoSize:K,zoomPanoSize:Y}})):(this.engine.aliasModule(Dt,Pt.Z),await this.engine.loadModule({type:Dt})),await this.engine.loadModule({type:ne.default}),this.quickstart&&(this.loadPanoControls(this.editModeStart),this.engineTick.start()),await(await t.getModule(Re.default)).waitForPlaying;const oe=((e,t)=>new CameraPoseProxy(e,t))(h,(await t.market.waitForData(jt.M_)).pose);this.engine.loadModule({type:tt.default,config:{container:this.container}}),this.engine.loadModule({type:ie.default,config:{renderMeshGeometry:!0,maxQuality:j,textureLOD:"2"===this.urlValues.texlod?ie.TextureLOD.RAYCAST:"0"===this.urlValues.texlod?ie.TextureLOD.NONE:N.get("raycast_lod")?ie.TextureLOD.RAYCAST:ie.TextureLOD.NONE,textureLODThreshold:void 0!==this.urlValues.texlodthreshold?parseInt(this.urlValues.texlodthreshold,10):$,colorizeRooms:"1"===this.urlValues.colorizeRooms,colorizeChunks:"1"===this.urlValues.colorizeChunks,wireframe:"1"===this.urlValues.wireframe}}),this.engine.loadModule({type:ze.default}),this.engine.loadModule({type:se.default,config:{startingMode:this.quickstart?Ie.Ey.Panorama:null}}),this.engine.loadModule({type:le.default,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,storageProvider:this.getStorageProvider()}}),this.engine.loadModule({type:W.default}),this.engine.loadModule({type:re.default,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,storageProvider:this.getStorageProvider(),readonly:!0}}),this.engine.loadModule({type:ae.default,config:{allowFloorChanges:x.Features[mt.w],focusBasedNav:x.Features[mt.Q]}}),this.engine.loadModule({type:Ge.default}),this.engine.loadModule({type:R.default,config:{baseUrl:this.modelUrls.urlBase,api:d,queue:this.storeQueue,modelId:this.modelId,storageProvider:this.getStorageProvider()}}),this.engine.loadModule({type:Te.default,config:{workshopApp:this.inWorkshop,container:this.container,mainDiv:o}}),this.engine.loadModule({type:qe.default,config:{mainDiv:o}}),this.engine.loadModule({type:xe}),this.engine.loadModule({type:ce.default}),this.engine.loadModule({type:me.default,config:{cameraPoseProxy:oe}}),this.engine.loadModule({type:ge.default}),this.engine.loadModule({type:_e.default,config:{enabled:"1"!==this.urlValues.nozoom,tiles:"0"!==this.urlValues.tiles}}),this.engine.loadModule({type:X.default}),this.engine.loadModule({type:U.default,config:{enableWheel:"1"===this.urlValues.nozoom,focusBasedNav:x.Features[mt.Q]}}),this.engine.loadModule({type:Je.default}),this.engine.loadModule({type:Q.default,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,storageProvider:this.getStorageProvider(),readonly:!0}}),this.engine.loadModule({type:He.default}),this.quickstart||this.engineTick.start(),this.quickstart||this.loadPanoControls(this.editModeStart),await this.engine.waitForLoadingModules(),(0,Bt.DO)(t,oe),"0"!==this.urlValues.portal&&(this.engine.loadModule({type:Fe.default}),this.engine.loadModule({type:Be.default})),"0"!==this.urlValues.pin&&(this.engine.loadModule({type:Ve.default}),this.engine.loadModule({type:Ue.default})),this.engine.loadModule({type:ue.default,config:{checkRenderModes:()=>{const e=t.market.tryGetData(te.k3);if(e&&e.isTourActive())return!1;const i=t.market.tryGetData(Ze.O);return!!i&&i.isPano()}}}),this.engine.loadModule({type:be.default,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,storageProvider:this.getStorageProvider(),readonly:!0}}),this.engine.loadModule({type:Ae.default}),this.engine.loadModule({type:Xe.default,config:{notesModeEnabled:w,newTagsEnabled:S}}),this.engine.loadModule({type:Qe.default,config:{debug:"1"===this.urlValues.fcdbg}}),this.getStorageProvider()===Ht.Xq.JSONSTORE&&this.engine.loadModule({type:we.default,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,readonly:!0,queue:this.storeQueue}}),this.engine.loadModule({type:Se.default}),this.engine.loadModule({type:fe.default,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,storageProvider:this.getStorageProvider(),readonly:!0,parserOptions:{model:this.modelId,supportLinks:!this.urlValues.mls||"0"===this.urlValues.mls,keepLinkLabels:!0}}}),this.engine.loadModule({type:ve.default}),this.engine.loadModule({type:ye.default}),this.engine.loadModule({type:Z.default}),this.engine.loadModule({type:Rt,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,storageProvider:this.getStorageProvider(),readonly:!0,looping:"1"===this.urlValues.lp}}),this.engine.loadModule({type:It.Z}),this.engine.loadModule({type:Le.default}),this.engine.loadModule({type:he.default}),this.engine.loadModule({type:de.default}),this.engine.loadModule({type:De.default}),this.engine.loadModule({type:Nt}),this.engine.loadModule({type:Ot.Z,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,storageProvider:this.getStorageProvider()}}),this.engine.loadModule({type:ke.default}),this.engine.loadModule({type:je.default}),this.engine.loadModule({type:We.default}),this.engine.loadModule({type:wt.default}),this.engine.loadModule({type:Lt}),this.engine.loadModule({type:At,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,storageProvider:this.getStorageProvider(),readonly:!0,queue:this.storeQueue}}),this.engine.loadModule({type:B.default,config:{queue:this.storeQueue}}),this.engine.loadModule({type:xt}),(w||S)&&(this.engine.loadModule({type:F.default,config:{queue:this.storeQueue,baseUrl:this.modelUrls.urlBase,modelId:this.modelId,modelUrl:this.modelUrl}}),w&&this.engine.loadModule({type:Ke.default,config:{storageProvider:this.getStorageProvider(),workshop:this.inWorkshop,baseUrl:this.modelUrls.urlBase,modelId:this.modelId,queue:this.storeQueue,startingNote:this.urlValues.note,readonly:!1}}),S&&this.engine.loadModule({type:$e.default}),this.engine.loadModule({type:Ye.default})),this.engine.loadModule({type:kt,config:{enableEventPositions:!1,framebufferScaling:Math.min(this.urlValues.xrframebuffer?parseFloat(this.urlValues.xrframebuffer):0,1),tracking:0,navPanoSize:K}})}async unload(e){try{await e.commandBinder.issueCommand(new Et.vy)}catch(e){qt.debug("showcase unload called before tour controls registered, ignoring stopTour",e)}await this.showcaseGui.unloadUi(),this.guiModule.unloadUi(),e.commandBinder.resetHooks()}async loadModel(e,t,i){qt.info(`Loading model ${e}`),await i.modelExists(e).catch((async e=>{if(!(e instanceof Ft.GT))throw e;await this.login()})),this.inWorkshop&&this.getStorageProvider()===Ht.Xq.MDS&&(await this.engine.getModule(Vt.F),await this.engine.commandBinder.issueCommand(new Gt.dS({viewType:Ht.XZ.SESSION}))),this.loadInitialDataModules(e,t)}loadInitialAppModules(e,t,i){this.engine.loadModule({type:oe.default}),this.engine.loadModule({type:G.default,config:{disableWheel:"0"===this.urlValues.wh,pointerPreventDefault:!this.settingOverrides||!this.settingOverrides.hasOwnProperty("pointerPreventDefault")||!!this.settingOverrides.pointerPreventDefault}}),this.engine.loadModule({type:Oe.default,config:{queue:this.storeQueue}}),this.engine.loadModule({type:K.default,config:{queue:this.storeQueue,appName:this.settingOverrides&&this.settingOverrides.appName||"showcase",provider:this.urlValues.analytics,additionalValues:{ab_tests:e.serialize(),gpu:t}}}),this.engine.loadModule({type:Ne.default});let n=i.Features[Zt.A]?Ht.hV.CACHE:Ht.hV.NONE;const s=this.urlValues.prefetch;s&&Object.values(Ht.hV).includes(s)&&(n=s),this.engine.loadModule({type:Vt.F,config:{modelId:this.modelId,mdsEnabled:this.getStorageProvider()===Ht.Xq.MDS,prefetchPolicy:n,baseUrl:this.apiHost,queue:this.storeQueue}})}loadInitialDataModules(e,t){const i=!("1"!==this.urlValues.play&&!t.autoPlay),n=C.Ot()&&!C.PI("xr-spatial-tracking"),s=!C.yL()||i&&!n,o=!(C.tq()||n),r=void 0!==this.urlValues.note,a=r,l=r||"0"===this.urlValues.title||"2"===this.urlValues.title,c=r||"1"===this.urlValues.mls||"2"===this.urlValues.mls||"0"===this.urlValues.brand;this.engine.loadModule({type:Re.default,config:{inWorkshop:this.inWorkshop,modelId:this.modelId,baseUrl:this.modelUrls.urlBase,quickstart:this.quickstart,autoplay:s,allowPlayInIframe:o,startNewTab:"1"===this.urlValues.nt,hideTitle:l,hideBranding:c,hidePoweredBy:a}}),this.engine.loadModule({type:k.default,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,storageProvider:this.getStorageProvider(),readonly:!0}}),this.engine.loadModule({type:N.default,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,storageProvider:this.getStorageProvider(),readonly:!0}}),this.engine.loadModule({type:D.default,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,storageProvider:this.getStorageProvider(),readonly:!0}}),this.engine.loadModule({type:j.default,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,storageProvider:this.getStorageProvider(),readonly:!0}})}loadPanoControls(e){this.loadUI(e),this.engine.loadModule({type:Ee.default}),this.engine.loadModule({type:pe.default})}async loadSdkModule(e,t){this.engine.loadModule({type:E.default,config:{validationUrl:this.apiHost+"/api/v1/user/",clientScriptUrl:await async function(){return await t.getAppKey("showcase","sdk_version")||""}(),setupExternalSdk:async function(i){const n=await r.e(838).then(r.bind(r,91453));await n.loadInterface(i,e,t)},queue:this.storeQueue}})}loadUI(e){Promise.all([this.engine.getModule(Te.default),this.engine.getModule(xe)]).then((([t,i])=>{this.guiModule=t,this.showcaseGui=i,e||t.loadUi(i.loadUi)}))}login(){return new Promise((async e=>{this.engine.loadModule({type:Y.default,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,container:this.container}});const t=await this.engine.getModule(Y.default);this.engine.subscribe($.L,(()=>{t.hidePasswordScreen(),e()})),t.showPasswordScreen()}))}}var Yt,$t=r(5277);!function(e){e.connect=async function(e,i){if("string"!=typeof i)throw Error("invalid key");const n=`${window.location.protocol}//${window.location.host}`,s=await e.getModule(E.default),o=await s.connect(i,n);return new(await async function(e){if(e){const i=t[e];if(i)return i;const n=new Promise(((t,i)=>{try{$t(e,(function(){const e=window["sdk-client"];delete window["sdk-client"],e&&e.SdkBuilder&&"function"==typeof e.SdkBuilder&&t(e.SdkBuilder)}))}catch(t){i(`Could not load the sdk from ${e}`)}}));return t[e]=n,n}throw new Error("Unabled to load the sdk")}(o.scriptUrl))(o.messengerFactory).build(o.serializedInterface)};const t={}}(Yt||(Yt={}));const Xt=new e.Z("bootstrap");function Qt(e){const t=new Engine,i=new Showcase(!1,e);t.loadApplication(i,i.setError.bind(i)),C.Jm()||document.body.classList.add("no-touch"),function(e){window.MP_SDK={connect:async(t,i)=>Yt.connect(e,i)}}(t)}window.addEventListener("app-start",(e=>{const t=e.detail&&e.detail.config?e.detail.config:{};let i=!1;(async()=>Promise.all(h))().then((()=>{i=!0,Qt(t)})).catch((e=>{Xt.error(e),i||Qt(t)}))}),!0)})()})();